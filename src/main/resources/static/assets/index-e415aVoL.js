var UD=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Hie=UD(et=>{function GD(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const a=Object.getOwnPropertyDescriptor(n,i);a&&Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();var aE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Rb={exports:{}},Fm={},Ob={exports:{}},Mr={};var sE;function VD(){if(sE)return Mr;sE=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),s=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),h=Symbol.iterator;function p(X){return X===null||typeof X!="object"?null:(X=h&&X[h]||X["@@iterator"],typeof X=="function"?X:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,S={};function w(X,re,he){this.props=X,this.context=re,this.refs=S,this.updater=he||g}w.prototype.isReactComponent={},w.prototype.setState=function(X,re){if(typeof X!="object"&&typeof X!="function"&&X!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,X,re,"setState")},w.prototype.forceUpdate=function(X){this.updater.enqueueForceUpdate(this,X,"forceUpdate")};function C(){}C.prototype=w.prototype;function _(X,re,he){this.props=X,this.context=re,this.refs=S,this.updater=he||g}var T=_.prototype=new C;T.constructor=_,y(T,w.prototype),T.isPureReactComponent=!0;var N=Array.isArray,R=Object.prototype.hasOwnProperty,I={current:null},j={key:!0,ref:!0,__self:!0,__source:!0};function O(X,re,he){var oe,se={},fe=null,ae=null;if(re!=null)for(oe in re.ref!==void 0&&(ae=re.ref),re.key!==void 0&&(fe=""+re.key),re)R.call(re,oe)&&!j.hasOwnProperty(oe)&&(se[oe]=re[oe]);var pe=arguments.length-2;if(pe===1)se.children=he;else if(1<pe){for(var ye=Array(pe),ve=0;ve<pe;ve++)ye[ve]=arguments[ve+2];se.children=ye}if(X&&X.defaultProps)for(oe in pe=X.defaultProps,pe)se[oe]===void 0&&(se[oe]=pe[oe]);return{$$typeof:t,type:X,key:fe,ref:ae,props:se,_owner:I.current}}function F(X,re){return{$$typeof:t,type:X.type,key:re,ref:X.ref,props:X.props,_owner:X._owner}}function z(X){return typeof X=="object"&&X!==null&&X.$$typeof===t}function V(X){var re={"=":"=0",":":"=2"};return"$"+X.replace(/[=:]/g,function(he){return re[he]})}var q=/\/+/g;function D(X,re){return typeof X=="object"&&X!==null&&X.key!=null?V(""+X.key):re.toString(36)}function U(X,re,he,oe,se){var fe=typeof X;(fe==="undefined"||fe==="boolean")&&(X=null);var ae=!1;if(X===null)ae=!0;else switch(fe){case"string":case"number":ae=!0;break;case"object":switch(X.$$typeof){case t:case e:ae=!0}}if(ae)return ae=X,se=se(ae),X=oe===""?"."+D(ae,0):oe,N(se)?(he="",X!=null&&(he=X.replace(q,"$&/")+"/"),U(se,re,he,"",function(ve){return ve})):se!=null&&(z(se)&&(se=F(se,he+(!se.key||ae&&ae.key===se.key?"":(""+se.key).replace(q,"$&/")+"/")+X)),re.push(se)),1;if(ae=0,oe=oe===""?".":oe+":",N(X))for(var pe=0;pe<X.length;pe++){fe=X[pe];var ye=oe+D(fe,pe);ae+=U(fe,re,he,ye,se)}else if(ye=p(X),typeof ye=="function")for(X=ye.call(X),pe=0;!(fe=X.next()).done;)fe=fe.value,ye=oe+D(fe,pe++),ae+=U(fe,re,he,ye,se);else if(fe==="object")throw re=String(X),Error("Objects are not valid as a React child (found: "+(re==="[object Object]"?"object with keys {"+Object.keys(X).join(", ")+"}":re)+"). If you meant to render a collection of children, use an array instead.");return ae}function G(X,re,he){if(X==null)return X;var oe=[],se=0;return U(X,oe,"","",function(fe){return re.call(he,fe,se++)}),oe}function Z(X){if(X._status===-1){var re=X._result;re=re(),re.then(function(he){(X._status===0||X._status===-1)&&(X._status=1,X._result=he)},function(he){(X._status===0||X._status===-1)&&(X._status=2,X._result=he)}),X._status===-1&&(X._status=0,X._result=re)}if(X._status===1)return X._result.default;throw X._result}var K={current:null},Q={transition:null},ne={ReactCurrentDispatcher:K,ReactCurrentBatchConfig:Q,ReactCurrentOwner:I};function te(){throw Error("act(...) is not supported in production builds of React.")}return Mr.Children={map:G,forEach:function(X,re,he){G(X,function(){re.apply(this,arguments)},he)},count:function(X){var re=0;return G(X,function(){re++}),re},toArray:function(X){return G(X,function(re){return re})||[]},only:function(X){if(!z(X))throw Error("React.Children.only expected to receive a single React element child.");return X}},Mr.Component=w,Mr.Fragment=r,Mr.Profiler=i,Mr.PureComponent=_,Mr.StrictMode=n,Mr.Suspense=l,Mr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ne,Mr.act=te,Mr.cloneElement=function(X,re,he){if(X==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+X+".");var oe=y({},X.props),se=X.key,fe=X.ref,ae=X._owner;if(re!=null){if(re.ref!==void 0&&(fe=re.ref,ae=I.current),re.key!==void 0&&(se=""+re.key),X.type&&X.type.defaultProps)var pe=X.type.defaultProps;for(ye in re)R.call(re,ye)&&!j.hasOwnProperty(ye)&&(oe[ye]=re[ye]===void 0&&pe!==void 0?pe[ye]:re[ye])}var ye=arguments.length-2;if(ye===1)oe.children=he;else if(1<ye){pe=Array(ye);for(var ve=0;ve<ye;ve++)pe[ve]=arguments[ve+2];oe.children=pe}return{$$typeof:t,type:X.type,key:se,ref:fe,props:oe,_owner:ae}},Mr.createContext=function(X){return X={$$typeof:s,_currentValue:X,_currentValue2:X,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},X.Provider={$$typeof:a,_context:X},X.Consumer=X},Mr.createElement=O,Mr.createFactory=function(X){var re=O.bind(null,X);return re.type=X,re},Mr.createRef=function(){return{current:null}},Mr.forwardRef=function(X){return{$$typeof:o,render:X}},Mr.isValidElement=z,Mr.lazy=function(X){return{$$typeof:c,_payload:{_status:-1,_result:X},_init:Z}},Mr.memo=function(X,re){return{$$typeof:u,type:X,compare:re===void 0?null:re}},Mr.startTransition=function(X){var re=Q.transition;Q.transition={};try{X()}finally{Q.transition=re}},Mr.unstable_act=te,Mr.useCallback=function(X,re){return K.current.useCallback(X,re)},Mr.useContext=function(X){return K.current.useContext(X)},Mr.useDebugValue=function(){},Mr.useDeferredValue=function(X){return K.current.useDeferredValue(X)},Mr.useEffect=function(X,re){return K.current.useEffect(X,re)},Mr.useId=function(){return K.current.useId()},Mr.useImperativeHandle=function(X,re,he){return K.current.useImperativeHandle(X,re,he)},Mr.useInsertionEffect=function(X,re){return K.current.useInsertionEffect(X,re)},Mr.useLayoutEffect=function(X,re){return K.current.useLayoutEffect(X,re)},Mr.useMemo=function(X,re){return K.current.useMemo(X,re)},Mr.useReducer=function(X,re,he){return K.current.useReducer(X,re,he)},Mr.useRef=function(X){return K.current.useRef(X)},Mr.useState=function(X){return K.current.useState(X)},Mr.useSyncExternalStore=function(X,re,he){return K.current.useSyncExternalStore(X,re,he)},Mr.useTransition=function(){return K.current.useTransition()},Mr.version="18.3.1",Mr}var oE;function sm(){return oE||(oE=1,Ob.exports=VD()),Ob.exports}var lE;function HD(){if(lE)return Fm;lE=1;var t=sm(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function s(o,l,u){var c,h={},p=null,g=null;u!==void 0&&(p=""+u),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(g=l.ref);for(c in l)n.call(l,c)&&!a.hasOwnProperty(c)&&(h[c]=l[c]);if(o&&o.defaultProps)for(c in l=o.defaultProps,l)h[c]===void 0&&(h[c]=l[c]);return{$$typeof:e,type:o,key:p,ref:g,props:h,_owner:i.current}}return Fm.Fragment=r,Fm.jsx=s,Fm.jsxs=s,Fm}var uE;function WD(){return uE||(uE=1,Rb.exports=HD()),Rb.exports}var m=WD(),ie=sm();const ir=Tf(ie),qD=GD({__proto__:null,default:ir},[ie]);var K0={},Db={exports:{}},Ws={},Ib={exports:{}},jb={};var cE;function $D(){return cE||(cE=1,(function(t){function e(Q,ne){var te=Q.length;Q.push(ne);e:for(;0<te;){var X=te-1>>>1,re=Q[X];if(0<i(re,ne))Q[X]=ne,Q[te]=re,te=X;else break e}}function r(Q){return Q.length===0?null:Q[0]}function n(Q){if(Q.length===0)return null;var ne=Q[0],te=Q.pop();if(te!==ne){Q[0]=te;e:for(var X=0,re=Q.length,he=re>>>1;X<he;){var oe=2*(X+1)-1,se=Q[oe],fe=oe+1,ae=Q[fe];if(0>i(se,te))fe<re&&0>i(ae,se)?(Q[X]=ae,Q[fe]=te,X=fe):(Q[X]=se,Q[oe]=te,X=oe);else if(fe<re&&0>i(ae,te))Q[X]=ae,Q[fe]=te,X=fe;else break e}}return ne}function i(Q,ne){var te=Q.sortIndex-ne.sortIndex;return te!==0?te:Q.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,o=s.now();t.unstable_now=function(){return s.now()-o}}var l=[],u=[],c=1,h=null,p=3,g=!1,y=!1,S=!1,w=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(Q){for(var ne=r(u);ne!==null;){if(ne.callback===null)n(u);else if(ne.startTime<=Q)n(u),ne.sortIndex=ne.expirationTime,e(l,ne);else break;ne=r(u)}}function N(Q){if(S=!1,T(Q),!y)if(r(l)!==null)y=!0,Z(R);else{var ne=r(u);ne!==null&&K(N,ne.startTime-Q)}}function R(Q,ne){y=!1,S&&(S=!1,C(O),O=-1),g=!0;var te=p;try{for(T(ne),h=r(l);h!==null&&(!(h.expirationTime>ne)||Q&&!V());){var X=h.callback;if(typeof X=="function"){h.callback=null,p=h.priorityLevel;var re=X(h.expirationTime<=ne);ne=t.unstable_now(),typeof re=="function"?h.callback=re:h===r(l)&&n(l),T(ne)}else n(l);h=r(l)}if(h!==null)var he=!0;else{var oe=r(u);oe!==null&&K(N,oe.startTime-ne),he=!1}return he}finally{h=null,p=te,g=!1}}var I=!1,j=null,O=-1,F=5,z=-1;function V(){return!(t.unstable_now()-z<F)}function q(){if(j!==null){var Q=t.unstable_now();z=Q;var ne=!0;try{ne=j(!0,Q)}finally{ne?D():(I=!1,j=null)}}else I=!1}var D;if(typeof _=="function")D=function(){_(q)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,G=U.port2;U.port1.onmessage=q,D=function(){G.postMessage(null)}}else D=function(){w(q,0)};function Z(Q){j=Q,I||(I=!0,D())}function K(Q,ne){O=w(function(){Q(t.unstable_now())},ne)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Q){Q.callback=null},t.unstable_continueExecution=function(){y||g||(y=!0,Z(R))},t.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<Q?Math.floor(1e3/Q):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(Q){switch(p){case 1:case 2:case 3:var ne=3;break;default:ne=p}var te=p;p=ne;try{return Q()}finally{p=te}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Q,ne){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var te=p;p=Q;try{return ne()}finally{p=te}},t.unstable_scheduleCallback=function(Q,ne,te){var X=t.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?X+te:X):te=X,Q){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=te+re,Q={id:c++,callback:ne,priorityLevel:Q,startTime:te,expirationTime:re,sortIndex:-1},te>X?(Q.sortIndex=te,e(u,Q),r(l)===null&&Q===r(u)&&(S?(C(O),O=-1):S=!0,K(N,te-X))):(Q.sortIndex=re,e(l,Q),y||g||(y=!0,Z(R))),Q},t.unstable_shouldYield=V,t.unstable_wrapCallback=function(Q){var ne=p;return function(){var te=p;p=ne;try{return Q.apply(this,arguments)}finally{p=te}}}})(jb)),jb}var dE;function Vk(){return dE||(dE=1,Ib.exports=$D()),Ib.exports}var hE;function KD(){if(hE)return Ws;hE=1;var t=sm(),e=Vk();function r(d){for(var v="https://reactjs.org/docs/error-decoder.html?invariant="+d,E=1;E<arguments.length;E++)v+="&args[]="+encodeURIComponent(arguments[E]);return"Minified React error #"+d+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,i={};function a(d,v){s(d,v),s(d+"Capture",v)}function s(d,v){for(i[d]=v,d=0;d<v.length;d++)n.add(v[d])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,c={},h={};function p(d){return l.call(h,d)?!0:l.call(c,d)?!1:u.test(d)?h[d]=!0:(c[d]=!0,!1)}function g(d,v,E,A){if(E!==null&&E.type===0)return!1;switch(typeof v){case"function":case"symbol":return!0;case"boolean":return A?!1:E!==null?!E.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function y(d,v,E,A){if(v===null||typeof v>"u"||g(d,v,E,A))return!0;if(A)return!1;if(E!==null)switch(E.type){case 3:return!v;case 4:return v===!1;case 5:return isNaN(v);case 6:return isNaN(v)||1>v}return!1}function S(d,v,E,A,W,Y,le){this.acceptsBooleans=v===2||v===3||v===4,this.attributeName=A,this.attributeNamespace=W,this.mustUseProperty=E,this.propertyName=d,this.type=v,this.sanitizeURL=Y,this.removeEmptyString=le}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){w[d]=new S(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var v=d[0];w[v]=new S(v,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){w[d]=new S(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){w[d]=new S(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){w[d]=new S(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){w[d]=new S(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){w[d]=new S(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){w[d]=new S(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){w[d]=new S(d,5,!1,d.toLowerCase(),null,!1,!1)});var C=/[\-:]([a-z])/g;function _(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var v=d.replace(C,_);w[v]=new S(v,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var v=d.replace(C,_);w[v]=new S(v,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var v=d.replace(C,_);w[v]=new S(v,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){w[d]=new S(d,1,!1,d.toLowerCase(),null,!1,!1)}),w.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){w[d]=new S(d,1,!1,d.toLowerCase(),null,!0,!0)});function T(d,v,E,A){var W=w.hasOwnProperty(v)?w[v]:null;(W!==null?W.type!==0:A||!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(y(v,E,W,A)&&(E=null),A||W===null?p(v)&&(E===null?d.removeAttribute(v):d.setAttribute(v,""+E)):W.mustUseProperty?d[W.propertyName]=E===null?W.type===3?!1:"":E:(v=W.attributeName,A=W.attributeNamespace,E===null?d.removeAttribute(v):(W=W.type,E=W===3||W===4&&E===!0?"":""+E,A?d.setAttributeNS(A,v,E):d.setAttribute(v,E))))}var N=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,R=Symbol.for("react.element"),I=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),O=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),V=Symbol.for("react.context"),q=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),G=Symbol.for("react.memo"),Z=Symbol.for("react.lazy"),K=Symbol.for("react.offscreen"),Q=Symbol.iterator;function ne(d){return d===null||typeof d!="object"?null:(d=Q&&d[Q]||d["@@iterator"],typeof d=="function"?d:null)}var te=Object.assign,X;function re(d){if(X===void 0)try{throw Error()}catch(E){var v=E.stack.trim().match(/\n( *(at )?)/);X=v&&v[1]||""}return`
`+X+d}var he=!1;function oe(d,v){if(!d||he)return"";he=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(v)if(v=function(){throw Error()},Object.defineProperty(v.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(v,[])}catch(Be){var A=Be}Reflect.construct(d,[],v)}else{try{v.call()}catch(Be){A=Be}d.call(v.prototype)}else{try{throw Error()}catch(Be){A=Be}d()}}catch(Be){if(Be&&A&&typeof Be.stack=="string"){for(var W=Be.stack.split(`
`),Y=A.stack.split(`
`),le=W.length-1,be=Y.length-1;1<=le&&0<=be&&W[le]!==Y[be];)be--;for(;1<=le&&0<=be;le--,be--)if(W[le]!==Y[be]){if(le!==1||be!==1)do if(le--,be--,0>be||W[le]!==Y[be]){var _e=`
`+W[le].replace(" at new "," at ");return d.displayName&&_e.includes("<anonymous>")&&(_e=_e.replace("<anonymous>",d.displayName)),_e}while(1<=le&&0<=be);break}}}finally{he=!1,Error.prepareStackTrace=E}return(d=d?d.displayName||d.name:"")?re(d):""}function se(d){switch(d.tag){case 5:return re(d.type);case 16:return re("Lazy");case 13:return re("Suspense");case 19:return re("SuspenseList");case 0:case 2:case 15:return d=oe(d.type,!1),d;case 11:return d=oe(d.type.render,!1),d;case 1:return d=oe(d.type,!0),d;default:return""}}function fe(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case j:return"Fragment";case I:return"Portal";case F:return"Profiler";case O:return"StrictMode";case D:return"Suspense";case U:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case V:return(d.displayName||"Context")+".Consumer";case z:return(d._context.displayName||"Context")+".Provider";case q:var v=d.render;return d=d.displayName,d||(d=v.displayName||v.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case G:return v=d.displayName||null,v!==null?v:fe(d.type)||"Memo";case Z:v=d._payload,d=d._init;try{return fe(d(v))}catch{}}return null}function ae(d){var v=d.type;switch(d.tag){case 24:return"Cache";case 9:return(v.displayName||"Context")+".Consumer";case 10:return(v._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=v.render,d=d.displayName||d.name||"",v.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return v;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fe(v);case 8:return v===O?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v}return null}function pe(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function ye(d){var v=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(v==="checkbox"||v==="radio")}function ve(d){var v=ye(d)?"checked":"value",E=Object.getOwnPropertyDescriptor(d.constructor.prototype,v),A=""+d[v];if(!d.hasOwnProperty(v)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var W=E.get,Y=E.set;return Object.defineProperty(d,v,{configurable:!0,get:function(){return W.call(this)},set:function(le){A=""+le,Y.call(this,le)}}),Object.defineProperty(d,v,{enumerable:E.enumerable}),{getValue:function(){return A},setValue:function(le){A=""+le},stopTracking:function(){d._valueTracker=null,delete d[v]}}}}function ue(d){d._valueTracker||(d._valueTracker=ve(d))}function xe(d){if(!d)return!1;var v=d._valueTracker;if(!v)return!0;var E=v.getValue(),A="";return d&&(A=ye(d)?d.checked?"true":"false":d.value),d=A,d!==E?(v.setValue(d),!0):!1}function Se(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function Oe(d,v){var E=v.checked;return te({},v,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:E??d._wrapperState.initialChecked})}function Ae(d,v){var E=v.defaultValue==null?"":v.defaultValue,A=v.checked!=null?v.checked:v.defaultChecked;E=pe(v.value!=null?v.value:E),d._wrapperState={initialChecked:A,initialValue:E,controlled:v.type==="checkbox"||v.type==="radio"?v.checked!=null:v.value!=null}}function tt(d,v){v=v.checked,v!=null&&T(d,"checked",v,!1)}function rt(d,v){tt(d,v);var E=pe(v.value),A=v.type;if(E!=null)A==="number"?(E===0&&d.value===""||d.value!=E)&&(d.value=""+E):d.value!==""+E&&(d.value=""+E);else if(A==="submit"||A==="reset"){d.removeAttribute("value");return}v.hasOwnProperty("value")?_t(d,v.type,E):v.hasOwnProperty("defaultValue")&&_t(d,v.type,pe(v.defaultValue)),v.checked==null&&v.defaultChecked!=null&&(d.defaultChecked=!!v.defaultChecked)}function dt(d,v,E){if(v.hasOwnProperty("value")||v.hasOwnProperty("defaultValue")){var A=v.type;if(!(A!=="submit"&&A!=="reset"||v.value!==void 0&&v.value!==null))return;v=""+d._wrapperState.initialValue,E||v===d.value||(d.value=v),d.defaultValue=v}E=d.name,E!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,E!==""&&(d.name=E)}function _t(d,v,E){(v!=="number"||Se(d.ownerDocument)!==d)&&(E==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+E&&(d.defaultValue=""+E))}var Xe=Array.isArray;function ht(d,v,E,A){if(d=d.options,v){v={};for(var W=0;W<E.length;W++)v["$"+E[W]]=!0;for(E=0;E<d.length;E++)W=v.hasOwnProperty("$"+d[E].value),d[E].selected!==W&&(d[E].selected=W),W&&A&&(d[E].defaultSelected=!0)}else{for(E=""+pe(E),v=null,W=0;W<d.length;W++){if(d[W].value===E){d[W].selected=!0,A&&(d[W].defaultSelected=!0);return}v!==null||d[W].disabled||(v=d[W])}v!==null&&(v.selected=!0)}}function ct(d,v){if(v.dangerouslySetInnerHTML!=null)throw Error(r(91));return te({},v,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function vt(d,v){var E=v.value;if(E==null){if(E=v.children,v=v.defaultValue,E!=null){if(v!=null)throw Error(r(92));if(Xe(E)){if(1<E.length)throw Error(r(93));E=E[0]}v=E}v==null&&(v=""),E=v}d._wrapperState={initialValue:pe(E)}}function lt(d,v){var E=pe(v.value),A=pe(v.defaultValue);E!=null&&(E=""+E,E!==d.value&&(d.value=E),v.defaultValue==null&&d.defaultValue!==E&&(d.defaultValue=E)),A!=null&&(d.defaultValue=""+A)}function Lt(d){var v=d.textContent;v===d._wrapperState.initialValue&&v!==""&&v!==null&&(d.value=v)}function jt(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ne(d,v){return d==null||d==="http://www.w3.org/1999/xhtml"?jt(v):d==="http://www.w3.org/2000/svg"&&v==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var qe,bt=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(v,E,A,W){MSApp.execUnsafeLocalFunction(function(){return d(v,E,A,W)})}:d})(function(d,v){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=v;else{for(qe=qe||document.createElement("div"),qe.innerHTML="<svg>"+v.valueOf().toString()+"</svg>",v=qe.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;v.firstChild;)d.appendChild(v.firstChild)}});function at(d,v){if(v){var E=d.firstChild;if(E&&E===d.lastChild&&E.nodeType===3){E.nodeValue=v;return}}d.textContent=v}var ut={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Fe=["Webkit","ms","Moz","O"];Object.keys(ut).forEach(function(d){Fe.forEach(function(v){v=v+d.charAt(0).toUpperCase()+d.substring(1),ut[v]=ut[d]})});function de(d,v,E){return v==null||typeof v=="boolean"||v===""?"":E||typeof v!="number"||v===0||ut.hasOwnProperty(d)&&ut[d]?(""+v).trim():v+"px"}function ge(d,v){d=d.style;for(var E in v)if(v.hasOwnProperty(E)){var A=E.indexOf("--")===0,W=de(E,v[E],A);E==="float"&&(E="cssFloat"),A?d.setProperty(E,W):d[E]=W}}var ke=te({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ee(d,v){if(v){if(ke[d]&&(v.children!=null||v.dangerouslySetInnerHTML!=null))throw Error(r(137,d));if(v.dangerouslySetInnerHTML!=null){if(v.children!=null)throw Error(r(60));if(typeof v.dangerouslySetInnerHTML!="object"||!("__html"in v.dangerouslySetInnerHTML))throw Error(r(61))}if(v.style!=null&&typeof v.style!="object")throw Error(r(62))}}function Le(d,v){if(d.indexOf("-")===-1)return typeof v.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qe=null;function Ve(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var xt=null,ze=null,$e=null;function wt(d){if(d=wl(d)){if(typeof xt!="function")throw Error(r(280));var v=d.stateNode;v&&(v=si(v),xt(d.stateNode,d.type,v))}}function Pt(d){ze?$e?$e.push(d):$e=[d]:ze=d}function Ct(){if(ze){var d=ze,v=$e;if($e=ze=null,wt(d),v)for(d=0;d<v.length;d++)wt(v[d])}}function Vt(d,v){return d(v)}function Yt(){}var Lr=!1;function kr(d,v,E){if(Lr)return d(v,E);Lr=!0;try{return Vt(d,v,E)}finally{Lr=!1,(ze!==null||$e!==null)&&(Yt(),Ct())}}function Qr(d,v){var E=d.stateNode;if(E===null)return null;var A=si(E);if(A===null)return null;E=A[v];e:switch(v){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(d=d.type,A=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!A;break e;default:d=!1}if(d)return null;if(E&&typeof E!="function")throw Error(r(231,v,typeof E));return E}var Jr=!1;if(o)try{var _r={};Object.defineProperty(_r,"passive",{get:function(){Jr=!0}}),window.addEventListener("test",_r,_r),window.removeEventListener("test",_r,_r)}catch{Jr=!1}function hn(d,v,E,A,W,Y,le,be,_e){var Be=Array.prototype.slice.call(arguments,3);try{v.apply(E,Be)}catch(st){this.onError(st)}}var vr=!1,Et=null,Br=!1,Xn=null,Zi={onError:function(d){vr=!0,Et=d}};function ds(d,v,E,A,W,Y,le,be,_e){vr=!1,Et=null,hn.apply(Zi,arguments)}function As(d,v,E,A,W,Y,le,be,_e){if(ds.apply(this,arguments),vr){if(vr){var Be=Et;vr=!1,Et=null}else throw Error(r(198));Br||(Br=!0,Xn=Be)}}function ni(d){var v=d,E=d;if(d.alternate)for(;v.return;)v=v.return;else{d=v;do v=d,(v.flags&4098)!==0&&(E=v.return),d=v.return;while(d)}return v.tag===3?E:null}function sn(d){if(d.tag===13){var v=d.memoizedState;if(v===null&&(d=d.alternate,d!==null&&(v=d.memoizedState)),v!==null)return v.dehydrated}return null}function kn(d){if(ni(d)!==d)throw Error(r(188))}function In(d){var v=d.alternate;if(!v){if(v=ni(d),v===null)throw Error(r(188));return v!==d?null:d}for(var E=d,A=v;;){var W=E.return;if(W===null)break;var Y=W.alternate;if(Y===null){if(A=W.return,A!==null){E=A;continue}break}if(W.child===Y.child){for(Y=W.child;Y;){if(Y===E)return kn(W),d;if(Y===A)return kn(W),v;Y=Y.sibling}throw Error(r(188))}if(E.return!==A.return)E=W,A=Y;else{for(var le=!1,be=W.child;be;){if(be===E){le=!0,E=W,A=Y;break}if(be===A){le=!0,A=W,E=Y;break}be=be.sibling}if(!le){for(be=Y.child;be;){if(be===E){le=!0,E=Y,A=W;break}if(be===A){le=!0,A=Y,E=W;break}be=be.sibling}if(!le)throw Error(r(189))}}if(E.alternate!==A)throw Error(r(190))}if(E.tag!==3)throw Error(r(188));return E.stateNode.current===E?d:v}function Ls(d){return d=In(d),d!==null?gi(d):null}function gi(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var v=gi(d);if(v!==null)return v;d=d.sibling}return null}var ko=e.unstable_scheduleCallback,qa=e.unstable_cancelCallback,Ru=e.unstable_shouldYield,_o=e.unstable_requestPaint,on=e.unstable_now,Co=e.unstable_getCurrentPriorityLevel,hs=e.unstable_ImmediatePriority,ro=e.unstable_UserBlockingPriority,Yi=e.unstable_NormalPriority,no=e.unstable_LowPriority,Ge=e.unstable_IdlePriority,Ye=null,nt=null;function pt(d){if(nt&&typeof nt.onCommitFiberRoot=="function")try{nt.onCommitFiberRoot(Ye,d,void 0,(d.current.flags&128)===128)}catch{}}var Ze=Math.clz32?Math.clz32:Pr,Dt=Math.log,Nr=Math.LN2;function Pr(d){return d>>>=0,d===0?32:31-(Dt(d)/Nr|0)|0}var Fr=64,vi=4194304;function zt(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function Ir(d,v){var E=d.pendingLanes;if(E===0)return 0;var A=0,W=d.suspendedLanes,Y=d.pingedLanes,le=E&268435455;if(le!==0){var be=le&~W;be!==0?A=zt(be):(Y&=le,Y!==0&&(A=zt(Y)))}else le=E&~W,le!==0?A=zt(le):Y!==0&&(A=zt(Y));if(A===0)return 0;if(v!==0&&v!==A&&(v&W)===0&&(W=A&-A,Y=v&-v,W>=Y||W===16&&(Y&4194240)!==0))return v;if((A&4)!==0&&(A|=E&16),v=d.entangledLanes,v!==0)for(d=d.entanglements,v&=A;0<v;)E=31-Ze(v),W=1<<E,A|=d[E],v&=~W;return A}function al(d,v){switch(d){case 1:case 2:case 4:return v+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Jt(d,v){for(var E=d.suspendedLanes,A=d.pingedLanes,W=d.expirationTimes,Y=d.pendingLanes;0<Y;){var le=31-Ze(Y),be=1<<le,_e=W[le];_e===-1?((be&E)===0||(be&A)!==0)&&(W[le]=al(be,v)):_e<=v&&(d.expiredLanes|=be),Y&=~be}}function tr(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function Rr(){var d=Fr;return Fr<<=1,(Fr&4194240)===0&&(Fr=64),d}function er(d){for(var v=[],E=0;31>E;E++)v.push(d);return v}function en(d,v,E){d.pendingLanes|=v,v!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,v=31-Ze(v),d[v]=E}function yn(d,v){var E=d.pendingLanes&~v;d.pendingLanes=v,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=v,d.mutableReadLanes&=v,d.entangledLanes&=v,v=d.entanglements;var A=d.eventTimes;for(d=d.expirationTimes;0<E;){var W=31-Ze(E),Y=1<<W;v[W]=0,A[W]=-1,d[W]=-1,E&=~Y}}function io(d,v){var E=d.entangledLanes|=v;for(d=d.entanglements;E;){var A=31-Ze(E),W=1<<A;W&v|d[A]&v&&(d[A]|=v),E&=~W}}var xr=0;function ao(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var Eo,Rs,Cc,Ec,sl,Gl=!1,To=[],Fi=null,so=null,$a=null,br=new Map,sr=new Map,Qn=[],$r="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gh(d,v){switch(d){case"focusin":case"focusout":Fi=null;break;case"dragenter":case"dragleave":so=null;break;case"mouseover":case"mouseout":$a=null;break;case"pointerover":case"pointerout":br.delete(v.pointerId);break;case"gotpointercapture":case"lostpointercapture":sr.delete(v.pointerId)}}function ol(d,v,E,A,W,Y){return d===null||d.nativeEvent!==Y?(d={blockedOn:v,domEventName:E,eventSystemFlags:A,nativeEvent:Y,targetContainers:[W]},v!==null&&(v=wl(v),v!==null&&Rs(v)),d):(d.eventSystemFlags|=A,v=d.targetContainers,W!==null&&v.indexOf(W)===-1&&v.push(W),d)}function jn(d,v,E,A,W){switch(v){case"focusin":return Fi=ol(Fi,d,v,E,A,W),!0;case"dragenter":return so=ol(so,d,v,E,A,W),!0;case"mouseover":return $a=ol($a,d,v,E,A,W),!0;case"pointerover":var Y=W.pointerId;return br.set(Y,ol(br.get(Y)||null,d,v,E,A,W)),!0;case"gotpointercapture":return Y=W.pointerId,sr.set(Y,ol(sr.get(Y)||null,d,v,E,A,W)),!0}return!1}function Vl(d){var v=Do(d.target);if(v!==null){var E=ni(v);if(E!==null){if(v=E.tag,v===13){if(v=sn(E),v!==null){d.blockedOn=v,sl(d.priority,function(){Cc(E)});return}}else if(v===3&&E.stateNode.current.memoizedState.isDehydrated){d.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Os(d){if(d.blockedOn!==null)return!1;for(var v=d.targetContainers;0<v.length;){var E=Iu(d.domEventName,d.eventSystemFlags,v[0],d.nativeEvent);if(E===null){E=d.nativeEvent;var A=new E.constructor(E.type,E);Qe=A,E.target.dispatchEvent(A),Qe=null}else return v=wl(E),v!==null&&Rs(v),d.blockedOn=E,!1;v.shift()}return!0}function Hl(d,v,E){Os(d)&&E.delete(v)}function Ou(){Gl=!1,Fi!==null&&Os(Fi)&&(Fi=null),so!==null&&Os(so)&&(so=null),$a!==null&&Os($a)&&($a=null),br.forEach(Hl),sr.forEach(Hl)}function fn(d,v){d.blockedOn===v&&(d.blockedOn=null,Gl||(Gl=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Ou)))}function Fn(d){function v(W){return fn(W,d)}if(0<To.length){fn(To[0],d);for(var E=1;E<To.length;E++){var A=To[E];A.blockedOn===d&&(A.blockedOn=null)}}for(Fi!==null&&fn(Fi,d),so!==null&&fn(so,d),$a!==null&&fn($a,d),br.forEach(v),sr.forEach(v),E=0;E<Qn.length;E++)A=Qn[E],A.blockedOn===d&&(A.blockedOn=null);for(;0<Qn.length&&(E=Qn[0],E.blockedOn===null);)Vl(E),E.blockedOn===null&&Qn.shift()}var ll=N.ReactCurrentBatchConfig,Du=!0;function fs(d,v,E,A){var W=xr,Y=ll.transition;ll.transition=null;try{xr=1,No(d,v,E,A)}finally{xr=W,ll.transition=Y}}function Ds(d,v,E,A){var W=xr,Y=ll.transition;ll.transition=null;try{xr=4,No(d,v,E,A)}finally{xr=W,ll.transition=Y}}function No(d,v,E,A){if(Du){var W=Iu(d,v,E,A);if(W===null)f(d,v,A,Wl,E),gh(d,A);else if(jn(W,d,v,E,A))A.stopPropagation();else if(gh(d,A),v&4&&-1<$r.indexOf(d)){for(;W!==null;){var Y=wl(W);if(Y!==null&&Eo(Y),Y=Iu(d,v,E,A),Y===null&&f(d,v,A,Wl,E),Y===W)break;W=Y}W!==null&&A.stopPropagation()}else f(d,v,A,null,E)}}var Wl=null;function Iu(d,v,E,A){if(Wl=null,d=Ve(A),d=Do(d),d!==null)if(v=ni(d),v===null)d=null;else if(E=v.tag,E===13){if(d=sn(v),d!==null)return d;d=null}else if(E===3){if(v.stateNode.current.memoizedState.isDehydrated)return v.tag===3?v.stateNode.containerInfo:null;d=null}else v!==d&&(d=null);return Wl=d,null}function Cr(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Co()){case hs:return 1;case ro:return 4;case Yi:case no:return 16;case Ge:return 536870912;default:return 16}default:return 16}}var yi=null,ii=null,ba=null;function ql(){if(ba)return ba;var d,v=ii,E=v.length,A,W="value"in yi?yi.value:yi.textContent,Y=W.length;for(d=0;d<E&&v[d]===W[d];d++);var le=E-d;for(A=1;A<=le&&v[E-A]===W[Y-A];A++);return ba=W.slice(d,1<A?1-A:void 0)}function ul(d){var v=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&v===13&&(d=13)):d=v,d===10&&(d=13),32<=d||d===13?d:0}function xi(){return!0}function wa(){return!1}function Bn(d){function v(E,A,W,Y,le){this._reactName=E,this._targetInst=W,this.type=A,this.nativeEvent=Y,this.target=le,this.currentTarget=null;for(var be in d)d.hasOwnProperty(be)&&(E=d[be],this[be]=E?E(Y):Y[be]);return this.isDefaultPrevented=(Y.defaultPrevented!=null?Y.defaultPrevented:Y.returnValue===!1)?xi:wa,this.isPropagationStopped=wa,this}return te(v.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=xi)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=xi)},persist:function(){},isPersistent:xi}),v}var Xi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ps=Bn(Xi),Sa=te({},Xi,{view:0,detail:0}),Of=Bn(Sa),Qi,ju,ai,_n=te({},Sa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ms,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==ai&&(ai&&d.type==="mousemove"?(Qi=d.screenX-ai.screenX,ju=d.screenY-ai.screenY):ju=Qi=0,ai=d),Qi)},movementY:function(d){return"movementY"in d?d.movementY:ju}}),tn=Bn(_n),$l=te({},_n,{dataTransfer:0}),ka=Bn($l),Df=te({},Sa,{relatedTarget:0}),Fu=Bn(Df),Tc=te({},Xi,{animationName:0,elapsedTime:0,pseudoElement:0}),vh=Bn(Tc),If=te({},Xi,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),Kl=Bn(If),jf=te({},Xi,{data:0}),Po=Bn(jf),Nc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Pc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Is={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ym(d){var v=this.nativeEvent;return v.getModifierState?v.getModifierState(d):(d=Is[d])?!!v[d]:!1}function ms(){return ym}var Bi=te({},Sa,{key:function(d){if(d.key){var v=Nc[d.key]||d.key;if(v!=="Unidentified")return v}return d.type==="keypress"?(d=ul(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Pc[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ms,charCode:function(d){return d.type==="keypress"?ul(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?ul(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),yh=Bn(Bi),xh=te({},_n,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cl=Bn(xh),Mc=te({},Sa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ms}),Zl=Bn(Mc),Ac=te({},Xi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yl=Bn(Ac),Lc=te({},_n,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),bh=Bn(Lc),Ka=[9,13,27,32],js=o&&"CompositionEvent"in window,dl=null;o&&"documentMode"in document&&(dl=document.documentMode);var Ji=o&&"TextEvent"in window&&!dl,_a=o&&(!js||dl&&8<dl&&11>=dl),Ca=" ",Rc=!1;function hl(d,v){switch(d){case"keyup":return Ka.indexOf(v.keyCode)!==-1;case"keydown":return v.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Za(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var Pi=!1;function wh(d,v){switch(d){case"compositionend":return Za(v);case"keypress":return v.which!==32?null:(Rc=!0,Ca);case"textInput":return d=v.data,d===Ca&&Rc?null:d;default:return null}}function oo(d,v){if(Pi)return d==="compositionend"||!js&&hl(d,v)?(d=ql(),ba=ii=yi=null,Pi=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(v.ctrlKey||v.altKey||v.metaKey)||v.ctrlKey&&v.altKey){if(v.char&&1<v.char.length)return v.char;if(v.which)return String.fromCharCode(v.which)}return null;case"compositionend":return _a&&v.locale!=="ko"?null:v.data;default:return null}}var Ya={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function lo(d){var v=d&&d.nodeName&&d.nodeName.toLowerCase();return v==="input"?!!Ya[d.type]:v==="textarea"}function fl(d,v,E,A){Pt(A),v=P(v,"onChange"),0<v.length&&(E=new ps("onChange","change",null,E,A),d.push({event:E,listeners:v}))}var Xl=null,Mi=null;function Ff(d){Bc(d,0)}function Ea(d){var v=Vn(d);if(xe(v))return d}function Xa(d,v){if(d==="change")return v}var ea=!1;if(o){var gs;if(o){var Ta="oninput"in document;if(!Ta){var Ql=document.createElement("div");Ql.setAttribute("oninput","return;"),Ta=typeof Ql.oninput=="function"}gs=Ta}else gs=!1;ea=gs&&(!document.documentMode||9<document.documentMode)}function Fs(){Xl&&(Xl.detachEvent("onpropertychange",Bu),Mi=Xl=null)}function Bu(d){if(d.propertyName==="value"&&Ea(Mi)){var v=[];fl(v,Mi,d,Ve(d)),kr(Ff,v)}}function Jl(d,v,E){d==="focusin"?(Fs(),Xl=v,Mi=E,Xl.attachEvent("onpropertychange",Bu)):d==="focusout"&&Fs()}function Hr(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Ea(Mi)}function pl(d,v){if(d==="click")return Ea(v)}function zu(d,v){if(d==="input"||d==="change")return Ea(v)}function Oc(d,v){return d===v&&(d!==0||1/d===1/v)||d!==d&&v!==v}var ta=typeof Object.is=="function"?Object.is:Oc;function Bs(d,v){if(ta(d,v))return!0;if(typeof d!="object"||d===null||typeof v!="object"||v===null)return!1;var E=Object.keys(d),A=Object.keys(v);if(E.length!==A.length)return!1;for(A=0;A<E.length;A++){var W=E[A];if(!l.call(v,W)||!ta(d[W],v[W]))return!1}return!0}function Mo(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function ln(d,v){var E=Mo(d);d=0;for(var A;E;){if(E.nodeType===3){if(A=d+E.textContent.length,d<=v&&A>=v)return{node:E,offset:v-d};d=A}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=Mo(E)}}function zn(d,v){return d&&v?d===v?!0:d&&d.nodeType===3?!1:v&&v.nodeType===3?zn(d,v.parentNode):"contains"in d?d.contains(v):d.compareDocumentPosition?!!(d.compareDocumentPosition(v)&16):!1:!1}function Un(){for(var d=window,v=Se();v instanceof d.HTMLIFrameElement;){try{var E=typeof v.contentWindow.location.href=="string"}catch{E=!1}if(E)d=v.contentWindow;else break;v=Se(d.document)}return v}function eu(d){var v=d&&d.nodeName&&d.nodeName.toLowerCase();return v&&(v==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||v==="textarea"||d.contentEditable==="true")}function ra(d){var v=Un(),E=d.focusedElem,A=d.selectionRange;if(v!==E&&E&&E.ownerDocument&&zn(E.ownerDocument.documentElement,E)){if(A!==null&&eu(E)){if(v=A.start,d=A.end,d===void 0&&(d=v),"selectionStart"in E)E.selectionStart=v,E.selectionEnd=Math.min(d,E.value.length);else if(d=(v=E.ownerDocument||document)&&v.defaultView||window,d.getSelection){d=d.getSelection();var W=E.textContent.length,Y=Math.min(A.start,W);A=A.end===void 0?Y:Math.min(A.end,W),!d.extend&&Y>A&&(W=A,A=Y,Y=W),W=ln(E,Y);var le=ln(E,A);W&&le&&(d.rangeCount!==1||d.anchorNode!==W.node||d.anchorOffset!==W.offset||d.focusNode!==le.node||d.focusOffset!==le.offset)&&(v=v.createRange(),v.setStart(W.node,W.offset),d.removeAllRanges(),Y>A?(d.addRange(v),d.extend(le.node,le.offset)):(v.setEnd(le.node,le.offset),d.addRange(v)))}}for(v=[],d=E;d=d.parentNode;)d.nodeType===1&&v.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<v.length;E++)d=v[E],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var Ao=o&&"documentMode"in document&&11>=document.documentMode,tu=null,An=null,ml=null,ru=!1;function Dc(d,v,E){var A=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;ru||tu==null||tu!==Se(A)||(A=tu,"selectionStart"in A&&eu(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),ml&&Bs(ml,A)||(ml=A,A=P(An,"onSelect"),0<A.length&&(v=new ps("onSelect","select",null,v,E),d.push({event:v,listeners:A}),v.target=tu)))}function bi(d,v){var E={};return E[d.toLowerCase()]=v.toLowerCase(),E["Webkit"+d]="webkit"+v,E["Moz"+d]="moz"+v,E}var wi={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},Qa={},Uu={};o&&(Uu=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);function gl(d){if(Qa[d])return Qa[d];if(!wi[d])return d;var v=wi[d],E;for(E in v)if(v.hasOwnProperty(E)&&E in Uu)return Qa[d]=v[E];return d}var Sh=gl("animationend"),vs=gl("animationiteration"),Ic=gl("animationstart"),jc=gl("transitionend"),vl=new Map,kh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ja(d,v){vl.set(d,v),a(v,[d])}for(var Lo=0;Lo<kh.length;Lo++){var Ro=kh[Lo],_h=Ro.toLowerCase(),Fc=Ro[0].toUpperCase()+Ro.slice(1);Ja(_h,"on"+Fc)}Ja(Sh,"onAnimationEnd"),Ja(vs,"onAnimationIteration"),Ja(Ic,"onAnimationStart"),Ja("dblclick","onDoubleClick"),Ja("focusin","onFocus"),Ja("focusout","onBlur"),Ja(jc,"onTransitionEnd"),s("onMouseEnter",["mouseout","mouseover"]),s("onMouseLeave",["mouseout","mouseover"]),s("onPointerEnter",["pointerout","pointerover"]),s("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var uo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ch=new Set("cancel close invalid load scroll toggle".split(" ").concat(uo));function Gu(d,v,E){var A=d.type||"unknown-event";d.currentTarget=E,As(A,v,void 0,d),d.currentTarget=null}function Bc(d,v){v=(v&4)!==0;for(var E=0;E<d.length;E++){var A=d[E],W=A.event;A=A.listeners;e:{var Y=void 0;if(v)for(var le=A.length-1;0<=le;le--){var be=A[le],_e=be.instance,Be=be.currentTarget;if(be=be.listener,_e!==Y&&W.isPropagationStopped())break e;Gu(W,be,Be),Y=_e}else for(le=0;le<A.length;le++){if(be=A[le],_e=be.instance,Be=be.currentTarget,be=be.listener,_e!==Y&&W.isPropagationStopped())break e;Gu(W,be,Be),Y=_e}}}if(Br)throw d=Xn,Br=!1,Xn=null,d}function Kr(d,v){var E=v[bl];E===void 0&&(E=v[bl]=new Set);var A=d+"__bubble";E.has(A)||(Eh(v,d,2,!1),E.add(A))}function zc(d,v,E){var A=0;v&&(A|=4),Eh(E,d,A,v)}var nu="_reactListening"+Math.random().toString(36).slice(2);function Oo(d){if(!d[nu]){d[nu]=!0,n.forEach(function(E){E!=="selectionchange"&&(Ch.has(E)||zc(E,!1,d),zc(E,!0,d))});var v=d.nodeType===9?d:d.ownerDocument;v===null||v[nu]||(v[nu]=!0,zc("selectionchange",!1,v))}}function Eh(d,v,E,A){switch(Cr(v)){case 1:var W=fs;break;case 4:W=Ds;break;default:W=No}E=W.bind(null,v,E,d),W=void 0,!Jr||v!=="touchstart"&&v!=="touchmove"&&v!=="wheel"||(W=!0),A?W!==void 0?d.addEventListener(v,E,{capture:!0,passive:W}):d.addEventListener(v,E,!0):W!==void 0?d.addEventListener(v,E,{passive:W}):d.addEventListener(v,E,!1)}function f(d,v,E,A,W){var Y=A;if((v&1)===0&&(v&2)===0&&A!==null)e:for(;;){if(A===null)return;var le=A.tag;if(le===3||le===4){var be=A.stateNode.containerInfo;if(be===W||be.nodeType===8&&be.parentNode===W)break;if(le===4)for(le=A.return;le!==null;){var _e=le.tag;if((_e===3||_e===4)&&(_e=le.stateNode.containerInfo,_e===W||_e.nodeType===8&&_e.parentNode===W))return;le=le.return}for(;be!==null;){if(le=Do(be),le===null)return;if(_e=le.tag,_e===5||_e===6){A=Y=le;continue e}be=be.parentNode}}A=A.return}kr(function(){var Be=Y,st=Ve(E),ft=[];e:{var it=vl.get(d);if(it!==void 0){var Rt=ps,Ut=d;switch(d){case"keypress":if(ul(E)===0)break e;case"keydown":case"keyup":Rt=yh;break;case"focusin":Ut="focus",Rt=Fu;break;case"focusout":Ut="blur",Rt=Fu;break;case"beforeblur":case"afterblur":Rt=Fu;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Rt=tn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Rt=ka;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Rt=Zl;break;case Sh:case vs:case Ic:Rt=vh;break;case jc:Rt=Yl;break;case"scroll":Rt=Of;break;case"wheel":Rt=bh;break;case"copy":case"cut":case"paste":Rt=Kl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Rt=cl}var Wt=(v&4)!==0,Ci=!Wt&&d==="scroll",Re=Wt?it!==null?it+"Capture":null:it;Wt=[];for(var Ce=Be,De;Ce!==null;){De=Ce;var yt=De.stateNode;if(De.tag===5&&yt!==null&&(De=yt,Re!==null&&(yt=Qr(Ce,Re),yt!=null&&Wt.push(k(Ce,yt,De)))),Ci)break;Ce=Ce.return}0<Wt.length&&(it=new Rt(it,Ut,null,E,st),ft.push({event:it,listeners:Wt}))}}if((v&7)===0){e:{if(it=d==="mouseover"||d==="pointerover",Rt=d==="mouseout"||d==="pointerout",it&&E!==Qe&&(Ut=E.relatedTarget||E.fromElement)&&(Do(Ut)||Ut[zr]))break e;if((Rt||it)&&(it=st.window===st?st:(it=st.ownerDocument)?it.defaultView||it.parentWindow:window,Rt?(Ut=E.relatedTarget||E.toElement,Rt=Be,Ut=Ut?Do(Ut):null,Ut!==null&&(Ci=ni(Ut),Ut!==Ci||Ut.tag!==5&&Ut.tag!==6)&&(Ut=null)):(Rt=null,Ut=Be),Rt!==Ut)){if(Wt=tn,yt="onMouseLeave",Re="onMouseEnter",Ce="mouse",(d==="pointerout"||d==="pointerover")&&(Wt=cl,yt="onPointerLeave",Re="onPointerEnter",Ce="pointer"),Ci=Rt==null?it:Vn(Rt),De=Ut==null?it:Vn(Ut),it=new Wt(yt,Ce+"leave",Rt,E,st),it.target=Ci,it.relatedTarget=De,yt=null,Do(st)===Be&&(Wt=new Wt(Re,Ce+"enter",Ut,E,st),Wt.target=De,Wt.relatedTarget=Ci,yt=Wt),Ci=yt,Rt&&Ut)t:{for(Wt=Rt,Re=Ut,Ce=0,De=Wt;De;De=H(De))Ce++;for(De=0,yt=Re;yt;yt=H(yt))De++;for(;0<Ce-De;)Wt=H(Wt),Ce--;for(;0<De-Ce;)Re=H(Re),De--;for(;Ce--;){if(Wt===Re||Re!==null&&Wt===Re.alternate)break t;Wt=H(Wt),Re=H(Re)}Wt=null}else Wt=null;Rt!==null&&J(ft,it,Rt,Wt,!1),Ut!==null&&Ci!==null&&J(ft,Ci,Ut,Wt,!0)}}e:{if(it=Be?Vn(Be):window,Rt=it.nodeName&&it.nodeName.toLowerCase(),Rt==="select"||Rt==="input"&&it.type==="file")var qt=Xa;else if(lo(it))if(ea)qt=zu;else{qt=Hr;var rr=Jl}else(Rt=it.nodeName)&&Rt.toLowerCase()==="input"&&(it.type==="checkbox"||it.type==="radio")&&(qt=pl);if(qt&&(qt=qt(d,Be))){fl(ft,qt,E,st);break e}rr&&rr(d,it,Be),d==="focusout"&&(rr=it._wrapperState)&&rr.controlled&&it.type==="number"&&_t(it,"number",it.value)}switch(rr=Be?Vn(Be):window,d){case"focusin":(lo(rr)||rr.contentEditable==="true")&&(tu=rr,An=Be,ml=null);break;case"focusout":ml=An=tu=null;break;case"mousedown":ru=!0;break;case"contextmenu":case"mouseup":case"dragend":ru=!1,Dc(ft,E,st);break;case"selectionchange":if(Ao)break;case"keydown":case"keyup":Dc(ft,E,st)}var nr;if(js)e:{switch(d){case"compositionstart":var or="onCompositionStart";break e;case"compositionend":or="onCompositionEnd";break e;case"compositionupdate":or="onCompositionUpdate";break e}or=void 0}else Pi?hl(d,E)&&(or="onCompositionEnd"):d==="keydown"&&E.keyCode===229&&(or="onCompositionStart");or&&(_a&&E.locale!=="ko"&&(Pi||or!=="onCompositionStart"?or==="onCompositionEnd"&&Pi&&(nr=ql()):(yi=st,ii="value"in yi?yi.value:yi.textContent,Pi=!0)),rr=P(Be,or),0<rr.length&&(or=new Po(or,d,null,E,st),ft.push({event:or,listeners:rr}),nr?or.data=nr:(nr=Za(E),nr!==null&&(or.data=nr)))),(nr=Ji?wh(d,E):oo(d,E))&&(Be=P(Be,"onBeforeInput"),0<Be.length&&(st=new Po("onBeforeInput","beforeinput",null,E,st),ft.push({event:st,listeners:Be}),st.data=nr))}Bc(ft,v)})}function k(d,v,E){return{instance:d,listener:v,currentTarget:E}}function P(d,v){for(var E=v+"Capture",A=[];d!==null;){var W=d,Y=W.stateNode;W.tag===5&&Y!==null&&(W=Y,Y=Qr(d,E),Y!=null&&A.unshift(k(d,Y,W)),Y=Qr(d,v),Y!=null&&A.push(k(d,Y,W))),d=d.return}return A}function H(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function J(d,v,E,A,W){for(var Y=v._reactName,le=[];E!==null&&E!==A;){var be=E,_e=be.alternate,Be=be.stateNode;if(_e!==null&&_e===A)break;be.tag===5&&Be!==null&&(be=Be,W?(_e=Qr(E,Y),_e!=null&&le.unshift(k(E,_e,be))):W||(_e=Qr(E,Y),_e!=null&&le.push(k(E,_e,be)))),E=E.return}le.length!==0&&d.push({event:v,listeners:le})}var ce=/\r\n?/g,we=/\u0000|\uFFFD/g;function Me(d){return(typeof d=="string"?d:""+d).replace(ce,`
`).replace(we,"")}function Ie(d,v,E){if(v=Me(v),Me(d)!==v&&E)throw Error(r(425))}function Je(){}var Tt=null,Xt=null;function hr(d,v){return d==="textarea"||d==="noscript"||typeof v.children=="string"||typeof v.children=="number"||typeof v.dangerouslySetInnerHTML=="object"&&v.dangerouslySetInnerHTML!==null&&v.dangerouslySetInnerHTML.__html!=null}var Zr=typeof setTimeout=="function"?setTimeout:void 0,Gn=typeof clearTimeout=="function"?clearTimeout:void 0,Ai=typeof Promise=="function"?Promise:void 0,zi=typeof queueMicrotask=="function"?queueMicrotask:typeof Ai<"u"?function(d){return Ai.resolve(null).then(d).catch(yl)}:Zr;function yl(d){setTimeout(function(){throw d})}function Uc(d,v){var E=v,A=0;do{var W=E.nextSibling;if(d.removeChild(E),W&&W.nodeType===8)if(E=W.data,E==="/$"){if(A===0){d.removeChild(W),Fn(v);return}A--}else E!=="$"&&E!=="$?"&&E!=="$!"||A++;E=W}while(E);Fn(v)}function zs(d){for(;d!=null;d=d.nextSibling){var v=d.nodeType;if(v===1||v===3)break;if(v===8){if(v=d.data,v==="$"||v==="$!"||v==="$?")break;if(v==="/$")return null}}return d}function xl(d){d=d.previousSibling;for(var v=0;d;){if(d.nodeType===8){var E=d.data;if(E==="$"||E==="$!"||E==="$?"){if(v===0)return d;v--}else E==="/$"&&v++}d=d.previousSibling}return null}var co=Math.random().toString(36).slice(2),es="__reactFiber$"+co,iu="__reactProps$"+co,zr="__reactContainer$"+co,bl="__reactEvents$"+co,Bf="__reactListeners$"+co,zf="__reactHandles$"+co;function Do(d){var v=d[es];if(v)return v;for(var E=d.parentNode;E;){if(v=E[zr]||E[es]){if(E=v.alternate,v.child!==null||E!==null&&E.child!==null)for(d=xl(d);d!==null;){if(E=d[es])return E;d=xl(d)}return v}d=E,E=d.parentNode}return null}function wl(d){return d=d[es]||d[zr],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function Vn(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(r(33))}function si(d){return d[iu]||null}var Uf=[],Vu=-1;function Sl(d){return{current:d}}function pn(d){0>Vu||(d.current=Uf[Vu],Uf[Vu]=null,Vu--)}function un(d,v){Vu++,Uf[Vu]=d.current,d.current=v}var Io={},Ui=Sl(Io),na=Sl(!1),au=Io;function Hu(d,v){var E=d.type.contextTypes;if(!E)return Io;var A=d.stateNode;if(A&&A.__reactInternalMemoizedUnmaskedChildContext===v)return A.__reactInternalMemoizedMaskedChildContext;var W={},Y;for(Y in E)W[Y]=v[Y];return A&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=v,d.__reactInternalMemoizedMaskedChildContext=W),W}function ia(d){return d=d.childContextTypes,d!=null}function Gc(){pn(na),pn(Ui)}function xm(d,v,E){if(Ui.current!==Io)throw Error(r(168));un(Ui,v),un(na,E)}function Gf(d,v,E){var A=d.stateNode;if(v=v.childContextTypes,typeof A.getChildContext!="function")return E;A=A.getChildContext();for(var W in A)if(!(W in v))throw Error(r(108,ae(d)||"Unknown",W));return te({},E,A)}function Wu(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||Io,au=Ui.current,un(Ui,d),un(na,na.current),!0}function v0(d,v,E){var A=d.stateNode;if(!A)throw Error(r(169));E?(d=Gf(d,v,au),A.__reactInternalMemoizedMergedChildContext=d,pn(na),pn(Ui),un(Ui,d)):pn(na),un(na,E)}var jo=null,Vc=!1,Vf=!1;function Th(d){jo===null?jo=[d]:jo.push(d)}function kl(d){Vc=!0,Th(d)}function su(){if(!Vf&&jo!==null){Vf=!0;var d=0,v=xr;try{var E=jo;for(xr=1;d<E.length;d++){var A=E[d];do A=A(!0);while(A!==null)}jo=null,Vc=!1}catch(W){throw jo!==null&&(jo=jo.slice(d+1)),ko(hs,su),W}finally{xr=v,Vf=!1}}return null}var Na=[],qu=0,ou=null,lu=0,Pa=[],Ma=0,uu=null,ys=1,Cn="";function $u(d,v){Na[qu++]=lu,Na[qu++]=ou,ou=d,lu=v}function y0(d,v,E){Pa[Ma++]=ys,Pa[Ma++]=Cn,Pa[Ma++]=uu,uu=d;var A=ys;d=Cn;var W=32-Ze(A)-1;A&=~(1<<W),E+=1;var Y=32-Ze(v)+W;if(30<Y){var le=W-W%5;Y=(A&(1<<le)-1).toString(32),A>>=le,W-=le,ys=1<<32-Ze(v)+W|E<<W|A,Cn=Y+d}else ys=1<<Y|E<<W|A,Cn=d}function Hc(d){d.return!==null&&($u(d,1),y0(d,1,0))}function Li(d){for(;d===ou;)ou=Na[--qu],Na[qu]=null,lu=Na[--qu],Na[qu]=null;for(;d===uu;)uu=Pa[--Ma],Pa[Ma]=null,Cn=Pa[--Ma],Pa[Ma]=null,ys=Pa[--Ma],Pa[Ma]=null}var xs=null,St=null,Yr=!1,bs=null;function bm(d,v){var E=Ho(5,null,null,0);E.elementType="DELETED",E.stateNode=v,E.return=d,v=d.deletions,v===null?(d.deletions=[E],d.flags|=16):v.push(E)}function x0(d,v){switch(d.tag){case 5:var E=d.type;return v=v.nodeType!==1||E.toLowerCase()!==v.nodeName.toLowerCase()?null:v,v!==null?(d.stateNode=v,xs=d,St=zs(v.firstChild),!0):!1;case 6:return v=d.pendingProps===""||v.nodeType!==3?null:v,v!==null?(d.stateNode=v,xs=d,St=null,!0):!1;case 13:return v=v.nodeType!==8?null:v,v!==null?(E=uu!==null?{id:ys,overflow:Cn}:null,d.memoizedState={dehydrated:v,treeContext:E,retryLane:1073741824},E=Ho(18,null,null,0),E.stateNode=v,E.return=d,d.child=E,xs=d,St=null,!0):!1;default:return!1}}function Ku(d){return(d.mode&1)!==0&&(d.flags&128)===0}function Wc(d){if(Yr){var v=St;if(v){var E=v;if(!x0(d,v)){if(Ku(d))throw Error(r(418));v=zs(E.nextSibling);var A=xs;v&&x0(d,v)?bm(A,E):(d.flags=d.flags&-4097|2,Yr=!1,xs=d)}}else{if(Ku(d))throw Error(r(418));d.flags=d.flags&-4097|2,Yr=!1,xs=d}}}function Hf(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;xs=d}function Nh(d){if(d!==xs)return!1;if(!Yr)return Hf(d),Yr=!0,!1;var v;if((v=d.tag!==3)&&!(v=d.tag!==5)&&(v=d.type,v=v!=="head"&&v!=="body"&&!hr(d.type,d.memoizedProps)),v&&(v=St)){if(Ku(d))throw wm(),Error(r(418));for(;v;)bm(d,v),v=zs(v.nextSibling)}if(Hf(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(r(317));e:{for(d=d.nextSibling,v=0;d;){if(d.nodeType===8){var E=d.data;if(E==="/$"){if(v===0){St=zs(d.nextSibling);break e}v--}else E!=="$"&&E!=="$!"&&E!=="$?"||v++}d=d.nextSibling}St=null}}else St=xs?zs(d.stateNode.nextSibling):null;return!0}function wm(){for(var d=St;d;)d=zs(d.nextSibling)}function Zu(){St=xs=null,Yr=!1}function Ph(d){bs===null?bs=[d]:bs.push(d)}var Sm=N.ReactCurrentBatchConfig;function Jn(d,v,E){if(d=E.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(E._owner){if(E=E._owner,E){if(E.tag!==1)throw Error(r(309));var A=E.stateNode}if(!A)throw Error(r(147,d));var W=A,Y=""+d;return v!==null&&v.ref!==null&&typeof v.ref=="function"&&v.ref._stringRef===Y?v.ref:(v=function(le){var be=W.refs;le===null?delete be[Y]:be[Y]=le},v._stringRef=Y,v)}if(typeof d!="string")throw Error(r(284));if(!E._owner)throw Error(r(290,d))}return d}function ts(d,v){throw d=Object.prototype.toString.call(v),Error(r(31,d==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":d))}function ho(d){var v=d._init;return v(d._payload)}function Wf(d){function v(Re,Ce){if(d){var De=Re.deletions;De===null?(Re.deletions=[Ce],Re.flags|=16):De.push(Ce)}}function E(Re,Ce){if(!d)return null;for(;Ce!==null;)v(Re,Ce),Ce=Ce.sibling;return null}function A(Re,Ce){for(Re=new Map;Ce!==null;)Ce.key!==null?Re.set(Ce.key,Ce):Re.set(Ce.index,Ce),Ce=Ce.sibling;return Re}function W(Re,Ce){return Re=hd(Re,Ce),Re.index=0,Re.sibling=null,Re}function Y(Re,Ce,De){return Re.index=De,d?(De=Re.alternate,De!==null?(De=De.index,De<Ce?(Re.flags|=2,Ce):De):(Re.flags|=2,Ce)):(Re.flags|=1048576,Ce)}function le(Re){return d&&Re.alternate===null&&(Re.flags|=2),Re}function be(Re,Ce,De,yt){return Ce===null||Ce.tag!==6?(Ce=Tb(De,Re.mode,yt),Ce.return=Re,Ce):(Ce=W(Ce,De),Ce.return=Re,Ce)}function _e(Re,Ce,De,yt){var qt=De.type;return qt===j?st(Re,Ce,De.props.children,yt,De.key):Ce!==null&&(Ce.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===Z&&ho(qt)===Ce.type)?(yt=W(Ce,De.props),yt.ref=Jn(Re,Ce,De),yt.return=Re,yt):(yt=z0(De.type,De.key,De.props,null,Re.mode,yt),yt.ref=Jn(Re,Ce,De),yt.return=Re,yt)}function Be(Re,Ce,De,yt){return Ce===null||Ce.tag!==4||Ce.stateNode.containerInfo!==De.containerInfo||Ce.stateNode.implementation!==De.implementation?(Ce=Nb(De,Re.mode,yt),Ce.return=Re,Ce):(Ce=W(Ce,De.children||[]),Ce.return=Re,Ce)}function st(Re,Ce,De,yt,qt){return Ce===null||Ce.tag!==7?(Ce=zh(De,Re.mode,yt,qt),Ce.return=Re,Ce):(Ce=W(Ce,De),Ce.return=Re,Ce)}function ft(Re,Ce,De){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number")return Ce=Tb(""+Ce,Re.mode,De),Ce.return=Re,Ce;if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case R:return De=z0(Ce.type,Ce.key,Ce.props,null,Re.mode,De),De.ref=Jn(Re,null,Ce),De.return=Re,De;case I:return Ce=Nb(Ce,Re.mode,De),Ce.return=Re,Ce;case Z:var yt=Ce._init;return ft(Re,yt(Ce._payload),De)}if(Xe(Ce)||ne(Ce))return Ce=zh(Ce,Re.mode,De,null),Ce.return=Re,Ce;ts(Re,Ce)}return null}function it(Re,Ce,De,yt){var qt=Ce!==null?Ce.key:null;if(typeof De=="string"&&De!==""||typeof De=="number")return qt!==null?null:be(Re,Ce,""+De,yt);if(typeof De=="object"&&De!==null){switch(De.$$typeof){case R:return De.key===qt?_e(Re,Ce,De,yt):null;case I:return De.key===qt?Be(Re,Ce,De,yt):null;case Z:return qt=De._init,it(Re,Ce,qt(De._payload),yt)}if(Xe(De)||ne(De))return qt!==null?null:st(Re,Ce,De,yt,null);ts(Re,De)}return null}function Rt(Re,Ce,De,yt,qt){if(typeof yt=="string"&&yt!==""||typeof yt=="number")return Re=Re.get(De)||null,be(Ce,Re,""+yt,qt);if(typeof yt=="object"&&yt!==null){switch(yt.$$typeof){case R:return Re=Re.get(yt.key===null?De:yt.key)||null,_e(Ce,Re,yt,qt);case I:return Re=Re.get(yt.key===null?De:yt.key)||null,Be(Ce,Re,yt,qt);case Z:var rr=yt._init;return Rt(Re,Ce,De,rr(yt._payload),qt)}if(Xe(yt)||ne(yt))return Re=Re.get(De)||null,st(Ce,Re,yt,qt,null);ts(Ce,yt)}return null}function Ut(Re,Ce,De,yt){for(var qt=null,rr=null,nr=Ce,or=Ce=0,ca=null;nr!==null&&or<De.length;or++){nr.index>or?(ca=nr,nr=null):ca=nr.sibling;var Wr=it(Re,nr,De[or],yt);if(Wr===null){nr===null&&(nr=ca);break}d&&nr&&Wr.alternate===null&&v(Re,nr),Ce=Y(Wr,Ce,or),rr===null?qt=Wr:rr.sibling=Wr,rr=Wr,nr=ca}if(or===De.length)return E(Re,nr),Yr&&$u(Re,or),qt;if(nr===null){for(;or<De.length;or++)nr=ft(Re,De[or],yt),nr!==null&&(Ce=Y(nr,Ce,or),rr===null?qt=nr:rr.sibling=nr,rr=nr);return Yr&&$u(Re,or),qt}for(nr=A(Re,nr);or<De.length;or++)ca=Rt(nr,Re,or,De[or],yt),ca!==null&&(d&&ca.alternate!==null&&nr.delete(ca.key===null?or:ca.key),Ce=Y(ca,Ce,or),rr===null?qt=ca:rr.sibling=ca,rr=ca);return d&&nr.forEach(function(fd){return v(Re,fd)}),Yr&&$u(Re,or),qt}function Wt(Re,Ce,De,yt){var qt=ne(De);if(typeof qt!="function")throw Error(r(150));if(De=qt.call(De),De==null)throw Error(r(151));for(var rr=qt=null,nr=Ce,or=Ce=0,ca=null,Wr=De.next();nr!==null&&!Wr.done;or++,Wr=De.next()){nr.index>or?(ca=nr,nr=null):ca=nr.sibling;var fd=it(Re,nr,Wr.value,yt);if(fd===null){nr===null&&(nr=ca);break}d&&nr&&fd.alternate===null&&v(Re,nr),Ce=Y(fd,Ce,or),rr===null?qt=fd:rr.sibling=fd,rr=fd,nr=ca}if(Wr.done)return E(Re,nr),Yr&&$u(Re,or),qt;if(nr===null){for(;!Wr.done;or++,Wr=De.next())Wr=ft(Re,Wr.value,yt),Wr!==null&&(Ce=Y(Wr,Ce,or),rr===null?qt=Wr:rr.sibling=Wr,rr=Wr);return Yr&&$u(Re,or),qt}for(nr=A(Re,nr);!Wr.done;or++,Wr=De.next())Wr=Rt(nr,Re,or,Wr.value,yt),Wr!==null&&(d&&Wr.alternate!==null&&nr.delete(Wr.key===null?or:Wr.key),Ce=Y(Wr,Ce,or),rr===null?qt=Wr:rr.sibling=Wr,rr=Wr);return d&&nr.forEach(function(zD){return v(Re,zD)}),Yr&&$u(Re,or),qt}function Ci(Re,Ce,De,yt){if(typeof De=="object"&&De!==null&&De.type===j&&De.key===null&&(De=De.props.children),typeof De=="object"&&De!==null){switch(De.$$typeof){case R:e:{for(var qt=De.key,rr=Ce;rr!==null;){if(rr.key===qt){if(qt=De.type,qt===j){if(rr.tag===7){E(Re,rr.sibling),Ce=W(rr,De.props.children),Ce.return=Re,Re=Ce;break e}}else if(rr.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===Z&&ho(qt)===rr.type){E(Re,rr.sibling),Ce=W(rr,De.props),Ce.ref=Jn(Re,rr,De),Ce.return=Re,Re=Ce;break e}E(Re,rr);break}else v(Re,rr);rr=rr.sibling}De.type===j?(Ce=zh(De.props.children,Re.mode,yt,De.key),Ce.return=Re,Re=Ce):(yt=z0(De.type,De.key,De.props,null,Re.mode,yt),yt.ref=Jn(Re,Ce,De),yt.return=Re,Re=yt)}return le(Re);case I:e:{for(rr=De.key;Ce!==null;){if(Ce.key===rr)if(Ce.tag===4&&Ce.stateNode.containerInfo===De.containerInfo&&Ce.stateNode.implementation===De.implementation){E(Re,Ce.sibling),Ce=W(Ce,De.children||[]),Ce.return=Re,Re=Ce;break e}else{E(Re,Ce);break}else v(Re,Ce);Ce=Ce.sibling}Ce=Nb(De,Re.mode,yt),Ce.return=Re,Re=Ce}return le(Re);case Z:return rr=De._init,Ci(Re,Ce,rr(De._payload),yt)}if(Xe(De))return Ut(Re,Ce,De,yt);if(ne(De))return Wt(Re,Ce,De,yt);ts(Re,De)}return typeof De=="string"&&De!==""||typeof De=="number"?(De=""+De,Ce!==null&&Ce.tag===6?(E(Re,Ce.sibling),Ce=W(Ce,De),Ce.return=Re,Re=Ce):(E(Re,Ce),Ce=Tb(De,Re.mode,yt),Ce.return=Re,Re=Ce),le(Re)):E(Re,Ce)}return Ci}var Yu=Wf(!0),Us=Wf(!1),Mh=Sl(null),ws=null,qc=null,qf=null;function $f(){qf=qc=ws=null}function Kf(d){var v=Mh.current;pn(Mh),d._currentValue=v}function Zf(d,v,E){for(;d!==null;){var A=d.alternate;if((d.childLanes&v)!==v?(d.childLanes|=v,A!==null&&(A.childLanes|=v)):A!==null&&(A.childLanes&v)!==v&&(A.childLanes|=v),d===E)break;d=d.return}}function _l(d,v){ws=d,qf=qc=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&v)!==0&&(ee=!0),d.firstContext=null)}function Aa(d){var v=d._currentValue;if(qf!==d)if(d={context:d,memoizedValue:v,next:null},qc===null){if(ws===null)throw Error(r(308));qc=d,ws.dependencies={lanes:0,firstContext:d}}else qc=qc.next=d;return v}var Fo=null;function $c(d){Fo===null?Fo=[d]:Fo.push(d)}function Ah(d,v,E,A){var W=v.interleaved;return W===null?(E.next=E,$c(v)):(E.next=W.next,W.next=E),v.interleaved=E,Ss(d,A)}function Ss(d,v){d.lanes|=v;var E=d.alternate;for(E!==null&&(E.lanes|=v),E=d,d=d.return;d!==null;)d.childLanes|=v,E=d.alternate,E!==null&&(E.childLanes|=v),E=d,d=d.return;return E.tag===3?E.stateNode:null}var Bo=!1;function Lh(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Yf(d,v){d=d.updateQueue,v.updateQueue===d&&(v.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function zo(d,v){return{eventTime:d,lane:v,tag:0,payload:null,callback:null,next:null}}function Uo(d,v,E){var A=d.updateQueue;if(A===null)return null;if(A=A.shared,(Ur&2)!==0){var W=A.pending;return W===null?v.next=v:(v.next=W.next,W.next=v),A.pending=v,Ss(d,E)}return W=A.interleaved,W===null?(v.next=v,$c(A)):(v.next=W.next,W.next=v),A.interleaved=v,Ss(d,E)}function Xf(d,v,E){if(v=v.updateQueue,v!==null&&(v=v.shared,(E&4194240)!==0)){var A=v.lanes;A&=d.pendingLanes,E|=A,v.lanes=E,io(d,E)}}function Rh(d,v){var E=d.updateQueue,A=d.alternate;if(A!==null&&(A=A.updateQueue,E===A)){var W=null,Y=null;if(E=E.firstBaseUpdate,E!==null){do{var le={eventTime:E.eventTime,lane:E.lane,tag:E.tag,payload:E.payload,callback:E.callback,next:null};Y===null?W=Y=le:Y=Y.next=le,E=E.next}while(E!==null);Y===null?W=Y=v:Y=Y.next=v}else W=Y=v;E={baseState:A.baseState,firstBaseUpdate:W,lastBaseUpdate:Y,shared:A.shared,effects:A.effects},d.updateQueue=E;return}d=E.lastBaseUpdate,d===null?E.firstBaseUpdate=v:d.next=v,E.lastBaseUpdate=v}function Kc(d,v,E,A){var W=d.updateQueue;Bo=!1;var Y=W.firstBaseUpdate,le=W.lastBaseUpdate,be=W.shared.pending;if(be!==null){W.shared.pending=null;var _e=be,Be=_e.next;_e.next=null,le===null?Y=Be:le.next=Be,le=_e;var st=d.alternate;st!==null&&(st=st.updateQueue,be=st.lastBaseUpdate,be!==le&&(be===null?st.firstBaseUpdate=Be:be.next=Be,st.lastBaseUpdate=_e))}if(Y!==null){var ft=W.baseState;le=0,st=Be=_e=null,be=Y;do{var it=be.lane,Rt=be.eventTime;if((A&it)===it){st!==null&&(st=st.next={eventTime:Rt,lane:0,tag:be.tag,payload:be.payload,callback:be.callback,next:null});e:{var Ut=d,Wt=be;switch(it=v,Rt=E,Wt.tag){case 1:if(Ut=Wt.payload,typeof Ut=="function"){ft=Ut.call(Rt,ft,it);break e}ft=Ut;break e;case 3:Ut.flags=Ut.flags&-65537|128;case 0:if(Ut=Wt.payload,it=typeof Ut=="function"?Ut.call(Rt,ft,it):Ut,it==null)break e;ft=te({},ft,it);break e;case 2:Bo=!0}}be.callback!==null&&be.lane!==0&&(d.flags|=64,it=W.effects,it===null?W.effects=[be]:it.push(be))}else Rt={eventTime:Rt,lane:it,tag:be.tag,payload:be.payload,callback:be.callback,next:null},st===null?(Be=st=Rt,_e=ft):st=st.next=Rt,le|=it;if(be=be.next,be===null){if(be=W.shared.pending,be===null)break;it=be,be=it.next,it.next=null,W.lastBaseUpdate=it,W.shared.pending=null}}while(!0);if(st===null&&(_e=ft),W.baseState=_e,W.firstBaseUpdate=Be,W.lastBaseUpdate=st,v=W.shared.interleaved,v!==null){W=v;do le|=W.lane,W=W.next;while(W!==v)}else Y===null&&(W.shared.lanes=0);Ih|=le,d.lanes=le,d.memoizedState=ft}}function Hn(d,v,E){if(d=v.effects,v.effects=null,d!==null)for(v=0;v<d.length;v++){var A=d[v],W=A.callback;if(W!==null){if(A.callback=null,A=E,typeof W!="function")throw Error(r(191,W));W.call(A)}}}var fr={},cn=Sl(fr),En=Sl(fr),ei=Sl(fr);function Si(d){if(d===fr)throw Error(r(174));return d}function cu(d,v){switch(un(ei,v),un(En,d),un(cn,fr),d=v.nodeType,d){case 9:case 11:v=(v=v.documentElement)?v.namespaceURI:Ne(null,"");break;default:d=d===8?v.parentNode:v,v=d.namespaceURI||null,d=d.tagName,v=Ne(v,d)}pn(cn),un(cn,v)}function Tn(){pn(cn),pn(En),pn(ei)}function Zc(d){Si(ei.current);var v=Si(cn.current),E=Ne(v,d.type);v!==E&&(un(En,d),un(cn,E))}function Cl(d){En.current===d&&(pn(cn),pn(En))}var mn=Sl(0);function Yc(d){for(var v=d;v!==null;){if(v.tag===13){var E=v.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return v}else if(v.tag===19&&v.memoizedProps.revealOrder!==void 0){if((v.flags&128)!==0)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===d)break;for(;v.sibling===null;){if(v.return===null||v.return===d)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}var Xu=[];function aa(){for(var d=0;d<Xu.length;d++)Xu[d]._workInProgressVersionPrimary=null;Xu.length=0}var Xc=N.ReactCurrentDispatcher,Oh=N.ReactCurrentBatchConfig,La=0,rn=null,Wn=null,oi=null,fo=!1,du=!1,Gs=0,Qf=0;function li(){throw Error(r(321))}function Dh(d,v){if(v===null)return!1;for(var E=0;E<v.length&&E<d.length;E++)if(!ta(d[E],v[E]))return!1;return!0}function Qc(d,v,E,A,W,Y){if(La=Y,rn=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,Xc.current=d===null||d.memoizedState===null?lb:pu,d=E(A,W),du){Y=0;do{if(du=!1,Gs=0,25<=Y)throw Error(r(301));Y+=1,oi=Wn=null,v.updateQueue=null,Xc.current=np,d=E(A,W)}while(du)}if(Xc.current=rd,v=Wn!==null&&Wn.next!==null,La=0,oi=Wn=rn=null,fo=!1,v)throw Error(r(300));return d}function Jc(){var d=Gs!==0;return Gs=0,d}function xn(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oi===null?rn.memoizedState=oi=d:oi=oi.next=d,oi}function ki(){if(Wn===null){var d=rn.alternate;d=d!==null?d.memoizedState:null}else d=Wn.next;var v=oi===null?rn.memoizedState:oi.next;if(v!==null)oi=v,Wn=d;else{if(d===null)throw Error(r(310));Wn=d,d={memoizedState:Wn.memoizedState,baseState:Wn.baseState,baseQueue:Wn.baseQueue,queue:Wn.queue,next:null},oi===null?rn.memoizedState=oi=d:oi=oi.next=d}return oi}function sa(d,v){return typeof v=="function"?v(d):v}function oa(d){var v=ki(),E=v.queue;if(E===null)throw Error(r(311));E.lastRenderedReducer=d;var A=Wn,W=A.baseQueue,Y=E.pending;if(Y!==null){if(W!==null){var le=W.next;W.next=Y.next,Y.next=le}A.baseQueue=W=Y,E.pending=null}if(W!==null){Y=W.next,A=A.baseState;var be=le=null,_e=null,Be=Y;do{var st=Be.lane;if((La&st)===st)_e!==null&&(_e=_e.next={lane:0,action:Be.action,hasEagerState:Be.hasEagerState,eagerState:Be.eagerState,next:null}),A=Be.hasEagerState?Be.eagerState:d(A,Be.action);else{var ft={lane:st,action:Be.action,hasEagerState:Be.hasEagerState,eagerState:Be.eagerState,next:null};_e===null?(be=_e=ft,le=A):_e=_e.next=ft,rn.lanes|=st,Ih|=st}Be=Be.next}while(Be!==null&&Be!==Y);_e===null?le=A:_e.next=be,ta(A,v.memoizedState)||(ee=!0),v.memoizedState=A,v.baseState=le,v.baseQueue=_e,E.lastRenderedState=A}if(d=E.interleaved,d!==null){W=d;do Y=W.lane,rn.lanes|=Y,Ih|=Y,W=W.next;while(W!==d)}else W===null&&(E.lanes=0);return[v.memoizedState,E.dispatch]}function Jf(d){var v=ki(),E=v.queue;if(E===null)throw Error(r(311));E.lastRenderedReducer=d;var A=E.dispatch,W=E.pending,Y=v.memoizedState;if(W!==null){E.pending=null;var le=W=W.next;do Y=d(Y,le.action),le=le.next;while(le!==W);ta(Y,v.memoizedState)||(ee=!0),v.memoizedState=Y,v.baseQueue===null&&(v.baseState=Y),E.lastRenderedState=Y}return[Y,A]}function ep(){}function tp(d,v){var E=rn,A=ki(),W=v(),Y=!ta(A.memoizedState,W);if(Y&&(A.memoizedState=W,ee=!0),A=A.queue,Em(km.bind(null,E,A,d),[d]),A.getSnapshot!==v||Y||oi!==null&&oi.memoizedState.tag&1){if(E.flags|=2048,ed(9,El.bind(null,E,A,W,v),void 0,null),ua===null)throw Error(r(349));(La&30)!==0||b0(E,v,W)}return W}function b0(d,v,E){d.flags|=16384,d={getSnapshot:v,value:E},v=rn.updateQueue,v===null?(v={lastEffect:null,stores:null},rn.updateQueue=v,v.stores=[d]):(E=v.stores,E===null?v.stores=[d]:E.push(d))}function El(d,v,E,A){v.value=E,v.getSnapshot=A,_m(v)&&rp(d)}function km(d,v,E){return E(function(){_m(v)&&rp(d)})}function _m(d){var v=d.getSnapshot;d=d.value;try{var E=v();return!ta(d,E)}catch{return!0}}function rp(d){var v=Ss(d,1);v!==null&&Ml(v,d,1,-1)}function hu(d){var v=xn();return typeof d=="function"&&(d=d()),v.memoizedState=v.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sa,lastRenderedState:d},v.queue=d,d=d.dispatch=E0.bind(null,rn,d),[v.memoizedState,d]}function ed(d,v,E,A){return d={tag:d,create:v,destroy:E,deps:A,next:null},v=rn.updateQueue,v===null?(v={lastEffect:null,stores:null},rn.updateQueue=v,v.lastEffect=d.next=d):(E=v.lastEffect,E===null?v.lastEffect=d.next=d:(A=E.next,E.next=d,d.next=A,v.lastEffect=d)),d}function Cm(){return ki().memoizedState}function td(d,v,E,A){var W=xn();rn.flags|=d,W.memoizedState=ed(1|v,E,void 0,A===void 0?null:A)}function Qu(d,v,E,A){var W=ki();A=A===void 0?null:A;var Y=void 0;if(Wn!==null){var le=Wn.memoizedState;if(Y=le.destroy,A!==null&&Dh(A,le.deps)){W.memoizedState=ed(v,E,Y,A);return}}rn.flags|=d,W.memoizedState=ed(1|v,E,Y,A)}function w0(d,v){return td(8390656,8,d,v)}function Em(d,v){return Qu(2048,8,d,v)}function Tm(d,v){return Qu(4,2,d,v)}function Nm(d,v){return Qu(4,4,d,v)}function fu(d,v){if(typeof v=="function")return d=d(),v(d),function(){v(null)};if(v!=null)return d=d(),v.current=d,function(){v.current=null}}function S0(d,v,E){return E=E!=null?E.concat([d]):null,Qu(4,4,fu.bind(null,v,d),E)}function Tl(){}function Pm(d,v){var E=ki();v=v===void 0?null:v;var A=E.memoizedState;return A!==null&&v!==null&&Dh(v,A[1])?A[0]:(E.memoizedState=[d,v],d)}function bn(d,v){var E=ki();v=v===void 0?null:v;var A=E.memoizedState;return A!==null&&v!==null&&Dh(v,A[1])?A[0]:(d=d(),E.memoizedState=[d,v],d)}function k0(d,v,E){return(La&21)===0?(d.baseState&&(d.baseState=!1,ee=!0),d.memoizedState=E):(ta(E,v)||(E=Rr(),rn.lanes|=E,Ih|=E,d.baseState=!0),v)}function _0(d,v){var E=xr;xr=E!==0&&4>E?E:4,d(!0);var A=Oh.transition;Oh.transition={};try{d(!1),v()}finally{xr=E,Oh.transition=A}}function C0(){return ki().memoizedState}function ob(d,v,E){var A=cd(d);if(E={lane:A,action:E,hasEagerState:!1,eagerState:null,next:null},Mm(d))T0(v,E);else if(E=Ah(d,v,E,A),E!==null){var W=_s();Ml(E,d,A,W),ks(E,v,A)}}function E0(d,v,E){var A=cd(d),W={lane:A,action:E,hasEagerState:!1,eagerState:null,next:null};if(Mm(d))T0(v,W);else{var Y=d.alternate;if(d.lanes===0&&(Y===null||Y.lanes===0)&&(Y=v.lastRenderedReducer,Y!==null))try{var le=v.lastRenderedState,be=Y(le,E);if(W.hasEagerState=!0,W.eagerState=be,ta(be,le)){var _e=v.interleaved;_e===null?(W.next=W,$c(v)):(W.next=_e.next,_e.next=W),v.interleaved=W;return}}catch{}E=Ah(d,v,W,A),E!==null&&(W=_s(),Ml(E,d,A,W),ks(E,v,A))}}function Mm(d){var v=d.alternate;return d===rn||v!==null&&v===rn}function T0(d,v){du=fo=!0;var E=d.pending;E===null?v.next=v:(v.next=E.next,E.next=v),d.pending=v}function ks(d,v,E){if((E&4194240)!==0){var A=v.lanes;A&=d.pendingLanes,E|=A,v.lanes=E,io(d,E)}}var rd={readContext:Aa,useCallback:li,useContext:li,useEffect:li,useImperativeHandle:li,useInsertionEffect:li,useLayoutEffect:li,useMemo:li,useReducer:li,useRef:li,useState:li,useDebugValue:li,useDeferredValue:li,useTransition:li,useMutableSource:li,useSyncExternalStore:li,useId:li,unstable_isNewReconciler:!1},lb={readContext:Aa,useCallback:function(d,v){return xn().memoizedState=[d,v===void 0?null:v],d},useContext:Aa,useEffect:w0,useImperativeHandle:function(d,v,E){return E=E!=null?E.concat([d]):null,td(4194308,4,fu.bind(null,v,d),E)},useLayoutEffect:function(d,v){return td(4194308,4,d,v)},useInsertionEffect:function(d,v){return td(4,2,d,v)},useMemo:function(d,v){var E=xn();return v=v===void 0?null:v,d=d(),E.memoizedState=[d,v],d},useReducer:function(d,v,E){var A=xn();return v=E!==void 0?E(v):v,A.memoizedState=A.baseState=v,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:v},A.queue=d,d=d.dispatch=ob.bind(null,rn,d),[A.memoizedState,d]},useRef:function(d){var v=xn();return d={current:d},v.memoizedState=d},useState:hu,useDebugValue:Tl,useDeferredValue:function(d){return xn().memoizedState=d},useTransition:function(){var d=hu(!1),v=d[0];return d=_0.bind(null,d[1]),xn().memoizedState=d,[v,d]},useMutableSource:function(){},useSyncExternalStore:function(d,v,E){var A=rn,W=xn();if(Yr){if(E===void 0)throw Error(r(407));E=E()}else{if(E=v(),ua===null)throw Error(r(349));(La&30)!==0||b0(A,v,E)}W.memoizedState=E;var Y={value:E,getSnapshot:v};return W.queue=Y,w0(km.bind(null,A,Y,d),[d]),A.flags|=2048,ed(9,El.bind(null,A,Y,E,v),void 0,null),E},useId:function(){var d=xn(),v=ua.identifierPrefix;if(Yr){var E=Cn,A=ys;E=(A&~(1<<32-Ze(A)-1)).toString(32)+E,v=":"+v+"R"+E,E=Gs++,0<E&&(v+="H"+E.toString(32)),v+=":"}else E=Qf++,v=":"+v+"r"+E.toString(32)+":";return d.memoizedState=v},unstable_isNewReconciler:!1},pu={readContext:Aa,useCallback:Pm,useContext:Aa,useEffect:Em,useImperativeHandle:S0,useInsertionEffect:Tm,useLayoutEffect:Nm,useMemo:bn,useReducer:oa,useRef:Cm,useState:function(){return oa(sa)},useDebugValue:Tl,useDeferredValue:function(d){var v=ki();return k0(v,Wn.memoizedState,d)},useTransition:function(){var d=oa(sa)[0],v=ki().memoizedState;return[d,v]},useMutableSource:ep,useSyncExternalStore:tp,useId:C0,unstable_isNewReconciler:!1},np={readContext:Aa,useCallback:Pm,useContext:Aa,useEffect:Em,useImperativeHandle:S0,useInsertionEffect:Tm,useLayoutEffect:Nm,useMemo:bn,useReducer:Jf,useRef:Cm,useState:function(){return Jf(sa)},useDebugValue:Tl,useDeferredValue:function(d){var v=ki();return Wn===null?v.memoizedState=d:k0(v,Wn.memoizedState,d)},useTransition:function(){var d=Jf(sa)[0],v=ki().memoizedState;return[d,v]},useMutableSource:ep,useSyncExternalStore:tp,useId:C0,unstable_isNewReconciler:!1};function Gi(d,v){if(d&&d.defaultProps){v=te({},v),d=d.defaultProps;for(var E in d)v[E]===void 0&&(v[E]=d[E]);return v}return v}function nd(d,v,E,A){v=d.memoizedState,E=E(A,v),E=E==null?v:te({},v,E),d.memoizedState=E,d.lanes===0&&(d.updateQueue.baseState=E)}var ad={isMounted:function(d){return(d=d._reactInternals)?ni(d)===d:!1},enqueueSetState:function(d,v,E){d=d._reactInternals;var A=_s(),W=cd(d),Y=zo(A,W);Y.payload=v,E!=null&&(Y.callback=E),v=Uo(d,Y,W),v!==null&&(Ml(v,d,W,A),Xf(v,d,W))},enqueueReplaceState:function(d,v,E){d=d._reactInternals;var A=_s(),W=cd(d),Y=zo(A,W);Y.tag=1,Y.payload=v,E!=null&&(Y.callback=E),v=Uo(d,Y,W),v!==null&&(Ml(v,d,W,A),Xf(v,d,W))},enqueueForceUpdate:function(d,v){d=d._reactInternals;var E=_s(),A=cd(d),W=zo(E,A);W.tag=2,v!=null&&(W.callback=v),v=Uo(d,W,A),v!==null&&(Ml(v,d,A,E),Xf(v,d,A))}};function ip(d,v,E,A,W,Y,le){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(A,Y,le):v.prototype&&v.prototype.isPureReactComponent?!Bs(E,A)||!Bs(W,Y):!0}function N0(d,v,E){var A=!1,W=Io,Y=v.contextType;return typeof Y=="object"&&Y!==null?Y=Aa(Y):(W=ia(v)?au:Ui.current,A=v.contextTypes,Y=(A=A!=null)?Hu(d,W):Io),v=new v(E,Y),d.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=ad,d.stateNode=v,v._reactInternals=d,A&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=W,d.__reactInternalMemoizedMaskedChildContext=Y),v}function Am(d,v,E,A){d=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(E,A),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(E,A),v.state!==d&&ad.enqueueReplaceState(v,v.state,null)}function ap(d,v,E,A){var W=d.stateNode;W.props=E,W.state=d.memoizedState,W.refs={},Lh(d);var Y=v.contextType;typeof Y=="object"&&Y!==null?W.context=Aa(Y):(Y=ia(v)?au:Ui.current,W.context=Hu(d,Y)),W.state=d.memoizedState,Y=v.getDerivedStateFromProps,typeof Y=="function"&&(nd(d,v,Y,E),W.state=d.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof W.getSnapshotBeforeUpdate=="function"||typeof W.UNSAFE_componentWillMount!="function"&&typeof W.componentWillMount!="function"||(v=W.state,typeof W.componentWillMount=="function"&&W.componentWillMount(),typeof W.UNSAFE_componentWillMount=="function"&&W.UNSAFE_componentWillMount(),v!==W.state&&ad.enqueueReplaceState(W,W.state,null),Kc(d,E,W,A),W.state=d.memoizedState),typeof W.componentDidMount=="function"&&(d.flags|=4194308)}function Ju(d,v){try{var E="",A=v;do E+=se(A),A=A.return;while(A);var W=E}catch(Y){W=`
Error generating stack: `+Y.message+`
`+Y.stack}return{value:d,source:v,stack:W,digest:null}}function sp(d,v,E){return{value:d,source:null,stack:E??null,digest:v??null}}function sd(d,v){try{console.error(v.value)}catch(E){setTimeout(function(){throw E})}}var ub=typeof WeakMap=="function"?WeakMap:Map;function P0(d,v,E){E=zo(-1,E),E.tag=3,E.payload={element:null};var A=v.value;return E.callback=function(){O0||(O0=!0,xb=A),sd(d,v)},E}function x(d,v,E){E=zo(-1,E),E.tag=3;var A=d.type.getDerivedStateFromError;if(typeof A=="function"){var W=v.value;E.payload=function(){return A(W)},E.callback=function(){sd(d,v)}}var Y=d.stateNode;return Y!==null&&typeof Y.componentDidCatch=="function"&&(E.callback=function(){sd(d,v),typeof A!="function"&&(ld===null?ld=new Set([this]):ld.add(this));var le=v.stack;this.componentDidCatch(v.value,{componentStack:le!==null?le:""})}),E}function b(d,v,E){var A=d.pingCache;if(A===null){A=d.pingCache=new ub;var W=new Set;A.set(v,W)}else W=A.get(v),W===void 0&&(W=new Set,A.set(v,W));W.has(E)||(W.add(E),d=PD.bind(null,d,v,E),v.then(d,d))}function M(d){do{var v;if((v=d.tag===13)&&(v=d.memoizedState,v=v!==null?v.dehydrated!==null:!0),v)return d;d=d.return}while(d!==null);return null}function B(d,v,E,A,W){return(d.mode&1)===0?(d===v?d.flags|=65536:(d.flags|=128,E.flags|=131072,E.flags&=-52805,E.tag===1&&(E.alternate===null?E.tag=17:(v=zo(-1,1),v.tag=2,Uo(E,v,1))),E.lanes|=1),d):(d.flags|=65536,d.lanes=W,d)}var $=N.ReactCurrentOwner,ee=!1;function me(d,v,E,A){v.child=d===null?Us(v,null,E,A):Yu(v,d.child,E,A)}function Te(d,v,E,A,W){E=E.render;var Y=v.ref;return _l(v,W),A=Qc(d,v,E,A,Y,W),E=Jc(),d!==null&&!ee?(v.updateQueue=d.updateQueue,v.flags&=-2053,d.lanes&=~W,la(d,v,W)):(Yr&&E&&Hc(v),v.flags|=1,me(d,v,A,W),v.child)}function Ue(d,v,E,A,W){if(d===null){var Y=E.type;return typeof Y=="function"&&!Eb(Y)&&Y.defaultProps===void 0&&E.compare===null&&E.defaultProps===void 0?(v.tag=15,v.type=Y,gt(d,v,Y,A,W)):(d=z0(E.type,null,A,v,v.mode,W),d.ref=v.ref,d.return=v,v.child=d)}if(Y=d.child,(d.lanes&W)===0){var le=Y.memoizedProps;if(E=E.compare,E=E!==null?E:Bs,E(le,A)&&d.ref===v.ref)return la(d,v,W)}return v.flags|=1,d=hd(Y,A),d.ref=v.ref,d.return=v,v.child=d}function gt(d,v,E,A,W){if(d!==null){var Y=d.memoizedProps;if(Bs(Y,A)&&d.ref===v.ref)if(ee=!1,v.pendingProps=A=Y,(d.lanes&W)!==0)(d.flags&131072)!==0&&(ee=!0);else return v.lanes=d.lanes,la(d,v,W)}return Mt(d,v,E,A,W)}function It(d,v,E){var A=v.pendingProps,W=A.children,Y=d!==null?d.memoizedState:null;if(A.mode==="hidden")if((v.mode&1)===0)v.memoizedState={baseLanes:0,cachePool:null,transitions:null},un(lp,po),po|=E;else{if((E&1073741824)===0)return d=Y!==null?Y.baseLanes|E:E,v.lanes=v.childLanes=1073741824,v.memoizedState={baseLanes:d,cachePool:null,transitions:null},v.updateQueue=null,un(lp,po),po|=d,null;v.memoizedState={baseLanes:0,cachePool:null,transitions:null},A=Y!==null?Y.baseLanes:E,un(lp,po),po|=A}else Y!==null?(A=Y.baseLanes|E,v.memoizedState=null):A=E,un(lp,po),po|=A;return me(d,v,W,E),v.child}function ur(d,v){var E=v.ref;(d===null&&E!==null||d!==null&&d.ref!==E)&&(v.flags|=512,v.flags|=2097152)}function Mt(d,v,E,A,W){var Y=ia(E)?au:Ui.current;return Y=Hu(v,Y),_l(v,W),E=Qc(d,v,E,A,Y,W),A=Jc(),d!==null&&!ee?(v.updateQueue=d.updateQueue,v.flags&=-2053,d.lanes&=~W,la(d,v,W)):(Yr&&A&&Hc(v),v.flags|=1,me(d,v,E,W),v.child)}function gn(d,v,E,A,W){if(ia(E)){var Y=!0;Wu(v)}else Y=!1;if(_l(v,W),v.stateNode===null)Or(d,v),N0(v,E,A),ap(v,E,A,W),A=!0;else if(d===null){var le=v.stateNode,be=v.memoizedProps;le.props=be;var _e=le.context,Be=E.contextType;typeof Be=="object"&&Be!==null?Be=Aa(Be):(Be=ia(E)?au:Ui.current,Be=Hu(v,Be));var st=E.getDerivedStateFromProps,ft=typeof st=="function"||typeof le.getSnapshotBeforeUpdate=="function";ft||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(be!==A||_e!==Be)&&Am(v,le,A,Be),Bo=!1;var it=v.memoizedState;le.state=it,Kc(v,A,le,W),_e=v.memoizedState,be!==A||it!==_e||na.current||Bo?(typeof st=="function"&&(nd(v,E,st,A),_e=v.memoizedState),(be=Bo||ip(v,E,be,A,it,_e,Be))?(ft||typeof le.UNSAFE_componentWillMount!="function"&&typeof le.componentWillMount!="function"||(typeof le.componentWillMount=="function"&&le.componentWillMount(),typeof le.UNSAFE_componentWillMount=="function"&&le.UNSAFE_componentWillMount()),typeof le.componentDidMount=="function"&&(v.flags|=4194308)):(typeof le.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=A,v.memoizedState=_e),le.props=A,le.state=_e,le.context=Be,A=be):(typeof le.componentDidMount=="function"&&(v.flags|=4194308),A=!1)}else{le=v.stateNode,Yf(d,v),be=v.memoizedProps,Be=v.type===v.elementType?be:Gi(v.type,be),le.props=Be,ft=v.pendingProps,it=le.context,_e=E.contextType,typeof _e=="object"&&_e!==null?_e=Aa(_e):(_e=ia(E)?au:Ui.current,_e=Hu(v,_e));var Rt=E.getDerivedStateFromProps;(st=typeof Rt=="function"||typeof le.getSnapshotBeforeUpdate=="function")||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(be!==ft||it!==_e)&&Am(v,le,A,_e),Bo=!1,it=v.memoizedState,le.state=it,Kc(v,A,le,W);var Ut=v.memoizedState;be!==ft||it!==Ut||na.current||Bo?(typeof Rt=="function"&&(nd(v,E,Rt,A),Ut=v.memoizedState),(Be=Bo||ip(v,E,Be,A,it,Ut,_e)||!1)?(st||typeof le.UNSAFE_componentWillUpdate!="function"&&typeof le.componentWillUpdate!="function"||(typeof le.componentWillUpdate=="function"&&le.componentWillUpdate(A,Ut,_e),typeof le.UNSAFE_componentWillUpdate=="function"&&le.UNSAFE_componentWillUpdate(A,Ut,_e)),typeof le.componentDidUpdate=="function"&&(v.flags|=4),typeof le.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof le.componentDidUpdate!="function"||be===d.memoizedProps&&it===d.memoizedState||(v.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||be===d.memoizedProps&&it===d.memoizedState||(v.flags|=1024),v.memoizedProps=A,v.memoizedState=Ut),le.props=A,le.state=Ut,le.context=_e,A=Be):(typeof le.componentDidUpdate!="function"||be===d.memoizedProps&&it===d.memoizedState||(v.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||be===d.memoizedProps&&it===d.memoizedState||(v.flags|=1024),A=!1)}return Xr(d,v,E,A,Y,W)}function Xr(d,v,E,A,W,Y){ur(d,v);var le=(v.flags&128)!==0;if(!A&&!le)return W&&v0(v,E,!1),la(d,v,Y);A=v.stateNode,$.current=v;var be=le&&typeof E.getDerivedStateFromError!="function"?null:A.render();return v.flags|=1,d!==null&&le?(v.child=Yu(v,d.child,null,Y),v.child=Yu(v,null,be,Y)):me(d,v,be,Y),v.memoizedState=A.state,W&&v0(v,E,!0),v.child}function Ra(d){var v=d.stateNode;v.pendingContext?xm(d,v.pendingContext,v.pendingContext!==v.context):v.context&&xm(d,v.context,!1),cu(d,v.containerInfo)}function Go(d,v,E,A,W){return Zu(),Ph(W),v.flags|=256,me(d,v,E,A),v.child}var je={dehydrated:null,treeContext:null,retryLane:0};function Pe(d){return{baseLanes:d,cachePool:null,transitions:null}}function He(d,v,E){var A=v.pendingProps,W=mn.current,Y=!1,le=(v.flags&128)!==0,be;if((be=le)||(be=d!==null&&d.memoizedState===null?!1:(W&2)!==0),be?(Y=!0,v.flags&=-129):(d===null||d.memoizedState!==null)&&(W|=1),un(mn,W&1),d===null)return Wc(v),d=v.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((v.mode&1)===0?v.lanes=1:d.data==="$!"?v.lanes=8:v.lanes=1073741824,null):(le=A.children,d=A.fallback,Y?(A=v.mode,Y=v.child,le={mode:"hidden",children:le},(A&1)===0&&Y!==null?(Y.childLanes=0,Y.pendingProps=le):Y=U0(le,A,0,null),d=zh(d,A,E,null),Y.return=v,d.return=v,Y.sibling=d,v.child=Y,v.child.memoizedState=Pe(E),v.memoizedState=je,d):At(v,le));if(W=d.memoizedState,W!==null&&(be=W.dehydrated,be!==null))return mr(d,v,le,A,be,W,E);if(Y){Y=A.fallback,le=v.mode,W=d.child,be=W.sibling;var _e={mode:"hidden",children:A.children};return(le&1)===0&&v.child!==W?(A=v.child,A.childLanes=0,A.pendingProps=_e,v.deletions=null):(A=hd(W,_e),A.subtreeFlags=W.subtreeFlags&14680064),be!==null?Y=hd(be,Y):(Y=zh(Y,le,E,null),Y.flags|=2),Y.return=v,A.return=v,A.sibling=Y,v.child=A,A=Y,Y=v.child,le=d.child.memoizedState,le=le===null?Pe(E):{baseLanes:le.baseLanes|E,cachePool:null,transitions:le.transitions},Y.memoizedState=le,Y.childLanes=d.childLanes&~E,v.memoizedState=je,A}return Y=d.child,d=Y.sibling,A=hd(Y,{mode:"visible",children:A.children}),(v.mode&1)===0&&(A.lanes=E),A.return=v,A.sibling=null,d!==null&&(E=v.deletions,E===null?(v.deletions=[d],v.flags|=16):E.push(d)),v.child=A,v.memoizedState=null,A}function At(d,v){return v=U0({mode:"visible",children:v},d.mode,0,null),v.return=d,d.child=v}function $t(d,v,E,A){return A!==null&&Ph(A),Yu(v,d.child,null,E),d=At(v,v.pendingProps.children),d.flags|=2,v.memoizedState=null,d}function mr(d,v,E,A,W,Y,le){if(E)return v.flags&256?(v.flags&=-257,A=sp(Error(r(422))),$t(d,v,le,A)):v.memoizedState!==null?(v.child=d.child,v.flags|=128,null):(Y=A.fallback,W=v.mode,A=U0({mode:"visible",children:A.children},W,0,null),Y=zh(Y,W,le,null),Y.flags|=2,A.return=v,Y.return=v,A.sibling=Y,v.child=A,(v.mode&1)!==0&&Yu(v,d.child,null,le),v.child.memoizedState=Pe(le),v.memoizedState=je,Y);if((v.mode&1)===0)return $t(d,v,le,null);if(W.data==="$!"){if(A=W.nextSibling&&W.nextSibling.dataset,A)var be=A.dgst;return A=be,Y=Error(r(419)),A=sp(Y,A,void 0),$t(d,v,le,A)}if(be=(le&d.childLanes)!==0,ee||be){if(A=ua,A!==null){switch(le&-le){case 4:W=2;break;case 16:W=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:W=32;break;case 536870912:W=268435456;break;default:W=0}W=(W&(A.suspendedLanes|le))!==0?0:W,W!==0&&W!==Y.retryLane&&(Y.retryLane=W,Ss(d,W),Ml(A,d,W,-1))}return Cb(),A=sp(Error(r(421))),$t(d,v,le,A)}return W.data==="$?"?(v.flags|=128,v.child=d.child,v=MD.bind(null,d),W._reactRetry=v,null):(d=Y.treeContext,St=zs(W.nextSibling),xs=v,Yr=!0,bs=null,d!==null&&(Pa[Ma++]=ys,Pa[Ma++]=Cn,Pa[Ma++]=uu,ys=d.id,Cn=d.overflow,uu=v),v=At(v,A.children),v.flags|=4096,v)}function cr(d,v,E){d.lanes|=v;var A=d.alternate;A!==null&&(A.lanes|=v),Zf(d.return,v,E)}function jr(d,v,E,A,W){var Y=d.memoizedState;Y===null?d.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:A,tail:E,tailMode:W}:(Y.isBackwards=v,Y.rendering=null,Y.renderingStartTime=0,Y.last=A,Y.tail=E,Y.tailMode=W)}function _i(d,v,E){var A=v.pendingProps,W=A.revealOrder,Y=A.tail;if(me(d,v,A.children,E),A=mn.current,(A&2)!==0)A=A&1|2,v.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=v.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&cr(d,E,v);else if(d.tag===19)cr(d,E,v);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===v)break e;for(;d.sibling===null;){if(d.return===null||d.return===v)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}A&=1}if(un(mn,A),(v.mode&1)===0)v.memoizedState=null;else switch(W){case"forwards":for(E=v.child,W=null;E!==null;)d=E.alternate,d!==null&&Yc(d)===null&&(W=E),E=E.sibling;E=W,E===null?(W=v.child,v.child=null):(W=E.sibling,E.sibling=null),jr(v,!1,W,E,Y);break;case"backwards":for(E=null,W=v.child,v.child=null;W!==null;){if(d=W.alternate,d!==null&&Yc(d)===null){v.child=W;break}d=W.sibling,W.sibling=E,E=W,W=d}jr(v,!0,E,null,Y);break;case"together":jr(v,!1,null,null,void 0);break;default:v.memoizedState=null}return v.child}function Or(d,v){(v.mode&1)===0&&d!==null&&(d.alternate=null,v.alternate=null,v.flags|=2)}function la(d,v,E){if(d!==null&&(v.dependencies=d.dependencies),Ih|=v.lanes,(E&v.childLanes)===0)return null;if(d!==null&&v.child!==d.child)throw Error(r(153));if(v.child!==null){for(d=v.child,E=hd(d,d.pendingProps),v.child=E,E.return=v;d.sibling!==null;)d=d.sibling,E=E.sibling=hd(d,d.pendingProps),E.return=v;E.sibling=null}return v.child}function cb(d,v,E){switch(v.tag){case 3:Ra(v),Zu();break;case 5:Zc(v);break;case 1:ia(v.type)&&Wu(v);break;case 4:cu(v,v.stateNode.containerInfo);break;case 10:var A=v.type._context,W=v.memoizedProps.value;un(Mh,A._currentValue),A._currentValue=W;break;case 13:if(A=v.memoizedState,A!==null)return A.dehydrated!==null?(un(mn,mn.current&1),v.flags|=128,null):(E&v.child.childLanes)!==0?He(d,v,E):(un(mn,mn.current&1),d=la(d,v,E),d!==null?d.sibling:null);un(mn,mn.current&1);break;case 19:if(A=(E&v.childLanes)!==0,(d.flags&128)!==0){if(A)return _i(d,v,E);v.flags|=128}if(W=v.memoizedState,W!==null&&(W.rendering=null,W.tail=null,W.lastEffect=null),un(mn,mn.current),A)break;return null;case 22:case 23:return v.lanes=0,It(d,v,E)}return la(d,v,E)}var MC,db,AC,LC;MC=function(d,v){for(var E=v.child;E!==null;){if(E.tag===5||E.tag===6)d.appendChild(E.stateNode);else if(E.tag!==4&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===v)break;for(;E.sibling===null;){if(E.return===null||E.return===v)return;E=E.return}E.sibling.return=E.return,E=E.sibling}},db=function(){},AC=function(d,v,E,A){var W=d.memoizedProps;if(W!==A){d=v.stateNode,Si(cn.current);var Y=null;switch(E){case"input":W=Oe(d,W),A=Oe(d,A),Y=[];break;case"select":W=te({},W,{value:void 0}),A=te({},A,{value:void 0}),Y=[];break;case"textarea":W=ct(d,W),A=ct(d,A),Y=[];break;default:typeof W.onClick!="function"&&typeof A.onClick=="function"&&(d.onclick=Je)}Ee(E,A);var le;E=null;for(Be in W)if(!A.hasOwnProperty(Be)&&W.hasOwnProperty(Be)&&W[Be]!=null)if(Be==="style"){var be=W[Be];for(le in be)be.hasOwnProperty(le)&&(E||(E={}),E[le]="")}else Be!=="dangerouslySetInnerHTML"&&Be!=="children"&&Be!=="suppressContentEditableWarning"&&Be!=="suppressHydrationWarning"&&Be!=="autoFocus"&&(i.hasOwnProperty(Be)?Y||(Y=[]):(Y=Y||[]).push(Be,null));for(Be in A){var _e=A[Be];if(be=W?.[Be],A.hasOwnProperty(Be)&&_e!==be&&(_e!=null||be!=null))if(Be==="style")if(be){for(le in be)!be.hasOwnProperty(le)||_e&&_e.hasOwnProperty(le)||(E||(E={}),E[le]="");for(le in _e)_e.hasOwnProperty(le)&&be[le]!==_e[le]&&(E||(E={}),E[le]=_e[le])}else E||(Y||(Y=[]),Y.push(Be,E)),E=_e;else Be==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,be=be?be.__html:void 0,_e!=null&&be!==_e&&(Y=Y||[]).push(Be,_e)):Be==="children"?typeof _e!="string"&&typeof _e!="number"||(Y=Y||[]).push(Be,""+_e):Be!=="suppressContentEditableWarning"&&Be!=="suppressHydrationWarning"&&(i.hasOwnProperty(Be)?(_e!=null&&Be==="onScroll"&&Kr("scroll",d),Y||be===_e||(Y=[])):(Y=Y||[]).push(Be,_e))}E&&(Y=Y||[]).push("style",E);var Be=Y;(v.updateQueue=Be)&&(v.flags|=4)}},LC=function(d,v,E,A){E!==A&&(v.flags|=4)};function Lm(d,v){if(!Yr)switch(d.tailMode){case"hidden":v=d.tail;for(var E=null;v!==null;)v.alternate!==null&&(E=v),v=v.sibling;E===null?d.tail=null:E.sibling=null;break;case"collapsed":E=d.tail;for(var A=null;E!==null;)E.alternate!==null&&(A=E),E=E.sibling;A===null?v||d.tail===null?d.tail=null:d.tail.sibling=null:A.sibling=null}}function rs(d){var v=d.alternate!==null&&d.alternate.child===d.child,E=0,A=0;if(v)for(var W=d.child;W!==null;)E|=W.lanes|W.childLanes,A|=W.subtreeFlags&14680064,A|=W.flags&14680064,W.return=d,W=W.sibling;else for(W=d.child;W!==null;)E|=W.lanes|W.childLanes,A|=W.subtreeFlags,A|=W.flags,W.return=d,W=W.sibling;return d.subtreeFlags|=A,d.childLanes=E,v}function xD(d,v,E){var A=v.pendingProps;switch(Li(v),v.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return rs(v),null;case 1:return ia(v.type)&&Gc(),rs(v),null;case 3:return A=v.stateNode,Tn(),pn(na),pn(Ui),aa(),A.pendingContext&&(A.context=A.pendingContext,A.pendingContext=null),(d===null||d.child===null)&&(Nh(v)?v.flags|=4:d===null||d.memoizedState.isDehydrated&&(v.flags&256)===0||(v.flags|=1024,bs!==null&&(Sb(bs),bs=null))),db(d,v),rs(v),null;case 5:Cl(v);var W=Si(ei.current);if(E=v.type,d!==null&&v.stateNode!=null)AC(d,v,E,A,W),d.ref!==v.ref&&(v.flags|=512,v.flags|=2097152);else{if(!A){if(v.stateNode===null)throw Error(r(166));return rs(v),null}if(d=Si(cn.current),Nh(v)){A=v.stateNode,E=v.type;var Y=v.memoizedProps;switch(A[es]=v,A[iu]=Y,d=(v.mode&1)!==0,E){case"dialog":Kr("cancel",A),Kr("close",A);break;case"iframe":case"object":case"embed":Kr("load",A);break;case"video":case"audio":for(W=0;W<uo.length;W++)Kr(uo[W],A);break;case"source":Kr("error",A);break;case"img":case"image":case"link":Kr("error",A),Kr("load",A);break;case"details":Kr("toggle",A);break;case"input":Ae(A,Y),Kr("invalid",A);break;case"select":A._wrapperState={wasMultiple:!!Y.multiple},Kr("invalid",A);break;case"textarea":vt(A,Y),Kr("invalid",A)}Ee(E,Y),W=null;for(var le in Y)if(Y.hasOwnProperty(le)){var be=Y[le];le==="children"?typeof be=="string"?A.textContent!==be&&(Y.suppressHydrationWarning!==!0&&Ie(A.textContent,be,d),W=["children",be]):typeof be=="number"&&A.textContent!==""+be&&(Y.suppressHydrationWarning!==!0&&Ie(A.textContent,be,d),W=["children",""+be]):i.hasOwnProperty(le)&&be!=null&&le==="onScroll"&&Kr("scroll",A)}switch(E){case"input":ue(A),dt(A,Y,!0);break;case"textarea":ue(A),Lt(A);break;case"select":case"option":break;default:typeof Y.onClick=="function"&&(A.onclick=Je)}A=W,v.updateQueue=A,A!==null&&(v.flags|=4)}else{le=W.nodeType===9?W:W.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=jt(E)),d==="http://www.w3.org/1999/xhtml"?E==="script"?(d=le.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof A.is=="string"?d=le.createElement(E,{is:A.is}):(d=le.createElement(E),E==="select"&&(le=d,A.multiple?le.multiple=!0:A.size&&(le.size=A.size))):d=le.createElementNS(d,E),d[es]=v,d[iu]=A,MC(d,v,!1,!1),v.stateNode=d;e:{switch(le=Le(E,A),E){case"dialog":Kr("cancel",d),Kr("close",d),W=A;break;case"iframe":case"object":case"embed":Kr("load",d),W=A;break;case"video":case"audio":for(W=0;W<uo.length;W++)Kr(uo[W],d);W=A;break;case"source":Kr("error",d),W=A;break;case"img":case"image":case"link":Kr("error",d),Kr("load",d),W=A;break;case"details":Kr("toggle",d),W=A;break;case"input":Ae(d,A),W=Oe(d,A),Kr("invalid",d);break;case"option":W=A;break;case"select":d._wrapperState={wasMultiple:!!A.multiple},W=te({},A,{value:void 0}),Kr("invalid",d);break;case"textarea":vt(d,A),W=ct(d,A),Kr("invalid",d);break;default:W=A}Ee(E,W),be=W;for(Y in be)if(be.hasOwnProperty(Y)){var _e=be[Y];Y==="style"?ge(d,_e):Y==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,_e!=null&&bt(d,_e)):Y==="children"?typeof _e=="string"?(E!=="textarea"||_e!=="")&&at(d,_e):typeof _e=="number"&&at(d,""+_e):Y!=="suppressContentEditableWarning"&&Y!=="suppressHydrationWarning"&&Y!=="autoFocus"&&(i.hasOwnProperty(Y)?_e!=null&&Y==="onScroll"&&Kr("scroll",d):_e!=null&&T(d,Y,_e,le))}switch(E){case"input":ue(d),dt(d,A,!1);break;case"textarea":ue(d),Lt(d);break;case"option":A.value!=null&&d.setAttribute("value",""+pe(A.value));break;case"select":d.multiple=!!A.multiple,Y=A.value,Y!=null?ht(d,!!A.multiple,Y,!1):A.defaultValue!=null&&ht(d,!!A.multiple,A.defaultValue,!0);break;default:typeof W.onClick=="function"&&(d.onclick=Je)}switch(E){case"button":case"input":case"select":case"textarea":A=!!A.autoFocus;break e;case"img":A=!0;break e;default:A=!1}}A&&(v.flags|=4)}v.ref!==null&&(v.flags|=512,v.flags|=2097152)}return rs(v),null;case 6:if(d&&v.stateNode!=null)LC(d,v,d.memoizedProps,A);else{if(typeof A!="string"&&v.stateNode===null)throw Error(r(166));if(E=Si(ei.current),Si(cn.current),Nh(v)){if(A=v.stateNode,E=v.memoizedProps,A[es]=v,(Y=A.nodeValue!==E)&&(d=xs,d!==null))switch(d.tag){case 3:Ie(A.nodeValue,E,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&Ie(A.nodeValue,E,(d.mode&1)!==0)}Y&&(v.flags|=4)}else A=(E.nodeType===9?E:E.ownerDocument).createTextNode(A),A[es]=v,v.stateNode=A}return rs(v),null;case 13:if(pn(mn),A=v.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(Yr&&St!==null&&(v.mode&1)!==0&&(v.flags&128)===0)wm(),Zu(),v.flags|=98560,Y=!1;else if(Y=Nh(v),A!==null&&A.dehydrated!==null){if(d===null){if(!Y)throw Error(r(318));if(Y=v.memoizedState,Y=Y!==null?Y.dehydrated:null,!Y)throw Error(r(317));Y[es]=v}else Zu(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;rs(v),Y=!1}else bs!==null&&(Sb(bs),bs=null),Y=!0;if(!Y)return v.flags&65536?v:null}return(v.flags&128)!==0?(v.lanes=E,v):(A=A!==null,A!==(d!==null&&d.memoizedState!==null)&&A&&(v.child.flags|=8192,(v.mode&1)!==0&&(d===null||(mn.current&1)!==0?Vi===0&&(Vi=3):Cb())),v.updateQueue!==null&&(v.flags|=4),rs(v),null);case 4:return Tn(),db(d,v),d===null&&Oo(v.stateNode.containerInfo),rs(v),null;case 10:return Kf(v.type._context),rs(v),null;case 17:return ia(v.type)&&Gc(),rs(v),null;case 19:if(pn(mn),Y=v.memoizedState,Y===null)return rs(v),null;if(A=(v.flags&128)!==0,le=Y.rendering,le===null)if(A)Lm(Y,!1);else{if(Vi!==0||d!==null&&(d.flags&128)!==0)for(d=v.child;d!==null;){if(le=Yc(d),le!==null){for(v.flags|=128,Lm(Y,!1),A=le.updateQueue,A!==null&&(v.updateQueue=A,v.flags|=4),v.subtreeFlags=0,A=E,E=v.child;E!==null;)Y=E,d=A,Y.flags&=14680066,le=Y.alternate,le===null?(Y.childLanes=0,Y.lanes=d,Y.child=null,Y.subtreeFlags=0,Y.memoizedProps=null,Y.memoizedState=null,Y.updateQueue=null,Y.dependencies=null,Y.stateNode=null):(Y.childLanes=le.childLanes,Y.lanes=le.lanes,Y.child=le.child,Y.subtreeFlags=0,Y.deletions=null,Y.memoizedProps=le.memoizedProps,Y.memoizedState=le.memoizedState,Y.updateQueue=le.updateQueue,Y.type=le.type,d=le.dependencies,Y.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),E=E.sibling;return un(mn,mn.current&1|2),v.child}d=d.sibling}Y.tail!==null&&on()>up&&(v.flags|=128,A=!0,Lm(Y,!1),v.lanes=4194304)}else{if(!A)if(d=Yc(le),d!==null){if(v.flags|=128,A=!0,E=d.updateQueue,E!==null&&(v.updateQueue=E,v.flags|=4),Lm(Y,!0),Y.tail===null&&Y.tailMode==="hidden"&&!le.alternate&&!Yr)return rs(v),null}else 2*on()-Y.renderingStartTime>up&&E!==1073741824&&(v.flags|=128,A=!0,Lm(Y,!1),v.lanes=4194304);Y.isBackwards?(le.sibling=v.child,v.child=le):(E=Y.last,E!==null?E.sibling=le:v.child=le,Y.last=le)}return Y.tail!==null?(v=Y.tail,Y.rendering=v,Y.tail=v.sibling,Y.renderingStartTime=on(),v.sibling=null,E=mn.current,un(mn,A?E&1|2:E&1),v):(rs(v),null);case 22:case 23:return _b(),A=v.memoizedState!==null,d!==null&&d.memoizedState!==null!==A&&(v.flags|=8192),A&&(v.mode&1)!==0?(po&1073741824)!==0&&(rs(v),v.subtreeFlags&6&&(v.flags|=8192)):rs(v),null;case 24:return null;case 25:return null}throw Error(r(156,v.tag))}function bD(d,v){switch(Li(v),v.tag){case 1:return ia(v.type)&&Gc(),d=v.flags,d&65536?(v.flags=d&-65537|128,v):null;case 3:return Tn(),pn(na),pn(Ui),aa(),d=v.flags,(d&65536)!==0&&(d&128)===0?(v.flags=d&-65537|128,v):null;case 5:return Cl(v),null;case 13:if(pn(mn),d=v.memoizedState,d!==null&&d.dehydrated!==null){if(v.alternate===null)throw Error(r(340));Zu()}return d=v.flags,d&65536?(v.flags=d&-65537|128,v):null;case 19:return pn(mn),null;case 4:return Tn(),null;case 10:return Kf(v.type._context),null;case 22:case 23:return _b(),null;case 24:return null;default:return null}}var M0=!1,ns=!1,wD=typeof WeakSet=="function"?WeakSet:Set,Ft=null;function op(d,v){var E=d.ref;if(E!==null)if(typeof E=="function")try{E(null)}catch(A){ui(d,v,A)}else E.current=null}function hb(d,v,E){try{E()}catch(A){ui(d,v,A)}}var RC=!1;function SD(d,v){if(Tt=Du,d=Un(),eu(d)){if("selectionStart"in d)var E={start:d.selectionStart,end:d.selectionEnd};else e:{E=(E=d.ownerDocument)&&E.defaultView||window;var A=E.getSelection&&E.getSelection();if(A&&A.rangeCount!==0){E=A.anchorNode;var W=A.anchorOffset,Y=A.focusNode;A=A.focusOffset;try{E.nodeType,Y.nodeType}catch{E=null;break e}var le=0,be=-1,_e=-1,Be=0,st=0,ft=d,it=null;t:for(;;){for(var Rt;ft!==E||W!==0&&ft.nodeType!==3||(be=le+W),ft!==Y||A!==0&&ft.nodeType!==3||(_e=le+A),ft.nodeType===3&&(le+=ft.nodeValue.length),(Rt=ft.firstChild)!==null;)it=ft,ft=Rt;for(;;){if(ft===d)break t;if(it===E&&++Be===W&&(be=le),it===Y&&++st===A&&(_e=le),(Rt=ft.nextSibling)!==null)break;ft=it,it=ft.parentNode}ft=Rt}E=be===-1||_e===-1?null:{start:be,end:_e}}else E=null}E=E||{start:0,end:0}}else E=null;for(Xt={focusedElem:d,selectionRange:E},Du=!1,Ft=v;Ft!==null;)if(v=Ft,d=v.child,(v.subtreeFlags&1028)!==0&&d!==null)d.return=v,Ft=d;else for(;Ft!==null;){v=Ft;try{var Ut=v.alternate;if((v.flags&1024)!==0)switch(v.tag){case 0:case 11:case 15:break;case 1:if(Ut!==null){var Wt=Ut.memoizedProps,Ci=Ut.memoizedState,Re=v.stateNode,Ce=Re.getSnapshotBeforeUpdate(v.elementType===v.type?Wt:Gi(v.type,Wt),Ci);Re.__reactInternalSnapshotBeforeUpdate=Ce}break;case 3:var De=v.stateNode.containerInfo;De.nodeType===1?De.textContent="":De.nodeType===9&&De.documentElement&&De.removeChild(De.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(yt){ui(v,v.return,yt)}if(d=v.sibling,d!==null){d.return=v.return,Ft=d;break}Ft=v.return}return Ut=RC,RC=!1,Ut}function Rm(d,v,E){var A=v.updateQueue;if(A=A!==null?A.lastEffect:null,A!==null){var W=A=A.next;do{if((W.tag&d)===d){var Y=W.destroy;W.destroy=void 0,Y!==void 0&&hb(v,E,Y)}W=W.next}while(W!==A)}}function A0(d,v){if(v=v.updateQueue,v=v!==null?v.lastEffect:null,v!==null){var E=v=v.next;do{if((E.tag&d)===d){var A=E.create;E.destroy=A()}E=E.next}while(E!==v)}}function fb(d){var v=d.ref;if(v!==null){var E=d.stateNode;d.tag,d=E,typeof v=="function"?v(d):v.current=d}}function OC(d){var v=d.alternate;v!==null&&(d.alternate=null,OC(v)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(v=d.stateNode,v!==null&&(delete v[es],delete v[iu],delete v[bl],delete v[Bf],delete v[zf])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function DC(d){return d.tag===5||d.tag===3||d.tag===4}function IC(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||DC(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function pb(d,v,E){var A=d.tag;if(A===5||A===6)d=d.stateNode,v?E.nodeType===8?E.parentNode.insertBefore(d,v):E.insertBefore(d,v):(E.nodeType===8?(v=E.parentNode,v.insertBefore(d,E)):(v=E,v.appendChild(d)),E=E._reactRootContainer,E!=null||v.onclick!==null||(v.onclick=Je));else if(A!==4&&(d=d.child,d!==null))for(pb(d,v,E),d=d.sibling;d!==null;)pb(d,v,E),d=d.sibling}function mb(d,v,E){var A=d.tag;if(A===5||A===6)d=d.stateNode,v?E.insertBefore(d,v):E.appendChild(d);else if(A!==4&&(d=d.child,d!==null))for(mb(d,v,E),d=d.sibling;d!==null;)mb(d,v,E),d=d.sibling}var Oa=null,Nl=!1;function od(d,v,E){for(E=E.child;E!==null;)jC(d,v,E),E=E.sibling}function jC(d,v,E){if(nt&&typeof nt.onCommitFiberUnmount=="function")try{nt.onCommitFiberUnmount(Ye,E)}catch{}switch(E.tag){case 5:ns||op(E,v);case 6:var A=Oa,W=Nl;Oa=null,od(d,v,E),Oa=A,Nl=W,Oa!==null&&(Nl?(d=Oa,E=E.stateNode,d.nodeType===8?d.parentNode.removeChild(E):d.removeChild(E)):Oa.removeChild(E.stateNode));break;case 18:Oa!==null&&(Nl?(d=Oa,E=E.stateNode,d.nodeType===8?Uc(d.parentNode,E):d.nodeType===1&&Uc(d,E),Fn(d)):Uc(Oa,E.stateNode));break;case 4:A=Oa,W=Nl,Oa=E.stateNode.containerInfo,Nl=!0,od(d,v,E),Oa=A,Nl=W;break;case 0:case 11:case 14:case 15:if(!ns&&(A=E.updateQueue,A!==null&&(A=A.lastEffect,A!==null))){W=A=A.next;do{var Y=W,le=Y.destroy;Y=Y.tag,le!==void 0&&((Y&2)!==0||(Y&4)!==0)&&hb(E,v,le),W=W.next}while(W!==A)}od(d,v,E);break;case 1:if(!ns&&(op(E,v),A=E.stateNode,typeof A.componentWillUnmount=="function"))try{A.props=E.memoizedProps,A.state=E.memoizedState,A.componentWillUnmount()}catch(be){ui(E,v,be)}od(d,v,E);break;case 21:od(d,v,E);break;case 22:E.mode&1?(ns=(A=ns)||E.memoizedState!==null,od(d,v,E),ns=A):od(d,v,E);break;default:od(d,v,E)}}function FC(d){var v=d.updateQueue;if(v!==null){d.updateQueue=null;var E=d.stateNode;E===null&&(E=d.stateNode=new wD),v.forEach(function(A){var W=AD.bind(null,d,A);E.has(A)||(E.add(A),A.then(W,W))})}}function Pl(d,v){var E=v.deletions;if(E!==null)for(var A=0;A<E.length;A++){var W=E[A];try{var Y=d,le=v,be=le;e:for(;be!==null;){switch(be.tag){case 5:Oa=be.stateNode,Nl=!1;break e;case 3:Oa=be.stateNode.containerInfo,Nl=!0;break e;case 4:Oa=be.stateNode.containerInfo,Nl=!0;break e}be=be.return}if(Oa===null)throw Error(r(160));jC(Y,le,W),Oa=null,Nl=!1;var _e=W.alternate;_e!==null&&(_e.return=null),W.return=null}catch(Be){ui(W,v,Be)}}if(v.subtreeFlags&12854)for(v=v.child;v!==null;)BC(v,d),v=v.sibling}function BC(d,v){var E=d.alternate,A=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(Pl(v,d),mu(d),A&4){try{Rm(3,d,d.return),A0(3,d)}catch(Wt){ui(d,d.return,Wt)}try{Rm(5,d,d.return)}catch(Wt){ui(d,d.return,Wt)}}break;case 1:Pl(v,d),mu(d),A&512&&E!==null&&op(E,E.return);break;case 5:if(Pl(v,d),mu(d),A&512&&E!==null&&op(E,E.return),d.flags&32){var W=d.stateNode;try{at(W,"")}catch(Wt){ui(d,d.return,Wt)}}if(A&4&&(W=d.stateNode,W!=null)){var Y=d.memoizedProps,le=E!==null?E.memoizedProps:Y,be=d.type,_e=d.updateQueue;if(d.updateQueue=null,_e!==null)try{be==="input"&&Y.type==="radio"&&Y.name!=null&&tt(W,Y),Le(be,le);var Be=Le(be,Y);for(le=0;le<_e.length;le+=2){var st=_e[le],ft=_e[le+1];st==="style"?ge(W,ft):st==="dangerouslySetInnerHTML"?bt(W,ft):st==="children"?at(W,ft):T(W,st,ft,Be)}switch(be){case"input":rt(W,Y);break;case"textarea":lt(W,Y);break;case"select":var it=W._wrapperState.wasMultiple;W._wrapperState.wasMultiple=!!Y.multiple;var Rt=Y.value;Rt!=null?ht(W,!!Y.multiple,Rt,!1):it!==!!Y.multiple&&(Y.defaultValue!=null?ht(W,!!Y.multiple,Y.defaultValue,!0):ht(W,!!Y.multiple,Y.multiple?[]:"",!1))}W[iu]=Y}catch(Wt){ui(d,d.return,Wt)}}break;case 6:if(Pl(v,d),mu(d),A&4){if(d.stateNode===null)throw Error(r(162));W=d.stateNode,Y=d.memoizedProps;try{W.nodeValue=Y}catch(Wt){ui(d,d.return,Wt)}}break;case 3:if(Pl(v,d),mu(d),A&4&&E!==null&&E.memoizedState.isDehydrated)try{Fn(v.containerInfo)}catch(Wt){ui(d,d.return,Wt)}break;case 4:Pl(v,d),mu(d);break;case 13:Pl(v,d),mu(d),W=d.child,W.flags&8192&&(Y=W.memoizedState!==null,W.stateNode.isHidden=Y,!Y||W.alternate!==null&&W.alternate.memoizedState!==null||(yb=on())),A&4&&FC(d);break;case 22:if(st=E!==null&&E.memoizedState!==null,d.mode&1?(ns=(Be=ns)||st,Pl(v,d),ns=Be):Pl(v,d),mu(d),A&8192){if(Be=d.memoizedState!==null,(d.stateNode.isHidden=Be)&&!st&&(d.mode&1)!==0)for(Ft=d,st=d.child;st!==null;){for(ft=Ft=st;Ft!==null;){switch(it=Ft,Rt=it.child,it.tag){case 0:case 11:case 14:case 15:Rm(4,it,it.return);break;case 1:op(it,it.return);var Ut=it.stateNode;if(typeof Ut.componentWillUnmount=="function"){A=it,E=it.return;try{v=A,Ut.props=v.memoizedProps,Ut.state=v.memoizedState,Ut.componentWillUnmount()}catch(Wt){ui(A,E,Wt)}}break;case 5:op(it,it.return);break;case 22:if(it.memoizedState!==null){GC(ft);continue}}Rt!==null?(Rt.return=it,Ft=Rt):GC(ft)}st=st.sibling}e:for(st=null,ft=d;;){if(ft.tag===5){if(st===null){st=ft;try{W=ft.stateNode,Be?(Y=W.style,typeof Y.setProperty=="function"?Y.setProperty("display","none","important"):Y.display="none"):(be=ft.stateNode,_e=ft.memoizedProps.style,le=_e!=null&&_e.hasOwnProperty("display")?_e.display:null,be.style.display=de("display",le))}catch(Wt){ui(d,d.return,Wt)}}}else if(ft.tag===6){if(st===null)try{ft.stateNode.nodeValue=Be?"":ft.memoizedProps}catch(Wt){ui(d,d.return,Wt)}}else if((ft.tag!==22&&ft.tag!==23||ft.memoizedState===null||ft===d)&&ft.child!==null){ft.child.return=ft,ft=ft.child;continue}if(ft===d)break e;for(;ft.sibling===null;){if(ft.return===null||ft.return===d)break e;st===ft&&(st=null),ft=ft.return}st===ft&&(st=null),ft.sibling.return=ft.return,ft=ft.sibling}}break;case 19:Pl(v,d),mu(d),A&4&&FC(d);break;case 21:break;default:Pl(v,d),mu(d)}}function mu(d){var v=d.flags;if(v&2){try{e:{for(var E=d.return;E!==null;){if(DC(E)){var A=E;break e}E=E.return}throw Error(r(160))}switch(A.tag){case 5:var W=A.stateNode;A.flags&32&&(at(W,""),A.flags&=-33);var Y=IC(d);mb(d,Y,W);break;case 3:case 4:var le=A.stateNode.containerInfo,be=IC(d);pb(d,be,le);break;default:throw Error(r(161))}}catch(_e){ui(d,d.return,_e)}d.flags&=-3}v&4096&&(d.flags&=-4097)}function kD(d,v,E){Ft=d,zC(d)}function zC(d,v,E){for(var A=(d.mode&1)!==0;Ft!==null;){var W=Ft,Y=W.child;if(W.tag===22&&A){var le=W.memoizedState!==null||M0;if(!le){var be=W.alternate,_e=be!==null&&be.memoizedState!==null||ns;be=M0;var Be=ns;if(M0=le,(ns=_e)&&!Be)for(Ft=W;Ft!==null;)le=Ft,_e=le.child,le.tag===22&&le.memoizedState!==null?VC(W):_e!==null?(_e.return=le,Ft=_e):VC(W);for(;Y!==null;)Ft=Y,zC(Y),Y=Y.sibling;Ft=W,M0=be,ns=Be}UC(d)}else(W.subtreeFlags&8772)!==0&&Y!==null?(Y.return=W,Ft=Y):UC(d)}}function UC(d){for(;Ft!==null;){var v=Ft;if((v.flags&8772)!==0){var E=v.alternate;try{if((v.flags&8772)!==0)switch(v.tag){case 0:case 11:case 15:ns||A0(5,v);break;case 1:var A=v.stateNode;if(v.flags&4&&!ns)if(E===null)A.componentDidMount();else{var W=v.elementType===v.type?E.memoizedProps:Gi(v.type,E.memoizedProps);A.componentDidUpdate(W,E.memoizedState,A.__reactInternalSnapshotBeforeUpdate)}var Y=v.updateQueue;Y!==null&&Hn(v,Y,A);break;case 3:var le=v.updateQueue;if(le!==null){if(E=null,v.child!==null)switch(v.child.tag){case 5:E=v.child.stateNode;break;case 1:E=v.child.stateNode}Hn(v,le,E)}break;case 5:var be=v.stateNode;if(E===null&&v.flags&4){E=be;var _e=v.memoizedProps;switch(v.type){case"button":case"input":case"select":case"textarea":_e.autoFocus&&E.focus();break;case"img":_e.src&&(E.src=_e.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(v.memoizedState===null){var Be=v.alternate;if(Be!==null){var st=Be.memoizedState;if(st!==null){var ft=st.dehydrated;ft!==null&&Fn(ft)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}ns||v.flags&512&&fb(v)}catch(it){ui(v,v.return,it)}}if(v===d){Ft=null;break}if(E=v.sibling,E!==null){E.return=v.return,Ft=E;break}Ft=v.return}}function GC(d){for(;Ft!==null;){var v=Ft;if(v===d){Ft=null;break}var E=v.sibling;if(E!==null){E.return=v.return,Ft=E;break}Ft=v.return}}function VC(d){for(;Ft!==null;){var v=Ft;try{switch(v.tag){case 0:case 11:case 15:var E=v.return;try{A0(4,v)}catch(_e){ui(v,E,_e)}break;case 1:var A=v.stateNode;if(typeof A.componentDidMount=="function"){var W=v.return;try{A.componentDidMount()}catch(_e){ui(v,W,_e)}}var Y=v.return;try{fb(v)}catch(_e){ui(v,Y,_e)}break;case 5:var le=v.return;try{fb(v)}catch(_e){ui(v,le,_e)}}}catch(_e){ui(v,v.return,_e)}if(v===d){Ft=null;break}var be=v.sibling;if(be!==null){be.return=v.return,Ft=be;break}Ft=v.return}}var _D=Math.ceil,L0=N.ReactCurrentDispatcher,gb=N.ReactCurrentOwner,Vo=N.ReactCurrentBatchConfig,Ur=0,ua=null,Ri=null,Da=0,po=0,lp=Sl(0),Vi=0,Om=null,Ih=0,R0=0,vb=0,Dm=null,Vs=null,yb=0,up=1/0,ec=null,O0=!1,xb=null,ld=null,D0=!1,ud=null,I0=0,Im=0,bb=null,j0=-1,F0=0;function _s(){return(Ur&6)!==0?on():j0!==-1?j0:j0=on()}function cd(d){return(d.mode&1)===0?1:(Ur&2)!==0&&Da!==0?Da&-Da:Sm.transition!==null?(F0===0&&(F0=Rr()),F0):(d=xr,d!==0||(d=window.event,d=d===void 0?16:Cr(d.type)),d)}function Ml(d,v,E,A){if(50<Im)throw Im=0,bb=null,Error(r(185));en(d,E,A),((Ur&2)===0||d!==ua)&&(d===ua&&((Ur&2)===0&&(R0|=E),Vi===4&&dd(d,Da)),Hs(d,A),E===1&&Ur===0&&(v.mode&1)===0&&(up=on()+500,Vc&&su()))}function Hs(d,v){var E=d.callbackNode;Jt(d,v);var A=Ir(d,d===ua?Da:0);if(A===0)E!==null&&qa(E),d.callbackNode=null,d.callbackPriority=0;else if(v=A&-A,d.callbackPriority!==v){if(E!=null&&qa(E),v===1)d.tag===0?kl(WC.bind(null,d)):Th(WC.bind(null,d)),zi(function(){(Ur&6)===0&&su()}),E=null;else{switch(ao(A)){case 1:E=hs;break;case 4:E=ro;break;case 16:E=Yi;break;case 536870912:E=Ge;break;default:E=Yi}E=JC(E,HC.bind(null,d))}d.callbackPriority=v,d.callbackNode=E}}function HC(d,v){if(j0=-1,F0=0,(Ur&6)!==0)throw Error(r(327));var E=d.callbackNode;if(cp()&&d.callbackNode!==E)return null;var A=Ir(d,d===ua?Da:0);if(A===0)return null;if((A&30)!==0||(A&d.expiredLanes)!==0||v)v=B0(d,A);else{v=A;var W=Ur;Ur|=2;var Y=$C();(ua!==d||Da!==v)&&(ec=null,up=on()+500,Fh(d,v));do try{TD();break}catch(be){qC(d,be)}while(!0);$f(),L0.current=Y,Ur=W,Ri!==null?v=0:(ua=null,Da=0,v=Vi)}if(v!==0){if(v===2&&(W=tr(d),W!==0&&(A=W,v=wb(d,W))),v===1)throw E=Om,Fh(d,0),dd(d,A),Hs(d,on()),E;if(v===6)dd(d,A);else{if(W=d.current.alternate,(A&30)===0&&!CD(W)&&(v=B0(d,A),v===2&&(Y=tr(d),Y!==0&&(A=Y,v=wb(d,Y))),v===1))throw E=Om,Fh(d,0),dd(d,A),Hs(d,on()),E;switch(d.finishedWork=W,d.finishedLanes=A,v){case 0:case 1:throw Error(r(345));case 2:Bh(d,Vs,ec);break;case 3:if(dd(d,A),(A&130023424)===A&&(v=yb+500-on(),10<v)){if(Ir(d,0)!==0)break;if(W=d.suspendedLanes,(W&A)!==A){_s(),d.pingedLanes|=d.suspendedLanes&W;break}d.timeoutHandle=Zr(Bh.bind(null,d,Vs,ec),v);break}Bh(d,Vs,ec);break;case 4:if(dd(d,A),(A&4194240)===A)break;for(v=d.eventTimes,W=-1;0<A;){var le=31-Ze(A);Y=1<<le,le=v[le],le>W&&(W=le),A&=~Y}if(A=W,A=on()-A,A=(120>A?120:480>A?480:1080>A?1080:1920>A?1920:3e3>A?3e3:4320>A?4320:1960*_D(A/1960))-A,10<A){d.timeoutHandle=Zr(Bh.bind(null,d,Vs,ec),A);break}Bh(d,Vs,ec);break;case 5:Bh(d,Vs,ec);break;default:throw Error(r(329))}}}return Hs(d,on()),d.callbackNode===E?HC.bind(null,d):null}function wb(d,v){var E=Dm;return d.current.memoizedState.isDehydrated&&(Fh(d,v).flags|=256),d=B0(d,v),d!==2&&(v=Vs,Vs=E,v!==null&&Sb(v)),d}function Sb(d){Vs===null?Vs=d:Vs.push.apply(Vs,d)}function CD(d){for(var v=d;;){if(v.flags&16384){var E=v.updateQueue;if(E!==null&&(E=E.stores,E!==null))for(var A=0;A<E.length;A++){var W=E[A],Y=W.getSnapshot;W=W.value;try{if(!ta(Y(),W))return!1}catch{return!1}}}if(E=v.child,v.subtreeFlags&16384&&E!==null)E.return=v,v=E;else{if(v===d)break;for(;v.sibling===null;){if(v.return===null||v.return===d)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function dd(d,v){for(v&=~vb,v&=~R0,d.suspendedLanes|=v,d.pingedLanes&=~v,d=d.expirationTimes;0<v;){var E=31-Ze(v),A=1<<E;d[E]=-1,v&=~A}}function WC(d){if((Ur&6)!==0)throw Error(r(327));cp();var v=Ir(d,0);if((v&1)===0)return Hs(d,on()),null;var E=B0(d,v);if(d.tag!==0&&E===2){var A=tr(d);A!==0&&(v=A,E=wb(d,A))}if(E===1)throw E=Om,Fh(d,0),dd(d,v),Hs(d,on()),E;if(E===6)throw Error(r(345));return d.finishedWork=d.current.alternate,d.finishedLanes=v,Bh(d,Vs,ec),Hs(d,on()),null}function kb(d,v){var E=Ur;Ur|=1;try{return d(v)}finally{Ur=E,Ur===0&&(up=on()+500,Vc&&su())}}function jh(d){ud!==null&&ud.tag===0&&(Ur&6)===0&&cp();var v=Ur;Ur|=1;var E=Vo.transition,A=xr;try{if(Vo.transition=null,xr=1,d)return d()}finally{xr=A,Vo.transition=E,Ur=v,(Ur&6)===0&&su()}}function _b(){po=lp.current,pn(lp)}function Fh(d,v){d.finishedWork=null,d.finishedLanes=0;var E=d.timeoutHandle;if(E!==-1&&(d.timeoutHandle=-1,Gn(E)),Ri!==null)for(E=Ri.return;E!==null;){var A=E;switch(Li(A),A.tag){case 1:A=A.type.childContextTypes,A!=null&&Gc();break;case 3:Tn(),pn(na),pn(Ui),aa();break;case 5:Cl(A);break;case 4:Tn();break;case 13:pn(mn);break;case 19:pn(mn);break;case 10:Kf(A.type._context);break;case 22:case 23:_b()}E=E.return}if(ua=d,Ri=d=hd(d.current,null),Da=po=v,Vi=0,Om=null,vb=R0=Ih=0,Vs=Dm=null,Fo!==null){for(v=0;v<Fo.length;v++)if(E=Fo[v],A=E.interleaved,A!==null){E.interleaved=null;var W=A.next,Y=E.pending;if(Y!==null){var le=Y.next;Y.next=W,A.next=le}E.pending=A}Fo=null}return d}function qC(d,v){do{var E=Ri;try{if($f(),Xc.current=rd,fo){for(var A=rn.memoizedState;A!==null;){var W=A.queue;W!==null&&(W.pending=null),A=A.next}fo=!1}if(La=0,oi=Wn=rn=null,du=!1,Gs=0,gb.current=null,E===null||E.return===null){Vi=1,Om=v,Ri=null;break}e:{var Y=d,le=E.return,be=E,_e=v;if(v=Da,be.flags|=32768,_e!==null&&typeof _e=="object"&&typeof _e.then=="function"){var Be=_e,st=be,ft=st.tag;if((st.mode&1)===0&&(ft===0||ft===11||ft===15)){var it=st.alternate;it?(st.updateQueue=it.updateQueue,st.memoizedState=it.memoizedState,st.lanes=it.lanes):(st.updateQueue=null,st.memoizedState=null)}var Rt=M(le);if(Rt!==null){Rt.flags&=-257,B(Rt,le,be,Y,v),Rt.mode&1&&b(Y,Be,v),v=Rt,_e=Be;var Ut=v.updateQueue;if(Ut===null){var Wt=new Set;Wt.add(_e),v.updateQueue=Wt}else Ut.add(_e);break e}else{if((v&1)===0){b(Y,Be,v),Cb();break e}_e=Error(r(426))}}else if(Yr&&be.mode&1){var Ci=M(le);if(Ci!==null){(Ci.flags&65536)===0&&(Ci.flags|=256),B(Ci,le,be,Y,v),Ph(Ju(_e,be));break e}}Y=_e=Ju(_e,be),Vi!==4&&(Vi=2),Dm===null?Dm=[Y]:Dm.push(Y),Y=le;do{switch(Y.tag){case 3:Y.flags|=65536,v&=-v,Y.lanes|=v;var Re=P0(Y,_e,v);Rh(Y,Re);break e;case 1:be=_e;var Ce=Y.type,De=Y.stateNode;if((Y.flags&128)===0&&(typeof Ce.getDerivedStateFromError=="function"||De!==null&&typeof De.componentDidCatch=="function"&&(ld===null||!ld.has(De)))){Y.flags|=65536,v&=-v,Y.lanes|=v;var yt=x(Y,be,v);Rh(Y,yt);break e}}Y=Y.return}while(Y!==null)}ZC(E)}catch(qt){v=qt,Ri===E&&E!==null&&(Ri=E=E.return);continue}break}while(!0)}function $C(){var d=L0.current;return L0.current=rd,d===null?rd:d}function Cb(){(Vi===0||Vi===3||Vi===2)&&(Vi=4),ua===null||(Ih&268435455)===0&&(R0&268435455)===0||dd(ua,Da)}function B0(d,v){var E=Ur;Ur|=2;var A=$C();(ua!==d||Da!==v)&&(ec=null,Fh(d,v));do try{ED();break}catch(W){qC(d,W)}while(!0);if($f(),Ur=E,L0.current=A,Ri!==null)throw Error(r(261));return ua=null,Da=0,Vi}function ED(){for(;Ri!==null;)KC(Ri)}function TD(){for(;Ri!==null&&!Ru();)KC(Ri)}function KC(d){var v=QC(d.alternate,d,po);d.memoizedProps=d.pendingProps,v===null?ZC(d):Ri=v,gb.current=null}function ZC(d){var v=d;do{var E=v.alternate;if(d=v.return,(v.flags&32768)===0){if(E=xD(E,v,po),E!==null){Ri=E;return}}else{if(E=bD(E,v),E!==null){E.flags&=32767,Ri=E;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{Vi=6,Ri=null;return}}if(v=v.sibling,v!==null){Ri=v;return}Ri=v=d}while(v!==null);Vi===0&&(Vi=5)}function Bh(d,v,E){var A=xr,W=Vo.transition;try{Vo.transition=null,xr=1,ND(d,v,E,A)}finally{Vo.transition=W,xr=A}return null}function ND(d,v,E,A){do cp();while(ud!==null);if((Ur&6)!==0)throw Error(r(327));E=d.finishedWork;var W=d.finishedLanes;if(E===null)return null;if(d.finishedWork=null,d.finishedLanes=0,E===d.current)throw Error(r(177));d.callbackNode=null,d.callbackPriority=0;var Y=E.lanes|E.childLanes;if(yn(d,Y),d===ua&&(Ri=ua=null,Da=0),(E.subtreeFlags&2064)===0&&(E.flags&2064)===0||D0||(D0=!0,JC(Yi,function(){return cp(),null})),Y=(E.flags&15990)!==0,(E.subtreeFlags&15990)!==0||Y){Y=Vo.transition,Vo.transition=null;var le=xr;xr=1;var be=Ur;Ur|=4,gb.current=null,SD(d,E),BC(E,d),ra(Xt),Du=!!Tt,Xt=Tt=null,d.current=E,kD(E),_o(),Ur=be,xr=le,Vo.transition=Y}else d.current=E;if(D0&&(D0=!1,ud=d,I0=W),Y=d.pendingLanes,Y===0&&(ld=null),pt(E.stateNode),Hs(d,on()),v!==null)for(A=d.onRecoverableError,E=0;E<v.length;E++)W=v[E],A(W.value,{componentStack:W.stack,digest:W.digest});if(O0)throw O0=!1,d=xb,xb=null,d;return(I0&1)!==0&&d.tag!==0&&cp(),Y=d.pendingLanes,(Y&1)!==0?d===bb?Im++:(Im=0,bb=d):Im=0,su(),null}function cp(){if(ud!==null){var d=ao(I0),v=Vo.transition,E=xr;try{if(Vo.transition=null,xr=16>d?16:d,ud===null)var A=!1;else{if(d=ud,ud=null,I0=0,(Ur&6)!==0)throw Error(r(331));var W=Ur;for(Ur|=4,Ft=d.current;Ft!==null;){var Y=Ft,le=Y.child;if((Ft.flags&16)!==0){var be=Y.deletions;if(be!==null){for(var _e=0;_e<be.length;_e++){var Be=be[_e];for(Ft=Be;Ft!==null;){var st=Ft;switch(st.tag){case 0:case 11:case 15:Rm(8,st,Y)}var ft=st.child;if(ft!==null)ft.return=st,Ft=ft;else for(;Ft!==null;){st=Ft;var it=st.sibling,Rt=st.return;if(OC(st),st===Be){Ft=null;break}if(it!==null){it.return=Rt,Ft=it;break}Ft=Rt}}}var Ut=Y.alternate;if(Ut!==null){var Wt=Ut.child;if(Wt!==null){Ut.child=null;do{var Ci=Wt.sibling;Wt.sibling=null,Wt=Ci}while(Wt!==null)}}Ft=Y}}if((Y.subtreeFlags&2064)!==0&&le!==null)le.return=Y,Ft=le;else e:for(;Ft!==null;){if(Y=Ft,(Y.flags&2048)!==0)switch(Y.tag){case 0:case 11:case 15:Rm(9,Y,Y.return)}var Re=Y.sibling;if(Re!==null){Re.return=Y.return,Ft=Re;break e}Ft=Y.return}}var Ce=d.current;for(Ft=Ce;Ft!==null;){le=Ft;var De=le.child;if((le.subtreeFlags&2064)!==0&&De!==null)De.return=le,Ft=De;else e:for(le=Ce;Ft!==null;){if(be=Ft,(be.flags&2048)!==0)try{switch(be.tag){case 0:case 11:case 15:A0(9,be)}}catch(qt){ui(be,be.return,qt)}if(be===le){Ft=null;break e}var yt=be.sibling;if(yt!==null){yt.return=be.return,Ft=yt;break e}Ft=be.return}}if(Ur=W,su(),nt&&typeof nt.onPostCommitFiberRoot=="function")try{nt.onPostCommitFiberRoot(Ye,d)}catch{}A=!0}return A}finally{xr=E,Vo.transition=v}}return!1}function YC(d,v,E){v=Ju(E,v),v=P0(d,v,1),d=Uo(d,v,1),v=_s(),d!==null&&(en(d,1,v),Hs(d,v))}function ui(d,v,E){if(d.tag===3)YC(d,d,E);else for(;v!==null;){if(v.tag===3){YC(v,d,E);break}else if(v.tag===1){var A=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(ld===null||!ld.has(A))){d=Ju(E,d),d=x(v,d,1),v=Uo(v,d,1),d=_s(),v!==null&&(en(v,1,d),Hs(v,d));break}}v=v.return}}function PD(d,v,E){var A=d.pingCache;A!==null&&A.delete(v),v=_s(),d.pingedLanes|=d.suspendedLanes&E,ua===d&&(Da&E)===E&&(Vi===4||Vi===3&&(Da&130023424)===Da&&500>on()-yb?Fh(d,0):vb|=E),Hs(d,v)}function XC(d,v){v===0&&((d.mode&1)===0?v=1:(v=vi,vi<<=1,(vi&130023424)===0&&(vi=4194304)));var E=_s();d=Ss(d,v),d!==null&&(en(d,v,E),Hs(d,E))}function MD(d){var v=d.memoizedState,E=0;v!==null&&(E=v.retryLane),XC(d,E)}function AD(d,v){var E=0;switch(d.tag){case 13:var A=d.stateNode,W=d.memoizedState;W!==null&&(E=W.retryLane);break;case 19:A=d.stateNode;break;default:throw Error(r(314))}A!==null&&A.delete(v),XC(d,E)}var QC;QC=function(d,v,E){if(d!==null)if(d.memoizedProps!==v.pendingProps||na.current)ee=!0;else{if((d.lanes&E)===0&&(v.flags&128)===0)return ee=!1,cb(d,v,E);ee=(d.flags&131072)!==0}else ee=!1,Yr&&(v.flags&1048576)!==0&&y0(v,lu,v.index);switch(v.lanes=0,v.tag){case 2:var A=v.type;Or(d,v),d=v.pendingProps;var W=Hu(v,Ui.current);_l(v,E),W=Qc(null,v,A,d,W,E);var Y=Jc();return v.flags|=1,typeof W=="object"&&W!==null&&typeof W.render=="function"&&W.$$typeof===void 0?(v.tag=1,v.memoizedState=null,v.updateQueue=null,ia(A)?(Y=!0,Wu(v)):Y=!1,v.memoizedState=W.state!==null&&W.state!==void 0?W.state:null,Lh(v),W.updater=ad,v.stateNode=W,W._reactInternals=v,ap(v,A,d,E),v=Xr(null,v,A,!0,Y,E)):(v.tag=0,Yr&&Y&&Hc(v),me(null,v,W,E),v=v.child),v;case 16:A=v.elementType;e:{switch(Or(d,v),d=v.pendingProps,W=A._init,A=W(A._payload),v.type=A,W=v.tag=RD(A),d=Gi(A,d),W){case 0:v=Mt(null,v,A,d,E);break e;case 1:v=gn(null,v,A,d,E);break e;case 11:v=Te(null,v,A,d,E);break e;case 14:v=Ue(null,v,A,Gi(A.type,d),E);break e}throw Error(r(306,A,""))}return v;case 0:return A=v.type,W=v.pendingProps,W=v.elementType===A?W:Gi(A,W),Mt(d,v,A,W,E);case 1:return A=v.type,W=v.pendingProps,W=v.elementType===A?W:Gi(A,W),gn(d,v,A,W,E);case 3:e:{if(Ra(v),d===null)throw Error(r(387));A=v.pendingProps,Y=v.memoizedState,W=Y.element,Yf(d,v),Kc(v,A,null,E);var le=v.memoizedState;if(A=le.element,Y.isDehydrated)if(Y={element:A,isDehydrated:!1,cache:le.cache,pendingSuspenseBoundaries:le.pendingSuspenseBoundaries,transitions:le.transitions},v.updateQueue.baseState=Y,v.memoizedState=Y,v.flags&256){W=Ju(Error(r(423)),v),v=Go(d,v,A,E,W);break e}else if(A!==W){W=Ju(Error(r(424)),v),v=Go(d,v,A,E,W);break e}else for(St=zs(v.stateNode.containerInfo.firstChild),xs=v,Yr=!0,bs=null,E=Us(v,null,A,E),v.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if(Zu(),A===W){v=la(d,v,E);break e}me(d,v,A,E)}v=v.child}return v;case 5:return Zc(v),d===null&&Wc(v),A=v.type,W=v.pendingProps,Y=d!==null?d.memoizedProps:null,le=W.children,hr(A,W)?le=null:Y!==null&&hr(A,Y)&&(v.flags|=32),ur(d,v),me(d,v,le,E),v.child;case 6:return d===null&&Wc(v),null;case 13:return He(d,v,E);case 4:return cu(v,v.stateNode.containerInfo),A=v.pendingProps,d===null?v.child=Yu(v,null,A,E):me(d,v,A,E),v.child;case 11:return A=v.type,W=v.pendingProps,W=v.elementType===A?W:Gi(A,W),Te(d,v,A,W,E);case 7:return me(d,v,v.pendingProps,E),v.child;case 8:return me(d,v,v.pendingProps.children,E),v.child;case 12:return me(d,v,v.pendingProps.children,E),v.child;case 10:e:{if(A=v.type._context,W=v.pendingProps,Y=v.memoizedProps,le=W.value,un(Mh,A._currentValue),A._currentValue=le,Y!==null)if(ta(Y.value,le)){if(Y.children===W.children&&!na.current){v=la(d,v,E);break e}}else for(Y=v.child,Y!==null&&(Y.return=v);Y!==null;){var be=Y.dependencies;if(be!==null){le=Y.child;for(var _e=be.firstContext;_e!==null;){if(_e.context===A){if(Y.tag===1){_e=zo(-1,E&-E),_e.tag=2;var Be=Y.updateQueue;if(Be!==null){Be=Be.shared;var st=Be.pending;st===null?_e.next=_e:(_e.next=st.next,st.next=_e),Be.pending=_e}}Y.lanes|=E,_e=Y.alternate,_e!==null&&(_e.lanes|=E),Zf(Y.return,E,v),be.lanes|=E;break}_e=_e.next}}else if(Y.tag===10)le=Y.type===v.type?null:Y.child;else if(Y.tag===18){if(le=Y.return,le===null)throw Error(r(341));le.lanes|=E,be=le.alternate,be!==null&&(be.lanes|=E),Zf(le,E,v),le=Y.sibling}else le=Y.child;if(le!==null)le.return=Y;else for(le=Y;le!==null;){if(le===v){le=null;break}if(Y=le.sibling,Y!==null){Y.return=le.return,le=Y;break}le=le.return}Y=le}me(d,v,W.children,E),v=v.child}return v;case 9:return W=v.type,A=v.pendingProps.children,_l(v,E),W=Aa(W),A=A(W),v.flags|=1,me(d,v,A,E),v.child;case 14:return A=v.type,W=Gi(A,v.pendingProps),W=Gi(A.type,W),Ue(d,v,A,W,E);case 15:return gt(d,v,v.type,v.pendingProps,E);case 17:return A=v.type,W=v.pendingProps,W=v.elementType===A?W:Gi(A,W),Or(d,v),v.tag=1,ia(A)?(d=!0,Wu(v)):d=!1,_l(v,E),N0(v,A,W),ap(v,A,W,E),Xr(null,v,A,!0,d,E);case 19:return _i(d,v,E);case 22:return It(d,v,E)}throw Error(r(156,v.tag))};function JC(d,v){return ko(d,v)}function LD(d,v,E,A){this.tag=d,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ho(d,v,E,A){return new LD(d,v,E,A)}function Eb(d){return d=d.prototype,!(!d||!d.isReactComponent)}function RD(d){if(typeof d=="function")return Eb(d)?1:0;if(d!=null){if(d=d.$$typeof,d===q)return 11;if(d===G)return 14}return 2}function hd(d,v){var E=d.alternate;return E===null?(E=Ho(d.tag,v,d.key,d.mode),E.elementType=d.elementType,E.type=d.type,E.stateNode=d.stateNode,E.alternate=d,d.alternate=E):(E.pendingProps=v,E.type=d.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=d.flags&14680064,E.childLanes=d.childLanes,E.lanes=d.lanes,E.child=d.child,E.memoizedProps=d.memoizedProps,E.memoizedState=d.memoizedState,E.updateQueue=d.updateQueue,v=d.dependencies,E.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},E.sibling=d.sibling,E.index=d.index,E.ref=d.ref,E}function z0(d,v,E,A,W,Y){var le=2;if(A=d,typeof d=="function")Eb(d)&&(le=1);else if(typeof d=="string")le=5;else e:switch(d){case j:return zh(E.children,W,Y,v);case O:le=8,W|=8;break;case F:return d=Ho(12,E,v,W|2),d.elementType=F,d.lanes=Y,d;case D:return d=Ho(13,E,v,W),d.elementType=D,d.lanes=Y,d;case U:return d=Ho(19,E,v,W),d.elementType=U,d.lanes=Y,d;case K:return U0(E,W,Y,v);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case z:le=10;break e;case V:le=9;break e;case q:le=11;break e;case G:le=14;break e;case Z:le=16,A=null;break e}throw Error(r(130,d==null?d:typeof d,""))}return v=Ho(le,E,v,W),v.elementType=d,v.type=A,v.lanes=Y,v}function zh(d,v,E,A){return d=Ho(7,d,A,v),d.lanes=E,d}function U0(d,v,E,A){return d=Ho(22,d,A,v),d.elementType=K,d.lanes=E,d.stateNode={isHidden:!1},d}function Tb(d,v,E){return d=Ho(6,d,null,v),d.lanes=E,d}function Nb(d,v,E){return v=Ho(4,d.children!==null?d.children:[],d.key,v),v.lanes=E,v.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},v}function OD(d,v,E,A,W){this.tag=v,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=er(0),this.expirationTimes=er(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=er(0),this.identifierPrefix=A,this.onRecoverableError=W,this.mutableSourceEagerHydrationData=null}function Pb(d,v,E,A,W,Y,le,be,_e){return d=new OD(d,v,E,be,_e),v===1?(v=1,Y===!0&&(v|=8)):v=0,Y=Ho(3,null,null,v),d.current=Y,Y.stateNode=d,Y.memoizedState={element:A,isDehydrated:E,cache:null,transitions:null,pendingSuspenseBoundaries:null},Lh(Y),d}function DD(d,v,E){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:I,key:A==null?null:""+A,children:d,containerInfo:v,implementation:E}}function eE(d){if(!d)return Io;d=d._reactInternals;e:{if(ni(d)!==d||d.tag!==1)throw Error(r(170));var v=d;do{switch(v.tag){case 3:v=v.stateNode.context;break e;case 1:if(ia(v.type)){v=v.stateNode.__reactInternalMemoizedMergedChildContext;break e}}v=v.return}while(v!==null);throw Error(r(171))}if(d.tag===1){var E=d.type;if(ia(E))return Gf(d,E,v)}return v}function tE(d,v,E,A,W,Y,le,be,_e){return d=Pb(E,A,!0,d,W,Y,le,be,_e),d.context=eE(null),E=d.current,A=_s(),W=cd(E),Y=zo(A,W),Y.callback=v??null,Uo(E,Y,W),d.current.lanes=W,en(d,W,A),Hs(d,A),d}function G0(d,v,E,A){var W=v.current,Y=_s(),le=cd(W);return E=eE(E),v.context===null?v.context=E:v.pendingContext=E,v=zo(Y,le),v.payload={element:d},A=A===void 0?null:A,A!==null&&(v.callback=A),d=Uo(W,v,le),d!==null&&(Ml(d,W,le,Y),Xf(d,W,le)),le}function V0(d){return d=d.current,d.child?(d.child.tag===5,d.child.stateNode):null}function rE(d,v){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var E=d.retryLane;d.retryLane=E!==0&&E<v?E:v}}function Mb(d,v){rE(d,v),(d=d.alternate)&&rE(d,v)}function ID(){return null}var nE=typeof reportError=="function"?reportError:function(d){console.error(d)};function Ab(d){this._internalRoot=d}H0.prototype.render=Ab.prototype.render=function(d){var v=this._internalRoot;if(v===null)throw Error(r(409));G0(d,v,null,null)},H0.prototype.unmount=Ab.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var v=d.containerInfo;jh(function(){G0(null,d,null,null)}),v[zr]=null}};function H0(d){this._internalRoot=d}H0.prototype.unstable_scheduleHydration=function(d){if(d){var v=Ec();d={blockedOn:null,target:d,priority:v};for(var E=0;E<Qn.length&&v!==0&&v<Qn[E].priority;E++);Qn.splice(E,0,d),E===0&&Vl(d)}};function Lb(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function W0(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function iE(){}function jD(d,v,E,A,W){if(W){if(typeof A=="function"){var Y=A;A=function(){var Be=V0(le);Y.call(Be)}}var le=tE(v,A,d,0,null,!1,!1,"",iE);return d._reactRootContainer=le,d[zr]=le.current,Oo(d.nodeType===8?d.parentNode:d),jh(),le}for(;W=d.lastChild;)d.removeChild(W);if(typeof A=="function"){var be=A;A=function(){var Be=V0(_e);be.call(Be)}}var _e=Pb(d,0,!1,null,null,!1,!1,"",iE);return d._reactRootContainer=_e,d[zr]=_e.current,Oo(d.nodeType===8?d.parentNode:d),jh(function(){G0(v,_e,E,A)}),_e}function q0(d,v,E,A,W){var Y=E._reactRootContainer;if(Y){var le=Y;if(typeof W=="function"){var be=W;W=function(){var _e=V0(le);be.call(_e)}}G0(v,le,d,W)}else le=jD(E,v,d,W,A);return V0(le)}Eo=function(d){switch(d.tag){case 3:var v=d.stateNode;if(v.current.memoizedState.isDehydrated){var E=zt(v.pendingLanes);E!==0&&(io(v,E|1),Hs(v,on()),(Ur&6)===0&&(up=on()+500,su()))}break;case 13:jh(function(){var A=Ss(d,1);if(A!==null){var W=_s();Ml(A,d,1,W)}}),Mb(d,1)}},Rs=function(d){if(d.tag===13){var v=Ss(d,134217728);if(v!==null){var E=_s();Ml(v,d,134217728,E)}Mb(d,134217728)}},Cc=function(d){if(d.tag===13){var v=cd(d),E=Ss(d,v);if(E!==null){var A=_s();Ml(E,d,v,A)}Mb(d,v)}},Ec=function(){return xr},sl=function(d,v){var E=xr;try{return xr=d,v()}finally{xr=E}},xt=function(d,v,E){switch(v){case"input":if(rt(d,E),v=E.name,E.type==="radio"&&v!=null){for(E=d;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll("input[name="+JSON.stringify(""+v)+'][type="radio"]'),v=0;v<E.length;v++){var A=E[v];if(A!==d&&A.form===d.form){var W=si(A);if(!W)throw Error(r(90));xe(A),rt(A,W)}}}break;case"textarea":lt(d,E);break;case"select":v=E.value,v!=null&&ht(d,!!E.multiple,v,!1)}},Vt=kb,Yt=jh;var FD={usingClientEntryPoint:!1,Events:[wl,Vn,si,Pt,Ct,kb]},jm={findFiberByHostInstance:Do,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},BD={bundleType:jm.bundleType,version:jm.version,rendererPackageName:jm.rendererPackageName,rendererConfig:jm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:N.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=Ls(d),d===null?null:d.stateNode},findFiberByHostInstance:jm.findFiberByHostInstance||ID,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$0.isDisabled&&$0.supportsFiber)try{Ye=$0.inject(BD),nt=$0}catch{}}return Ws.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=FD,Ws.createPortal=function(d,v){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Lb(v))throw Error(r(200));return DD(d,v,null,E)},Ws.createRoot=function(d,v){if(!Lb(d))throw Error(r(299));var E=!1,A="",W=nE;return v!=null&&(v.unstable_strictMode===!0&&(E=!0),v.identifierPrefix!==void 0&&(A=v.identifierPrefix),v.onRecoverableError!==void 0&&(W=v.onRecoverableError)),v=Pb(d,1,!1,null,null,E,!1,A,W),d[zr]=v.current,Oo(d.nodeType===8?d.parentNode:d),new Ab(v)},Ws.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var v=d._reactInternals;if(v===void 0)throw typeof d.render=="function"?Error(r(188)):(d=Object.keys(d).join(","),Error(r(268,d)));return d=Ls(v),d=d===null?null:d.stateNode,d},Ws.flushSync=function(d){return jh(d)},Ws.hydrate=function(d,v,E){if(!W0(v))throw Error(r(200));return q0(null,d,v,!0,E)},Ws.hydrateRoot=function(d,v,E){if(!Lb(d))throw Error(r(405));var A=E!=null&&E.hydratedSources||null,W=!1,Y="",le=nE;if(E!=null&&(E.unstable_strictMode===!0&&(W=!0),E.identifierPrefix!==void 0&&(Y=E.identifierPrefix),E.onRecoverableError!==void 0&&(le=E.onRecoverableError)),v=tE(v,null,d,1,E??null,W,!1,Y,le),d[zr]=v.current,Oo(d),A)for(d=0;d<A.length;d++)E=A[d],W=E._getVersion,W=W(E._source),v.mutableSourceEagerHydrationData==null?v.mutableSourceEagerHydrationData=[E,W]:v.mutableSourceEagerHydrationData.push(E,W);return new H0(v)},Ws.render=function(d,v,E){if(!W0(v))throw Error(r(200));return q0(null,d,v,!1,E)},Ws.unmountComponentAtNode=function(d){if(!W0(d))throw Error(r(40));return d._reactRootContainer?(jh(function(){q0(null,null,d,!1,function(){d._reactRootContainer=null,d[zr]=null})}),!0):!1},Ws.unstable_batchedUpdates=kb,Ws.unstable_renderSubtreeIntoContainer=function(d,v,E,A){if(!W0(E))throw Error(r(200));if(d==null||d._reactInternals===void 0)throw Error(r(38));return q0(d,v,E,!1,A)},Ws.version="18.3.1-next-f1338f8080-20240426",Ws}var fE;function sM(){if(fE)return Db.exports;fE=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Db.exports=KD(),Db.exports}var pE;function ZD(){if(pE)return K0;pE=1;var t=sM();return K0.createRoot=t.createRoot,K0.hydrateRoot=t.hydrateRoot,K0}var YD=ZD();const XD=Tf(YD);var eo=sM();const QD=Tf(eo);function gv(){return gv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},gv.apply(this,arguments)}var Ld;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Ld||(Ld={}));const mE="popstate";function JD(t){t===void 0&&(t={});function e(n,i){let{pathname:a,search:s,hash:o}=n.location;return TS("",{pathname:a,search:s,hash:o},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){return typeof i=="string"?i:tx(i)}return t8(e,r,null,t)}function hi(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Hk(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function e8(){return Math.random().toString(36).substr(2,8)}function gE(t,e){return{usr:t.state,key:t.key,idx:e}}function TS(t,e,r,n){return r===void 0&&(r=null),gv({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?om(e):e,{state:r,key:e&&e.key||n||e8()})}function tx(t){let{pathname:e="/",search:r="",hash:n=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function om(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function t8(t,e,r,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:a=!1}=n,s=i.history,o=Ld.Pop,l=null,u=c();u==null&&(u=0,s.replaceState(gv({},s.state,{idx:u}),""));function c(){return(s.state||{idx:null}).idx}function h(){o=Ld.Pop;let w=c(),C=w==null?null:w-u;u=w,l&&l({action:o,location:S.location,delta:C})}function p(w,C){o=Ld.Push;let _=TS(S.location,w,C);u=c()+1;let T=gE(_,u),N=S.createHref(_);try{s.pushState(T,"",N)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;i.location.assign(N)}a&&l&&l({action:o,location:S.location,delta:1})}function g(w,C){o=Ld.Replace;let _=TS(S.location,w,C);u=c();let T=gE(_,u),N=S.createHref(_);s.replaceState(T,"",N),a&&l&&l({action:o,location:S.location,delta:0})}function y(w){let C=i.location.origin!=="null"?i.location.origin:i.location.href,_=typeof w=="string"?w:tx(w);return _=_.replace(/ $/,"%20"),hi(C,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,C)}let S={get action(){return o},get location(){return t(i,s)},listen(w){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(mE,h),l=w,()=>{i.removeEventListener(mE,h),l=null}},createHref(w){return e(i,w)},createURL:y,encodeLocation(w){let C=y(w);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:p,replace:g,go(w){return s.go(w)}};return S}var vE;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(vE||(vE={}));function r8(t,e,r){return r===void 0&&(r="/"),n8(t,e,r)}function n8(t,e,r,n){let i=typeof e=="string"?om(e):e,a=Hp(i.pathname||"/",r);if(a==null)return null;let s=oM(t);i8(s);let o=null;for(let l=0;o==null&&l<s.length;++l){let u=m8(a);o=f8(s[l],u)}return o}function oM(t,e,r,n){e===void 0&&(e=[]),r===void 0&&(r=[]),n===void 0&&(n="");let i=(a,s,o)=>{let l={relativePath:o===void 0?a.path||"":o,caseSensitive:a.caseSensitive===!0,childrenIndex:s,route:a};l.relativePath.startsWith("/")&&(hi(l.relativePath.startsWith(n),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(n.length));let u=zd([n,l.relativePath]),c=r.concat(l);a.children&&a.children.length>0&&(hi(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),oM(a.children,e,c,u)),!(a.path==null&&!a.index)&&e.push({path:u,score:d8(u,a.index),routesMeta:c})};return t.forEach((a,s)=>{var o;if(a.path===""||!((o=a.path)!=null&&o.includes("?")))i(a,s);else for(let l of lM(a.path))i(a,s,l)}),e}function lM(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,i=r.endsWith("?"),a=r.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let s=lM(n.join("/")),o=[];return o.push(...s.map(l=>l===""?a:[a,l].join("/"))),i&&o.push(...s),o.map(l=>t.startsWith("/")&&l===""?"/":l)}function i8(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:h8(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const a8=/^:[\w-]+$/,s8=3,o8=2,l8=1,u8=10,c8=-2,yE=t=>t==="*";function d8(t,e){let r=t.split("/"),n=r.length;return r.some(yE)&&(n+=c8),e&&(n+=o8),r.filter(i=>!yE(i)).reduce((i,a)=>i+(a8.test(a)?s8:a===""?l8:u8),n)}function h8(t,e){return t.length===e.length&&t.slice(0,-1).every((n,i)=>n===e[i])?t[t.length-1]-e[e.length-1]:0}function f8(t,e,r){let{routesMeta:n}=t,i={},a="/",s=[];for(let o=0;o<n.length;++o){let l=n[o],u=o===n.length-1,c=a==="/"?e:e.slice(a.length)||"/",h=NS({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),p=l.route;if(!h)return null;Object.assign(i,h.params),s.push({params:i,pathname:zd([a,h.pathname]),pathnameBase:b8(zd([a,h.pathnameBase])),route:p}),h.pathnameBase!=="/"&&(a=zd([a,h.pathnameBase]))}return s}function NS(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=p8(t.path,t.caseSensitive,t.end),i=e.match(r);if(!i)return null;let a=i[0],s=a.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:n.reduce((u,c,h)=>{let{paramName:p,isOptional:g}=c;if(p==="*"){let S=o[h]||"";s=a.slice(0,a.length-S.length).replace(/(.)\/+$/,"$1")}const y=o[h];return g&&!y?u[p]=void 0:u[p]=(y||"").replace(/%2F/g,"/"),u},{}),pathname:a,pathnameBase:s,pattern:t}}function p8(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),Hk(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,o,l)=>(n.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function m8(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Hk(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Hp(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}const g8=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,v8=t=>g8.test(t);function y8(t,e){e===void 0&&(e="/");let{pathname:r,search:n="",hash:i=""}=typeof t=="string"?om(t):t,a;if(r)if(v8(r))a=r;else{if(r.includes("//")){let s=r;r=r.replace(/\/\/+/g,"/"),Hk(!1,"Pathnames cannot have embedded double slashes - normalizing "+(s+" -> "+r))}r.startsWith("/")?a=xE(r.substring(1),"/"):a=xE(r,e)}else a=e;return{pathname:a,search:w8(n),hash:S8(i)}}function xE(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function Fb(t,e,r,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function x8(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function uM(t,e){let r=x8(t);return e?r.map((n,i)=>i===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function cM(t,e,r,n){n===void 0&&(n=!1);let i;typeof t=="string"?i=om(t):(i=gv({},t),hi(!i.pathname||!i.pathname.includes("?"),Fb("?","pathname","search",i)),hi(!i.pathname||!i.pathname.includes("#"),Fb("#","pathname","hash",i)),hi(!i.search||!i.search.includes("#"),Fb("#","search","hash",i)));let a=t===""||i.pathname==="",s=a?"/":i.pathname,o;if(s==null)o=r;else{let h=e.length-1;if(!n&&s.startsWith("..")){let p=s.split("/");for(;p[0]==="..";)p.shift(),h-=1;i.pathname=p.join("/")}o=h>=0?e[h]:"/"}let l=y8(i,o),u=s&&s!=="/"&&s.endsWith("/"),c=(a||s===".")&&r.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const zd=t=>t.join("/").replace(/\/\/+/g,"/"),b8=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),w8=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,S8=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function k8(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const dM=["post","put","patch","delete"];new Set(dM);const _8=["get",...dM];new Set(_8);function vv(){return vv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},vv.apply(this,arguments)}const v1=ie.createContext(null),hM=ie.createContext(null),ih=ie.createContext(null),y1=ie.createContext(null),bc=ie.createContext({outlet:null,matches:[],isDataRoute:!1}),fM=ie.createContext(null);function C8(t,e){let{relative:r}=e===void 0?{}:e;Wv()||hi(!1);let{basename:n,navigator:i}=ie.useContext(ih),{hash:a,pathname:s,search:o}=x1(t,{relative:r}),l=s;return n!=="/"&&(l=s==="/"?n:zd([n,s])),i.createHref({pathname:l,search:o,hash:a})}function Wv(){return ie.useContext(y1)!=null}function Nf(){return Wv()||hi(!1),ie.useContext(y1).location}function pM(t){ie.useContext(ih).static||ie.useLayoutEffect(t)}function Ga(){let{isDataRoute:t}=ie.useContext(bc);return t?B8():E8()}function E8(){Wv()||hi(!1);let t=ie.useContext(v1),{basename:e,future:r,navigator:n}=ie.useContext(ih),{matches:i}=ie.useContext(bc),{pathname:a}=Nf(),s=JSON.stringify(uM(i,r.v7_relativeSplatPath)),o=ie.useRef(!1);return pM(()=>{o.current=!0}),ie.useCallback(function(u,c){if(c===void 0&&(c={}),!o.current)return;if(typeof u=="number"){n.go(u);return}let h=cM(u,JSON.parse(s),a,c.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:zd([e,h.pathname])),(c.replace?n.replace:n.push)(h,c.state,c)},[e,n,s,a,t])}const mM=ie.createContext(null);function bo(){return ie.useContext(mM)}function T8(t){let e=ie.useContext(bc).outlet;return e&&ie.createElement(mM.Provider,{value:t},e)}function Va(){let{matches:t}=ie.useContext(bc),e=t[t.length-1];return e?e.params:{}}function x1(t,e){let{relative:r}=e===void 0?{}:e,{future:n}=ie.useContext(ih),{matches:i}=ie.useContext(bc),{pathname:a}=Nf(),s=JSON.stringify(uM(i,n.v7_relativeSplatPath));return ie.useMemo(()=>cM(t,JSON.parse(s),a,r==="path"),[t,s,a,r])}function N8(t,e){return P8(t,e)}function P8(t,e,r,n){Wv()||hi(!1);let{navigator:i}=ie.useContext(ih),{matches:a}=ie.useContext(bc),s=a[a.length-1],o=s?s.params:{};s&&s.pathname;let l=s?s.pathnameBase:"/";s&&s.route;let u=Nf(),c;if(e){var h;let w=typeof e=="string"?om(e):e;l==="/"||(h=w.pathname)!=null&&h.startsWith(l)||hi(!1),c=w}else c=u;let p=c.pathname||"/",g=p;if(l!=="/"){let w=l.replace(/^\//,"").split("/");g="/"+p.replace(/^\//,"").split("/").slice(w.length).join("/")}let y=r8(t,{pathname:g}),S=O8(y&&y.map(w=>Object.assign({},w,{params:Object.assign({},o,w.params),pathname:zd([l,i.encodeLocation?i.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?l:zd([l,i.encodeLocation?i.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),a,r,n);return e&&S?ie.createElement(y1.Provider,{value:{location:vv({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:Ld.Pop}},S):S}function M8(){let t=F8(),e=k8(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ie.createElement(ie.Fragment,null,ie.createElement("h2",null,"Unexpected Application Error!"),ie.createElement("h3",{style:{fontStyle:"italic"}},e),r?ie.createElement("pre",{style:i},r):null,null)}const A8=ie.createElement(M8,null);class L8 extends ie.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?ie.createElement(bc.Provider,{value:this.props.routeContext},ie.createElement(fM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function R8(t){let{routeContext:e,match:r,children:n}=t,i=ie.useContext(v1);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),ie.createElement(bc.Provider,{value:e},n)}function O8(t,e,r,n){var i;if(e===void 0&&(e=[]),r===void 0&&(r=null),n===void 0&&(n=null),t==null){var a;if(!r)return null;if(r.errors)t=r.matches;else if((a=n)!=null&&a.v7_partialHydration&&e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let s=t,o=(i=r)==null?void 0:i.errors;if(o!=null){let c=s.findIndex(h=>h.route.id&&o?.[h.route.id]!==void 0);c>=0||hi(!1),s=s.slice(0,Math.min(s.length,c+1))}let l=!1,u=-1;if(r&&n&&n.v7_partialHydration)for(let c=0;c<s.length;c++){let h=s[c];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=c),h.route.id){let{loaderData:p,errors:g}=r,y=h.route.loader&&p[h.route.id]===void 0&&(!g||g[h.route.id]===void 0);if(h.route.lazy||y){l=!0,u>=0?s=s.slice(0,u+1):s=[s[0]];break}}}return s.reduceRight((c,h,p)=>{let g,y=!1,S=null,w=null;r&&(g=o&&h.route.id?o[h.route.id]:void 0,S=h.route.errorElement||A8,l&&(u<0&&p===0?(z8("route-fallback"),y=!0,w=null):u===p&&(y=!0,w=h.route.hydrateFallbackElement||null)));let C=e.concat(s.slice(0,p+1)),_=()=>{let T;return g?T=S:y?T=w:h.route.Component?T=ie.createElement(h.route.Component,null):h.route.element?T=h.route.element:T=c,ie.createElement(R8,{match:h,routeContext:{outlet:c,matches:C,isDataRoute:r!=null},children:T})};return r&&(h.route.ErrorBoundary||h.route.errorElement||p===0)?ie.createElement(L8,{location:r.location,revalidation:r.revalidation,component:S,error:g,children:_(),routeContext:{outlet:null,matches:C,isDataRoute:!0}}):_()},null)}var gM=(function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t})(gM||{}),vM=(function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t})(vM||{});function D8(t){let e=ie.useContext(v1);return e||hi(!1),e}function I8(t){let e=ie.useContext(hM);return e||hi(!1),e}function j8(t){let e=ie.useContext(bc);return e||hi(!1),e}function yM(t){let e=j8(),r=e.matches[e.matches.length-1];return r.route.id||hi(!1),r.route.id}function F8(){var t;let e=ie.useContext(fM),r=I8(),n=yM();return e!==void 0?e:(t=r.errors)==null?void 0:t[n]}function B8(){let{router:t}=D8(gM.UseNavigateStable),e=yM(vM.UseNavigateStable),r=ie.useRef(!1);return pM(()=>{r.current=!0}),ie.useCallback(function(i,a){a===void 0&&(a={}),r.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,vv({fromRouteId:e},a)))},[t,e])}const bE={};function z8(t,e,r){bE[t]||(bE[t]=!0)}function U8(t,e){t?.v7_startTransition,t?.v7_relativeSplatPath}function Wk(t){return T8(t.context)}function qn(t){hi(!1)}function G8(t){let{basename:e="/",children:r=null,location:n,navigationType:i=Ld.Pop,navigator:a,static:s=!1,future:o}=t;Wv()&&hi(!1);let l=e.replace(/^\/*/,"/"),u=ie.useMemo(()=>({basename:l,navigator:a,static:s,future:vv({v7_relativeSplatPath:!1},o)}),[l,o,a,s]);typeof n=="string"&&(n=om(n));let{pathname:c="/",search:h="",hash:p="",state:g=null,key:y="default"}=n,S=ie.useMemo(()=>{let w=Hp(c,l);return w==null?null:{location:{pathname:w,search:h,hash:p,state:g,key:y},navigationType:i}},[l,c,h,p,g,y,i]);return S==null?null:ie.createElement(ih.Provider,{value:u},ie.createElement(y1.Provider,{children:r,value:S}))}function V8(t){let{children:e,location:r}=t;return N8(PS(e),r)}new Promise(()=>{});function PS(t,e){e===void 0&&(e=[]);let r=[];return ie.Children.forEach(t,(n,i)=>{if(!ie.isValidElement(n))return;let a=[...e,i];if(n.type===ie.Fragment){r.push.apply(r,PS(n.props.children,a));return}n.type!==qn&&hi(!1),!n.props.index||!n.props.children||hi(!1);let s={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(s.children=PS(n.props.children,a)),r.push(s)}),r}function rx(){return rx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},rx.apply(this,arguments)}function xM(t,e){if(t==null)return{};var r={},n=Object.keys(t),i,a;for(a=0;a<n.length;a++)i=n[a],!(e.indexOf(i)>=0)&&(r[i]=t[i]);return r}function H8(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function W8(t,e){return t.button===0&&(!e||e==="_self")&&!H8(t)}const q8=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],$8=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],K8="6";try{window.__reactRouterVersion=K8}catch{}const Z8=ie.createContext({isTransitioning:!1}),Y8="startTransition",wE=qD[Y8];function X8(t){let{basename:e,children:r,future:n,window:i}=t,a=ie.useRef();a.current==null&&(a.current=JD({window:i,v5Compat:!0}));let s=a.current,[o,l]=ie.useState({action:s.action,location:s.location}),{v7_startTransition:u}=n||{},c=ie.useCallback(h=>{u&&wE?wE(()=>l(h)):l(h)},[l,u]);return ie.useLayoutEffect(()=>s.listen(c),[s,c]),ie.useEffect(()=>U8(n),[n]),ie.createElement(G8,{basename:e,children:r,location:o.location,navigationType:o.action,navigator:s,future:n})}const Q8=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",J8=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ff=ie.forwardRef(function(e,r){let{onClick:n,relative:i,reloadDocument:a,replace:s,state:o,target:l,to:u,preventScrollReset:c,viewTransition:h}=e,p=xM(e,q8),{basename:g}=ie.useContext(ih),y,S=!1;if(typeof u=="string"&&J8.test(u)&&(y=u,Q8))try{let T=new URL(window.location.href),N=u.startsWith("//")?new URL(T.protocol+u):new URL(u),R=Hp(N.pathname,g);N.origin===T.origin&&R!=null?u=R+N.search+N.hash:S=!0}catch{}let w=C8(u,{relative:i}),C=rI(u,{replace:s,state:o,target:l,preventScrollReset:c,relative:i,viewTransition:h});function _(T){n&&n(T),T.defaultPrevented||C(T)}return ie.createElement("a",rx({},p,{href:y||w,onClick:S||a?n:_,ref:r,target:l}))}),eI=ie.forwardRef(function(e,r){let{"aria-current":n="page",caseSensitive:i=!1,className:a="",end:s=!1,style:o,to:l,viewTransition:u,children:c}=e,h=xM(e,$8),p=x1(l,{relative:h.relative}),g=Nf(),y=ie.useContext(hM),{navigator:S,basename:w}=ie.useContext(ih),C=y!=null&&nI(p)&&u===!0,_=S.encodeLocation?S.encodeLocation(p).pathname:p.pathname,T=g.pathname,N=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;i||(T=T.toLowerCase(),N=N?N.toLowerCase():null,_=_.toLowerCase()),N&&w&&(N=Hp(N,w)||N);const R=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let I=T===_||!s&&T.startsWith(_)&&T.charAt(R)==="/",j=N!=null&&(N===_||!s&&N.startsWith(_)&&N.charAt(_.length)==="/"),O={isActive:I,isPending:j,isTransitioning:C},F=I?n:void 0,z;typeof a=="function"?z=a(O):z=[a,I?"active":null,j?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let V=typeof o=="function"?o(O):o;return ie.createElement(ff,rx({},h,{"aria-current":F,className:z,ref:r,style:V,to:l,viewTransition:u}),typeof c=="function"?c(O):c)});var MS;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(MS||(MS={}));var SE;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(SE||(SE={}));function tI(t){let e=ie.useContext(v1);return e||hi(!1),e}function rI(t,e){let{target:r,replace:n,state:i,preventScrollReset:a,relative:s,viewTransition:o}=e===void 0?{}:e,l=Ga(),u=Nf(),c=x1(t,{relative:s});return ie.useCallback(h=>{if(W8(h,r)){h.preventDefault();let p=n!==void 0?n:tx(u)===tx(c);l(t,{replace:p,state:i,preventScrollReset:a,relative:s,viewTransition:o})}},[u,l,c,n,i,r,t,a,s,o])}function nI(t,e){e===void 0&&(e={});let r=ie.useContext(Z8);r==null&&hi(!1);let{basename:n}=tI(MS.useViewTransitionState),i=x1(t,{relative:e.relative});if(!r.isTransitioning)return!1;let a=Hp(r.currentLocation.pathname,n)||r.currentLocation.pathname,s=Hp(r.nextLocation.pathname,n)||r.nextLocation.pathname;return NS(i.pathname,s)!=null||NS(i.pathname,a)!=null}const qk="-",iI=t=>{const e=sI(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:s=>{const o=s.split(qk);return o[0]===""&&o.length!==1&&o.shift(),bM(o,e)||aI(s)},getConflictingClassGroupIds:(s,o)=>{const l=r[s]||[];return o&&n[s]?[...l,...n[s]]:l}}},bM=(t,e)=>{if(t.length===0)return e.classGroupId;const r=t[0],n=e.nextPart.get(r),i=n?bM(t.slice(1),n):void 0;if(i)return i;if(e.validators.length===0)return;const a=t.join(qk);return e.validators.find(({validator:s})=>s(a))?.classGroupId},kE=/^\[(.+)\]$/,aI=t=>{if(kE.test(t)){const e=kE.exec(t)[1],r=e?.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},sI=t=>{const{theme:e,prefix:r}=t,n={nextPart:new Map,validators:[]};return lI(Object.entries(t.classGroups),r).forEach(([a,s])=>{AS(s,n,a,e)}),n},AS=(t,e,r,n)=>{t.forEach(i=>{if(typeof i=="string"){const a=i===""?e:_E(e,i);a.classGroupId=r;return}if(typeof i=="function"){if(oI(i)){AS(i(n),e,r,n);return}e.validators.push({validator:i,classGroupId:r});return}Object.entries(i).forEach(([a,s])=>{AS(s,_E(e,a),r,n)})})},_E=(t,e)=>{let r=t;return e.split(qk).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},oI=t=>t.isThemeGetter,lI=(t,e)=>e?t.map(([r,n])=>{const i=n.map(a=>typeof a=="string"?e+a:typeof a=="object"?Object.fromEntries(Object.entries(a).map(([s,o])=>[e+s,o])):a);return[r,i]}):t,uI=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,n=new Map;const i=(a,s)=>{r.set(a,s),e++,e>t&&(e=0,n=r,r=new Map)};return{get(a){let s=r.get(a);if(s!==void 0)return s;if((s=n.get(a))!==void 0)return i(a,s),s},set(a,s){r.has(a)?r.set(a,s):i(a,s)}}},wM="!",cI=t=>{const{separator:e,experimentalParseClassName:r}=t,n=e.length===1,i=e[0],a=e.length,s=o=>{const l=[];let u=0,c=0,h;for(let w=0;w<o.length;w++){let C=o[w];if(u===0){if(C===i&&(n||o.slice(w,w+a)===e)){l.push(o.slice(c,w)),c=w+a;continue}if(C==="/"){h=w;continue}}C==="["?u++:C==="]"&&u--}const p=l.length===0?o:o.substring(c),g=p.startsWith(wM),y=g?p.substring(1):p,S=h&&h>c?h-c:void 0;return{modifiers:l,hasImportantModifier:g,baseClassName:y,maybePostfixModifierPosition:S}};return r?o=>r({className:o,parseClassName:s}):s},dI=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(n=>{n[0]==="["?(e.push(...r.sort(),n),r=[]):r.push(n)}),e.push(...r.sort()),e},hI=t=>({cache:uI(t.cacheSize),parseClassName:cI(t),...iI(t)}),fI=/\s+/,pI=(t,e)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:i}=e,a=[],s=t.trim().split(fI);let o="";for(let l=s.length-1;l>=0;l-=1){const u=s[l],{modifiers:c,hasImportantModifier:h,baseClassName:p,maybePostfixModifierPosition:g}=r(u);let y=!!g,S=n(y?p.substring(0,g):p);if(!S){if(!y){o=u+(o.length>0?" "+o:o);continue}if(S=n(p),!S){o=u+(o.length>0?" "+o:o);continue}y=!1}const w=dI(c).join(":"),C=h?w+wM:w,_=C+S;if(a.includes(_))continue;a.push(_);const T=i(S,y);for(let N=0;N<T.length;++N){const R=T[N];a.push(C+R)}o=u+(o.length>0?" "+o:o)}return o};function mI(){let t=0,e,r,n="";for(;t<arguments.length;)(e=arguments[t++])&&(r=SM(e))&&(n&&(n+=" "),n+=r);return n}const SM=t=>{if(typeof t=="string")return t;let e,r="";for(let n=0;n<t.length;n++)t[n]&&(e=SM(t[n]))&&(r&&(r+=" "),r+=e);return r};function gI(t,...e){let r,n,i,a=s;function s(l){const u=e.reduce((c,h)=>h(c),t());return r=hI(u),n=r.cache.get,i=r.cache.set,a=o,o(l)}function o(l){const u=n(l);if(u)return u;const c=pI(l,r);return i(l,c),c}return function(){return a(mI.apply(null,arguments))}}const Ln=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},kM=/^\[(?:([a-z-]+):)?(.+)\]$/i,vI=/^\d+\/\d+$/,yI=new Set(["px","full","screen"]),xI=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,bI=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,wI=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,SI=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,kI=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,tc=t=>Ip(t)||yI.has(t)||vI.test(t),pd=t=>lm(t,"length",AI),Ip=t=>!!t&&!Number.isNaN(Number(t)),Bb=t=>lm(t,"number",Ip),Bm=t=>!!t&&Number.isInteger(Number(t)),_I=t=>t.endsWith("%")&&Ip(t.slice(0,-1)),yr=t=>kM.test(t),md=t=>xI.test(t),CI=new Set(["length","size","percentage"]),EI=t=>lm(t,CI,_M),TI=t=>lm(t,"position",_M),NI=new Set(["image","url"]),PI=t=>lm(t,NI,RI),MI=t=>lm(t,"",LI),zm=()=>!0,lm=(t,e,r)=>{const n=kM.exec(t);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):r(n[2]):!1},AI=t=>bI.test(t)&&!wI.test(t),_M=()=>!1,LI=t=>SI.test(t),RI=t=>kI.test(t),OI=()=>{const t=Ln("colors"),e=Ln("spacing"),r=Ln("blur"),n=Ln("brightness"),i=Ln("borderColor"),a=Ln("borderRadius"),s=Ln("borderSpacing"),o=Ln("borderWidth"),l=Ln("contrast"),u=Ln("grayscale"),c=Ln("hueRotate"),h=Ln("invert"),p=Ln("gap"),g=Ln("gradientColorStops"),y=Ln("gradientColorStopPositions"),S=Ln("inset"),w=Ln("margin"),C=Ln("opacity"),_=Ln("padding"),T=Ln("saturate"),N=Ln("scale"),R=Ln("sepia"),I=Ln("skew"),j=Ln("space"),O=Ln("translate"),F=()=>["auto","contain","none"],z=()=>["auto","hidden","clip","visible","scroll"],V=()=>["auto",yr,e],q=()=>[yr,e],D=()=>["",tc,pd],U=()=>["auto",Ip,yr],G=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Z=()=>["solid","dashed","dotted","double","none"],K=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Q=()=>["start","end","center","between","around","evenly","stretch"],ne=()=>["","0",yr],te=()=>["auto","avoid","all","avoid-page","page","left","right","column"],X=()=>[Ip,yr];return{cacheSize:500,separator:":",theme:{colors:[zm],spacing:[tc,pd],blur:["none","",md,yr],brightness:X(),borderColor:[t],borderRadius:["none","","full",md,yr],borderSpacing:q(),borderWidth:D(),contrast:X(),grayscale:ne(),hueRotate:X(),invert:ne(),gap:q(),gradientColorStops:[t],gradientColorStopPositions:[_I,pd],inset:V(),margin:V(),opacity:X(),padding:q(),saturate:X(),scale:X(),sepia:ne(),skew:X(),space:q(),translate:q()},classGroups:{aspect:[{aspect:["auto","square","video",yr]}],container:["container"],columns:[{columns:[md]}],"break-after":[{"break-after":te()}],"break-before":[{"break-before":te()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...G(),yr]}],overflow:[{overflow:z()}],"overflow-x":[{"overflow-x":z()}],"overflow-y":[{"overflow-y":z()}],overscroll:[{overscroll:F()}],"overscroll-x":[{"overscroll-x":F()}],"overscroll-y":[{"overscroll-y":F()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[S]}],"inset-x":[{"inset-x":[S]}],"inset-y":[{"inset-y":[S]}],start:[{start:[S]}],end:[{end:[S]}],top:[{top:[S]}],right:[{right:[S]}],bottom:[{bottom:[S]}],left:[{left:[S]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Bm,yr]}],basis:[{basis:V()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",yr]}],grow:[{grow:ne()}],shrink:[{shrink:ne()}],order:[{order:["first","last","none",Bm,yr]}],"grid-cols":[{"grid-cols":[zm]}],"col-start-end":[{col:["auto",{span:["full",Bm,yr]},yr]}],"col-start":[{"col-start":U()}],"col-end":[{"col-end":U()}],"grid-rows":[{"grid-rows":[zm]}],"row-start-end":[{row:["auto",{span:[Bm,yr]},yr]}],"row-start":[{"row-start":U()}],"row-end":[{"row-end":U()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",yr]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",yr]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...Q()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Q(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Q(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[w]}],mx:[{mx:[w]}],my:[{my:[w]}],ms:[{ms:[w]}],me:[{me:[w]}],mt:[{mt:[w]}],mr:[{mr:[w]}],mb:[{mb:[w]}],ml:[{ml:[w]}],"space-x":[{"space-x":[j]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[j]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",yr,e]}],"min-w":[{"min-w":[yr,e,"min","max","fit"]}],"max-w":[{"max-w":[yr,e,"none","full","min","max","fit","prose",{screen:[md]},md]}],h:[{h:[yr,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[yr,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[yr,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[yr,e,"auto","min","max","fit"]}],"font-size":[{text:["base",md,pd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Bb]}],"font-family":[{font:[zm]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",yr]}],"line-clamp":[{"line-clamp":["none",Ip,Bb]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",tc,yr]}],"list-image":[{"list-image":["none",yr]}],"list-style-type":[{list:["none","disc","decimal",yr]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[C]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[C]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Z(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",tc,pd]}],"underline-offset":[{"underline-offset":["auto",tc,yr]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:q()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",yr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",yr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[C]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...G(),TI]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",EI]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},PI]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[y]}],"gradient-via-pos":[{via:[y]}],"gradient-to-pos":[{to:[y]}],"gradient-from":[{from:[g]}],"gradient-via":[{via:[g]}],"gradient-to":[{to:[g]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[C]}],"border-style":[{border:[...Z(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[C]}],"divide-style":[{divide:Z()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...Z()]}],"outline-offset":[{"outline-offset":[tc,yr]}],"outline-w":[{outline:[tc,pd]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:D()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[C]}],"ring-offset-w":[{"ring-offset":[tc,pd]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",md,MI]}],"shadow-color":[{shadow:[zm]}],opacity:[{opacity:[C]}],"mix-blend":[{"mix-blend":[...K(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":K()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",md,yr]}],grayscale:[{grayscale:[u]}],"hue-rotate":[{"hue-rotate":[c]}],invert:[{invert:[h]}],saturate:[{saturate:[T]}],sepia:[{sepia:[R]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[u]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[c]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[C]}],"backdrop-saturate":[{"backdrop-saturate":[T]}],"backdrop-sepia":[{"backdrop-sepia":[R]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[s]}],"border-spacing-x":[{"border-spacing-x":[s]}],"border-spacing-y":[{"border-spacing-y":[s]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",yr]}],duration:[{duration:X()}],ease:[{ease:["linear","in","out","in-out",yr]}],delay:[{delay:X()}],animate:[{animate:["none","spin","ping","pulse","bounce",yr]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[N]}],"scale-x":[{"scale-x":[N]}],"scale-y":[{"scale-y":[N]}],rotate:[{rotate:[Bm,yr]}],"translate-x":[{"translate-x":[O]}],"translate-y":[{"translate-y":[O]}],"skew-x":[{"skew-x":[I]}],"skew-y":[{"skew-y":[I]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",yr]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",yr]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":q()}],"scroll-mx":[{"scroll-mx":q()}],"scroll-my":[{"scroll-my":q()}],"scroll-ms":[{"scroll-ms":q()}],"scroll-me":[{"scroll-me":q()}],"scroll-mt":[{"scroll-mt":q()}],"scroll-mr":[{"scroll-mr":q()}],"scroll-mb":[{"scroll-mb":q()}],"scroll-ml":[{"scroll-ml":q()}],"scroll-p":[{"scroll-p":q()}],"scroll-px":[{"scroll-px":q()}],"scroll-py":[{"scroll-py":q()}],"scroll-ps":[{"scroll-ps":q()}],"scroll-pe":[{"scroll-pe":q()}],"scroll-pt":[{"scroll-pt":q()}],"scroll-pr":[{"scroll-pr":q()}],"scroll-pb":[{"scroll-pb":q()}],"scroll-pl":[{"scroll-pl":q()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",yr]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[tc,pd,Bb]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},$k=gI(OI),ti=({children:t,className:e,...r})=>m.jsx("div",{className:$k("bg-glass backdrop-blur-xl border border-glass-border rounded-xl",e),...r,children:t}),Kk=({url:t,name:e,alt:r="User",size:n="md",className:i})=>{const a={sm:"size-8 text-xs",md:"size-10 text-sm",lg:"size-16 text-lg",xl:"size-32 text-2xl"},s=e?e.charAt(0).toUpperCase():r?r.charAt(0).toUpperCase():"?";return m.jsx("div",{className:$k("rounded-full bg-surface-light border border-white/10 flex items-center justify-center overflow-hidden shrink-0 text-slate-400 font-bold select-none",a[n],i),children:t?m.jsx("img",{src:t,alt:e||r,className:"w-full h-full object-cover"}):m.jsx("span",{children:s})})},DI=()=>m.jsx("div",{className:"flex h-screen w-full overflow-hidden bg-background-dark relative",children:m.jsx("main",{className:"flex-1 min-w-0 relative overflow-hidden flex flex-col",children:m.jsx(Wk,{})})}),II="/api",Ke={async request(t,e={}){const r=`${II}${t}`,i={...e.body instanceof FormData?{}:{"Content-Type":"application/json"},...e.headers},a=await fetch(r,{...e,headers:i,credentials:"include"});if(!a.ok){const s=await a.json().catch(()=>({}));throw new Error(s.error||`HTTP error! status: ${a.status}`)}return a.status===204||a.headers.get("content-length")==="0"?null:a.json()},get(t,e={}){return this.request(t,{method:"GET",headers:e})},post(t,e,r={}){return this.request(t,{method:"POST",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},put(t,e,r={}){return this.request(t,{method:"PUT",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},patch(t,e,r={}){return this.request(t,{method:"PATCH",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},delete(t,e={}){return this.request(t,{method:"DELETE",headers:e})}},Uh={list:()=>Ke.get("/workspaces"),create:(t,e,r,n)=>Ke.post("/workspaces",{name:t,title:e,genre:r,imageUrl:n}),delete:t=>Ke.delete("/workspaces/"+t),update:(t,e)=>Ke.put("/workspaces/"+t,e),select:t=>Ke.post("/workspaces/select",{projectName:t}),restartBackend:()=>Ke.post("/system/restart",{}),healthCheck:()=>Ke.get("/system/health")},jI=["FANTASA","SCI-FI","HORROR","LORE","MISTERIO","HISTRICO","CYBERPUNK","STEAMPUNK"],FI=({isOpen:t,onClose:e,onCreate:r})=>{if(!t)return null;const[n,i]=ie.useState(!1),[a,s]=ie.useState({name:"",title:"",genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"}),o=u=>{const{name:c,value:h}=u.target;s(p=>({...p,[c]:h}))},l=u=>{u.preventDefault();let c=a.name;if(!c&&a.title&&(c=a.title.toLowerCase().replace(/[^a-z0-9]/g,"-")),!c){alert("Project ID/Name is required");return}r({...a,name:c}),e(),s({name:"",title:"",genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"})};return eo.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-2xl bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex animate-in zoom-in-95 duration-200",children:[m.jsxs("div",{className:"w-1/3 bg-black relative hidden sm:block",children:[m.jsx("img",{src:a.imageUrl,onError:()=>i(!0),className:`absolute inset-0 w-full h-full object-cover opacity-60 transition-opacity duration-500 ${n?"hidden":""}`,alt:"Preview"}),m.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-6 bg-gradient-to-t from-black to-transparent",children:[m.jsx("h4",{className:"text-white font-black text-xl leading-none",children:a.title||"Untitled"}),m.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest mt-2 block",children:a.genre})]})]}),m.jsxs("div",{className:"flex-1 p-8",children:[m.jsx("h2",{className:"text-2xl font-black text-white mb-6",children:"Nuevo Cuaderno"}),m.jsxs("form",{onSubmit:l,className:"space-y-5",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Ttulo del Proyecto"}),m.jsx("input",{type:"text",name:"title",value:a.title,onChange:o,placeholder:"e.g. Las Crnicas de Etheria",className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-sm focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all",autoFocus:!0})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"ID de Archivo (Slug)"}),m.jsx("input",{type:"text",name:"name",value:a.name,onChange:o,placeholder:"e.g. etheria-v1",className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white font-mono text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all placeholder:text-white/10"}),m.jsx("p",{className:"text-[10px] text-white/20",children:"Se usar como nombre del archivo .db"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Gnero"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:jI.slice(0,4).map(u=>m.jsx("button",{type:"button",onClick:()=>s(c=>({...c,genre:u})),className:`px-3 py-2 rounded-lg text-[10px] font-bold border transition-all ${a.genre===u?"bg-primary text-white border-primary":"bg-[#13141f] border-white/10 text-text-muted hover:border-white/20"}`,children:u},u))})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Imagen de Portada (URL)"}),m.jsx("input",{type:"text",name:"imageUrl",value:a.imageUrl,onChange:u=>{s(c=>({...c,imageUrl:u.target.value})),i(!1)},className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all truncate"})]}),m.jsxs("div",{className:"pt-4 flex gap-3",children:[m.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-3 bg-[#13141f] hover:bg-white/5 border border-white/10 rounded-xl text-xs font-bold text-text-muted transition-all",children:"Cancelar"}),m.jsxs("button",{type:"submit",className:"flex-1 px-4 py-3 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"rocket_launch"}),"Crear Universo"]})]})]})]})]})]}),document.body)},BI=["FANTASA","SCI-FI","HORROR","LORE","MISTERIO","HISTRICO","CYBERPUNK","STEAMPUNK"],zI=({isOpen:t,onClose:e,onUpdate:r,project:n})=>{if(!t||!n)return null;const[i,a]=ie.useState(!1),[s,o]=ie.useState({name:n,title:n,genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"});ie.useEffect(()=>{n&&o(u=>({...u,name:n,title:n}))},[n]);const l=u=>{u.preventDefault(),r(s.name,{title:s.title,genre:s.genre,imageUrl:s.imageUrl}),e()};return eo.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-2xl bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex animate-in zoom-in-95 duration-200",children:[m.jsxs("div",{className:"w-1/3 bg-black relative hidden sm:block",children:[m.jsx("img",{src:s.imageUrl,onError:()=>a(!0),className:`absolute inset-0 w-full h-full object-cover opacity-60 transition-opacity duration-500 ${i?"hidden":""}`,alt:"Preview"}),m.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-6 bg-gradient-to-t from-black to-transparent",children:[m.jsx("h4",{className:"text-white font-black text-xl leading-none",children:s.title||"Untitled"}),m.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest mt-2 block",children:s.genre})]})]}),m.jsxs("div",{className:"flex-1 p-8",children:[m.jsx("h2",{className:"text-2xl font-black text-white mb-6",children:"Editar Cuaderno"}),m.jsxs("form",{onSubmit:l,className:"space-y-5",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Ttulo del Proyecto"}),m.jsx("input",{type:"text",name:"title",value:s.title,onChange:u=>o(c=>({...c,title:u.target.value})),className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-sm focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all",autoFocus:!0})]}),m.jsxs("div",{className:"space-y-1.5 opacity-50",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"ID de Archivo (Inmutable)"}),m.jsx("input",{type:"text",value:s.name,readOnly:!0,className:"w-full bg-[#0a0a0c] border border-white/5 rounded-xl px-4 py-3 text-white/50 font-mono text-xs outline-none cursor-not-allowed"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Gnero"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:BI.slice(0,4).map(u=>m.jsx("button",{type:"button",onClick:()=>o(c=>({...c,genre:u})),className:`px-3 py-2 rounded-lg text-[10px] font-bold border transition-all ${s.genre===u?"bg-primary text-white border-primary":"bg-[#13141f] border-white/10 text-text-muted hover:border-white/20"}`,children:u},u))})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Imagen de Portada (URL)"}),m.jsx("input",{type:"text",value:s.imageUrl,onChange:u=>{o(c=>({...c,imageUrl:u.target.value})),a(!1)},className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all truncate"})]}),m.jsxs("div",{className:"pt-4 flex gap-3",children:[m.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-3 bg-[#13141f] hover:bg-white/5 border border-white/10 rounded-xl text-xs font-bold text-text-muted transition-all",children:"Cancelar"}),m.jsxs("button",{type:"submit",className:"flex-1 px-4 py-3 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Guardar Cambios"]})]})]})]})]})]}),document.body)},Dn=ie.forwardRef(({children:t,variant:e="primary",size:r="md",className:n,icon:i,isLoading:a,...s},o)=>{const l="inline-flex items-center justify-center rounded-lg font-medium transition-all focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed active:scale-95",u={primary:"bg-primary text-white shadow-lg shadow-primary/25 hover:bg-primary-light hover:shadow-primary/40 border border-transparent",secondary:"bg-surface-light text-slate-200 border border-white/10 hover:bg-white/5 hover:text-white hover:border-white/20",ghost:"bg-transparent text-slate-400 hover:text-white hover:bg-white/5",danger:"bg-red-500/10 text-red-500 border border-red-500/20 hover:bg-red-500/20 hover:border-red-500/50 hover:shadow-lg hover:shadow-red-500/10",outline:"bg-transparent border border-primary/50 text-primary hover:bg-primary/10"},c={xs:"px-2.5 py-1 text-xs gap-1.5",sm:"px-3 py-1.5 text-xs gap-1.5",md:"px-4 py-2 text-sm gap-2",lg:"px-6 py-3 text-base gap-3",icon:"size-9 p-0"};return m.jsxs("button",{ref:o,className:$k(l,u[e],c[r],n),disabled:a,...s,children:[a?m.jsx("span",{className:"material-symbols-outlined animate-spin text-[18px]",children:"progress_activity"}):i?m.jsx("span",{className:"material-symbols-outlined text-[18px]",children:i}):null,t]})});Dn.displayName="Button";const Zk=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,confirmText:a="Confirm",cancelText:s="Cancel",isDestructive:o=!0})=>t?m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",onClick:e}),m.jsx("div",{className:"relative z-10 w-full max-w-md animate-in zoom-in-95 duration-300",children:m.jsxs(ti,{className:"p-6 border-red-500/20 shadow-2xl shadow-black/50",children:[m.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[m.jsx("div",{className:`
                            size-12 rounded-xl flex items-center justify-center shrink-0
                            ${o?"bg-red-500/10 text-red-500":"bg-primary/10 text-primary"}
                        `,children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:o?"warning":"help"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-black text-white mb-2 leading-tight",children:n}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:i})]})]}),m.jsxs("div",{className:"flex items-center justify-end gap-3",children:[m.jsx(Dn,{variant:"ghost",onClick:e,children:s}),m.jsx(Dn,{variant:o?"danger":"primary",onClick:()=>{r(),e()},icon:o?"delete":"check",children:a})]})]})})]}):null,UI=()=>{const t=Ga(),[e,r]=ie.useState([]),[n,i]=ie.useState(!0),[a,s]=ie.useState(null),[o,l]=ie.useState(""),[u,c]=ie.useState(!1),[h,p]=ie.useState(null),[g,y]=ie.useState(null),[S,w]=ie.useState(!1),[C,_]=ie.useState(0),[T,N]=ie.useState("idle");ie.useEffect(()=>{R()},[]);const R=async()=>{try{i(!0);const D=await Uh.list();r(D)}catch(D){console.error("Failed to load workspaces",D),s("Error al cargar cuadernos. Est el servidor encendido?")}finally{i(!1)}},I=async D=>{try{i(!0);const U=await Uh.select(D);U.success&&U.redirect&&(localStorage.setItem("user",JSON.stringify({username:"local",success:!0})),t(U.redirect))}catch(U){s(U.message||"Fallo al entrar al cuaderno"),i(!1)}},j=async D=>{try{i(!0),(await Uh.create(D.name,D.title,D.genre,D.imageUrl)).success&&await I(D.name)}catch{s("Error al crear cuaderno"),i(!1)}},O=async()=>{if(h)try{i(!0),await Uh.delete(h),await R(),p(null)}catch{s("Error al borrar el cuaderno"),i(!1)}},F=async(D,U)=>{try{i(!0),await Uh.update(D,U),await R(),y(null)}catch{s("Error al actualizar cuaderno"),i(!1)}},z=()=>{window.location.href="/api/backup/download"},V=async()=>{w(!0),N("restarting"),_(10);try{await Uh.restartBackend(),_(30),await new Promise(Z=>setTimeout(Z,2e3)),_(50),N("checking");let D=0;const U=30,G=async()=>{try{await Uh.healthCheck(),_(100),N("complete"),setTimeout(()=>{w(!1),N("idle"),_(0),R()},1500)}catch{D++,D>=U?(N("error"),_(0)):(_(50+D/U*50),setTimeout(G,1e3))}};G()}catch{N("error"),_(0)}},q=e.filter(D=>(D.title||D.filename||"").toLowerCase().includes(o.toLowerCase()));return m.jsxs("div",{className:"h-screen w-full bg-[#0a0b14] text-white flex flex-col items-center font-sans selection:bg-indigo-500/30 overflow-hidden",children:[m.jsxs("div",{className:"w-full max-w-6xl flex-1 flex flex-col overflow-y-auto custom-scrollbar p-8",children:[m.jsxs("header",{className:"w-full mt-24 mb-12 flex flex-col lg:flex-row lg:items-end justify-between gap-8 flex-shrink-0",children:[m.jsx("div",{className:"space-y-4",children:m.jsx("div",{className:"flex items-center gap-4",children:m.jsxs("h1",{className:"text-6xl font-black tracking-tighter leading-none",children:[m.jsx("span",{className:"block text-indigo-400",children:"Mis"}),m.jsx("span",{className:"block text-white",children:"Cuadernos"})]})})}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("button",{onClick:()=>t("/settings"),className:"flex items-center gap-2 px-5 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white group",title:"Configuracin Global",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:rotate-90 transition-transform duration-500",children:"settings"}),m.jsx("span",{className:"hidden sm:inline",children:"Ajustes"})]}),m.jsxs("button",{onClick:z,className:"flex items-center gap-2 px-5 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white group",title:"Descargar copia de seguridad de todos los universos",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:scale-110 transition-transform",children:"cloud_download"}),m.jsx("span",{className:"hidden sm:inline",children:"Backup Global"})]}),m.jsxs("button",{onClick:V,className:"flex items-center gap-2 px-5 py-3 bg-orange-500/10 hover:bg-orange-500/20 border border-orange-500/20 rounded-2xl transition-all text-xs font-bold text-orange-400 hover:text-orange-300 group",title:"Reiniciar servidor backend (til tras migraciones)",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:rotate-180 transition-transform duration-500",children:"refresh"}),m.jsx("span",{className:"hidden sm:inline",children:"Reiniciar Backend"})]}),m.jsxs("div",{className:"relative group min-w-[300px]",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-white/20 text-xl group-focus-within:text-indigo-400 transition-colors pointer-events-none",children:"search"}),m.jsx("input",{type:"text",placeholder:"Buscar...",value:o,onChange:D=>l(D.target.value),className:"w-full bg-[#13141f] border border-white/5 rounded-2xl py-3 pl-12 pr-4 text-sm text-white focus:outline-none focus:border-indigo-500/50 transition-all placeholder:text-white/10"})]})]})]}),m.jsx("section",{className:"w-full max-w-6xl",children:n?m.jsxs("div",{className:"flex flex-col items-center gap-6 py-20 opacity-20",children:[m.jsx("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"}),m.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"Accediendo al Sector Local..."})]}):m.jsxs("div",{className:"flex flex-wrap gap-6 justify-start pb-20",children:[m.jsxs("div",{onClick:()=>c(!0),className:"group relative h-[380px] rounded-[2.5rem] border-2 border-dashed border-white/5 flex flex-col items-center justify-center gap-6 hover:bg-white/5 hover:border-indigo-500/30 transition-all cursor-pointer overflow-hidden animate-in fade-in duration-700 w-full md:w-[calc(50%-0.75rem)] lg:w-[calc(33.333%-1rem)]",children:[m.jsx("div",{className:"w-20 h-20 rounded-full bg-[#13141f] border border-white/5 flex items-center justify-center text-4xl text-white/20 group-hover:scale-110 group-hover:text-indigo-400 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-4xl",children:"add"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("h3",{className:"text-xl font-black tracking-tight text-white/50 group-hover:text-white transition-colors",children:"Nuevo Cuaderno"}),m.jsx("p",{className:"text-[10px] font-bold text-white/20 uppercase tracking-widest mt-2 group-hover:text-white/40",children:"Inicia un nuevo universo"})]})]}),q.map(D=>{const U=D.imageUrl||"https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&q=80&w=800";return m.jsxs("div",{onClick:()=>I(D.filename),className:"group relative h-[380px] rounded-[2.5rem] bg-[#13141f] border border-white/5 overflow-hidden transition-all hover:-translate-y-2 hover:shadow-2xl hover:shadow-indigo-500/10 cursor-pointer animate-in fade-in slide-in-from-bottom-4 w-full md:w-[calc(50%-0.75rem)] lg:w-[calc(33.333%-1rem)]",children:[m.jsxs("div",{className:"absolute inset-x-0 top-0 h-2/3",children:[m.jsx("img",{src:U,className:"w-full h-full object-cover opacity-40 group-hover:opacity-60 transition-opacity",alt:""}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#13141f] via-transparent to-transparent"})]}),m.jsxs("div",{className:"absolute top-6 right-6 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20",children:[m.jsx("button",{onClick:G=>{G.stopPropagation(),y(D.filename)},className:"w-10 h-10 rounded-full bg-black/50 backdrop-blur-md border border-white/10 flex items-center justify-center text-white/70 hover:text-white hover:bg-indigo-500 hover:border-indigo-400 transition-all",title:"Editar",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),m.jsx("button",{onClick:G=>{G.stopPropagation(),p(D.filename)},className:"w-10 h-10 rounded-full bg-black/50 backdrop-blur-md border border-white/10 flex items-center justify-center text-white/70 hover:text-white hover:bg-red-500 hover:border-red-400 transition-all",title:"Eliminar",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsx("div",{className:"absolute inset-0 flex flex-col justify-end p-8",children:m.jsxs("div",{className:"mt-auto space-y-3",children:[m.jsx("span",{className:"inline-block px-3 py-1 bg-red-500/20 border border-red-500/30 text-[9px] font-black text-red-100 rounded-lg tracking-widest uppercase",children:D.tag}),m.jsx("h3",{className:"text-3xl font-black text-white tracking-tighter leading-tight group-hover:text-indigo-400 transition-colors",children:D.title}),D.title!==D.filename&&m.jsx("p",{className:"text-[10px] text-white/30 font-mono mb-1",children:D.filename}),m.jsx("p",{className:"text-xs text-white/40 line-clamp-2 leading-relaxed",children:"Una tierra dividida por la magia y la tecnologa antigua..."}),m.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-white/5 mt-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"}),m.jsxs("span",{className:"text-[9px] font-black uppercase tracking-widest text-white/20",children:["ltima edicin: ",m.jsx("span",{className:"text-white/40",children:D.lastModified})]})]}),m.jsx("div",{className:"w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-[10px] font-black text-indigo-300",children:D.initials})]})]})})]},D.filename)})]})})]}),a&&m.jsx("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 px-6 py-3 bg-red-500/20 border border-red-500/30 text-red-200 rounded-2xl text-xs font-bold shadow-2xl animate-bounce",children:a}),m.jsx(FI,{isOpen:u,onClose:()=>c(!1),onCreate:j}),m.jsx(zI,{isOpen:!!g,onClose:()=>y(null),project:g,onUpdate:F}),m.jsx(Zk,{isOpen:!!h,onClose:()=>p(null),onConfirm:O,title:"Eliminar Proyecto?",message:`Ests a punto de borrar "${h}" y todo su contenido permanentemente. Esta accin no se puede deshacer.`,confirmText:"Eliminar Universo",isDestructive:!0}),S&&m.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm animate-in fade-in duration-300",children:m.jsxs("div",{className:"w-full max-w-md bg-[#0A0A0F] border border-orange-500/20 rounded-[2.5rem] overflow-hidden shadow-2xl shadow-orange-500/10 animate-in zoom-in-95 duration-500",children:[m.jsx("div",{className:"p-8 border-b border-white/5 bg-gradient-to-r from-orange-500/10 to-transparent",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-500/20 border border-orange-500/30 flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-2xl text-orange-400 animate-spin",children:"refresh"})}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-xl font-black text-white",children:"Reiniciando Backend"}),m.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:[T==="restarting"&&"Deteniendo servidor...",T==="checking"&&"Esperando reconexin...",T==="complete"&&"Reinicio completado!",T==="error"&&"Error en el reinicio"]})]})]})}),m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex justify-between text-xs",children:[m.jsx("span",{className:"text-slate-500 font-bold",children:"Progreso"}),m.jsxs("span",{className:"text-orange-400 font-black",children:[Math.round(C),"%"]})]}),m.jsx("div",{className:"h-2 bg-white/5 rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-gradient-to-r from-orange-500 to-orange-400 transition-all duration-500 ease-out",style:{width:`${C}%`}})})]}),m.jsxs("div",{className:"space-y-2 text-xs text-slate-400",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:`w-2 h-2 rounded-full ${C>=30?"bg-green-500":"bg-slate-700"}`}),m.jsx("span",{children:"Seal de reinicio enviada"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:`w-2 h-2 rounded-full ${C>=50?"bg-green-500":"bg-slate-700"}`}),m.jsx("span",{children:"Servidor detenido"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:`w-2 h-2 rounded-full ${C>=100?"bg-green-500":C>50?"bg-orange-500 animate-pulse":"bg-slate-700"}`}),m.jsx("span",{children:"Servidor iniciado y listo"})]})]}),T==="error"&&m.jsxs("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-xs text-red-400",children:[m.jsx("p",{className:"font-bold",children:"Error: El servidor no respondi despus de 30 segundos."}),m.jsx("p",{className:"mt-2 text-red-300/70",children:"Por favor, reinicia manualmente desde la terminal."})]})]}),T==="complete"&&m.jsxs("div",{className:"p-6 bg-green-500/10 border-t border-green-500/20 flex items-center justify-center gap-2 text-green-400 text-sm font-bold",children:[m.jsx("span",{className:"material-symbols-outlined",children:"check_circle"}),m.jsx("span",{children:"Backend reiniciado correctamente"})]}),T==="error"&&m.jsx("div",{className:"p-6 border-t border-white/5 flex justify-end",children:m.jsx("button",{onClick:()=>{w(!1),N("idle"),_(0)},className:"px-6 py-3 rounded-2xl bg-white/5 hover:bg-white/10 text-white text-xs font-bold transition-all",children:"Cerrar"})})]})})]})},GI={save:"Guardar",saved:"Guardado",saving:"Guardando...",cancel:"Cancelar",delete:"Borrar",edit:"Editar",create:"Crear",back:"Volver",loading:"Cargando...",search:"Buscar...",no_results:"Sin resultados",confirm_delete:"Eliminar",are_you_sure:"Ests seguro de que quieres eliminar este elemento? Esta accin no se puede deshacer.",architect:"Arquitecto",confirm_delete_btn:"S, borrar",view_all:"Ver todos",rename:"Renombrar",error_delete:"Error al eliminar el elemento"},VI={dashboard:"Panel de Control",bible:"Biblia del Mundo",atlas:"Atlas",writing:"Escritura",settings:"Ajustes",logout:"Salir al Hub",chronology:"Cronologa",graph:"Grafo",languages:"Lingstica"},HI={title:"Ajustes",general:"General",appearance:"Apariencia",language:"Idioma",theme:"Tema",font:"Tipografa",font_size:"Tamao del Texto",unauthorized:"No autorizado",sync:"Sincronizacin",backup:"Respaldo",edit_template:"Editar Plantilla",available_templates:"Plantillas Disponibles",no_templates:"Sin Plantillas",is_global:"Es Global?",name:"Nombre",type:"Tipo"},WI={title:"Escritura",library:"Biblioteca del Arquitecto",library_desc:"Gestiona tus Archivadores y Crnicas",new_notebook:"Nuevo Archivador",new_page:"Nueva Hoja",index:"ndice",notes:"Notas",format:"Formato",empty:"Pgina vaca...",active_notebook:"Archivador Activo",open_archivador:"Abrir Archivador",book_title:"Ttulo del Libro",placeholder_title:"Las Crnicas del Vaco...",create_and_open:"Crear y Abrir",expansion:"Expansin de la Biblioteca",delete_confirm:"Seguro que quieres borrar este archivador? Se perdern todas sus hojas.",chapter:"Captulo",page:"Pgina",of:"de"},qI={grid_system:"Sistema de Rejilla",size:"Tamao",canvas_data:"Datos del Lienzo",width:"Ancho (px)",height:"Alto (px)",background_image:"Imagen de Fondo",upload_image:"Subir Nueva Imagen",remove_image:"Eliminar Imagen",explorer:"Explorador de Mundo",not_found:"Imagen del Mapa no Encontrada",upload_desc:"Sube una imagen del mapa en el editor para comenzar",fullscreen:"Pantalla Completa",share:"Compartir",inhabitants:"Habitantes Clave",related_events:"Eventos Relacionados",open_bible:"Abrir en la Biblia",place:"Lugar",capital:"Capital",new_map:"Nuevo Mapa"},$I={explore:"Explorar",explorer:"Explorador",templates:"Plantillas",drag_attributes:"Arrastrar Atributos",search_entity:"Buscar entidad...",filter_type:"Filtrar por Tipo",all:"Todos",entities:"Entidades",maps:"Mapas",timelines:"Lneas de Tiempo",new_folder:"Nueva Carpeta",new_timeline:"Nueva Lnea de Tiempo",delete_folder:"Borrar Carpeta",delete_folder_msg:"Seguro que quieres borrar esta carpeta y todo su contenido?",delete_entity:"Borrar Entidad",delete_entity_msg:"Seguro que quieres borrar esta entidad de la Biblia?",no_favorites:"Sin favoritos an",favorites:"Favoritos",root_index:"ndice Raz",central_archive:"Archivo central de todas las entidades, cronologas y registros geogrficos del mundo.",empty_archive:"Archivo Vaco",empty_archive_desc:"Comienza creando tu primera carpeta o lnea de tiempo para organizar el conocimiento."},KI={title:"Lnea de Tiempo",add_event:"Aadir Evento",add_line:"Nueva Lnea de Tiempo",edit_event:"Editar Evento",edit_line:"Editar Lnea de Tiempo",delete_event:"Eliminar Evento",delete_line:"Eliminar Lnea de Tiempo",events_tab:"Eventos",annexes_tab:"Anexos",linked_timelines:"Lneas de Tiempo Vinculadas",available_timelines:"Lneas de Tiempo Disponibles",multiverse:"Multiverso",new_universe:"Nuevo Universo",universe_settings:"Ajustes del Universo",delete_universe_confirm:"Eliminar este universo y TODAS sus lneas de tiempo? Esta accin no se puede deshacer.",select_timeline:"Seleccionar Lnea",no_events:"Sin eventos an. Usa el panel derecho para aadir uno.",event_name:"Nombre del Evento",date_label:"Etiqueta de Fecha",order:"Orden (Sorteo)",description:"Descripcin",save_changes:"Guardar Cambios",create_event:"Crear Evento",delete_event_btn:"Eliminar Evento",annexed_desc:"Vincula otras lneas de tiempo localizadas a esta para verificar la consistencia cronolgica.",no_linked:"Sin lneas vinculadas.",available_to_link:"Disponibles para Vincular",no_available:"No hay otras lneas disponibles.",universe_name:"Nombre del Universo",universe_desc:"Contexto para este universo...",add_timeline_here:"Aadir Lnea de Tiempo aqu",no_timelines:"No hay lneas aqu"},ZI={title:"Lingstica",lexicon:"Lxico",grammar:"Reglas de Gramtica",writing_system:"Sistema de Escritura",phonology:"Fonologa",translator:"Traductor",new_word:"Aadir Nueva Palabra",new_rule:"Definir Nueva Regla",open_editor:"Abrir Editor",auto_saved:"Auto-guardado",desc:"Una lengua perteneciente a {{projectName}}. Gestiona su lxico, reglas gramaticales y sistemas de escritura aqu.",stats:{words:"Palabras",rules:"Reglas",glyphs:"Glifos"},search_lexicon:"Buscar palabra o significado...",manage:"Gestionar",moon_script:"Escritura Lunar",inventory:"Inventario de Vocales",vectors:"Smbolos Vectoriales",upload_svg:"Subir SVG",live_stream:"Flujo Logogrfico en Vivo",rendered_output:"Salida Renderizada",source_text:"Texto de origen aqu..."},YI={dashboard_desc:"Panel de Control del Proyecto",welcome:"Bienvenido,",welcome_desc:"Tu mundo est esperando ser esculpido. Utiliza el Codex para documentar entidades, el Atlas para trazar geografas o las Crnicas para escribir su historia.",codex_title:"Codex",codex_desc:"Biblia del Mundo y Base de Datos de Entidades",atlas_title:"Atlas",atlas_desc:"Cartografa y Geografa Interactiva",chronicles_title:"Crnicas",chronicles_desc:"Escritura Narrativa y Gestin de Cuadernos",graph_title:"Grafo",graph_desc:"Visualizacin de Conexiones y Relaciones",timeline_title:"Cronologa",timeline_desc:"Lneas de Tiempo y Eventos Histricos",linguistics_title:"Lingstica",linguistics_desc:"Creacin de Lenguas y Glifos",explore_tool:"Explorar Herramienta"},XI={common:GI,nav:VI,settings:HI,writing:WI,atlas:qI,bible:$I,timeline:KI,linguistics:ZI,project:YI},QI={save:"Save",saved:"Saved",saving:"Saving...",cancel:"Cancel",delete:"Delete",edit:"Edit",create:"Create",back:"Back",loading:"Loading...",search:"Search...",no_results:"No results",confirm_delete:"Delete",are_you_sure:"Are you sure you want to delete this item? This action cannot be undone.",architect:"Architect",confirm_delete_btn:"Yes, delete",view_all:"View All",rename:"Rename",error_delete:"Error deleting item"},JI={dashboard:"Dashboard",bible:"World Bible",atlas:"Atlas",writing:"Writing",settings:"Settings",logout:"Exit to Hub",chronology:"Chronology",graph:"Graph",languages:"Linguistics"},ej={title:"Settings",general:"General",appearance:"Appearance",language:"Language",theme:"Theme",font:"Typography",font_size:"Font Size",unauthorized:"Unauthorized",sync:"Synchronization",backup:"Backup",edit_template:"Edit Template",available_templates:"Available Templates",no_templates:"No Templates",is_global:"Is Global?",name:"Name",type:"Type"},tj={title:"Writing",library:"Architect's Library",library_desc:"Manage your Archives and Chronicles",new_notebook:"New Archivador",new_page:"New Page",index:"Index",notes:"Notes",format:"Format",empty:"Empty page...",active_notebook:"Active Archivador",open_archivador:"Open Archivador",book_title:"Book Title",placeholder_title:"The Chronicles of the Void...",create_and_open:"Create and Open",expansion:"Library Expansion",delete_confirm:"Are you sure you want to delete this archivador? All its pages will be lost.",chapter:"Chapter",page:"Page",of:"of"},rj={grid_system:"Grid System",size:"Size",canvas_data:"Canvas Data",width:"Width (px)",height:"Height (px)",background_image:"Background Image",upload_image:"Upload New Image",remove_image:"Remove Image",explorer:"World Explorer",not_found:"Map Image Not Found",upload_desc:"Upload a map image in the editor to get started",fullscreen:"Fullscreen",share:"Share",inhabitants:"Key Inhabitants",related_events:"Related Events",open_bible:"Open in Bible",place:"Place",capital:"Capital",new_map:"New Map"},nj={explore:"Explore",explorer:"Explorer",templates:"Templates",drag_attributes:"Drag Attributes",search_entity:"Search entity...",filter_type:"Filter by Type",all:"All",entities:"Entities",maps:"Maps",timelines:"Timelines",new_folder:"New Folder",new_timeline:"New Timeline",delete_folder:"Delete Folder",delete_folder_msg:"Are you sure you want to delete this folder and all its contents?",delete_entity:"Delete Entity",delete_entity_msg:"Are you sure you want to delete this entity from the Bible?",no_favorites:"No favorites yet",favorites:"Favorites",root_index:"Root Index",central_archive:"Central archive of all entities, timelines, and world geographical records.",empty_archive:"Empty Archive",empty_archive_desc:"Start by creating your first folder or timeline to organize knowledge."},ij={title:"Timeline",add_event:"Add Event",add_line:"New Timeline",edit_event:"Edit Event",edit_line:"Edit Timeline",delete_event:"Delete Event",delete_line:"Delete Timeline",events_tab:"Events",annexes_tab:"Annexes",linked_timelines:"Linked Timelines",available_timelines:"Available Timelines",multiverse:"Multiverse",new_universe:"New Universe",universe_settings:"Universe Settings",delete_universe_confirm:"Delete this universe and ALL its timelines? This cannot be undone.",select_timeline:"Select Timeline",no_events:"No events yet. Use the right panel to add one.",event_name:"Event Name",date_label:"Date Label",order:"Order (Sort)",description:"Description",save_changes:"Save Changes",create_event:"Create Event",delete_event_btn:"Delete Event",annexed_desc:"Link other localized timelines to this one to verify chronological consistency.",no_linked:"No linked timelines.",available_to_link:"Available to Link",no_available:"No other timelines available.",universe_name:"Universe Name",universe_desc:"Context for this universe...",add_timeline_here:"Add Timeline here",no_timelines:"No timelines here"},aj={title:"Linguistics",lexicon:"Lexicon",grammar:"Grammar Rules",writing_system:"Writing System",phonology:"Phonology",translator:"Translator",new_word:"Add New Word",new_rule:"Define New Rule",open_editor:"Open Editor",auto_saved:"Auto-Saved",desc:"A conlang belonging to {{projectName}}. Manage its lexicon, grammar rules, and writing systems here.",stats:{words:"Words",rules:"Rules",glyphs:"Glyphs"},search_lexicon:"Search word or meaning...",manage:"Manage",moon_script:"Moon Script",inventory:"Vowel Inventory",vectors:"Vector Symbols",upload_svg:"Upload SVG",live_stream:"Live Logographic Stream",rendered_output:"Rendered Output",source_text:"Source text here..."},sj={dashboard_desc:"Project Dashboard",welcome:"Welcome,",welcome_desc:"Your world is waiting to be shaped. Use the Codex to document entities, the Atlas to map out geographies, or the Chronicles to write its history.",codex_title:"Codex",codex_desc:"World Bible and Entity Database",atlas_title:"Atlas",atlas_desc:"Interactive Cartography and Geography",chronicles_title:"Chronicles",chronicles_desc:"Narrative Writing and Notebook Management",graph_title:"Graph",graph_desc:"Visualization of Connections and Relations",timeline_title:"Chronology",timeline_desc:"Timelines and Historical Events",linguistics_title:"Linguistics",linguistics_desc:"Conlang Creation and Glyphs",explore_tool:"Explore Tool"},oj={common:QI,nav:JI,settings:ej,writing:tj,atlas:rj,bible:nj,timeline:ij,linguistics:aj,project:sj},CM=ie.createContext(),lj={es:XI,en:oj},uj=({children:t})=>{const[e,r]=ie.useState(()=>{const a=localStorage.getItem("app_settings");if(a)try{return JSON.parse(a).language||"es"}catch{return"es"}return"es"}),n=a=>{const s=a.split(".");let o=lj[e];for(const l of s)if(o&&o[l])o=o[l];else return a;return o},i=a=>{r(a);const s=localStorage.getItem("app_settings");let o={};if(s)try{o=JSON.parse(s)}catch{}localStorage.setItem("app_settings",JSON.stringify({...o,language:a}))};return m.jsx(CM.Provider,{value:{language:e,t:n,changeLanguage:i},children:t})},Ps=()=>{const t=ie.useContext(CM);if(!t)throw new Error("useLanguage must be used within a LanguageProvider");return t},dp=({icon:t,title:e,desc:r,color:n,onClick:i,t:a})=>m.jsxs("div",{onClick:i,className:"group relative p-8 rounded-[32px] bg-surface-dark border border-white/5 hover:border-white/10 transition-all cursor-pointer flex flex-col h-full gap-6 hover:shadow-2xl hover:shadow-black/40",children:[m.jsx("div",{className:`size-14 rounded-2xl ${n} flex items-center justify-center text-white shadow-lg group-hover:scale-110 transition-all duration-500`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:t})}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-2xl font-bold text-white tracking-tight",children:e}),m.jsx("p",{className:"text-slate-500 text-sm leading-relaxed",children:r})]}),m.jsxs("div",{className:"mt-auto pt-6 border-t border-white/5 flex items-center justify-between text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-white transition-colors",children:[m.jsx("span",{children:a("project.explore_tool")}),m.jsx("span",{className:"material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform",children:"arrow_forward"})]})]}),cj=()=>{const{projectName:t}=bo(),e=Ga(),{username:r}=Va(),{t:n}=Ps(),i=`/${r}/${t}`,[a,s]=ir.useState(null);return ir.useEffect(()=>{const o=localStorage.getItem("user");o&&o!=="undefined"&&s(JSON.parse(o))},[]),m.jsxs("div",{className:"flex-1 flex flex-col h-screen overflow-hidden bg-background-dark",children:[m.jsxs("div",{className:"h-20 border-b border-white/5 flex items-center justify-between px-12 bg-surface-dark/20 backdrop-blur-xl shrink-0",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/20 flex items-center justify-center text-primary shadow-lg shadow-primary/10",children:m.jsx("span",{className:"material-symbols-outlined",children:"auto_stories"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-xl font-black text-white tracking-tight uppercase",children:t}),m.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:n("project.dashboard_desc")})]})]}),m.jsx("div",{className:"flex items-center gap-4",children:m.jsx("div",{className:"flex -space-x-2",children:m.jsx("div",{className:"size-8 rounded-full border-2 border-surface-dark bg-indigo-500 overflow-hidden flex items-center justify-center text-[10px] font-black text-white shadow-lg",children:a?.avatarUrl?m.jsx("img",{src:a.avatarUrl,alt:"Me",className:"w-full h-full object-cover"}):m.jsx("span",{children:(a?.displayName||r)?.substring(0,2).toUpperCase()})})})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:m.jsxs("div",{className:"max-w-7xl mx-auto p-12 space-y-16 animate-in fade-in slide-in-from-bottom-8 duration-700",children:[m.jsxs("div",{className:"space-y-4 max-w-2xl",children:[m.jsxs("h2",{className:"text-4xl font-black text-white tracking-tighter leading-tight",children:[n("project.welcome")," ",m.jsx("span",{className:"text-indigo-400",children:a?.displayName||n("common.architect")}),"."]}),m.jsx("p",{className:"text-slate-400 text-lg font-serif italic leading-relaxed opacity-80",children:n("project.welcome_desc")})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[m.jsx(dp,{icon:"menu_book",title:n("project.codex_title"),desc:n("project.codex_desc"),color:"bg-indigo-600 shadow-indigo-500/20",onClick:()=>e(`${i}/bible`),t:n}),m.jsx(dp,{icon:"map",title:n("project.atlas_title"),desc:n("project.atlas_desc"),color:"bg-emerald-600 shadow-emerald-500/20",onClick:()=>e(`${i}/map`),t:n}),m.jsx(dp,{icon:"edit_note",title:n("project.chronicles_title"),desc:n("project.chronicles_desc"),color:"bg-amber-600 shadow-amber-500/20",onClick:()=>e(`${i}/writing`),t:n}),m.jsx(dp,{icon:"hub",title:n("project.graph_title"),desc:n("project.graph_desc"),color:"bg-purple-600 shadow-purple-500/20",onClick:()=>e(`${i}/graph`),t:n}),m.jsx(dp,{icon:"calendar_month",title:n("project.timeline_title"),desc:n("project.timeline_desc"),color:"bg-rose-600 shadow-rose-500/20",onClick:()=>e(`${i}/timeline`),t:n}),m.jsx(dp,{icon:"translate",title:n("project.linguistics_title"),desc:n("project.linguistics_desc"),color:"bg-blue-600 shadow-blue-500/20",onClick:()=>e(`${i}/linguistics`),t:n})]})]})})]})},dj=()=>{const t=Ga(),[e,r]=ie.useState(null),[n,i]=ie.useState([]),[a,s]=ie.useState([]),[o,l]=ie.useState("general"),[u,c]=ie.useState([]),[h,p]=ie.useState({theme:"deep_space",font:"Outfit",fontSize:16});ie.useEffect(()=>{try{const O=localStorage.getItem("user");O&&O!=="undefined"&&r(JSON.parse(O));const F=localStorage.getItem("app_settings");F&&p(JSON.parse(F));const z=localStorage.getItem("sync_projects");z&&s(JSON.parse(z)),g()}catch(O){console.error("Failed to parse user settings",O)}},[]);const g=async()=>{try{const O=await Ke.get("/workspaces");O&&i(O)}catch(O){console.error("Error loading projects for sync",O)}},y=(O,F="success")=>{const z=Date.now();c(V=>[...V,{id:z,message:O,type:F}]),setTimeout(()=>{c(V=>V.filter(q=>q.id!==z))},3e3)},S=(O,F)=>{const z={...h,[O]:F};p(z),localStorage.setItem("app_settings",JSON.stringify(z)),window.dispatchEvent(new Event("storage_update")),y(`Ajuste actualizado: ${O}`)},w=O=>{const F=a.includes(O),z=F?a.filter(V=>V!==O):[...a,O];s(z),localStorage.setItem("sync_projects",JSON.stringify(z)),y(F?"Universo desmarcado de sincronizacin":"Universo incluido en sincronizacin")},C=()=>{y("Iniciando descarga de backup...","info");const O=document.createElement("a"),F="/api/backup/download",z=a.length>0?`?projects=${a.join(",")}`:"";O.href=F+z,O.setAttribute("download",`worldbuilding_backup_${Date.now()}.zip`),document.body.appendChild(O),O.click(),document.body.removeChild(O)},_=ir.useRef(null),T=async O=>{const F=O.target.files[0];if(!F)return;if(!F.name.endsWith(".db")){y("Solo se permiten archivos .db","error");return}const z=new FormData;z.append("file",F),y("Importando universo...","info");try{const V=await Ke.post("/import/database",z);y(V.message||"Universo importado con xito"),g()}catch(V){console.error("Import error",V);const q=V.response?.data?.error||"Error al importar el archivo";y(q,"error")}_.current&&(_.current.value="")},N=O=>{const F=O.target.files[0];if(!F)return;if(F.size>1024*1024){y("Imagen demasiado grande (mx 1MB)","error");return}const z=new FileReader;z.onload=V=>{const q=V.target.result,D={...e||{},avatarUrl:q};r(D);try{localStorage.setItem("user",JSON.stringify(D)),y("Foto de perfil actualizada","success")}catch(U){y("Error al guardar imagen (memoria llena)","error"),console.error("Storage error",U)}},z.readAsDataURL(F)},R=(O,F)=>{const z={...e||{},[O]:F};r(z),localStorage.setItem("user",JSON.stringify(z)),window.dispatchEvent(new Event("storage_update"))},I=[{id:"general",label:"General / Sincro",icon:"person"},{id:"appearance",label:"Apariencia y Editor",icon:"palette"}],j=[{id:"deep_space",label:"Deep Space",color:"#0f172a"},{id:"nebula",label:"Nebula",color:"#312e81"},{id:"high_contrast",label:"High Contrast",color:"#000000"}];return m.jsxs("div",{className:"flex flex-col w-full h-full bg-[#050508] text-white font-sans overflow-hidden relative",children:[m.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden opacity-50",children:[m.jsx("div",{className:"absolute -top-[10%] -left-[10%] size-[40%] bg-indigo-500/10 blur-[120px] rounded-full animate-pulse"}),m.jsx("div",{className:"absolute -bottom-[10%] -right-[10%] size-[40%] bg-purple-500/5 blur-[120px] rounded-full animate-pulse",style:{animationDelay:"1s"}})]}),m.jsx("div",{className:"fixed top-24 right-8 z-[100] flex flex-col gap-3",children:u.map(O=>m.jsxs("div",{className:"flex items-center gap-3 px-6 py-4 bg-surface-dark border border-white/10 rounded-2xl shadow-2xl animate-slide-in-right",children:[m.jsx("span",{className:`material-symbols-outlined ${O.type==="success"?"text-green-400":"text-indigo-400"}`,children:O.type==="success"?"check_circle":"info"}),m.jsx("span",{className:"text-sm font-bold",children:O.message})]},O.id))}),m.jsxs("header",{className:"h-20 flex-none flex items-center justify-between px-12 border-b border-white/5 bg-[#0a0a0e] z-30",children:[m.jsxs("div",{className:"flex items-center gap-8",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-indigo-500 flex items-center justify-center text-white shadow-lg shadow-indigo-500/20",children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:"settings"})}),m.jsx("h1",{className:"text-xl font-bold tracking-tight hidden sm:block",children:"Ajustes"})]}),m.jsx("nav",{className:"flex items-center gap-2 p-1 bg-white/5 rounded-2xl",children:I.map(O=>m.jsxs("button",{onClick:()=>l(O.id),className:`flex items-center gap-2 px-5 py-2.5 rounded-xl text-xs font-bold transition-all ${o===O.id?"bg-indigo-500 text-white shadow-lg shadow-indigo-500/20":"text-slate-400 hover:text-white hover:bg-white/5"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:O.icon}),O.label]},O.id))})]}),m.jsxs("button",{onClick:()=>t(-1),className:"flex items-center gap-2 px-6 py-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"}),m.jsx("span",{children:"Volver"})]})]}),m.jsx("main",{className:"flex-1 overflow-y-auto p-12 custom-scrollbar",children:m.jsxs("div",{className:"max-w-3xl mx-auto pb-24 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[o==="general"&&m.jsxs("div",{className:"space-y-6",children:[m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"person"}),"Perfil de Arquitecto"]}),m.jsxs("div",{className:"flex items-center gap-6 p-6 bg-white/5 rounded-3xl border border-white/5 group relative overflow-hidden",children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"}),m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"size-20 rounded-full bg-indigo-500 flex items-center justify-center text-white text-3xl font-black shadow-2xl border-4 border-white/10 overflow-hidden",children:e?.avatarUrl?m.jsx("img",{src:e.avatarUrl,alt:"Profile",className:"w-full h-full object-cover"}):e?.displayName?.substring(0,2).toUpperCase()||e?.username?.substring(0,2).toUpperCase()||"AR"}),m.jsxs("label",{className:"absolute -bottom-1 -right-1 size-8 bg-indigo-500 rounded-full flex items-center justify-center text-white cursor-pointer hover:scale-110 transition-all border-4 border-[#0f0f13] shadow-lg",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"photo_camera"}),m.jsx("input",{type:"file",accept:"image/*",onChange:N,className:"hidden"})]})]}),m.jsxs("div",{className:"flex-1 space-y-2",children:[m.jsx("input",{type:"text",value:e?.displayName??"",onChange:O=>R("displayName",O.target.value),placeholder:e?.username||"Tu nombre de arquitecto...",className:"bg-transparent border-none text-2xl font-black text-white outline-none focus:ring-0 w-full p-0 placeholder-white/20"}),m.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-indigo-400",children:"Architect Rank  Local Session"})]})]})]}),m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8 space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"sync_lock"}),"Sincronizacin y Respaldo"]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("input",{type:"file",ref:_,onChange:T,accept:".db",className:"hidden"}),m.jsxs("button",{onClick:()=>_.current?.click(),className:"flex items-center gap-2 px-6 py-3 border border-white/5 bg-white/5 hover:bg-white/10 text-white rounded-2xl text-xs font-black uppercase tracking-widest transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"upload_file"}),"Importar Universo"]}),m.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-6 py-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest transition-all shadow-lg shadow-indigo-500/30",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"cloud_download"}),"Descargar Backup ZIP"]})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 block",children:"Universos para sincronizacin"}),m.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.length>0?n.map(O=>m.jsxs("button",{onClick:()=>w(O.filename),className:`flex items-center gap-3 p-4 rounded-2xl border transition-all text-left ${a.includes(O.filename)?"border-indigo-500 bg-indigo-500/10 text-white":"border-white/5 bg-black/20 text-slate-400 hover:border-white/10"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-lg",children:a.includes(O.filename)?"check_circle":"circle"}),m.jsx("div",{className:"truncate",children:m.jsx("p",{className:"text-xs font-bold truncate",children:O.title})})]},O.filename)):m.jsx("div",{className:"col-span-2 p-8 border border-dashed border-white/5 rounded-2xl text-center text-slate-600 text-xs italic text-glass-muted",children:"No hay universos detectados..."})})]})]})]}),o==="appearance"&&m.jsxs("div",{className:"space-y-6",children:[m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"palette"}),"Esttica del Sistema"]}),m.jsx("div",{className:"grid grid-cols-3 gap-6",children:j.map(O=>m.jsxs("button",{onClick:()=>S("theme",O.id),className:`relative flex flex-col gap-3 group text-left transition-all p-3 rounded-2xl border ${h.theme===O.id?"border-indigo-500 bg-indigo-500/5 ring-1 ring-indigo-500/50":"border-white/5 bg-black/20 hover:border-white/20"}`,children:[m.jsx("div",{className:"h-24 rounded-xl flex items-center justify-center overflow-hidden",style:{backgroundColor:O.color},children:m.jsx("div",{className:"size-10 rounded-full bg-white/10 backdrop-blur-xl border border-white/10"})}),m.jsx("span",{className:"text-xs font-bold text-center",children:O.label})]},O.id))})]}),m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"text_fields"}),"Tipografa y Lectura"]}),m.jsxs("div",{className:"grid grid-cols-2 gap-12",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Fuente del Codex"}),m.jsxs("div",{className:"relative",children:[m.jsxs("select",{value:h.font,onChange:O=>S("font",O.target.value),className:"w-full bg-[#0f0f13] border border-white/10 rounded-xl px-5 py-3.5 text-sm text-white appearance-none outline-none focus:border-indigo-500 transition-all",style:{fontFamily:h.font},children:[m.jsx("option",{value:"Lexend",className:"bg-[#0f0f13] text-white",children:"Lexend (UI Moderna)"}),m.jsx("option",{value:"Outfit",className:"bg-[#0f0f13] text-white",children:"Outfit (Sleek)"}),m.jsx("option",{value:"Cormorant Garamond",className:"bg-[#0f0f13] text-white",children:"Cormorant (Legendaria)"}),m.jsx("option",{value:"Playfair Display",className:"bg-[#0f0f13] text-white",children:"Playfair (Elegante)"}),m.jsx("option",{value:"JetBrains Mono",className:"bg-[#0f0f13] text-white",children:"JetBrains Mono (Codex)"})]}),m.jsx("span",{className:"material-symbols-outlined absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500",children:"expand_more"})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Tamao del Texto"}),m.jsxs("span",{className:"text-xs font-bold text-indigo-400",children:[h.fontSize,"px"]})]}),m.jsx("div",{className:"flex items-center gap-4 py-3",children:m.jsx("input",{type:"range",min:"12",max:"24",value:h.fontSize,onChange:O=>S("fontSize",parseInt(O.target.value)),className:"flex-1 accent-indigo-500 h-1 bg-white/10 rounded-full appearance-none cursor-pointer"})})]})]}),m.jsxs("div",{className:"mt-12 space-y-4 border-t border-white/5 pt-8",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Preferencia de Idioma / Language"}),m.jsxs("div",{className:"flex gap-4",children:[m.jsxs("button",{onClick:()=>S("language","es"),className:`flex-1 py-4 rounded-2xl border transition-all flex items-center justify-center gap-3 font-bold text-xs ${h.language==="es"||!h.language?"border-primary bg-primary/10 text-white shadow-lg":"border-white/5 bg-black/20 text-slate-400"}`,children:[m.jsx("span",{className:"text-xl",children:""}),"Castellano"]}),m.jsxs("button",{onClick:()=>S("language","en"),className:`flex-1 py-4 rounded-2xl border transition-all flex items-center justify-center gap-3 font-bold text-xs ${h.language==="en"?"border-primary bg-primary/10 text-white shadow-lg":"border-white/5 bg-black/20 text-slate-400"}`,children:[m.jsx("span",{className:"text-xl",children:""}),"English"]})]})]}),m.jsx("div",{className:"mt-8 p-6 bg-black/40 rounded-2xl border border-white/5 text-center shadow-inner",children:m.jsx("p",{style:{fontFamily:h.font,fontSize:`${h.fontSize}px`},className:"text-slate-200 transition-all duration-300",children:'"El universo es un libro escrito en el lenguaje de las historias."'})})]})]})]})})]})},qv=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,confirmText:a="Confirmar",cancelText:s="Cancelar",type:o="danger"})=>t?eo.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-md bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl p-6 animate-in zoom-in-95 duration-200 overflow-hidden",children:[m.jsx("div",{className:"absolute top-0 left-0 right-0 h-32 bg-gradient-to-b from-white/5 to-transparent pointer-events-none"}),m.jsxs("div",{className:"relative z-10 text-center",children:[m.jsx("div",{className:`mx-auto mb-4 size-16 rounded-2xl flex items-center justify-center ${o==="danger"?"bg-red-500/10 text-red-500":"bg-yellow-500/10 text-yellow-500"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:o==="danger"?"delete_forever":"warning"})}),m.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:n}),m.jsx("p",{className:"text-text-muted text-sm mb-8 leading-relaxed",children:i}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{onClick:e,className:"flex-1 px-4 py-3 rounded-xl bg-surface-light hover:bg-white/10 text-text-muted hover:text-white text-xs font-bold transition-all border border-white/5",children:s}),m.jsx("button",{onClick:()=>{r(),e()},className:`flex-1 px-4 py-3 rounded-xl text-white text-xs font-bold transition-all shadow-lg flex items-center justify-center gap-2
                                ${o==="danger"?"bg-red-500 hover:bg-red-600 shadow-red-500/20":"bg-primary hover:bg-primary-light shadow-primary/20"}`,children:m.jsx("span",{children:a})})]})]})]})]}),document.body):null,hj=t=>{const e=`notebooks_v2_${t}`,[r,n]=ie.useState(()=>{const a=localStorage.getItem(e);return a?JSON.parse(a):[]});return[r,a=>{n(a),localStorage.setItem(e,JSON.stringify(a))}]},fj=({projectId:t})=>{const{t:e}=Ps(),[r,n]=hj(t||"global"),[i,a]=ie.useState(null),[s,o]=ie.useState(null),[l,u]=ie.useState(null),c=()=>{const g={id:Date.now().toString(),title:"Nuevo Cuaderno",content:"",updatedAt:new Date().toISOString()};n([g,...r]),o(g.id)},h=(g,y,S)=>{const w=r.map(C=>C.id===g?{...C,[y]:S,updatedAt:new Date().toISOString()}:C);n(w),i&&i.id===g&&a({...i,[y]:S})},p=()=>{l&&(n(r.filter(g=>g.id!==l)),i&&i.id===l&&a(null),u(null))};return i?m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark/50 animate-in slide-in-from-right-4 duration-300",children:[m.jsxs("div",{className:"flex items-center gap-2 p-3 border-b border-white/5 bg-white/[0.02]",children:[m.jsx("button",{onClick:()=>a(null),className:"p-1.5 rounded-lg hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})}),m.jsx("input",{className:"bg-transparent border-none outline-none font-bold text-white text-sm w-full placeholder-slate-600",value:i.title,onChange:g=>h(i.id,"title",g.target.value),placeholder:"Ttulo del Cuaderno..."})]}),m.jsx("textarea",{className:"flex-1 w-full bg-transparent p-4 text-sm text-slate-300 outline-none resize-none custom-scrollbar leading-relaxed",placeholder:"Escribe aqu tus ideas...",value:i.content||"",onChange:g=>h(i.id,"content",g.target.value),autoFocus:!0}),m.jsx("div",{className:"p-2 text-[10px] text-slate-600 text-right border-t border-white/5",children:i.updatedAt?`Guardado: ${new Date(i.updatedAt).toLocaleTimeString()}`:"Sin guardar"})]}):m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark/50",children:[m.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-white/5 bg-white/[0.02]",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-slate-400",children:"Tus Cuadernos"}),m.jsxs("button",{onClick:c,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-primary/20 text-primary hover:bg-primary/30 transition-all text-[10px] font-bold uppercase tracking-wide border border-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"}),"Nuevo"]})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-3 space-y-2",children:r.length===0?m.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-slate-600 space-y-2 opacity-60",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl",children:"library_books"}),m.jsx("p",{className:"text-xs",children:"No hay cuadernos"})]}):r.map(g=>m.jsxs("div",{onClick:()=>a(g),className:"group relative bg-white/5 hover:bg-white/10 border border-white/5 hover:border-primary/30 rounded-xl p-3 cursor-pointer transition-all hover:translate-x-1",children:[m.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s===g.id?m.jsx("input",{className:"bg-black/50 border border-primary/50 text-white text-xs font-bold rounded px-1 outline-none w-full mr-6",value:g.title,onChange:y=>h(g.id,"title",y.target.value),onBlur:()=>o(null),onKeyDown:y=>y.key==="Enter"&&o(null),autoFocus:!0,onClick:y=>y.stopPropagation()}):m.jsx("h4",{className:"text-xs font-bold text-white truncate pr-6",children:g.title}),m.jsx("button",{onClick:y=>{y.stopPropagation(),u(g.id)},className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 p-1 hover:text-red-400 text-slate-500 transition-all bg-surface-dark rounded-md",children:m.jsx("span",{className:"material-symbols-outlined text-[14px]",children:"delete"})})]}),m.jsx("p",{className:"text-[10px] text-slate-500 line-clamp-2",children:g.content||"Sin contenido..."})]},g.id))}),m.jsx(qv,{isOpen:!!l,onClose:()=>u(null),onConfirm:p,title:"Eliminar Cuaderno",message:"Ests seguro? Esta accin no se puede deshacer.",confirmText:"Eliminar",type:"danger"})]})},ef={UNIVERSE:{id:"UNIVERSE",label:"Universo / Multiverso",description:"Contenedor supremo de realidades.",icon:"public",color:"text-purple-400",bgColor:"bg-purple-900/20"},GALAXY:{id:"GALAXY",label:"Galaxia",description:"Agrupacin masiva de sistemas estelares.",icon:"auto_awesome",color:"text-indigo-400",bgColor:"bg-indigo-900/20"},SYSTEM:{id:"SYSTEM",label:"Sistema Solar",description:"Estrella central y sus cuerpos orbitales.",icon:"wb_sunny",color:"text-yellow-400",bgColor:"bg-yellow-900/20"},PLANET:{id:"PLANET",label:"Planeta / Mundo",description:"Cuerpo celeste o plano de existencia principal.",icon:"public",color:"text-emerald-400",bgColor:"bg-emerald-900/20"},GEOGRAPHY:{id:"GEOGRAPHY",label:"Geografa",icon:"map",color:"text-green-300"},ENTITIES:{id:"ENTITIES",label:"Entidades",icon:"groups",color:"text-blue-300"},MAGIC:{id:"MAGIC",label:"Magia",icon:"auto_fix_high",color:"text-pink-300"},TIMELINE:{id:"TIMELINE",label:"Cronologa",icon:"history",color:"text-orange-300"},FACTIONS:{id:"FACTIONS",label:"Facciones",icon:"security",color:"text-red-300"},ITEMS:{id:"ITEMS",label:"Objetos",icon:"inventory_2",color:"text-gray-300"},FOLDER:{id:"FOLDER",label:"Carpeta",icon:"folder",color:"text-gray-400"}},LS=t=>ef[t]||ef.FOLDER,pj=t=>{switch(t?.toLowerCase()){case"text":return"notes";case"short_text":return"short_text";case"number":return"pin";case"date":return"calendar_today";case"select":return"list";case"boolean":return"check_box";case"map":return"map";case"timeline":return"timeline";case"character":case"entidadindividual":return"person";case"location":case"zona":case"construccion":return"location_on";case"culture":case"entidadcolectiva":return"groups";case"universe":case"galaxy":case"system":case"planet":return"public";case"entity_link":return"link";default:return"description"}},mj=(t,e,r,n)=>{const i=r.slug||r.id;return`/${t}/${e}/bible/folder/${n||"root"}/entity/${i}`},EM=({folder:t,onCreateSubfolder:e,onRename:r,onDeleteFolder:n,onDeleteEntity:i,onCreateTemplate:a,onMoveEntity:s,onDuplicateEntity:o,onCreateEntity:l,onConfirmCreate:u,searchTerm:c,filterType:h,className:p})=>{const{username:g,projectName:y}=Va(),S=Ga(),[w,C]=ie.useState(!1),[_,T]=ie.useState({folders:[],entities:[]}),[N,R]=ie.useState(!1),[I,j]=ie.useState(null),[O,F]=ie.useState(t.nombre),[z,V]=ie.useState(!1),[q,D]=ie.useState(null);ie.useEffect(()=>{F(t.nombre)},[t.nombre]),ie.useEffect(()=>{c&&!w&&_.entities.some(se=>se.nombre.toLowerCase().includes(c.toLowerCase())&&(h==="ALL"||se.tipoEspecial===h))&&C(!0)},[c,_.entities]),ie.useEffect(()=>{const oe=se=>{const{folderId:fe,optimisticType:ae,confirmedType:pe,removeId:ye,item:ve,oldId:ue,expand:xe,type:Se}=se.detail||{};if(fe===t.id){if(xe&&(C(!0),N||U()),N)if(ae){const Oe=ae==="folder"?"folders":"entities";T(Ae=>({...Ae,[Oe]:[...Ae[Oe].filter(tt=>tt.id!==ve.id),ve]}))}else if(pe){const Oe=pe==="folder"?"folders":"entities";T(Ae=>({...Ae,[Oe]:Ae[Oe].map(tt=>tt.id===ue?ve:tt)}))}else if(ye){const Oe=Se==="folder"?"folders":"entities";T(Ae=>({...Ae,[Oe]:Ae[Oe].filter(tt=>tt.id!==ye)}))}else!ae&&!pe&&!ye&&U()}else se.detail?.targetFolderId===t.id&&se.detail?.type==="move-in"?N&&U():se.detail?.sourceFolderId===t.id&&se.detail?.type==="move-out"&&N&&T(Oe=>({...Oe,entities:Oe.entities.filter(Ae=>Ae.id!==Ae.detail.entityId)}))};return window.addEventListener("folder-update",oe),()=>window.removeEventListener("folder-update",oe)},[t.id,N]);const U=async()=>{try{console.log("Loading content for folder:",t.id,"Slug:",t.slug);const[oe,se]=await Promise.all([Ke.get(`/world-bible/folders/${t.id}/subfolders`),Ke.get(`/world-bible/folders/${t.id}/entities`)]);T({folders:oe,entities:se}),R(!0)}catch(oe){console.error("Error reloading folder content:",oe),oe.message&&oe.message.includes("404")&&console.error(`404 for folder ${t.id} (${t.nombre})`)}},G=oe=>{oe.stopPropagation(),C(!w),!N&&!w&&U()},Z=()=>S(`/${g}/${y}/bible/folder/${t.slug||t.id}`),K=(oe,se,fe,ae)=>{oe.preventDefault(),oe.stopPropagation(),j({x:oe.clientX,y:oe.clientY,type:se,id:fe,name:ae})},Q=()=>j(null);ie.useEffect(()=>{if(I)return window.addEventListener("click",Q),()=>window.removeEventListener("click",Q)},[I]);const ne=oe=>{if(oe.key==="Enter"){oe.preventDefault();const se=oe.target.value.trim();se?u(t.id,se,"folder",t.parentId,t.tipoEspecial):t.isNew&&i(t.id,t.parentId)}};if(t.isNew)return m.jsx("div",{className:"px-3 py-1 animate-in fade-in zoom-in-95 duration-200",children:m.jsx("input",{autoFocus:!0,type:"text",className:"w-full bg-surface-light border border-primary/50 rounded px-2 py-1 text-xs text-white outline-none",placeholder:"Folder Name...",onKeyDown:ne,onBlur:oe=>{const se=oe.target.value.trim();se?u(t.id,se,"folder",t.parentId):i(t.id,t.parentId)}})});const te=({item:oe,type:se})=>m.jsx("div",{className:"px-3 py-1 animate-in fade-in zoom-in-95 duration-200",children:m.jsx("input",{autoFocus:!0,type:"text",defaultValue:oe.nombre||"",className:"w-full bg-surface-light border border-primary/50 rounded px-2 py-1 text-xs text-white outline-none",placeholder:"Name...",onKeyDown:fe=>{if(fe.key==="Enter"){fe.preventDefault();const ae=fe.target.value.trim();ae?u(oe.id,ae,se,t.id,oe.tipoEspecial):oe.isNew&&i(oe.id,t.id),D(null)}else fe.key==="Escape"&&(D(null),oe.isNew&&i(oe.id,t.id))},onBlur:fe=>{const ae=fe.target.value.trim();ae?u(oe.id,ae,se,t.id,oe.tipoEspecial):oe.isNew&&i(oe.id,t.id),D(null)}})}),X=oe=>{oe.preventDefault(),oe.stopPropagation(),oe.currentTarget.classList.add("bg-primary/20")},re=oe=>{oe.preventDefault(),oe.stopPropagation(),oe.currentTarget.classList.remove("bg-primary/20")},he=oe=>{oe.preventDefault(),oe.stopPropagation(),oe.currentTarget.classList.remove("bg-primary/20");const se=oe.dataTransfer.getData("entityId"),fe=oe.dataTransfer.getData("sourceFolderId");se&&fe&&fe!==String(t.id)&&s(se,t.id,fe)};return m.jsxs("div",{className:`space-y-1 select-none ${p||""}`,children:[m.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 rounded-xl text-xs font-bold text-text-muted hover:text-white hover:bg-white/5 cursor-pointer transition-all group relative",onClick:Z,onContextMenu:oe=>K(oe,"folder",t.id,t.nombre),onDragOver:X,onDragLeave:re,onDrop:he,children:[m.jsx("span",{onClick:G,className:`material-symbols-outlined text-lg transition-transform hover:text-primary ${w?"rotate-90 text-primary":"opacity-50"}`,children:"chevron_right"}),m.jsx("span",{className:`material-symbols-outlined text-lg ${LS(t.tipo).color}`,children:LS(t.tipo).icon}),z?m.jsx("input",{autoFocus:!0,className:"bg-surface-light border border-primary/50 rounded px-2 py-0.5 text-xs text-white outline-none flex-1 min-w-0",defaultValue:O,onKeyDown:async oe=>{if(oe.key==="Enter"){oe.preventDefault(),oe.stopPropagation();const se=oe.target.value.trim();if(se&&se!==O)try{await r(t.id,se),F(se)}catch(fe){console.error("Rename failed",fe)}V(!1)}else oe.key==="Escape"&&(oe.preventDefault(),oe.stopPropagation(),V(!1))},onBlur:()=>V(!1),onClick:oe=>oe.stopPropagation()}):m.jsx("span",{className:"truncate flex-1",children:O})]}),I&&m.jsxs("div",{className:"fixed bg-surface-dark border border-glass-border shadow-2xl rounded-xl py-2 z-50 w-48 text-xs font-medium flex flex-col",style:{top:I.y,left:I.x},onClick:oe=>oe.stopPropagation(),children:[m.jsx("div",{className:"px-4 py-2 border-b border-white/5 font-bold text-text-muted truncate",children:I.name}),I.type==="folder"?m.jsxs(m.Fragment,{children:[m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{l(t.id,"entidadindividual"),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"person"})," Add Character"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{S(`/${g}/${y}/map-editor/create/${t.id}`),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"map"})," Add Map"]}),m.jsx("div",{className:"h-px bg-white/5 my-1"}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{V(!0),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," Rename Folder"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-2",onClick:()=>{n(t.id,t.parentId),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," Delete Folder"]})]}):m.jsxs(m.Fragment,{children:[m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2 cursor-pointer",onClick:()=>{D(I.id),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," Rename"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2 cursor-pointer",onClick:()=>{o(I.id,t.id),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"content_copy"})," Duplicar"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-2",onClick:()=>{i(I.id,t.id),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," Delete Entity"]})]})]}),w&&m.jsxs("div",{className:"ml-6 pl-4 border-l border-glass-border space-y-1 animate-slide-in",children:[_.folders.map(oe=>m.jsx(EM,{folder:oe,onCreateSubfolder:e,onRename:r,onDeleteFolder:n,onDeleteEntity:i,onCreateTemplate:a,onDuplicateEntity:o,onCreateEntity:l,onConfirmCreate:u,searchTerm:c,filterType:h},oe.id)),_.entities.filter(oe=>{if(!c)return!0;const se=oe.nombre.toLowerCase().includes(c.toLowerCase()),fe=h==="ALL"||oe.tipoEspecial===h;return se&&fe}).map(oe=>oe.isNew||oe.id===q?m.jsx(te,{item:oe,type:"entity"},oe.id):m.jsxs(ff,{to:mj(g,y,oe,t.slug||t.id),onContextMenu:se=>K(se,"entity",oe.id,oe.nombre),className:`flex items-center gap-3 px-3 py-2 rounded-xl text-[11px] font-medium text-text-muted hover:text-white hover:bg-primary/10 transition-all group cursor-grab active:cursor-grabbing ${oe.pending?"opacity-50 pointer-events-none":""}`,draggable:!oe.pending,onDragStart:se=>{se.dataTransfer.setData("entityId",oe.id),se.dataTransfer.setData("sourceFolderId",t.id)},children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-70 group-hover:text-primary transition-colors",children:pj(oe.tipoEspecial)}),m.jsx("span",{className:"truncate flex-1",children:oe.nombre}),oe.favorite&&m.jsx("span",{className:"material-symbols-outlined text-[10px] text-yellow-500",title:"Favorito",children:"star"})]},oe.id)),N&&_.folders.length===0&&_.entities.length===0&&m.jsx("div",{className:"px-3 py-2 text-[10px] text-text-muted/30 uppercase font-black italic tracking-tighter",children:"Empty Sector"})]})]})},gj=({isOpen:t,onClose:e,onToggle:r,contextContent:n,projectId:i,activeTab:a,setActiveTab:s,title:o,onClearContext:l,folders:u,searchTerm:c,setSearchTerm:h,filterType:p,setFilterType:g,handleCreateSimpleFolder:y,handleRenameFolder:S,handleDeleteFolder:w,handleMoveEntity:C,handleDuplicateEntity:_,handleCreateEntity:T,handleConfirmCreate:N})=>{const{t:R}=Ps();return ir.useEffect(()=>{console.log("[GlobalRightPanel] contextContent changed:",!!n,"activeTab:",a),n&&a!=="EXPLORER"&&a!=="NOTEBOOKS"&&(console.log("[GlobalRightPanel] Auto-switching to CONTEXT tab"),s("CONTEXT"))},[n,a]),m.jsxs("aside",{className:`
                fixed top-0 right-0 h-full bg-surface-dark border-l border-glass-border shadow-2xl z-40 transition-all duration-500 ease-in-out flex flex-col
                ${t?"w-96 translate-x-0":"w-96 translate-x-full"}
            `,children:[m.jsxs("button",{onClick:r,className:`
                    absolute top-1/2 -translate-y-1/2 -left-10 w-10 h-24 
                    bg-surface-dark border border-glass-border border-r-0
                    rounded-l-2xl flex flex-col items-center justify-center gap-1
                    transition-all duration-300 group
                    hover:bg-primary/10 hover:border-primary/30
                    ${t?"text-primary shadow-[-4px_0_15px_-5px_rgba(var(--primary-rgb),0.3)]":"text-slate-500"}
                `,title:t?"Cerrar Panel":"Abrir Panel",children:[m.jsx("div",{className:`w-1 h-3 rounded-full bg-current opacity-20 transition-all duration-500 ${t?"h-6 opacity-40":""}`}),m.jsx("span",{className:`material-symbols-outlined text-lg transition-transform duration-500 ${t?"rotate-180":""}`,children:"side_navigation"}),m.jsx("div",{className:`w-1 h-3 rounded-full bg-current opacity-20 transition-all duration-500 ${t?"h-6 opacity-40":""}`}),m.jsx("div",{className:"absolute inset-0 rounded-l-2xl bg-primary/5 opacity-0 group-hover:opacity-100 transition-opacity"})]}),m.jsxs("div",{className:"flex items-center border-b border-glass-border bg-white/[0.02]",children:[m.jsxs("button",{onClick:()=>s("CONTEXT"),className:`flex-1 py-4 flex items-center justify-center gap-2 text-xs font-black uppercase tracking-widest transition-colors relative ${a==="CONTEXT"?"text-primary":"text-slate-500 hover:text-white"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"view_sidebar"}),"Contexto",a==="CONTEXT"&&m.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]}),m.jsxs("button",{onClick:()=>{l&&l(),s("NOTEBOOKS")},className:`flex-1 py-4 flex items-center justify-center gap-2 text-xs font-black uppercase tracking-widest transition-colors relative ${a==="NOTEBOOKS"?"text-primary":"text-slate-500 hover:text-white"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"book"}),"Apuntes",a==="NOTEBOOKS"&&m.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]}),m.jsxs("button",{onClick:()=>{l&&l(),s("EXPLORER")},className:`flex-1 py-4 flex items-center justify-center gap-2 text-xs font-black uppercase tracking-widest transition-colors relative ${a==="EXPLORER"?"text-primary":"text-slate-500 hover:text-white"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"folder_open"}),"Explorador",a==="EXPLORER"&&m.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]})]}),o&&a==="CONTEXT"&&m.jsx("div",{className:"px-6 py-3 border-b border-glass-border bg-white/[0.01]",children:m.jsx("div",{className:"text-sm font-bold text-white tracking-tight",children:o})}),m.jsxs("div",{className:"flex-1 overflow-hidden relative bg-black/20",children:[m.jsx("div",{className:`absolute inset-0 transition-opacity duration-300 flex flex-col ${a==="CONTEXT"?"opacity-100 z-10":"opacity-0 z-0 pointer-events-none"}`,children:n||m.jsx("div",{id:"global-right-panel-portal",className:"h-full flex flex-col relative"})}),m.jsx("div",{className:`absolute inset-0 transition-opacity duration-300 flex flex-col ${a==="NOTEBOOKS"?"opacity-100 z-10":"opacity-0 z-0 pointer-events-none"}`,children:m.jsx(fj,{projectId:i})}),m.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 flex flex-col ${a==="EXPLORER"?"opacity-100 z-10":"opacity-0 z-0 pointer-events-none"}`,children:[m.jsxs("div",{className:"p-4 border-b border-glass-border",children:[m.jsxs("div",{className:"relative group mb-3",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-muted text-sm group-focus-within:text-primary transition-colors",children:"search"}),m.jsx("input",{type:"text",placeholder:R("bible.search_entity"),value:c,onChange:I=>h&&h(I.target.value),className:"w-full bg-surface-light/50 border border-glass-border rounded-xl py-2 pl-9 pr-3 text-xs focus:border-primary/50 outline-none transition-all text-white placeholder:text-text-muted/50"})]}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs("div",{className:"relative flex-1",children:[m.jsxs("select",{value:p,onChange:I=>g&&g(I.target.value),className:"appearance-none bg-surface-dark border border-glass-border rounded-xl px-4 py-2 pr-10 text-xs font-bold text-white transition-all hover:bg-slate-800/50 focus:border-primary outline-none inline-flex items-center w-full",children:[m.jsx("option",{value:"ALL",children:" TODO"}),m.jsx("option",{value:"individual",children:" PERSONAJES"}),m.jsx("option",{value:"location",children:" LUGARES"}),m.jsx("option",{value:"culture",children:" CULTURAS"}),m.jsx("option",{value:"map",children:" MAPAS"}),m.jsx("option",{value:"timeline",children:" TIMELINES"})]}),m.jsx("span",{className:"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-xs text-text-muted pointer-events-none",children:"expand_more"})]})})]}),m.jsx("div",{className:"p-4 border-b border-glass-border pt-0",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h2",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:R("bible.explorer")}),m.jsx("div",{className:"relative",children:m.jsx("button",{className:"transition-colors hover:text-white text-primary",onClick:()=>y&&y(null),title:R("bible.new_folder"),children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"create_new_folder"})})})]})}),m.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar p-2 space-y-0.5",children:u&&u.length===0?m.jsxs("div",{className:"p-8 text-center opacity-30",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl mb-2",children:"folder_off"}),m.jsx("p",{className:"text-[10px] uppercase font-bold",children:R("bible.empty_archive")})]}):u&&u.map(I=>m.jsx(EM,{folder:I,onCreateSubfolder:()=>{},onRename:S,onDeleteFolder:w,onDeleteEntity:w,onCreateTemplate:()=>{},onMoveEntity:C,onDuplicateEntity:_,onCreateEntity:T,onConfirmCreate:N,searchTerm:c,filterType:p},I.uiKey||I.id))})]})]})]})},gd=({to:t,icon:e,label:r,collapsed:n,end:i})=>m.jsxs(eI,{to:t,end:i,className:({isActive:a})=>`
            flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all group
            ${a?"bg-primary text-white shadow-lg shadow-primary/20":"text-text-muted hover:text-white hover:bg-white/5"}
            ${n?"justify-center":""}
        `,title:n?r:"",children:[m.jsx("span",{className:"material-symbols-outlined text-xl",children:e}),!n&&m.jsx("span",{className:"text-sm font-bold tracking-wide",children:r})]}),vj=()=>{console.log("ArchitectLayout Mounting");const{username:t,projectName:e,folderSlug:r}=Va(),n=Ga(),{t:i}=Ps(),a=Nf(),[s,o]=ie.useState(!0),[l,u]=ie.useState(!1),[c,h]=ie.useState("Loading..."),[p,g]=ie.useState(null),[y,S]=ie.useState(null),[w,C]=ie.useState("NOTEBOOKS"),[_,T]=ie.useState(null),[N,R]=ie.useState("DEFAULT"),[I,j]=ie.useState({name:"",description:"",type:"regional",showGrid:!0,gridSize:50,width:800,height:600,bgImage:null}),[O,F]=ie.useState(null),z=ze=>{S(ze),ze&&u(!0)},[V,q]=ie.useState("identity"),[D,U]=ie.useState("notes"),[G,Z]=ie.useState(""),[K,Q]=ie.useState("ALL"),ne=a.pathname.includes("/bible"),[te,X]=ie.useState([]),[re,he]=ie.useState(""),[oe,se]=ie.useState("ALL"),[fe,ae]=ie.useState(null);a.pathname.includes("/writing");const[pe,ye]=ie.useState("index");a.pathname.includes("/languages");const[ve,ue]=ie.useState(null),[xe,Se]=ie.useState([]),[Oe,Ae]=ie.useState("identity"),[tt,rt]=ie.useState(null),[dt,_t]=ie.useState(!1),[Xe,ht]=ie.useState(null),[ct,vt]=ie.useState(!1),[lt,Lt]=ie.useState(null),jt=async()=>{if(tt){try{await Ke.delete(`/world-bible/templates/${tt}`),setAvailableTemplates(ze=>ze.filter($e=>$e.id!==tt))}catch(ze){console.error("Delete failed",ze)}rt(null)}},Ne=async ze=>{ze.preventDefault();try{await Ke.put(`/world-bible/templates/${ve.id}`,ve),setAvailableTemplates($e=>$e.map(wt=>wt.id===ve.id?ve:wt)),ue(null)}catch($e){console.error("Update failed",$e)}},qe=`/${t}/${e}`;ie.useEffect(()=>{e&&bt()},[e]);const bt=async()=>{try{const ze=await Ke.get("/world-bible/folders");X(ze)}catch(ze){console.error("Error loading folders:",ze)}};ie.useEffect(()=>{e&&Qe(e);const ze=()=>{e&&Qe(e)};return window.addEventListener("focus",ze),()=>window.removeEventListener("focus",ze)},[e]),ie.useEffect(()=>{console.log("[ArchitectLayout] Route changed, clearing panel content"),S(null),C("CONTEXT")},[a.pathname]),ie.useEffect(()=>{ne||ae(null)},[ne]);const at=()=>u(ze=>!ze),ut=async(ze=null,$e="FOLDER")=>{try{const wt=ze?typeof ze=="object"?ze.id:ze:null,Pt=await Ke.post("/world-bible/folders",{nombre:$e==="TIMELINE"?"Nueva Timeline":"Nueva Carpeta",padreId:wt,tipo:$e});wt===null?(await bt(),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:null}}))):window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:wt,optimisticType:"folder",item:Pt,expand:!0}}))}catch(wt){console.error("Error creating simple folder:",wt)}},Fe=async(ze,$e)=>{try{await Ke.put(`/world-bible/folders/${ze}`,{nombre:$e}),X(wt=>wt.map(Pt=>Pt.id===ze?{...Pt,nombre:$e}:Pt))}catch(wt){throw wt}},de=(ze,$e=null)=>{Lt({id:ze,parentId:$e,type:"folder"}),vt(!0)},ge=async(ze,$e,wt)=>{try{await Ke.put(`/world-bible/entities/${ze}`,{carpetaId:$e}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:wt,removeId:ze,type:"entity"}})),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:$e,type:"move-in",entityId:ze}}))}catch(Pt){console.error("Move failed:",Pt)}},ke=async(ze,$e)=>{try{const wt=await Ke.get(`/world-bible/entities/${ze}`),Pt=await Ke.post("/world-bible/entities",{...wt,id:void 0,nombre:`${wt.nombre} (Copia)`,carpetaId:$e});window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:$e,type:"entity",item:Pt}}))}catch(wt){console.error("Duplicate failed:",wt)}},Ee=async(ze,$e="entidadindividual")=>{const wt=typeof ze=="object"?ze.slug||ze.id:ze;n(`${qe}/bible/folder/${wt}/entity/new/${$e}`)},Le=async(ze,$e,wt,Pt,Ct)=>{try{if(wt==="folder")typeof ze=="number"&&!ze.toString().startsWith("temp")&&(await Ke.put(`/world-bible/folders/${ze}`,{nombre:$e}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Pt,confirmedType:"folder",oldId:ze,item:{id:ze,nombre:$e,parentId:Pt,tipo:Ct,uiKey:Date.now()}}})),Pt||X(Vt=>Vt.map(Yt=>Yt.id===ze?{...Yt,nombre:$e}:Yt)));else if(wt==="entity"&&typeof ze=="string"&&ze.startsWith("new-")){const Vt=await Ke.post("/world-bible/entities",{nombre:$e,carpetaId:Pt,tipoEspecial:Ct||"entidadindividual"});window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Pt,confirmedType:"entity",oldId:ze,item:Vt}}))}}catch(Vt){console.error("Confirm create failed:",Vt)}},Qe=async ze=>{try{const $e=await Ke.get(`/proyectos/${ze}`);$e&&(h($e.nombreProyecto),g($e.id))}catch($e){console.error("Error loading project:",$e),h("Error"),n("/")}},[Ve,xt]=ie.useState(null);return ie.useEffect(()=>{const ze=localStorage.getItem("user");ze&&ze!=="undefined"&&xt(JSON.parse(ze))},[]),m.jsxs("div",{className:"flex h-screen w-full overflow-hidden bg-background-dark text-text-main font-sans selection:bg-primary/30",children:[m.jsxs("aside",{className:`
                    flex-none bg-surface-dark border-r border-glass-border transition-all duration-500 relative flex flex-col z-30
                    ${s?"w-80":"w-20"}
                `,children:[m.jsxs("div",{className:"h-16 flex items-center justify-center border-b border-glass-border relative",children:[s?m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"size-8 rounded-lg bg-surface-light flex items-center justify-center text-primary shadow-inner",children:m.jsx("span",{className:"material-symbols-outlined",children:a.pathname.includes("/writing")?"edit_note":a.pathname.includes("/graph")?"hub":a.pathname.includes("/bible")?"auto_stories":a.pathname.includes("/map")?"map":a.pathname.includes("/timeline")?"timeline":a.pathname.includes("/languages")?"translate":"auto_stories"})}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-widest text-white truncate max-w-[150px]",children:c})]}):m.jsx("button",{onClick:()=>o(!0),className:"size-10 rounded-xl hover:bg-white/5 flex items-center justify-center text-text-muted hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined",children:"menu"})}),s&&m.jsx("button",{onClick:()=>o(!1),className:"absolute right-4 text-text-muted hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"dock_to_left"})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar flex flex-col",children:m.jsxs("div",{className:"p-3 space-y-1",children:[m.jsx(gd,{to:qe,icon:"home",label:i("nav.dashboard"),collapsed:!s,end:!0}),m.jsx(gd,{to:`${qe}/bible`,icon:"menu_book",label:i("nav.bible"),collapsed:!s}),m.jsx(gd,{to:`${qe}/map`,icon:"map",label:i("nav.atlas"),collapsed:!s}),m.jsx(gd,{to:`${qe}/timeline`,icon:"calendar_month",label:i("nav.chronology"),collapsed:!s}),m.jsx(gd,{to:`${qe}/languages`,icon:"translate",label:i("nav.languages"),collapsed:!s}),m.jsx(gd,{to:`${qe}/graph`,icon:"hub",label:i("nav.graph"),collapsed:!s}),m.jsx("div",{className:"h-px bg-glass-border my-2 mx-2 opacity-50"}),m.jsx(gd,{to:`${qe}/writing`,icon:"edit_note",label:i("nav.writing"),collapsed:!s}),m.jsx("div",{className:"h-px bg-glass-border my-2 mx-2 opacity-10"}),m.jsx(gd,{to:"/",icon:"logout",label:i("nav.logout"),collapsed:!s})]})}),m.jsx("footer",{className:"p-4 border-t border-glass-border",children:m.jsxs("div",{className:`flex items-center gap-3 ${!s&&"justify-center"}`,children:[m.jsx("div",{className:"size-10 rounded-full border border-glass-border p-1 bg-surface-light relative overflow-hidden",children:Ve?.avatarUrl?m.jsx("img",{src:Ve.avatarUrl,alt:"Me",className:"w-full h-full rounded-full object-cover"}):m.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-primary to-purple-500 flex items-center justify-center text-white font-black text-xs",children:(Ve?.displayName||t)?.substring(0,2).toUpperCase()||"US"})}),s&&m.jsxs("div",{className:"overflow-hidden",children:[m.jsx("h4",{className:"text-xs font-bold text-white truncate",children:Ve?.displayName||t||"User"}),m.jsx("p",{className:"text-[10px] text-text-muted uppercase font-black tracking-tighter",children:i("common.architect")})]})]})})]}),m.jsxs("main",{className:"flex-1 flex flex-col min-w-0 bg-background-dark relative",children:[m.jsx("div",{className:"h-16 w-full absolute top-0 left-0 bg-gradient-to-b from-background-dark to-transparent pointer-events-none"}),m.jsx("div",{className:"flex-1 flex flex-col min-w-0 bg-background-dark relative overflow-hidden",children:m.jsx(Wk,{context:{setRightPanelContent:z,setRightOpen:u,toggleRightPanel:at,rightPanelTab:w,setRightPanelTab:C,setRightPanelTitle:T,setRightPanelMode:R,folderSearchTerm:G,setFolderSearchTerm:Z,folderFilterType:K,setFolderFilterType:Q,setBibleExplorerState:ae,projectId:p,mapSettings:I,setMapSettings:j,onMapSettingsChange:O,setOnMapSettingsChange:F}})}),m.jsx(gj,{isOpen:l,onClose:()=>u(!1),onToggle:at,contextContent:y,projectId:p,activeTab:w,setActiveTab:C,title:_,onClearContext:()=>S(null),folders:te,searchTerm:re,setSearchTerm:he,filterType:oe,setFilterType:se,handleCreateSimpleFolder:ut,handleRenameFolder:Fe,handleDeleteFolder:de,handleMoveEntity:ge,handleDuplicateEntity:ke,handleCreateEntity:Ee,handleConfirmCreate:Le})]}),ve&&m.jsx("div",{className:"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:m.jsxs("div",{className:"bg-surface-dark border border-glass-border rounded-2xl p-6 w-full max-w-md shadow-2xl animate-scale-in",children:[m.jsx("h3",{className:"text-xl font-black text-white mb-4",children:i("settings.edit_template")}),m.jsxs("form",{onSubmit:Ne,className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs uppercase font-bold text-text-muted block mb-1",children:i("settings.name")}),m.jsx("input",{autoFocus:!0,className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none",value:ve.nombre,onChange:ze=>ue({...ve,nombre:ze.target.value}),required:!0})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs uppercase font-bold text-text-muted block mb-1",children:i("settings.type")}),m.jsxs("select",{className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none",value:ve.tipo,onChange:ze=>ue({...ve,tipo:ze.target.value}),children:[m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"text",children:"Texto Largo"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"short_text",children:"Texto Corto"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"number",children:"Nmero"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"boolean",children:"Si/No"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"date",children:"Fecha"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"entity_link",children:"Vnculo Entidad"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"image",children:"Imagen URL"})]})]}),m.jsx("div",{className:"flex items-center",children:m.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-3 bg-white/5 rounded-xl w-full hover:bg-white/10 transition-colors",children:[m.jsx("input",{type:"checkbox",checked:ve.global,onChange:ze=>ue({...ve,global:ze.target.checked}),className:"accent-primary size-4"}),m.jsx("span",{className:"text-sm font-bold text-white",children:i("settings.is_global")})]})})]}),m.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[m.jsx("button",{type:"button",onClick:()=>ue(null),className:"px-4 py-2 text-text-muted hover:text-white font-bold transition-colors",children:i("common.cancel")}),m.jsx("button",{type:"submit",className:"px-6 py-2 bg-primary text-white rounded-xl font-bold shadow-lg shadow-primary/20 hover:scale-105 transition-transform",children:i("common.save")})]})]})]})}),m.jsx(qv,{isOpen:!!tt,onClose:()=>rt(null),onConfirm:jt,title:i("settings.delete_template"),message:i("common.are_you_sure"),confirmText:i("common.confirm_delete"),type:"danger"})]})};var zb={exports:{}},Ub,CE;function yj(){if(CE)return Ub;CE=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Ub=t,Ub}var Gb,EE;function xj(){if(EE)return Gb;EE=1;var t=yj();function e(){}function r(){}return r.resetWarningCache=e,Gb=function(){function n(s,o,l,u,c,h){if(h!==t){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}n.isRequired=n;function i(){return n}var a={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:i,element:n,elementType:n,instanceOf:i,node:n,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:r,resetWarningCache:e};return a.PropTypes=a,a},Gb}var TE;function bj(){return TE||(TE=1,zb.exports=xj()()),zb.exports}var wj=bj();const Sj=Tf(wj);function RS(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function kj(t){if(Array.isArray(t))return t}function _j(t){if(Array.isArray(t))return RS(t)}function ah(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Cj(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,NM(n.key),n)}}function sh(t,e,r){return e&&Cj(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ys(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Yk(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,s=!0,o=!1;return{s:function(){r=r.call(t)},n:function(){var l=r.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{s||r.return==null||r.return()}finally{if(o)throw a}}}}function TM(t,e,r){return(e=NM(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ej(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Tj(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,a,s,o=[],l=!0,u=!1;try{if(a=(r=r.call(t)).next,e===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}function Nj(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pj(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Di(t,e){return kj(t)||Tj(t,e)||Yk(t,e)||Nj()}function nx(t){return _j(t)||Ej(t)||Yk(t)||Pj()}function Mj(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function NM(t){var e=Mj(t,"string");return typeof e=="symbol"?e:e+""}function qi(t){"@babel/helpers - typeof";return qi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qi(t)}function Yk(t,e){if(t){if(typeof t=="string")return RS(t,e);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?RS(t,e):void 0}}var Hi=typeof window>"u"?null:window,NE=Hi?Hi.navigator:null;Hi&&Hi.document;var Aj=qi(""),PM=qi({}),Lj=qi(function(){}),Rj=typeof HTMLElement>"u"?"undefined":qi(HTMLElement),$v=function(e){return e&&e.instanceString&&ri(e.instanceString)?e.instanceString():null},Zt=function(e){return e!=null&&qi(e)==Aj},ri=function(e){return e!=null&&qi(e)===Lj},Sn=function(e){return!vo(e)&&(Array.isArray?Array.isArray(e):e!=null&&e instanceof Array)},Vr=function(e){return e!=null&&qi(e)===PM&&!Sn(e)&&e.constructor===Object},Oj=function(e){return e!=null&&qi(e)===PM},kt=function(e){return e!=null&&qi(e)===qi(1)&&!isNaN(e)},Dj=function(e){return kt(e)&&Math.floor(e)===e},ix=function(e){if(Rj!=="undefined")return e!=null&&e instanceof HTMLElement},vo=function(e){return Kv(e)||MM(e)},Kv=function(e){return $v(e)==="collection"&&e._private.single},MM=function(e){return $v(e)==="collection"&&!e._private.single},Xk=function(e){return $v(e)==="core"},AM=function(e){return $v(e)==="stylesheet"},Ij=function(e){return $v(e)==="event"},Zd=function(e){return e==null?!0:!!(e===""||e.match(/^\s+$/))},jj=function(e){return typeof HTMLElement>"u"?!1:e instanceof HTMLElement},Fj=function(e){return Vr(e)&&kt(e.x1)&&kt(e.x2)&&kt(e.y1)&&kt(e.y2)},Bj=function(e){return Oj(e)&&ri(e.then)},zj=function(){return NE&&NE.userAgent.match(/msie|trident|edge/i)},Wp=function(e,r){r||(r=function(){if(arguments.length===1)return arguments[0];if(arguments.length===0)return"undefined";for(var a=[],s=0;s<arguments.length;s++)a.push(arguments[s]);return a.join("$")});var n=function(){var a=this,s=arguments,o,l=r.apply(a,s),u=n.cache;return(o=u[l])||(o=u[l]=e.apply(a,s)),o};return n.cache={},n},Qk=Wp(function(t){return t.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}),b1=Wp(function(t){return t.replace(/(-\w)/g,function(e){return e[1].toUpperCase()})}),LM=Wp(function(t,e){return t+e[0].toUpperCase()+e.substring(1)},function(t,e){return t+"$"+e}),PE=function(e){return Zd(e)?e:e.charAt(0).toUpperCase()+e.substring(1)},Rd=function(e,r){return e.slice(-1*r.length)===r},Wi="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",Uj="rgb[a]?\\(("+Wi+"[%]?)\\s*,\\s*("+Wi+"[%]?)\\s*,\\s*("+Wi+"[%]?)(?:\\s*,\\s*("+Wi+"))?\\)",Gj="rgb[a]?\\((?:"+Wi+"[%]?)\\s*,\\s*(?:"+Wi+"[%]?)\\s*,\\s*(?:"+Wi+"[%]?)(?:\\s*,\\s*(?:"+Wi+"))?\\)",Vj="hsl[a]?\\(("+Wi+")\\s*,\\s*("+Wi+"[%])\\s*,\\s*("+Wi+"[%])(?:\\s*,\\s*("+Wi+"))?\\)",Hj="hsl[a]?\\((?:"+Wi+")\\s*,\\s*(?:"+Wi+"[%])\\s*,\\s*(?:"+Wi+"[%])(?:\\s*,\\s*(?:"+Wi+"))?\\)",Wj="\\#[0-9a-fA-F]{3}",qj="\\#[0-9a-fA-F]{6}",RM=function(e,r){return e<r?-1:e>r?1:0},$j=function(e,r){return-1*RM(e,r)},ar=Object.assign!=null?Object.assign.bind(Object):function(t){for(var e=arguments,r=1;r<e.length;r++){var n=e[r];if(n!=null)for(var i=Object.keys(n),a=0;a<i.length;a++){var s=i[a];t[s]=n[s]}}return t},Kj=function(e){if(!(!(e.length===4||e.length===7)||e[0]!=="#")){var r=e.length===4,n,i,a,s=16;return r?(n=parseInt(e[1]+e[1],s),i=parseInt(e[2]+e[2],s),a=parseInt(e[3]+e[3],s)):(n=parseInt(e[1]+e[2],s),i=parseInt(e[3]+e[4],s),a=parseInt(e[5]+e[6],s)),[n,i,a]}},Zj=function(e){var r,n,i,a,s,o,l,u;function c(y,S,w){return w<0&&(w+=1),w>1&&(w-=1),w<1/6?y+(S-y)*6*w:w<1/2?S:w<2/3?y+(S-y)*(2/3-w)*6:y}var h=new RegExp("^"+Vj+"$").exec(e);if(h){if(n=parseInt(h[1]),n<0?n=(360- -1*n%360)%360:n>360&&(n=n%360),n/=360,i=parseFloat(h[2]),i<0||i>100||(i=i/100,a=parseFloat(h[3]),a<0||a>100)||(a=a/100,s=h[4],s!==void 0&&(s=parseFloat(s),s<0||s>1)))return;if(i===0)o=l=u=Math.round(a*255);else{var p=a<.5?a*(1+i):a+i-a*i,g=2*a-p;o=Math.round(255*c(g,p,n+1/3)),l=Math.round(255*c(g,p,n)),u=Math.round(255*c(g,p,n-1/3))}r=[o,l,u,s]}return r},Yj=function(e){var r,n=new RegExp("^"+Uj+"$").exec(e);if(n){r=[];for(var i=[],a=1;a<=3;a++){var s=n[a];if(s[s.length-1]==="%"&&(i[a]=!0),s=parseFloat(s),i[a]&&(s=s/100*255),s<0||s>255)return;r.push(Math.floor(s))}var o=i[1]||i[2]||i[3],l=i[1]&&i[2]&&i[3];if(o&&!l)return;var u=n[4];if(u!==void 0){if(u=parseFloat(u),u<0||u>1)return;r.push(u)}}return r},Xj=function(e){return Qj[e.toLowerCase()]},OM=function(e){return(Sn(e)?e:null)||Xj(e)||Kj(e)||Yj(e)||Zj(e)},Qj={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},DM=function(e){for(var r=e.map,n=e.keys,i=n.length,a=0;a<i;a++){var s=n[a];if(Vr(s))throw Error("Tried to set map with object key");a<n.length-1?(r[s]==null&&(r[s]={}),r=r[s]):r[s]=e.value}},IM=function(e){for(var r=e.map,n=e.keys,i=n.length,a=0;a<i;a++){var s=n[a];if(Vr(s))throw Error("Tried to get map with object key");if(r=r[s],r==null)return r}return r},Z0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Vb,ME;function Yv(){if(ME)return Vb;ME=1;function t(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}return Vb=t,Vb}var Hb,AE;function Jj(){if(AE)return Hb;AE=1;var t=typeof Z0=="object"&&Z0&&Z0.Object===Object&&Z0;return Hb=t,Hb}var Wb,LE;function w1(){if(LE)return Wb;LE=1;var t=Jj(),e=typeof self=="object"&&self&&self.Object===Object&&self,r=t||e||Function("return this")();return Wb=r,Wb}var qb,RE;function e9(){if(RE)return qb;RE=1;var t=w1(),e=function(){return t.Date.now()};return qb=e,qb}var $b,OE;function t9(){if(OE)return $b;OE=1;var t=/\s/;function e(r){for(var n=r.length;n--&&t.test(r.charAt(n)););return n}return $b=e,$b}var Kb,DE;function r9(){if(DE)return Kb;DE=1;var t=t9(),e=/^\s+/;function r(n){return n&&n.slice(0,t(n)+1).replace(e,"")}return Kb=r,Kb}var Zb,IE;function Jk(){if(IE)return Zb;IE=1;var t=w1(),e=t.Symbol;return Zb=e,Zb}var Yb,jE;function n9(){if(jE)return Yb;jE=1;var t=Jk(),e=Object.prototype,r=e.hasOwnProperty,n=e.toString,i=t?t.toStringTag:void 0;function a(s){var o=r.call(s,i),l=s[i];try{s[i]=void 0;var u=!0}catch{}var c=n.call(s);return u&&(o?s[i]=l:delete s[i]),c}return Yb=a,Yb}var Xb,FE;function i9(){if(FE)return Xb;FE=1;var t=Object.prototype,e=t.toString;function r(n){return e.call(n)}return Xb=r,Xb}var Qb,BE;function jM(){if(BE)return Qb;BE=1;var t=Jk(),e=n9(),r=i9(),n="[object Null]",i="[object Undefined]",a=t?t.toStringTag:void 0;function s(o){return o==null?o===void 0?i:n:a&&a in Object(o)?e(o):r(o)}return Qb=s,Qb}var Jb,zE;function a9(){if(zE)return Jb;zE=1;function t(e){return e!=null&&typeof e=="object"}return Jb=t,Jb}var ew,UE;function Xv(){if(UE)return ew;UE=1;var t=jM(),e=a9(),r="[object Symbol]";function n(i){return typeof i=="symbol"||e(i)&&t(i)==r}return ew=n,ew}var tw,GE;function s9(){if(GE)return tw;GE=1;var t=r9(),e=Yv(),r=Xv(),n=NaN,i=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt;function l(u){if(typeof u=="number")return u;if(r(u))return n;if(e(u)){var c=typeof u.valueOf=="function"?u.valueOf():u;u=e(c)?c+"":c}if(typeof u!="string")return u===0?u:+u;u=t(u);var h=a.test(u);return h||s.test(u)?o(u.slice(2),h?2:8):i.test(u)?n:+u}return tw=l,tw}var rw,VE;function o9(){if(VE)return rw;VE=1;var t=Yv(),e=e9(),r=s9(),n="Expected a function",i=Math.max,a=Math.min;function s(o,l,u){var c,h,p,g,y,S,w=0,C=!1,_=!1,T=!0;if(typeof o!="function")throw new TypeError(n);l=r(l)||0,t(u)&&(C=!!u.leading,_="maxWait"in u,p=_?i(r(u.maxWait)||0,l):p,T="trailing"in u?!!u.trailing:T);function N(D){var U=c,G=h;return c=h=void 0,w=D,g=o.apply(G,U),g}function R(D){return w=D,y=setTimeout(O,l),C?N(D):g}function I(D){var U=D-S,G=D-w,Z=l-U;return _?a(Z,p-G):Z}function j(D){var U=D-S,G=D-w;return S===void 0||U>=l||U<0||_&&G>=p}function O(){var D=e();if(j(D))return F(D);y=setTimeout(O,I(D))}function F(D){return y=void 0,T&&c?N(D):(c=h=void 0,g)}function z(){y!==void 0&&clearTimeout(y),w=0,c=S=h=y=void 0}function V(){return y===void 0?g:F(e())}function q(){var D=e(),U=j(D);if(c=arguments,h=this,S=D,U){if(y===void 0)return R(S);if(_)return clearTimeout(y),y=setTimeout(O,l),N(S)}return y===void 0&&(y=setTimeout(O,l)),g}return q.cancel=z,q.flush=V,q}return rw=s,rw}var l9=o9(),Qv=Zv(l9),nw=Hi?Hi.performance:null,FM=nw&&nw.now?function(){return nw.now()}:function(){return Date.now()},u9=(function(){if(Hi){if(Hi.requestAnimationFrame)return function(t){Hi.requestAnimationFrame(t)};if(Hi.mozRequestAnimationFrame)return function(t){Hi.mozRequestAnimationFrame(t)};if(Hi.webkitRequestAnimationFrame)return function(t){Hi.webkitRequestAnimationFrame(t)};if(Hi.msRequestAnimationFrame)return function(t){Hi.msRequestAnimationFrame(t)}}return function(t){t&&setTimeout(function(){t(FM())},1e3/60)}})(),ax=function(e){return u9(e)},vc=FM,Yh=9261,BM=65599,Cp=5381,zM=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Yh,n=r,i;i=e.next(),!i.done;)n=n*BM+i.value|0;return n},yv=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Yh;return r*BM+e|0},xv=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Cp;return(r<<5)+r+e|0},c9=function(e,r){return e*2097152+r},vd=function(e){return e[0]*2097152+e[1]},Y0=function(e,r){return[yv(e[0],r[0]),xv(e[1],r[1])]},HE=function(e,r){var n={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?n.value=e[i++]:n.done=!0,n}};return zM(s,r)},pf=function(e,r){var n={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?n.value=e.charCodeAt(i++):n.done=!0,n}};return zM(s,r)},UM=function(){return d9(arguments)},d9=function(e){for(var r,n=0;n<e.length;n++){var i=e[n];n===0?r=pf(i):r=pf(i,r)}return r};function h9(t,e,r,n,i){var a=i*Math.PI/180,s=Math.cos(a)*(t-r)-Math.sin(a)*(e-n)+r,o=Math.sin(a)*(t-r)+Math.cos(a)*(e-n)+n;return{x:s,y:o}}var f9=function(e,r,n,i,a,s){return{x:(e-n)*a+n,y:(r-i)*s+i}};function p9(t,e,r){if(r===0)return t;var n=(e.x1+e.x2)/2,i=(e.y1+e.y2)/2,a=e.w/e.h,s=1/a,o=h9(t.x,t.y,n,i,r),l=f9(o.x,o.y,n,i,a,s);return{x:l.x,y:l.y}}var WE=!0,m9=console.warn!=null,g9=console.trace!=null,e_=Number.MAX_SAFE_INTEGER||9007199254740991,GM=function(){return!0},sx=function(){return!1},qE=function(){return 0},t_=function(){},Kn=function(e){throw new Error(e)},VM=function(e){if(e!==void 0)WE=!!e;else return WE},an=function(e){VM()&&(m9?console.warn(e):(console.log(e),g9&&console.trace()))},v9=function(e){return ar({},e)},ku=function(e){return e==null?e:Sn(e)?e.slice():Vr(e)?v9(e):e},y9=function(e){return e.slice()},HM=function(e,r){for(r=e="";e++<36;r+=e*51&52?(e^15?8^Math.random()*(e^20?16:4):4).toString(16):"-");return r},x9={},WM=function(){return x9},Ha=function(e){var r=Object.keys(e);return function(n){for(var i={},a=0;a<r.length;a++){var s=r[a],o=n?.[s];i[s]=o===void 0?e[s]:o}return i}},Yd=function(e,r,n){for(var i=e.length-1;i>=0;i--)e[i]===r&&e.splice(i,1)},r_=function(e){e.splice(0,e.length)},b9=function(e,r){for(var n=0;n<r.length;n++){var i=r[n];e.push(i)}},$s=function(e,r,n){return n&&(r=LM(n,r)),e[r]},cc=function(e,r,n,i){n&&(r=LM(n,r)),e[r]=i},w9=(function(){function t(){ah(this,t),this._obj={}}return sh(t,[{key:"set",value:function(r,n){return this._obj[r]=n,this}},{key:"delete",value:function(r){return this._obj[r]=void 0,this}},{key:"clear",value:function(){this._obj={}}},{key:"has",value:function(r){return this._obj[r]!==void 0}},{key:"get",value:function(r){return this._obj[r]}}])})(),dc=typeof Map<"u"?Map:w9,S9="undefined",k9=(function(){function t(e){if(ah(this,t),this._obj=Object.create(null),this.size=0,e!=null){var r;e.instanceString!=null&&e.instanceString()===this.instanceString()?r=e.toArray():r=e;for(var n=0;n<r.length;n++)this.add(r[n])}}return sh(t,[{key:"instanceString",value:function(){return"set"}},{key:"add",value:function(r){var n=this._obj;n[r]!==1&&(n[r]=1,this.size++)}},{key:"delete",value:function(r){var n=this._obj;n[r]===1&&(n[r]=0,this.size--)}},{key:"clear",value:function(){this._obj=Object.create(null)}},{key:"has",value:function(r){return this._obj[r]===1}},{key:"toArray",value:function(){var r=this;return Object.keys(this._obj).filter(function(n){return r.has(n)})}},{key:"forEach",value:function(r,n){return this.toArray().forEach(r,n)}}])})(),um=(typeof Set>"u"?"undefined":qi(Set))!==S9?Set:k9,S1=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(e===void 0||r===void 0||!Xk(e)){Kn("An element must have a core reference and parameters set");return}var i=r.group;if(i==null&&(r.data&&r.data.source!=null&&r.data.target!=null?i="edges":i="nodes"),i!=="nodes"&&i!=="edges"){Kn("An element must be of type `nodes` or `edges`; you specified `"+i+"`");return}this.length=1,this[0]=this;var a=this._private={cy:e,single:!0,data:r.data||{},position:r.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group:i,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!r.selected,selectable:r.selectable===void 0?!0:!!r.selectable,locked:!!r.locked,grabbed:!1,grabbable:r.grabbable===void 0?!0:!!r.grabbable,pannable:r.pannable===void 0?i==="edges":!!r.pannable,active:!1,classes:new um,animation:{current:[],queue:[]},rscratch:{},scratch:r.scratch||{},edges:[],children:[],parent:r.parent&&r.parent.isNode()?r.parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(a.position.x==null&&(a.position.x=0),a.position.y==null&&(a.position.y=0),r.renderedPosition){var s=r.renderedPosition,o=e.pan(),l=e.zoom();a.position={x:(s.x-o.x)/l,y:(s.y-o.y)/l}}var u=[];Sn(r.classes)?u=r.classes:Zt(r.classes)&&(u=r.classes.split(/\s+/));for(var c=0,h=u.length;c<h;c++){var p=u[c];!p||p===""||a.classes.add(p)}this.createEmitter(),(n===void 0||n)&&this.restore();var g=r.style||r.css;g&&(an("Setting a `style` bypass at element creation should be done only when absolutely necessary.  Try to use the stylesheet instead."),this.style(g))},$E=function(e){return e={bfs:e.bfs||!e.dfs,dfs:e.dfs||!e.bfs},function(n,i,a){var s;Vr(n)&&!vo(n)&&(s=n,n=s.roots||s.root,i=s.visit,a=s.directed),a=arguments.length===2&&!ri(i)?i:a,i=ri(i)?i:function(){};for(var o=this._private.cy,l=n=Zt(n)?this.filter(n):n,u=[],c=[],h={},p={},g={},y=0,S,w=this.byGroup(),C=w.nodes,_=w.edges,T=0;T<l.length;T++){var N=l[T],R=N.id();N.isNode()&&(u.unshift(N),e.bfs&&(g[R]=!0,c.push(N)),p[R]=0)}for(var I=function(){var D=e.bfs?u.shift():u.pop(),U=D.id();if(e.dfs){if(g[U])return 0;g[U]=!0,c.push(D)}var G=p[U],Z=h[U],K=Z!=null?Z.source():null,Q=Z!=null?Z.target():null,ne=Z==null?void 0:D.same(K)?Q[0]:K[0],te;if(te=i(D,Z,ne,y++,G),te===!0)return S=D,1;if(te===!1)return 1;for(var X=D.connectedEdges().filter(function(fe){return(!a||fe.source().same(D))&&_.has(fe)}),re=0;re<X.length;re++){var he=X[re],oe=he.connectedNodes().filter(function(fe){return!fe.same(D)&&C.has(fe)}),se=oe.id();oe.length!==0&&!g[se]&&(oe=oe[0],u.push(oe),e.bfs&&(g[se]=!0,c.push(oe)),h[se]=he,p[se]=p[U]+1)}},j;u.length!==0&&(j=I(),!(j!==0&&j===1)););for(var O=o.collection(),F=0;F<c.length;F++){var z=c[F],V=h[z.id()];V!=null&&O.push(V),O.push(z)}return{path:o.collection(O),found:o.collection(S)}}},bv={breadthFirstSearch:$E({bfs:!0}),depthFirstSearch:$E({dfs:!0})};bv.bfs=bv.breadthFirstSearch;bv.dfs=bv.depthFirstSearch;var Oy={exports:{}},_9=Oy.exports,KE;function C9(){return KE||(KE=1,(function(t,e){(function(){var r,n,i,a,s,o,l,u,c,h,p,g,y,S,w;i=Math.floor,h=Math.min,n=function(C,_){return C<_?-1:C>_?1:0},c=function(C,_,T,N,R){var I;if(T==null&&(T=0),R==null&&(R=n),T<0)throw new Error("lo must be non-negative");for(N==null&&(N=C.length);T<N;)I=i((T+N)/2),R(_,C[I])<0?N=I:T=I+1;return[].splice.apply(C,[T,T-T].concat(_)),_},o=function(C,_,T){return T==null&&(T=n),C.push(_),S(C,0,C.length-1,T)},s=function(C,_){var T,N;return _==null&&(_=n),T=C.pop(),C.length?(N=C[0],C[0]=T,w(C,0,_)):N=T,N},u=function(C,_,T){var N;return T==null&&(T=n),N=C[0],C[0]=_,w(C,0,T),N},l=function(C,_,T){var N;return T==null&&(T=n),C.length&&T(C[0],_)<0&&(N=[C[0],_],_=N[0],C[0]=N[1],w(C,0,T)),_},a=function(C,_){var T,N,R,I,j,O;for(_==null&&(_=n),I=(function(){O=[];for(var F=0,z=i(C.length/2);0<=z?F<z:F>z;0<=z?F++:F--)O.push(F);return O}).apply(this).reverse(),j=[],N=0,R=I.length;N<R;N++)T=I[N],j.push(w(C,T,_));return j},y=function(C,_,T){var N;if(T==null&&(T=n),N=C.indexOf(_),N!==-1)return S(C,0,N,T),w(C,N,T)},p=function(C,_,T){var N,R,I,j,O;if(T==null&&(T=n),R=C.slice(0,_),!R.length)return R;for(a(R,T),O=C.slice(_),I=0,j=O.length;I<j;I++)N=O[I],l(R,N,T);return R.sort(T).reverse()},g=function(C,_,T){var N,R,I,j,O,F,z,V,q;if(T==null&&(T=n),_*10<=C.length){if(I=C.slice(0,_).sort(T),!I.length)return I;for(R=I[I.length-1],z=C.slice(_),j=0,F=z.length;j<F;j++)N=z[j],T(N,R)<0&&(c(I,N,0,null,T),I.pop(),R=I[I.length-1]);return I}for(a(C,T),q=[],O=0,V=h(_,C.length);0<=V?O<V:O>V;0<=V?++O:--O)q.push(s(C,T));return q},S=function(C,_,T,N){var R,I,j;for(N==null&&(N=n),R=C[T];T>_;){if(j=T-1>>1,I=C[j],N(R,I)<0){C[T]=I,T=j;continue}break}return C[T]=R},w=function(C,_,T){var N,R,I,j,O;for(T==null&&(T=n),R=C.length,O=_,I=C[_],N=2*_+1;N<R;)j=N+1,j<R&&!(T(C[N],C[j])<0)&&(N=j),C[_]=C[N],_=N,N=2*_+1;return C[_]=I,S(C,O,_,T)},r=(function(){C.push=o,C.pop=s,C.replace=u,C.pushpop=l,C.heapify=a,C.updateItem=y,C.nlargest=p,C.nsmallest=g;function C(_){this.cmp=_??n,this.nodes=[]}return C.prototype.push=function(_){return o(this.nodes,_,this.cmp)},C.prototype.pop=function(){return s(this.nodes,this.cmp)},C.prototype.peek=function(){return this.nodes[0]},C.prototype.contains=function(_){return this.nodes.indexOf(_)!==-1},C.prototype.replace=function(_){return u(this.nodes,_,this.cmp)},C.prototype.pushpop=function(_){return l(this.nodes,_,this.cmp)},C.prototype.heapify=function(){return a(this.nodes,this.cmp)},C.prototype.updateItem=function(_){return y(this.nodes,_,this.cmp)},C.prototype.clear=function(){return this.nodes=[]},C.prototype.empty=function(){return this.nodes.length===0},C.prototype.size=function(){return this.nodes.length},C.prototype.clone=function(){var _;return _=new C,_.nodes=this.nodes.slice(0),_},C.prototype.toArray=function(){return this.nodes.slice(0)},C.prototype.insert=C.prototype.push,C.prototype.top=C.prototype.peek,C.prototype.front=C.prototype.peek,C.prototype.has=C.prototype.contains,C.prototype.copy=C.prototype.clone,C})(),(function(C,_){return t.exports=_()})(this,function(){return r})}).call(_9)})(Oy)),Oy.exports}var iw,ZE;function E9(){return ZE||(ZE=1,iw=C9()),iw}var T9=E9(),Jv=Zv(T9),N9=Ha({root:null,weight:function(e){return 1},directed:!1}),P9={dijkstra:function(e){if(!Vr(e)){var r=arguments;e={root:r[0],weight:r[1],directed:r[2]}}var n=N9(e),i=n.root,a=n.weight,s=n.directed,o=this,l=a,u=Zt(i)?this.filter(i)[0]:i[0],c={},h={},p={},g=this.byGroup(),y=g.nodes,S=g.edges;S.unmergeBy(function(G){return G.isLoop()});for(var w=function(Z){return c[Z.id()]},C=function(Z,K){c[Z.id()]=K,_.updateItem(Z)},_=new Jv(function(G,Z){return w(G)-w(Z)}),T=0;T<y.length;T++){var N=y[T];c[N.id()]=N.same(u)?0:1/0,_.push(N)}for(var R=function(Z,K){for(var Q=(s?Z.edgesTo(K):Z.edgesWith(K)).intersect(S),ne=1/0,te,X=0;X<Q.length;X++){var re=Q[X],he=l(re);(he<ne||!te)&&(ne=he,te=re)}return{edge:te,dist:ne}};_.size()>0;){var I=_.pop(),j=w(I),O=I.id();if(p[O]=j,j!==1/0)for(var F=I.neighborhood().intersect(y),z=0;z<F.length;z++){var V=F[z],q=V.id(),D=R(I,V),U=j+D.dist;U<w(V)&&(C(V,U),h[q]={node:I,edge:D.edge})}}return{distanceTo:function(Z){var K=Zt(Z)?y.filter(Z)[0]:Z[0];return p[K.id()]},pathTo:function(Z){var K=Zt(Z)?y.filter(Z)[0]:Z[0],Q=[],ne=K,te=ne.id();if(K.length>0)for(Q.unshift(K);h[te];){var X=h[te];Q.unshift(X.edge),Q.unshift(X.node),ne=X.node,te=ne.id()}return o.spawn(Q)}}}},M9={kruskal:function(e){e=e||function(T){return 1};for(var r=this.byGroup(),n=r.nodes,i=r.edges,a=n.length,s=new Array(a),o=n,l=function(N){for(var R=0;R<s.length;R++){var I=s[R];if(I.has(N))return R}},u=0;u<a;u++)s[u]=this.spawn(n[u]);for(var c=i.sort(function(T,N){return e(T)-e(N)}),h=0;h<c.length;h++){var p=c[h],g=p.source()[0],y=p.target()[0],S=l(g),w=l(y),C=s[S],_=s[w];S!==w&&(o.merge(p),C.merge(_),s.splice(w,1))}return o}},A9=Ha({root:null,goal:null,weight:function(e){return 1},heuristic:function(e){return 0},directed:!1}),L9={aStar:function(e){var r=this.cy(),n=A9(e),i=n.root,a=n.goal,s=n.heuristic,o=n.directed,l=n.weight;i=r.collection(i)[0],a=r.collection(a)[0];var u=i.id(),c=a.id(),h={},p={},g={},y=new Jv(function(te,X){return p[te.id()]-p[X.id()]}),S=new um,w={},C={},_=function(X,re){y.push(X),S.add(re)},T,N,R=function(){T=y.pop(),N=T.id(),S.delete(N)},I=function(X){return S.has(X)};_(i,u),h[u]=0,p[u]=s(i);for(var j=0;y.size()>0;){if(R(),j++,N===c){for(var O=[],F=a,z=c,V=C[z];O.unshift(F),V!=null&&O.unshift(V),F=w[z],F!=null;)z=F.id(),V=C[z];return{found:!0,distance:h[N],path:this.spawn(O),steps:j}}g[N]=!0;for(var q=T._private.edges,D=0;D<q.length;D++){var U=q[D];if(this.hasElementWithId(U.id())&&!(o&&U.data("source")!==N)){var G=U.source(),Z=U.target(),K=G.id()!==N?G:Z,Q=K.id();if(this.hasElementWithId(Q)&&!g[Q]){var ne=h[N]+l(U);if(!I(Q)){h[Q]=ne,p[Q]=ne+s(K),_(K,Q),w[Q]=T,C[Q]=U;continue}ne<h[Q]&&(h[Q]=ne,p[Q]=ne+s(K),w[Q]=T,C[Q]=U)}}}}return{found:!1,distance:void 0,path:void 0,steps:j}}},R9=Ha({weight:function(e){return 1},directed:!1}),O9={floydWarshall:function(e){for(var r=this.cy(),n=R9(e),i=n.weight,a=n.directed,s=i,o=this.byGroup(),l=o.nodes,u=o.edges,c=l.length,h=c*c,p=function(he){return l.indexOf(he)},g=function(he){return l[he]},y=new Array(h),S=0;S<h;S++){var w=S%c,C=(S-w)/c;C===w?y[S]=0:y[S]=1/0}for(var _=new Array(h),T=new Array(h),N=0;N<u.length;N++){var R=u[N],I=R.source()[0],j=R.target()[0];if(I!==j){var O=p(I),F=p(j),z=O*c+F,V=s(R);if(y[z]>V&&(y[z]=V,_[z]=F,T[z]=R),!a){var q=F*c+O;!a&&y[q]>V&&(y[q]=V,_[q]=O,T[q]=R)}}}for(var D=0;D<c;D++)for(var U=0;U<c;U++)for(var G=U*c+D,Z=0;Z<c;Z++){var K=U*c+Z,Q=D*c+Z;y[G]+y[Q]<y[K]&&(y[K]=y[G]+y[Q],_[K]=_[G])}var ne=function(he){return(Zt(he)?r.filter(he):he)[0]},te=function(he){return p(ne(he))},X={distance:function(he,oe){var se=te(he),fe=te(oe);return y[se*c+fe]},path:function(he,oe){var se=te(he),fe=te(oe),ae=g(se);if(se===fe)return ae.collection();if(_[se*c+fe]==null)return r.collection();var pe=r.collection(),ye=se,ve;for(pe.merge(ae);se!==fe;)ye=se,se=_[se*c+fe],ve=T[ye*c+se],pe.merge(ve),pe.merge(g(se));return pe}};return X}},D9=Ha({weight:function(e){return 1},directed:!1,root:null}),I9={bellmanFord:function(e){var r=this,n=D9(e),i=n.weight,a=n.directed,s=n.root,o=i,l=this,u=this.cy(),c=this.byGroup(),h=c.edges,p=c.nodes,g=p.length,y=new dc,S=!1,w=[];s=u.collection(s)[0],h.unmergeBy(function(rt){return rt.isLoop()});for(var C=h.length,_=function(dt){var _t=y.get(dt.id());return _t||(_t={},y.set(dt.id(),_t)),_t},T=function(dt){return(Zt(dt)?u.$(dt):dt)[0]},N=function(dt){return _(T(dt)).dist},R=function(dt){for(var _t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s,Xe=T(dt),ht=[],ct=Xe;;){if(ct==null)return r.spawn();var vt=_(ct),lt=vt.edge,Lt=vt.pred;if(ht.unshift(ct[0]),ct.same(_t)&&ht.length>0)break;lt!=null&&ht.unshift(lt),ct=Lt}return l.spawn(ht)},I=0;I<g;I++){var j=p[I],O=_(j);j.same(s)?O.dist=0:O.dist=1/0,O.pred=null,O.edge=null}for(var F=!1,z=function(dt,_t,Xe,ht,ct,vt){var lt=ht.dist+vt;lt<ct.dist&&!Xe.same(ht.edge)&&(ct.dist=lt,ct.pred=dt,ct.edge=Xe,F=!0)},V=1;V<g;V++){F=!1;for(var q=0;q<C;q++){var D=h[q],U=D.source(),G=D.target(),Z=o(D),K=_(U),Q=_(G);z(U,G,D,K,Q,Z),a||z(G,U,D,Q,K,Z)}if(!F)break}if(F)for(var ne=[],te=0;te<C;te++){var X=h[te],re=X.source(),he=X.target(),oe=o(X),se=_(re).dist,fe=_(he).dist;if(se+oe<fe||!a&&fe+oe<se)if(S||(an("Graph contains a negative weight cycle for Bellman-Ford"),S=!0),e.findNegativeWeightCycles!==!1){var ae=[];se+oe<fe&&ae.push(re),!a&&fe+oe<se&&ae.push(he);for(var pe=ae.length,ye=0;ye<pe;ye++){var ve=ae[ye],ue=[ve];ue.push(_(ve).edge);for(var xe=_(ve).pred;ue.indexOf(xe)===-1;)ue.push(xe),ue.push(_(xe).edge),xe=_(xe).pred;ue=ue.slice(ue.indexOf(xe));for(var Se=ue[0].id(),Oe=0,Ae=2;Ae<ue.length;Ae+=2)ue[Ae].id()<Se&&(Se=ue[Ae].id(),Oe=Ae);ue=ue.slice(Oe).concat(ue.slice(0,Oe)),ue.push(ue[0]);var tt=ue.map(function(rt){return rt.id()}).join(",");ne.indexOf(tt)===-1&&(w.push(l.spawn(ue)),ne.push(tt))}}else break}return{distanceTo:N,pathTo:R,hasNegativeWeightCycle:S,negativeWeightCycles:w}}},j9=Math.sqrt(2),F9=function(e,r,n){n.length===0&&Kn("Karger-Stein must be run on a connected (sub)graph");for(var i=n[e],a=i[1],s=i[2],o=r[a],l=r[s],u=n,c=u.length-1;c>=0;c--){var h=u[c],p=h[1],g=h[2];(r[p]===o&&r[g]===l||r[p]===l&&r[g]===o)&&u.splice(c,1)}for(var y=0;y<u.length;y++){var S=u[y];S[1]===l?(u[y]=S.slice(),u[y][1]=o):S[2]===l&&(u[y]=S.slice(),u[y][2]=o)}for(var w=0;w<r.length;w++)r[w]===l&&(r[w]=o);return u},aw=function(e,r,n,i){for(;n>i;){var a=Math.floor(Math.random()*r.length);r=F9(a,e,r),n--}return r},B9={kargerStein:function(){var e=this,r=this.byGroup(),n=r.nodes,i=r.edges;i.unmergeBy(function(Q){return Q.isLoop()});var a=n.length,s=i.length,o=Math.ceil(Math.pow(Math.log(a)/Math.LN2,2)),l=Math.floor(a/j9);if(a<2){Kn("At least 2 nodes are required for Karger-Stein algorithm");return}for(var u=[],c=0;c<s;c++){var h=i[c];u.push([c,n.indexOf(h.source()),n.indexOf(h.target())])}for(var p=1/0,g=[],y=new Array(a),S=new Array(a),w=new Array(a),C=function(ne,te){for(var X=0;X<a;X++)te[X]=ne[X]},_=0;_<=o;_++){for(var T=0;T<a;T++)S[T]=T;var N=aw(S,u.slice(),a,l),R=N.slice();C(S,w);var I=aw(S,N,l,2),j=aw(w,R,l,2);I.length<=j.length&&I.length<p?(p=I.length,g=I,C(S,y)):j.length<=I.length&&j.length<p&&(p=j.length,g=j,C(w,y))}for(var O=this.spawn(g.map(function(Q){return i[Q[0]]})),F=this.spawn(),z=this.spawn(),V=y[0],q=0;q<y.length;q++){var D=y[q],U=n[q];D===V?F.merge(U):z.merge(U)}var G=function(ne){var te=e.spawn();return ne.forEach(function(X){te.merge(X),X.connectedEdges().forEach(function(re){e.contains(re)&&!O.contains(re)&&te.merge(re)})}),te},Z=[G(F),G(z)],K={cut:O,components:Z,partition1:F,partition2:z};return K}},sw,z9=function(e){return{x:e.x,y:e.y}},k1=function(e,r,n){return{x:e.x*r+n.x,y:e.y*r+n.y}},qM=function(e,r,n){return{x:(e.x-n.x)/r,y:(e.y-n.y)/r}},Lp=function(e){return{x:e[0],y:e[1]}},U9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=1/0,a=r;a<n;a++){var s=e[a];isFinite(s)&&(i=Math.min(s,i))}return i},G9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=-1/0,a=r;a<n;a++){var s=e[a];isFinite(s)&&(i=Math.max(s,i))}return i},V9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=0,a=0,s=r;s<n;s++){var o=e[s];isFinite(o)&&(i+=o,a++)}return i/a},H9=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0;i?e=e.slice(r,n):(n<e.length&&e.splice(n,e.length-n),r>0&&e.splice(0,r));for(var o=0,l=e.length-1;l>=0;l--){var u=e[l];s?isFinite(u)||(e[l]=-1/0,o++):e.splice(l,1)}a&&e.sort(function(p,g){return p-g});var c=e.length,h=Math.floor(c/2);return c%2!==0?e[h+1+o]:(e[h-1+o]+e[h+o])/2},W9=function(e){return Math.PI*e/180},X0=function(e,r){return Math.atan2(r,e)-Math.PI/2},n_=Math.log2||function(t){return Math.log(t)/Math.log(2)},i_=function(e){return e>0?1:e<0?-1:0},mf=function(e,r){return Math.sqrt($h(e,r))},$h=function(e,r){var n=r.x-e.x,i=r.y-e.y;return n*n+i*i},q9=function(e){for(var r=e.length,n=0,i=0;i<r;i++)n+=e[i];for(var a=0;a<r;a++)e[a]=e[a]/n;return e},da=function(e,r,n,i){return(1-i)*(1-i)*e+2*(1-i)*i*r+i*i*n},jp=function(e,r,n,i){return{x:da(e.x,r.x,n.x,i),y:da(e.y,r.y,n.y,i)}},$9=function(e,r,n,i){var a={x:r.x-e.x,y:r.y-e.y},s=mf(e,r),o={x:a.x/s,y:a.y/s};return n=n??0,i=i??n*s,{x:e.x+o.x*i,y:e.y+o.y*i}},wv=function(e,r,n){return Math.max(e,Math.min(n,r))},Es=function(e){if(e==null)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(e.x1!=null&&e.y1!=null){if(e.x2!=null&&e.y2!=null&&e.x2>=e.x1&&e.y2>=e.y1)return{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,w:e.x2-e.x1,h:e.y2-e.y1};if(e.w!=null&&e.h!=null&&e.w>=0&&e.h>=0)return{x1:e.x1,y1:e.y1,x2:e.x1+e.w,y2:e.y1+e.h,w:e.w,h:e.h}}},K9=function(e){return{x1:e.x1,x2:e.x2,w:e.w,y1:e.y1,y2:e.y2,h:e.h}},Z9=function(e){e.x1=1/0,e.y1=1/0,e.x2=-1/0,e.y2=-1/0,e.w=0,e.h=0},Y9=function(e,r){e.x1=Math.min(e.x1,r.x1),e.x2=Math.max(e.x2,r.x2),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,r.y1),e.y2=Math.max(e.y2,r.y2),e.h=e.y2-e.y1},$M=function(e,r,n){e.x1=Math.min(e.x1,r),e.x2=Math.max(e.x2,r),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,n),e.y2=Math.max(e.y2,n),e.h=e.y2-e.y1},Dy=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.x1-=r,e.x2+=r,e.y1-=r,e.y2+=r,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},Iy=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0],n,i,a,s;if(r.length===1)n=i=a=s=r[0];else if(r.length===2)n=a=r[0],s=i=r[1];else if(r.length===4){var o=Di(r,4);n=o[0],i=o[1],a=o[2],s=o[3]}return e.x1-=s,e.x2+=i,e.y1-=n,e.y2+=a,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},YE=function(e,r){e.x1=r.x1,e.y1=r.y1,e.x2=r.x2,e.y2=r.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1},a_=function(e,r){return!(e.x1>r.x2||r.x1>e.x2||e.x2<r.x1||r.x2<e.x1||e.y2<r.y1||r.y2<e.y1||e.y1>r.y2||r.y1>e.y2)},Od=function(e,r,n){return e.x1<=r&&r<=e.x2&&e.y1<=n&&n<=e.y2},XE=function(e,r){return Od(e,r.x,r.y)},KM=function(e,r){return Od(e,r.x1,r.y1)&&Od(e,r.x2,r.y2)},X9=(sw=Math.hypot)!==null&&sw!==void 0?sw:function(t,e){return Math.sqrt(t*t+e*e)};function Q9(t,e){if(t.length<3)throw new Error("Need at least 3 vertices");var r=function(O,F){return{x:O.x+F.x,y:O.y+F.y}},n=function(O,F){return{x:O.x-F.x,y:O.y-F.y}},i=function(O,F){return{x:O.x*F,y:O.y*F}},a=function(O,F){return O.x*F.y-O.y*F.x},s=function(O){var F=X9(O.x,O.y);return F===0?{x:0,y:0}:{x:O.x/F,y:O.y/F}},o=function(O){for(var F=0,z=0;z<O.length;z++){var V=O[z],q=O[(z+1)%O.length];F+=V.x*q.y-q.x*V.y}return F/2},l=function(O,F,z,V){var q=n(F,O),D=n(V,z),U=a(q,D);if(Math.abs(U)<1e-9)return r(O,i(q,.5));var G=a(n(z,O),D)/U;return r(O,i(q,G))},u=t.map(function(j){return{x:j.x,y:j.y}});o(u)<0&&u.reverse();for(var c=u.length,h=[],p=0;p<c;p++){var g=u[p],y=u[(p+1)%c],S=n(y,g),w=s({x:S.y,y:-S.x});h.push(w)}for(var C=h.map(function(j,O){var F=r(u[O],i(j,e)),z=r(u[(O+1)%c],i(j,e));return{p1:F,p2:z}}),_=[],T=0;T<c;T++){var N=C[(T-1+c)%c],R=C[T],I=l(N.p1,N.p2,R.p1,R.p2);_.push(I)}return _}function J9(t,e,r,n,i,a){var s=lF(t,e,r,n,i),o=Q9(s,a),l=Es();return o.forEach(function(u){return $M(l,u.x,u.y)}),l}var ZM=function(e,r,n,i,a,s,o){var l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:"auto",u=l==="auto"?Xd(a,s):l,c=a/2,h=s/2;u=Math.min(u,c,h);var p=u!==c,g=u!==h,y;if(p){var S=n-c+u-o,w=i-h-o,C=n+c-u+o,_=w;if(y=Dd(e,r,n,i,S,w,C,_,!1),y.length>0)return y}if(g){var T=n+c+o,N=i-h+u-o,R=T,I=i+h-u+o;if(y=Dd(e,r,n,i,T,N,R,I,!1),y.length>0)return y}if(p){var j=n-c+u-o,O=i+h+o,F=n+c-u+o,z=O;if(y=Dd(e,r,n,i,j,O,F,z,!1),y.length>0)return y}if(g){var V=n-c-o,q=i-h+u-o,D=V,U=i+h-u+o;if(y=Dd(e,r,n,i,V,q,D,U,!1),y.length>0)return y}var G;{var Z=n-c+u,K=i-h+u;if(G=Hg(e,r,n,i,Z,K,u+o),G.length>0&&G[0]<=Z&&G[1]<=K)return[G[0],G[1]]}{var Q=n+c-u,ne=i-h+u;if(G=Hg(e,r,n,i,Q,ne,u+o),G.length>0&&G[0]>=Q&&G[1]<=ne)return[G[0],G[1]]}{var te=n+c-u,X=i+h-u;if(G=Hg(e,r,n,i,te,X,u+o),G.length>0&&G[0]>=te&&G[1]>=X)return[G[0],G[1]]}{var re=n-c+u,he=i+h-u;if(G=Hg(e,r,n,i,re,he,u+o),G.length>0&&G[0]<=re&&G[1]>=he)return[G[0],G[1]]}return[]},eF=function(e,r,n,i,a,s,o){var l=o,u=Math.min(n,a),c=Math.max(n,a),h=Math.min(i,s),p=Math.max(i,s);return u-l<=e&&e<=c+l&&h-l<=r&&r<=p+l},tF=function(e,r,n,i,a,s,o,l,u){var c={x1:Math.min(n,o,a)-u,x2:Math.max(n,o,a)+u,y1:Math.min(i,l,s)-u,y2:Math.max(i,l,s)+u};return!(e<c.x1||e>c.x2||r<c.y1||r>c.y2)},rF=function(e,r,n,i){n-=i;var a=r*r-4*e*n;if(a<0)return[];var s=Math.sqrt(a),o=2*e,l=(-r+s)/o,u=(-r-s)/o;return[l,u]},nF=function(e,r,n,i,a){var s=1e-5;e===0&&(e=s),r/=e,n/=e,i/=e;var o,l,u,c,h,p,g,y;if(l=(3*n-r*r)/9,u=-(27*i)+r*(9*n-2*(r*r)),u/=54,o=l*l*l+u*u,a[1]=0,g=r/3,o>0){h=u+Math.sqrt(o),h=h<0?-Math.pow(-h,1/3):Math.pow(h,1/3),p=u-Math.sqrt(o),p=p<0?-Math.pow(-p,1/3):Math.pow(p,1/3),a[0]=-g+h+p,g+=(h+p)/2,a[4]=a[2]=-g,g=Math.sqrt(3)*(-p+h)/2,a[3]=g,a[5]=-g;return}if(a[5]=a[3]=0,o===0){y=u<0?-Math.pow(-u,1/3):Math.pow(u,1/3),a[0]=-g+2*y,a[4]=a[2]=-(y+g);return}l=-l,c=l*l*l,c=Math.acos(u/Math.sqrt(c)),y=2*Math.sqrt(l),a[0]=-g+y*Math.cos(c/3),a[2]=-g+y*Math.cos((c+2*Math.PI)/3),a[4]=-g+y*Math.cos((c+4*Math.PI)/3)},iF=function(e,r,n,i,a,s,o,l){var u=1*n*n-4*n*a+2*n*o+4*a*a-4*a*o+o*o+i*i-4*i*s+2*i*l+4*s*s-4*s*l+l*l,c=9*n*a-3*n*n-3*n*o-6*a*a+3*a*o+9*i*s-3*i*i-3*i*l-6*s*s+3*s*l,h=3*n*n-6*n*a+n*o-n*e+2*a*a+2*a*e-o*e+3*i*i-6*i*s+i*l-i*r+2*s*s+2*s*r-l*r,p=1*n*a-n*n+n*e-a*e+i*s-i*i+i*r-s*r,g=[];nF(u,c,h,p,g);for(var y=1e-7,S=[],w=0;w<6;w+=2)Math.abs(g[w+1])<y&&g[w]>=0&&g[w]<=1&&S.push(g[w]);S.push(1),S.push(0);for(var C=-1,_,T,N,R=0;R<S.length;R++)_=Math.pow(1-S[R],2)*n+2*(1-S[R])*S[R]*a+S[R]*S[R]*o,T=Math.pow(1-S[R],2)*i+2*(1-S[R])*S[R]*s+S[R]*S[R]*l,N=Math.pow(_-e,2)+Math.pow(T-r,2),C>=0?N<C&&(C=N):C=N;return C},aF=function(e,r,n,i,a,s){var o=[e-n,r-i],l=[a-n,s-i],u=l[0]*l[0]+l[1]*l[1],c=o[0]*o[0]+o[1]*o[1],h=o[0]*l[0]+o[1]*l[1],p=h*h/u;return h<0?c:p>u?(e-a)*(e-a)+(r-s)*(r-s):c-p},Ks=function(e,r,n){for(var i,a,s,o,l,u=0,c=0;c<n.length/2;c++)if(i=n[c*2],a=n[c*2+1],c+1<n.length/2?(s=n[(c+1)*2],o=n[(c+1)*2+1]):(s=n[(c+1-n.length/2)*2],o=n[(c+1-n.length/2)*2+1]),!(i==e&&s==e))if(i>=e&&e>=s||i<=e&&e<=s)l=(e-i)/(s-i)*(o-a)+a,l>r&&u++;else continue;return u%2!==0},yc=function(e,r,n,i,a,s,o,l,u){var c=new Array(n.length),h;l[0]!=null?(h=Math.atan(l[1]/l[0]),l[0]<0?h=h+Math.PI/2:h=-h-Math.PI/2):h=l;for(var p=Math.cos(-h),g=Math.sin(-h),y=0;y<c.length/2;y++)c[y*2]=s/2*(n[y*2]*p-n[y*2+1]*g),c[y*2+1]=o/2*(n[y*2+1]*p+n[y*2]*g),c[y*2]+=i,c[y*2+1]+=a;var S;if(u>0){var w=lx(c,-u);S=ox(w)}else S=c;return Ks(e,r,S)},sF=function(e,r,n,i,a,s,o,l){for(var u=new Array(n.length*2),c=0;c<l.length;c++){var h=l[c];u[c*4+0]=h.startX,u[c*4+1]=h.startY,u[c*4+2]=h.stopX,u[c*4+3]=h.stopY;var p=Math.pow(h.cx-e,2)+Math.pow(h.cy-r,2);if(p<=Math.pow(h.radius,2))return!0}return Ks(e,r,u)},ox=function(e){for(var r=new Array(e.length/2),n,i,a,s,o,l,u,c,h=0;h<e.length/4;h++){n=e[h*4],i=e[h*4+1],a=e[h*4+2],s=e[h*4+3],h<e.length/4-1?(o=e[(h+1)*4],l=e[(h+1)*4+1],u=e[(h+1)*4+2],c=e[(h+1)*4+3]):(o=e[0],l=e[1],u=e[2],c=e[3]);var p=Dd(n,i,a,s,o,l,u,c,!0);r[h*2]=p[0],r[h*2+1]=p[1]}return r},lx=function(e,r){for(var n=new Array(e.length*2),i,a,s,o,l=0;l<e.length/2;l++){i=e[l*2],a=e[l*2+1],l<e.length/2-1?(s=e[(l+1)*2],o=e[(l+1)*2+1]):(s=e[0],o=e[1]);var u=o-a,c=-(s-i),h=Math.sqrt(u*u+c*c),p=u/h,g=c/h;n[l*4]=i+p*r,n[l*4+1]=a+g*r,n[l*4+2]=s+p*r,n[l*4+3]=o+g*r}return n},oF=function(e,r,n,i,a,s){var o=n-e,l=i-r;o/=a,l/=s;var u=Math.sqrt(o*o+l*l),c=u-1;if(c<0)return[];var h=c/u;return[(n-e)*h+e,(i-r)*h+r]},tf=function(e,r,n,i,a,s,o){return e-=a,r-=s,e/=n/2+o,r/=i/2+o,e*e+r*r<=1},Hg=function(e,r,n,i,a,s,o){var l=[n-e,i-r],u=[e-a,r-s],c=l[0]*l[0]+l[1]*l[1],h=2*(u[0]*l[0]+u[1]*l[1]),p=u[0]*u[0]+u[1]*u[1]-o*o,g=h*h-4*c*p;if(g<0)return[];var y=(-h+Math.sqrt(g))/(2*c),S=(-h-Math.sqrt(g))/(2*c),w=Math.min(y,S),C=Math.max(y,S),_=[];if(w>=0&&w<=1&&_.push(w),C>=0&&C<=1&&_.push(C),_.length===0)return[];var T=_[0]*l[0]+e,N=_[0]*l[1]+r;if(_.length>1){if(_[0]==_[1])return[T,N];var R=_[1]*l[0]+e,I=_[1]*l[1]+r;return[T,N,R,I]}else return[T,N]},ow=function(e,r,n){return r<=e&&e<=n||n<=e&&e<=r?e:e<=r&&r<=n||n<=r&&r<=e?r:n},Dd=function(e,r,n,i,a,s,o,l,u){var c=e-a,h=n-e,p=o-a,g=r-s,y=i-r,S=l-s,w=p*g-S*c,C=h*g-y*c,_=S*h-p*y;if(_!==0){var T=w/_,N=C/_,R=.001,I=0-R,j=1+R;return I<=T&&T<=j&&I<=N&&N<=j?[e+T*h,r+T*y]:u?[e+T*h,r+T*y]:[]}else return w===0||C===0?ow(e,n,o)===o?[o,l]:ow(e,n,a)===a?[a,s]:ow(a,o,n)===n?[n,i]:[]:[]},lF=function(e,r,n,i,a){var s=[],o=i/2,l=a/2,u=r,c=n;s.push({x:u+o*e[0],y:c+l*e[1]});for(var h=1;h<e.length/2;h++)s.push({x:u+o*e[h*2],y:c+l*e[h*2+1]});return s},Sv=function(e,r,n,i,a,s,o,l){var u=[],c,h=new Array(n.length),p=!0;s==null&&(p=!1);var g;if(p){for(var y=0;y<h.length/2;y++)h[y*2]=n[y*2]*s+i,h[y*2+1]=n[y*2+1]*o+a;if(l>0){var S=lx(h,-l);g=ox(S)}else g=h}else g=n;for(var w,C,_,T,N=0;N<g.length/2;N++)w=g[N*2],C=g[N*2+1],N<g.length/2-1?(_=g[(N+1)*2],T=g[(N+1)*2+1]):(_=g[0],T=g[1]),c=Dd(e,r,i,a,w,C,_,T),c.length!==0&&u.push(c[0],c[1]);return u},uF=function(e,r,n,i,a,s,o,l,u){var c=[],h,p=new Array(n.length*2);u.forEach(function(_,T){T===0?(p[p.length-2]=_.startX,p[p.length-1]=_.startY):(p[T*4-2]=_.startX,p[T*4-1]=_.startY),p[T*4]=_.stopX,p[T*4+1]=_.stopY,h=Hg(e,r,i,a,_.cx,_.cy,_.radius),h.length!==0&&c.push(h[0],h[1])});for(var g=0;g<p.length/4;g++)h=Dd(e,r,i,a,p[g*4],p[g*4+1],p[g*4+2],p[g*4+3],!1),h.length!==0&&c.push(h[0],h[1]);if(c.length>2){for(var y=[c[0],c[1]],S=Math.pow(y[0]-e,2)+Math.pow(y[1]-r,2),w=1;w<c.length/2;w++){var C=Math.pow(c[w*2]-e,2)+Math.pow(c[w*2+1]-r,2);C<=S&&(y[0]=c[w*2],y[1]=c[w*2+1],S=C)}return y}return c},Q0=function(e,r,n){var i=[e[0]-r[0],e[1]-r[1]],a=Math.sqrt(i[0]*i[0]+i[1]*i[1]),s=(a-n)/a;return s<0&&(s=1e-5),[r[0]+s*i[0],r[1]+s*i[1]]},Cs=function(e,r){var n=OS(e,r);return n=YM(n),n},YM=function(e){for(var r,n,i=e.length/2,a=1/0,s=1/0,o=-1/0,l=-1/0,u=0;u<i;u++)r=e[2*u],n=e[2*u+1],a=Math.min(a,r),o=Math.max(o,r),s=Math.min(s,n),l=Math.max(l,n);for(var c=2/(o-a),h=2/(l-s),p=0;p<i;p++)r=e[2*p]=e[2*p]*c,n=e[2*p+1]=e[2*p+1]*h,a=Math.min(a,r),o=Math.max(o,r),s=Math.min(s,n),l=Math.max(l,n);if(s<-1)for(var g=0;g<i;g++)n=e[2*g+1]=e[2*g+1]+(-1-s);return e},OS=function(e,r){var n=1/e*2*Math.PI,i=e%2===0?Math.PI/2+n/2:Math.PI/2;i+=r;for(var a=new Array(e*2),s,o=0;o<e;o++)s=o*n+i,a[2*o]=Math.cos(s),a[2*o+1]=Math.sin(-s);return a},Xd=function(e,r){return Math.min(e/4,r/4,8)},XM=function(e,r){return Math.min(e/10,r/10,8)},s_=function(){return 8},cF=function(e,r,n){return[e-2*r+n,2*(r-e),e]},DS=function(e,r){return{heightOffset:Math.min(15,.05*r),widthOffset:Math.min(100,.25*e),ctrlPtOffsetPct:.05}};function lw(t,e){function r(h){for(var p=[],g=0;g<h.length;g++){var y=h[g],S=h[(g+1)%h.length],w={x:S.x-y.x,y:S.y-y.y},C={x:-w.y,y:w.x},_=Math.sqrt(C.x*C.x+C.y*C.y);p.push({x:C.x/_,y:C.y/_})}return p}function n(h,p){var g=1/0,y=-1/0,S=Ys(h),w;try{for(S.s();!(w=S.n()).done;){var C=w.value,_=C.x*p.x+C.y*p.y;g=Math.min(g,_),y=Math.max(y,_)}}catch(T){S.e(T)}finally{S.f()}return{min:g,max:y}}function i(h,p){return!(h.max<p.min||p.max<h.min)}var a=[].concat(nx(r(t)),nx(r(e))),s=Ys(a),o;try{for(s.s();!(o=s.n()).done;){var l=o.value,u=n(t,l),c=n(e,l);if(!i(u,c))return!1}}catch(h){s.e(h)}finally{s.f()}return!0}var dF=Ha({dampingFactor:.8,precision:1e-6,iterations:200,weight:function(e){return 1}}),hF={pageRank:function(e){for(var r=dF(e),n=r.dampingFactor,i=r.precision,a=r.iterations,s=r.weight,o=this._private.cy,l=this.byGroup(),u=l.nodes,c=l.edges,h=u.length,p=h*h,g=c.length,y=new Array(p),S=new Array(h),w=(1-n)/h,C=0;C<h;C++){for(var _=0;_<h;_++){var T=C*h+_;y[T]=0}S[C]=0}for(var N=0;N<g;N++){var R=c[N],I=R.data("source"),j=R.data("target");if(I!==j){var O=u.indexOfId(I),F=u.indexOfId(j),z=s(R),V=F*h+O;y[V]+=z,S[O]+=z}}for(var q=1/h+w,D=0;D<h;D++)if(S[D]===0)for(var U=0;U<h;U++){var G=U*h+D;y[G]=q}else for(var Z=0;Z<h;Z++){var K=Z*h+D;y[K]=y[K]/S[D]+w}for(var Q=new Array(h),ne=new Array(h),te,X=0;X<h;X++)Q[X]=1;for(var re=0;re<a;re++){for(var he=0;he<h;he++)ne[he]=0;for(var oe=0;oe<h;oe++)for(var se=0;se<h;se++){var fe=oe*h+se;ne[oe]+=y[fe]*Q[se]}q9(ne),te=Q,Q=ne,ne=te;for(var ae=0,pe=0;pe<h;pe++){var ye=te[pe]-Q[pe];ae+=ye*ye}if(ae<i)break}var ve={rank:function(xe){return xe=o.collection(xe)[0],Q[u.indexOf(xe)]}};return ve}},QE=Ha({root:null,weight:function(e){return 1},directed:!1,alpha:0}),Fp={degreeCentralityNormalized:function(e){e=QE(e);var r=this.cy(),n=this.nodes(),i=n.length;if(e.directed){for(var c={},h={},p=0,g=0,y=0;y<i;y++){var S=n[y],w=S.id();e.root=S;var C=this.degreeCentrality(e);p<C.indegree&&(p=C.indegree),g<C.outdegree&&(g=C.outdegree),c[w]=C.indegree,h[w]=C.outdegree}return{indegree:function(T){return p==0?0:(Zt(T)&&(T=r.filter(T)),c[T.id()]/p)},outdegree:function(T){return g===0?0:(Zt(T)&&(T=r.filter(T)),h[T.id()]/g)}}}else{for(var a={},s=0,o=0;o<i;o++){var l=n[o];e.root=l;var u=this.degreeCentrality(e);s<u.degree&&(s=u.degree),a[l.id()]=u.degree}return{degree:function(T){return s===0?0:(Zt(T)&&(T=r.filter(T)),a[T.id()]/s)}}}},degreeCentrality:function(e){e=QE(e);var r=this.cy(),n=this,i=e,a=i.root,s=i.weight,o=i.directed,l=i.alpha;if(a=r.collection(a)[0],o){for(var g=a.connectedEdges(),y=g.filter(function(I){return I.target().same(a)&&n.has(I)}),S=g.filter(function(I){return I.source().same(a)&&n.has(I)}),w=y.length,C=S.length,_=0,T=0,N=0;N<y.length;N++)_+=s(y[N]);for(var R=0;R<S.length;R++)T+=s(S[R]);return{indegree:Math.pow(w,1-l)*Math.pow(_,l),outdegree:Math.pow(C,1-l)*Math.pow(T,l)}}else{for(var u=a.connectedEdges().intersection(n),c=u.length,h=0,p=0;p<u.length;p++)h+=s(u[p]);return{degree:Math.pow(c,1-l)*Math.pow(h,l)}}}};Fp.dc=Fp.degreeCentrality;Fp.dcn=Fp.degreeCentralityNormalised=Fp.degreeCentralityNormalized;var JE=Ha({harmonic:!0,weight:function(){return 1},directed:!1,root:null}),Bp={closenessCentralityNormalized:function(e){for(var r=JE(e),n=r.harmonic,i=r.weight,a=r.directed,s=this.cy(),o={},l=0,u=this.nodes(),c=this.floydWarshall({weight:i,directed:a}),h=0;h<u.length;h++){for(var p=0,g=u[h],y=0;y<u.length;y++)if(h!==y){var S=c.distance(g,u[y]);n?p+=1/S:p+=S}n||(p=1/p),l<p&&(l=p),o[g.id()]=p}return{closeness:function(C){return l==0?0:(Zt(C)?C=s.filter(C)[0].id():C=C.id(),o[C]/l)}}},closenessCentrality:function(e){var r=JE(e),n=r.root,i=r.weight,a=r.directed,s=r.harmonic;n=this.filter(n)[0];for(var o=this.dijkstra({root:n,weight:i,directed:a}),l=0,u=this.nodes(),c=0;c<u.length;c++){var h=u[c];if(!h.same(n)){var p=o.distanceTo(h);s?l+=1/p:l+=p}}return s?l:1/l}};Bp.cc=Bp.closenessCentrality;Bp.ccn=Bp.closenessCentralityNormalised=Bp.closenessCentralityNormalized;var fF=Ha({weight:null,directed:!1}),IS={betweennessCentrality:function(e){for(var r=fF(e),n=r.directed,i=r.weight,a=i!=null,s=this.cy(),o=this.nodes(),l={},u={},c=0,h={set:function(T,N){u[T]=N,N>c&&(c=N)},get:function(T){return u[T]}},p=0;p<o.length;p++){var g=o[p],y=g.id();n?l[y]=g.outgoers().nodes():l[y]=g.openNeighborhood().nodes(),h.set(y,0)}for(var S=function(){for(var T=o[w].id(),N=[],R={},I={},j={},O=new Jv(function(oe,se){return j[oe]-j[se]}),F=0;F<o.length;F++){var z=o[F].id();R[z]=[],I[z]=0,j[z]=1/0}for(I[T]=1,j[T]=0,O.push(T);!O.empty();){var V=O.pop();if(N.push(V),a)for(var q=0;q<l[V].length;q++){var D=l[V][q],U=s.getElementById(V),G=void 0;U.edgesTo(D).length>0?G=U.edgesTo(D)[0]:G=D.edgesTo(U)[0];var Z=i(G);D=D.id(),j[D]>j[V]+Z&&(j[D]=j[V]+Z,O.nodes.indexOf(D)<0?O.push(D):O.updateItem(D),I[D]=0,R[D]=[]),j[D]==j[V]+Z&&(I[D]=I[D]+I[V],R[D].push(V))}else for(var K=0;K<l[V].length;K++){var Q=l[V][K].id();j[Q]==1/0&&(O.push(Q),j[Q]=j[V]+1),j[Q]==j[V]+1&&(I[Q]=I[Q]+I[V],R[Q].push(V))}}for(var ne={},te=0;te<o.length;te++)ne[o[te].id()]=0;for(;N.length>0;){for(var X=N.pop(),re=0;re<R[X].length;re++){var he=R[X][re];ne[he]=ne[he]+I[he]/I[X]*(1+ne[X])}X!=o[w].id()&&h.set(X,h.get(X)+ne[X])}},w=0;w<o.length;w++)S();var C={betweenness:function(T){var N=s.collection(T).id();return h.get(N)},betweennessNormalized:function(T){if(c==0)return 0;var N=s.collection(T).id();return h.get(N)/c}};return C.betweennessNormalised=C.betweennessNormalized,C}};IS.bc=IS.betweennessCentrality;var pF=Ha({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(t){return 1}]}),mF=function(e){return pF(e)},gF=function(e,r){for(var n=0,i=0;i<r.length;i++)n+=r[i](e);return n},vF=function(e,r,n){for(var i=0;i<r;i++)e[i*r+i]=n},QM=function(e,r){for(var n,i=0;i<r;i++){n=0;for(var a=0;a<r;a++)n+=e[a*r+i];for(var s=0;s<r;s++)e[s*r+i]=e[s*r+i]/n}},yF=function(e,r,n){for(var i=new Array(n*n),a=0;a<n;a++){for(var s=0;s<n;s++)i[a*n+s]=0;for(var o=0;o<n;o++)for(var l=0;l<n;l++)i[a*n+l]+=e[a*n+o]*r[o*n+l]}return i},xF=function(e,r,n){for(var i=e.slice(0),a=1;a<n;a++)e=yF(e,i,r);return e},bF=function(e,r,n){for(var i=new Array(r*r),a=0;a<r*r;a++)i[a]=Math.pow(e[a],n);return QM(i,r),i},wF=function(e,r,n,i){for(var a=0;a<n;a++){var s=Math.round(e[a]*Math.pow(10,i))/Math.pow(10,i),o=Math.round(r[a]*Math.pow(10,i))/Math.pow(10,i);if(s!==o)return!1}return!0},SF=function(e,r,n,i){for(var a=[],s=0;s<r;s++){for(var o=[],l=0;l<r;l++)Math.round(e[s*r+l]*1e3)/1e3>0&&o.push(n[l]);o.length!==0&&a.push(i.collection(o))}return a},kF=function(e,r){for(var n=0;n<e.length;n++)if(!r[n]||e[n].id()!==r[n].id())return!1;return!0},_F=function(e){for(var r=0;r<e.length;r++)for(var n=0;n<e.length;n++)r!=n&&kF(e[r],e[n])&&e.splice(n,1);return e},eT=function(e){for(var r=this.nodes(),n=this.edges(),i=this.cy(),a=mF(e),s={},o=0;o<r.length;o++)s[r[o].id()]=o;for(var l=r.length,u=l*l,c=new Array(u),h,p=0;p<u;p++)c[p]=0;for(var g=0;g<n.length;g++){var y=n[g],S=s[y.source().id()],w=s[y.target().id()],C=gF(y,a.attributes);c[S*l+w]+=C,c[w*l+S]+=C}vF(c,l,a.multFactor),QM(c,l);for(var _=!0,T=0;_&&T<a.maxIterations;)_=!1,h=xF(c,l,a.expandFactor),c=bF(h,l,a.inflateFactor),wF(c,h,u,4)||(_=!0),T++;var N=SF(c,l,r,i);return N=_F(N),N},CF={markovClustering:eT,mcl:eT},EF=function(e){return e},JM=function(e,r){return Math.abs(r-e)},tT=function(e,r,n){return e+JM(r,n)},rT=function(e,r,n){return e+Math.pow(n-r,2)},TF=function(e){return Math.sqrt(e)},NF=function(e,r,n){return Math.max(e,JM(r,n))},Um=function(e,r,n,i,a){for(var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:EF,o=i,l,u,c=0;c<e;c++)l=r(c),u=n(c),o=a(o,l,u);return s(o)},qp={euclidean:function(e,r,n){return e>=2?Um(e,r,n,0,rT,TF):Um(e,r,n,0,tT)},squaredEuclidean:function(e,r,n){return Um(e,r,n,0,rT)},manhattan:function(e,r,n){return Um(e,r,n,0,tT)},max:function(e,r,n){return Um(e,r,n,-1/0,NF)}};qp["squared-euclidean"]=qp.squaredEuclidean;qp.squaredeuclidean=qp.squaredEuclidean;function _1(t,e,r,n,i,a){var s;return ri(t)?s=t:s=qp[t]||qp.euclidean,e===0&&ri(t)?s(i,a):s(e,r,n,i,a)}var PF=Ha({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),o_=function(e){return PF(e)},ux=function(e,r,n,i,a){var s=a!=="kMedoids",o=s?function(h){return n[h]}:function(h){return i[h](n)},l=function(p){return i[p](r)},u=n,c=r;return _1(e,i.length,o,l,u,c)},uw=function(e,r,n){for(var i=n.length,a=new Array(i),s=new Array(i),o=new Array(r),l=null,u=0;u<i;u++)a[u]=e.min(n[u]).value,s[u]=e.max(n[u]).value;for(var c=0;c<r;c++){l=[];for(var h=0;h<i;h++)l[h]=Math.random()*(s[h]-a[h])+a[h];o[c]=l}return o},eA=function(e,r,n,i,a){for(var s=1/0,o=0,l=0;l<r.length;l++){var u=ux(n,e,r[l],i,a);u<s&&(s=u,o=l)}return o},tA=function(e,r,n){for(var i=[],a=null,s=0;s<r.length;s++)a=r[s],n[a.id()]===e&&i.push(a);return i},MF=function(e,r,n){return Math.abs(r-e)<=n},AF=function(e,r,n){for(var i=0;i<e.length;i++)for(var a=0;a<e[i].length;a++){var s=Math.abs(e[i][a]-r[i][a]);if(s>n)return!1}return!0},LF=function(e,r,n){for(var i=0;i<n;i++)if(e===r[i])return!0;return!1},nT=function(e,r){var n=new Array(r);if(e.length<50)for(var i=0;i<r;i++){for(var a=e[Math.floor(Math.random()*e.length)];LF(a,n,i);)a=e[Math.floor(Math.random()*e.length)];n[i]=a}else for(var s=0;s<r;s++)n[s]=e[Math.floor(Math.random()*e.length)];return n},iT=function(e,r,n){for(var i=0,a=0;a<r.length;a++)i+=ux("manhattan",r[a],e,n,"kMedoids");return i},RF=function(e){var r=this.cy(),n=this.nodes(),i=null,a=o_(e),s=new Array(a.k),o={},l;a.testMode?typeof a.testCentroids=="number"?(a.testCentroids,l=uw(n,a.k,a.attributes)):qi(a.testCentroids)==="object"?l=a.testCentroids:l=uw(n,a.k,a.attributes):l=uw(n,a.k,a.attributes);for(var u=!0,c=0;u&&c<a.maxIterations;){for(var h=0;h<n.length;h++)i=n[h],o[i.id()]=eA(i,l,a.distance,a.attributes,"kMeans");u=!1;for(var p=0;p<a.k;p++){var g=tA(p,n,o);if(g.length!==0){for(var y=a.attributes.length,S=l[p],w=new Array(y),C=new Array(y),_=0;_<y;_++){C[_]=0;for(var T=0;T<g.length;T++)i=g[T],C[_]+=a.attributes[_](i);w[_]=C[_]/g.length,MF(w[_],S[_],a.sensitivityThreshold)||(u=!0)}l[p]=w,s[p]=r.collection(g)}}c++}return s},OF=function(e){var r=this.cy(),n=this.nodes(),i=null,a=o_(e),s=new Array(a.k),o,l={},u,c=new Array(a.k);a.testMode?typeof a.testCentroids=="number"||(qi(a.testCentroids)==="object"?o=a.testCentroids:o=nT(n,a.k)):o=nT(n,a.k);for(var h=!0,p=0;h&&p<a.maxIterations;){for(var g=0;g<n.length;g++)i=n[g],l[i.id()]=eA(i,o,a.distance,a.attributes,"kMedoids");h=!1;for(var y=0;y<o.length;y++){var S=tA(y,n,l);if(S.length!==0){c[y]=iT(o[y],S,a.attributes);for(var w=0;w<S.length;w++)u=iT(S[w],S,a.attributes),u<c[y]&&(c[y]=u,o[y]=S[w],h=!0);s[y]=r.collection(S)}}p++}return s},DF=function(e,r,n,i,a){for(var s,o,l=0;l<r.length;l++)for(var u=0;u<e.length;u++)i[l][u]=Math.pow(n[l][u],a.m);for(var c=0;c<e.length;c++)for(var h=0;h<a.attributes.length;h++){s=0,o=0;for(var p=0;p<r.length;p++)s+=i[p][c]*a.attributes[h](r[p]),o+=i[p][c];e[c][h]=s/o}},IF=function(e,r,n,i,a){for(var s=0;s<e.length;s++)r[s]=e[s].slice();for(var o,l,u,c=2/(a.m-1),h=0;h<n.length;h++)for(var p=0;p<i.length;p++){o=0;for(var g=0;g<n.length;g++)l=ux(a.distance,i[p],n[h],a.attributes,"cmeans"),u=ux(a.distance,i[p],n[g],a.attributes,"cmeans"),o+=Math.pow(l/u,c);e[p][h]=1/o}},jF=function(e,r,n,i){for(var a=new Array(n.k),s=0;s<a.length;s++)a[s]=[];for(var o,l,u=0;u<r.length;u++){o=-1/0,l=-1;for(var c=0;c<r[0].length;c++)r[u][c]>o&&(o=r[u][c],l=c);a[l].push(e[u])}for(var h=0;h<a.length;h++)a[h]=i.collection(a[h]);return a},aT=function(e){var r=this.cy(),n=this.nodes(),i=o_(e),a,s,o,l,u;l=new Array(n.length);for(var c=0;c<n.length;c++)l[c]=new Array(i.k);o=new Array(n.length);for(var h=0;h<n.length;h++)o[h]=new Array(i.k);for(var p=0;p<n.length;p++){for(var g=0,y=0;y<i.k;y++)o[p][y]=Math.random(),g+=o[p][y];for(var S=0;S<i.k;S++)o[p][S]=o[p][S]/g}s=new Array(i.k);for(var w=0;w<i.k;w++)s[w]=new Array(i.attributes.length);u=new Array(n.length);for(var C=0;C<n.length;C++)u[C]=new Array(i.k);for(var _=!0,T=0;_&&T<i.maxIterations;)_=!1,DF(s,n,o,u,i),IF(o,l,s,n,i),AF(o,l,i.sensitivityThreshold)||(_=!0),T++;return a=jF(n,o,i,r),{clusters:a,degreeOfMembership:o}},FF={kMeans:RF,kMedoids:OF,fuzzyCMeans:aT,fcm:aT},BF=Ha({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),zF={single:"min",complete:"max"},UF=function(e){var r=BF(e),n=zF[r.linkage];return n!=null&&(r.linkage=n),r},sT=function(e,r,n,i,a){for(var s=0,o=1/0,l,u=a.attributes,c=function(F,z){return _1(a.distance,u.length,function(V){return u[V](F)},function(V){return u[V](z)},F,z)},h=0;h<e.length;h++){var p=e[h].key,g=n[p][i[p]];g<o&&(s=p,o=g)}if(a.mode==="threshold"&&o>=a.threshold||a.mode==="dendrogram"&&e.length===1)return!1;var y=r[s],S=r[i[s]],w;a.mode==="dendrogram"?w={left:y,right:S,key:y.key}:w={value:y.value.concat(S.value),key:y.key},e[y.index]=w,e.splice(S.index,1),r[y.key]=w;for(var C=0;C<e.length;C++){var _=e[C];y.key===_.key?l=1/0:a.linkage==="min"?(l=n[y.key][_.key],n[y.key][_.key]>n[S.key][_.key]&&(l=n[S.key][_.key])):a.linkage==="max"?(l=n[y.key][_.key],n[y.key][_.key]<n[S.key][_.key]&&(l=n[S.key][_.key])):a.linkage==="mean"?l=(n[y.key][_.key]*y.size+n[S.key][_.key]*S.size)/(y.size+S.size):a.mode==="dendrogram"?l=c(_.value,y.value):l=c(_.value[0],y.value[0]),n[y.key][_.key]=n[_.key][y.key]=l}for(var T=0;T<e.length;T++){var N=e[T].key;if(i[N]===y.key||i[N]===S.key){for(var R=N,I=0;I<e.length;I++){var j=e[I].key;n[N][j]<n[N][R]&&(R=j)}i[N]=R}e[T].index=T}return y.key=S.key=y.index=S.index=null,!0},Rp=function(e,r,n){e&&(e.value?r.push(e.value):(e.left&&Rp(e.left,r),e.right&&Rp(e.right,r)))},jS=function(e,r){if(!e)return"";if(e.left&&e.right){var n=jS(e.left,r),i=jS(e.right,r),a=r.add({group:"nodes",data:{id:n+","+i}});return r.add({group:"edges",data:{source:n,target:a.id()}}),r.add({group:"edges",data:{source:i,target:a.id()}}),a.id()}else if(e.value)return e.value.id()},FS=function(e,r,n){if(!e)return[];var i=[],a=[],s=[];return r===0?(e.left&&Rp(e.left,i),e.right&&Rp(e.right,a),s=i.concat(a),[n.collection(s)]):r===1?e.value?[n.collection(e.value)]:(e.left&&Rp(e.left,i),e.right&&Rp(e.right,a),[n.collection(i),n.collection(a)]):e.value?[n.collection(e.value)]:(e.left&&(i=FS(e.left,r-1,n)),e.right&&(a=FS(e.right,r-1,n)),i.concat(a))},oT=function(e){for(var r=this.cy(),n=this.nodes(),i=UF(e),a=i.attributes,s=function(T,N){return _1(i.distance,a.length,function(R){return a[R](T)},function(R){return a[R](N)},T,N)},o=[],l=[],u=[],c=[],h=0;h<n.length;h++){var p={value:i.mode==="dendrogram"?n[h]:[n[h]],key:h,index:h};o[h]=p,c[h]=p,l[h]=[],u[h]=0}for(var g=0;g<o.length;g++)for(var y=0;y<=g;y++){var S=void 0;i.mode==="dendrogram"?S=g===y?1/0:s(o[g].value,o[y].value):S=g===y?1/0:s(o[g].value[0],o[y].value[0]),l[g][y]=S,l[y][g]=S,S<l[g][u[g]]&&(u[g]=y)}for(var w=sT(o,c,l,u,i);w;)w=sT(o,c,l,u,i);var C;return i.mode==="dendrogram"?(C=FS(o[0],i.dendrogramDepth,r),i.addDendrogram&&jS(o[0],r)):(C=new Array(o.length),o.forEach(function(_,T){_.key=_.index=null,C[T]=r.collection(_.value)})),C},GF={hierarchicalClustering:oT,hca:oT},VF=Ha({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),HF=function(e){var r=e.damping,n=e.preference;.5<=r&&r<1||Kn("Damping must range on [0.5, 1).  Got: ".concat(r));var i=["median","mean","min","max"];return i.some(function(a){return a===n})||kt(n)||Kn("Preference must be one of [".concat(i.map(function(a){return"'".concat(a,"'")}).join(", "),"] or a number.  Got: ").concat(n)),VF(e)},WF=function(e,r,n,i){var a=function(o,l){return i[l](o)};return-_1(e,i.length,function(s){return a(r,s)},function(s){return a(n,s)},r,n)},qF=function(e,r){var n=null;return r==="median"?n=H9(e):r==="mean"?n=V9(e):r==="min"?n=U9(e):r==="max"?n=G9(e):n=r,n},$F=function(e,r,n){for(var i=[],a=0;a<e;a++)r[a*e+a]+n[a*e+a]>0&&i.push(a);return i},lT=function(e,r,n){for(var i=[],a=0;a<e;a++){for(var s=-1,o=-1/0,l=0;l<n.length;l++){var u=n[l];r[a*e+u]>o&&(s=u,o=r[a*e+u])}s>0&&i.push(s)}for(var c=0;c<n.length;c++)i[n[c]]=n[c];return i},KF=function(e,r,n){for(var i=lT(e,r,n),a=0;a<n.length;a++){for(var s=[],o=0;o<i.length;o++)i[o]===n[a]&&s.push(o);for(var l=-1,u=-1/0,c=0;c<s.length;c++){for(var h=0,p=0;p<s.length;p++)h+=r[s[p]*e+s[c]];h>u&&(l=c,u=h)}n[a]=s[l]}return i=lT(e,r,n),i},uT=function(e){for(var r=this.cy(),n=this.nodes(),i=HF(e),a={},s=0;s<n.length;s++)a[n[s].id()]=s;var o,l,u,c,h,p;o=n.length,l=o*o,u=new Array(l);for(var g=0;g<l;g++)u[g]=-1/0;for(var y=0;y<o;y++)for(var S=0;S<o;S++)y!==S&&(u[y*o+S]=WF(i.distance,n[y],n[S],i.attributes));c=qF(u,i.preference);for(var w=0;w<o;w++)u[w*o+w]=c;h=new Array(l);for(var C=0;C<l;C++)h[C]=0;p=new Array(l);for(var _=0;_<l;_++)p[_]=0;for(var T=new Array(o),N=new Array(o),R=new Array(o),I=0;I<o;I++)T[I]=0,N[I]=0,R[I]=0;for(var j=new Array(o*i.minIterations),O=0;O<j.length;O++)j[O]=0;var F;for(F=0;F<i.maxIterations;F++){for(var z=0;z<o;z++){for(var V=-1/0,q=-1/0,D=-1,U=0,G=0;G<o;G++)T[G]=h[z*o+G],U=p[z*o+G]+u[z*o+G],U>=V?(q=V,V=U,D=G):U>q&&(q=U);for(var Z=0;Z<o;Z++)h[z*o+Z]=(1-i.damping)*(u[z*o+Z]-V)+i.damping*T[Z];h[z*o+D]=(1-i.damping)*(u[z*o+D]-q)+i.damping*T[D]}for(var K=0;K<o;K++){for(var Q=0,ne=0;ne<o;ne++)T[ne]=p[ne*o+K],N[ne]=Math.max(0,h[ne*o+K]),Q+=N[ne];Q-=N[K],N[K]=h[K*o+K],Q+=N[K];for(var te=0;te<o;te++)p[te*o+K]=(1-i.damping)*Math.min(0,Q-N[te])+i.damping*T[te];p[K*o+K]=(1-i.damping)*(Q-N[K])+i.damping*T[K]}for(var X=0,re=0;re<o;re++){var he=p[re*o+re]+h[re*o+re]>0?1:0;j[F%i.minIterations*o+re]=he,X+=he}if(X>0&&(F>=i.minIterations-1||F==i.maxIterations-1)){for(var oe=0,se=0;se<o;se++){R[se]=0;for(var fe=0;fe<i.minIterations;fe++)R[se]+=j[fe*o+se];(R[se]===0||R[se]===i.minIterations)&&oe++}if(oe===o)break}}for(var ae=$F(o,h,p),pe=KF(o,u,ae),ye={},ve=0;ve<ae.length;ve++)ye[ae[ve]]=[];for(var ue=0;ue<n.length;ue++){var xe=a[n[ue].id()],Se=pe[xe];Se!=null&&ye[Se].push(n[ue])}for(var Oe=new Array(ae.length),Ae=0;Ae<ae.length;Ae++)Oe[Ae]=r.collection(ye[ae[Ae]]);return Oe},ZF={affinityPropagation:uT,ap:uT},YF=Ha({root:void 0,directed:!1}),XF={hierholzer:function(e){if(!Vr(e)){var r=arguments;e={root:r[0],directed:r[1]}}var n=YF(e),i=n.root,a=n.directed,s=this,o=!1,l,u,c;i&&(c=Zt(i)?this.filter(i)[0].id():i[0].id());var h={},p={};a?s.forEach(function(_){var T=_.id();if(_.isNode()){var N=_.indegree(!0),R=_.outdegree(!0),I=N-R,j=R-N;I==1?l?o=!0:l=T:j==1?u?o=!0:u=T:(j>1||I>1)&&(o=!0),h[T]=[],_.outgoers().forEach(function(O){O.isEdge()&&h[T].push(O.id())})}else p[T]=[void 0,_.target().id()]}):s.forEach(function(_){var T=_.id();if(_.isNode()){var N=_.degree(!0);N%2&&(l?u?o=!0:u=T:l=T),h[T]=[],_.connectedEdges().forEach(function(R){return h[T].push(R.id())})}else p[T]=[_.source().id(),_.target().id()]});var g={found:!1,trail:void 0};if(o)return g;if(u&&l)if(a){if(c&&u!=c)return g;c=u}else{if(c&&u!=c&&l!=c)return g;c||(c=u)}else c||(c=s[0].id());var y=function(T){for(var N=T,R=[T],I,j,O;h[N].length;)I=h[N].shift(),j=p[I][0],O=p[I][1],N!=O?(h[O]=h[O].filter(function(F){return F!=I}),N=O):!a&&N!=j&&(h[j]=h[j].filter(function(F){return F!=I}),N=j),R.unshift(I),R.unshift(N);return R},S=[],w=[];for(w=y(c);w.length!=1;)h[w[0]].length==0?(S.unshift(s.getElementById(w.shift())),S.unshift(s.getElementById(w.shift()))):w=y(w.shift()).concat(w);S.unshift(s.getElementById(w.shift()));for(var C in h)if(h[C].length)return g;return g.found=!0,g.trail=this.spawn(S,!0),g}},J0=function(){var e=this,r={},n=0,i=0,a=[],s=[],o={},l=function(p,g){for(var y=s.length-1,S=[],w=e.spawn();s[y].x!=p||s[y].y!=g;)S.push(s.pop().edge),y--;S.push(s.pop().edge),S.forEach(function(C){var _=C.connectedNodes().intersection(e);w.merge(C),_.forEach(function(T){var N=T.id(),R=T.connectedEdges().intersection(e);w.merge(T),r[N].cutVertex?w.merge(R.filter(function(I){return I.isLoop()})):w.merge(R)})}),a.push(w)},u=function(p,g,y){p===y&&(i+=1),r[g]={id:n,low:n++,cutVertex:!1};var S=e.getElementById(g).connectedEdges().intersection(e);if(S.size()===0)a.push(e.spawn(e.getElementById(g)));else{var w,C,_,T;S.forEach(function(N){w=N.source().id(),C=N.target().id(),_=w===g?C:w,_!==y&&(T=N.id(),o[T]||(o[T]=!0,s.push({x:g,y:_,edge:N})),_ in r?r[g].low=Math.min(r[g].low,r[_].id):(u(p,_,g),r[g].low=Math.min(r[g].low,r[_].low),r[g].id<=r[_].low&&(r[g].cutVertex=!0,l(g,_))))})}};e.forEach(function(h){if(h.isNode()){var p=h.id();p in r||(i=0,u(p,p),r[p].cutVertex=i>1)}});var c=Object.keys(r).filter(function(h){return r[h].cutVertex}).map(function(h){return e.getElementById(h)});return{cut:e.spawn(c),components:a}},QF={hopcroftTarjanBiconnected:J0,htbc:J0,htb:J0,hopcroftTarjanBiconnectedComponents:J0},ey=function(){var e=this,r={},n=0,i=[],a=[],s=e.spawn(e),o=function(u){a.push(u),r[u]={index:n,low:n++,explored:!1};var c=e.getElementById(u).connectedEdges().intersection(e);if(c.forEach(function(S){var w=S.target().id();w!==u&&(w in r||o(w),r[w].explored||(r[u].low=Math.min(r[u].low,r[w].low)))}),r[u].index===r[u].low){for(var h=e.spawn();;){var p=a.pop();if(h.merge(e.getElementById(p)),r[p].low=r[u].index,r[p].explored=!0,p===u)break}var g=h.edgesWith(h),y=h.merge(g);i.push(y),s=s.difference(y)}};return e.forEach(function(l){if(l.isNode()){var u=l.id();u in r||o(u)}}),{cut:s,components:i}},JF={tarjanStronglyConnected:ey,tsc:ey,tscc:ey,tarjanStronglyConnectedComponents:ey},rA={};[bv,P9,M9,L9,O9,I9,B9,hF,Fp,Bp,IS,CF,FF,GF,ZF,XF,QF,JF].forEach(function(t){ar(rA,t)});var nA=0,iA=1,aA=2,jl=function(e){if(!(this instanceof jl))return new jl(e);this.id="Thenable/1.0.7",this.state=nA,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},typeof e=="function"&&e.call(this,this.fulfill.bind(this),this.reject.bind(this))};jl.prototype={fulfill:function(e){return cT(this,iA,"fulfillValue",e)},reject:function(e){return cT(this,aA,"rejectReason",e)},then:function(e,r){var n=this,i=new jl;return n.onFulfilled.push(hT(e,i,"fulfill")),n.onRejected.push(hT(r,i,"reject")),sA(n),i.proxy}};var cT=function(e,r,n,i){return e.state===nA&&(e.state=r,e[n]=i,sA(e)),e},sA=function(e){e.state===iA?dT(e,"onFulfilled",e.fulfillValue):e.state===aA&&dT(e,"onRejected",e.rejectReason)},dT=function(e,r,n){if(e[r].length!==0){var i=e[r];e[r]=[];var a=function(){for(var o=0;o<i.length;o++)i[o](n)};typeof setImmediate=="function"?setImmediate(a):setTimeout(a,0)}},hT=function(e,r,n){return function(i){if(typeof e!="function")r[n].call(r,i);else{var a;try{a=e(i)}catch(s){r.reject(s);return}oA(r,a)}}},oA=function(e,r){if(e===r||e.proxy===r){e.reject(new TypeError("cannot resolve promise with itself"));return}var n;if(qi(r)==="object"&&r!==null||typeof r=="function")try{n=r.then}catch(a){e.reject(a);return}if(typeof n=="function"){var i=!1;try{n.call(r,function(a){i||(i=!0,a===r?e.reject(new TypeError("circular thenable chain")):oA(e,a))},function(a){i||(i=!0,e.reject(a))})}catch(a){i||e.reject(a)}return}e.fulfill(r)};jl.all=function(t){return new jl(function(e,r){for(var n=new Array(t.length),i=0,a=function(l,u){n[l]=u,i++,i===t.length&&e(n)},s=0;s<t.length;s++)(function(o){var l=t[o],u=l!=null&&l.then!=null;if(u)l.then(function(h){a(o,h)},function(h){r(h)});else{var c=l;a(o,c)}})(s)})};jl.resolve=function(t){return new jl(function(e,r){e(t)})};jl.reject=function(t){return new jl(function(e,r){r(t)})};var cm=typeof Promise<"u"?Promise:jl,BS=function(e,r,n){var i=Xk(e),a=!i,s=this._private=ar({duration:1e3},r,n);if(s.target=e,s.style=s.style||s.css,s.started=!1,s.playing=!1,s.hooked=!1,s.applying=!1,s.progress=0,s.completes=[],s.frames=[],s.complete&&ri(s.complete)&&s.completes.push(s.complete),a){var o=e.position();s.startPosition=s.startPosition||{x:o.x,y:o.y},s.startStyle=s.startStyle||e.cy().style().getAnimationStartStyle(e,s.style)}if(i){var l=e.pan();s.startPan={x:l.x,y:l.y},s.startZoom=e.zoom()}this.length=1,this[0]=this},gf=BS.prototype;ar(gf,{instanceString:function(){return"animation"},hook:function(){var e=this._private;if(!e.hooked){var r,n=e.target._private.animation;e.queue?r=n.queue:r=n.current,r.push(this),vo(e.target)&&e.target.cy().addToAnimationPool(e.target),e.hooked=!0}return this},play:function(){var e=this._private;return e.progress===1&&(e.progress=0),e.playing=!0,e.started=!1,e.stopped=!1,this.hook(),this},playing:function(){return this._private.playing},apply:function(){var e=this._private;return e.applying=!0,e.started=!1,e.stopped=!1,this.hook(),this},applying:function(){return this._private.applying},pause:function(){var e=this._private;return e.playing=!1,e.started=!1,this},stop:function(){var e=this._private;return e.playing=!1,e.started=!1,e.stopped=!0,this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(e){var r=this._private;return e===void 0?r.progress*r.duration:this.progress(e/r.duration)},progress:function(e){var r=this._private,n=r.playing;return e===void 0?r.progress:(n&&this.pause(),r.progress=e,r.started=!1,n&&this.play(),this)},completed:function(){return this._private.progress===1},reverse:function(){var e=this._private,r=e.playing;r&&this.pause(),e.progress=1-e.progress,e.started=!1;var n=function(u,c){var h=e[u];h!=null&&(e[u]=e[c],e[c]=h)};if(n("zoom","startZoom"),n("pan","startPan"),n("position","startPosition"),e.style)for(var i=0;i<e.style.length;i++){var a=e.style[i],s=a.name,o=e.startStyle[s];e.startStyle[s]=a,e.style[i]=o}return r&&this.play(),this},promise:function(e){var r=this._private,n;switch(e){case"frame":n=r.frames;break;default:case"complete":case"completed":n=r.completes}return new cm(function(i,a){n.push(function(){i()})})}});gf.complete=gf.completed;gf.run=gf.play;gf.running=gf.playing;var eB={animated:function(){return function(){var r=this,n=r.length!==void 0,i=n?r:[r],a=this._private.cy||this;if(!a.styleEnabled())return!1;var s=i[0];if(s)return s._private.animation.current.length>0}},clearQueue:function(){return function(){var r=this,n=r.length!==void 0,i=n?r:[r],a=this._private.cy||this;if(!a.styleEnabled())return this;for(var s=0;s<i.length;s++){var o=i[s];o._private.animation.queue=[]}return this}},delay:function(){return function(r,n){var i=this._private.cy||this;return i.styleEnabled()?this.animate({delay:r,duration:r,complete:n}):this}},delayAnimation:function(){return function(r,n){var i=this._private.cy||this;return i.styleEnabled()?this.animation({delay:r,duration:r,complete:n}):this}},animation:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this,l=!a,u=!l;if(!o.styleEnabled())return this;var c=o.style();r=ar({},r,n);var h=Object.keys(r).length===0;if(h)return new BS(s[0],r);switch(r.duration===void 0&&(r.duration=400),r.duration){case"slow":r.duration=600;break;case"fast":r.duration=200;break}if(u&&(r.style=c.getPropsList(r.style||r.css),r.css=void 0),u&&r.renderedPosition!=null){var p=r.renderedPosition,g=o.pan(),y=o.zoom();r.position=qM(p,y,g)}if(l&&r.panBy!=null){var S=r.panBy,w=o.pan();r.pan={x:w.x+S.x,y:w.y+S.y}}var C=r.center||r.centre;if(l&&C!=null){var _=o.getCenterPan(C.eles,r.zoom);_!=null&&(r.pan=_)}if(l&&r.fit!=null){var T=r.fit,N=o.getFitViewport(T.eles||T.boundingBox,T.padding);N!=null&&(r.pan=N.pan,r.zoom=N.zoom)}if(l&&Vr(r.zoom)){var R=o.getZoomedViewport(r.zoom);R!=null?(R.zoomed&&(r.zoom=R.zoom),R.panned&&(r.pan=R.pan)):r.zoom=null}return new BS(s[0],r)}},animate:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;n&&(r=ar({},r,n));for(var l=0;l<s.length;l++){var u=s[l],c=u.animated()&&(r.queue===void 0||r.queue),h=u.animation(r,c?{queue:!0}:void 0);h.play()}return this}},stop:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;for(var l=0;l<s.length;l++){for(var u=s[l],c=u._private,h=c.animation.current,p=0;p<h.length;p++){var g=h[p],y=g._private;n&&(y.duration=0)}r&&(c.animation.queue=[]),n||(c.animation.current=[])}return o.notify("draw"),this}}},cw,fT;function C1(){if(fT)return cw;fT=1;var t=Array.isArray;return cw=t,cw}var dw,pT;function tB(){if(pT)return dw;pT=1;var t=C1(),e=Xv(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function i(a,s){if(t(a))return!1;var o=typeof a;return o=="number"||o=="symbol"||o=="boolean"||a==null||e(a)?!0:n.test(a)||!r.test(a)||s!=null&&a in Object(s)}return dw=i,dw}var hw,mT;function rB(){if(mT)return hw;mT=1;var t=jM(),e=Yv(),r="[object AsyncFunction]",n="[object Function]",i="[object GeneratorFunction]",a="[object Proxy]";function s(o){if(!e(o))return!1;var l=t(o);return l==n||l==i||l==r||l==a}return hw=s,hw}var fw,gT;function nB(){if(gT)return fw;gT=1;var t=w1(),e=t["__core-js_shared__"];return fw=e,fw}var pw,vT;function iB(){if(vT)return pw;vT=1;var t=nB(),e=(function(){var n=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})();function r(n){return!!e&&e in n}return pw=r,pw}var mw,yT;function aB(){if(yT)return mw;yT=1;var t=Function.prototype,e=t.toString;function r(n){if(n!=null){try{return e.call(n)}catch{}try{return n+""}catch{}}return""}return mw=r,mw}var gw,xT;function sB(){if(xT)return gw;xT=1;var t=rB(),e=iB(),r=Yv(),n=aB(),i=/[\\^$.*+?()[\]{}|]/g,a=/^\[object .+?Constructor\]$/,s=Function.prototype,o=Object.prototype,l=s.toString,u=o.hasOwnProperty,c=RegExp("^"+l.call(u).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function h(p){if(!r(p)||e(p))return!1;var g=t(p)?c:a;return g.test(n(p))}return gw=h,gw}var vw,bT;function oB(){if(bT)return vw;bT=1;function t(e,r){return e?.[r]}return vw=t,vw}var yw,wT;function l_(){if(wT)return yw;wT=1;var t=sB(),e=oB();function r(n,i){var a=e(n,i);return t(a)?a:void 0}return yw=r,yw}var xw,ST;function E1(){if(ST)return xw;ST=1;var t=l_(),e=t(Object,"create");return xw=e,xw}var bw,kT;function lB(){if(kT)return bw;kT=1;var t=E1();function e(){this.__data__=t?t(null):{},this.size=0}return bw=e,bw}var ww,_T;function uB(){if(_T)return ww;_T=1;function t(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}return ww=t,ww}var Sw,CT;function cB(){if(CT)return Sw;CT=1;var t=E1(),e="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function i(a){var s=this.__data__;if(t){var o=s[a];return o===e?void 0:o}return n.call(s,a)?s[a]:void 0}return Sw=i,Sw}var kw,ET;function dB(){if(ET)return kw;ET=1;var t=E1(),e=Object.prototype,r=e.hasOwnProperty;function n(i){var a=this.__data__;return t?a[i]!==void 0:r.call(a,i)}return kw=n,kw}var _w,TT;function hB(){if(TT)return _w;TT=1;var t=E1(),e="__lodash_hash_undefined__";function r(n,i){var a=this.__data__;return this.size+=this.has(n)?0:1,a[n]=t&&i===void 0?e:i,this}return _w=r,_w}var Cw,NT;function fB(){if(NT)return Cw;NT=1;var t=lB(),e=uB(),r=cB(),n=dB(),i=hB();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,Cw=a,Cw}var Ew,PT;function pB(){if(PT)return Ew;PT=1;function t(){this.__data__=[],this.size=0}return Ew=t,Ew}var Tw,MT;function lA(){if(MT)return Tw;MT=1;function t(e,r){return e===r||e!==e&&r!==r}return Tw=t,Tw}var Nw,AT;function T1(){if(AT)return Nw;AT=1;var t=lA();function e(r,n){for(var i=r.length;i--;)if(t(r[i][0],n))return i;return-1}return Nw=e,Nw}var Pw,LT;function mB(){if(LT)return Pw;LT=1;var t=T1(),e=Array.prototype,r=e.splice;function n(i){var a=this.__data__,s=t(a,i);if(s<0)return!1;var o=a.length-1;return s==o?a.pop():r.call(a,s,1),--this.size,!0}return Pw=n,Pw}var Mw,RT;function gB(){if(RT)return Mw;RT=1;var t=T1();function e(r){var n=this.__data__,i=t(n,r);return i<0?void 0:n[i][1]}return Mw=e,Mw}var Aw,OT;function vB(){if(OT)return Aw;OT=1;var t=T1();function e(r){return t(this.__data__,r)>-1}return Aw=e,Aw}var Lw,DT;function yB(){if(DT)return Lw;DT=1;var t=T1();function e(r,n){var i=this.__data__,a=t(i,r);return a<0?(++this.size,i.push([r,n])):i[a][1]=n,this}return Lw=e,Lw}var Rw,IT;function xB(){if(IT)return Rw;IT=1;var t=pB(),e=mB(),r=gB(),n=vB(),i=yB();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,Rw=a,Rw}var Ow,jT;function bB(){if(jT)return Ow;jT=1;var t=l_(),e=w1(),r=t(e,"Map");return Ow=r,Ow}var Dw,FT;function wB(){if(FT)return Dw;FT=1;var t=fB(),e=xB(),r=bB();function n(){this.size=0,this.__data__={hash:new t,map:new(r||e),string:new t}}return Dw=n,Dw}var Iw,BT;function SB(){if(BT)return Iw;BT=1;function t(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}return Iw=t,Iw}var jw,zT;function N1(){if(zT)return jw;zT=1;var t=SB();function e(r,n){var i=r.__data__;return t(n)?i[typeof n=="string"?"string":"hash"]:i.map}return jw=e,jw}var Fw,UT;function kB(){if(UT)return Fw;UT=1;var t=N1();function e(r){var n=t(this,r).delete(r);return this.size-=n?1:0,n}return Fw=e,Fw}var Bw,GT;function _B(){if(GT)return Bw;GT=1;var t=N1();function e(r){return t(this,r).get(r)}return Bw=e,Bw}var zw,VT;function CB(){if(VT)return zw;VT=1;var t=N1();function e(r){return t(this,r).has(r)}return zw=e,zw}var Uw,HT;function EB(){if(HT)return Uw;HT=1;var t=N1();function e(r,n){var i=t(this,r),a=i.size;return i.set(r,n),this.size+=i.size==a?0:1,this}return Uw=e,Uw}var Gw,WT;function TB(){if(WT)return Gw;WT=1;var t=wB(),e=kB(),r=_B(),n=CB(),i=EB();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,Gw=a,Gw}var Vw,qT;function NB(){if(qT)return Vw;qT=1;var t=TB(),e="Expected a function";function r(n,i){if(typeof n!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var a=function(){var s=arguments,o=i?i.apply(this,s):s[0],l=a.cache;if(l.has(o))return l.get(o);var u=n.apply(this,s);return a.cache=l.set(o,u)||l,u};return a.cache=new(r.Cache||t),a}return r.Cache=t,Vw=r,Vw}var Hw,$T;function PB(){if($T)return Hw;$T=1;var t=NB(),e=500;function r(n){var i=t(n,function(s){return a.size===e&&a.clear(),s}),a=i.cache;return i}return Hw=r,Hw}var Ww,KT;function uA(){if(KT)return Ww;KT=1;var t=PB(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=t(function(i){var a=[];return i.charCodeAt(0)===46&&a.push(""),i.replace(e,function(s,o,l,u){a.push(l?u.replace(r,"$1"):o||s)}),a});return Ww=n,Ww}var qw,ZT;function cA(){if(ZT)return qw;ZT=1;function t(e,r){for(var n=-1,i=e==null?0:e.length,a=Array(i);++n<i;)a[n]=r(e[n],n,e);return a}return qw=t,qw}var $w,YT;function MB(){if(YT)return $w;YT=1;var t=Jk(),e=cA(),r=C1(),n=Xv(),i=t?t.prototype:void 0,a=i?i.toString:void 0;function s(o){if(typeof o=="string")return o;if(r(o))return e(o,s)+"";if(n(o))return a?a.call(o):"";var l=o+"";return l=="0"&&1/o==-1/0?"-0":l}return $w=s,$w}var Kw,XT;function dA(){if(XT)return Kw;XT=1;var t=MB();function e(r){return r==null?"":t(r)}return Kw=e,Kw}var Zw,QT;function hA(){if(QT)return Zw;QT=1;var t=C1(),e=tB(),r=uA(),n=dA();function i(a,s){return t(a)?a:e(a,s)?[a]:r(n(a))}return Zw=i,Zw}var Yw,JT;function u_(){if(JT)return Yw;JT=1;var t=Xv();function e(r){if(typeof r=="string"||t(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return Yw=e,Yw}var Xw,eN;function AB(){if(eN)return Xw;eN=1;var t=hA(),e=u_();function r(n,i){i=t(i,n);for(var a=0,s=i.length;n!=null&&a<s;)n=n[e(i[a++])];return a&&a==s?n:void 0}return Xw=r,Xw}var Qw,tN;function LB(){if(tN)return Qw;tN=1;var t=AB();function e(r,n,i){var a=r==null?void 0:t(r,n);return a===void 0?i:a}return Qw=e,Qw}var RB=LB(),OB=Zv(RB),Jw,rN;function DB(){if(rN)return Jw;rN=1;var t=l_(),e=(function(){try{var r=t(Object,"defineProperty");return r({},"",{}),r}catch{}})();return Jw=e,Jw}var e2,nN;function IB(){if(nN)return e2;nN=1;var t=DB();function e(r,n,i){n=="__proto__"&&t?t(r,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):r[n]=i}return e2=e,e2}var t2,iN;function jB(){if(iN)return t2;iN=1;var t=IB(),e=lA(),r=Object.prototype,n=r.hasOwnProperty;function i(a,s,o){var l=a[s];(!(n.call(a,s)&&e(l,o))||o===void 0&&!(s in a))&&t(a,s,o)}return t2=i,t2}var r2,aN;function FB(){if(aN)return r2;aN=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function r(n,i){var a=typeof n;return i=i??t,!!i&&(a=="number"||a!="symbol"&&e.test(n))&&n>-1&&n%1==0&&n<i}return r2=r,r2}var n2,sN;function BB(){if(sN)return n2;sN=1;var t=jB(),e=hA(),r=FB(),n=Yv(),i=u_();function a(s,o,l,u){if(!n(s))return s;o=e(o,s);for(var c=-1,h=o.length,p=h-1,g=s;g!=null&&++c<h;){var y=i(o[c]),S=l;if(y==="__proto__"||y==="constructor"||y==="prototype")return s;if(c!=p){var w=g[y];S=u?u(w,y,g):void 0,S===void 0&&(S=n(w)?w:r(o[c+1])?[]:{})}t(g,y,S),g=g[y]}return s}return n2=a,n2}var i2,oN;function zB(){if(oN)return i2;oN=1;var t=BB();function e(r,n,i){return r==null?r:t(r,n,i)}return i2=e,i2}var UB=zB(),GB=Zv(UB),a2,lN;function VB(){if(lN)return a2;lN=1;function t(e,r){var n=-1,i=e.length;for(r||(r=Array(i));++n<i;)r[n]=e[n];return r}return a2=t,a2}var s2,uN;function HB(){if(uN)return s2;uN=1;var t=cA(),e=VB(),r=C1(),n=Xv(),i=uA(),a=u_(),s=dA();function o(l){return r(l)?t(l,a):n(l)?[l]:e(i(s(l)))}return s2=o,s2}var WB=HB(),qB=Zv(WB),$B={data:function(e){var r={field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function(i){},beforeSet:function(i,a){},onSet:function(i){},canSet:function(i){return!0}};return e=ar({},r,e),function(i,a){var s=e,o=this,l=o.length!==void 0,u=l?o:[o],c=l?o[0]:o;if(Zt(i)){var h=i.indexOf(".")!==-1,p=h&&qB(i);if(s.allowGetting&&a===void 0){var g;return c&&(s.beforeGet(c),p&&c._private[s.field][i]===void 0?g=OB(c._private[s.field],p):g=c._private[s.field][i]),g}else if(s.allowSetting&&a!==void 0){var y=!s.immutableKeys[i];if(y){var S=TM({},i,a);s.beforeSet(o,S);for(var w=0,C=u.length;w<C;w++){var _=u[w];s.canSet(_)&&(p&&c._private[s.field][i]===void 0?GB(_._private[s.field],p,a):_._private[s.field][i]=a)}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}}}else if(s.allowSetting&&Vr(i)){var T=i,N,R,I=Object.keys(T);s.beforeSet(o,T);for(var j=0;j<I.length;j++){N=I[j],R=T[N];var O=!s.immutableKeys[N];if(O)for(var F=0;F<u.length;F++){var z=u[F];s.canSet(z)&&(z._private[s.field][N]=R)}}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}else if(s.allowBinding&&ri(i)){var V=i;o.on(s.bindingEvent,V)}else if(s.allowGetting&&i===void 0){var q;return c&&(s.beforeGet(c),q=c._private[s.field]),q}return o}},removeData:function(e){var r={field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}};return e=ar({},r,e),function(i){var a=e,s=this,o=s.length!==void 0,l=o?s:[s];if(Zt(i)){for(var u=i.split(/\s+/),c=u.length,h=0;h<c;h++){var p=u[h];if(!Zd(p)){var g=!a.immutableKeys[p];if(g)for(var y=0,S=l.length;y<S;y++)l[y]._private[a.field][p]=void 0}}a.triggerEvent&&s[a.triggerFnName](a.event)}else if(i===void 0){for(var w=0,C=l.length;w<C;w++)for(var _=l[w]._private[a.field],T=Object.keys(_),N=0;N<T.length;N++){var R=T[N],I=!a.immutableKeys[R];I&&(_[R]=void 0)}a.triggerEvent&&s[a.triggerFnName](a.event)}return s}}},KB={eventAliasesOn:function(e){var r=e;r.addListener=r.listen=r.bind=r.on,r.unlisten=r.unbind=r.off=r.removeListener,r.trigger=r.emit,r.pon=r.promiseOn=function(n,i){var a=this,s=Array.prototype.slice.call(arguments,0);return new cm(function(o,l){var u=function(g){a.off.apply(a,h),o(g)},c=s.concat([u]),h=c.concat([]);a.on.apply(a,c)})}}},nn={};[eB,$B,KB].forEach(function(t){ar(nn,t)});var ZB={animate:nn.animate(),animation:nn.animation(),animated:nn.animated(),clearQueue:nn.clearQueue(),delay:nn.delay(),delayAnimation:nn.delayAnimation(),stop:nn.stop()},jy={classes:function(e){var r=this;if(e===void 0){var n=[];return r[0]._private.classes.forEach(function(y){return n.push(y)}),n}else Sn(e)||(e=(e||"").match(/\S+/g)||[]);for(var i=[],a=new um(e),s=0;s<r.length;s++){for(var o=r[s],l=o._private,u=l.classes,c=!1,h=0;h<e.length;h++){var p=e[h],g=u.has(p);if(!g){c=!0;break}}c||(c=u.size!==e.length),c&&(l.classes=a,i.push(o))}return i.length>0&&this.spawn(i).updateStyle().emit("class"),r},addClass:function(e){return this.toggleClass(e,!0)},hasClass:function(e){var r=this[0];return r!=null&&r._private.classes.has(e)},toggleClass:function(e,r){Sn(e)||(e=e.match(/\S+/g)||[]);for(var n=this,i=r===void 0,a=[],s=0,o=n.length;s<o;s++)for(var l=n[s],u=l._private.classes,c=!1,h=0;h<e.length;h++){var p=e[h],g=u.has(p),y=!1;r||i&&!g?(u.add(p),y=!0):(!r||i&&g)&&(u.delete(p),y=!0),!c&&y&&(a.push(l),c=!0)}return a.length>0&&this.spawn(a).updateStyle().emit("class"),n},removeClass:function(e){return this.toggleClass(e,!1)},flashClass:function(e,r){var n=this;if(r==null)r=250;else if(r===0)return n;return n.addClass(e),setTimeout(function(){n.removeClass(e)},r),n}};jy.className=jy.classNames=jy.classes;var Gr={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:`"(?:\\\\"|[^"])*"|'(?:\\\\'|[^'])*'`,number:Wi,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};Gr.variable="(?:[\\w-.]|(?:\\\\"+Gr.metaChar+"))+";Gr.className="(?:[\\w-]|(?:\\\\"+Gr.metaChar+"))+";Gr.value=Gr.string+"|"+Gr.number;Gr.id=Gr.variable;(function(){var t,e,r;for(t=Gr.comparatorOp.split("|"),r=0;r<t.length;r++)e=t[r],Gr.comparatorOp+="|@"+e;for(t=Gr.comparatorOp.split("|"),r=0;r<t.length;r++)e=t[r],!(e.indexOf("!")>=0)&&e!=="="&&(Gr.comparatorOp+="|\\!"+e)})();var vn=function(){return{checks:[]}},Bt={GROUP:0,COLLECTION:1,FILTER:2,DATA_COMPARE:3,DATA_EXIST:4,DATA_BOOL:5,META_COMPARE:6,STATE:7,ID:8,CLASS:9,UNDIRECTED_EDGE:10,DIRECTED_EDGE:11,NODE_SOURCE:12,NODE_TARGET:13,NODE_NEIGHBOR:14,CHILD:15,DESCENDANT:16,PARENT:17,ANCESTOR:18,COMPOUND_SPLIT:19,TRUE:20},zS=[{selector:":selected",matches:function(e){return e.selected()}},{selector:":unselected",matches:function(e){return!e.selected()}},{selector:":selectable",matches:function(e){return e.selectable()}},{selector:":unselectable",matches:function(e){return!e.selectable()}},{selector:":locked",matches:function(e){return e.locked()}},{selector:":unlocked",matches:function(e){return!e.locked()}},{selector:":visible",matches:function(e){return e.visible()}},{selector:":hidden",matches:function(e){return!e.visible()}},{selector:":transparent",matches:function(e){return e.transparent()}},{selector:":grabbed",matches:function(e){return e.grabbed()}},{selector:":free",matches:function(e){return!e.grabbed()}},{selector:":removed",matches:function(e){return e.removed()}},{selector:":inside",matches:function(e){return!e.removed()}},{selector:":grabbable",matches:function(e){return e.grabbable()}},{selector:":ungrabbable",matches:function(e){return!e.grabbable()}},{selector:":animated",matches:function(e){return e.animated()}},{selector:":unanimated",matches:function(e){return!e.animated()}},{selector:":parent",matches:function(e){return e.isParent()}},{selector:":childless",matches:function(e){return e.isChildless()}},{selector:":child",matches:function(e){return e.isChild()}},{selector:":orphan",matches:function(e){return e.isOrphan()}},{selector:":nonorphan",matches:function(e){return e.isChild()}},{selector:":compound",matches:function(e){return e.isNode()?e.isParent():e.source().isParent()||e.target().isParent()}},{selector:":loop",matches:function(e){return e.isLoop()}},{selector:":simple",matches:function(e){return e.isSimple()}},{selector:":active",matches:function(e){return e.active()}},{selector:":inactive",matches:function(e){return!e.active()}},{selector:":backgrounding",matches:function(e){return e.backgrounding()}},{selector:":nonbackgrounding",matches:function(e){return!e.backgrounding()}}].sort(function(t,e){return $j(t.selector,e.selector)}),YB=(function(){for(var t={},e,r=0;r<zS.length;r++)e=zS[r],t[e.selector]=e.matches;return t})(),XB=function(e,r){return YB[e](r)},QB="("+zS.map(function(t){return t.selector}).join("|")+")",hp=function(e){return e.replace(new RegExp("\\\\("+Gr.metaChar+")","g"),function(r,n){return n})},yd=function(e,r,n){e[e.length-1]=n},US=[{name:"group",query:!0,regex:"("+Gr.group+")",populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Bt.GROUP,value:a==="*"?a:a+"s"})}},{name:"state",query:!0,regex:QB,populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Bt.STATE,value:a})}},{name:"id",query:!0,regex:"\\#("+Gr.id+")",populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Bt.ID,value:hp(a)})}},{name:"className",query:!0,regex:"\\.("+Gr.className+")",populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Bt.CLASS,value:hp(a)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+Gr.variable+")\\s*\\]",populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Bt.DATA_EXIST,field:hp(a)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+Gr.variable+")\\s*("+Gr.comparatorOp+")\\s*("+Gr.value+")\\s*\\]",populate:function(e,r,n){var i=Di(n,3),a=i[0],s=i[1],o=i[2],l=new RegExp("^"+Gr.string+"$").exec(o)!=null;l?o=o.substring(1,o.length-1):o=parseFloat(o),r.checks.push({type:Bt.DATA_COMPARE,field:hp(a),operator:s,value:o})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+Gr.boolOp+")\\s*("+Gr.variable+")\\s*\\]",populate:function(e,r,n){var i=Di(n,2),a=i[0],s=i[1];r.checks.push({type:Bt.DATA_BOOL,field:hp(s),operator:a})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+Gr.meta+")\\s*("+Gr.comparatorOp+")\\s*("+Gr.number+")\\s*\\]\\]",populate:function(e,r,n){var i=Di(n,3),a=i[0],s=i[1],o=i[2];r.checks.push({type:Bt.META_COMPARE,field:hp(a),operator:s,value:parseFloat(o)})}},{name:"nextQuery",separator:!0,regex:Gr.separator,populate:function(e,r){var n=e.currentSubject,i=e.edgeCount,a=e.compoundCount,s=e[e.length-1];n!=null&&(s.subject=n,e.currentSubject=null),s.edgeCount=i,s.compoundCount=a,e.edgeCount=0,e.compoundCount=0;var o=e[e.length++]=vn();return o}},{name:"directedEdge",separator:!0,regex:Gr.directedEdge,populate:function(e,r){if(e.currentSubject==null){var n=vn(),i=r,a=vn();return n.checks.push({type:Bt.DIRECTED_EDGE,source:i,target:a}),yd(e,r,n),e.edgeCount++,a}else{var s=vn(),o=r,l=vn();return s.checks.push({type:Bt.NODE_SOURCE,source:o,target:l}),yd(e,r,s),e.edgeCount++,l}}},{name:"undirectedEdge",separator:!0,regex:Gr.undirectedEdge,populate:function(e,r){if(e.currentSubject==null){var n=vn(),i=r,a=vn();return n.checks.push({type:Bt.UNDIRECTED_EDGE,nodes:[i,a]}),yd(e,r,n),e.edgeCount++,a}else{var s=vn(),o=r,l=vn();return s.checks.push({type:Bt.NODE_NEIGHBOR,node:o,neighbor:l}),yd(e,r,s),l}}},{name:"child",separator:!0,regex:Gr.child,populate:function(e,r){if(e.currentSubject==null){var n=vn(),i=vn(),a=e[e.length-1];return n.checks.push({type:Bt.CHILD,parent:a,child:i}),yd(e,r,n),e.compoundCount++,i}else if(e.currentSubject===r){var s=vn(),o=e[e.length-1],l=vn(),u=vn(),c=vn(),h=vn();return s.checks.push({type:Bt.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=r.checks,r.checks=[{type:Bt.TRUE}],h.checks.push({type:Bt.TRUE}),l.checks.push({type:Bt.PARENT,parent:h,child:c}),yd(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var p=vn(),g=vn(),y=[{type:Bt.PARENT,parent:p,child:g}];return p.checks=r.checks,r.checks=y,e.compoundCount++,g}}},{name:"descendant",separator:!0,regex:Gr.descendant,populate:function(e,r){if(e.currentSubject==null){var n=vn(),i=vn(),a=e[e.length-1];return n.checks.push({type:Bt.DESCENDANT,ancestor:a,descendant:i}),yd(e,r,n),e.compoundCount++,i}else if(e.currentSubject===r){var s=vn(),o=e[e.length-1],l=vn(),u=vn(),c=vn(),h=vn();return s.checks.push({type:Bt.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=r.checks,r.checks=[{type:Bt.TRUE}],h.checks.push({type:Bt.TRUE}),l.checks.push({type:Bt.ANCESTOR,ancestor:h,descendant:c}),yd(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var p=vn(),g=vn(),y=[{type:Bt.ANCESTOR,ancestor:p,descendant:g}];return p.checks=r.checks,r.checks=y,e.compoundCount++,g}}},{name:"subject",modifier:!0,regex:Gr.subject,populate:function(e,r){if(e.currentSubject!=null&&e.currentSubject!==r)return an("Redefinition of subject in selector `"+e.toString()+"`"),!1;e.currentSubject=r;var n=e[e.length-1],i=n.checks[0],a=i==null?null:i.type;a===Bt.DIRECTED_EDGE?i.type=Bt.NODE_TARGET:a===Bt.UNDIRECTED_EDGE&&(i.type=Bt.NODE_NEIGHBOR,i.node=i.nodes[1],i.neighbor=i.nodes[0],i.nodes=null)}}];US.forEach(function(t){return t.regexObj=new RegExp("^"+t.regex)});var JB=function(e){for(var r,n,i,a=0;a<US.length;a++){var s=US[a],o=s.name,l=e.match(s.regexObj);if(l!=null){n=l,r=s,i=o;var u=l[0];e=e.substring(u.length);break}}return{expr:r,match:n,name:i,remaining:e}},e7=function(e){var r=e.match(/^\s+/);if(r){var n=r[0];e=e.substring(n.length)}return e},t7=function(e){var r=this,n=r.inputText=e,i=r[0]=vn();for(r.length=1,n=e7(n);;){var a=JB(n);if(a.expr==null)return an("The selector `"+e+"`is invalid"),!1;var s=a.match.slice(1),o=a.expr.populate(r,i,s);if(o===!1)return!1;if(o!=null&&(i=o),n=a.remaining,n.match(/^\s*$/))break}var l=r[r.length-1];r.currentSubject!=null&&(l.subject=r.currentSubject),l.edgeCount=r.edgeCount,l.compoundCount=r.compoundCount;for(var u=0;u<r.length;u++){var c=r[u];if(c.compoundCount>0&&c.edgeCount>0)return an("The selector `"+e+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(c.edgeCount>1)return an("The selector `"+e+"` is invalid because it uses multiple edge selectors"),!1;c.edgeCount===1&&an("The selector `"+e+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},r7=function(){if(this.toStringCache!=null)return this.toStringCache;for(var e=function(c){return c??""},r=function(c){return Zt(c)?'"'+c+'"':e(c)},n=function(c){return" "+c+" "},i=function(c,h){var p=c.type,g=c.value;switch(p){case Bt.GROUP:{var y=e(g);return y.substring(0,y.length-1)}case Bt.DATA_COMPARE:{var S=c.field,w=c.operator;return"["+S+n(e(w))+r(g)+"]"}case Bt.DATA_BOOL:{var C=c.operator,_=c.field;return"["+e(C)+_+"]"}case Bt.DATA_EXIST:{var T=c.field;return"["+T+"]"}case Bt.META_COMPARE:{var N=c.operator,R=c.field;return"[["+R+n(e(N))+r(g)+"]]"}case Bt.STATE:return g;case Bt.ID:return"#"+g;case Bt.CLASS:return"."+g;case Bt.PARENT:case Bt.CHILD:return a(c.parent,h)+n(">")+a(c.child,h);case Bt.ANCESTOR:case Bt.DESCENDANT:return a(c.ancestor,h)+" "+a(c.descendant,h);case Bt.COMPOUND_SPLIT:{var I=a(c.left,h),j=a(c.subject,h),O=a(c.right,h);return I+(I.length>0?" ":"")+j+O}case Bt.TRUE:return""}},a=function(c,h){return c.checks.reduce(function(p,g,y){return p+(h===c&&y===0?"$":"")+i(g,h)},"")},s="",o=0;o<this.length;o++){var l=this[o];s+=a(l,l.subject),this.length>1&&o<this.length-1&&(s+=", ")}return this.toStringCache=s,s},n7={parse:t7,toString:r7},fA=function(e,r,n){var i,a=Zt(e),s=kt(e),o=Zt(n),l,u,c=!1,h=!1,p=!1;switch(r.indexOf("!")>=0&&(r=r.replace("!",""),h=!0),r.indexOf("@")>=0&&(r=r.replace("@",""),c=!0),(a||o||c)&&(l=!a&&!s?"":""+e,u=""+n),c&&(e=l=l.toLowerCase(),n=u=u.toLowerCase()),r){case"*=":i=l.indexOf(u)>=0;break;case"$=":i=l.indexOf(u,l.length-u.length)>=0;break;case"^=":i=l.indexOf(u)===0;break;case"=":i=e===n;break;case">":p=!0,i=e>n;break;case">=":p=!0,i=e>=n;break;case"<":p=!0,i=e<n;break;case"<=":p=!0,i=e<=n;break;default:i=!1;break}return h&&(e!=null||!p)&&(i=!i),i},i7=function(e,r){switch(r){case"?":return!!e;case"!":return!e;case"^":return e===void 0}},a7=function(e){return e!==void 0},c_=function(e,r){return e.data(r)},s7=function(e,r){return e[r]()},fi=[],On=function(e,r){return e.checks.every(function(n){return fi[n.type](n,r)})};fi[Bt.GROUP]=function(t,e){var r=t.value;return r==="*"||r===e.group()};fi[Bt.STATE]=function(t,e){var r=t.value;return XB(r,e)};fi[Bt.ID]=function(t,e){var r=t.value;return e.id()===r};fi[Bt.CLASS]=function(t,e){var r=t.value;return e.hasClass(r)};fi[Bt.META_COMPARE]=function(t,e){var r=t.field,n=t.operator,i=t.value;return fA(s7(e,r),n,i)};fi[Bt.DATA_COMPARE]=function(t,e){var r=t.field,n=t.operator,i=t.value;return fA(c_(e,r),n,i)};fi[Bt.DATA_BOOL]=function(t,e){var r=t.field,n=t.operator;return i7(c_(e,r),n)};fi[Bt.DATA_EXIST]=function(t,e){var r=t.field;return t.operator,a7(c_(e,r))};fi[Bt.UNDIRECTED_EDGE]=function(t,e){var r=t.nodes[0],n=t.nodes[1],i=e.source(),a=e.target();return On(r,i)&&On(n,a)||On(n,i)&&On(r,a)};fi[Bt.NODE_NEIGHBOR]=function(t,e){return On(t.node,e)&&e.neighborhood().some(function(r){return r.isNode()&&On(t.neighbor,r)})};fi[Bt.DIRECTED_EDGE]=function(t,e){return On(t.source,e.source())&&On(t.target,e.target())};fi[Bt.NODE_SOURCE]=function(t,e){return On(t.source,e)&&e.outgoers().some(function(r){return r.isNode()&&On(t.target,r)})};fi[Bt.NODE_TARGET]=function(t,e){return On(t.target,e)&&e.incomers().some(function(r){return r.isNode()&&On(t.source,r)})};fi[Bt.CHILD]=function(t,e){return On(t.child,e)&&On(t.parent,e.parent())};fi[Bt.PARENT]=function(t,e){return On(t.parent,e)&&e.children().some(function(r){return On(t.child,r)})};fi[Bt.DESCENDANT]=function(t,e){return On(t.descendant,e)&&e.ancestors().some(function(r){return On(t.ancestor,r)})};fi[Bt.ANCESTOR]=function(t,e){return On(t.ancestor,e)&&e.descendants().some(function(r){return On(t.descendant,r)})};fi[Bt.COMPOUND_SPLIT]=function(t,e){return On(t.subject,e)&&On(t.left,e)&&On(t.right,e)};fi[Bt.TRUE]=function(){return!0};fi[Bt.COLLECTION]=function(t,e){var r=t.value;return r.has(e)};fi[Bt.FILTER]=function(t,e){var r=t.value;return r(e)};var o7=function(e){var r=this;if(r.length===1&&r[0].checks.length===1&&r[0].checks[0].type===Bt.ID)return e.getElementById(r[0].checks[0].value).collection();var n=function(a){for(var s=0;s<r.length;s++){var o=r[s];if(On(o,a))return!0}return!1};return r.text()==null&&(n=function(){return!0}),e.filter(n)},l7=function(e){for(var r=this,n=0;n<r.length;n++){var i=r[n];if(On(i,e))return!0}return!1},u7={matches:l7,filter:o7},Qd=function(e){this.inputText=e,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,e==null||Zt(e)&&e.match(/^\s*$/)||(vo(e)?this.addQuery({checks:[{type:Bt.COLLECTION,value:e.collection()}]}):ri(e)?this.addQuery({checks:[{type:Bt.FILTER,value:e}]}):Zt(e)?this.parse(e)||(this.invalid=!0):Kn("A selector must be created from a string; found "))},Jd=Qd.prototype;[n7,u7].forEach(function(t){return ar(Jd,t)});Jd.text=function(){return this.inputText};Jd.size=function(){return this.length};Jd.eq=function(t){return this[t]};Jd.sameText=function(t){return!this.invalid&&!t.invalid&&this.text()===t.text()};Jd.addQuery=function(t){this[this.length++]=t};Jd.selector=Jd.toString;var Ud={allAre:function(e){var r=new Qd(e);return this.every(function(n){return r.matches(n)})},is:function(e){var r=new Qd(e);return this.some(function(n){return r.matches(n)})},some:function(e,r){for(var n=0;n<this.length;n++){var i=r?e.apply(r,[this[n],n,this]):e(this[n],n,this);if(i)return!0}return!1},every:function(e,r){for(var n=0;n<this.length;n++){var i=r?e.apply(r,[this[n],n,this]):e(this[n],n,this);if(!i)return!1}return!0},same:function(e){if(this===e)return!0;e=this.cy().collection(e);var r=this.length,n=e.length;return r!==n?!1:r===1?this[0]===e[0]:this.every(function(i){return e.hasElementWithId(i.id())})},anySame:function(e){return e=this.cy().collection(e),this.some(function(r){return e.hasElementWithId(r.id())})},allAreNeighbors:function(e){e=this.cy().collection(e);var r=this.neighborhood();return e.every(function(n){return r.hasElementWithId(n.id())})},contains:function(e){e=this.cy().collection(e);var r=this;return e.every(function(n){return r.hasElementWithId(n.id())})}};Ud.allAreNeighbours=Ud.allAreNeighbors;Ud.has=Ud.contains;Ud.equal=Ud.equals=Ud.same;var Xo=function(e,r){return function(i,a,s,o){var l=i,u=this,c;if(l==null?c="":vo(l)&&l.length===1&&(c=l.id()),u.length===1&&c){var h=u[0]._private,p=h.traversalCache=h.traversalCache||{},g=p[r]=p[r]||[],y=pf(c),S=g[y];return S||(g[y]=e.call(u,i,a,s,o))}else return e.call(u,i,a,s,o)}},$p={parent:function(e){var r=[];if(this.length===1){var n=this[0]._private.parent;if(n)return n}for(var i=0;i<this.length;i++){var a=this[i],s=a._private.parent;s&&r.push(s)}return this.spawn(r,!0).filter(e)},parents:function(e){for(var r=[],n=this.parent();n.nonempty();){for(var i=0;i<n.length;i++){var a=n[i];r.push(a)}n=n.parent()}return this.spawn(r,!0).filter(e)},commonAncestors:function(e){for(var r,n=0;n<this.length;n++){var i=this[n],a=i.parents();r=r||a,r=r.intersect(a)}return r.filter(e)},orphans:function(e){return this.stdFilter(function(r){return r.isOrphan()}).filter(e)},nonorphans:function(e){return this.stdFilter(function(r){return r.isChild()}).filter(e)},children:Xo(function(t){for(var e=[],r=0;r<this.length;r++)for(var n=this[r],i=n._private.children,a=0;a<i.length;a++)e.push(i[a]);return this.spawn(e,!0).filter(t)},"children"),siblings:function(e){return this.parent().children().not(this).filter(e)},isParent:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length!==0},isChildless:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length===0},isChild:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent!=null},isOrphan:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent==null},descendants:function(e){var r=[];function n(i){for(var a=0;a<i.length;a++){var s=i[a];r.push(s),s.children().nonempty()&&n(s.children())}}return n(this.children()),this.spawn(r,!0).filter(e)}};function d_(t,e,r,n){for(var i=[],a=new um,s=t.cy(),o=s.hasCompoundNodes(),l=0;l<t.length;l++){var u=t[l];r?i.push(u):o&&n(i,a,u)}for(;i.length>0;){var c=i.shift();e(c),a.add(c.id()),o&&n(i,a,c)}return t}function pA(t,e,r){if(r.isParent())for(var n=r._private.children,i=0;i<n.length;i++){var a=n[i];e.has(a.id())||t.push(a)}}$p.forEachDown=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return d_(this,t,e,pA)};function mA(t,e,r){if(r.isChild()){var n=r._private.parent;e.has(n.id())||t.push(n)}}$p.forEachUp=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return d_(this,t,e,mA)};function c7(t,e,r){mA(t,e,r),pA(t,e,r)}$p.forEachUpAndDown=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return d_(this,t,e,c7)};$p.ancestors=$p.parents;var kv,gA;kv=gA={data:nn.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:nn.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:nn.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:nn.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:nn.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:nn.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var e=this[0];if(e)return e._private.data.id}};kv.attr=kv.data;kv.removeAttr=kv.removeData;var d7=gA,P1={};function o2(t){return function(e){var r=this;if(e===void 0&&(e=!0),r.length!==0)if(r.isNode()&&!r.removed()){for(var n=0,i=r[0],a=i._private.edges,s=0;s<a.length;s++){var o=a[s];!e&&o.isLoop()||(n+=t(i,o))}return n}else return}}ar(P1,{degree:o2(function(t,e){return e.source().same(e.target())?2:1}),indegree:o2(function(t,e){return e.target().same(t)?1:0}),outdegree:o2(function(t,e){return e.source().same(t)?1:0})});function fp(t,e){return function(r){for(var n,i=this.nodes(),a=0;a<i.length;a++){var s=i[a],o=s[t](r);o!==void 0&&(n===void 0||e(o,n))&&(n=o)}return n}}ar(P1,{minDegree:fp("degree",function(t,e){return t<e}),maxDegree:fp("degree",function(t,e){return t>e}),minIndegree:fp("indegree",function(t,e){return t<e}),maxIndegree:fp("indegree",function(t,e){return t>e}),minOutdegree:fp("outdegree",function(t,e){return t<e}),maxOutdegree:fp("outdegree",function(t,e){return t>e})});ar(P1,{totalDegree:function(e){for(var r=0,n=this.nodes(),i=0;i<n.length;i++)r+=n[i].degree(e);return r}});var Il,vA,yA=function(e,r,n){for(var i=0;i<e.length;i++){var a=e[i];if(!a.locked()){var s=a._private.position,o={x:r.x!=null?r.x-s.x:0,y:r.y!=null?r.y-s.y:0};a.isParent()&&!(o.x===0&&o.y===0)&&a.children().shift(o,n),a.dirtyBoundingBoxCache()}}},cN={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function(e){e.updateCompoundBounds()},beforeSet:function(e,r){yA(e,r,!1)},onSet:function(e){e.dirtyCompoundBoundsCache()},canSet:function(e){return!e.locked()}};Il=vA={position:nn.data(cN),silentPosition:nn.data(ar({},cN,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function(e,r){yA(e,r,!0)},onSet:function(e){e.dirtyCompoundBoundsCache()}})),positions:function(e,r){if(Vr(e))r?this.silentPosition(e):this.position(e);else if(ri(e)){var n=e,i=this.cy();i.startBatch();for(var a=0;a<this.length;a++){var s=this[a],o=void 0;(o=n(s,a))&&(r?s.silentPosition(o):s.position(o))}i.endBatch()}return this},silentPositions:function(e){return this.positions(e,!0)},shift:function(e,r,n){var i;if(Vr(e)?(i={x:kt(e.x)?e.x:0,y:kt(e.y)?e.y:0},n=r):Zt(e)&&kt(r)&&(i={x:0,y:0},i[e]=r),i!=null){var a=this.cy();a.startBatch();for(var s=0;s<this.length;s++){var o=this[s];if(!(a.hasCompoundNodes()&&o.isChild()&&o.ancestors().anySame(this))){var l=o.position(),u={x:l.x+i.x,y:l.y+i.y};n?o.silentPosition(u):o.position(u)}}a.endBatch()}return this},silentShift:function(e,r){return Vr(e)?this.shift(e,!0):Zt(e)&&kt(r)&&this.shift(e,r,!0),this},renderedPosition:function(e,r){var n=this[0],i=this.cy(),a=i.zoom(),s=i.pan(),o=Vr(e)?e:void 0,l=o!==void 0||r!==void 0&&Zt(e);if(n&&n.isNode())if(l)for(var u=0;u<this.length;u++){var c=this[u];r!==void 0?c.position(e,(r-s[e])/a):o!==void 0&&c.position(qM(o,a,s))}else{var h=n.position();return o=k1(h,a,s),e===void 0?o:o[e]}else if(!l)return;return this},relativePosition:function(e,r){var n=this[0],i=this.cy(),a=Vr(e)?e:void 0,s=a!==void 0||r!==void 0&&Zt(e),o=i.hasCompoundNodes();if(n&&n.isNode())if(s)for(var l=0;l<this.length;l++){var u=this[l],c=o?u.parent():null,h=c&&c.length>0,p=h;h&&(c=c[0]);var g=p?c.position():{x:0,y:0};r!==void 0?u.position(e,r+g[e]):a!==void 0&&u.position({x:a.x+g.x,y:a.y+g.y})}else{var y=n.position(),S=o?n.parent():null,w=S&&S.length>0,C=w;w&&(S=S[0]);var _=C?S.position():{x:0,y:0};return a={x:y.x-_.x,y:y.y-_.y},e===void 0?a:a[e]}else if(!s)return;return this}};Il.modelPosition=Il.point=Il.position;Il.modelPositions=Il.points=Il.positions;Il.renderedPoint=Il.renderedPosition;Il.relativePoint=Il.relativePosition;var h7=vA,zp,oh;zp=oh={};oh.renderedBoundingBox=function(t){var e=this.boundingBox(t),r=this.cy(),n=r.zoom(),i=r.pan(),a=e.x1*n+i.x,s=e.x2*n+i.x,o=e.y1*n+i.y,l=e.y2*n+i.y;return{x1:a,x2:s,y1:o,y2:l,w:s-a,h:l-o}};oh.dirtyCompoundBoundsCache=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();return!e.styleEnabled()||!e.hasCompoundNodes()?this:(this.forEachUp(function(r){if(r.isParent()){var n=r._private;n.compoundBoundsClean=!1,n.bbCache=null,t||r.emitAndNotify("bounds")}}),this)};oh.updateCompoundBounds=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();if(!e.styleEnabled()||!e.hasCompoundNodes())return this;if(!t&&e.batching())return this;function r(s){if(!s.isParent())return;var o=s._private,l=s.children(),u=s.pstyle("compound-sizing-wrt-labels").value==="include",c={width:{val:s.pstyle("min-width").pfValue,left:s.pstyle("min-width-bias-left"),right:s.pstyle("min-width-bias-right")},height:{val:s.pstyle("min-height").pfValue,top:s.pstyle("min-height-bias-top"),bottom:s.pstyle("min-height-bias-bottom")}},h=l.boundingBox({includeLabels:u,includeOverlays:!1,useCache:!1}),p=o.position;(h.w===0||h.h===0)&&(h={w:s.pstyle("width").pfValue,h:s.pstyle("height").pfValue},h.x1=p.x-h.w/2,h.x2=p.x+h.w/2,h.y1=p.y-h.h/2,h.y2=p.y+h.h/2);function g(F,z,V){var q=0,D=0,U=z+V;return F>0&&U>0&&(q=z/U*F,D=V/U*F),{biasDiff:q,biasComplementDiff:D}}function y(F,z,V,q){if(V.units==="%")switch(q){case"width":return F>0?V.pfValue*F:0;case"height":return z>0?V.pfValue*z:0;case"average":return F>0&&z>0?V.pfValue*(F+z)/2:0;case"min":return F>0&&z>0?F>z?V.pfValue*z:V.pfValue*F:0;case"max":return F>0&&z>0?F>z?V.pfValue*F:V.pfValue*z:0;default:return 0}else return V.units==="px"?V.pfValue:0}var S=c.width.left.value;c.width.left.units==="px"&&c.width.val>0&&(S=S*100/c.width.val);var w=c.width.right.value;c.width.right.units==="px"&&c.width.val>0&&(w=w*100/c.width.val);var C=c.height.top.value;c.height.top.units==="px"&&c.height.val>0&&(C=C*100/c.height.val);var _=c.height.bottom.value;c.height.bottom.units==="px"&&c.height.val>0&&(_=_*100/c.height.val);var T=g(c.width.val-h.w,S,w),N=T.biasDiff,R=T.biasComplementDiff,I=g(c.height.val-h.h,C,_),j=I.biasDiff,O=I.biasComplementDiff;o.autoPadding=y(h.w,h.h,s.pstyle("padding"),s.pstyle("padding-relative-to").value),o.autoWidth=Math.max(h.w,c.width.val),p.x=(-N+h.x1+h.x2+R)/2,o.autoHeight=Math.max(h.h,c.height.val),p.y=(-j+h.y1+h.y2+O)/2}for(var n=0;n<this.length;n++){var i=this[n],a=i._private;(!a.compoundBoundsClean||t)&&(r(i),e.batching()||(a.compoundBoundsClean=!0))}return this};var Zo=function(e){return e===1/0||e===-1/0?0:e},Ll=function(e,r,n,i,a){i-r===0||a-n===0||r==null||n==null||i==null||a==null||(e.x1=r<e.x1?r:e.x1,e.x2=i>e.x2?i:e.x2,e.y1=n<e.y1?n:e.y1,e.y2=a>e.y2?a:e.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1)},Ed=function(e,r){return r==null?e:Ll(e,r.x1,r.y1,r.x2,r.y2)},Gm=function(e,r,n){return $s(e,r,n)},ty=function(e,r,n){if(!r.cy().headless()){var i=r._private,a=i.rstyle,s=a.arrowWidth/2,o=r.pstyle(n+"-arrow-shape").value,l,u;if(o!=="none"){n==="source"?(l=a.srcX,u=a.srcY):n==="target"?(l=a.tgtX,u=a.tgtY):(l=a.midX,u=a.midY);var c=i.arrowBounds=i.arrowBounds||{},h=c[n]=c[n]||{};h.x1=l-s,h.y1=u-s,h.x2=l+s,h.y2=u+s,h.w=h.x2-h.x1,h.h=h.y2-h.y1,Dy(h,1),Ll(e,h.x1,h.y1,h.x2,h.y2)}}},l2=function(e,r,n){if(!r.cy().headless()){var i;n?i=n+"-":i="";var a=r._private,s=a.rstyle,o=r.pstyle(i+"label").strValue;if(o){var l=r.pstyle("text-halign"),u=r.pstyle("text-valign"),c=Gm(s,"labelWidth",n),h=Gm(s,"labelHeight",n),p=Gm(s,"labelX",n),g=Gm(s,"labelY",n),y=r.pstyle(i+"text-margin-x").pfValue,S=r.pstyle(i+"text-margin-y").pfValue,w=r.isEdge(),C=r.pstyle(i+"text-rotation"),_=r.pstyle("text-outline-width").pfValue,T=r.pstyle("text-border-width").pfValue,N=T/2,R=r.pstyle("text-background-padding").pfValue,I=2,j=h,O=c,F=O/2,z=j/2,V,q,D,U;if(w)V=p-F,q=p+F,D=g-z,U=g+z;else{switch(l.value){case"left":V=p-O,q=p;break;case"center":V=p-F,q=p+F;break;case"right":V=p,q=p+O;break}switch(u.value){case"top":D=g-j,U=g;break;case"center":D=g-z,U=g+z;break;case"bottom":D=g,U=g+j;break}}var G=y-Math.max(_,N)-R-I,Z=y+Math.max(_,N)+R+I,K=S-Math.max(_,N)-R-I,Q=S+Math.max(_,N)+R+I;V+=G,q+=Z,D+=K,U+=Q;var ne=n||"main",te=a.labelBounds,X=te[ne]=te[ne]||{};X.x1=V,X.y1=D,X.x2=q,X.y2=U,X.w=q-V,X.h=U-D,X.leftPad=G,X.rightPad=Z,X.topPad=K,X.botPad=Q;var re=w&&C.strValue==="autorotate",he=C.pfValue!=null&&C.pfValue!==0;if(re||he){var oe=re?Gm(a.rstyle,"labelAngle",n):C.pfValue,se=Math.cos(oe),fe=Math.sin(oe),ae=(V+q)/2,pe=(D+U)/2;if(!w){switch(l.value){case"left":ae=q;break;case"right":ae=V;break}switch(u.value){case"top":pe=U;break;case"bottom":pe=D;break}}var ye=function(rt,dt){return rt=rt-ae,dt=dt-pe,{x:rt*se-dt*fe+ae,y:rt*fe+dt*se+pe}},ve=ye(V,D),ue=ye(V,U),xe=ye(q,D),Se=ye(q,U);V=Math.min(ve.x,ue.x,xe.x,Se.x),q=Math.max(ve.x,ue.x,xe.x,Se.x),D=Math.min(ve.y,ue.y,xe.y,Se.y),U=Math.max(ve.y,ue.y,xe.y,Se.y)}var Oe=ne+"Rot",Ae=te[Oe]=te[Oe]||{};Ae.x1=V,Ae.y1=D,Ae.x2=q,Ae.y2=U,Ae.w=q-V,Ae.h=U-D,Ll(e,V,D,q,U),Ll(a.labelBounds.all,V,D,q,U)}return e}},dN=function(e,r){if(!r.cy().headless()){var n=r.pstyle("outline-opacity").value,i=r.pstyle("outline-width").value,a=r.pstyle("outline-offset").value,s=i+a;xA(e,r,n,s,"outside",s/2)}},xA=function(e,r,n,i,a,s){if(!(n===0||i<=0||a==="inside")){var o=r.cy(),l=r.pstyle("shape").value,u=o.renderer().nodeShapes[l],c=r.position(),h=c.x,p=c.y,g=r.width(),y=r.height();if(u.hasMiterBounds){a==="center"&&(i/=2);var S=u.miterBounds(h,p,g,y,i);Ed(e,S)}else s!=null&&s>0&&Iy(e,[s,s,s,s])}},f7=function(e,r){if(!r.cy().headless()){var n=r.pstyle("border-opacity").value,i=r.pstyle("border-width").pfValue,a=r.pstyle("border-position").value;xA(e,r,n,i,a)}},p7=function(e,r){var n=e._private.cy,i=n.styleEnabled(),a=n.headless(),s=Es(),o=e._private,l=e.isNode(),u=e.isEdge(),c,h,p,g,y,S,w=o.rstyle,C=l&&i?e.pstyle("bounds-expansion").pfValue:[0],_=function(tt){return tt.pstyle("display").value!=="none"},T=!i||_(e)&&(!u||_(e.source())&&_(e.target()));if(T){var N=0,R=0;i&&r.includeOverlays&&(N=e.pstyle("overlay-opacity").value,N!==0&&(R=e.pstyle("overlay-padding").value));var I=0,j=0;i&&r.includeUnderlays&&(I=e.pstyle("underlay-opacity").value,I!==0&&(j=e.pstyle("underlay-padding").value));var O=Math.max(R,j),F=0,z=0;if(i&&(F=e.pstyle("width").pfValue,z=F/2),l&&r.includeNodes){var V=e.position();y=V.x,S=V.y;var q=e.outerWidth(),D=q/2,U=e.outerHeight(),G=U/2;c=y-D,h=y+D,p=S-G,g=S+G,Ll(s,c,p,h,g),i&&dN(s,e),i&&r.includeOutlines&&!a&&dN(s,e),i&&f7(s,e)}else if(u&&r.includeEdges)if(i&&!a){var Z=e.pstyle("curve-style").strValue;if(c=Math.min(w.srcX,w.midX,w.tgtX),h=Math.max(w.srcX,w.midX,w.tgtX),p=Math.min(w.srcY,w.midY,w.tgtY),g=Math.max(w.srcY,w.midY,w.tgtY),c-=z,h+=z,p-=z,g+=z,Ll(s,c,p,h,g),Z==="haystack"){var K=w.haystackPts;if(K&&K.length===2){if(c=K[0].x,p=K[0].y,h=K[1].x,g=K[1].y,c>h){var Q=c;c=h,h=Q}if(p>g){var ne=p;p=g,g=ne}Ll(s,c-z,p-z,h+z,g+z)}}else if(Z==="bezier"||Z==="unbundled-bezier"||Rd(Z,"segments")||Rd(Z,"taxi")){var te;switch(Z){case"bezier":case"unbundled-bezier":te=w.bezierPts;break;case"segments":case"taxi":case"round-segments":case"round-taxi":te=w.linePts;break}if(te!=null)for(var X=0;X<te.length;X++){var re=te[X];c=re.x-z,h=re.x+z,p=re.y-z,g=re.y+z,Ll(s,c,p,h,g)}}}else{var he=e.source(),oe=he.position(),se=e.target(),fe=se.position();if(c=oe.x,h=fe.x,p=oe.y,g=fe.y,c>h){var ae=c;c=h,h=ae}if(p>g){var pe=p;p=g,g=pe}c-=z,h+=z,p-=z,g+=z,Ll(s,c,p,h,g)}if(i&&r.includeEdges&&u&&(ty(s,e,"mid-source"),ty(s,e,"mid-target"),ty(s,e,"source"),ty(s,e,"target")),i){var ye=e.pstyle("ghost").value==="yes";if(ye){var ve=e.pstyle("ghost-offset-x").pfValue,ue=e.pstyle("ghost-offset-y").pfValue;Ll(s,s.x1+ve,s.y1+ue,s.x2+ve,s.y2+ue)}}var xe=o.bodyBounds=o.bodyBounds||{};YE(xe,s),Iy(xe,C),Dy(xe,1),i&&(c=s.x1,h=s.x2,p=s.y1,g=s.y2,Ll(s,c-O,p-O,h+O,g+O));var Se=o.overlayBounds=o.overlayBounds||{};YE(Se,s),Iy(Se,C),Dy(Se,1);var Oe=o.labelBounds=o.labelBounds||{};Oe.all!=null?Z9(Oe.all):Oe.all=Es(),i&&r.includeLabels&&(r.includeMainLabels&&l2(s,e,null),u&&(r.includeSourceLabels&&l2(s,e,"source"),r.includeTargetLabels&&l2(s,e,"target")))}return s.x1=Zo(s.x1),s.y1=Zo(s.y1),s.x2=Zo(s.x2),s.y2=Zo(s.y2),s.w=Zo(s.x2-s.x1),s.h=Zo(s.y2-s.y1),s.w>0&&s.h>0&&T&&(Iy(s,C),Dy(s,1)),s},bA=function(e){var r=0,n=function(s){return(s?1:0)<<r++},i=0;return i+=n(e.incudeNodes),i+=n(e.includeEdges),i+=n(e.includeLabels),i+=n(e.includeMainLabels),i+=n(e.includeSourceLabels),i+=n(e.includeTargetLabels),i+=n(e.includeOverlays),i+=n(e.includeOutlines),i},wA=function(e){var r=function(o){return Math.round(o)};if(e.isEdge()){var n=e.source().position(),i=e.target().position();return HE([r(n.x),r(n.y),r(i.x),r(i.y)])}else{var a=e.position();return HE([r(a.x),r(a.y)])}},hN=function(e,r){var n=e._private,i,a=e.isEdge(),s=r==null?fN:bA(r),o=s===fN;if(n.bbCache==null?(i=p7(e,_v),n.bbCache=i,n.bbCachePosKey=wA(e)):i=n.bbCache,!o){var l=e.isNode();i=Es(),(r.includeNodes&&l||r.includeEdges&&!l)&&(r.includeOverlays?Ed(i,n.overlayBounds):Ed(i,n.bodyBounds)),r.includeLabels&&(r.includeMainLabels&&(!a||r.includeSourceLabels&&r.includeTargetLabels)?Ed(i,n.labelBounds.all):(r.includeMainLabels&&Ed(i,n.labelBounds.mainRot),r.includeSourceLabels&&Ed(i,n.labelBounds.sourceRot),r.includeTargetLabels&&Ed(i,n.labelBounds.targetRot))),i.w=i.x2-i.x1,i.h=i.y2-i.y1}return i},_v={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,includeUnderlays:!0,includeOutlines:!0,useCache:!0},fN=bA(_v),pN=Ha(_v);oh.boundingBox=function(t){var e,r=t===void 0||t.useCache===void 0||t.useCache===!0,n=Wp(function(c){var h=c._private;return h.bbCache==null||h.styleDirty||h.bbCachePosKey!==wA(c)},function(c){return c.id()});if(r&&this.length===1&&!n(this[0]))t===void 0?t=_v:t=pN(t),e=hN(this[0],t);else{e=Es(),t=t||_v;var i=pN(t),a=this,s=a.cy(),o=s.styleEnabled();this.edges().forEach(n),this.nodes().forEach(n),o&&this.recalculateRenderedStyle(r),this.updateCompoundBounds(!r);for(var l=0;l<a.length;l++){var u=a[l];n(u)&&u.dirtyBoundingBoxCache(),Ed(e,hN(u,i))}}return e.x1=Zo(e.x1),e.y1=Zo(e.y1),e.x2=Zo(e.x2),e.y2=Zo(e.y2),e.w=Zo(e.x2-e.x1),e.h=Zo(e.y2-e.y1),e};oh.dirtyBoundingBoxCache=function(){for(var t=0;t<this.length;t++){var e=this[t]._private;e.bbCache=null,e.bbCachePosKey=null,e.bodyBounds=null,e.overlayBounds=null,e.labelBounds.all=null,e.labelBounds.source=null,e.labelBounds.target=null,e.labelBounds.main=null,e.labelBounds.sourceRot=null,e.labelBounds.targetRot=null,e.labelBounds.mainRot=null,e.arrowBounds.source=null,e.arrowBounds.target=null,e.arrowBounds["mid-source"]=null,e.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this};oh.boundingBoxAt=function(t){var e=this.nodes(),r=this.cy(),n=r.hasCompoundNodes(),i=r.collection();if(n&&(i=e.filter(function(u){return u.isParent()}),e=e.not(i)),Vr(t)){var a=t;t=function(){return a}}var s=function(c,h){return c._private.bbAtOldPos=t(c,h)},o=function(c){return c._private.bbAtOldPos};r.startBatch(),e.forEach(s).silentPositions(t),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0));var l=K9(this.boundingBox({useCache:!1}));return e.silentPositions(o),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0)),r.endBatch(),l};zp.boundingbox=zp.bb=zp.boundingBox;zp.renderedBoundingbox=zp.renderedBoundingBox;var m7=oh,Wg,e0;Wg=e0={};var SA=function(e){e.uppercaseName=PE(e.name),e.autoName="auto"+e.uppercaseName,e.labelName="label"+e.uppercaseName,e.outerName="outer"+e.uppercaseName,e.uppercaseOuterName=PE(e.outerName),Wg[e.name]=function(){var n=this[0],i=n._private,a=i.cy,s=a._private.styleEnabled;if(n)if(s){if(n.isParent())return n.updateCompoundBounds(),i[e.autoName]||0;var o=n.pstyle(e.name);return o.strValue==="label"?(n.recalculateRenderedStyle(),i.rstyle[e.labelName]||0):o.pfValue}else return 1},Wg["outer"+e.uppercaseName]=function(){var n=this[0],i=n._private,a=i.cy,s=a._private.styleEnabled;if(n)if(s){var o=n[e.name](),l=n.pstyle("border-position").value,u;l==="center"?u=n.pstyle("border-width").pfValue:l==="outside"?u=2*n.pstyle("border-width").pfValue:u=0;var c=2*n.padding();return o+u+c}else return 1},Wg["rendered"+e.uppercaseName]=function(){var n=this[0];if(n){var i=n[e.name]();return i*this.cy().zoom()}},Wg["rendered"+e.uppercaseOuterName]=function(){var n=this[0];if(n){var i=n[e.outerName]();return i*this.cy().zoom()}}};SA({name:"width"});SA({name:"height"});e0.padding=function(){var t=this[0],e=t._private;return t.isParent()?(t.updateCompoundBounds(),e.autoPadding!==void 0?e.autoPadding:t.pstyle("padding").pfValue):t.pstyle("padding").pfValue};e0.paddedHeight=function(){var t=this[0];return t.height()+2*t.padding()};e0.paddedWidth=function(){var t=this[0];return t.width()+2*t.padding()};var g7=e0,v7=function(e,r){if(e.isEdge()&&e.takesUpSpace())return r(e)},y7=function(e,r){if(e.isEdge()&&e.takesUpSpace()){var n=e.cy();return k1(r(e),n.zoom(),n.pan())}},x7=function(e,r){if(e.isEdge()&&e.takesUpSpace()){var n=e.cy(),i=n.pan(),a=n.zoom();return r(e).map(function(s){return k1(s,a,i)})}},b7=function(e){return e.renderer().getControlPoints(e)},w7=function(e){return e.renderer().getSegmentPoints(e)},S7=function(e){return e.renderer().getSourceEndpoint(e)},k7=function(e){return e.renderer().getTargetEndpoint(e)},_7=function(e){return e.renderer().getEdgeMidpoint(e)},mN={controlPoints:{get:b7,mult:!0},segmentPoints:{get:w7,mult:!0},sourceEndpoint:{get:S7},targetEndpoint:{get:k7},midpoint:{get:_7}},C7=function(e){return"rendered"+e[0].toUpperCase()+e.substr(1)},E7=Object.keys(mN).reduce(function(t,e){var r=mN[e],n=C7(e);return t[e]=function(){return v7(this,r.get)},r.mult?t[n]=function(){return x7(this,r.get)}:t[n]=function(){return y7(this,r.get)},t},{}),T7=ar({},h7,m7,g7,E7);var kA=function(e,r){this.recycle(e,r)};function Vm(){return!1}function ry(){return!0}kA.prototype={instanceString:function(){return"event"},recycle:function(e,r){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=Vm,e!=null&&e.preventDefault?(this.type=e.type,this.isDefaultPrevented=e.defaultPrevented?ry:Vm):e!=null&&e.type?r=e:this.type=e,r!=null&&(this.originalEvent=r.originalEvent,this.type=r.type!=null?r.type:this.type,this.cy=r.cy,this.target=r.target,this.position=r.position,this.renderedPosition=r.renderedPosition,this.namespace=r.namespace,this.layout=r.layout),this.cy!=null&&this.position!=null&&this.renderedPosition==null){var n=this.position,i=this.cy.zoom(),a=this.cy.pan();this.renderedPosition={x:n.x*i+a.x,y:n.y*i+a.y}}this.timeStamp=e&&e.timeStamp||Date.now()},preventDefault:function(){this.isDefaultPrevented=ry;var e=this.originalEvent;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.isPropagationStopped=ry;var e=this.originalEvent;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=ry,this.stopPropagation()},isDefaultPrevented:Vm,isPropagationStopped:Vm,isImmediatePropagationStopped:Vm};var _A=/^([^.]+)(\.(?:[^.]+))?$/,N7=".*",CA={qualifierCompare:function(e,r){return e===r},eventMatches:function(){return!0},addEventFields:function(){},callbackContext:function(e){return e},beforeEmit:function(){},afterEmit:function(){},bubble:function(){return!1},parent:function(){return null},context:null},gN=Object.keys(CA),P7={};function M1(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:P7,e=arguments.length>1?arguments[1]:void 0,r=0;r<gN.length;r++){var n=gN[r];this[n]=t[n]||CA[n]}this.context=e||this.context,this.listeners=[],this.emitting=0}var eh=M1.prototype,EA=function(e,r,n,i,a,s,o){ri(i)&&(a=i,i=null),o&&(s==null?s=o:s=ar({},s,o));for(var l=Sn(n)?n:n.split(/\s+/),u=0;u<l.length;u++){var c=l[u];if(!Zd(c)){var h=c.match(_A);if(h){var p=h[1],g=h[2]?h[2]:null,y=r(e,c,p,g,i,a,s);if(y===!1)break}}}},vN=function(e,r){return e.addEventFields(e.context,r),new kA(r.type,r)},M7=function(e,r,n){if(Ij(n)){r(e,n);return}else if(Vr(n)){r(e,vN(e,n));return}for(var i=Sn(n)?n:n.split(/\s+/),a=0;a<i.length;a++){var s=i[a];if(!Zd(s)){var o=s.match(_A);if(o){var l=o[1],u=o[2]?o[2]:null,c=vN(e,{type:l,namespace:u,target:e.context});r(e,c)}}}};eh.on=eh.addListener=function(t,e,r,n,i){return EA(this,function(a,s,o,l,u,c,h){ri(c)&&a.listeners.push({event:s,callback:c,type:o,namespace:l,qualifier:u,conf:h})},t,e,r,n,i),this};eh.one=function(t,e,r,n){return this.on(t,e,r,n,{one:!0})};eh.removeListener=eh.off=function(t,e,r,n){var i=this;this.emitting!==0&&(this.listeners=y9(this.listeners));for(var a=this.listeners,s=function(u){var c=a[u];EA(i,function(h,p,g,y,S,w){if((c.type===g||t==="*")&&(!y&&c.namespace!==".*"||c.namespace===y)&&(!S||h.qualifierCompare(c.qualifier,S))&&(!w||c.callback===w))return a.splice(u,1),!1},t,e,r,n)},o=a.length-1;o>=0;o--)s(o);return this};eh.removeAllListeners=function(){return this.removeListener("*")};eh.emit=eh.trigger=function(t,e,r){var n=this.listeners,i=n.length;return this.emitting++,Sn(e)||(e=[e]),M7(this,function(a,s){r!=null&&(n=[{event:s.event,type:s.type,namespace:s.namespace,callback:r}],i=n.length);for(var o=function(){var c=n[l];if(c.type===s.type&&(!c.namespace||c.namespace===s.namespace||c.namespace===N7)&&a.eventMatches(a.context,c,s)){var h=[s];e!=null&&b9(h,e),a.beforeEmit(a.context,c,s),c.conf&&c.conf.one&&(a.listeners=a.listeners.filter(function(y){return y!==c}));var p=a.callbackContext(a.context,c,s),g=c.callback.apply(p,h);a.afterEmit(a.context,c,s),g===!1&&(s.stopPropagation(),s.preventDefault())}},l=0;l<i;l++)o();a.bubble(a.context)&&!s.isPropagationStopped()&&a.parent(a.context).emit(s,e)},t),this.emitting--,this};var A7={qualifierCompare:function(e,r){return e==null||r==null?e==null&&r==null:e.sameText(r)},eventMatches:function(e,r,n){var i=r.qualifier;return i!=null?e!==n.target&&Kv(n.target)&&i.matches(n.target):!0},addEventFields:function(e,r){r.cy=e.cy(),r.target=e},callbackContext:function(e,r,n){return r.qualifier!=null?n.target:e},beforeEmit:function(e,r){r.conf&&r.conf.once&&r.conf.onceCollection.removeListener(r.event,r.qualifier,r.callback)},bubble:function(){return!0},parent:function(e){return e.isChild()?e.parent():e.cy()}},ny=function(e){return Zt(e)?new Qd(e):e},TA={createEmitter:function(){for(var e=0;e<this.length;e++){var r=this[e],n=r._private;n.emitter||(n.emitter=new M1(A7,r))}return this},emitter:function(){return this._private.emitter},on:function(e,r,n){for(var i=ny(r),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,n)}return this},removeListener:function(e,r,n){for(var i=ny(r),a=0;a<this.length;a++){var s=this[a];s.emitter().removeListener(e,i,n)}return this},removeAllListeners:function(){for(var e=0;e<this.length;e++){var r=this[e];r.emitter().removeAllListeners()}return this},one:function(e,r,n){for(var i=ny(r),a=0;a<this.length;a++){var s=this[a];s.emitter().one(e,i,n)}return this},once:function(e,r,n){for(var i=ny(r),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,n,{once:!0,onceCollection:this})}},emit:function(e,r){for(var n=0;n<this.length;n++){var i=this[n];i.emitter().emit(e,r)}return this},emitAndNotify:function(e,r){if(this.length!==0)return this.cy().notify(e,this),this.emit(e,r),this}};nn.eventAliasesOn(TA);var NA={nodes:function(e){return this.filter(function(r){return r.isNode()}).filter(e)},edges:function(e){return this.filter(function(r){return r.isEdge()}).filter(e)},byGroup:function(){for(var e=this.spawn(),r=this.spawn(),n=0;n<this.length;n++){var i=this[n];i.isNode()?e.push(i):r.push(i)}return{nodes:e,edges:r}},filter:function(e,r){if(e===void 0)return this;if(Zt(e)||vo(e))return new Qd(e).filter(this);if(ri(e)){for(var n=this.spawn(),i=this,a=0;a<i.length;a++){var s=i[a],o=r?e.apply(r,[s,a,i]):e(s,a,i);o&&n.push(s)}return n}return this.spawn()},not:function(e){if(e){Zt(e)&&(e=this.filter(e));for(var r=this.spawn(),n=0;n<this.length;n++){var i=this[n],a=e.has(i);a||r.push(i)}return r}else return this},absoluteComplement:function(){var e=this.cy();return e.mutableElements().not(this)},intersect:function(e){if(Zt(e)){var r=e;return this.filter(r)}for(var n=this.spawn(),i=this,a=e,s=this.length<e.length,o=s?i:a,l=s?a:i,u=0;u<o.length;u++){var c=o[u];l.has(c)&&n.push(c)}return n},xor:function(e){var r=this._private.cy;Zt(e)&&(e=r.$(e));var n=this.spawn(),i=this,a=e,s=function(l,u){for(var c=0;c<l.length;c++){var h=l[c],p=h._private.data.id,g=u.hasElementWithId(p);g||n.push(h)}};return s(i,a),s(a,i),n},diff:function(e){var r=this._private.cy;Zt(e)&&(e=r.$(e));var n=this.spawn(),i=this.spawn(),a=this.spawn(),s=this,o=e,l=function(c,h,p){for(var g=0;g<c.length;g++){var y=c[g],S=y._private.data.id,w=h.hasElementWithId(S);w?a.merge(y):p.push(y)}};return l(s,o,n),l(o,s,i),{left:n,right:i,both:a}},add:function(e){var r=this._private.cy;if(!e)return this;if(Zt(e)){var n=e;e=r.mutableElements().filter(n)}for(var i=this.spawnSelf(),a=0;a<e.length;a++){var s=e[a],o=!this.has(s);o&&i.push(s)}return i},merge:function(e){var r=this._private,n=r.cy;if(!e)return this;if(e&&Zt(e)){var i=e;e=n.mutableElements().filter(i)}for(var a=r.map,s=0;s<e.length;s++){var o=e[s],l=o._private.data.id,u=!a.has(l);if(u){var c=this.length++;this[c]=o,a.set(l,{ele:o,index:c})}}return this},unmergeAt:function(e){var r=this[e],n=r.id(),i=this._private,a=i.map;this[e]=void 0,a.delete(n);var s=e===this.length-1;if(this.length>1&&!s){var o=this.length-1,l=this[o],u=l._private.data.id;this[o]=void 0,this[e]=l,a.set(u,{ele:l,index:e})}return this.length--,this},unmergeOne:function(e){e=e[0];var r=this._private,n=e._private.data.id,i=r.map,a=i.get(n);if(!a)return this;var s=a.index;return this.unmergeAt(s),this},unmerge:function(e){var r=this._private.cy;if(!e)return this;if(e&&Zt(e)){var n=e;e=r.mutableElements().filter(n)}for(var i=0;i<e.length;i++)this.unmergeOne(e[i]);return this},unmergeBy:function(e){for(var r=this.length-1;r>=0;r--){var n=this[r];e(n)&&this.unmergeAt(r)}return this},map:function(e,r){for(var n=[],i=this,a=0;a<i.length;a++){var s=i[a],o=r?e.apply(r,[s,a,i]):e(s,a,i);n.push(o)}return n},reduce:function(e,r){for(var n=r,i=this,a=0;a<i.length;a++)n=e(n,i[a],a,i);return n},max:function(e,r){for(var n=-1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=r?e.apply(r,[o,s,a]):e(o,s,a);l>n&&(n=l,i=o)}return{value:n,ele:i}},min:function(e,r){for(var n=1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=r?e.apply(r,[o,s,a]):e(o,s,a);l<n&&(n=l,i=o)}return{value:n,ele:i}}},qr=NA;qr.u=qr["|"]=qr["+"]=qr.union=qr.or=qr.add;qr["\\"]=qr["!"]=qr["-"]=qr.difference=qr.relativeComplement=qr.subtract=qr.not;qr.n=qr["&"]=qr["."]=qr.and=qr.intersection=qr.intersect;qr["^"]=qr["(+)"]=qr["(-)"]=qr.symmetricDifference=qr.symdiff=qr.xor;qr.fnFilter=qr.filterFn=qr.stdFilter=qr.filter;qr.complement=qr.abscomp=qr.absoluteComplement;var L7={isNode:function(){return this.group()==="nodes"},isEdge:function(){return this.group()==="edges"},isLoop:function(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function(){var e=this[0];if(e)return e._private.group}},PA=function(e,r){var n=e.cy(),i=n.hasCompoundNodes();function a(c){var h=c.pstyle("z-compound-depth");return h.value==="auto"?i?c.zDepth():0:h.value==="bottom"?-1:h.value==="top"?e_:0}var s=a(e)-a(r);if(s!==0)return s;function o(c){var h=c.pstyle("z-index-compare");return h.value==="auto"&&c.isNode()?1:0}var l=o(e)-o(r);if(l!==0)return l;var u=e.pstyle("z-index").value-r.pstyle("z-index").value;return u!==0?u:e.poolIndex()-r.poolIndex()},cx={forEach:function(e,r){if(ri(e))for(var n=this.length,i=0;i<n;i++){var a=this[i],s=r?e.apply(r,[a,i,this]):e(a,i,this);if(s===!1)break}return this},toArray:function(){for(var e=[],r=0;r<this.length;r++)e.push(this[r]);return e},slice:function(e,r){var n=[],i=this.length;r==null&&(r=i),e==null&&(e=0),e<0&&(e=i+e),r<0&&(r=i+r);for(var a=e;a>=0&&a<r&&a<i;a++)n.push(this[a]);return this.spawn(n)},size:function(){return this.length},eq:function(e){return this[e]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return this.length===0},nonempty:function(){return!this.empty()},sort:function(e){if(!ri(e))return this;var r=this.toArray().sort(e);return this.spawn(r)},sortByZIndex:function(){return this.sort(PA)},zDepth:function(){var e=this[0];if(e){var r=e._private,n=r.group;if(n==="nodes"){var i=r.data.parent?e.parents().size():0;return e.isParent()?i:e_-1}else{var a=r.source,s=r.target,o=a.zDepth(),l=s.zDepth();return Math.max(o,l,0)}}}};cx.each=cx.forEach;var R7=function(){var e="undefined",r=(typeof Symbol>"u"?"undefined":qi(Symbol))!=e&&qi(Symbol.iterator)!=e;r&&(cx[Symbol.iterator]=function(){var n=this,i={value:void 0,done:!1},a=0,s=this.length;return TM({next:function(){return a<s?i.value=n[a++]:(i.value=void 0,i.done=!0),i}},Symbol.iterator,function(){return this})})};R7();var O7=Ha({nodeDimensionsIncludeLabels:!1}),Fy={layoutDimensions:function(e){e=O7(e);var r;if(!this.takesUpSpace())r={w:0,h:0};else if(e.nodeDimensionsIncludeLabels){var n=this.boundingBox();r={w:n.w,h:n.h}}else r={w:this.outerWidth(),h:this.outerHeight()};return(r.w===0||r.h===0)&&(r.w=r.h=1),r},layoutPositions:function(e,r,n){var i=this.nodes().filter(function(R){return!R.isParent()}),a=this.cy(),s=r.eles,o=function(I){return I.id()},l=Wp(n,o);e.emit({type:"layoutstart",layout:e}),e.animations=[];var u=function(I,j,O){var F={x:j.x1+j.w/2,y:j.y1+j.h/2},z={x:(O.x-F.x)*I,y:(O.y-F.y)*I};return{x:F.x+z.x,y:F.y+z.y}},c=r.spacingFactor&&r.spacingFactor!==1,h=function(){if(!c)return null;for(var I=Es(),j=0;j<i.length;j++){var O=i[j],F=l(O,j);$M(I,F.x,F.y)}return I},p=h(),g=Wp(function(R,I){var j=l(R,I);if(c){var O=Math.abs(r.spacingFactor);j=u(O,p,j)}return r.transform!=null&&(j=r.transform(R,j)),j},o);if(r.animate){for(var y=0;y<i.length;y++){var S=i[y],w=g(S,y),C=r.animateFilter==null||r.animateFilter(S,y);if(C){var _=S.animation({position:w,duration:r.animationDuration,easing:r.animationEasing});e.animations.push(_)}else S.position(w)}if(r.fit){var T=a.animation({fit:{boundingBox:s.boundingBoxAt(g),padding:r.padding},duration:r.animationDuration,easing:r.animationEasing});e.animations.push(T)}else if(r.zoom!==void 0&&r.pan!==void 0){var N=a.animation({zoom:r.zoom,pan:r.pan,duration:r.animationDuration,easing:r.animationEasing});e.animations.push(N)}e.animations.forEach(function(R){return R.play()}),e.one("layoutready",r.ready),e.emit({type:"layoutready",layout:e}),cm.all(e.animations.map(function(R){return R.promise()})).then(function(){e.one("layoutstop",r.stop),e.emit({type:"layoutstop",layout:e})})}else i.positions(g),r.fit&&a.fit(r.eles,r.padding),r.zoom!=null&&a.zoom(r.zoom),r.pan&&a.pan(r.pan),e.one("layoutready",r.ready),e.emit({type:"layoutready",layout:e}),e.one("layoutstop",r.stop),e.emit({type:"layoutstop",layout:e});return this},layout:function(e){var r=this.cy();return r.makeLayout(ar({},e,{eles:this}))}};Fy.createLayout=Fy.makeLayout=Fy.layout;function MA(t,e,r){var n=r._private,i=n.styleCache=n.styleCache||[],a;return(a=i[t])!=null||(a=i[t]=e(r)),a}function A1(t,e){return t=pf(t),function(n){return MA(t,e,n)}}function L1(t,e){t=pf(t);var r=function(i){return e.call(i)};return function(){var i=this[0];if(i)return MA(t,r,i)}}var Ba={recalculateRenderedStyle:function(e){var r=this.cy(),n=r.renderer(),i=r.styleEnabled();return n&&i&&n.recalculateRenderedStyle(this,e),this},dirtyStyleCache:function(){var e=this.cy(),r=function(a){return a._private.styleCache=null};if(e.hasCompoundNodes()){var n;n=this.spawnSelf().merge(this.descendants()).merge(this.parents()),n.merge(n.connectedEdges()),n.forEach(r)}else this.forEach(function(i){r(i),i.connectedEdges().forEach(r)});return this},updateStyle:function(e){var r=this._private.cy;if(!r.styleEnabled())return this;if(r.batching()){var n=r._private.batchStyleEles;return n.merge(this),this}var i=r.hasCompoundNodes(),a=this;e=!!(e||e===void 0),i&&(a=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var s=a;return e?s.emitAndNotify("style"):s.emit("style"),a.forEach(function(o){return o._private.styleDirty=!0}),this},cleanStyle:function(){var e=this.cy();if(e.styleEnabled())for(var r=0;r<this.length;r++){var n=this[r];n._private.styleDirty&&(n._private.styleDirty=!1,e.style().apply(n))}},parsedStyle:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=this[0],i=n.cy();if(i.styleEnabled()&&n){n._private.styleDirty&&(n._private.styleDirty=!1,i.style().apply(n));var a=n._private.style[e];return a??(r?i.style().getDefaultProperty(e):null)}},numericStyle:function(e){var r=this[0];if(r.cy().styleEnabled()&&r){var n=r.pstyle(e);return n.pfValue!==void 0?n.pfValue:n.value}},numericStyleUnits:function(e){var r=this[0];if(r.cy().styleEnabled()&&r)return r.pstyle(e).units},renderedStyle:function(e){var r=this.cy();if(!r.styleEnabled())return this;var n=this[0];if(n)return r.style().getRenderedStyle(n,e)},style:function(e,r){var n=this.cy();if(!n.styleEnabled())return this;var i=!1,a=n.style();if(Vr(e)){var s=e;a.applyBypass(this,s,i),this.emitAndNotify("style")}else if(Zt(e))if(r===void 0){var o=this[0];return o?a.getStylePropertyValue(o,e):void 0}else a.applyBypass(this,e,r,i),this.emitAndNotify("style");else if(e===void 0){var l=this[0];return l?a.getRawStyle(l):void 0}return this},removeStyle:function(e){var r=this.cy();if(!r.styleEnabled())return this;var n=!1,i=r.style(),a=this;if(e===void 0)for(var s=0;s<a.length;s++){var o=a[s];i.removeAllBypasses(o,n)}else{e=e.split(/\s+/);for(var l=0;l<a.length;l++){var u=a[l];i.removeBypasses(u,e,n)}}return this.emitAndNotify("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},effectiveOpacity:function(){var e=this.cy();if(!e.styleEnabled())return 1;var r=e.hasCompoundNodes(),n=this[0];if(n){var i=n._private,a=n.pstyle("opacity").value;if(!r)return a;var s=i.data.parent?n.parents():null;if(s)for(var o=0;o<s.length;o++){var l=s[o],u=l.pstyle("opacity").value;a=u*a}return a}},transparent:function(){var e=this.cy();if(!e.styleEnabled())return!1;var r=this[0],n=r.cy().hasCompoundNodes();if(r)return n?r.effectiveOpacity()===0:r.pstyle("opacity").value===0},backgrounding:function(){var e=this.cy();if(!e.styleEnabled())return!1;var r=this[0];return!!r._private.backgrounding}};function u2(t,e){var r=t._private,n=r.data.parent?t.parents():null;if(n)for(var i=0;i<n.length;i++){var a=n[i];if(!e(a))return!1}return!0}function h_(t){var e=t.ok,r=t.edgeOkViaNode||t.ok,n=t.parentOk||t.ok;return function(){var i=this.cy();if(!i.styleEnabled())return!0;var a=this[0],s=i.hasCompoundNodes();if(a){var o=a._private;if(!e(a))return!1;if(a.isNode())return!s||u2(a,n);var l=o.source,u=o.target;return r(l)&&(!s||u2(l,r))&&(l===u||r(u)&&(!s||u2(u,r)))}}}var dm=A1("eleTakesUpSpace",function(t){return t.pstyle("display").value==="element"&&t.width()!==0&&(t.isNode()?t.height()!==0:!0)});Ba.takesUpSpace=L1("takesUpSpace",h_({ok:dm}));var D7=A1("eleInteractive",function(t){return t.pstyle("events").value==="yes"&&t.pstyle("visibility").value==="visible"&&dm(t)}),I7=A1("parentInteractive",function(t){return t.pstyle("visibility").value==="visible"&&dm(t)});Ba.interactive=L1("interactive",h_({ok:D7,parentOk:I7,edgeOkViaNode:dm}));Ba.noninteractive=function(){var t=this[0];if(t)return!t.interactive()};var j7=A1("eleVisible",function(t){return t.pstyle("visibility").value==="visible"&&t.pstyle("opacity").pfValue!==0&&dm(t)}),F7=dm;Ba.visible=L1("visible",h_({ok:j7,edgeOkViaNode:F7}));Ba.hidden=function(){var t=this[0];if(t)return!t.visible()};Ba.isBundledBezier=L1("isBundledBezier",function(){return this.cy().styleEnabled()?!this.removed()&&this.pstyle("curve-style").value==="bezier"&&this.takesUpSpace():!1});Ba.bypass=Ba.css=Ba.style;Ba.renderedCss=Ba.renderedStyle;Ba.removeBypass=Ba.removeCss=Ba.removeStyle;Ba.pstyle=Ba.parsedStyle;var Gd={};function yN(t){return function(){var e=arguments,r=[];if(e.length===2){var n=e[0],i=e[1];this.on(t.event,n,i)}else if(e.length===1&&ri(e[0])){var a=e[0];this.on(t.event,a)}else if(e.length===0||e.length===1&&Sn(e[0])){for(var s=e.length===1?e[0]:null,o=0;o<this.length;o++){var l=this[o],u=!t.ableField||l._private[t.ableField],c=l._private[t.field]!=t.value;if(t.overrideAble){var h=t.overrideAble(l);if(h!==void 0&&(u=h,!h))return this}u&&(l._private[t.field]=t.value,c&&r.push(l))}var p=this.spawn(r);p.updateStyle(),p.emit(t.event),s&&p.emit(s)}return this}}function hm(t){Gd[t.field]=function(){var e=this[0];if(e){if(t.overrideField){var r=t.overrideField(e);if(r!==void 0)return r}return e._private[t.field]}},Gd[t.on]=yN({event:t.on,field:t.field,ableField:t.ableField,overrideAble:t.overrideAble,value:!0}),Gd[t.off]=yN({event:t.off,field:t.field,ableField:t.ableField,overrideAble:t.overrideAble,value:!1})}hm({field:"locked",overrideField:function(e){return e.cy().autolock()?!0:void 0},on:"lock",off:"unlock"});hm({field:"grabbable",overrideField:function(e){return e.cy().autoungrabify()||e.pannable()?!1:void 0},on:"grabify",off:"ungrabify"});hm({field:"selected",ableField:"selectable",overrideAble:function(e){return e.cy().autounselectify()?!1:void 0},on:"select",off:"unselect"});hm({field:"selectable",overrideField:function(e){return e.cy().autounselectify()?!1:void 0},on:"selectify",off:"unselectify"});Gd.deselect=Gd.unselect;Gd.grabbed=function(){var t=this[0];if(t)return t._private.grabbed};hm({field:"active",on:"activate",off:"unactivate"});hm({field:"pannable",on:"panify",off:"unpanify"});Gd.inactive=function(){var t=this[0];if(t)return!t._private.active};var ss={},xN=function(e){return function(n){for(var i=this,a=[],s=0;s<i.length;s++){var o=i[s];if(o.isNode()){for(var l=!1,u=o.connectedEdges(),c=0;c<u.length;c++){var h=u[c],p=h.source(),g=h.target();if(e.noIncomingEdges&&g===o&&p!==o||e.noOutgoingEdges&&p===o&&g!==o){l=!0;break}}l||a.push(o)}}return this.spawn(a,!0).filter(n)}},bN=function(e){return function(r){for(var n=this,i=[],a=0;a<n.length;a++){var s=n[a];if(s.isNode())for(var o=s.connectedEdges(),l=0;l<o.length;l++){var u=o[l],c=u.source(),h=u.target();e.outgoing&&c===s?(i.push(u),i.push(h)):e.incoming&&h===s&&(i.push(u),i.push(c))}}return this.spawn(i,!0).filter(r)}},wN=function(e){return function(r){for(var n=this,i=[],a={};;){var s=e.outgoing?n.outgoers():n.incomers();if(s.length===0)break;for(var o=!1,l=0;l<s.length;l++){var u=s[l],c=u.id();a[c]||(a[c]=!0,i.push(u),o=!0)}if(!o)break;n=s}return this.spawn(i,!0).filter(r)}};ss.clearTraversalCache=function(){for(var t=0;t<this.length;t++)this[t]._private.traversalCache=null};ar(ss,{roots:xN({noIncomingEdges:!0}),leaves:xN({noOutgoingEdges:!0}),outgoers:Xo(bN({outgoing:!0}),"outgoers"),successors:wN({outgoing:!0}),incomers:Xo(bN({incoming:!0}),"incomers"),predecessors:wN({})});ar(ss,{neighborhood:Xo(function(t){for(var e=[],r=this.nodes(),n=0;n<r.length;n++)for(var i=r[n],a=i.connectedEdges(),s=0;s<a.length;s++){var o=a[s],l=o.source(),u=o.target(),c=i===l?u:l;c.length>0&&e.push(c[0]),e.push(o[0])}return this.spawn(e,!0).filter(t)},"neighborhood"),closedNeighborhood:function(e){return this.neighborhood().add(this).filter(e)},openNeighborhood:function(e){return this.neighborhood(e)}});ss.neighbourhood=ss.neighborhood;ss.closedNeighbourhood=ss.closedNeighborhood;ss.openNeighbourhood=ss.openNeighborhood;ar(ss,{source:Xo(function(e){var r=this[0],n;return r&&(n=r._private.source||r.cy().collection()),n&&e?n.filter(e):n},"source"),target:Xo(function(e){var r=this[0],n;return r&&(n=r._private.target||r.cy().collection()),n&&e?n.filter(e):n},"target"),sources:SN({attr:"source"}),targets:SN({attr:"target"})});function SN(t){return function(r){for(var n=[],i=0;i<this.length;i++){var a=this[i],s=a._private[t.attr];s&&n.push(s)}return this.spawn(n,!0).filter(r)}}ar(ss,{edgesWith:Xo(kN(),"edgesWith"),edgesTo:Xo(kN({thisIsSrc:!0}),"edgesTo")});function kN(t){return function(r){var n=[],i=this._private.cy,a=t||{};Zt(r)&&(r=i.$(r));for(var s=0;s<r.length;s++)for(var o=r[s]._private.edges,l=0;l<o.length;l++){var u=o[l],c=u._private.data,h=this.hasElementWithId(c.source)&&r.hasElementWithId(c.target),p=r.hasElementWithId(c.source)&&this.hasElementWithId(c.target),g=h||p;g&&((a.thisIsSrc||a.thisIsTgt)&&(a.thisIsSrc&&!h||a.thisIsTgt&&!p)||n.push(u))}return this.spawn(n,!0)}}ar(ss,{connectedEdges:Xo(function(t){for(var e=[],r=this,n=0;n<r.length;n++){var i=r[n];if(i.isNode())for(var a=i._private.edges,s=0;s<a.length;s++){var o=a[s];e.push(o)}}return this.spawn(e,!0).filter(t)},"connectedEdges"),connectedNodes:Xo(function(t){for(var e=[],r=this,n=0;n<r.length;n++){var i=r[n];i.isEdge()&&(e.push(i.source()[0]),e.push(i.target()[0]))}return this.spawn(e,!0).filter(t)},"connectedNodes"),parallelEdges:Xo(_N(),"parallelEdges"),codirectedEdges:Xo(_N({codirected:!0}),"codirectedEdges")});function _N(t){var e={codirected:!1};return t=ar({},e,t),function(n){for(var i=[],a=this.edges(),s=t,o=0;o<a.length;o++)for(var l=a[o],u=l._private,c=u.source,h=c._private.data.id,p=u.data.target,g=c._private.edges,y=0;y<g.length;y++){var S=g[y],w=S._private.data,C=w.target,_=w.source,T=C===p&&_===h,N=h===C&&p===_;(s.codirected&&T||!s.codirected&&(T||N))&&i.push(S)}return this.spawn(i,!0).filter(n)}}ar(ss,{components:function(e){var r=this,n=r.cy(),i=n.collection(),a=e==null?r.nodes():e.nodes(),s=[];e!=null&&a.empty()&&(a=e.sources());var o=function(c,h){i.merge(c),a.unmerge(c),h.merge(c)};if(a.empty())return r.spawn();var l=function(){var c=n.collection();s.push(c);var h=a[0];o(h,c),r.bfs({directed:!1,roots:h,visit:function(g){return o(g,c)}}),c.forEach(function(p){p.connectedEdges().forEach(function(g){r.has(g)&&c.has(g.source())&&c.has(g.target())&&c.merge(g)})})};do l();while(a.length>0);return s},component:function(){var e=this[0];return e.cy().mutableElements().components(e)[0]}});ss.componentsOf=ss.components;var za=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e===void 0){Kn("A collection must have a reference to the core");return}var a=new dc,s=!1;if(!r)r=[];else if(r.length>0&&Vr(r[0])&&!Kv(r[0])){s=!0;for(var o=[],l=new um,u=0,c=r.length;u<c;u++){var h=r[u];h.data==null&&(h.data={});var p=h.data;if(p.id==null)p.id=HM();else if(e.hasElementWithId(p.id)||l.has(p.id))continue;var g=new S1(e,h,!1);o.push(g),l.add(p.id)}r=o}this.length=0;for(var y=0,S=r.length;y<S;y++){var w=r[y][0];if(w!=null){var C=w._private.data.id;(!n||!a.has(C))&&(n&&a.set(C,{index:this.length,ele:w}),this[this.length]=w,this.length++)}}this._private={eles:this,cy:e,get map(){return this.lazyMap==null&&this.rebuildMap(),this.lazyMap},set map(_){this.lazyMap=_},rebuildMap:function(){for(var T=this.lazyMap=new dc,N=this.eles,R=0;R<N.length;R++){var I=N[R];T.set(I.id(),{index:R,ele:I})}}},n&&(this._private.map=a),s&&!i&&this.restore()},Pn=S1.prototype=za.prototype=Object.create(Array.prototype);Pn.instanceString=function(){return"collection"};Pn.spawn=function(t,e){return new za(this.cy(),t,e)};Pn.spawnSelf=function(){return this.spawn(this)};Pn.cy=function(){return this._private.cy};Pn.renderer=function(){return this._private.cy.renderer()};Pn.element=function(){return this[0]};Pn.collection=function(){return MM(this)?this:new za(this._private.cy,[this])};Pn.unique=function(){return new za(this._private.cy,this,!0)};Pn.hasElementWithId=function(t){return t=""+t,this._private.map.has(t)};Pn.getElementById=function(t){t=""+t;var e=this._private.cy,r=this._private.map.get(t);return r?r.ele:new za(e)};Pn.$id=Pn.getElementById;Pn.poolIndex=function(){var t=this._private.cy,e=t._private.elements,r=this[0]._private.data.id;return e._private.map.get(r).index};Pn.indexOf=function(t){var e=t[0]._private.data.id;return this._private.map.get(e).index};Pn.indexOfId=function(t){return t=""+t,this._private.map.get(t).index};Pn.json=function(t){var e=this.element(),r=this.cy();if(e==null&&t)return this;if(e!=null){var n=e._private;if(Vr(t)){if(r.startBatch(),t.data){e.data(t.data);var i=n.data;if(e.isEdge()){var a=!1,s={},o=t.data.source,l=t.data.target;o!=null&&o!=i.source&&(s.source=""+o,a=!0),l!=null&&l!=i.target&&(s.target=""+l,a=!0),a&&(e=e.move(s))}else{var u="parent"in t.data,c=t.data.parent;u&&(c!=null||i.parent!=null)&&c!=i.parent&&(c===void 0&&(c=null),c!=null&&(c=""+c),e=e.move({parent:c}))}}t.position&&e.position(t.position);var h=function(S,w,C){var _=t[S];_!=null&&_!==n[S]&&(_?e[w]():e[C]())};return h("removed","remove","restore"),h("selected","select","unselect"),h("selectable","selectify","unselectify"),h("locked","lock","unlock"),h("grabbable","grabify","ungrabify"),h("pannable","panify","unpanify"),t.classes!=null&&e.classes(t.classes),r.endBatch(),this}else if(t===void 0){var p={data:ku(n.data),position:ku(n.position),group:n.group,removed:n.removed,selected:n.selected,selectable:n.selectable,locked:n.locked,grabbable:n.grabbable,pannable:n.pannable,classes:null};p.classes="";var g=0;return n.classes.forEach(function(y){return p.classes+=g++===0?y:" "+y}),p}}};Pn.jsons=function(){for(var t=[],e=0;e<this.length;e++){var r=this[e],n=r.json();t.push(n)}return t};Pn.clone=function(){for(var t=this.cy(),e=[],r=0;r<this.length;r++){var n=this[r],i=n.json(),a=new S1(t,i,!1);e.push(a)}return new za(t,e)};Pn.copy=Pn.clone;Pn.restore=function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=r.cy(),i=n._private,a=[],s=[],o,l=0,u=r.length;l<u;l++){var c=r[l];e&&!c.removed()||(c.isNode()?a.push(c):s.push(c))}o=a.concat(s);var h,p=function(){o.splice(h,1),h--};for(h=0;h<o.length;h++){var g=o[h],y=g._private,S=y.data;if(g.clearTraversalCache(),!(!e&&!y.removed)){if(S.id===void 0)S.id=HM();else if(kt(S.id))S.id=""+S.id;else if(Zd(S.id)||!Zt(S.id)){Kn("Can not create element with invalid string ID `"+S.id+"`"),p();continue}else if(n.hasElementWithId(S.id)){Kn("Can not create second element with ID `"+S.id+"`"),p();continue}}var w=S.id;if(g.isNode()){var C=y.position;C.x==null&&(C.x=0),C.y==null&&(C.y=0)}if(g.isEdge()){for(var _=g,T=["source","target"],N=T.length,R=!1,I=0;I<N;I++){var j=T[I],O=S[j];kt(O)&&(O=S[j]=""+S[j]),O==null||O===""?(Kn("Can not create edge `"+w+"` with unspecified "+j),R=!0):n.hasElementWithId(O)||(Kn("Can not create edge `"+w+"` with nonexistant "+j+" `"+O+"`"),R=!0)}if(R){p();continue}var F=n.getElementById(S.source),z=n.getElementById(S.target);F.same(z)?F._private.edges.push(_):(F._private.edges.push(_),z._private.edges.push(_)),_._private.source=F,_._private.target=z}y.map=new dc,y.map.set(w,{ele:g,index:0}),y.removed=!1,e&&n.addToPool(g)}for(var V=0;V<a.length;V++){var q=a[V],D=q._private.data;kt(D.parent)&&(D.parent=""+D.parent);var U=D.parent,G=U!=null;if(G||q._private.parent){var Z=q._private.parent?n.collection().merge(q._private.parent):n.getElementById(U);if(Z.empty())D.parent=void 0;else if(Z[0].removed())an("Node added with missing parent, reference to parent removed"),D.parent=void 0,q._private.parent=null;else{for(var K=!1,Q=Z;!Q.empty();){if(q.same(Q)){K=!0,D.parent=void 0;break}Q=Q.parent()}K||(Z[0]._private.children.push(q),q._private.parent=Z[0],i.hasCompoundNodes=!0)}}}if(o.length>0){for(var ne=o.length===r.length?r:new za(n,o),te=0;te<ne.length;te++){var X=ne[te];X.isNode()||(X.parallelEdges().clearTraversalCache(),X.source().clearTraversalCache(),X.target().clearTraversalCache())}var re;i.hasCompoundNodes?re=n.collection().merge(ne).merge(ne.connectedNodes()).merge(ne.parent()):re=ne,re.dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(t),t?ne.emitAndNotify("add"):e&&ne.emit("add")}return r};Pn.removed=function(){var t=this[0];return t&&t._private.removed};Pn.inside=function(){var t=this[0];return t&&!t._private.removed};Pn.remove=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=[],i={},a=r._private.cy;function s(U){for(var G=U._private.edges,Z=0;Z<G.length;Z++)l(G[Z])}function o(U){for(var G=U._private.children,Z=0;Z<G.length;Z++)l(G[Z])}function l(U){var G=i[U.id()];e&&U.removed()||G||(i[U.id()]=!0,U.isNode()?(n.push(U),s(U),o(U)):n.unshift(U))}for(var u=0,c=r.length;u<c;u++){var h=r[u];l(h)}function p(U,G){var Z=U._private.edges;Yd(Z,G),U.clearTraversalCache()}function g(U){U.clearTraversalCache()}var y=[];y.ids={};function S(U,G){G=G[0],U=U[0];var Z=U._private.children,K=U.id();Yd(Z,G),G._private.parent=null,y.ids[K]||(y.ids[K]=!0,y.push(U))}r.dirtyCompoundBoundsCache(),e&&a.removeFromPool(n);for(var w=0;w<n.length;w++){var C=n[w];if(C.isEdge()){var _=C.source()[0],T=C.target()[0];p(_,C),p(T,C);for(var N=C.parallelEdges(),R=0;R<N.length;R++){var I=N[R];g(I),I.isBundledBezier()&&I.dirtyBoundingBoxCache()}}else{var j=C.parent();j.length!==0&&S(j,C)}e&&(C._private.removed=!0)}var O=a._private.elements;a._private.hasCompoundNodes=!1;for(var F=0;F<O.length;F++){var z=O[F];if(z.isParent()){a._private.hasCompoundNodes=!0;break}}var V=new za(this.cy(),n);V.size()>0&&(t?V.emitAndNotify("remove"):e&&V.emit("remove"));for(var q=0;q<y.length;q++){var D=y[q];(!e||!D.removed())&&D.updateStyle()}return V};Pn.move=function(t){var e=this._private.cy,r=this,n=!1,i=!1,a=function(y){return y==null?y:""+y};if(t.source!==void 0||t.target!==void 0){var s=a(t.source),o=a(t.target),l=s!=null&&e.hasElementWithId(s),u=o!=null&&e.hasElementWithId(o);(l||u)&&(e.batch(function(){r.remove(n,i),r.emitAndNotify("moveout");for(var g=0;g<r.length;g++){var y=r[g],S=y._private.data;y.isEdge()&&(l&&(S.source=s),u&&(S.target=o))}r.restore(n,i)}),r.emitAndNotify("move"))}else if(t.parent!==void 0){var c=a(t.parent),h=c===null||e.hasElementWithId(c);if(h){var p=c===null?void 0:c;e.batch(function(){var g=r.remove(n,i);g.emitAndNotify("moveout");for(var y=0;y<r.length;y++){var S=r[y],w=S._private.data;S.isNode()&&(w.parent=p)}g.restore(n,i)}),r.emitAndNotify("move")}}return this};[rA,ZB,jy,Ud,$p,d7,P1,T7,TA,NA,L7,cx,Fy,Ba,Gd,ss].forEach(function(t){ar(Pn,t)});var B7={add:function(e){var r,n=this;if(vo(e)){var i=e;if(i._private.cy===n)r=i.restore();else{for(var a=[],s=0;s<i.length;s++){var o=i[s];a.push(o.json())}r=new za(n,a)}}else if(Sn(e)){var l=e;r=new za(n,l)}else if(Vr(e)&&(Sn(e.nodes)||Sn(e.edges))){for(var u=e,c=[],h=["nodes","edges"],p=0,g=h.length;p<g;p++){var y=h[p],S=u[y];if(Sn(S))for(var w=0,C=S.length;w<C;w++){var _=ar({group:y},S[w]);c.push(_)}}r=new za(n,c)}else{var T=e;r=new S1(n,T).collection()}return r},remove:function(e){if(!vo(e)){if(Zt(e)){var r=e;e=this.$(r)}}return e.remove()}};function z7(t,e,r,n){var i=4,a=.001,s=1e-7,o=10,l=11,u=1/(l-1),c=typeof Float32Array<"u";if(arguments.length!==4)return!1;for(var h=0;h<4;++h)if(typeof arguments[h]!="number"||isNaN(arguments[h])||!isFinite(arguments[h]))return!1;t=Math.min(t,1),r=Math.min(r,1),t=Math.max(t,0),r=Math.max(r,0);var p=c?new Float32Array(l):new Array(l);function g(z,V){return 1-3*V+3*z}function y(z,V){return 3*V-6*z}function S(z){return 3*z}function w(z,V,q){return((g(V,q)*z+y(V,q))*z+S(V))*z}function C(z,V,q){return 3*g(V,q)*z*z+2*y(V,q)*z+S(V)}function _(z,V){for(var q=0;q<i;++q){var D=C(V,t,r);if(D===0)return V;var U=w(V,t,r)-z;V-=U/D}return V}function T(){for(var z=0;z<l;++z)p[z]=w(z*u,t,r)}function N(z,V,q){var D,U,G=0;do U=V+(q-V)/2,D=w(U,t,r)-z,D>0?q=U:V=U;while(Math.abs(D)>s&&++G<o);return U}function R(z){for(var V=0,q=1,D=l-1;q!==D&&p[q]<=z;++q)V+=u;--q;var U=(z-p[q])/(p[q+1]-p[q]),G=V+U*u,Z=C(G,t,r);return Z>=a?_(z,G):Z===0?G:N(z,V,V+u)}var I=!1;function j(){I=!0,(t!==e||r!==n)&&T()}var O=function(V){return I||j(),t===e&&r===n?V:V===0?0:V===1?1:w(R(V),e,n)};O.getControlPoints=function(){return[{x:t,y:e},{x:r,y:n}]};var F="generateBezier("+[t,e,r,n]+")";return O.toString=function(){return F},O}var U7=(function(){function t(n){return-n.tension*n.x-n.friction*n.v}function e(n,i,a){var s={x:n.x+a.dx*i,v:n.v+a.dv*i,tension:n.tension,friction:n.friction};return{dx:s.v,dv:t(s)}}function r(n,i){var a={dx:n.v,dv:t(n)},s=e(n,i*.5,a),o=e(n,i*.5,s),l=e(n,i,o),u=1/6*(a.dx+2*(s.dx+o.dx)+l.dx),c=1/6*(a.dv+2*(s.dv+o.dv)+l.dv);return n.x=n.x+u*i,n.v=n.v+c*i,n}return function n(i,a,s){var o={x:-1,v:0,tension:null,friction:null},l=[0],u=0,c=1/1e4,h=16/1e3,p,g,y;for(i=parseFloat(i)||500,a=parseFloat(a)||20,s=s||null,o.tension=i,o.friction=a,p=s!==null,p?(u=n(i,a),g=u/s*h):g=h;y=r(y||o,g),l.push(1+y.x),u+=16,Math.abs(y.x)>c&&Math.abs(y.v)>c;);return p?function(S){return l[S*(l.length-1)|0]}:u}})(),Nn=function(e,r,n,i){var a=z7(e,r,n,i);return function(s,o,l){return s+(o-s)*a(l)}},By={linear:function(e,r,n){return e+(r-e)*n},ease:Nn(.25,.1,.25,1),"ease-in":Nn(.42,0,1,1),"ease-out":Nn(0,0,.58,1),"ease-in-out":Nn(.42,0,.58,1),"ease-in-sine":Nn(.47,0,.745,.715),"ease-out-sine":Nn(.39,.575,.565,1),"ease-in-out-sine":Nn(.445,.05,.55,.95),"ease-in-quad":Nn(.55,.085,.68,.53),"ease-out-quad":Nn(.25,.46,.45,.94),"ease-in-out-quad":Nn(.455,.03,.515,.955),"ease-in-cubic":Nn(.55,.055,.675,.19),"ease-out-cubic":Nn(.215,.61,.355,1),"ease-in-out-cubic":Nn(.645,.045,.355,1),"ease-in-quart":Nn(.895,.03,.685,.22),"ease-out-quart":Nn(.165,.84,.44,1),"ease-in-out-quart":Nn(.77,0,.175,1),"ease-in-quint":Nn(.755,.05,.855,.06),"ease-out-quint":Nn(.23,1,.32,1),"ease-in-out-quint":Nn(.86,0,.07,1),"ease-in-expo":Nn(.95,.05,.795,.035),"ease-out-expo":Nn(.19,1,.22,1),"ease-in-out-expo":Nn(1,0,0,1),"ease-in-circ":Nn(.6,.04,.98,.335),"ease-out-circ":Nn(.075,.82,.165,1),"ease-in-out-circ":Nn(.785,.135,.15,.86),spring:function(e,r,n){if(n===0)return By.linear;var i=U7(e,r,n);return function(a,s,o){return a+(s-a)*i(o)}},"cubic-bezier":Nn};function CN(t,e,r,n,i){if(n===1||e===r)return r;var a=i(e,r,n);return t==null||((t.roundValue||t.color)&&(a=Math.round(a)),t.min!==void 0&&(a=Math.max(a,t.min)),t.max!==void 0&&(a=Math.min(a,t.max))),a}function EN(t,e){return t.pfValue!=null||t.value!=null?t.pfValue!=null&&(e==null||e.type.units!=="%")?t.pfValue:t.value:t}function pp(t,e,r,n,i){var a=i!=null?i.type:null;r<0?r=0:r>1&&(r=1);var s=EN(t,i),o=EN(e,i);if(kt(s)&&kt(o))return CN(a,s,o,r,n);if(Sn(s)&&Sn(o)){for(var l=[],u=0;u<o.length;u++){var c=s[u],h=o[u];if(c!=null&&h!=null){var p=CN(a,c,h,r,n);l.push(p)}else l.push(h)}return l}}function G7(t,e,r,n){var i=!n,a=t._private,s=e._private,o=s.easing,l=s.startTime,u=n?t:t.cy(),c=u.style();if(!s.easingImpl)if(o==null)s.easingImpl=By.linear;else{var h;if(Zt(o)){var p=c.parse("transition-timing-function",o);h=p.value}else h=o;var g,y;Zt(h)?(g=h,y=[]):(g=h[1],y=h.slice(2).map(function(ne){return+ne})),y.length>0?(g==="spring"&&y.push(s.duration),s.easingImpl=By[g].apply(null,y)):s.easingImpl=By[g]}var S=s.easingImpl,w;if(s.duration===0?w=1:w=(r-l)/s.duration,s.applying&&(w=s.progress),w<0?w=0:w>1&&(w=1),s.delay==null){var C=s.startPosition,_=s.position;if(_&&i&&!t.locked()){var T={};Hm(C.x,_.x)&&(T.x=pp(C.x,_.x,w,S)),Hm(C.y,_.y)&&(T.y=pp(C.y,_.y,w,S)),t.position(T)}var N=s.startPan,R=s.pan,I=a.pan,j=R!=null&&n;j&&(Hm(N.x,R.x)&&(I.x=pp(N.x,R.x,w,S)),Hm(N.y,R.y)&&(I.y=pp(N.y,R.y,w,S)),t.emit("pan"));var O=s.startZoom,F=s.zoom,z=F!=null&&n;z&&(Hm(O,F)&&(a.zoom=wv(a.minZoom,pp(O,F,w,S),a.maxZoom)),t.emit("zoom")),(j||z)&&t.emit("viewport");var V=s.style;if(V&&V.length>0&&i){for(var q=0;q<V.length;q++){var D=V[q],U=D.name,G=D,Z=s.startStyle[U],K=c.properties[Z.name],Q=pp(Z,G,w,S,K);c.overrideBypass(t,U,Q)}t.emit("style")}}return s.progress=w,w}function Hm(t,e){return t==null||e==null?!1:kt(t)&&kt(e)?!0:!!(t&&e)}function V7(t,e,r,n){var i=e._private;i.started=!0,i.startTime=r-i.progress*i.duration}function TN(t,e){var r=e._private.aniEles,n=[];function i(c,h){var p=c._private,g=p.animation.current,y=p.animation.queue,S=!1;if(g.length===0){var w=y.shift();w&&g.push(w)}for(var C=function(I){for(var j=I.length-1;j>=0;j--){var O=I[j];O()}I.splice(0,I.length)},_=g.length-1;_>=0;_--){var T=g[_],N=T._private;if(N.stopped){g.splice(_,1),N.hooked=!1,N.playing=!1,N.started=!1,C(N.frames);continue}!N.playing&&!N.applying||(N.playing&&N.applying&&(N.applying=!1),N.started||V7(c,T,t),G7(c,T,t,h),N.applying&&(N.applying=!1),C(N.frames),N.step!=null&&N.step(t),T.completed()&&(g.splice(_,1),N.hooked=!1,N.playing=!1,N.started=!1,C(N.completes)),S=!0)}return!h&&g.length===0&&y.length===0&&n.push(c),S}for(var a=!1,s=0;s<r.length;s++){var o=r[s],l=i(o);a=a||l}var u=i(e,!0);(a||u)&&(r.length>0?e.notify("draw",r):e.notify("draw")),r.unmerge(n),e.emit("step")}var H7={animate:nn.animate(),animation:nn.animation(),animated:nn.animated(),clearQueue:nn.clearQueue(),delay:nn.delay(),delayAnimation:nn.delayAnimation(),stop:nn.stop(),addToAnimationPool:function(e){var r=this;r.styleEnabled()&&r._private.aniEles.merge(e)},stopAnimationLoop:function(){this._private.animationsRunning=!1},startAnimationLoop:function(){var e=this;if(e._private.animationsRunning=!0,!e.styleEnabled())return;function r(){e._private.animationsRunning&&ax(function(a){TN(a,e),r()})}var n=e.renderer();n&&n.beforeRender?n.beforeRender(function(a,s){TN(s,e)},n.beforeRenderPriorities.animations):r()}},W7={qualifierCompare:function(e,r){return e==null||r==null?e==null&&r==null:e.sameText(r)},eventMatches:function(e,r,n){var i=r.qualifier;return i!=null?e!==n.target&&Kv(n.target)&&i.matches(n.target):!0},addEventFields:function(e,r){r.cy=e,r.target=e},callbackContext:function(e,r,n){return r.qualifier!=null?n.target:e}},iy=function(e){return Zt(e)?new Qd(e):e},AA={createEmitter:function(){var e=this._private;return e.emitter||(e.emitter=new M1(W7,this)),this},emitter:function(){return this._private.emitter},on:function(e,r,n){return this.emitter().on(e,iy(r),n),this},removeListener:function(e,r,n){return this.emitter().removeListener(e,iy(r),n),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},one:function(e,r,n){return this.emitter().one(e,iy(r),n),this},once:function(e,r,n){return this.emitter().one(e,iy(r),n),this},emit:function(e,r){return this.emitter().emit(e,r),this},emitAndNotify:function(e,r){return this.emit(e),this.notify(e,r),this}};nn.eventAliasesOn(AA);var GS={png:function(e){var r=this._private.renderer;return e=e||{},r.png(e)},jpg:function(e){var r=this._private.renderer;return e=e||{},e.bg=e.bg||"#fff",r.jpg(e)}};GS.jpeg=GS.jpg;var zy={layout:function(e){var r=this;if(e==null){Kn("Layout options must be specified to make a layout");return}if(e.name==null){Kn("A `name` must be specified to make a layout");return}var n=e.name,i=r.extension("layout",n);if(i==null){Kn("No such layout `"+n+"` found.  Did you forget to import it and `cytoscape.use()` it?");return}var a;Zt(e.eles)?a=r.$(e.eles):a=e.eles!=null?e.eles:r.$();var s=new i(ar({},e,{cy:r,eles:a}));return s}};zy.createLayout=zy.makeLayout=zy.layout;var q7={notify:function(e,r){var n=this._private;if(this.batching()){n.batchNotifications=n.batchNotifications||{};var i=n.batchNotifications[e]=n.batchNotifications[e]||this.collection();r!=null&&i.merge(r);return}if(n.notificationsEnabled){var a=this.renderer();this.destroyed()||!a||a.notify(e,r)}},notifications:function(e){var r=this._private;return e===void 0?r.notificationsEnabled:(r.notificationsEnabled=!!e,this)},noNotifications:function(e){this.notifications(!1),e(),this.notifications(!0)},batching:function(){return this._private.batchCount>0},startBatch:function(){var e=this._private;return e.batchCount==null&&(e.batchCount=0),e.batchCount===0&&(e.batchStyleEles=this.collection(),e.batchNotifications={}),e.batchCount++,this},endBatch:function(){var e=this._private;if(e.batchCount===0)return this;if(e.batchCount--,e.batchCount===0){e.batchStyleEles.updateStyle();var r=this.renderer();Object.keys(e.batchNotifications).forEach(function(n){var i=e.batchNotifications[n];i.empty()?r.notify(n):r.notify(n,i)})}return this},batch:function(e){return this.startBatch(),e(),this.endBatch(),this},batchData:function(e){var r=this;return this.batch(function(){for(var n=Object.keys(e),i=0;i<n.length;i++){var a=n[i],s=e[a],o=r.getElementById(a);o.data(s)}})}},$7=Ha({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1,webgl:!1,webglDebug:!1,webglDebugShowAtlases:!1,webglTexSize:2048,webglTexRows:36,webglTexRowsNodes:18,webglBatchSize:2048,webglTexPerBatch:14,webglBgColor:[255,255,255]}),VS={renderTo:function(e,r,n,i){var a=this._private.renderer;return a.renderTo(e,r,n,i),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify("draw"),this},resize:function(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function(e){var r=this,n=r.extension("renderer",e.name);if(n==null){Kn("Can not initialise: No such renderer `".concat(e.name,"` found. Did you forget to import it and `cytoscape.use()` it?"));return}e.wheelSensitivity!==void 0&&an("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var i=$7(e);i.cy=r,r._private.renderer=new n(i),this.notify("init")},destroyRenderer:function(){var e=this;e.notify("destroy");var r=e.container();if(r)for(r._cyreg=null;r.childNodes.length>0;)r.removeChild(r.childNodes[0]);e._private.renderer=null,e.mutableElements().forEach(function(n){var i=n._private;i.rscratch={},i.rstyle={},i.animation.current=[],i.animation.queue=[]})},onRender:function(e){return this.on("render",e)},offRender:function(e){return this.off("render",e)}};VS.invalidateDimensions=VS.resize;var Uy={collection:function(e,r){return Zt(e)?this.$(e):vo(e)?e.collection():Sn(e)?(r||(r={}),new za(this,e,r.unique,r.removed)):new za(this)},nodes:function(e){var r=this.$(function(n){return n.isNode()});return e?r.filter(e):r},edges:function(e){var r=this.$(function(n){return n.isEdge()});return e?r.filter(e):r},$:function(e){var r=this._private.elements;return e?r.filter(e):r.spawnSelf()},mutableElements:function(){return this._private.elements}};Uy.elements=Uy.filter=Uy.$;var ya={},Jg="t",K7="f";ya.apply=function(t){for(var e=this,r=e._private,n=r.cy,i=n.collection(),a=0;a<t.length;a++){var s=t[a],o=e.getContextMeta(s);if(!o.empty){var l=e.getContextStyle(o),u=e.applyContextStyle(o,l,s);s._private.appliedInitStyle?e.updateTransitions(s,u.diffProps):s._private.appliedInitStyle=!0;var c=e.updateStyleHints(s);c&&i.push(s)}}return i};ya.getPropertiesDiff=function(t,e){var r=this,n=r._private.propDiffs=r._private.propDiffs||{},i=t+"-"+e,a=n[i];if(a)return a;for(var s=[],o={},l=0;l<r.length;l++){var u=r[l],c=t[l]===Jg,h=e[l]===Jg,p=c!==h,g=u.mappedProperties.length>0;if(p||h&&g){var y=void 0;p&&g||p?y=u.properties:g&&(y=u.mappedProperties);for(var S=0;S<y.length;S++){for(var w=y[S],C=w.name,_=!1,T=l+1;T<r.length;T++){var N=r[T],R=e[T]===Jg;if(R&&(_=N.properties[w.name]!=null,_))break}!o[C]&&!_&&(o[C]=!0,s.push(C))}}}return n[i]=s,s};ya.getContextMeta=function(t){for(var e=this,r="",n,i=t._private.styleCxtKey||"",a=0;a<e.length;a++){var s=e[a],o=s.selector&&s.selector.matches(t);o?r+=Jg:r+=K7}return n=e.getPropertiesDiff(i,r),t._private.styleCxtKey=r,{key:r,diffPropNames:n,empty:n.length===0}};ya.getContextStyle=function(t){var e=t.key,r=this,n=this._private.contextStyles=this._private.contextStyles||{};if(n[e])return n[e];for(var i={_private:{key:e}},a=0;a<r.length;a++){var s=r[a],o=e[a]===Jg;if(o)for(var l=0;l<s.properties.length;l++){var u=s.properties[l];i[u.name]=u}}return n[e]=i,i};ya.applyContextStyle=function(t,e,r){for(var n=this,i=t.diffPropNames,a={},s=n.types,o=0;o<i.length;o++){var l=i[o],u=e[l],c=r.pstyle(l);if(!u)if(c)c.bypass?u={name:l,deleteBypassed:!0}:u={name:l,delete:!0};else continue;if(c!==u){if(u.mapped===s.fn&&c!=null&&c.mapping!=null&&c.mapping.value===u.value){var h=c.mapping,p=h.fnValue=u.value(r);if(p===h.prevFnValue)continue}var g=a[l]={prev:c};n.applyParsedProperty(r,u),g.next=r.pstyle(l),g.next&&g.next.bypass&&(g.next=g.next.bypassed)}}return{diffProps:a}};ya.updateStyleHints=function(t){var e=t._private,r=this,n=r.propertyGroupNames,i=r.propertyGroupKeys,a=function(xe,Se,Oe){return r.getPropertiesHash(xe,Se,Oe)},s=e.styleKey;if(t.removed())return!1;var o=e.group==="nodes",l=t._private.style;n=Object.keys(l);for(var u=0;u<i.length;u++){var c=i[u];e.styleKeys[c]=[Yh,Cp]}for(var h=function(xe,Se){return e.styleKeys[Se][0]=yv(xe,e.styleKeys[Se][0])},p=function(xe,Se){return e.styleKeys[Se][1]=xv(xe,e.styleKeys[Se][1])},g=function(xe,Se){h(xe,Se),p(xe,Se)},y=function(xe,Se){for(var Oe=0;Oe<xe.length;Oe++){var Ae=xe.charCodeAt(Oe);h(Ae,Se),p(Ae,Se)}},S=2e9,w=function(xe){return-128<xe&&xe<128&&Math.floor(xe)!==xe?S-(xe*1024|0):xe},C=0;C<n.length;C++){var _=n[C],T=l[_];if(T!=null){var N=this.properties[_],R=N.type,I=N.groupKey,j=void 0;N.hashOverride!=null?j=N.hashOverride(t,T):T.pfValue!=null&&(j=T.pfValue);var O=N.enums==null?T.value:null,F=j!=null,z=O!=null,V=F||z,q=T.units;if(R.number&&V&&!R.multiple){var D=F?j:O;g(w(D),I),!F&&q!=null&&y(q,I)}else y(T.strValue,I)}}for(var U=[Yh,Cp],G=0;G<i.length;G++){var Z=i[G],K=e.styleKeys[Z];U[0]=yv(K[0],U[0]),U[1]=xv(K[1],U[1])}e.styleKey=c9(U[0],U[1]);var Q=e.styleKeys;e.labelDimsKey=vd(Q.labelDimensions);var ne=a(t,["label"],Q.labelDimensions);if(e.labelKey=vd(ne),e.labelStyleKey=vd(Y0(Q.commonLabel,ne)),!o){var te=a(t,["source-label"],Q.labelDimensions);e.sourceLabelKey=vd(te),e.sourceLabelStyleKey=vd(Y0(Q.commonLabel,te));var X=a(t,["target-label"],Q.labelDimensions);e.targetLabelKey=vd(X),e.targetLabelStyleKey=vd(Y0(Q.commonLabel,X))}if(o){var re=e.styleKeys,he=re.nodeBody,oe=re.nodeBorder,se=re.nodeOutline,fe=re.backgroundImage,ae=re.compound,pe=re.pie,ye=re.stripe,ve=[he,oe,se,fe,ae,pe,ye].filter(function(ue){return ue!=null}).reduce(Y0,[Yh,Cp]);e.nodeKey=vd(ve),e.hasPie=pe!=null&&pe[0]!==Yh&&pe[1]!==Cp,e.hasStripe=ye!=null&&ye[0]!==Yh&&ye[1]!==Cp}return s!==e.styleKey};ya.clearStyleHints=function(t){var e=t._private;e.styleCxtKey="",e.styleKeys={},e.styleKey=null,e.labelKey=null,e.labelStyleKey=null,e.sourceLabelKey=null,e.sourceLabelStyleKey=null,e.targetLabelKey=null,e.targetLabelStyleKey=null,e.nodeKey=null,e.hasPie=null,e.hasStripe=null};ya.applyParsedProperty=function(t,e){var r=this,n=e,i=t._private.style,a,s=r.types,o=r.properties[n.name].type,l=n.bypass,u=i[n.name],c=u&&u.bypass,h=t._private,p="mapping",g=function(he){return he==null?null:he.pfValue!=null?he.pfValue:he.value},y=function(){var he=g(u),oe=g(n);r.checkTriggers(t,n.name,he,oe)};if(e.name==="curve-style"&&t.isEdge()&&(e.value!=="bezier"&&t.isLoop()||e.value==="haystack"&&(t.source().isParent()||t.target().isParent()))&&(n=e=this.parse(e.name,"bezier",l)),n.delete)return i[n.name]=void 0,y(),!0;if(n.deleteBypassed)return u?u.bypass?(u.bypassed=void 0,y(),!0):!1:(y(),!0);if(n.deleteBypass)return u?u.bypass?(i[n.name]=u.bypassed,y(),!0):!1:(y(),!0);var S=function(){an("Do not assign mappings to elements without corresponding data (i.e. ele `"+t.id()+"` has no mapping for property `"+n.name+"` with data field `"+n.field+"`); try a `["+n.field+"]` selector to limit scope to elements with `"+n.field+"` defined")};switch(n.mapped){case s.mapData:{for(var w=n.field.split("."),C=h.data,_=0;_<w.length&&C;_++){var T=w[_];C=C[T]}if(C==null)return S(),!1;var N;if(kt(C)){var R=n.fieldMax-n.fieldMin;R===0?N=0:N=(C-n.fieldMin)/R}else return an("Do not use continuous mappers without specifying numeric data (i.e. `"+n.field+": "+C+"` for `"+t.id()+"` is non-numeric)"),!1;if(N<0?N=0:N>1&&(N=1),o.color){var I=n.valueMin[0],j=n.valueMax[0],O=n.valueMin[1],F=n.valueMax[1],z=n.valueMin[2],V=n.valueMax[2],q=n.valueMin[3]==null?1:n.valueMin[3],D=n.valueMax[3]==null?1:n.valueMax[3],U=[Math.round(I+(j-I)*N),Math.round(O+(F-O)*N),Math.round(z+(V-z)*N),Math.round(q+(D-q)*N)];a={bypass:n.bypass,name:n.name,value:U,strValue:"rgb("+U[0]+", "+U[1]+", "+U[2]+")"}}else if(o.number){var G=n.valueMin+(n.valueMax-n.valueMin)*N;a=this.parse(n.name,G,n.bypass,p)}else return!1;if(!a)return S(),!1;a.mapping=n,n=a;break}case s.data:{for(var Z=n.field.split("."),K=h.data,Q=0;Q<Z.length&&K;Q++){var ne=Z[Q];K=K[ne]}if(K!=null&&(a=this.parse(n.name,K,n.bypass,p)),!a)return S(),!1;a.mapping=n,n=a;break}case s.fn:{var te=n.value,X=n.fnValue!=null?n.fnValue:te(t);if(n.prevFnValue=X,X==null)return an("Custom function mappers may not return null (i.e. `"+n.name+"` for ele `"+t.id()+"` is null)"),!1;if(a=this.parse(n.name,X,n.bypass,p),!a)return an("Custom function mappers may not return invalid values for the property type (i.e. `"+n.name+"` for ele `"+t.id()+"` is invalid)"),!1;a.mapping=ku(n),n=a;break}case void 0:break;default:return!1}return l?(c?n.bypassed=u.bypassed:n.bypassed=u,i[n.name]=n):c?u.bypassed=n:i[n.name]=n,y(),!0};ya.cleanElements=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(this.clearStyleHints(n),n.dirtyCompoundBoundsCache(),n.dirtyBoundingBoxCache(),!e)n._private.style={};else for(var i=n._private.style,a=Object.keys(i),s=0;s<a.length;s++){var o=a[s],l=i[o];l!=null&&(l.bypass?l.bypassed=null:i[o]=null)}}};ya.update=function(){var t=this._private.cy,e=t.mutableElements();e.updateStyle()};ya.updateTransitions=function(t,e){var r=this,n=t._private,i=t.pstyle("transition-property").value,a=t.pstyle("transition-duration").pfValue,s=t.pstyle("transition-delay").pfValue;if(i.length>0&&a>0){for(var o={},l=!1,u=0;u<i.length;u++){var c=i[u],h=t.pstyle(c),p=e[c];if(p){var g=p.prev,y=g,S=p.next!=null?p.next:h,w=!1,C=void 0,_=1e-6;y&&(kt(y.pfValue)&&kt(S.pfValue)?(w=S.pfValue-y.pfValue,C=y.pfValue+_*w):kt(y.value)&&kt(S.value)?(w=S.value-y.value,C=y.value+_*w):Sn(y.value)&&Sn(S.value)&&(w=y.value[0]!==S.value[0]||y.value[1]!==S.value[1]||y.value[2]!==S.value[2],C=y.strValue),w&&(o[c]=S.strValue,this.applyBypass(t,c,C),l=!0))}}if(!l)return;n.transitioning=!0,new cm(function(T){s>0?t.delayAnimation(s).play().promise().then(T):T()}).then(function(){return t.animation({style:o,duration:a,easing:t.pstyle("transition-timing-function").value,queue:!1}).play().promise()}).then(function(){r.removeBypasses(t,i),t.emitAndNotify("style"),n.transitioning=!1})}else n.transitioning&&(this.removeBypasses(t,i),t.emitAndNotify("style"),n.transitioning=!1)};ya.checkTrigger=function(t,e,r,n,i,a){var s=this.properties[e],o=i(s);t.removed()||o!=null&&o(r,n,t)&&a(s)};ya.checkZOrderTrigger=function(t,e,r,n){var i=this;this.checkTrigger(t,e,r,n,function(a){return a.triggersZOrder},function(){i._private.cy.notify("zorder",t)})};ya.checkBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBounds},function(i){t.dirtyCompoundBoundsCache(),t.dirtyBoundingBoxCache()})};ya.checkConnectedEdgesBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBoundsOfConnectedEdges},function(i){t.connectedEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})};ya.checkParallelEdgesBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBoundsOfParallelEdges},function(i){t.parallelEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})};ya.checkTriggers=function(t,e,r,n){t.dirtyStyleCache(),this.checkZOrderTrigger(t,e,r,n),this.checkBoundsTrigger(t,e,r,n),this.checkConnectedEdgesBoundsTrigger(t,e,r,n),this.checkParallelEdgesBoundsTrigger(t,e,r,n)};var t0={};t0.applyBypass=function(t,e,r,n){var i=this,a=[],s=!0;if(e==="*"||e==="**"){if(r!==void 0)for(var o=0;o<i.properties.length;o++){var l=i.properties[o],u=l.name,c=this.parse(u,r,!0);c&&a.push(c)}}else if(Zt(e)){var h=this.parse(e,r,!0);h&&a.push(h)}else if(Vr(e)){var p=e;n=r;for(var g=Object.keys(p),y=0;y<g.length;y++){var S=g[y],w=p[S];if(w===void 0&&(w=p[b1(S)]),w!==void 0){var C=this.parse(S,w,!0);C&&a.push(C)}}}else return!1;if(a.length===0)return!1;for(var _=!1,T=0;T<t.length;T++){for(var N=t[T],R={},I=void 0,j=0;j<a.length;j++){var O=a[j];if(n){var F=N.pstyle(O.name);I=R[O.name]={prev:F}}_=this.applyParsedProperty(N,ku(O))||_,n&&(I.next=N.pstyle(O.name))}_&&this.updateStyleHints(N),n&&this.updateTransitions(N,R,s)}return _};t0.overrideBypass=function(t,e,r){e=Qk(e);for(var n=0;n<t.length;n++){var i=t[n],a=i._private.style[e],s=this.properties[e].type,o=s.color,l=s.mutiple,u=a?a.pfValue!=null?a.pfValue:a.value:null;!a||!a.bypass?this.applyBypass(i,e,r):(a.value=r,a.pfValue!=null&&(a.pfValue=r),o?a.strValue="rgb("+r.join(",")+")":l?a.strValue=r.join(" "):a.strValue=""+r,this.updateStyleHints(i)),this.checkTriggers(i,e,u,r)}};t0.removeAllBypasses=function(t,e){return this.removeBypasses(t,this.propertyNames,e)};t0.removeBypasses=function(t,e,r){for(var n=!0,i=0;i<t.length;i++){for(var a=t[i],s={},o=0;o<e.length;o++){var l=e[o],u=this.properties[l],c=a.pstyle(u.name);if(!(!c||!c.bypass)){var h="",p=this.parse(l,h,!0),g=s[u.name]={prev:c};this.applyParsedProperty(a,p),g.next=a.pstyle(u.name)}}this.updateStyleHints(a),r&&this.updateTransitions(a,s,n)}};var f_={};f_.getEmSizeInPixels=function(){var t=this.containerCss("font-size");return t!=null?parseFloat(t):1};f_.containerCss=function(t){var e=this._private.cy,r=e.container(),n=e.window();if(n&&r&&n.getComputedStyle)return n.getComputedStyle(r).getPropertyValue(t)};var Tu={};Tu.getRenderedStyle=function(t,e){return e?this.getStylePropertyValue(t,e,!0):this.getRawStyle(t,!0)};Tu.getRawStyle=function(t,e){var r=this;if(t=t[0],t){for(var n={},i=0;i<r.properties.length;i++){var a=r.properties[i],s=r.getStylePropertyValue(t,a.name,e);s!=null&&(n[a.name]=s,n[b1(a.name)]=s)}return n}};Tu.getIndexedStyle=function(t,e,r,n){var i=t.pstyle(e)[r][n];return i??t.cy().style().getDefaultProperty(e)[r][0]};Tu.getStylePropertyValue=function(t,e,r){var n=this;if(t=t[0],t){var i=n.properties[e];i.alias&&(i=i.pointsTo);var a=i.type,s=t.pstyle(i.name);if(s){var o=s.value,l=s.units,u=s.strValue;if(r&&a.number&&o!=null&&kt(o)){var c=t.cy().zoom(),h=function(w){return w*c},p=function(w,C){return h(w)+C},g=Sn(o),y=g?l.every(function(S){return S!=null}):l!=null;return y?g?o.map(function(S,w){return p(S,l[w])}).join(" "):p(o,l):g?o.map(function(S){return Zt(S)?S:""+h(S)}).join(" "):""+h(o)}else if(u!=null)return u}return null}};Tu.getAnimationStartStyle=function(t,e){for(var r={},n=0;n<e.length;n++){var i=e[n],a=i.name,s=t.pstyle(a);s!==void 0&&(Vr(s)?s=this.parse(a,s.strValue):s=this.parse(a,s)),s&&(r[a]=s)}return r};Tu.getPropsList=function(t){var e=this,r=[],n=t,i=e.properties;if(n)for(var a=Object.keys(n),s=0;s<a.length;s++){var o=a[s],l=n[o],u=i[o]||i[Qk(o)],c=this.parse(u.name,l);c&&r.push(c)}return r};Tu.getNonDefaultPropertiesHash=function(t,e,r){var n=r.slice(),i,a,s,o,l,u;for(l=0;l<e.length;l++)if(i=e[l],a=t.pstyle(i,!1),a!=null)if(a.pfValue!=null)n[0]=yv(o,n[0]),n[1]=xv(o,n[1]);else for(s=a.strValue,u=0;u<s.length;u++)o=s.charCodeAt(u),n[0]=yv(o,n[0]),n[1]=xv(o,n[1]);return n};Tu.getPropertiesHash=Tu.getNonDefaultPropertiesHash;var R1={};R1.appendFromJson=function(t){for(var e=this,r=0;r<t.length;r++){var n=t[r],i=n.selector,a=n.style||n.css,s=Object.keys(a);e.selector(i);for(var o=0;o<s.length;o++){var l=s[o],u=a[l];e.css(l,u)}}return e};R1.fromJson=function(t){var e=this;return e.resetToDefault(),e.appendFromJson(t),e};R1.json=function(){for(var t=[],e=this.defaultLength;e<this.length;e++){for(var r=this[e],n=r.selector,i=r.properties,a={},s=0;s<i.length;s++){var o=i[s];a[o.name]=o.strValue}t.push({selector:n?n.toString():"core",style:a})}return t};var p_={};p_.appendFromString=function(t){var e=this,r=this,n=""+t,i,a,s;n=n.replace(/[/][*](\s|.)+?[*][/]/g,"");function o(){n.length>i.length?n=n.substr(i.length):n=""}function l(){a.length>s.length?a=a.substr(s.length):a=""}for(;;){var u=n.match(/^\s*$/);if(u)break;var c=n.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!c){an("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+n);break}i=c[0];var h=c[1];if(h!=="core"){var p=new Qd(h);if(p.invalid){an("Skipping parsing of block: Invalid selector found in string stylesheet: "+h),o();continue}}var g=c[2],y=!1;a=g;for(var S=[];;){var w=a.match(/^\s*$/);if(w)break;var C=a.match(/^\s*(.+?)\s*:\s*(.+?)(?:\s*;|\s*$)/);if(!C){an("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+g),y=!0;break}s=C[0];var _=C[1],T=C[2],N=e.properties[_];if(!N){an("Skipping property: Invalid property name in: "+s),l();continue}var R=r.parse(_,T);if(!R){an("Skipping property: Invalid property definition in: "+s),l();continue}S.push({name:_,val:T}),l()}if(y){o();break}r.selector(h);for(var I=0;I<S.length;I++){var j=S[I];r.css(j.name,j.val)}o()}return r};p_.fromString=function(t){var e=this;return e.resetToDefault(),e.appendFromString(t),e};var Oi={};(function(){var t=Wi,e=Gj,r=Hj,n=Wj,i=qj,a=function(ue){return"^"+ue+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},s=function(ue){var xe=t+"|\\w+|"+e+"|"+r+"|"+n+"|"+i;return"^"+ue+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+t+")\\s*\\,\\s*("+t+")\\s*,\\s*("+xe+")\\s*\\,\\s*("+xe+")\\)$"},o=[`^url\\s*\\(\\s*['"]?(.+?)['"]?\\s*\\)$`,"^(none)$","^(.+)$"];Oi.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},nonNegativeNumber:{number:!0,min:0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizeMaybePercent:{number:!0,allowPercent:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},axisDirectionExplicit:{enums:["leftward","rightward","upward","downward"]},axisDirectionPrimary:{enums:["horizontal","vertical"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials","null"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},bgContainment:{enums:["inside","over"],multiple:!0},boxSelection:{enums:["contain","overlap","none"]},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},bools:{enums:["yes","no"],multiple:!0},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},linePosition:{enums:["center","inside","outside"]},lineJoin:{enums:["round","bevel","miter"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","straight-triangle","taxi","round-segments","round-taxi"]},radiusType:{enums:["arc-radius","influence-radius"],multiple:!0},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle","circle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","round-triangle","square","pentagon","round-pentagon","hexagon","round-hexagon","concavehexagon","concave-hexagon","heptagon","round-heptagon","octagon","round-octagon","tag","round-tag","star","diamond","round-diamond","vee","rhomboid","right-rhomboid","polygon"]},overlayShape:{enums:["roundrectangle","round-rectangle","ellipse"]},cornerRadius:{number:!0,min:0,units:"px|em",implicitUnits:"px",enums:["auto"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","circle-triangle","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},arrowWidth:{number:!0,units:"%|px|em",implicitUnits:"px",enums:["match-line"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:a("data")},layoutData:{mapping:!0,regex:a("layoutData")},scratch:{mapping:!0,regex:a("scratch")},mapData:{mapping:!0,regex:s("mapData")},mapLayoutData:{mapping:!0,regex:s("mapLayoutData")},mapScratch:{mapping:!0,regex:s("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:o,singleRegexMatchValue:!0},urls:{regexes:o,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position","endpoints"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function(ue,xe){switch(ue.length){case 2:return xe[0]!=="deg"&&xe[0]!=="rad"&&xe[1]!=="deg"&&xe[1]!=="rad";case 1:return Zt(ue[0])||xe[0]==="deg"||xe[0]==="rad";default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+t+")\\s*,\\s*("+t+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+t+")\\s*,\\s*("+t+")\\s*,\\s*("+t+")\\s*,\\s*("+t+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function(ue){var xe=ue.length;return xe===1||xe===2||xe===4}}};var l={zeroNonZero:function(ue,xe){return(ue==null||xe==null)&&ue!==xe||ue==0&&xe!=0?!0:ue!=0&&xe==0},any:function(ue,xe){return ue!=xe},emptyNonEmpty:function(ue,xe){var Se=Zd(ue),Oe=Zd(xe);return Se&&!Oe||!Se&&Oe}},u=Oi.types,c=[{name:"label",type:u.text,triggersBounds:l.any,triggersZOrder:l.emptyNonEmpty},{name:"text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any}],h=[{name:"source-label",type:u.text,triggersBounds:l.any},{name:"source-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"source-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-offset",type:u.size,triggersBounds:l.any}],p=[{name:"target-label",type:u.text,triggersBounds:l.any},{name:"target-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"target-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-offset",type:u.size,triggersBounds:l.any}],g=[{name:"font-family",type:u.fontFamily,triggersBounds:l.any},{name:"font-style",type:u.fontStyle,triggersBounds:l.any},{name:"font-weight",type:u.fontWeight,triggersBounds:l.any},{name:"font-size",type:u.size,triggersBounds:l.any},{name:"text-transform",type:u.textTransform,triggersBounds:l.any},{name:"text-wrap",type:u.textWrap,triggersBounds:l.any},{name:"text-overflow-wrap",type:u.textOverflowWrap,triggersBounds:l.any},{name:"text-max-width",type:u.size,triggersBounds:l.any},{name:"text-outline-width",type:u.size,triggersBounds:l.any},{name:"line-height",type:u.positiveNumber,triggersBounds:l.any}],y=[{name:"text-valign",type:u.valign,triggersBounds:l.any},{name:"text-halign",type:u.halign,triggersBounds:l.any},{name:"color",type:u.color},{name:"text-outline-color",type:u.color},{name:"text-outline-opacity",type:u.zeroOneNumber},{name:"text-background-color",type:u.color},{name:"text-background-opacity",type:u.zeroOneNumber},{name:"text-background-padding",type:u.size,triggersBounds:l.any},{name:"text-border-opacity",type:u.zeroOneNumber},{name:"text-border-color",type:u.color},{name:"text-border-width",type:u.size,triggersBounds:l.any},{name:"text-border-style",type:u.borderStyle,triggersBounds:l.any},{name:"text-background-shape",type:u.textBackgroundShape,triggersBounds:l.any},{name:"text-justification",type:u.justification},{name:"box-select-labels",type:u.bool,triggersBounds:l.any}],S=[{name:"events",type:u.bool,triggersZOrder:l.any},{name:"text-events",type:u.bool,triggersZOrder:l.any},{name:"box-selection",type:u.boxSelection,triggersZOrder:l.any}],w=[{name:"display",type:u.display,triggersZOrder:l.any,triggersBounds:l.any,triggersBoundsOfConnectedEdges:l.any,triggersBoundsOfParallelEdges:function(ue,xe,Se){return ue===xe?!1:Se.pstyle("curve-style").value==="bezier"}},{name:"visibility",type:u.visibility,triggersZOrder:l.any},{name:"opacity",type:u.zeroOneNumber,triggersZOrder:l.zeroNonZero},{name:"text-opacity",type:u.zeroOneNumber},{name:"min-zoomed-font-size",type:u.size},{name:"z-compound-depth",type:u.zCompoundDepth,triggersZOrder:l.any},{name:"z-index-compare",type:u.zIndexCompare,triggersZOrder:l.any},{name:"z-index",type:u.number,triggersZOrder:l.any}],C=[{name:"overlay-padding",type:u.size,triggersBounds:l.any},{name:"overlay-color",type:u.color},{name:"overlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"overlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"overlay-corner-radius",type:u.cornerRadius}],_=[{name:"underlay-padding",type:u.size,triggersBounds:l.any},{name:"underlay-color",type:u.color},{name:"underlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"underlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"underlay-corner-radius",type:u.cornerRadius}],T=[{name:"transition-property",type:u.propList},{name:"transition-duration",type:u.time},{name:"transition-delay",type:u.time},{name:"transition-timing-function",type:u.easing}],N=function(ue,xe){return xe.value==="label"?-ue.poolIndex():xe.pfValue},R=[{name:"height",type:u.nodeSize,triggersBounds:l.any,hashOverride:N},{name:"width",type:u.nodeSize,triggersBounds:l.any,hashOverride:N},{name:"shape",type:u.nodeShape,triggersBounds:l.any},{name:"shape-polygon-points",type:u.polygonPointList,triggersBounds:l.any},{name:"corner-radius",type:u.cornerRadius},{name:"background-color",type:u.color},{name:"background-fill",type:u.fill},{name:"background-opacity",type:u.zeroOneNumber},{name:"background-blacken",type:u.nOneOneNumber},{name:"background-gradient-stop-colors",type:u.colors},{name:"background-gradient-stop-positions",type:u.percentages},{name:"background-gradient-direction",type:u.gradientDirection},{name:"padding",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"padding-relative-to",type:u.paddingRelativeTo,triggersBounds:l.any},{name:"bounds-expansion",type:u.boundsExpansion,triggersBounds:l.any}],I=[{name:"border-color",type:u.color},{name:"border-opacity",type:u.zeroOneNumber},{name:"border-width",type:u.size,triggersBounds:l.any},{name:"border-style",type:u.borderStyle},{name:"border-cap",type:u.lineCap},{name:"border-join",type:u.lineJoin},{name:"border-dash-pattern",type:u.numbers},{name:"border-dash-offset",type:u.number},{name:"border-position",type:u.linePosition}],j=[{name:"outline-color",type:u.color},{name:"outline-opacity",type:u.zeroOneNumber},{name:"outline-width",type:u.size,triggersBounds:l.any},{name:"outline-style",type:u.borderStyle},{name:"outline-offset",type:u.size,triggersBounds:l.any}],O=[{name:"background-image",type:u.urls},{name:"background-image-crossorigin",type:u.bgCrossOrigin},{name:"background-image-opacity",type:u.zeroOneNumbers},{name:"background-image-containment",type:u.bgContainment},{name:"background-image-smoothing",type:u.bools},{name:"background-position-x",type:u.bgPos},{name:"background-position-y",type:u.bgPos},{name:"background-width-relative-to",type:u.bgRelativeTo},{name:"background-height-relative-to",type:u.bgRelativeTo},{name:"background-repeat",type:u.bgRepeat},{name:"background-fit",type:u.bgFit},{name:"background-clip",type:u.bgClip},{name:"background-width",type:u.bgWH},{name:"background-height",type:u.bgWH},{name:"background-offset-x",type:u.bgPos},{name:"background-offset-y",type:u.bgPos}],F=[{name:"position",type:u.position,triggersBounds:l.any},{name:"compound-sizing-wrt-labels",type:u.compoundIncludeLabels,triggersBounds:l.any},{name:"min-width",type:u.size,triggersBounds:l.any},{name:"min-width-bias-left",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-width-bias-right",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height",type:u.size,triggersBounds:l.any},{name:"min-height-bias-top",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height-bias-bottom",type:u.sizeMaybePercent,triggersBounds:l.any}],z=[{name:"line-style",type:u.lineStyle},{name:"line-color",type:u.color},{name:"line-fill",type:u.fill},{name:"line-cap",type:u.lineCap},{name:"line-opacity",type:u.zeroOneNumber},{name:"line-dash-pattern",type:u.numbers},{name:"line-dash-offset",type:u.number},{name:"line-outline-width",type:u.size},{name:"line-outline-color",type:u.color},{name:"line-gradient-stop-colors",type:u.colors},{name:"line-gradient-stop-positions",type:u.percentages},{name:"curve-style",type:u.curveStyle,triggersBounds:l.any,triggersBoundsOfParallelEdges:function(ue,xe){return ue===xe?!1:ue==="bezier"||xe==="bezier"}},{name:"haystack-radius",type:u.zeroOneNumber,triggersBounds:l.any},{name:"source-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"target-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"control-point-step-size",type:u.size,triggersBounds:l.any},{name:"control-point-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"control-point-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"segment-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-radii",type:u.numbers,triggersBounds:l.any},{name:"radius-type",type:u.radiusType,triggersBounds:l.any},{name:"taxi-turn",type:u.bidirectionalSizeMaybePercent,triggersBounds:l.any},{name:"taxi-turn-min-distance",type:u.size,triggersBounds:l.any},{name:"taxi-direction",type:u.axisDirection,triggersBounds:l.any},{name:"taxi-radius",type:u.number,triggersBounds:l.any},{name:"edge-distances",type:u.edgeDistances,triggersBounds:l.any},{name:"arrow-scale",type:u.positiveNumber,triggersBounds:l.any},{name:"loop-direction",type:u.angle,triggersBounds:l.any},{name:"loop-sweep",type:u.angle,triggersBounds:l.any},{name:"source-distance-from-node",type:u.size,triggersBounds:l.any},{name:"target-distance-from-node",type:u.size,triggersBounds:l.any}],V=[{name:"ghost",type:u.bool,triggersBounds:l.any},{name:"ghost-offset-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-offset-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-opacity",type:u.zeroOneNumber}],q=[{name:"selection-box-color",type:u.color},{name:"selection-box-opacity",type:u.zeroOneNumber},{name:"selection-box-border-color",type:u.color},{name:"selection-box-border-width",type:u.size},{name:"active-bg-color",type:u.color},{name:"active-bg-opacity",type:u.zeroOneNumber},{name:"active-bg-size",type:u.size},{name:"outside-texture-bg-color",type:u.color},{name:"outside-texture-bg-opacity",type:u.zeroOneNumber}],D=[];Oi.pieBackgroundN=16,D.push({name:"pie-size",type:u.sizeMaybePercent}),D.push({name:"pie-hole",type:u.sizeMaybePercent}),D.push({name:"pie-start-angle",type:u.angle});for(var U=1;U<=Oi.pieBackgroundN;U++)D.push({name:"pie-"+U+"-background-color",type:u.color}),D.push({name:"pie-"+U+"-background-size",type:u.percent}),D.push({name:"pie-"+U+"-background-opacity",type:u.zeroOneNumber});var G=[];Oi.stripeBackgroundN=16,G.push({name:"stripe-size",type:u.sizeMaybePercent}),G.push({name:"stripe-direction",type:u.axisDirectionPrimary});for(var Z=1;Z<=Oi.stripeBackgroundN;Z++)G.push({name:"stripe-"+Z+"-background-color",type:u.color}),G.push({name:"stripe-"+Z+"-background-size",type:u.percent}),G.push({name:"stripe-"+Z+"-background-opacity",type:u.zeroOneNumber});var K=[],Q=Oi.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:u.arrowShape,triggersBounds:l.any},{name:"arrow-color",type:u.color},{name:"arrow-fill",type:u.arrowFill},{name:"arrow-width",type:u.arrowWidth}].forEach(function(ve){Q.forEach(function(ue){var xe=ue+"-"+ve.name,Se=ve.type,Oe=ve.triggersBounds;K.push({name:xe,type:Se,triggersBounds:Oe})})},{});var ne=Oi.properties=[].concat(S,T,w,C,_,V,y,g,c,h,p,R,I,j,O,D,G,F,z,K,q),te=Oi.propertyGroups={behavior:S,transition:T,visibility:w,overlay:C,underlay:_,ghost:V,commonLabel:y,labelDimensions:g,mainLabel:c,sourceLabel:h,targetLabel:p,nodeBody:R,nodeBorder:I,nodeOutline:j,backgroundImage:O,pie:D,stripe:G,compound:F,edgeLine:z,edgeArrow:K,core:q},X=Oi.propertyGroupNames={},re=Oi.propertyGroupKeys=Object.keys(te);re.forEach(function(ve){X[ve]=te[ve].map(function(ue){return ue.name}),te[ve].forEach(function(ue){return ue.groupKey=ve})});var he=Oi.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"segment-distance",pointsTo:"segment-distances"},{name:"segment-weight",pointsTo:"segment-weights"},{name:"segment-radius",pointsTo:"segment-radii"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];Oi.propertyNames=ne.map(function(ve){return ve.name});for(var oe=0;oe<ne.length;oe++){var se=ne[oe];ne[se.name]=se}for(var fe=0;fe<he.length;fe++){var ae=he[fe],pe=ne[ae.pointsTo],ye={name:ae.name,alias:!0,pointsTo:pe};ne.push(ye),ne[ae.name]=ye}})();Oi.getDefaultProperty=function(t){return this.getDefaultProperties()[t]};Oi.getDefaultProperties=function(){var t=this._private;if(t.defaultProperties!=null)return t.defaultProperties;for(var e=ar({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","box-selection":"contain","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"overlay-shape":"round-rectangle","overlay-corner-radius":"auto","underlay-opacity":0,"underlay-color":"#000","underlay-padding":10,"underlay-shape":"round-rectangle","underlay-corner-radius":"auto","transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","box-select-labels":"no","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-image-containment":"inside","background-image-smoothing":"yes","background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid","border-dash-pattern":[4,2],"border-dash-offset":0,"border-cap":"butt","border-join":"miter","border-position":"center","outline-color":"#999","outline-opacity":1,"outline-width":0,"outline-offset":0,"outline-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","corner-radius":"auto","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%","pie-hole":0,"pie-start-angle":"0deg"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(l,u){for(var c=1;c<=Oi.pieBackgroundN;c++){var h=u.name.replace("{{i}}",c),p=u.value;l[h]=p}return l},{}),{"stripe-size":"100%","stripe-direction":"horizontal"},[{name:"stripe-{{i}}-background-color",value:"black"},{name:"stripe-{{i}}-background-size",value:"0%"},{name:"stripe-{{i}}-background-opacity",value:1}].reduce(function(l,u){for(var c=1;c<=Oi.stripeBackgroundN;c++){var h=u.name.replace("{{i}}",c),p=u.value;l[h]=p}return l},{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-opacity":1,"line-outline-width":0,"line-outline-color":"#000","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"segment-radii":15,"radius-type":"arc-radius","taxi-turn":"50%","taxi-radius":15,"taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"},{name:"arrow-width",value:1}].reduce(function(l,u){return Oi.arrowPrefixes.forEach(function(c){var h=c+"-"+u.name,p=u.value;l[h]=p}),l},{})),r={},n=0;n<this.properties.length;n++){var i=this.properties[n];if(!i.pointsTo){var a=i.name,s=e[a],o=this.parse(a,s);r[a]=o}}return t.defaultProperties=r,t.defaultProperties};Oi.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var O1={};O1.parse=function(t,e,r,n){var i=this;if(ri(e))return i.parseImplWarn(t,e,r,n);var a=n==="mapping"||n===!0||n===!1||n==null?"dontcare":n,s=r?"t":"f",o=""+e,l=UM(t,o,s,a),u=i.propCache=i.propCache||[],c;return(c=u[l])||(c=u[l]=i.parseImplWarn(t,e,r,n)),(r||n==="mapping")&&(c=ku(c),c&&(c.value=ku(c.value))),c};O1.parseImplWarn=function(t,e,r,n){var i=this.parseImpl(t,e,r,n);return!i&&e!=null&&an("The style property `".concat(t,": ").concat(e,"` is invalid")),i&&(i.name==="width"||i.name==="height")&&e==="label"&&an("The style value of `label` is deprecated for `"+i.name+"`"),i};O1.parseImpl=function(t,e,r,n){var i=this;t=Qk(t);var a=i.properties[t],s=e,o=i.types;if(!a||e===void 0)return null;a.alias&&(a=a.pointsTo,t=a.name);var l=Zt(e);l&&(e=e.trim());var u=a.type;if(!u)return null;if(r&&(e===""||e===null))return{name:t,value:e,bypass:!0,deleteBypass:!0};if(ri(e))return{name:t,value:e,strValue:"fn",mapped:o.fn,bypass:r};var c,h;if(!(!l||n||e.length<7||e[1]!=="a")){if(e.length>=7&&e[0]==="d"&&(c=new RegExp(o.data.regex).exec(e))){if(r)return!1;var p=o.data;return{name:t,value:c,strValue:""+e,mapped:p,field:c[1],bypass:r}}else if(e.length>=10&&e[0]==="m"&&(h=new RegExp(o.mapData.regex).exec(e))){if(r||u.multiple)return!1;var g=o.mapData;if(!(u.color||u.number))return!1;var y=this.parse(t,h[4]);if(!y||y.mapped)return!1;var S=this.parse(t,h[5]);if(!S||S.mapped)return!1;if(y.pfValue===S.pfValue||y.strValue===S.strValue)return an("`"+t+": "+e+"` is not a valid mapper because the output range is zero; converting to `"+t+": "+y.strValue+"`"),this.parse(t,y.strValue);if(u.color){var w=y.value,C=S.value,_=w[0]===C[0]&&w[1]===C[1]&&w[2]===C[2]&&(w[3]===C[3]||(w[3]==null||w[3]===1)&&(C[3]==null||C[3]===1));if(_)return!1}return{name:t,value:h,strValue:""+e,mapped:g,field:h[1],fieldMin:parseFloat(h[2]),fieldMax:parseFloat(h[3]),valueMin:y.value,valueMax:S.value,bypass:r}}}if(u.multiple&&n!=="multiple"){var T;if(l?T=e.split(/\s+/):Sn(e)?T=e:T=[e],u.evenMultiple&&T.length%2!==0)return null;for(var N=[],R=[],I=[],j="",O=!1,F=0;F<T.length;F++){var z=i.parse(t,T[F],r,"multiple");O=O||Zt(z.value),N.push(z.value),I.push(z.pfValue!=null?z.pfValue:z.value),R.push(z.units),j+=(F>0?" ":"")+z.strValue}return u.validate&&!u.validate(N,R)?null:u.singleEnum&&O?N.length===1&&Zt(N[0])?{name:t,value:N[0],strValue:N[0],bypass:r}:null:{name:t,value:N,pfValue:I,strValue:j,bypass:r,units:R}}var V=function(){for(var ye=0;ye<u.enums.length;ye++){var ve=u.enums[ye];if(ve===e)return{name:t,value:e,strValue:""+e,bypass:r}}return null};if(u.number){var q,D="px";if(u.units&&(q=u.units),u.implicitUnits&&(D=u.implicitUnits),!u.unitless)if(l){var U="px|em"+(u.allowPercent?"|\\%":"");q&&(U=q);var G=e.match("^("+Wi+")("+U+")?$");G&&(e=G[1],q=G[2]||D)}else(!q||u.implicitUnits)&&(q=D);if(e=parseFloat(e),isNaN(e)&&u.enums===void 0)return null;if(isNaN(e)&&u.enums!==void 0)return e=s,V();if(u.integer&&!Dj(e)||u.min!==void 0&&(e<u.min||u.strictMin&&e===u.min)||u.max!==void 0&&(e>u.max||u.strictMax&&e===u.max))return null;var Z={name:t,value:e,strValue:""+e+(q||""),units:q,bypass:r};return u.unitless||q!=="px"&&q!=="em"?Z.pfValue=e:Z.pfValue=q==="px"||!q?e:this.getEmSizeInPixels()*e,(q==="ms"||q==="s")&&(Z.pfValue=q==="ms"?e:1e3*e),(q==="deg"||q==="rad")&&(Z.pfValue=q==="rad"?e:W9(e)),q==="%"&&(Z.pfValue=e/100),Z}else if(u.propList){var K=[],Q=""+e;if(Q!=="none"){for(var ne=Q.split(/\s*,\s*|\s+/),te=0;te<ne.length;te++){var X=ne[te].trim();i.properties[X]?K.push(X):an("`"+X+"` is not a valid property name")}if(K.length===0)return null}return{name:t,value:K,strValue:K.length===0?"none":K.join(" "),bypass:r}}else if(u.color){var re=OM(e);return re?{name:t,value:re,pfValue:re,strValue:"rgb("+re[0]+","+re[1]+","+re[2]+")",bypass:r}:null}else if(u.regex||u.regexes){if(u.enums){var he=V();if(he)return he}for(var oe=u.regexes?u.regexes:[u.regex],se=0;se<oe.length;se++){var fe=new RegExp(oe[se]),ae=fe.exec(e);if(ae)return{name:t,value:u.singleRegexMatchValue?ae[1]:ae,strValue:""+e,bypass:r}}return null}else return u.string?{name:t,value:""+e,strValue:""+e,bypass:r}:u.enums?V():null};var ma=function(e){if(!(this instanceof ma))return new ma(e);if(!Xk(e)){Kn("A style must have a core reference");return}this._private={cy:e,coreStyle:{}},this.length=0,this.resetToDefault()},ls=ma.prototype;ls.instanceString=function(){return"style"};ls.clear=function(){for(var t=this._private,e=t.cy,r=e.elements(),n=0;n<this.length;n++)this[n]=void 0;return this.length=0,t.contextStyles={},t.propDiffs={},this.cleanElements(r,!0),r.forEach(function(i){var a=i[0]._private;a.styleDirty=!0,a.appliedInitStyle=!1}),this};ls.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this};ls.core=function(t){return this._private.coreStyle[t]||this.getDefaultProperty(t)};ls.selector=function(t){var e=t==="core"?null:new Qd(t),r=this.length++;return this[r]={selector:e,properties:[],mappedProperties:[],index:r},this};ls.css=function(){var t=this,e=arguments;if(e.length===1)for(var r=e[0],n=0;n<t.properties.length;n++){var i=t.properties[n],a=r[i.name];a===void 0&&(a=r[b1(i.name)]),a!==void 0&&this.cssRule(i.name,a)}else e.length===2&&this.cssRule(e[0],e[1]);return this};ls.style=ls.css;ls.cssRule=function(t,e){var r=this.parse(t,e);if(r){var n=this.length-1;this[n].properties.push(r),this[n].properties[r.name]=r,r.name.match(/pie-(\d+)-background-size/)&&r.value&&(this._private.hasPie=!0),r.name.match(/stripe-(\d+)-background-size/)&&r.value&&(this._private.hasStripe=!0),r.mapped&&this[n].mappedProperties.push(r);var i=!this[n].selector;i&&(this._private.coreStyle[r.name]=r)}return this};ls.append=function(t){return AM(t)?t.appendToStyle(this):Sn(t)?this.appendFromJson(t):Zt(t)&&this.appendFromString(t),this};ma.fromJson=function(t,e){var r=new ma(t);return r.fromJson(e),r};ma.fromString=function(t,e){return new ma(t).fromString(e)};[ya,t0,f_,Tu,R1,p_,Oi,O1].forEach(function(t){ar(ls,t)});ma.types=ls.types;ma.properties=ls.properties;ma.propertyGroups=ls.propertyGroups;ma.propertyGroupNames=ls.propertyGroupNames;ma.propertyGroupKeys=ls.propertyGroupKeys;var Z7={style:function(e){if(e){var r=this.setStyle(e);r.update()}return this._private.style},setStyle:function(e){var r=this._private;return AM(e)?r.style=e.generateStyle(this):Sn(e)?r.style=ma.fromJson(this,e):Zt(e)?r.style=ma.fromString(this,e):r.style=ma(this),r.style},updateStyle:function(){this.mutableElements().updateStyle()}},Y7="single",vf={autolock:function(e){if(e!==void 0)this._private.autolock=!!e;else return this._private.autolock;return this},autoungrabify:function(e){if(e!==void 0)this._private.autoungrabify=!!e;else return this._private.autoungrabify;return this},autounselectify:function(e){if(e!==void 0)this._private.autounselectify=!!e;else return this._private.autounselectify;return this},selectionType:function(e){var r=this._private;if(r.selectionType==null&&(r.selectionType=Y7),e!==void 0)(e==="additive"||e==="single")&&(r.selectionType=e);else return r.selectionType;return this},panningEnabled:function(e){if(e!==void 0)this._private.panningEnabled=!!e;else return this._private.panningEnabled;return this},userPanningEnabled:function(e){if(e!==void 0)this._private.userPanningEnabled=!!e;else return this._private.userPanningEnabled;return this},zoomingEnabled:function(e){if(e!==void 0)this._private.zoomingEnabled=!!e;else return this._private.zoomingEnabled;return this},userZoomingEnabled:function(e){if(e!==void 0)this._private.userZoomingEnabled=!!e;else return this._private.userZoomingEnabled;return this},boxSelectionEnabled:function(e){if(e!==void 0)this._private.boxSelectionEnabled=!!e;else return this._private.boxSelectionEnabled;return this},pan:function(){var e=arguments,r=this._private.pan,n,i,a,s,o;switch(e.length){case 0:return r;case 1:if(Zt(e[0]))return n=e[0],r[n];if(Vr(e[0])){if(!this._private.panningEnabled)return this;a=e[0],s=a.x,o=a.y,kt(s)&&(r.x=s),kt(o)&&(r.y=o),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;n=e[0],i=e[1],(n==="x"||n==="y")&&kt(i)&&(r[n]=i),this.emit("pan viewport");break}return this.notify("viewport"),this},panBy:function(e,r){var n=arguments,i=this._private.pan,a,s,o,l,u;if(!this._private.panningEnabled)return this;switch(n.length){case 1:Vr(e)&&(o=n[0],l=o.x,u=o.y,kt(l)&&(i.x+=l),kt(u)&&(i.y+=u),this.emit("pan viewport"));break;case 2:a=e,s=r,(a==="x"||a==="y")&&kt(s)&&(i[a]+=s),this.emit("pan viewport");break}return this.notify("viewport"),this},gc:function(){this.notify("gc")},fit:function(e,r){var n=this.getFitViewport(e,r);if(n){var i=this._private;i.zoom=n.zoom,i.pan=n.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function(e,r){if(kt(e)&&r===void 0&&(r=e,e=void 0),!(!this._private.panningEnabled||!this._private.zoomingEnabled)){var n;if(Zt(e)){var i=e;e=this.$(i)}else if(Fj(e)){var a=e;n={x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2},n.w=n.x2-n.x1,n.h=n.y2-n.y1}else vo(e)||(e=this.mutableElements());if(!(vo(e)&&e.empty())){n=n||e.boundingBox();var s=this.width(),o=this.height(),l;if(r=kt(r)?r:0,!isNaN(s)&&!isNaN(o)&&s>0&&o>0&&!isNaN(n.w)&&!isNaN(n.h)&&n.w>0&&n.h>0){l=Math.min((s-2*r)/n.w,(o-2*r)/n.h),l=l>this._private.maxZoom?this._private.maxZoom:l,l=l<this._private.minZoom?this._private.minZoom:l;var u={x:(s-l*(n.x1+n.x2))/2,y:(o-l*(n.y1+n.y2))/2};return{zoom:l,pan:u}}}}},zoomRange:function(e,r){var n=this._private;if(r==null){var i=e;e=i.min,r=i.max}return kt(e)&&kt(r)&&e<=r?(n.minZoom=e,n.maxZoom=r):kt(e)&&r===void 0&&e<=n.maxZoom?n.minZoom=e:kt(r)&&e===void 0&&r>=n.minZoom&&(n.maxZoom=r),this},minZoom:function(e){return e===void 0?this._private.minZoom:this.zoomRange({min:e})},maxZoom:function(e){return e===void 0?this._private.maxZoom:this.zoomRange({max:e})},getZoomedViewport:function(e){var r=this._private,n=r.pan,i=r.zoom,a,s,o=!1;if(r.zoomingEnabled||(o=!0),kt(e)?s=e:Vr(e)&&(s=e.level,e.position!=null?a=k1(e.position,i,n):e.renderedPosition!=null&&(a=e.renderedPosition),a!=null&&!r.panningEnabled&&(o=!0)),s=s>r.maxZoom?r.maxZoom:s,s=s<r.minZoom?r.minZoom:s,o||!kt(s)||s===i||a!=null&&(!kt(a.x)||!kt(a.y)))return null;if(a!=null){var l=n,u=i,c=s,h={x:-c/u*(a.x-l.x)+a.x,y:-c/u*(a.y-l.y)+a.y};return{zoomed:!0,panned:!0,zoom:c,pan:h}}else return{zoomed:!0,panned:!1,zoom:s,pan:n}},zoom:function(e){if(e===void 0)return this._private.zoom;var r=this.getZoomedViewport(e),n=this._private;return r==null||!r.zoomed?this:(n.zoom=r.zoom,r.panned&&(n.pan.x=r.pan.x,n.pan.y=r.pan.y),this.emit("zoom"+(r.panned?" pan":"")+" viewport"),this.notify("viewport"),this)},viewport:function(e){var r=this._private,n=!0,i=!0,a=[],s=!1,o=!1;if(!e)return this;if(kt(e.zoom)||(n=!1),Vr(e.pan)||(i=!1),!n&&!i)return this;if(n){var l=e.zoom;l<r.minZoom||l>r.maxZoom||!r.zoomingEnabled?s=!0:(r.zoom=l,a.push("zoom"))}if(i&&(!s||!e.cancelOnFailedZoom)&&r.panningEnabled){var u=e.pan;kt(u.x)&&(r.pan.x=u.x,o=!1),kt(u.y)&&(r.pan.y=u.y,o=!1),o||a.push("pan")}return a.length>0&&(a.push("viewport"),this.emit(a.join(" ")),this.notify("viewport")),this},center:function(e){var r=this.getCenterPan(e);return r&&(this._private.pan=r,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function(e,r){if(this._private.panningEnabled){if(Zt(e)){var n=e;e=this.mutableElements().filter(n)}else vo(e)||(e=this.mutableElements());if(e.length!==0){var i=e.boundingBox(),a=this.width(),s=this.height();r=r===void 0?this._private.zoom:r;var o={x:(a-r*(i.x1+i.x2))/2,y:(s-r*(i.y1+i.y2))/2};return o}}},reset:function(){return!this._private.panningEnabled||!this._private.zoomingEnabled?this:(this.viewport({pan:{x:0,y:0},zoom:1}),this)},invalidateSize:function(){this._private.sizeCache=null},size:function(){var e=this._private,r=e.container,n=this;return e.sizeCache=e.sizeCache||(r?(function(){var i=n.window().getComputedStyle(r),a=function(o){return parseFloat(i.getPropertyValue(o))};return{width:r.clientWidth-a("padding-left")-a("padding-right"),height:r.clientHeight-a("padding-top")-a("padding-bottom")}})():{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var e=this._private.pan,r=this._private.zoom,n=this.renderedExtent(),i={x1:(n.x1-e.x)/r,x2:(n.x2-e.x)/r,y1:(n.y1-e.y)/r,y2:(n.y2-e.y)/r};return i.w=i.x2-i.x1,i.h=i.y2-i.y1,i},renderedExtent:function(){var e=this.width(),r=this.height();return{x1:0,y1:0,x2:e,y2:r,w:e,h:r}},multiClickDebounceTime:function(e){if(e)this._private.multiClickDebounceTime=e;else return this._private.multiClickDebounceTime;return this}};vf.centre=vf.center;vf.autolockNodes=vf.autolock;vf.autoungrabifyNodes=vf.autoungrabify;var Cv={data:nn.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeData:nn.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),scratch:nn.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:nn.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0})};Cv.attr=Cv.data;Cv.removeAttr=Cv.removeData;var Ev=function(e){var r=this;e=ar({},e);var n=e.container;n&&!ix(n)&&ix(n[0])&&(n=n[0]);var i=n?n._cyreg:null;i=i||{},i&&i.cy&&(i.cy.destroy(),i={});var a=i.readies=i.readies||[];n&&(n._cyreg=i),i.cy=r;var s=Hi!==void 0&&n!==void 0&&!e.headless,o=e;o.layout=ar({name:s?"grid":"null"},o.layout),o.renderer=ar({name:s?"canvas":"null"},o.renderer);var l=function(y,S,w){return S!==void 0?S:w!==void 0?w:y},u=this._private={container:n,ready:!1,options:o,elements:new za(this),listeners:[],aniEles:new za(this),data:o.data||{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:l(!0,o.zoomingEnabled),userZoomingEnabled:l(!0,o.userZoomingEnabled),panningEnabled:l(!0,o.panningEnabled),userPanningEnabled:l(!0,o.userPanningEnabled),boxSelectionEnabled:l(!0,o.boxSelectionEnabled),autolock:l(!1,o.autolock,o.autolockNodes),autoungrabify:l(!1,o.autoungrabify,o.autoungrabifyNodes),autounselectify:l(!1,o.autounselectify),styleEnabled:o.styleEnabled===void 0?s:o.styleEnabled,zoom:kt(o.zoom)?o.zoom:1,pan:{x:Vr(o.pan)&&kt(o.pan.x)?o.pan.x:0,y:Vr(o.pan)&&kt(o.pan.y)?o.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,multiClickDebounceTime:l(250,o.multiClickDebounceTime)};this.createEmitter(),this.selectionType(o.selectionType),this.zoomRange({min:o.minZoom,max:o.maxZoom});var c=function(y,S){var w=y.some(Bj);if(w)return cm.all(y).then(S);S(y)};u.styleEnabled&&r.setStyle([]);var h=ar({},o,o.renderer);r.initRenderer(h);var p=function(y,S,w){r.notifications(!1);var C=r.mutableElements();C.length>0&&C.remove(),y!=null&&(Vr(y)||Sn(y))&&r.add(y),r.one("layoutready",function(T){r.notifications(!0),r.emit(T),r.one("load",S),r.emitAndNotify("load")}).one("layoutstop",function(){r.one("done",w),r.emit("done")});var _=ar({},r._private.options.layout);_.eles=r.elements(),r.layout(_).run()};c([o.style,o.elements],function(g){var y=g[0],S=g[1];u.styleEnabled&&r.style().append(y),p(S,function(){r.startAnimationLoop(),u.ready=!0,ri(o.ready)&&r.on("ready",o.ready);for(var w=0;w<a.length;w++){var C=a[w];r.on("ready",C)}i&&(i.readies=[]),r.emit("ready")},o.done)})},dx=Ev.prototype;ar(dx,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},destroyed:function(){return this._private.destroyed},ready:function(e){return this.isReady()?this.emitter().emit("ready",[],e):this.on("ready",e),this},destroy:function(){var e=this;if(!e.destroyed())return e.stopAnimationLoop(),e.destroyRenderer(),this.emit("destroy"),e._private.destroyed=!0,e},hasElementWithId:function(e){return this._private.elements.hasElementWithId(e)},getElementById:function(e){return this._private.elements.getElementById(e)},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return this._private.renderer.isHeadless()},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(e){return this._private.elements.merge(e),this},removeFromPool:function(e){return this._private.elements.unmerge(e),this},container:function(){return this._private.container||null},window:function(){var e=this._private.container;if(e==null)return Hi;var r=this._private.container.ownerDocument;return r===void 0||r==null?Hi:r.defaultView||Hi},mount:function(e){if(e!=null){var r=this,n=r._private,i=n.options;return!ix(e)&&ix(e[0])&&(e=e[0]),r.stopAnimationLoop(),r.destroyRenderer(),n.container=e,n.styleEnabled=!0,r.invalidateSize(),r.initRenderer(ar({},i,i.renderer,{name:i.renderer.name==="null"?"canvas":i.renderer.name})),r.startAnimationLoop(),r.style(i.style),r.emit("mount"),r}},unmount:function(){var e=this;return e.stopAnimationLoop(),e.destroyRenderer(),e.initRenderer({name:"null"}),e.emit("unmount"),e},options:function(){return ku(this._private.options)},json:function(e){var r=this,n=r._private,i=r.mutableElements(),a=function(N){return r.getElementById(N.id())};if(Vr(e)){if(r.startBatch(),e.elements){var s={},o=function(N,R){for(var I=[],j=[],O=0;O<N.length;O++){var F=N[O];if(!F.data.id){an("cy.json() cannot handle elements without an ID attribute");continue}var z=""+F.data.id,V=r.getElementById(z);s[z]=!0,V.length!==0?j.push({ele:V,json:F}):(R&&(F.group=R),I.push(F))}r.add(I);for(var q=0;q<j.length;q++){var D=j[q],U=D.ele,G=D.json;U.json(G)}};if(Sn(e.elements))o(e.elements);else for(var l=["nodes","edges"],u=0;u<l.length;u++){var c=l[u],h=e.elements[c];Sn(h)&&o(h,c)}var p=r.collection();i.filter(function(T){return!s[T.id()]}).forEach(function(T){T.isParent()?p.merge(T):T.remove()}),p.forEach(function(T){return T.children().move({parent:null})}),p.forEach(function(T){return a(T).remove()})}e.style&&r.style(e.style),e.zoom!=null&&e.zoom!==n.zoom&&r.zoom(e.zoom),e.pan&&(e.pan.x!==n.pan.x||e.pan.y!==n.pan.y)&&r.pan(e.pan),e.data&&r.data(e.data);for(var g=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify","multiClickDebounceTime"],y=0;y<g.length;y++){var S=g[y];e[S]!=null&&r[S](e[S])}return r.endBatch(),this}else{var w=!!e,C={};w?C.elements=this.elements().map(function(T){return T.json()}):(C.elements={},i.forEach(function(T){var N=T.group();C.elements[N]||(C.elements[N]=[]),C.elements[N].push(T.json())})),this._private.styleEnabled&&(C.style=r.style().json()),C.data=ku(r.data());var _=n.options;return C.zoomingEnabled=n.zoomingEnabled,C.userZoomingEnabled=n.userZoomingEnabled,C.zoom=n.zoom,C.minZoom=n.minZoom,C.maxZoom=n.maxZoom,C.panningEnabled=n.panningEnabled,C.userPanningEnabled=n.userPanningEnabled,C.pan=ku(n.pan),C.boxSelectionEnabled=n.boxSelectionEnabled,C.renderer=ku(_.renderer),C.hideEdgesOnViewport=_.hideEdgesOnViewport,C.textureOnViewport=_.textureOnViewport,C.wheelSensitivity=_.wheelSensitivity,C.motionBlur=_.motionBlur,C.multiClickDebounceTime=_.multiClickDebounceTime,C}}});dx.$id=dx.getElementById;[B7,H7,AA,GS,zy,q7,VS,Uy,Z7,vf,Cv].forEach(function(t){ar(dx,t)});var X7={fit:!0,directed:!1,direction:"downward",padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,depthSort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}},Q7={maximal:!1,acyclic:!1},mp=function(e){return e.scratch("breadthfirst")},NN=function(e,r){return e.scratch("breadthfirst",r)};function LA(t){this.options=ar({},X7,Q7,t)}LA.prototype.run=function(){var t=this.options,e=t.cy,r=t.eles,n=r.nodes().filter(function(_t){return _t.isChildless()}),i=r,a=t.directed,s=t.acyclic||t.maximal||t.maximalAdjustments>0,o=!!t.boundingBox,l=Es(o?t.boundingBox:structuredClone(e.extent())),u;if(vo(t.roots))u=t.roots;else if(Sn(t.roots)){for(var c=[],h=0;h<t.roots.length;h++){var p=t.roots[h],g=e.getElementById(p);c.push(g)}u=e.collection(c)}else if(Zt(t.roots))u=e.$(t.roots);else if(a)u=n.roots();else{var y=r.components();u=e.collection();for(var S=function(){var Xe=y[w],ht=Xe.maxDegree(!1),ct=Xe.filter(function(vt){return vt.degree(!1)===ht});u=u.add(ct)},w=0;w<y.length;w++)S()}var C=[],_={},T=function(Xe,ht){C[ht]==null&&(C[ht]=[]);var ct=C[ht].length;C[ht].push(Xe),NN(Xe,{index:ct,depth:ht})},N=function(Xe,ht){var ct=mp(Xe),vt=ct.depth,lt=ct.index;C[vt][lt]=null,Xe.isChildless()&&T(Xe,ht)};i.bfs({roots:u,directed:t.directed,visit:function(Xe,ht,ct,vt,lt){var Lt=Xe[0],jt=Lt.id();Lt.isChildless()&&T(Lt,lt),_[jt]=!0}});for(var R=[],I=0;I<n.length;I++){var j=n[I];_[j.id()]||R.push(j)}var O=function(Xe){for(var ht=C[Xe],ct=0;ct<ht.length;ct++){var vt=ht[ct];if(vt==null){ht.splice(ct,1),ct--;continue}NN(vt,{depth:Xe,index:ct})}},F=function(Xe,ht){for(var ct=mp(Xe),vt=Xe.incomers().filter(function(at){return at.isNode()&&r.has(at)}),lt=-1,Lt=Xe.id(),jt=0;jt<vt.length;jt++){var Ne=vt[jt],qe=mp(Ne);lt=Math.max(lt,qe.depth)}if(ct.depth<=lt){if(!t.acyclic&&ht[Lt])return null;var bt=lt+1;return N(Xe,bt),ht[Lt]=bt,!0}return!1};if(a&&s){var z=[],V={},q=function(Xe){return z.push(Xe)},D=function(){return z.shift()};for(n.forEach(function(_t){return z.push(_t)});z.length>0;){var U=D(),G=F(U,V);if(G)U.outgoers().filter(function(_t){return _t.isNode()&&r.has(_t)}).forEach(q);else if(G===null){an("Detected double maximal shift for node `"+U.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}var Z=0;if(t.avoidOverlap)for(var K=0;K<n.length;K++){var Q=n[K],ne=Q.layoutDimensions(t),te=ne.w,X=ne.h;Z=Math.max(Z,te,X)}var re={},he=function(Xe){if(re[Xe.id()])return re[Xe.id()];for(var ht=mp(Xe).depth,ct=Xe.neighborhood(),vt=0,lt=0,Lt=0;Lt<ct.length;Lt++){var jt=ct[Lt];if(!(jt.isEdge()||jt.isParent()||!n.has(jt))){var Ne=mp(jt);if(Ne!=null){var qe=Ne.index,bt=Ne.depth;if(!(qe==null||bt==null)){var at=C[bt].length;bt<ht&&(vt+=qe/at,lt++)}}}}return lt=Math.max(1,lt),vt=vt/lt,lt===0&&(vt=0),re[Xe.id()]=vt,vt},oe=function(Xe,ht){var ct=he(Xe),vt=he(ht),lt=ct-vt;return lt===0?RM(Xe.id(),ht.id()):lt};t.depthSort!==void 0&&(oe=t.depthSort);for(var se=C.length,fe=0;fe<se;fe++)C[fe].sort(oe),O(fe);for(var ae=[],pe=0;pe<R.length;pe++)ae.push(R[pe]);var ye=function(){for(var Xe=0;Xe<se;Xe++)O(Xe)};ae.length&&(C.unshift(ae),se=C.length,ye());for(var ve=0,ue=0;ue<se;ue++)ve=Math.max(C[ue].length,ve);var xe={x:l.x1+l.w/2,y:l.y1+l.h/2},Se=n.reduce(function(_t,Xe){return(function(ht){return{w:_t.w===-1?ht.w:(_t.w+ht.w)/2,h:_t.h===-1?ht.h:(_t.h+ht.h)/2}})(Xe.boundingBox({includeLabels:t.nodeDimensionsIncludeLabels}))},{w:-1,h:-1}),Oe=Math.max(se===1?0:o?(l.h-t.padding*2-Se.h)/(se-1):(l.h-t.padding*2-Se.h)/(se+1),Z),Ae=C.reduce(function(_t,Xe){return Math.max(_t,Xe.length)},0),tt=function(Xe){var ht=mp(Xe),ct=ht.depth,vt=ht.index;if(t.circle){var lt=Math.min(l.w/2/se,l.h/2/se);lt=Math.max(lt,Z);var Lt=lt*ct+lt-(se>0&&C[0].length<=3?lt/2:0),jt=2*Math.PI/C[ct].length*vt;return ct===0&&C[0].length===1&&(Lt=1),{x:xe.x+Lt*Math.cos(jt),y:xe.y+Lt*Math.sin(jt)}}else{var Ne=C[ct].length,qe=Math.max(Ne===1?0:o?(l.w-t.padding*2-Se.w)/((t.grid?Ae:Ne)-1):(l.w-t.padding*2-Se.w)/((t.grid?Ae:Ne)+1),Z),bt={x:xe.x+(vt+1-(Ne+1)/2)*qe,y:xe.y+(ct+1-(se+1)/2)*Oe};return bt}},rt={downward:0,leftward:90,upward:180,rightward:-90};Object.keys(rt).indexOf(t.direction)===-1&&Kn("Invalid direction '".concat(t.direction,"' specified for breadthfirst layout. Valid values are: ").concat(Object.keys(rt).join(", ")));var dt=function(Xe){return p9(tt(Xe),l,rt[t.direction])};return r.nodes().layoutPositions(this,t,dt),this};var J7={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function RA(t){this.options=ar({},J7,t)}RA.prototype.run=function(){var t=this.options,e=t,r=t.cy,n=e.eles,i=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,a=n.nodes().not(":parent");e.sort&&(a=a.sort(e.sort));for(var s=Es(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=e.sweep===void 0?2*Math.PI-2*Math.PI/a.length:e.sweep,u=l/Math.max(1,a.length-1),c,h=0,p=0;p<a.length;p++){var g=a[p],y=g.layoutDimensions(e),S=y.w,w=y.h;h=Math.max(h,S,w)}if(kt(e.radius)?c=e.radius:a.length<=1?c=0:c=Math.min(s.h,s.w)/2-h,a.length>1&&e.avoidOverlap){h*=1.75;var C=Math.cos(u)-Math.cos(0),_=Math.sin(u)-Math.sin(0),T=Math.sqrt(h*h/(C*C+_*_));c=Math.max(T,c)}var N=function(I,j){var O=e.startAngle+j*u*(i?1:-1),F=c*Math.cos(O),z=c*Math.sin(O),V={x:o.x+F,y:o.y+z};return V};return n.nodes().layoutPositions(this,e,N),this};var ez={fit:!0,padding:30,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function(e){return e.degree()},levelWidth:function(e){return e.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function OA(t){this.options=ar({},ez,t)}OA.prototype.run=function(){for(var t=this.options,e=t,r=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,n=t.cy,i=e.eles,a=i.nodes().not(":parent"),s=Es(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:n.width(),h:n.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=[],u=0,c=0;c<a.length;c++){var h=a[c],p=void 0;p=e.concentric(h),l.push({value:p,node:h}),h._private.scratch.concentric=p}a.updateStyle();for(var g=0;g<a.length;g++){var y=a[g],S=y.layoutDimensions(e);u=Math.max(u,S.w,S.h)}l.sort(function(Oe,Ae){return Ae.value-Oe.value});for(var w=e.levelWidth(a),C=[[]],_=C[0],T=0;T<l.length;T++){var N=l[T];if(_.length>0){var R=Math.abs(_[0].value-N.value);R>=w&&(_=[],C.push(_))}_.push(N)}var I=u+e.minNodeSpacing;if(!e.avoidOverlap){var j=C.length>0&&C[0].length>1,O=Math.min(s.w,s.h)/2-I,F=O/(C.length+j?1:0);I=Math.min(I,F)}for(var z=0,V=0;V<C.length;V++){var q=C[V],D=e.sweep===void 0?2*Math.PI-2*Math.PI/q.length:e.sweep,U=q.dTheta=D/Math.max(1,q.length-1);if(q.length>1&&e.avoidOverlap){var G=Math.cos(U)-Math.cos(0),Z=Math.sin(U)-Math.sin(0),K=Math.sqrt(I*I/(G*G+Z*Z));z=Math.max(K,z)}q.r=z,z+=I}if(e.equidistant){for(var Q=0,ne=0,te=0;te<C.length;te++){var X=C[te],re=X.r-ne;Q=Math.max(Q,re)}ne=0;for(var he=0;he<C.length;he++){var oe=C[he];he===0&&(ne=oe.r),oe.r=ne,ne+=Q}}for(var se={},fe=0;fe<C.length;fe++)for(var ae=C[fe],pe=ae.dTheta,ye=ae.r,ve=0;ve<ae.length;ve++){var ue=ae[ve],xe=e.startAngle+(r?1:-1)*pe*ve,Se={x:o.x+ye*Math.cos(xe),y:o.y+ye*Math.sin(xe)};se[ue.node.id()]=Se}return i.nodes().layoutPositions(this,e,function(Oe){var Ae=Oe.id();return se[Ae]}),this};var c2,tz={ready:function(){},stop:function(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function(e,r){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function(e){return 2048},nodeOverlap:4,idealEdgeLength:function(e){return 32},edgeElasticity:function(e){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function D1(t){this.options=ar({},tz,t),this.options.layout=this;var e=this.options.eles.nodes(),r=this.options.eles.edges(),n=r.filter(function(i){var a=i.source().data("id"),s=i.target().data("id"),o=e.some(function(u){return u.data("id")===a}),l=e.some(function(u){return u.data("id")===s});return!o||!l});this.options.eles=this.options.eles.not(n)}D1.prototype.run=function(){var t=this.options,e=t.cy,r=this;r.stopped=!1,(t.animate===!0||t.animate===!1)&&r.emit({type:"layoutstart",layout:r}),t.debug===!0?c2=!0:c2=!1;var n=rz(e,r,t);c2&&iz(n),t.randomize&&az(n);var i=vc(),a=function(){sz(n,e,t),t.fit===!0&&e.fit(t.padding)},s=function(p){return!(r.stopped||p>=t.numIter||(oz(n,t),n.temperature=n.temperature*t.coolingFactor,n.temperature<t.minTemp))},o=function(){if(t.animate===!0||t.animate===!1)a(),r.one("layoutstop",t.stop),r.emit({type:"layoutstop",layout:r});else{var p=t.eles.nodes(),g=IA(n,t,p);p.layoutPositions(r,t,g)}},l=0,u=!0;if(t.animate===!0){var c=function(){for(var p=0;u&&p<t.refresh;)u=s(l),l++,p++;if(!u)MN(n,t),o();else{var g=vc();g-i>=t.animationThreshold&&a(),ax(c)}};c()}else{for(;u;)u=s(l),l++;MN(n,t),o()}return this};D1.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this};D1.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var rz=function(e,r,n){for(var i=n.eles.edges(),a=n.eles.nodes(),s=Es(n.boundingBox?n.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),o={isCompound:e.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:a.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:i.size(),temperature:n.initialTemp,clientWidth:s.w,clientHeight:s.h,boundingBox:s},l=n.eles.components(),u={},c=0;c<l.length;c++)for(var h=l[c],p=0;p<h.length;p++){var g=h[p];u[g.id()]=c}for(var c=0;c<o.nodeSize;c++){var y=a[c],S=y.layoutDimensions(n),w={};w.isLocked=y.locked(),w.id=y.data("id"),w.parentId=y.data("parent"),w.cmptId=u[y.id()],w.children=[],w.positionX=y.position("x"),w.positionY=y.position("y"),w.offsetX=0,w.offsetY=0,w.height=S.w,w.width=S.h,w.maxX=w.positionX+w.width/2,w.minX=w.positionX-w.width/2,w.maxY=w.positionY+w.height/2,w.minY=w.positionY-w.height/2,w.padLeft=parseFloat(y.style("padding")),w.padRight=parseFloat(y.style("padding")),w.padTop=parseFloat(y.style("padding")),w.padBottom=parseFloat(y.style("padding")),w.nodeRepulsion=ri(n.nodeRepulsion)?n.nodeRepulsion(y):n.nodeRepulsion,o.layoutNodes.push(w),o.idToIndex[w.id]=c}for(var C=[],_=0,T=-1,N=[],c=0;c<o.nodeSize;c++){var y=o.layoutNodes[c],R=y.parentId;R!=null?o.layoutNodes[o.idToIndex[R]].children.push(y.id):(C[++T]=y.id,N.push(y.id))}for(o.graphSet.push(N);_<=T;){var I=C[_++],j=o.idToIndex[I],g=o.layoutNodes[j],O=g.children;if(O.length>0){o.graphSet.push(O);for(var c=0;c<O.length;c++)C[++T]=O[c]}}for(var c=0;c<o.graphSet.length;c++)for(var F=o.graphSet[c],p=0;p<F.length;p++){var z=o.idToIndex[F[p]];o.indexToGraph[z]=c}for(var c=0;c<o.edgeSize;c++){var V=i[c],q={};q.id=V.data("id"),q.sourceId=V.data("source"),q.targetId=V.data("target");var D=ri(n.idealEdgeLength)?n.idealEdgeLength(V):n.idealEdgeLength,U=ri(n.edgeElasticity)?n.edgeElasticity(V):n.edgeElasticity,G=o.idToIndex[q.sourceId],Z=o.idToIndex[q.targetId],K=o.indexToGraph[G],Q=o.indexToGraph[Z];if(K!=Q){for(var ne=nz(q.sourceId,q.targetId,o),te=o.graphSet[ne],X=0,w=o.layoutNodes[G];te.indexOf(w.id)===-1;)w=o.layoutNodes[o.idToIndex[w.parentId]],X++;for(w=o.layoutNodes[Z];te.indexOf(w.id)===-1;)w=o.layoutNodes[o.idToIndex[w.parentId]],X++;D*=X*n.nestingFactor}q.idealLength=D,q.elasticity=U,o.layoutEdges.push(q)}return o},nz=function(e,r,n){var i=DA(e,r,0,n);return 2>i.count?0:i.graph},DA=function(e,r,n,i){var a=i.graphSet[n];if(-1<a.indexOf(e)&&-1<a.indexOf(r))return{count:2,graph:n};for(var s=0,o=0;o<a.length;o++){var l=a[o],u=i.idToIndex[l],c=i.layoutNodes[u].children;if(c.length!==0){var h=i.indexToGraph[i.idToIndex[c[0]]],p=DA(e,r,h,i);if(p.count!==0)if(p.count===1){if(s++,s===2)break}else return p}}return{count:s,graph:n}},iz,az=function(e,r){for(var n=e.clientWidth,i=e.clientHeight,a=0;a<e.nodeSize;a++){var s=e.layoutNodes[a];s.children.length===0&&!s.isLocked&&(s.positionX=Math.random()*n,s.positionY=Math.random()*i)}},IA=function(e,r,n){var i=e.boundingBox,a={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return r.boundingBox&&(n.forEach(function(s){var o=e.layoutNodes[e.idToIndex[s.data("id")]];a.x1=Math.min(a.x1,o.positionX),a.x2=Math.max(a.x2,o.positionX),a.y1=Math.min(a.y1,o.positionY),a.y2=Math.max(a.y2,o.positionY)}),a.w=a.x2-a.x1,a.h=a.y2-a.y1),function(s,o){var l=e.layoutNodes[e.idToIndex[s.data("id")]];if(r.boundingBox){var u=a.w===0?.5:(l.positionX-a.x1)/a.w,c=a.h===0?.5:(l.positionY-a.y1)/a.h;return{x:i.x1+u*i.w,y:i.y1+c*i.h}}else return{x:l.positionX,y:l.positionY}}},sz=function(e,r,n){var i=n.layout,a=n.eles.nodes(),s=IA(e,n,a);a.positions(s),e.ready!==!0&&(e.ready=!0,i.one("layoutready",n.ready),i.emit({type:"layoutready",layout:this}))},oz=function(e,r,n){lz(e,r),dz(e),hz(e,r),fz(e),pz(e)},lz=function(e,r){for(var n=0;n<e.graphSet.length;n++)for(var i=e.graphSet[n],a=i.length,s=0;s<a;s++)for(var o=e.layoutNodes[e.idToIndex[i[s]]],l=s+1;l<a;l++){var u=e.layoutNodes[e.idToIndex[i[l]]];uz(o,u,e,r)}},PN=function(e){return-1+2*e*Math.random()},uz=function(e,r,n,i){var a=e.cmptId,s=r.cmptId;if(!(a!==s&&!n.isCompound)){var o=r.positionX-e.positionX,l=r.positionY-e.positionY,u=1;o===0&&l===0&&(o=PN(u),l=PN(u));var c=cz(e,r,o,l);if(c>0)var h=i.nodeOverlap*c,p=Math.sqrt(o*o+l*l),g=h*o/p,y=h*l/p;else var S=hx(e,o,l),w=hx(r,-1*o,-1*l),C=w.x-S.x,_=w.y-S.y,T=C*C+_*_,p=Math.sqrt(T),h=(e.nodeRepulsion+r.nodeRepulsion)/T,g=h*C/p,y=h*_/p;e.isLocked||(e.offsetX-=g,e.offsetY-=y),r.isLocked||(r.offsetX+=g,r.offsetY+=y)}},cz=function(e,r,n,i){if(n>0)var a=e.maxX-r.minX;else var a=r.maxX-e.minX;if(i>0)var s=e.maxY-r.minY;else var s=r.maxY-e.minY;return a>=0&&s>=0?Math.sqrt(a*a+s*s):0},hx=function(e,r,n){var i=e.positionX,a=e.positionY,s=e.height||1,o=e.width||1,l=n/r,u=s/o,c={};return r===0&&0<n||r===0&&0>n?(c.x=i,c.y=a+s/2,c):0<r&&-1*u<=l&&l<=u?(c.x=i+o/2,c.y=a+o*n/2/r,c):0>r&&-1*u<=l&&l<=u?(c.x=i-o/2,c.y=a-o*n/2/r,c):0<n&&(l<=-1*u||l>=u)?(c.x=i+s*r/2/n,c.y=a+s/2,c):(0>n&&(l<=-1*u||l>=u)&&(c.x=i-s*r/2/n,c.y=a-s/2),c)},dz=function(e,r){for(var n=0;n<e.edgeSize;n++){var i=e.layoutEdges[n],a=e.idToIndex[i.sourceId],s=e.layoutNodes[a],o=e.idToIndex[i.targetId],l=e.layoutNodes[o],u=l.positionX-s.positionX,c=l.positionY-s.positionY;if(!(u===0&&c===0)){var h=hx(s,u,c),p=hx(l,-1*u,-1*c),g=p.x-h.x,y=p.y-h.y,S=Math.sqrt(g*g+y*y),w=Math.pow(i.idealLength-S,2)/i.elasticity;if(S!==0)var C=w*g/S,_=w*y/S;else var C=0,_=0;s.isLocked||(s.offsetX+=C,s.offsetY+=_),l.isLocked||(l.offsetX-=C,l.offsetY-=_)}}},hz=function(e,r){if(r.gravity!==0)for(var n=1,i=0;i<e.graphSet.length;i++){var a=e.graphSet[i],s=a.length;if(i===0)var o=e.clientHeight/2,l=e.clientWidth/2;else var u=e.layoutNodes[e.idToIndex[a[0]]],c=e.layoutNodes[e.idToIndex[u.parentId]],o=c.positionX,l=c.positionY;for(var h=0;h<s;h++){var p=e.layoutNodes[e.idToIndex[a[h]]];if(!p.isLocked){var g=o-p.positionX,y=l-p.positionY,S=Math.sqrt(g*g+y*y);if(S>n){var w=r.gravity*g/S,C=r.gravity*y/S;p.offsetX+=w,p.offsetY+=C}}}}},fz=function(e,r){var n=[],i=0,a=-1;for(n.push.apply(n,e.graphSet[0]),a+=e.graphSet[0].length;i<=a;){var s=n[i++],o=e.idToIndex[s],l=e.layoutNodes[o],u=l.children;if(0<u.length&&!l.isLocked){for(var c=l.offsetX,h=l.offsetY,p=0;p<u.length;p++){var g=e.layoutNodes[e.idToIndex[u[p]]];g.offsetX+=c,g.offsetY+=h,n[++a]=u[p]}l.offsetX=0,l.offsetY=0}}},pz=function(e,r){for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];0<i.children.length&&(i.maxX=void 0,i.minX=void 0,i.maxY=void 0,i.minY=void 0)}for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];if(!(0<i.children.length||i.isLocked)){var a=mz(i.offsetX,i.offsetY,e.temperature);i.positionX+=a.x,i.positionY+=a.y,i.offsetX=0,i.offsetY=0,i.minX=i.positionX-i.width,i.maxX=i.positionX+i.width,i.minY=i.positionY-i.height,i.maxY=i.positionY+i.height,jA(i,e)}}for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];0<i.children.length&&!i.isLocked&&(i.positionX=(i.maxX+i.minX)/2,i.positionY=(i.maxY+i.minY)/2,i.width=i.maxX-i.minX,i.height=i.maxY-i.minY)}},mz=function(e,r,n){var i=Math.sqrt(e*e+r*r);if(i>n)var a={x:n*e/i,y:n*r/i};else var a={x:e,y:r};return a},jA=function(e,r){var n=e.parentId;if(n!=null){var i=r.layoutNodes[r.idToIndex[n]],a=!1;if((i.maxX==null||e.maxX+i.padRight>i.maxX)&&(i.maxX=e.maxX+i.padRight,a=!0),(i.minX==null||e.minX-i.padLeft<i.minX)&&(i.minX=e.minX-i.padLeft,a=!0),(i.maxY==null||e.maxY+i.padBottom>i.maxY)&&(i.maxY=e.maxY+i.padBottom,a=!0),(i.minY==null||e.minY-i.padTop<i.minY)&&(i.minY=e.minY-i.padTop,a=!0),a)return jA(i,r)}},MN=function(e,r){for(var n=e.layoutNodes,i=[],a=0;a<n.length;a++){var s=n[a],o=s.cmptId,l=i[o]=i[o]||[];l.push(s)}for(var u=0,a=0;a<i.length;a++){var c=i[a];if(c){c.x1=1/0,c.x2=-1/0,c.y1=1/0,c.y2=-1/0;for(var h=0;h<c.length;h++){var p=c[h];c.x1=Math.min(c.x1,p.positionX-p.width/2),c.x2=Math.max(c.x2,p.positionX+p.width/2),c.y1=Math.min(c.y1,p.positionY-p.height/2),c.y2=Math.max(c.y2,p.positionY+p.height/2)}c.w=c.x2-c.x1,c.h=c.y2-c.y1,u+=c.w*c.h}}i.sort(function(_,T){return T.w*T.h-_.w*_.h});for(var g=0,y=0,S=0,w=0,C=Math.sqrt(u)*e.clientWidth/e.clientHeight,a=0;a<i.length;a++){var c=i[a];if(c){for(var h=0;h<c.length;h++){var p=c[h];p.isLocked||(p.positionX+=g-c.x1,p.positionY+=y-c.y1)}g+=c.w+r.componentSpacing,S+=c.w+r.componentSpacing,w=Math.max(w,c.h),S>C&&(y+=w+r.componentSpacing,g=0,S=0,w=0)}}},gz={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function(e){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function FA(t){this.options=ar({},gz,t)}FA.prototype.run=function(){var t=this.options,e=t,r=t.cy,n=e.eles,i=n.nodes().not(":parent");e.sort&&(i=i.sort(e.sort));var a=Es(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()});if(a.h===0||a.w===0)n.nodes().layoutPositions(this,e,function(he){return{x:a.x1,y:a.y1}});else{var s=i.size(),o=Math.sqrt(s*a.h/a.w),l=Math.round(o),u=Math.round(a.w/a.h*o),c=function(oe){if(oe==null)return Math.min(l,u);var se=Math.min(l,u);se==l?l=oe:u=oe},h=function(oe){if(oe==null)return Math.max(l,u);var se=Math.max(l,u);se==l?l=oe:u=oe},p=e.rows,g=e.cols!=null?e.cols:e.columns;if(p!=null&&g!=null)l=p,u=g;else if(p!=null&&g==null)l=p,u=Math.ceil(s/l);else if(p==null&&g!=null)u=g,l=Math.ceil(s/u);else if(u*l>s){var y=c(),S=h();(y-1)*S>=s?c(y-1):(S-1)*y>=s&&h(S-1)}else for(;u*l<s;){var w=c(),C=h();(C+1)*w>=s?h(C+1):c(w+1)}var _=a.w/u,T=a.h/l;if(e.condense&&(_=0,T=0),e.avoidOverlap)for(var N=0;N<i.length;N++){var R=i[N],I=R._private.position;(I.x==null||I.y==null)&&(I.x=0,I.y=0);var j=R.layoutDimensions(e),O=e.avoidOverlapPadding,F=j.w+O,z=j.h+O;_=Math.max(_,F),T=Math.max(T,z)}for(var V={},q=function(oe,se){return!!V["c-"+oe+"-"+se]},D=function(oe,se){V["c-"+oe+"-"+se]=!0},U=0,G=0,Z=function(){G++,G>=u&&(G=0,U++)},K={},Q=0;Q<i.length;Q++){var ne=i[Q],te=e.position(ne);if(te&&(te.row!==void 0||te.col!==void 0)){var X={row:te.row,col:te.col};if(X.col===void 0)for(X.col=0;q(X.row,X.col);)X.col++;else if(X.row===void 0)for(X.row=0;q(X.row,X.col);)X.row++;K[ne.id()]=X,D(X.row,X.col)}}var re=function(oe,se){var fe,ae;if(oe.locked()||oe.isParent())return!1;var pe=K[oe.id()];if(pe)fe=pe.col*_+_/2+a.x1,ae=pe.row*T+T/2+a.y1;else{for(;q(U,G);)Z();fe=G*_+_/2+a.x1,ae=U*T+T/2+a.y1,D(U,G),Z()}return{x:fe,y:ae}};i.layoutPositions(this,e,re)}return this};var vz={ready:function(){},stop:function(){}};function m_(t){this.options=ar({},vz,t)}m_.prototype.run=function(){var t=this.options,e=t.eles,r=this;return t.cy,r.emit("layoutstart"),e.nodes().positions(function(){return{x:0,y:0}}),r.one("layoutready",t.ready),r.emit("layoutready"),r.one("layoutstop",t.stop),r.emit("layoutstop"),this};m_.prototype.stop=function(){return this};var yz={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,spacingFactor:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function BA(t){this.options=ar({},yz,t)}BA.prototype.run=function(){var t=this.options,e=t.eles,r=e.nodes(),n=ri(t.positions);function i(a){if(t.positions==null)return z9(a.position());if(n)return t.positions(a);var s=t.positions[a._private.data.id];return s??null}return r.layoutPositions(this,t,function(a,s){var o=i(a);return a.locked()||o==null?!1:o}),this};var xz={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function zA(t){this.options=ar({},xz,t)}zA.prototype.run=function(){var t=this.options,e=t.cy,r=t.eles,n=Es(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),i=function(s,o){return{x:n.x1+Math.round(Math.random()*n.w),y:n.y1+Math.round(Math.random()*n.h)}};return r.nodes().layoutPositions(this,t,i),this};var bz=[{name:"breadthfirst",impl:LA},{name:"circle",impl:RA},{name:"concentric",impl:OA},{name:"cose",impl:D1},{name:"grid",impl:FA},{name:"null",impl:m_},{name:"preset",impl:BA},{name:"random",impl:zA}];function UA(t){this.options=t,this.notifications=0}var AN=function(){},LN=function(){throw new Error("A headless instance can not render images")};UA.prototype={recalculateRenderedStyle:AN,notify:function(){this.notifications++},init:AN,isHeadless:function(){return!0},png:LN,jpg:LN};var g_={};g_.arrowShapeWidth=.3;g_.registerArrowShapes=function(){var t=this.arrowShapes={},e=this,r=function(u,c,h,p,g,y,S){var w=g.x-h/2-S,C=g.x+h/2+S,_=g.y-h/2-S,T=g.y+h/2+S,N=w<=u&&u<=C&&_<=c&&c<=T;return N},n=function(u,c,h,p,g){var y=u*Math.cos(p)-c*Math.sin(p),S=u*Math.sin(p)+c*Math.cos(p),w=y*h,C=S*h,_=w+g.x,T=C+g.y;return{x:_,y:T}},i=function(u,c,h,p){for(var g=[],y=0;y<u.length;y+=2){var S=u[y],w=u[y+1];g.push(n(S,w,c,h,p))}return g},a=function(u){for(var c=[],h=0;h<u.length;h++){var p=u[h];c.push(p.x,p.y)}return c},s=function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").pfValue*2},o=function(u,c){Zt(c)&&(c=t[c]),t[u]=ar({name:u,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(p,g,y,S,w,C){var _=a(i(this.points,y+2*C,S,w)),T=Ks(p,g,_);return T},roughCollide:r,draw:function(p,g,y,S){var w=i(this.points,g,y,S);e.arrowShapeImpl("polygon")(p,w)},spacing:function(p){return 0},gap:s},c)};o("none",{collide:sx,roughCollide:sx,draw:t_,spacing:qE,gap:qE}),o("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),o("arrow","triangle"),o("triangle-backcurve",{points:t.triangle.points,controlPoint:[0,-.15],roughCollide:r,draw:function(u,c,h,p,g){var y=i(this.points,c,h,p),S=this.controlPoint,w=n(S[0],S[1],c,h,p);e.arrowShapeImpl(this.name)(u,y,w)},gap:function(u){return s(u)*.8}}),o("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(u,c,h,p,g,y,S){var w=a(i(this.points,h+2*S,p,g)),C=a(i(this.pointsTee,h+2*S,p,g)),_=Ks(u,c,w)||Ks(u,c,C);return _},draw:function(u,c,h,p,g){var y=i(this.points,c,h,p),S=i(this.pointsTee,c,h,p);e.arrowShapeImpl(this.name)(u,y,S)}}),o("circle-triangle",{radius:.15,pointsTr:[0,-.15,.15,-.45,-.15,-.45,0,-.15],collide:function(u,c,h,p,g,y,S){var w=g,C=Math.pow(w.x-u,2)+Math.pow(w.y-c,2)<=Math.pow((h+2*S)*this.radius,2),_=a(i(this.points,h+2*S,p,g));return Ks(u,c,_)||C},draw:function(u,c,h,p,g){var y=i(this.pointsTr,c,h,p);e.arrowShapeImpl(this.name)(u,y,p.x,p.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function(u,c){var h=this.baseCrossLinePts.slice(),p=c/u,g=3,y=5;return h[g]=h[g]-p,h[y]=h[y]-p,h},collide:function(u,c,h,p,g,y,S){var w=a(i(this.points,h+2*S,p,g)),C=a(i(this.crossLinePts(h,y),h+2*S,p,g)),_=Ks(u,c,w)||Ks(u,c,C);return _},draw:function(u,c,h,p,g){var y=i(this.points,c,h,p),S=i(this.crossLinePts(c,g),c,h,p);e.arrowShapeImpl(this.name)(u,y,S)}}),o("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(u){return s(u)*.525}}),o("circle",{radius:.15,collide:function(u,c,h,p,g,y,S){var w=g,C=Math.pow(w.x-u,2)+Math.pow(w.y-c,2)<=Math.pow((h+2*S)*this.radius,2);return C},draw:function(u,c,h,p,g){e.arrowShapeImpl(this.name)(u,p.x,p.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(u){return 1},gap:function(u){return 1}}),o("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),o("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}}),o("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function(u){return .95*u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}})};var Pf={};Pf.projectIntoViewport=function(t,e){var r=this.cy,n=this.findContainerClientCoords(),i=n[0],a=n[1],s=n[4],o=r.pan(),l=r.zoom(),u=((t-i)/s-o.x)/l,c=((e-a)/s-o.y)/l;return[u,c]};Pf.findContainerClientCoords=function(){if(this.containerBB)return this.containerBB;var t=this.container,e=t.getBoundingClientRect(),r=this.cy.window().getComputedStyle(t),n=function(C){return parseFloat(r.getPropertyValue(C))},i={left:n("padding-left"),right:n("padding-right"),top:n("padding-top"),bottom:n("padding-bottom")},a={left:n("border-left-width"),right:n("border-right-width"),top:n("border-top-width"),bottom:n("border-bottom-width")},s=t.clientWidth,o=t.clientHeight,l=i.left+i.right,u=i.top+i.bottom,c=a.left+a.right,h=e.width/(s+c),p=s-l,g=o-u,y=e.left+i.left+a.left,S=e.top+i.top+a.top;return this.containerBB=[y,S,p,g,h]};Pf.invalidateContainerClientCoordsCache=function(){this.containerBB=null};Pf.findNearestElement=function(t,e,r,n){return this.findNearestElements(t,e,r,n)[0]};Pf.findNearestElements=function(t,e,r,n){var i=this,a=this,s=a.getCachedZSortedEles(),o=[],l=a.cy.zoom(),u=a.cy.hasCompoundNodes(),c=(n?24:8)/l,h=(n?8:2)/l,p=(n?8:2)/l,g=1/0,y,S;r&&(s=s.interactive);function w(j,O){if(j.isNode()){if(S)return;S=j,o.push(j)}if(j.isEdge()&&(O==null||O<g))if(y){if(y.pstyle("z-compound-depth").value===j.pstyle("z-compound-depth").value&&y.pstyle("z-compound-depth").value===j.pstyle("z-compound-depth").value){for(var F=0;F<o.length;F++)if(o[F].isEdge()){o[F]=j,y=j,g=O??g;break}}}else o.push(j),y=j,g=O??g}function C(j){var O=j.outerWidth()+2*h,F=j.outerHeight()+2*h,z=O/2,V=F/2,q=j.position(),D=j.pstyle("corner-radius").value==="auto"?"auto":j.pstyle("corner-radius").pfValue,U=j._private.rscratch;if(q.x-z<=t&&t<=q.x+z&&q.y-V<=e&&e<=q.y+V){var G=a.nodeShapes[i.getNodeShape(j)];if(G.checkPoint(t,e,0,O,F,q.x,q.y,D,U))return w(j,0),!0}}function _(j){var O=j._private,F=O.rscratch,z=j.pstyle("width").pfValue,V=j.pstyle("arrow-scale").value,q=z/2+c,D=q*q,U=q*2,Q=O.source,ne=O.target,G;if(F.edgeType==="segments"||F.edgeType==="straight"||F.edgeType==="haystack"){for(var Z=F.allpts,K=0;K+3<Z.length;K+=2)if(eF(t,e,Z[K],Z[K+1],Z[K+2],Z[K+3],U)&&D>(G=aF(t,e,Z[K],Z[K+1],Z[K+2],Z[K+3])))return w(j,G),!0}else if(F.edgeType==="bezier"||F.edgeType==="multibezier"||F.edgeType==="self"||F.edgeType==="compound"){for(var Z=F.allpts,K=0;K+5<F.allpts.length;K+=4)if(tF(t,e,Z[K],Z[K+1],Z[K+2],Z[K+3],Z[K+4],Z[K+5],U)&&D>(G=iF(t,e,Z[K],Z[K+1],Z[K+2],Z[K+3],Z[K+4],Z[K+5])))return w(j,G),!0}for(var Q=Q||O.source,ne=ne||O.target,te=i.getArrowWidth(z,V),X=[{name:"source",x:F.arrowStartX,y:F.arrowStartY,angle:F.srcArrowAngle},{name:"target",x:F.arrowEndX,y:F.arrowEndY,angle:F.tgtArrowAngle},{name:"mid-source",x:F.midX,y:F.midY,angle:F.midsrcArrowAngle},{name:"mid-target",x:F.midX,y:F.midY,angle:F.midtgtArrowAngle}],K=0;K<X.length;K++){var re=X[K],he=a.arrowShapes[j.pstyle(re.name+"-arrow-shape").value],oe=j.pstyle("width").pfValue;if(he.roughCollide(t,e,te,re.angle,{x:re.x,y:re.y},oe,c)&&he.collide(t,e,te,re.angle,{x:re.x,y:re.y},oe,c))return w(j),!0}u&&o.length>0&&(C(Q),C(ne))}function T(j,O,F){return $s(j,O,F)}function N(j,O){var F=j._private,z=p,V;O?V=O+"-":V="",j.boundingBox();var q=F.labelBounds[O||"main"],D=j.pstyle(V+"label").value,U=j.pstyle("text-events").strValue==="yes";if(!(!U||!D)){var G=T(F.rscratch,"labelX",O),Z=T(F.rscratch,"labelY",O),K=T(F.rscratch,"labelAngle",O),Q=j.pstyle(V+"text-margin-x").pfValue,ne=j.pstyle(V+"text-margin-y").pfValue,te=q.x1-z-Q,X=q.x2+z-Q,re=q.y1-z-ne,he=q.y2+z-ne;if(K){var oe=Math.cos(K),se=Math.sin(K),fe=function(Se,Oe){return Se=Se-G,Oe=Oe-Z,{x:Se*oe-Oe*se+G,y:Se*se+Oe*oe+Z}},ae=fe(te,re),pe=fe(te,he),ye=fe(X,re),ve=fe(X,he),ue=[ae.x+Q,ae.y+ne,ye.x+Q,ye.y+ne,ve.x+Q,ve.y+ne,pe.x+Q,pe.y+ne];if(Ks(t,e,ue))return w(j),!0}else if(Od(q,t,e))return w(j),!0}}for(var R=s.length-1;R>=0;R--){var I=s[R];I.isNode()?C(I)||N(I):_(I)||N(I)||N(I,"source")||N(I,"target")}return o};Pf.getAllInBox=function(t,e,r,n){var i=this.getCachedZSortedEles().interactive,a=this.cy.zoom(),s=2/a,o=[],l=Math.min(t,r),u=Math.max(t,r),c=Math.min(e,n),h=Math.max(e,n);t=l,r=u,e=c,n=h;var p=Es({x1:t,y1:e,x2:r,y2:n}),g=[{x:p.x1,y:p.y1},{x:p.x2,y:p.y1},{x:p.x2,y:p.y2},{x:p.x1,y:p.y2}],y=[[g[0],g[1]],[g[1],g[2]],[g[2],g[3]],[g[3],g[0]]];function S(Se,Oe,Ae){return $s(Se,Oe,Ae)}function w(Se,Oe){var Ae=Se._private,tt=s,rt="";Se.boundingBox();var dt=Ae.labelBounds.main;if(!dt)return null;var _t=S(Ae.rscratch,"labelX",Oe),Xe=S(Ae.rscratch,"labelY",Oe),ht=S(Ae.rscratch,"labelAngle",Oe),ct=Se.pstyle(rt+"text-margin-x").pfValue,vt=Se.pstyle(rt+"text-margin-y").pfValue,lt=dt.x1-tt-ct,Lt=dt.x2+tt-ct,jt=dt.y1-tt-vt,Ne=dt.y2+tt-vt;if(ht){var qe=Math.cos(ht),bt=Math.sin(ht),at=function(Fe,de){return Fe=Fe-_t,de=de-Xe,{x:Fe*qe-de*bt+_t,y:Fe*bt+de*qe+Xe}};return[at(lt,jt),at(Lt,jt),at(Lt,Ne),at(lt,Ne)]}else return[{x:lt,y:jt},{x:Lt,y:jt},{x:Lt,y:Ne},{x:lt,y:Ne}]}function C(Se,Oe,Ae,tt){function rt(dt,_t,Xe){return(Xe.y-dt.y)*(_t.x-dt.x)>(_t.y-dt.y)*(Xe.x-dt.x)}return rt(Se,Ae,tt)!==rt(Oe,Ae,tt)&&rt(Se,Oe,Ae)!==rt(Se,Oe,tt)}for(var _=0;_<i.length;_++){var T=i[_];if(T.isNode()){var N=T,R=N.pstyle("text-events").strValue==="yes",I=N.pstyle("box-selection").strValue,j=N.pstyle("box-select-labels").strValue==="yes";if(I==="none")continue;var O=(I==="overlap"||j)&&R,F=N.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:O});if(I==="contain"){var z=!1;if(j&&R){var V=w(N);V&&lw(V,g)&&(o.push(N),z=!0)}!z&&KM(p,F)&&o.push(N)}else if(I==="overlap"&&a_(p,F)){var q=N.boundingBox({includeNodes:!0,includeEdges:!0,includeLabels:!1,includeMainLabels:!1,includeSourceLabels:!1,includeTargetLabels:!1}),D=[{x:q.x1,y:q.y1},{x:q.x2,y:q.y1},{x:q.x2,y:q.y2},{x:q.x1,y:q.y2}];if(lw(D,g))o.push(N);else{var U=w(N);U&&lw(U,g)&&o.push(N)}}}else{var G=T,Z=G._private,K=Z.rscratch,Q=G.pstyle("box-selection").strValue;if(Q==="none")continue;if(Q==="contain"){if(K.startX!=null&&K.startY!=null&&!Od(p,K.startX,K.startY)||K.endX!=null&&K.endY!=null&&!Od(p,K.endX,K.endY))continue;if(K.edgeType==="bezier"||K.edgeType==="multibezier"||K.edgeType==="self"||K.edgeType==="compound"||K.edgeType==="segments"||K.edgeType==="haystack"){for(var ne=Z.rstyle.bezierPts||Z.rstyle.linePts||Z.rstyle.haystackPts,te=!0,X=0;X<ne.length;X++)if(!XE(p,ne[X])){te=!1;break}te&&o.push(G)}else K.edgeType==="straight"&&o.push(G)}else if(Q==="overlap"){var re=!1;if(K.startX!=null&&K.startY!=null&&K.endX!=null&&K.endY!=null&&(Od(p,K.startX,K.startY)||Od(p,K.endX,K.endY)))o.push(G),re=!0;else if(!re&&K.edgeType==="haystack"){for(var he=Z.rstyle.haystackPts,oe=0;oe<he.length;oe++)if(XE(p,he[oe])){o.push(G),re=!0;break}}if(!re){var se=Z.rstyle.bezierPts||Z.rstyle.linePts||Z.rstyle.haystackPts;if((!se||se.length<2)&&K.edgeType==="straight"&&K.startX!=null&&K.startY!=null&&K.endX!=null&&K.endY!=null&&(se=[{x:K.startX,y:K.startY},{x:K.endX,y:K.endY}]),!se||se.length<2)continue;for(var fe=0;fe<se.length-1;fe++){for(var ae=se[fe],pe=se[fe+1],ye=0;ye<y.length;ye++){var ve=Di(y[ye],2),ue=ve[0],xe=ve[1];if(C(ae,pe,ue,xe)){o.push(G),re=!0;break}}if(re)break}}}}}return o};var fx={};fx.calculateArrowAngles=function(t){var e=t._private.rscratch,r=e.edgeType==="haystack",n=e.edgeType==="bezier",i=e.edgeType==="multibezier",a=e.edgeType==="segments",s=e.edgeType==="compound",o=e.edgeType==="self",l,u,c,h,p,g,C,_;if(r?(c=e.haystackPts[0],h=e.haystackPts[1],p=e.haystackPts[2],g=e.haystackPts[3]):(c=e.arrowStartX,h=e.arrowStartY,p=e.arrowEndX,g=e.arrowEndY),C=e.midX,_=e.midY,a)l=c-e.segpts[0],u=h-e.segpts[1];else if(i||s||o||n){var y=e.allpts,S=da(y[0],y[2],y[4],.1),w=da(y[1],y[3],y[5],.1);l=c-S,u=h-w}else l=c-C,u=h-_;e.srcArrowAngle=X0(l,u);var C=e.midX,_=e.midY;if(r&&(C=(c+p)/2,_=(h+g)/2),l=p-c,u=g-h,a){var y=e.allpts;if(y.length/2%2===0){var T=y.length/2,N=T-2;l=y[T]-y[N],u=y[T+1]-y[N+1]}else if(e.isRound)l=e.midVector[1],u=-e.midVector[0];else{var T=y.length/2-1,N=T-2;l=y[T]-y[N],u=y[T+1]-y[N+1]}}else if(i||s||o){var y=e.allpts,R=e.ctrlpts,I,j,O,F;if(R.length/2%2===0){var z=y.length/2-1,V=z+2,q=V+2;I=da(y[z],y[V],y[q],0),j=da(y[z+1],y[V+1],y[q+1],0),O=da(y[z],y[V],y[q],1e-4),F=da(y[z+1],y[V+1],y[q+1],1e-4)}else{var V=y.length/2-1,z=V-2,q=V+2;I=da(y[z],y[V],y[q],.4999),j=da(y[z+1],y[V+1],y[q+1],.4999),O=da(y[z],y[V],y[q],.5),F=da(y[z+1],y[V+1],y[q+1],.5)}l=O-I,u=F-j}if(e.midtgtArrowAngle=X0(l,u),e.midDispX=l,e.midDispY=u,l*=-1,u*=-1,a){var y=e.allpts;if(y.length/2%2!==0){if(!e.isRound){var T=y.length/2-1,D=T+2;l=-(y[D]-y[T]),u=-(y[D+1]-y[T+1])}}}if(e.midsrcArrowAngle=X0(l,u),a)l=p-e.segpts[e.segpts.length-2],u=g-e.segpts[e.segpts.length-1];else if(i||s||o||n){var y=e.allpts,U=y.length,S=da(y[U-6],y[U-4],y[U-2],.9),w=da(y[U-5],y[U-3],y[U-1],.9);l=p-S,u=g-w}else l=p-C,u=g-_;e.tgtArrowAngle=X0(l,u)};fx.getArrowWidth=fx.getArrowHeight=function(t,e){var r=this.arrowWidthCache=this.arrowWidthCache||{},n=r[t+", "+e];return n||(n=Math.max(Math.pow(t*13.37,.9),29)*e,r[t+", "+e]=n,n)};var HS,WS,yu={},qo={},RN,ON,Xh,Gy,rc,Gh,Kh,gu,gp,ay,GA,VA,qS,$S,DN,IN=function(e,r,n){n.x=r.x-e.x,n.y=r.y-e.y,n.len=Math.sqrt(n.x*n.x+n.y*n.y),n.nx=n.x/n.len,n.ny=n.y/n.len,n.ang=Math.atan2(n.ny,n.nx)},wz=function(e,r){r.x=e.x*-1,r.y=e.y*-1,r.nx=e.nx*-1,r.ny=e.ny*-1,r.ang=e.ang>0?-(Math.PI-e.ang):Math.PI+e.ang},Sz=function(e,r,n,i,a){if(e!==DN?IN(r,e,yu):wz(qo,yu),IN(r,n,qo),RN=yu.nx*qo.ny-yu.ny*qo.nx,ON=yu.nx*qo.nx-yu.ny*-qo.ny,rc=Math.asin(Math.max(-1,Math.min(1,RN))),Math.abs(rc)<1e-6){HS=r.x,WS=r.y,Kh=gp=0;return}Xh=1,Gy=!1,ON<0?rc<0?rc=Math.PI+rc:(rc=Math.PI-rc,Xh=-1,Gy=!0):rc>0&&(Xh=-1,Gy=!0),r.radius!==void 0?gp=r.radius:gp=i,Gh=rc/2,ay=Math.min(yu.len/2,qo.len/2),a?(gu=Math.abs(Math.cos(Gh)*gp/Math.sin(Gh)),gu>ay?(gu=ay,Kh=Math.abs(gu*Math.sin(Gh)/Math.cos(Gh))):Kh=gp):(gu=Math.min(ay,gp),Kh=Math.abs(gu*Math.sin(Gh)/Math.cos(Gh))),qS=r.x+qo.nx*gu,$S=r.y+qo.ny*gu,HS=qS-qo.ny*Kh*Xh,WS=$S+qo.nx*Kh*Xh,GA=r.x+yu.nx*gu,VA=r.y+yu.ny*gu,DN=r};function HA(t,e){e.radius===0?t.lineTo(e.cx,e.cy):t.arc(e.cx,e.cy,e.radius,e.startAngle,e.endAngle,e.counterClockwise)}function v_(t,e,r,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;return n===0||e.radius===0?{cx:e.x,cy:e.y,radius:0,startX:e.x,startY:e.y,stopX:e.x,stopY:e.y,startAngle:void 0,endAngle:void 0,counterClockwise:void 0}:(Sz(t,e,r,n,i),{cx:HS,cy:WS,radius:Kh,startX:GA,startY:VA,stopX:qS,stopY:$S,startAngle:yu.ang+Math.PI/2*Xh,endAngle:qo.ang-Math.PI/2*Xh,counterClockwise:Gy})}var Tv=.01,kz=Math.sqrt(2*Tv),us={};us.findMidptPtsEtc=function(t,e){var r=e.posPts,n=e.intersectionPts,i=e.vectorNormInverse,a,s=t.pstyle("source-endpoint"),o=t.pstyle("target-endpoint"),l=s.units!=null&&o.units!=null,u=function(R,I,j,O){var F=O-I,z=j-R,V=Math.sqrt(z*z+F*F);return{x:-F/V,y:z/V}},c=t.pstyle("edge-distances").value;switch(c){case"node-position":a=r;break;case"intersection":a=n;break;case"endpoints":{if(l){var h=this.manualEndptToPx(t.source()[0],s),p=Di(h,2),g=p[0],y=p[1],S=this.manualEndptToPx(t.target()[0],o),w=Di(S,2),C=w[0],_=w[1],T={x1:g,y1:y,x2:C,y2:_};i=u(g,y,C,_),a=T}else an("Edge ".concat(t.id()," has edge-distances:endpoints specified without manual endpoints specified via source-endpoint and target-endpoint.  Falling back on edge-distances:intersection (default).")),a=n;break}}return{midptPts:a,vectorNormInverse:i}};us.findHaystackPoints=function(t){for(var e=0;e<t.length;e++){var r=t[e],n=r._private,i=n.rscratch;if(!i.haystack){var a=Math.random()*2*Math.PI;i.source={x:Math.cos(a),y:Math.sin(a)},a=Math.random()*2*Math.PI,i.target={x:Math.cos(a),y:Math.sin(a)}}var s=n.source,o=n.target,l=s.position(),u=o.position(),c=s.width(),h=o.width(),p=s.height(),g=o.height(),y=r.pstyle("haystack-radius").value,S=y/2;i.haystackPts=i.allpts=[i.source.x*c*S+l.x,i.source.y*p*S+l.y,i.target.x*h*S+u.x,i.target.y*g*S+u.y],i.midX=(i.allpts[0]+i.allpts[2])/2,i.midY=(i.allpts[1]+i.allpts[3])/2,i.edgeType="haystack",i.haystack=!0,this.storeEdgeProjections(r),this.calculateArrowAngles(r),this.recalculateEdgeLabelProjections(r),this.calculateLabelAngles(r)}};us.findSegmentsPoints=function(t,e){var r=t._private.rscratch,n=t.pstyle("segment-weights"),i=t.pstyle("segment-distances"),a=t.pstyle("segment-radii"),s=t.pstyle("radius-type"),o=Math.min(n.pfValue.length,i.pfValue.length),l=a.pfValue[a.pfValue.length-1],u=s.pfValue[s.pfValue.length-1];r.edgeType="segments",r.segpts=[],r.radii=[],r.isArcRadius=[];for(var c=0;c<o;c++){var h=n.pfValue[c],p=i.pfValue[c],g=1-h,y=h,S=this.findMidptPtsEtc(t,e),w=S.midptPts,C=S.vectorNormInverse,_={x:w.x1*g+w.x2*y,y:w.y1*g+w.y2*y};r.segpts.push(_.x+C.x*p,_.y+C.y*p),r.radii.push(a.pfValue[c]!==void 0?a.pfValue[c]:l),r.isArcRadius.push((s.pfValue[c]!==void 0?s.pfValue[c]:u)==="arc-radius")}};us.findLoopPoints=function(t,e,r,n){var i=t._private.rscratch,a=e.dirCounts,s=e.srcPos,o=t.pstyle("control-point-distances"),l=o?o.pfValue[0]:void 0,u=t.pstyle("loop-direction").pfValue,c=t.pstyle("loop-sweep").pfValue,h=t.pstyle("control-point-step-size").pfValue;i.edgeType="self";var p=r,g=h;n&&(p=0,g=l);var y=u-Math.PI/2,S=y-c/2,w=y+c/2,C=u+"_"+c;p=a[C]===void 0?a[C]=0:++a[C],i.ctrlpts=[s.x+Math.cos(S)*1.4*g*(p/3+1),s.y+Math.sin(S)*1.4*g*(p/3+1),s.x+Math.cos(w)*1.4*g*(p/3+1),s.y+Math.sin(w)*1.4*g*(p/3+1)]};us.findCompoundLoopPoints=function(t,e,r,n){var i=t._private.rscratch;i.edgeType="compound";var a=e.srcPos,s=e.tgtPos,o=e.srcW,l=e.srcH,u=e.tgtW,c=e.tgtH,h=t.pstyle("control-point-step-size").pfValue,p=t.pstyle("control-point-distances"),g=p?p.pfValue[0]:void 0,y=r,S=h;n&&(y=0,S=g);var w=50,C={x:a.x-o/2,y:a.y-l/2},_={x:s.x-u/2,y:s.y-c/2},T={x:Math.min(C.x,_.x),y:Math.min(C.y,_.y)},N=.5,R=Math.max(N,Math.log(o*Tv)),I=Math.max(N,Math.log(u*Tv));i.ctrlpts=[T.x,T.y-(1+Math.pow(w,1.12)/100)*S*(y/3+1)*R,T.x-(1+Math.pow(w,1.12)/100)*S*(y/3+1)*I,T.y]};us.findStraightEdgePoints=function(t){t._private.rscratch.edgeType="straight"};us.findBezierPoints=function(t,e,r,n,i){var a=t._private.rscratch,s=t.pstyle("control-point-step-size").pfValue,o=t.pstyle("control-point-distances"),l=t.pstyle("control-point-weights"),u=o&&l?Math.min(o.value.length,l.value.length):1,c=o?o.pfValue[0]:void 0,h=l.value[0],p=n;a.edgeType=p?"multibezier":"bezier",a.ctrlpts=[];for(var g=0;g<u;g++){var y=(.5-e.eles.length/2+r)*s*(i?-1:1),S=void 0,w=i_(y);p&&(c=o?o.pfValue[g]:s,h=l.value[g]),n?S=c:S=c!==void 0?w*c:void 0;var C=S!==void 0?S:y,_=1-h,T=h,N=this.findMidptPtsEtc(t,e),R=N.midptPts,I=N.vectorNormInverse,j={x:R.x1*_+R.x2*T,y:R.y1*_+R.y2*T};a.ctrlpts.push(j.x+I.x*C,j.y+I.y*C)}};us.findTaxiPoints=function(t,e){var r=t._private.rscratch;r.edgeType="segments";var n="vertical",i="horizontal",a="leftward",s="rightward",o="downward",l="upward",u="auto",c=e.posPts,h=e.srcW,p=e.srcH,g=e.tgtW,y=e.tgtH,S=t.pstyle("edge-distances").value,w=S!=="node-position",C=t.pstyle("taxi-direction").value,_=C,T=t.pstyle("taxi-turn"),N=T.units==="%",R=T.pfValue,I=R<0,j=t.pstyle("taxi-turn-min-distance").pfValue,O=w?(h+g)/2:0,F=w?(p+y)/2:0,z=c.x2-c.x1,V=c.y2-c.y1,q=function(de,ge){return de>0?Math.max(de-ge,0):Math.min(de+ge,0)},D=q(z,O),U=q(V,F),G=!1;_===u?C=Math.abs(D)>Math.abs(U)?i:n:_===l||_===o?(C=n,G=!0):(_===a||_===s)&&(C=i,G=!0);var Z=C===n,K=Z?U:D,Q=Z?V:z,ne=i_(Q),te=!1;!(G&&(N||I))&&(_===o&&Q<0||_===l&&Q>0||_===a&&Q>0||_===s&&Q<0)&&(ne*=-1,K=ne*Math.abs(K),te=!0);var X;if(N){var re=R<0?1+R:R;X=re*K}else{var he=R<0?K:0;X=he+R*ne}var oe=function(de){return Math.abs(de)<j||Math.abs(de)>=Math.abs(K)},se=oe(X),fe=oe(Math.abs(K)-Math.abs(X)),ae=se||fe;if(ae&&!te)if(Z){var pe=Math.abs(Q)<=p/2,ye=Math.abs(z)<=g/2;if(pe){var ve=(c.x1+c.x2)/2,ue=c.y1,xe=c.y2;r.segpts=[ve,ue,ve,xe]}else if(ye){var Se=(c.y1+c.y2)/2,Oe=c.x1,Ae=c.x2;r.segpts=[Oe,Se,Ae,Se]}else r.segpts=[c.x1,c.y2]}else{var tt=Math.abs(Q)<=h/2,rt=Math.abs(V)<=y/2;if(tt){var dt=(c.y1+c.y2)/2,_t=c.x1,Xe=c.x2;r.segpts=[_t,dt,Xe,dt]}else if(rt){var ht=(c.x1+c.x2)/2,ct=c.y1,vt=c.y2;r.segpts=[ht,ct,ht,vt]}else r.segpts=[c.x2,c.y1]}else if(Z){var lt=c.y1+X+(w?p/2*ne:0),Lt=c.x1,jt=c.x2;r.segpts=[Lt,lt,jt,lt]}else{var Ne=c.x1+X+(w?h/2*ne:0),qe=c.y1,bt=c.y2;r.segpts=[Ne,qe,Ne,bt]}if(r.isRound){var at=t.pstyle("taxi-radius").value,ut=t.pstyle("radius-type").value[0]==="arc-radius";r.radii=new Array(r.segpts.length/2).fill(at),r.isArcRadius=new Array(r.segpts.length/2).fill(ut)}};us.tryToCorrectInvalidPoints=function(t,e){var r=t._private.rscratch;if(r.edgeType==="bezier"){var n=e.srcPos,i=e.tgtPos,a=e.srcW,s=e.srcH,o=e.tgtW,l=e.tgtH,u=e.srcShape,c=e.tgtShape,h=e.srcCornerRadius,p=e.tgtCornerRadius,g=e.srcRs,y=e.tgtRs,S=!kt(r.startX)||!kt(r.startY),w=!kt(r.arrowStartX)||!kt(r.arrowStartY),C=!kt(r.endX)||!kt(r.endY),_=!kt(r.arrowEndX)||!kt(r.arrowEndY),T=3,N=this.getArrowWidth(t.pstyle("width").pfValue,t.pstyle("arrow-scale").value)*this.arrowShapeWidth,R=T*N,I=mf({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.startX,y:r.startY}),j=I<R,O=mf({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.endX,y:r.endY}),F=O<R,z=!1;if(S||w||j){z=!0;var V={x:r.ctrlpts[0]-n.x,y:r.ctrlpts[1]-n.y},q=Math.sqrt(V.x*V.x+V.y*V.y),D={x:V.x/q,y:V.y/q},U=Math.max(a,s),G={x:r.ctrlpts[0]+D.x*2*U,y:r.ctrlpts[1]+D.y*2*U},Z=u.intersectLine(n.x,n.y,a,s,G.x,G.y,0,h,g);j?(r.ctrlpts[0]=r.ctrlpts[0]+D.x*(R-I),r.ctrlpts[1]=r.ctrlpts[1]+D.y*(R-I)):(r.ctrlpts[0]=Z[0]+D.x*R,r.ctrlpts[1]=Z[1]+D.y*R)}if(C||_||F){z=!0;var K={x:r.ctrlpts[0]-i.x,y:r.ctrlpts[1]-i.y},Q=Math.sqrt(K.x*K.x+K.y*K.y),ne={x:K.x/Q,y:K.y/Q},te=Math.max(a,s),X={x:r.ctrlpts[0]+ne.x*2*te,y:r.ctrlpts[1]+ne.y*2*te},re=c.intersectLine(i.x,i.y,o,l,X.x,X.y,0,p,y);F?(r.ctrlpts[0]=r.ctrlpts[0]+ne.x*(R-O),r.ctrlpts[1]=r.ctrlpts[1]+ne.y*(R-O)):(r.ctrlpts[0]=re[0]+ne.x*R,r.ctrlpts[1]=re[1]+ne.y*R)}z&&this.findEndpoints(t)}};us.storeAllpts=function(t){var e=t._private.rscratch;if(e.edgeType==="multibezier"||e.edgeType==="bezier"||e.edgeType==="self"||e.edgeType==="compound"){e.allpts=[],e.allpts.push(e.startX,e.startY);for(var r=0;r+1<e.ctrlpts.length;r+=2)e.allpts.push(e.ctrlpts[r],e.ctrlpts[r+1]),r+3<e.ctrlpts.length&&e.allpts.push((e.ctrlpts[r]+e.ctrlpts[r+2])/2,(e.ctrlpts[r+1]+e.ctrlpts[r+3])/2);e.allpts.push(e.endX,e.endY);var n,i;e.ctrlpts.length/2%2===0?(n=e.allpts.length/2-1,e.midX=e.allpts[n],e.midY=e.allpts[n+1]):(n=e.allpts.length/2-3,i=.5,e.midX=da(e.allpts[n],e.allpts[n+2],e.allpts[n+4],i),e.midY=da(e.allpts[n+1],e.allpts[n+3],e.allpts[n+5],i))}else if(e.edgeType==="straight")e.allpts=[e.startX,e.startY,e.endX,e.endY],e.midX=(e.startX+e.endX+e.arrowStartX+e.arrowEndX)/4,e.midY=(e.startY+e.endY+e.arrowStartY+e.arrowEndY)/4;else if(e.edgeType==="segments"){if(e.allpts=[],e.allpts.push(e.startX,e.startY),e.allpts.push.apply(e.allpts,e.segpts),e.allpts.push(e.endX,e.endY),e.isRound){e.roundCorners=[];for(var a=2;a+3<e.allpts.length;a+=2){var s=e.radii[a/2-1],o=e.isArcRadius[a/2-1];e.roundCorners.push(v_({x:e.allpts[a-2],y:e.allpts[a-1]},{x:e.allpts[a],y:e.allpts[a+1],radius:s},{x:e.allpts[a+2],y:e.allpts[a+3]},s,o))}}if(e.segpts.length%4===0){var l=e.segpts.length/2,u=l-2;e.midX=(e.segpts[u]+e.segpts[l])/2,e.midY=(e.segpts[u+1]+e.segpts[l+1])/2}else{var c=e.segpts.length/2-1;if(!e.isRound)e.midX=e.segpts[c],e.midY=e.segpts[c+1];else{var h={x:e.segpts[c],y:e.segpts[c+1]},p=e.roundCorners[c/2];if(p.radius===0){var g={x:e.segpts[c+2],y:e.segpts[c+3]};e.midX=h.x,e.midY=h.y,e.midVector=[h.y-g.y,g.x-h.x]}else{var y=[h.x-p.cx,h.y-p.cy],S=p.radius/Math.sqrt(Math.pow(y[0],2)+Math.pow(y[1],2));y=y.map(function(w){return w*S}),e.midX=p.cx+y[0],e.midY=p.cy+y[1],e.midVector=y}}}}};us.checkForInvalidEdgeWarning=function(t){var e=t[0]._private.rscratch;e.nodesOverlap||kt(e.startX)&&kt(e.startY)&&kt(e.endX)&&kt(e.endY)?e.loggedErr=!1:e.loggedErr||(e.loggedErr=!0,an("Edge `"+t.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))};us.findEdgeControlPoints=function(t){var e=this;if(!(!t||t.length===0)){for(var r=this,n=r.cy,i=n.hasCompoundNodes(),a=new dc,s=function(F,z){return[].concat(nx(F),[z?1:0]).join("-")},o=[],l=[],u=0;u<t.length;u++){var c=t[u],h=c._private,p=c.pstyle("curve-style").value;if(!(c.removed()||!c.takesUpSpace())){if(p==="haystack"){l.push(c);continue}var g=p==="unbundled-bezier"||Rd(p,"segments")||p==="straight"||p==="straight-triangle"||Rd(p,"taxi"),y=p==="unbundled-bezier"||p==="bezier",S=h.source,w=h.target,C=S.poolIndex(),_=w.poolIndex(),T=[C,_].sort(),N=s(T,g),R=a.get(N);R==null&&(R={eles:[]},o.push({pairId:T,edgeIsUnbundled:g}),a.set(N,R)),R.eles.push(c),g&&(R.hasUnbundled=!0),y&&(R.hasBezier=!0)}}for(var I=function(){var F=o[j],z=F.pairId,V=F.edgeIsUnbundled,q=s(z,V),D=a.get(q),U;if(!D.hasUnbundled){var G=D.eles[0].parallelEdges().filter(function(ut){return ut.isBundledBezier()});r_(D.eles),G.forEach(function(ut){return D.eles.push(ut)}),D.eles.sort(function(ut,Fe){return ut.poolIndex()-Fe.poolIndex()})}var Z=D.eles[0],K=Z.source(),Q=Z.target();if(K.poolIndex()>Q.poolIndex()){var ne=K;K=Q,Q=ne}var te=D.srcPos=K.position(),X=D.tgtPos=Q.position(),re=D.srcW=K.outerWidth(),he=D.srcH=K.outerHeight(),oe=D.tgtW=Q.outerWidth(),se=D.tgtH=Q.outerHeight(),fe=D.srcShape=r.nodeShapes[e.getNodeShape(K)],ae=D.tgtShape=r.nodeShapes[e.getNodeShape(Q)],pe=D.srcCornerRadius=K.pstyle("corner-radius").value==="auto"?"auto":K.pstyle("corner-radius").pfValue,ye=D.tgtCornerRadius=Q.pstyle("corner-radius").value==="auto"?"auto":Q.pstyle("corner-radius").pfValue,ve=D.tgtRs=Q._private.rscratch,ue=D.srcRs=K._private.rscratch;D.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var xe=0;xe<D.eles.length;xe++){var Se=D.eles[xe],Oe=Se[0]._private.rscratch,Ae=Se.pstyle("curve-style").value,tt=Ae==="unbundled-bezier"||Rd(Ae,"segments")||Rd(Ae,"taxi"),rt=!K.same(Se.source());if(!D.calculatedIntersection&&K!==Q&&(D.hasBezier||D.hasUnbundled)){D.calculatedIntersection=!0;var dt=fe.intersectLine(te.x,te.y,re,he,X.x,X.y,0,pe,ue),_t=D.srcIntn=dt,Xe=ae.intersectLine(X.x,X.y,oe,se,te.x,te.y,0,ye,ve),ht=D.tgtIntn=Xe,ct=D.intersectionPts={x1:dt[0],x2:Xe[0],y1:dt[1],y2:Xe[1]},vt=D.posPts={x1:te.x,x2:X.x,y1:te.y,y2:X.y},lt=Xe[1]-dt[1],Lt=Xe[0]-dt[0],jt=Math.sqrt(Lt*Lt+lt*lt);kt(jt)&&jt>=kz||(jt=Math.sqrt(Math.max(Lt*Lt,Tv)+Math.max(lt*lt,Tv)));var Ne=D.vector={x:Lt,y:lt},qe=D.vectorNorm={x:Ne.x/jt,y:Ne.y/jt},bt={x:-qe.y,y:qe.x};D.nodesOverlap=!kt(jt)||ae.checkPoint(dt[0],dt[1],0,oe,se,X.x,X.y,ye,ve)||fe.checkPoint(Xe[0],Xe[1],0,re,he,te.x,te.y,pe,ue),D.vectorNormInverse=bt,U={nodesOverlap:D.nodesOverlap,dirCounts:D.dirCounts,calculatedIntersection:!0,hasBezier:D.hasBezier,hasUnbundled:D.hasUnbundled,eles:D.eles,srcPos:X,srcRs:ve,tgtPos:te,tgtRs:ue,srcW:oe,srcH:se,tgtW:re,tgtH:he,srcIntn:ht,tgtIntn:_t,srcShape:ae,tgtShape:fe,posPts:{x1:vt.x2,y1:vt.y2,x2:vt.x1,y2:vt.y1},intersectionPts:{x1:ct.x2,y1:ct.y2,x2:ct.x1,y2:ct.y1},vector:{x:-Ne.x,y:-Ne.y},vectorNorm:{x:-qe.x,y:-qe.y},vectorNormInverse:{x:-bt.x,y:-bt.y}}}var at=rt?U:D;Oe.nodesOverlap=at.nodesOverlap,Oe.srcIntn=at.srcIntn,Oe.tgtIntn=at.tgtIntn,Oe.isRound=Ae.startsWith("round"),i&&(K.isParent()||K.isChild()||Q.isParent()||Q.isChild())&&(K.parents().anySame(Q)||Q.parents().anySame(K)||K.same(Q)&&K.isParent())?e.findCompoundLoopPoints(Se,at,xe,tt):K===Q?e.findLoopPoints(Se,at,xe,tt):Ae.endsWith("segments")?e.findSegmentsPoints(Se,at):Ae.endsWith("taxi")?e.findTaxiPoints(Se,at):Ae==="straight"||!tt&&D.eles.length%2===1&&xe===Math.floor(D.eles.length/2)?e.findStraightEdgePoints(Se):e.findBezierPoints(Se,at,xe,tt,rt),e.findEndpoints(Se),e.tryToCorrectInvalidPoints(Se,at),e.checkForInvalidEdgeWarning(Se),e.storeAllpts(Se),e.storeEdgeProjections(Se),e.calculateArrowAngles(Se),e.recalculateEdgeLabelProjections(Se),e.calculateLabelAngles(Se)}},j=0;j<o.length;j++)I();this.findHaystackPoints(l)}};function WA(t){var e=[];if(t!=null){for(var r=0;r<t.length;r+=2){var n=t[r],i=t[r+1];e.push({x:n,y:i})}return e}}us.getSegmentPoints=function(t){var e=t[0]._private.rscratch;this.recalculateRenderedStyle(t);var r=e.edgeType;if(r==="segments")return WA(e.segpts)};us.getControlPoints=function(t){var e=t[0]._private.rscratch;this.recalculateRenderedStyle(t);var r=e.edgeType;if(r==="bezier"||r==="multibezier"||r==="self"||r==="compound")return WA(e.ctrlpts)};us.getEdgeMidpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),{x:e.midX,y:e.midY}};var r0={};r0.manualEndptToPx=function(t,e){var r=this,n=t.position(),i=t.outerWidth(),a=t.outerHeight(),s=t._private.rscratch;if(e.value.length===2){var o=[e.pfValue[0],e.pfValue[1]];return e.units[0]==="%"&&(o[0]=o[0]*i),e.units[1]==="%"&&(o[1]=o[1]*a),o[0]+=n.x,o[1]+=n.y,o}else{var l=e.pfValue[0];l=-Math.PI/2+l;var u=2*Math.max(i,a),c=[n.x+Math.cos(l)*u,n.y+Math.sin(l)*u];return r.nodeShapes[this.getNodeShape(t)].intersectLine(n.x,n.y,i,a,c[0],c[1],0,t.pstyle("corner-radius").value==="auto"?"auto":t.pstyle("corner-radius").pfValue,s)}};r0.findEndpoints=function(t){var e,r,n,i,a=this,s,o=t.source()[0],l=t.target()[0],u=o.position(),c=l.position(),h=t.pstyle("target-arrow-shape").value,p=t.pstyle("source-arrow-shape").value,g=t.pstyle("target-distance-from-node").pfValue,y=t.pstyle("source-distance-from-node").pfValue,S=o._private.rscratch,w=l._private.rscratch,C=t.pstyle("curve-style").value,_=t._private.rscratch,T=_.edgeType,N=Rd(C,"taxi"),R=T==="self"||T==="compound",I=T==="bezier"||T==="multibezier"||R,j=T!=="bezier",O=T==="straight"||T==="segments",F=T==="segments",z=I||j||O,V=R||N,q=t.pstyle("source-endpoint"),D=V?"outside-to-node":q.value,U=o.pstyle("corner-radius").value==="auto"?"auto":o.pstyle("corner-radius").pfValue,G=t.pstyle("target-endpoint"),Z=V?"outside-to-node":G.value,K=l.pstyle("corner-radius").value==="auto"?"auto":l.pstyle("corner-radius").pfValue;_.srcManEndpt=q,_.tgtManEndpt=G;var Q,ne,te,X,re=(e=(G==null||(r=G.pfValue)===null||r===void 0?void 0:r.length)===2?G.pfValue:null)!==null&&e!==void 0?e:[0,0],he=(n=(q==null||(i=q.pfValue)===null||i===void 0?void 0:i.length)===2?q.pfValue:null)!==null&&n!==void 0?n:[0,0];if(I){var oe=[_.ctrlpts[0],_.ctrlpts[1]],se=j?[_.ctrlpts[_.ctrlpts.length-2],_.ctrlpts[_.ctrlpts.length-1]]:oe;Q=se,ne=oe}else if(O){var fe=F?_.segpts.slice(0,2):[c.x+re[0],c.y+re[1]],ae=F?_.segpts.slice(_.segpts.length-2):[u.x+he[0],u.y+he[1]];Q=ae,ne=fe}if(Z==="inside-to-node")s=[c.x,c.y];else if(G.units)s=this.manualEndptToPx(l,G);else if(Z==="outside-to-line")s=_.tgtIntn;else if(Z==="outside-to-node"||Z==="outside-to-node-or-label"?te=Q:(Z==="outside-to-line"||Z==="outside-to-line-or-label")&&(te=[u.x,u.y]),s=a.nodeShapes[this.getNodeShape(l)].intersectLine(c.x,c.y,l.outerWidth(),l.outerHeight(),te[0],te[1],0,K,w),Z==="outside-to-node-or-label"||Z==="outside-to-line-or-label"){var pe=l._private.rscratch,ye=pe.labelWidth,ve=pe.labelHeight,ue=pe.labelX,xe=pe.labelY,Se=ye/2,Oe=ve/2,Ae=l.pstyle("text-valign").value;Ae==="top"?xe-=Oe:Ae==="bottom"&&(xe+=Oe);var tt=l.pstyle("text-halign").value;tt==="left"?ue-=Se:tt==="right"&&(ue+=Se);var rt=Sv(te[0],te[1],[ue-Se,xe-Oe,ue+Se,xe-Oe,ue+Se,xe+Oe,ue-Se,xe+Oe],c.x,c.y);if(rt.length>0){var dt=u,_t=$h(dt,Lp(s)),Xe=$h(dt,Lp(rt)),ht=_t;if(Xe<_t&&(s=rt,ht=Xe),rt.length>2){var ct=$h(dt,{x:rt[2],y:rt[3]});ct<ht&&(s=[rt[2],rt[3]])}}}var vt=Q0(s,Q,a.arrowShapes[h].spacing(t)+g),lt=Q0(s,Q,a.arrowShapes[h].gap(t)+g);if(_.endX=lt[0],_.endY=lt[1],_.arrowEndX=vt[0],_.arrowEndY=vt[1],D==="inside-to-node")s=[u.x,u.y];else if(q.units)s=this.manualEndptToPx(o,q);else if(D==="outside-to-line")s=_.srcIntn;else if(D==="outside-to-node"||D==="outside-to-node-or-label"?X=ne:(D==="outside-to-line"||D==="outside-to-line-or-label")&&(X=[c.x,c.y]),s=a.nodeShapes[this.getNodeShape(o)].intersectLine(u.x,u.y,o.outerWidth(),o.outerHeight(),X[0],X[1],0,U,S),D==="outside-to-node-or-label"||D==="outside-to-line-or-label"){var Lt=o._private.rscratch,jt=Lt.labelWidth,Ne=Lt.labelHeight,qe=Lt.labelX,bt=Lt.labelY,at=jt/2,ut=Ne/2,Fe=o.pstyle("text-valign").value;Fe==="top"?bt-=ut:Fe==="bottom"&&(bt+=ut);var de=o.pstyle("text-halign").value;de==="left"?qe-=at:de==="right"&&(qe+=at);var ge=Sv(X[0],X[1],[qe-at,bt-ut,qe+at,bt-ut,qe+at,bt+ut,qe-at,bt+ut],u.x,u.y);if(ge.length>0){var ke=c,Ee=$h(ke,Lp(s)),Le=$h(ke,Lp(ge)),Qe=Ee;if(Le<Ee&&(s=[ge[0],ge[1]],Qe=Le),ge.length>2){var Ve=$h(ke,{x:ge[2],y:ge[3]});Ve<Qe&&(s=[ge[2],ge[3]])}}}var xt=Q0(s,ne,a.arrowShapes[p].spacing(t)+y),ze=Q0(s,ne,a.arrowShapes[p].gap(t)+y);_.startX=ze[0],_.startY=ze[1],_.arrowStartX=xt[0],_.arrowStartY=xt[1],z&&(!kt(_.startX)||!kt(_.startY)||!kt(_.endX)||!kt(_.endY)?_.badLine=!0:_.badLine=!1)};r0.getSourceEndpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),e.edgeType==="haystack"?{x:e.haystackPts[0],y:e.haystackPts[1]}:{x:e.arrowStartX,y:e.arrowStartY}};r0.getTargetEndpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),e.edgeType==="haystack"?{x:e.haystackPts[2],y:e.haystackPts[3]}:{x:e.arrowEndX,y:e.arrowEndY}};var y_={};function _z(t,e,r){for(var n=function(u,c,h,p){return da(u,c,h,p)},i=e._private,a=i.rstyle.bezierPts,s=0;s<t.bezierProjPcts.length;s++){var o=t.bezierProjPcts[s];a.push({x:n(r[0],r[2],r[4],o),y:n(r[1],r[3],r[5],o)})}}y_.storeEdgeProjections=function(t){var e=t._private,r=e.rscratch,n=r.edgeType;if(e.rstyle.bezierPts=null,e.rstyle.linePts=null,e.rstyle.haystackPts=null,n==="multibezier"||n==="bezier"||n==="self"||n==="compound"){e.rstyle.bezierPts=[];for(var i=0;i+5<r.allpts.length;i+=4)_z(this,t,r.allpts.slice(i,i+6))}else if(n==="segments")for(var a=e.rstyle.linePts=[],i=0;i+1<r.allpts.length;i+=2)a.push({x:r.allpts[i],y:r.allpts[i+1]});else if(n==="haystack"){var s=r.haystackPts;e.rstyle.haystackPts=[{x:s[0],y:s[1]},{x:s[2],y:s[3]}]}e.rstyle.arrowWidth=this.getArrowWidth(t.pstyle("width").pfValue,t.pstyle("arrow-scale").value)*this.arrowShapeWidth};y_.recalculateEdgeProjections=function(t){this.findEdgeControlPoints(t)};var Au={};Au.recalculateNodeLabelProjection=function(t){var e=t.pstyle("label").strValue;if(!Zd(e)){var r,n,i=t._private,a=t.width(),s=t.height(),o=t.padding(),l=t.position(),u=t.pstyle("text-halign").strValue,c=t.pstyle("text-valign").strValue,h=i.rscratch,p=i.rstyle;switch(u){case"left":r=l.x-a/2-o;break;case"right":r=l.x+a/2+o;break;default:r=l.x}switch(c){case"top":n=l.y-s/2-o;break;case"bottom":n=l.y+s/2+o;break;default:n=l.y}h.labelX=r,h.labelY=n,p.labelX=r,p.labelY=n,this.calculateLabelAngles(t),this.applyLabelDimensions(t)}};var qA=function(e,r){var n=Math.atan(r/e);return e===0&&n<0&&(n=n*-1),n},$A=function(e,r){var n=r.x-e.x,i=r.y-e.y;return qA(n,i)},Cz=function(e,r,n,i){var a=wv(0,i-.001,1),s=wv(0,i+.001,1),o=jp(e,r,n,a),l=jp(e,r,n,s);return $A(o,l)};Au.recalculateEdgeLabelProjections=function(t){var e,r=t._private,n=r.rscratch,i=this,a={mid:t.pstyle("label").strValue,source:t.pstyle("source-label").strValue,target:t.pstyle("target-label").strValue};if(a.mid||a.source||a.target){e={x:n.midX,y:n.midY};var s=function(h,p,g){cc(r.rscratch,h,p,g),cc(r.rstyle,h,p,g)};s("labelX",null,e.x),s("labelY",null,e.y);var o=qA(n.midDispX,n.midDispY);s("labelAutoAngle",null,o);var l=function(){if(l.cache)return l.cache;for(var h=[],p=0;p+5<n.allpts.length;p+=4){var g={x:n.allpts[p],y:n.allpts[p+1]},y={x:n.allpts[p+2],y:n.allpts[p+3]},S={x:n.allpts[p+4],y:n.allpts[p+5]};h.push({p0:g,p1:y,p2:S,startDist:0,length:0,segments:[]})}var w=r.rstyle.bezierPts,C=i.bezierProjPcts.length;function _(j,O,F,z,V){var q=mf(O,F),D=j.segments[j.segments.length-1],U={p0:O,p1:F,t0:z,t1:V,startDist:D?D.startDist+D.length:0,length:q};j.segments.push(U),j.length+=q}for(var T=0;T<h.length;T++){var N=h[T],R=h[T-1];R&&(N.startDist=R.startDist+R.length),_(N,N.p0,w[T*C],0,i.bezierProjPcts[0]);for(var I=0;I<C-1;I++)_(N,w[T*C+I],w[T*C+I+1],i.bezierProjPcts[I],i.bezierProjPcts[I+1]);_(N,w[T*C+C-1],N.p2,i.bezierProjPcts[C-1],1)}return l.cache=h},u=function(h){var p,g=h==="source";if(a[h]){var y=t.pstyle(h+"-text-offset").pfValue;switch(n.edgeType){case"self":case"compound":case"bezier":case"multibezier":{for(var S=l(),w,C=0,_=0,T=0;T<S.length;T++){for(var N=S[g?T:S.length-1-T],R=0;R<N.segments.length;R++){var I=N.segments[g?R:N.segments.length-1-R],j=T===S.length-1&&R===N.segments.length-1;if(C=_,_+=I.length,_>=y||j){w={cp:N,segment:I};break}}if(w)break}var O=w.cp,F=w.segment,z=(y-C)/F.length,V=F.t1-F.t0,q=g?F.t0+V*z:F.t1-V*z;q=wv(0,q,1),e=jp(O.p0,O.p1,O.p2,q),p=Cz(O.p0,O.p1,O.p2,q);break}case"straight":case"segments":case"haystack":{for(var D=0,U,G,Z,K,Q=n.allpts.length,ne=0;ne+3<Q&&(g?(Z={x:n.allpts[ne],y:n.allpts[ne+1]},K={x:n.allpts[ne+2],y:n.allpts[ne+3]}):(Z={x:n.allpts[Q-2-ne],y:n.allpts[Q-1-ne]},K={x:n.allpts[Q-4-ne],y:n.allpts[Q-3-ne]}),U=mf(Z,K),G=D,D+=U,!(D>=y));ne+=2);var te=y-G,X=te/U;X=wv(0,X,1),e=$9(Z,K,X),p=$A(Z,K);break}}s("labelX",h,e.x),s("labelY",h,e.y),s("labelAutoAngle",h,p)}};u("source"),u("target"),this.applyLabelDimensions(t)}};Au.applyLabelDimensions=function(t){this.applyPrefixedLabelDimensions(t),t.isEdge()&&(this.applyPrefixedLabelDimensions(t,"source"),this.applyPrefixedLabelDimensions(t,"target"))};Au.applyPrefixedLabelDimensions=function(t,e){var r=t._private,n=this.getLabelText(t,e),i=pf(n,t._private.labelDimsKey);if($s(r.rscratch,"prefixedLabelDimsKey",e)!==i){cc(r.rscratch,"prefixedLabelDimsKey",e,i);var a=this.calculateLabelDimensions(t,n),s=t.pstyle("line-height").pfValue,o=t.pstyle("text-wrap").strValue,l=$s(r.rscratch,"labelWrapCachedLines",e)||[],u=o!=="wrap"?1:Math.max(l.length,1),c=a.height/u,h=c*s,p=a.width,g=a.height+(u-1)*(s-1)*c;cc(r.rstyle,"labelWidth",e,p),cc(r.rscratch,"labelWidth",e,p),cc(r.rstyle,"labelHeight",e,g),cc(r.rscratch,"labelHeight",e,g),cc(r.rscratch,"labelLineHeight",e,h)}};Au.getLabelText=function(t,e){var r=t._private,n=e?e+"-":"",i=t.pstyle(n+"label").strValue,a=t.pstyle("text-transform").value,s=function(he,oe){return oe?(cc(r.rscratch,he,e,oe),oe):$s(r.rscratch,he,e)};if(!i)return"";a=="none"||(a=="uppercase"?i=i.toUpperCase():a=="lowercase"&&(i=i.toLowerCase()));var o=t.pstyle("text-wrap").value;if(o==="wrap"){var l=s("labelKey");if(l!=null&&s("labelWrapKey")===l)return s("labelWrapCachedText");for(var u="",c=i.split(`
`),h=t.pstyle("text-max-width").pfValue,p=t.pstyle("text-overflow-wrap").value,g=p==="anywhere",y=[],S=/[\s\u200b]+|$/g,w=0;w<c.length;w++){var C=c[w],_=this.calculateLabelDimensions(t,C),T=_.width;if(g){var N=C.split("").join(u);C=N}if(T>h){var R=C.matchAll(S),I="",j=0,O=Ys(R),F;try{for(O.s();!(F=O.n()).done;){var z=F.value,V=z[0],q=C.substring(j,z.index);j=z.index+V.length;var D=I.length===0?q:I+q+V,U=this.calculateLabelDimensions(t,D),G=U.width;G<=h?I+=q+V:(I&&y.push(I),I=q+V)}}catch(re){O.e(re)}finally{O.f()}I.match(/^[\s\u200b]+$/)||y.push(I)}else y.push(C)}s("labelWrapCachedLines",y),i=s("labelWrapCachedText",y.join(`
`)),s("labelWrapKey",l)}else if(o==="ellipsis"){var Z=t.pstyle("text-max-width").pfValue,K="",Q="",ne=!1;if(this.calculateLabelDimensions(t,i).width<Z)return i;for(var te=0;te<i.length;te++){var X=this.calculateLabelDimensions(t,K+i[te]+Q).width;if(X>Z)break;K+=i[te],te===i.length-1&&(ne=!0)}return ne||(K+=Q),K}return i};Au.getLabelJustification=function(t){var e=t.pstyle("text-justification").strValue,r=t.pstyle("text-halign").strValue;if(e==="auto")if(t.isNode())switch(r){case"left":return"right";case"right":return"left";default:return"center"}else return"center";else return e};Au.calculateLabelDimensions=function(t,e){var r=this,n=r.cy.window(),i=n.document,a=0,s=t.pstyle("font-style").strValue,o=t.pstyle("font-size").pfValue,l=t.pstyle("font-family").strValue,u=t.pstyle("font-weight").strValue,c=this.labelCalcCanvas,h=this.labelCalcCanvasContext;if(!c){c=this.labelCalcCanvas=i.createElement("canvas"),h=this.labelCalcCanvasContext=c.getContext("2d");var p=c.style;p.position="absolute",p.left="-9999px",p.top="-9999px",p.zIndex="-1",p.visibility="hidden",p.pointerEvents="none"}h.font="".concat(s," ").concat(u," ").concat(o,"px ").concat(l);for(var g=0,y=0,S=e.split(`
`),w=0;w<S.length;w++){var C=S[w],_=h.measureText(C),T=Math.ceil(_.width),N=o;g=Math.max(T,g),y+=N}return g+=a,y+=a,{width:g,height:y}};Au.calculateLabelAngle=function(t,e){var r=t._private,n=r.rscratch,i=t.isEdge(),a=e?e+"-":"",s=t.pstyle(a+"text-rotation"),o=s.strValue;return o==="none"?0:i&&o==="autorotate"?n.labelAutoAngle:o==="autorotate"?0:s.pfValue};Au.calculateLabelAngles=function(t){var e=this,r=t.isEdge(),n=t._private,i=n.rscratch;i.labelAngle=e.calculateLabelAngle(t),r&&(i.sourceLabelAngle=e.calculateLabelAngle(t,"source"),i.targetLabelAngle=e.calculateLabelAngle(t,"target"))};var KA={},jN=28,FN=!1;KA.getNodeShape=function(t){var e=this,r=t.pstyle("shape").value;if(r==="cutrectangle"&&(t.width()<jN||t.height()<jN))return FN||(an("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),FN=!0),"rectangle";if(t.isParent())return r==="rectangle"||r==="roundrectangle"||r==="round-rectangle"||r==="cutrectangle"||r==="cut-rectangle"||r==="barrel"?r:"rectangle";if(r==="polygon"){var n=t.pstyle("shape-polygon-points").value;return e.nodeShapes.makePolygon(n).name}return r};var I1={};I1.registerCalculationListeners=function(){var t=this.cy,e=t.collection(),r=this,n=function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(e.merge(s),o)for(var l=0;l<s.length;l++){var u=s[l],c=u._private,h=c.rstyle;h.clean=!1,h.cleanConnected=!1}};r.binder(t).on("bounds.* dirty.*",function(s){var o=s.target;n(o)}).on("style.* background.*",function(s){var o=s.target;n(o,!1)});var i=function(s){if(s){var o=r.onUpdateEleCalcsFns;e.cleanStyle();for(var l=0;l<e.length;l++){var u=e[l],c=u._private.rstyle;u.isNode()&&!c.cleanConnected&&(n(u.connectedEdges()),c.cleanConnected=!0)}if(o)for(var h=0;h<o.length;h++){var p=o[h];p(s,e)}r.recalculateRenderedStyle(e),e=t.collection()}};r.flushRenderedStyleQueue=function(){i(!0)},r.beforeRender(i,r.beforeRenderPriorities.eleCalcs)};I1.onUpdateEleCalcs=function(t){var e=this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[];e.push(t)};I1.recalculateRenderedStyle=function(t,e){var r=function(N){return N._private.rstyle.cleanConnected};if(t.length!==0){var n=[],i=[];if(!this.destroyed){e===void 0&&(e=!0);for(var a=0;a<t.length;a++){var s=t[a],o=s._private,l=o.rstyle;s.isEdge()&&(!r(s.source())||!r(s.target()))&&(l.clean=!1),s.isEdge()&&s.isBundledBezier()&&s.parallelEdges().some(function(T){return!T._private.rstyle.clean&&T.isBundledBezier()})&&(l.clean=!1),!(e&&l.clean||s.removed())&&s.pstyle("display").value!=="none"&&(o.group==="nodes"?i.push(s):n.push(s),l.clean=!0)}for(var u=0;u<i.length;u++){var c=i[u],h=c._private,p=h.rstyle,g=c.position();this.recalculateNodeLabelProjection(c),p.nodeX=g.x,p.nodeY=g.y,p.nodeW=c.pstyle("width").pfValue,p.nodeH=c.pstyle("height").pfValue}this.recalculateEdgeProjections(n);for(var y=0;y<n.length;y++){var S=n[y],w=S._private,C=w.rstyle,_=w.rscratch;C.srcX=_.arrowStartX,C.srcY=_.arrowStartY,C.tgtX=_.arrowEndX,C.tgtY=_.arrowEndY,C.midX=_.midX,C.midY=_.midY,C.labelAngle=_.labelAngle,C.sourceLabelAngle=_.sourceLabelAngle,C.targetLabelAngle=_.targetLabelAngle}}}};var j1={};j1.updateCachedGrabbedEles=function(){var t=this.cachedZSortedEles;if(t){t.drag=[],t.nondrag=[];for(var e=[],r=0;r<t.length;r++){var n=t[r],i=n._private.rscratch;n.grabbed()&&!n.isParent()?e.push(n):i.inDragLayer?t.drag.push(n):t.nondrag.push(n)}for(var r=0;r<e.length;r++){var n=e[r];t.drag.push(n)}}};j1.invalidateCachedZSortedEles=function(){this.cachedZSortedEles=null};j1.getCachedZSortedEles=function(t){if(t||!this.cachedZSortedEles){var e=this.cy.mutableElements().toArray();e.sort(PA),e.interactive=e.filter(function(r){return r.interactive()}),this.cachedZSortedEles=e,this.updateCachedGrabbedEles()}else e=this.cachedZSortedEles;return e};var ZA={};[Pf,fx,us,r0,y_,Au,KA,I1,j1].forEach(function(t){ar(ZA,t)});var YA={};YA.getCachedImage=function(t,e,r){var n=this,i=n.imageCache=n.imageCache||{},a=i[t];if(a)return a.image.complete||a.image.addEventListener("load",r),a.image;a=i[t]=i[t]||{};var s=a.image=new Image;s.addEventListener("load",r),s.addEventListener("error",function(){s.error=!0});var o="data:",l=t.substring(0,o.length).toLowerCase()===o;return l||(e=e==="null"?null:e,s.crossOrigin=e),s.src=t,s};var fm={};fm.registerBinding=function(t,e,r,n){var i=Array.prototype.slice.apply(arguments,[1]);if(Array.isArray(t)){for(var a=[],s=0;s<t.length;s++){var o=t[s];if(o!==void 0){var l=this.binder(o);a.push(l.on.apply(l,i))}}return a}var l=this.binder(t);return l.on.apply(l,i)};fm.binder=function(t){var e=this,r=e.cy.window(),n=t===r||t===r.document||t===r.document.body||jj(t);if(e.supportsPassiveEvents==null){var i=!1;try{var a=Object.defineProperty({},"passive",{get:function(){return i=!0,!0}});r.addEventListener("test",null,a)}catch{}e.supportsPassiveEvents=i}var s=function(l,u,c){var h=Array.prototype.slice.call(arguments);return n&&e.supportsPassiveEvents&&(h[2]={capture:c??!1,passive:!1,once:!1}),e.bindings.push({target:t,args:h}),(t.addEventListener||t.on).apply(t,h),this};return{on:s,addEventListener:s,addListener:s,bind:s}};fm.nodeIsDraggable=function(t){return t&&t.isNode()&&!t.locked()&&t.grabbable()};fm.nodeIsGrabbable=function(t){return this.nodeIsDraggable(t)&&t.interactive()};fm.load=function(){var t=this,e=t.cy.window(),r=function(de){return de.selected()},n=function(de){var ge=de.getRootNode();if(ge&&ge.nodeType===11&&ge.host!==void 0)return ge},i=function(de,ge,ke,Ee){de==null&&(de=t.cy);for(var Le=0;Le<ge.length;Le++){var Qe=ge[Le];de.emit({originalEvent:ke,type:Qe,position:Ee})}},a=function(de){return de.shiftKey||de.metaKey||de.ctrlKey},s=function(de,ge){var ke=!0;if(t.cy.hasCompoundNodes()&&de&&de.pannable())for(var Ee=0;ge&&Ee<ge.length;Ee++){var de=ge[Ee];if(de.isNode()&&de.isParent()&&!de.pannable()){ke=!1;break}}else ke=!0;return ke},o=function(de){de[0]._private.grabbed=!0},l=function(de){de[0]._private.grabbed=!1},u=function(de){de[0]._private.rscratch.inDragLayer=!0},c=function(de){de[0]._private.rscratch.inDragLayer=!1},h=function(de){de[0]._private.rscratch.isGrabTarget=!0},p=function(de){de[0]._private.rscratch.isGrabTarget=!1},g=function(de,ge){var ke=ge.addToList,Ee=ke.has(de);!Ee&&de.grabbable()&&!de.locked()&&(ke.merge(de),o(de))},y=function(de,ge){if(de.cy().hasCompoundNodes()&&!(ge.inDragLayer==null&&ge.addToList==null)){var ke=de.descendants();ge.inDragLayer&&(ke.forEach(u),ke.connectedEdges().forEach(u)),ge.addToList&&g(ke,ge)}},S=function(de,ge){ge=ge||{};var ke=de.cy().hasCompoundNodes();ge.inDragLayer&&(de.forEach(u),de.neighborhood().stdFilter(function(Ee){return!ke||Ee.isEdge()}).forEach(u)),ge.addToList&&de.forEach(function(Ee){g(Ee,ge)}),y(de,ge),_(de,{inDragLayer:ge.inDragLayer}),t.updateCachedGrabbedEles()},w=S,C=function(de){de&&(t.getCachedZSortedEles().forEach(function(ge){l(ge),c(ge),p(ge)}),t.updateCachedGrabbedEles())},_=function(de,ge){if(!(ge.inDragLayer==null&&ge.addToList==null)&&de.cy().hasCompoundNodes()){var ke=de.ancestors().orphans();if(!ke.same(de)){var Ee=ke.descendants().spawnSelf().merge(ke).unmerge(de).unmerge(de.descendants()),Le=Ee.connectedEdges();ge.inDragLayer&&(Le.forEach(u),Ee.forEach(u)),ge.addToList&&Ee.forEach(function(Qe){g(Qe,ge)})}}},T=function(){document.activeElement!=null&&document.activeElement.blur!=null&&document.activeElement.blur()},N=typeof MutationObserver<"u",R=typeof ResizeObserver<"u";N?(t.removeObserver=new MutationObserver(function(Fe){for(var de=0;de<Fe.length;de++){var ge=Fe[de],ke=ge.removedNodes;if(ke)for(var Ee=0;Ee<ke.length;Ee++){var Le=ke[Ee];if(Le===t.container){t.destroy();break}}}}),t.container.parentNode&&t.removeObserver.observe(t.container.parentNode,{childList:!0})):t.registerBinding(t.container,"DOMNodeRemoved",function(Fe){t.destroy()});var I=Qv(function(){t.cy.resize()},100);N&&(t.styleObserver=new MutationObserver(I),t.styleObserver.observe(t.container,{attributes:!0})),t.registerBinding(e,"resize",I),R&&(t.resizeObserver=new ResizeObserver(I),t.resizeObserver.observe(t.container));var j=function(de,ge){for(;de!=null;)ge(de),de=de.parentNode},O=function(){t.invalidateContainerClientCoordsCache()};j(t.container,function(Fe){t.registerBinding(Fe,"transitionend",O),t.registerBinding(Fe,"animationend",O),t.registerBinding(Fe,"scroll",O)}),t.registerBinding(t.container,"contextmenu",function(Fe){Fe.preventDefault()});var F=function(){return t.selection[4]!==0},z=function(de){for(var ge=t.findContainerClientCoords(),ke=ge[0],Ee=ge[1],Le=ge[2],Qe=ge[3],Ve=de.touches?de.touches:[de],xt=!1,ze=0;ze<Ve.length;ze++){var $e=Ve[ze];if(ke<=$e.clientX&&$e.clientX<=ke+Le&&Ee<=$e.clientY&&$e.clientY<=Ee+Qe){xt=!0;break}}if(!xt)return!1;for(var wt=t.container,Pt=de.target,Ct=Pt.parentNode,Vt=!1;Ct;){if(Ct===wt){Vt=!0;break}Ct=Ct.parentNode}return!!Vt};t.registerBinding(t.container,"mousedown",function(de){if(z(de)&&!(t.hoverData.which===1&&de.which!==1)){de.preventDefault(),T(),t.hoverData.capture=!0,t.hoverData.which=de.which;var ge=t.cy,ke=[de.clientX,de.clientY],Ee=t.projectIntoViewport(ke[0],ke[1]),Le=t.selection,Qe=t.findNearestElements(Ee[0],Ee[1],!0,!1),Ve=Qe[0],xt=t.dragData.possibleDragElements;t.hoverData.mdownPos=Ee,t.hoverData.mdownGPos=ke;var ze=function(Yt){return{originalEvent:de,type:Yt,position:{x:Ee[0],y:Ee[1]}}},$e=function(){t.hoverData.tapholdCancelled=!1,clearTimeout(t.hoverData.tapholdTimeout),t.hoverData.tapholdTimeout=setTimeout(function(){if(!t.hoverData.tapholdCancelled){var Yt=t.hoverData.down;Yt?Yt.emit(ze("taphold")):ge.emit(ze("taphold"))}},t.tapholdDuration)};if(de.which==3){t.hoverData.cxtStarted=!0;var wt={originalEvent:de,type:"cxttapstart",position:{x:Ee[0],y:Ee[1]}};Ve?(Ve.activate(),Ve.emit(wt),t.hoverData.down=Ve):ge.emit(wt),t.hoverData.downTime=new Date().getTime(),t.hoverData.cxtDragged=!1}else if(de.which==1){Ve&&Ve.activate();{if(Ve!=null&&t.nodeIsGrabbable(Ve)){var Pt=function(Yt){Yt.emit(ze("grab"))};if(h(Ve),!Ve.selected())xt=t.dragData.possibleDragElements=ge.collection(),w(Ve,{addToList:xt}),Ve.emit(ze("grabon")).emit(ze("grab"));else{xt=t.dragData.possibleDragElements=ge.collection();var Ct=ge.$(function(Vt){return Vt.isNode()&&Vt.selected()&&t.nodeIsGrabbable(Vt)});S(Ct,{addToList:xt}),Ve.emit(ze("grabon")),Ct.forEach(Pt)}t.redrawHint("eles",!0),t.redrawHint("drag",!0)}t.hoverData.down=Ve,t.hoverData.downs=Qe,t.hoverData.downTime=new Date().getTime()}i(Ve,["mousedown","tapstart","vmousedown"],de,{x:Ee[0],y:Ee[1]}),Ve==null?(Le[4]=1,t.data.bgActivePosistion={x:Ee[0],y:Ee[1]},t.redrawHint("select",!0),t.redraw()):Ve.pannable()&&(Le[4]=1),$e()}Le[0]=Le[2]=Ee[0],Le[1]=Le[3]=Ee[1]}},!1);var V=n(t.container);t.registerBinding([e,V],"mousemove",function(de){var ge=t.hoverData.capture;if(!(!ge&&!z(de))){var ke=!1,Ee=t.cy,Le=Ee.zoom(),Qe=[de.clientX,de.clientY],Ve=t.projectIntoViewport(Qe[0],Qe[1]),xt=t.hoverData.mdownPos,ze=t.hoverData.mdownGPos,$e=t.selection,wt=null;!t.hoverData.draggingEles&&!t.hoverData.dragging&&!t.hoverData.selecting&&(wt=t.findNearestElement(Ve[0],Ve[1],!0,!1));var Pt=t.hoverData.last,Ct=t.hoverData.down,Vt=[Ve[0]-$e[2],Ve[1]-$e[3]],Yt=t.dragData.possibleDragElements,Lr;if(ze){var kr=Qe[0]-ze[0],Qr=kr*kr,Jr=Qe[1]-ze[1],_r=Jr*Jr,hn=Qr+_r;t.hoverData.isOverThresholdDrag=Lr=hn>=t.desktopTapThreshold2}var vr=a(de);Lr&&(t.hoverData.tapholdCancelled=!0);var Et=function(){var gi=t.hoverData.dragDelta=t.hoverData.dragDelta||[];gi.length===0?(gi.push(Vt[0]),gi.push(Vt[1])):(gi[0]+=Vt[0],gi[1]+=Vt[1])};ke=!0,i(wt,["mousemove","vmousemove","tapdrag"],de,{x:Ve[0],y:Ve[1]});var Br=function(gi){return{originalEvent:de,type:gi,position:{x:Ve[0],y:Ve[1]}}},Xn=function(){t.data.bgActivePosistion=void 0,t.hoverData.selecting||Ee.emit(Br("boxstart")),$e[4]=1,t.hoverData.selecting=!0,t.redrawHint("select",!0),t.redraw()};if(t.hoverData.which===3){if(Lr){var Zi=Br("cxtdrag");Ct?Ct.emit(Zi):Ee.emit(Zi),t.hoverData.cxtDragged=!0,(!t.hoverData.cxtOver||wt!==t.hoverData.cxtOver)&&(t.hoverData.cxtOver&&t.hoverData.cxtOver.emit(Br("cxtdragout")),t.hoverData.cxtOver=wt,wt&&wt.emit(Br("cxtdragover")))}}else if(t.hoverData.dragging){if(ke=!0,Ee.panningEnabled()&&Ee.userPanningEnabled()){var ds;if(t.hoverData.justStartedPan){var As=t.hoverData.mdownPos;ds={x:(Ve[0]-As[0])*Le,y:(Ve[1]-As[1])*Le},t.hoverData.justStartedPan=!1}else ds={x:Vt[0]*Le,y:Vt[1]*Le};Ee.panBy(ds),Ee.emit(Br("dragpan")),t.hoverData.dragged=!0}Ve=t.projectIntoViewport(de.clientX,de.clientY)}else if($e[4]==1&&(Ct==null||Ct.pannable())){if(Lr){if(!t.hoverData.dragging&&Ee.boxSelectionEnabled()&&(vr||!Ee.panningEnabled()||!Ee.userPanningEnabled()))Xn();else if(!t.hoverData.selecting&&Ee.panningEnabled()&&Ee.userPanningEnabled()){var ni=s(Ct,t.hoverData.downs);ni&&(t.hoverData.dragging=!0,t.hoverData.justStartedPan=!0,$e[4]=0,t.data.bgActivePosistion=Lp(xt),t.redrawHint("select",!0),t.redraw())}Ct&&Ct.pannable()&&Ct.active()&&Ct.unactivate()}}else{if(Ct&&Ct.pannable()&&Ct.active()&&Ct.unactivate(),(!Ct||!Ct.grabbed())&&wt!=Pt&&(Pt&&i(Pt,["mouseout","tapdragout"],de,{x:Ve[0],y:Ve[1]}),wt&&i(wt,["mouseover","tapdragover"],de,{x:Ve[0],y:Ve[1]}),t.hoverData.last=wt),Ct)if(Lr){if(Ee.boxSelectionEnabled()&&vr)Ct&&Ct.grabbed()&&(C(Yt),Ct.emit(Br("freeon")),Yt.emit(Br("free")),t.dragData.didDrag&&(Ct.emit(Br("dragfreeon")),Yt.emit(Br("dragfree")))),Xn();else if(Ct&&Ct.grabbed()&&t.nodeIsDraggable(Ct)){var sn=!t.dragData.didDrag;sn&&t.redrawHint("eles",!0),t.dragData.didDrag=!0,t.hoverData.draggingEles||S(Yt,{inDragLayer:!0});var kn={x:0,y:0};if(kt(Vt[0])&&kt(Vt[1])&&(kn.x+=Vt[0],kn.y+=Vt[1],sn)){var In=t.hoverData.dragDelta;In&&kt(In[0])&&kt(In[1])&&(kn.x+=In[0],kn.y+=In[1])}t.hoverData.draggingEles=!0,Yt.silentShift(kn).emit(Br("position")).emit(Br("drag")),t.redrawHint("drag",!0),t.redraw()}}else Et();ke=!0}if($e[2]=Ve[0],$e[3]=Ve[1],ke)return de.stopPropagation&&de.stopPropagation(),de.preventDefault&&de.preventDefault(),!1}},!1);var q,D,U;t.registerBinding(e,"mouseup",function(de){if(!(t.hoverData.which===1&&de.which!==1&&t.hoverData.capture)){var ge=t.hoverData.capture;if(ge){t.hoverData.capture=!1;var ke=t.cy,Ee=t.projectIntoViewport(de.clientX,de.clientY),Le=t.selection,Qe=t.findNearestElement(Ee[0],Ee[1],!0,!1),Ve=t.dragData.possibleDragElements,xt=t.hoverData.down,ze=a(de);t.data.bgActivePosistion&&(t.redrawHint("select",!0),t.redraw()),t.hoverData.tapholdCancelled=!0,t.data.bgActivePosistion=void 0,xt&&xt.unactivate();var $e=function(kr){return{originalEvent:de,type:kr,position:{x:Ee[0],y:Ee[1]}}};if(t.hoverData.which===3){var wt=$e("cxttapend");if(xt?xt.emit(wt):ke.emit(wt),!t.hoverData.cxtDragged){var Pt=$e("cxttap");xt?xt.emit(Pt):ke.emit(Pt)}t.hoverData.cxtDragged=!1,t.hoverData.which=null}else if(t.hoverData.which===1){if(i(Qe,["mouseup","tapend","vmouseup"],de,{x:Ee[0],y:Ee[1]}),!t.dragData.didDrag&&!t.hoverData.dragged&&!t.hoverData.selecting&&!t.hoverData.isOverThresholdDrag&&(i(xt,["click","tap","vclick"],de,{x:Ee[0],y:Ee[1]}),D=!1,de.timeStamp-U<=ke.multiClickDebounceTime()?(q&&clearTimeout(q),D=!0,U=null,i(xt,["dblclick","dbltap","vdblclick"],de,{x:Ee[0],y:Ee[1]})):(q=setTimeout(function(){D||i(xt,["oneclick","onetap","voneclick"],de,{x:Ee[0],y:Ee[1]})},ke.multiClickDebounceTime()),U=de.timeStamp)),xt==null&&!t.dragData.didDrag&&!t.hoverData.selecting&&!t.hoverData.dragged&&!a(de)&&(ke.$(r).unselect(["tapunselect"]),Ve.length>0&&t.redrawHint("eles",!0),t.dragData.possibleDragElements=Ve=ke.collection()),Qe==xt&&!t.dragData.didDrag&&!t.hoverData.selecting&&Qe!=null&&Qe._private.selectable&&(t.hoverData.dragging||(ke.selectionType()==="additive"||ze?Qe.selected()?Qe.unselect(["tapunselect"]):Qe.select(["tapselect"]):ze||(ke.$(r).unmerge(Qe).unselect(["tapunselect"]),Qe.select(["tapselect"]))),t.redrawHint("eles",!0)),t.hoverData.selecting){var Ct=ke.collection(t.getAllInBox(Le[0],Le[1],Le[2],Le[3]));t.redrawHint("select",!0),Ct.length>0&&t.redrawHint("eles",!0),ke.emit($e("boxend"));var Vt=function(kr){return kr.selectable()&&!kr.selected()};ke.selectionType()==="additive"||ze||ke.$(r).unmerge(Ct).unselect(),Ct.emit($e("box")).stdFilter(Vt).select().emit($e("boxselect")),t.redraw()}if(t.hoverData.dragging&&(t.hoverData.dragging=!1,t.redrawHint("select",!0),t.redrawHint("eles",!0),t.redraw()),!Le[4]){t.redrawHint("drag",!0),t.redrawHint("eles",!0);var Yt=xt&&xt.grabbed();C(Ve),Yt&&(xt.emit($e("freeon")),Ve.emit($e("free")),t.dragData.didDrag&&(xt.emit($e("dragfreeon")),Ve.emit($e("dragfree"))))}}Le[4]=0,t.hoverData.down=null,t.hoverData.cxtStarted=!1,t.hoverData.draggingEles=!1,t.hoverData.selecting=!1,t.hoverData.isOverThresholdDrag=!1,t.dragData.didDrag=!1,t.hoverData.dragged=!1,t.hoverData.dragDelta=[],t.hoverData.mdownPos=null,t.hoverData.mdownGPos=null,t.hoverData.which=null}}},!1);var G=[],Z=4,K,Q=1e5,ne=function(de,ge){for(var ke=0;ke<de.length;ke++)if(de[ke]%ge!==0)return!1;return!0},te=function(de){for(var ge=Math.abs(de[0]),ke=1;ke<de.length;ke++)if(Math.abs(de[ke])!==ge)return!1;return!0},X=function(de){var ge=!1,ke=de.deltaY;if(ke==null&&(de.wheelDeltaY!=null?ke=de.wheelDeltaY/4:de.wheelDelta!=null&&(ke=de.wheelDelta/4)),ke!==0){if(K==null)if(G.length>=Z){var Ee=G;if(K=ne(Ee,5),!K){var Le=Math.abs(Ee[0]);K=te(Ee)&&Le>5}if(K)for(var Qe=0;Qe<Ee.length;Qe++)Q=Math.min(Math.abs(Ee[Qe]),Q)}else G.push(ke),ge=!0;else K&&(Q=Math.min(Math.abs(ke),Q));if(!t.scrollingPage){var Ve=t.cy,xt=Ve.zoom(),ze=Ve.pan(),$e=t.projectIntoViewport(de.clientX,de.clientY),wt=[$e[0]*xt+ze.x,$e[1]*xt+ze.y];if(t.hoverData.draggingEles||t.hoverData.dragging||t.hoverData.cxtStarted||F()){de.preventDefault();return}if(Ve.panningEnabled()&&Ve.userPanningEnabled()&&Ve.zoomingEnabled()&&Ve.userZoomingEnabled()){de.preventDefault(),t.data.wheelZooming=!0,clearTimeout(t.data.wheelTimeout),t.data.wheelTimeout=setTimeout(function(){t.data.wheelZooming=!1,t.redrawHint("eles",!0),t.redraw()},150);var Pt;ge&&Math.abs(ke)>5&&(ke=i_(ke)*5),Pt=ke/-250,K&&(Pt/=Q,Pt*=3),Pt=Pt*t.wheelSensitivity;var Ct=de.deltaMode===1;Ct&&(Pt*=33);var Vt=Ve.zoom()*Math.pow(10,Pt);de.type==="gesturechange"&&(Vt=t.gestureStartZoom*de.scale),Ve.zoom({level:Vt,renderedPosition:{x:wt[0],y:wt[1]}}),Ve.emit({type:de.type==="gesturechange"?"pinchzoom":"scrollzoom",originalEvent:de,position:{x:$e[0],y:$e[1]}})}}}};t.registerBinding(t.container,"wheel",X,!0),t.registerBinding(e,"scroll",function(de){t.scrollingPage=!0,clearTimeout(t.scrollingPageTimeout),t.scrollingPageTimeout=setTimeout(function(){t.scrollingPage=!1},250)},!0),t.registerBinding(t.container,"gesturestart",function(de){t.gestureStartZoom=t.cy.zoom(),t.hasTouchStarted||de.preventDefault()},!0),t.registerBinding(t.container,"gesturechange",function(Fe){t.hasTouchStarted||X(Fe)},!0),t.registerBinding(t.container,"mouseout",function(de){var ge=t.projectIntoViewport(de.clientX,de.clientY);t.cy.emit({originalEvent:de,type:"mouseout",position:{x:ge[0],y:ge[1]}})},!1),t.registerBinding(t.container,"mouseover",function(de){var ge=t.projectIntoViewport(de.clientX,de.clientY);t.cy.emit({originalEvent:de,type:"mouseover",position:{x:ge[0],y:ge[1]}})},!1);var re,he,oe,se,fe,ae,pe,ye,ve,ue,xe,Se,Oe,Ae=function(de,ge,ke,Ee){return Math.sqrt((ke-de)*(ke-de)+(Ee-ge)*(Ee-ge))},tt=function(de,ge,ke,Ee){return(ke-de)*(ke-de)+(Ee-ge)*(Ee-ge)},rt;t.registerBinding(t.container,"touchstart",rt=function(de){if(t.hasTouchStarted=!0,!!z(de)){T(),t.touchData.capture=!0,t.data.bgActivePosistion=void 0;var ge=t.cy,ke=t.touchData.now,Ee=t.touchData.earlier;if(de.touches[0]){var Le=t.projectIntoViewport(de.touches[0].clientX,de.touches[0].clientY);ke[0]=Le[0],ke[1]=Le[1]}if(de.touches[1]){var Le=t.projectIntoViewport(de.touches[1].clientX,de.touches[1].clientY);ke[2]=Le[0],ke[3]=Le[1]}if(de.touches[2]){var Le=t.projectIntoViewport(de.touches[2].clientX,de.touches[2].clientY);ke[4]=Le[0],ke[5]=Le[1]}var Qe=function(vr){return{originalEvent:de,type:vr,position:{x:ke[0],y:ke[1]}}};if(de.touches[1]){t.touchData.singleTouchMoved=!0,C(t.dragData.touchDragEles);var Ve=t.findContainerClientCoords();ve=Ve[0],ue=Ve[1],xe=Ve[2],Se=Ve[3],re=de.touches[0].clientX-ve,he=de.touches[0].clientY-ue,oe=de.touches[1].clientX-ve,se=de.touches[1].clientY-ue,Oe=0<=re&&re<=xe&&0<=oe&&oe<=xe&&0<=he&&he<=Se&&0<=se&&se<=Se;var xt=ge.pan(),ze=ge.zoom();fe=Ae(re,he,oe,se),ae=tt(re,he,oe,se),pe=[(re+oe)/2,(he+se)/2],ye=[(pe[0]-xt.x)/ze,(pe[1]-xt.y)/ze];var $e=200,wt=$e*$e;if(ae<wt&&!de.touches[2]){var Pt=t.findNearestElement(ke[0],ke[1],!0,!0),Ct=t.findNearestElement(ke[2],ke[3],!0,!0);Pt&&Pt.isNode()?(Pt.activate().emit(Qe("cxttapstart")),t.touchData.start=Pt):Ct&&Ct.isNode()?(Ct.activate().emit(Qe("cxttapstart")),t.touchData.start=Ct):ge.emit(Qe("cxttapstart")),t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxt=!0,t.touchData.cxtDragged=!1,t.data.bgActivePosistion=void 0,t.redraw();return}}if(de.touches[2])ge.boxSelectionEnabled()&&de.preventDefault();else if(!de.touches[1]){if(de.touches[0]){var Vt=t.findNearestElements(ke[0],ke[1],!0,!0),Yt=Vt[0];if(Yt!=null&&(Yt.activate(),t.touchData.start=Yt,t.touchData.starts=Vt,t.nodeIsGrabbable(Yt))){var Lr=t.dragData.touchDragEles=ge.collection(),kr=null;t.redrawHint("eles",!0),t.redrawHint("drag",!0),Yt.selected()?(kr=ge.$(function(hn){return hn.selected()&&t.nodeIsGrabbable(hn)}),S(kr,{addToList:Lr})):w(Yt,{addToList:Lr}),h(Yt),Yt.emit(Qe("grabon")),kr?kr.forEach(function(hn){hn.emit(Qe("grab"))}):Yt.emit(Qe("grab"))}i(Yt,["touchstart","tapstart","vmousedown"],de,{x:ke[0],y:ke[1]}),Yt==null&&(t.data.bgActivePosistion={x:Le[0],y:Le[1]},t.redrawHint("select",!0),t.redraw()),t.touchData.singleTouchMoved=!1,t.touchData.singleTouchStartTime=+new Date,clearTimeout(t.touchData.tapholdTimeout),t.touchData.tapholdTimeout=setTimeout(function(){t.touchData.singleTouchMoved===!1&&!t.pinching&&!t.touchData.selecting&&i(t.touchData.start,["taphold"],de,{x:ke[0],y:ke[1]})},t.tapholdDuration)}}if(de.touches.length>=1){for(var Qr=t.touchData.startPosition=[null,null,null,null,null,null],Jr=0;Jr<ke.length;Jr++)Qr[Jr]=Ee[Jr]=ke[Jr];var _r=de.touches[0];t.touchData.startGPosition=[_r.clientX,_r.clientY]}}},!1);var dt;t.registerBinding(e,"touchmove",dt=function(de){var ge=t.touchData.capture;if(!(!ge&&!z(de))){var ke=t.selection,Ee=t.cy,Le=t.touchData.now,Qe=t.touchData.earlier,Ve=Ee.zoom();if(de.touches[0]){var xt=t.projectIntoViewport(de.touches[0].clientX,de.touches[0].clientY);Le[0]=xt[0],Le[1]=xt[1]}if(de.touches[1]){var xt=t.projectIntoViewport(de.touches[1].clientX,de.touches[1].clientY);Le[2]=xt[0],Le[3]=xt[1]}if(de.touches[2]){var xt=t.projectIntoViewport(de.touches[2].clientX,de.touches[2].clientY);Le[4]=xt[0],Le[5]=xt[1]}var ze=function(Ir){return{originalEvent:de,type:Ir,position:{x:Le[0],y:Le[1]}}},$e=t.touchData.startGPosition,wt;if(ge&&de.touches[0]&&$e){for(var Pt=[],Ct=0;Ct<Le.length;Ct++)Pt[Ct]=Le[Ct]-Qe[Ct];var Vt=de.touches[0].clientX-$e[0],Yt=Vt*Vt,Lr=de.touches[0].clientY-$e[1],kr=Lr*Lr,Qr=Yt+kr;wt=Qr>=t.touchTapThreshold2}if(ge&&t.touchData.cxt){de.preventDefault();var Jr=de.touches[0].clientX-ve,_r=de.touches[0].clientY-ue,hn=de.touches[1].clientX-ve,vr=de.touches[1].clientY-ue,Et=tt(Jr,_r,hn,vr),Br=Et/ae,Xn=150,Zi=Xn*Xn,ds=1.5,As=ds*ds;if(Br>=As||Et>=Zi){t.touchData.cxt=!1,t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var ni=ze("cxttapend");t.touchData.start?(t.touchData.start.unactivate().emit(ni),t.touchData.start=null):Ee.emit(ni)}}if(ge&&t.touchData.cxt){var ni=ze("cxtdrag");t.data.bgActivePosistion=void 0,t.redrawHint("select",!0),t.touchData.start?t.touchData.start.emit(ni):Ee.emit(ni),t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxtDragged=!0;var sn=t.findNearestElement(Le[0],Le[1],!0,!0);(!t.touchData.cxtOver||sn!==t.touchData.cxtOver)&&(t.touchData.cxtOver&&t.touchData.cxtOver.emit(ze("cxtdragout")),t.touchData.cxtOver=sn,sn&&sn.emit(ze("cxtdragover")))}else if(ge&&de.touches[2]&&Ee.boxSelectionEnabled())de.preventDefault(),t.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,t.touchData.selecting||Ee.emit(ze("boxstart")),t.touchData.selecting=!0,t.touchData.didSelect=!0,ke[4]=1,!ke||ke.length===0||ke[0]===void 0?(ke[0]=(Le[0]+Le[2]+Le[4])/3,ke[1]=(Le[1]+Le[3]+Le[5])/3,ke[2]=(Le[0]+Le[2]+Le[4])/3+1,ke[3]=(Le[1]+Le[3]+Le[5])/3+1):(ke[2]=(Le[0]+Le[2]+Le[4])/3,ke[3]=(Le[1]+Le[3]+Le[5])/3),t.redrawHint("select",!0),t.redraw();else if(ge&&de.touches[1]&&!t.touchData.didSelect&&Ee.zoomingEnabled()&&Ee.panningEnabled()&&Ee.userZoomingEnabled()&&Ee.userPanningEnabled()){de.preventDefault(),t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var kn=t.dragData.touchDragEles;if(kn){t.redrawHint("drag",!0);for(var In=0;In<kn.length;In++){var Ls=kn[In]._private;Ls.grabbed=!1,Ls.rscratch.inDragLayer=!1}}var gi=t.touchData.start,Jr=de.touches[0].clientX-ve,_r=de.touches[0].clientY-ue,hn=de.touches[1].clientX-ve,vr=de.touches[1].clientY-ue,ko=Ae(Jr,_r,hn,vr),qa=ko/fe;if(Oe){var Ru=Jr-re,_o=_r-he,on=hn-oe,Co=vr-se,hs=(Ru+on)/2,ro=(_o+Co)/2,Yi=Ee.zoom(),no=Yi*qa,Ge=Ee.pan(),Ye=ye[0]*Yi+Ge.x,nt=ye[1]*Yi+Ge.y,pt={x:-no/Yi*(Ye-Ge.x-hs)+Ye,y:-no/Yi*(nt-Ge.y-ro)+nt};if(gi&&gi.active()){var kn=t.dragData.touchDragEles;C(kn),t.redrawHint("drag",!0),t.redrawHint("eles",!0),gi.unactivate().emit(ze("freeon")),kn.emit(ze("free")),t.dragData.didDrag&&(gi.emit(ze("dragfreeon")),kn.emit(ze("dragfree")))}Ee.viewport({zoom:no,pan:pt,cancelOnFailedZoom:!0}),Ee.emit(ze("pinchzoom")),fe=ko,re=Jr,he=_r,oe=hn,se=vr,t.pinching=!0}if(de.touches[0]){var xt=t.projectIntoViewport(de.touches[0].clientX,de.touches[0].clientY);Le[0]=xt[0],Le[1]=xt[1]}if(de.touches[1]){var xt=t.projectIntoViewport(de.touches[1].clientX,de.touches[1].clientY);Le[2]=xt[0],Le[3]=xt[1]}if(de.touches[2]){var xt=t.projectIntoViewport(de.touches[2].clientX,de.touches[2].clientY);Le[4]=xt[0],Le[5]=xt[1]}}else if(de.touches[0]&&!t.touchData.didSelect){var Ze=t.touchData.start,Dt=t.touchData.last,sn;if(!t.hoverData.draggingEles&&!t.swipePanning&&(sn=t.findNearestElement(Le[0],Le[1],!0,!0)),ge&&Ze!=null&&de.preventDefault(),ge&&Ze!=null&&t.nodeIsDraggable(Ze))if(wt){var kn=t.dragData.touchDragEles,Nr=!t.dragData.didDrag;Nr&&S(kn,{inDragLayer:!0}),t.dragData.didDrag=!0;var Pr={x:0,y:0};if(kt(Pt[0])&&kt(Pt[1])&&(Pr.x+=Pt[0],Pr.y+=Pt[1],Nr)){t.redrawHint("eles",!0);var Fr=t.touchData.dragDelta;Fr&&kt(Fr[0])&&kt(Fr[1])&&(Pr.x+=Fr[0],Pr.y+=Fr[1])}t.hoverData.draggingEles=!0,kn.silentShift(Pr).emit(ze("position")).emit(ze("drag")),t.redrawHint("drag",!0),t.touchData.startPosition[0]==Qe[0]&&t.touchData.startPosition[1]==Qe[1]&&t.redrawHint("eles",!0),t.redraw()}else{var Fr=t.touchData.dragDelta=t.touchData.dragDelta||[];Fr.length===0?(Fr.push(Pt[0]),Fr.push(Pt[1])):(Fr[0]+=Pt[0],Fr[1]+=Pt[1])}if(i(Ze||sn,["touchmove","tapdrag","vmousemove"],de,{x:Le[0],y:Le[1]}),(!Ze||!Ze.grabbed())&&sn!=Dt&&(Dt&&Dt.emit(ze("tapdragout")),sn&&sn.emit(ze("tapdragover"))),t.touchData.last=sn,ge)for(var In=0;In<Le.length;In++)Le[In]&&t.touchData.startPosition[In]&&wt&&(t.touchData.singleTouchMoved=!0);if(ge&&(Ze==null||Ze.pannable())&&Ee.panningEnabled()&&Ee.userPanningEnabled()){var vi=s(Ze,t.touchData.starts);vi&&(de.preventDefault(),t.data.bgActivePosistion||(t.data.bgActivePosistion=Lp(t.touchData.startPosition)),t.swipePanning?(Ee.panBy({x:Pt[0]*Ve,y:Pt[1]*Ve}),Ee.emit(ze("dragpan"))):wt&&(t.swipePanning=!0,Ee.panBy({x:Vt*Ve,y:Lr*Ve}),Ee.emit(ze("dragpan")),Ze&&(Ze.unactivate(),t.redrawHint("select",!0),t.touchData.start=null)));var xt=t.projectIntoViewport(de.touches[0].clientX,de.touches[0].clientY);Le[0]=xt[0],Le[1]=xt[1]}}for(var Ct=0;Ct<Le.length;Ct++)Qe[Ct]=Le[Ct];ge&&de.touches.length>0&&!t.hoverData.draggingEles&&!t.swipePanning&&t.data.bgActivePosistion!=null&&(t.data.bgActivePosistion=void 0,t.redrawHint("select",!0),t.redraw())}},!1);var _t;t.registerBinding(e,"touchcancel",_t=function(de){var ge=t.touchData.start;t.touchData.capture=!1,ge&&ge.unactivate()});var Xe,ht,ct,vt;if(t.registerBinding(e,"touchend",Xe=function(de){var ge=t.touchData.start,ke=t.touchData.capture;if(ke)de.touches.length===0&&(t.touchData.capture=!1),de.preventDefault();else return;var Ee=t.selection;t.swipePanning=!1,t.hoverData.draggingEles=!1;var Le=t.cy,Qe=Le.zoom(),Ve=t.touchData.now,xt=t.touchData.earlier;if(de.touches[0]){var ze=t.projectIntoViewport(de.touches[0].clientX,de.touches[0].clientY);Ve[0]=ze[0],Ve[1]=ze[1]}if(de.touches[1]){var ze=t.projectIntoViewport(de.touches[1].clientX,de.touches[1].clientY);Ve[2]=ze[0],Ve[3]=ze[1]}if(de.touches[2]){var ze=t.projectIntoViewport(de.touches[2].clientX,de.touches[2].clientY);Ve[4]=ze[0],Ve[5]=ze[1]}var $e=function(Zi){return{originalEvent:de,type:Zi,position:{x:Ve[0],y:Ve[1]}}};ge&&ge.unactivate();var wt;if(t.touchData.cxt){if(wt=$e("cxttapend"),ge?ge.emit(wt):Le.emit(wt),!t.touchData.cxtDragged){var Pt=$e("cxttap");ge?ge.emit(Pt):Le.emit(Pt)}t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxt=!1,t.touchData.start=null,t.redraw();return}if(!de.touches[2]&&Le.boxSelectionEnabled()&&t.touchData.selecting){t.touchData.selecting=!1;var Ct=Le.collection(t.getAllInBox(Ee[0],Ee[1],Ee[2],Ee[3]));Ee[0]=void 0,Ee[1]=void 0,Ee[2]=void 0,Ee[3]=void 0,Ee[4]=0,t.redrawHint("select",!0),Le.emit($e("boxend"));var Vt=function(Zi){return Zi.selectable()&&!Zi.selected()};Ct.emit($e("box")).stdFilter(Vt).select().emit($e("boxselect")),Ct.nonempty()&&t.redrawHint("eles",!0),t.redraw()}if(ge?.unactivate(),de.touches[2])t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);else if(!de.touches[1]){if(!de.touches[0]){if(!de.touches[0]){t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var Yt=t.dragData.touchDragEles;if(ge!=null){var Lr=ge._private.grabbed;C(Yt),t.redrawHint("drag",!0),t.redrawHint("eles",!0),Lr&&(ge.emit($e("freeon")),Yt.emit($e("free")),t.dragData.didDrag&&(ge.emit($e("dragfreeon")),Yt.emit($e("dragfree")))),i(ge,["touchend","tapend","vmouseup","tapdragout"],de,{x:Ve[0],y:Ve[1]}),ge.unactivate(),t.touchData.start=null}else{var kr=t.findNearestElement(Ve[0],Ve[1],!0,!0);i(kr,["touchend","tapend","vmouseup","tapdragout"],de,{x:Ve[0],y:Ve[1]})}var Qr=t.touchData.startPosition[0]-Ve[0],Jr=Qr*Qr,_r=t.touchData.startPosition[1]-Ve[1],hn=_r*_r,vr=Jr+hn,Et=vr*Qe*Qe;t.touchData.singleTouchMoved||(ge||Le.$(":selected").unselect(["tapunselect"]),i(ge,["tap","vclick"],de,{x:Ve[0],y:Ve[1]}),ht=!1,de.timeStamp-vt<=Le.multiClickDebounceTime()?(ct&&clearTimeout(ct),ht=!0,vt=null,i(ge,["dbltap","vdblclick"],de,{x:Ve[0],y:Ve[1]})):(ct=setTimeout(function(){ht||i(ge,["onetap","voneclick"],de,{x:Ve[0],y:Ve[1]})},Le.multiClickDebounceTime()),vt=de.timeStamp)),ge!=null&&!t.dragData.didDrag&&ge._private.selectable&&Et<t.touchTapThreshold2&&!t.pinching&&(Le.selectionType()==="single"?(Le.$(r).unmerge(ge).unselect(["tapunselect"]),ge.select(["tapselect"])):ge.selected()?ge.unselect(["tapunselect"]):ge.select(["tapselect"]),t.redrawHint("eles",!0)),t.touchData.singleTouchMoved=!0}}}for(var Br=0;Br<Ve.length;Br++)xt[Br]=Ve[Br];t.dragData.didDrag=!1,de.touches.length===0&&(t.touchData.dragDelta=[],t.touchData.startPosition=[null,null,null,null,null,null],t.touchData.startGPosition=null,t.touchData.didSelect=!1),de.touches.length<2&&(de.touches.length===1&&(t.touchData.startGPosition=[de.touches[0].clientX,de.touches[0].clientY]),t.pinching=!1,t.redrawHint("eles",!0),t.redraw())},!1),typeof TouchEvent>"u"){var lt=[],Lt=function(de){return{clientX:de.clientX,clientY:de.clientY,force:1,identifier:de.pointerId,pageX:de.pageX,pageY:de.pageY,radiusX:de.width/2,radiusY:de.height/2,screenX:de.screenX,screenY:de.screenY,target:de.target}},jt=function(de){return{event:de,touch:Lt(de)}},Ne=function(de){lt.push(jt(de))},qe=function(de){for(var ge=0;ge<lt.length;ge++){var ke=lt[ge];if(ke.event.pointerId===de.pointerId){lt.splice(ge,1);return}}},bt=function(de){var ge=lt.filter(function(ke){return ke.event.pointerId===de.pointerId})[0];ge.event=de,ge.touch=Lt(de)},at=function(de){de.touches=lt.map(function(ge){return ge.touch})},ut=function(de){return de.pointerType==="mouse"||de.pointerType===4};t.registerBinding(t.container,"pointerdown",function(Fe){ut(Fe)||(Fe.preventDefault(),Ne(Fe),at(Fe),rt(Fe))}),t.registerBinding(t.container,"pointerup",function(Fe){ut(Fe)||(qe(Fe),at(Fe),Xe(Fe))}),t.registerBinding(t.container,"pointercancel",function(Fe){ut(Fe)||(qe(Fe),at(Fe),_t(Fe))}),t.registerBinding(t.container,"pointermove",function(Fe){ut(Fe)||(Fe.preventDefault(),bt(Fe),at(Fe),dt(Fe))})}};var wc={};wc.generatePolygon=function(t,e){return this.nodeShapes[t]={renderer:this,name:t,points:e,draw:function(n,i,a,s,o,l){this.renderer.nodeShapeImpl("polygon",n,i,a,s,o,this.points)},intersectLine:function(n,i,a,s,o,l,u,c){return Sv(o,l,this.points,n,i,a/2,s/2,u)},checkPoint:function(n,i,a,s,o,l,u,c){return yc(n,i,this.points,l,u,s,o,[0,-1],a)},hasMiterBounds:t!=="rectangle",miterBounds:function(n,i,a,s,o,l){return J9(this.points,n,i,a,s,o)}}};wc.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a)},intersectLine:function(e,r,n,i,a,s,o,l){return oF(a,s,e,r,n/2+o,i/2+o)},checkPoint:function(e,r,n,i,a,s,o,l){return tf(e,r,i,a,s,o,n)}}};wc.generateRoundPolygon=function(t,e){return this.nodeShapes[t]={renderer:this,name:t,points:e,getOrCreateCorners:function(n,i,a,s,o,l,u){if(l[u]!==void 0&&l[u+"-cx"]===n&&l[u+"-cy"]===i)return l[u];l[u]=new Array(e.length/2),l[u+"-cx"]=n,l[u+"-cy"]=i;var c=a/2,h=s/2;o=o==="auto"?XM(a,s):o;for(var p=new Array(e.length/2),g=0;g<e.length/2;g++)p[g]={x:n+c*e[g*2],y:i+h*e[g*2+1]};var y,S,w,C,_=p.length;for(S=p[_-1],y=0;y<_;y++)w=p[y%_],C=p[(y+1)%_],l[u][y]=v_(S,w,C,o),S=w,w=C;return l[u]},draw:function(n,i,a,s,o,l,u){this.renderer.nodeShapeImpl("round-polygon",n,i,a,s,o,this.points,this.getOrCreateCorners(i,a,s,o,l,u,"drawCorners"))},intersectLine:function(n,i,a,s,o,l,u,c,h){return uF(o,l,this.points,n,i,a,s,u,this.getOrCreateCorners(n,i,a,s,c,h,"corners"))},checkPoint:function(n,i,a,s,o,l,u,c,h){return sF(n,i,this.points,l,u,s,o,this.getOrCreateCorners(l,u,s,o,c,h,"corners"))}}};wc.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:Cs(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,this.points,s)},intersectLine:function(e,r,n,i,a,s,o,l){return ZM(a,s,e,r,n,i,o,l)},checkPoint:function(e,r,n,i,a,s,o,l){var u=i/2,c=a/2;l=l==="auto"?Xd(i,a):l,l=Math.min(u,c,l);var h=l*2;return!!(yc(e,r,this.points,s,o,i,a-h,[0,-1],n)||yc(e,r,this.points,s,o,i-h,a,[0,-1],n)||tf(e,r,h,h,s-u+l,o-c+l,n)||tf(e,r,h,h,s+u-l,o-c+l,n)||tf(e,r,h,h,s+u-l,o+c-l,n)||tf(e,r,h,h,s-u+l,o+c-l,n))}}};wc.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:s_(),points:Cs(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,null,s)},generateCutTrianglePts:function(e,r,n,i,a){var s=a==="auto"?this.cornerLength:a,o=r/2,l=e/2,u=n-l,c=n+l,h=i-o,p=i+o;return{topLeft:[u,h+s,u+s,h,u+s,h+s],topRight:[c-s,h,c,h+s,c-s,h+s],bottomRight:[c,p-s,c-s,p,c-s,p-s],bottomLeft:[u+s,p,u,p-s,u+s,p-s]}},intersectLine:function(e,r,n,i,a,s,o,l){var u=this.generateCutTrianglePts(n+2*o,i+2*o,e,r,l),c=[].concat.apply([],[u.topLeft.splice(0,4),u.topRight.splice(0,4),u.bottomRight.splice(0,4),u.bottomLeft.splice(0,4)]);return Sv(a,s,c,e,r)},checkPoint:function(e,r,n,i,a,s,o,l){var u=l==="auto"?this.cornerLength:l;if(yc(e,r,this.points,s,o,i,a-2*u,[0,-1],n)||yc(e,r,this.points,s,o,i-2*u,a,[0,-1],n))return!0;var c=this.generateCutTrianglePts(i,a,s,o);return Ks(e,r,c.topLeft)||Ks(e,r,c.topRight)||Ks(e,r,c.bottomRight)||Ks(e,r,c.bottomLeft)}}};wc.generateBarrel=function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:Cs(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a)},intersectLine:function(e,r,n,i,a,s,o,l){var u=.15,c=.5,h=.85,p=this.generateBarrelBezierPts(n+2*o,i+2*o,e,r),g=function(w){var C=jp({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},u),_=jp({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},c),T=jp({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},h);return[w[0],w[1],C.x,C.y,_.x,_.y,T.x,T.y,w[4],w[5]]},y=[].concat(g(p.topLeft),g(p.topRight),g(p.bottomRight),g(p.bottomLeft));return Sv(a,s,y,e,r)},generateBarrelBezierPts:function(e,r,n,i){var a=r/2,s=e/2,o=n-s,l=n+s,u=i-a,c=i+a,h=DS(e,r),p=h.heightOffset,g=h.widthOffset,y=h.ctrlPtOffsetPct*e,S={topLeft:[o,u+p,o+y,u,o+g,u],topRight:[l-g,u,l-y,u,l,u+p],bottomRight:[l,c-p,l-y,c,l-g,c],bottomLeft:[o+g,c,o+y,c,o,c-p]};return S.topLeft.isTop=!0,S.topRight.isTop=!0,S.bottomLeft.isBottom=!0,S.bottomRight.isBottom=!0,S},checkPoint:function(e,r,n,i,a,s,o,l){var u=DS(i,a),c=u.heightOffset,h=u.widthOffset;if(yc(e,r,this.points,s,o,i,a-2*c,[0,-1],n)||yc(e,r,this.points,s,o,i-2*h,a,[0,-1],n))return!0;for(var p=this.generateBarrelBezierPts(i,a,s,o),g=function(O,F,z){var V=z[4],q=z[2],D=z[0],U=z[5],G=z[1],Z=Math.min(V,D),K=Math.max(V,D),Q=Math.min(U,G),ne=Math.max(U,G);if(Z<=O&&O<=K&&Q<=F&&F<=ne){var te=cF(V,q,D),X=rF(te[0],te[1],te[2],O),re=X.filter(function(he){return 0<=he&&he<=1});if(re.length>0)return re[0]}return null},y=Object.keys(p),S=0;S<y.length;S++){var w=y[S],C=p[w],_=g(e,r,C);if(_!=null){var T=C[5],N=C[3],R=C[1],I=da(T,N,R,_);if(C.isTop&&I<=r||C.isBottom&&r<=I)return!0}}return!1}}};wc.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:Cs(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,this.points,s)},intersectLine:function(e,r,n,i,a,s,o,l){var u=e-(n/2+o),c=r-(i/2+o),h=c,p=e+(n/2+o),g=Dd(a,s,e,r,u,c,p,h,!1);return g.length>0?g:ZM(a,s,e,r,n,i,o,l)},checkPoint:function(e,r,n,i,a,s,o,l){l=l==="auto"?Xd(i,a):l;var u=2*l;if(yc(e,r,this.points,s,o,i,a-u,[0,-1],n)||yc(e,r,this.points,s,o,i-u,a,[0,-1],n))return!0;var c=i/2+2*n,h=a/2+2*n,p=[s-c,o-h,s-c,o,s+c,o,s+c,o-h];return!!(Ks(e,r,p)||tf(e,r,u,u,s+i/2-l,o+a/2-l,n)||tf(e,r,u,u,s-i/2+l,o+a/2-l,n))}}};wc.registerNodeShapes=function(){var t=this.nodeShapes={},e=this;this.generateEllipse(),this.generatePolygon("triangle",Cs(3,0)),this.generateRoundPolygon("round-triangle",Cs(3,0)),this.generatePolygon("rectangle",Cs(4,0)),t.square=t.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle();{var r=[0,1,1,0,0,-1,-1,0];this.generatePolygon("diamond",r),this.generateRoundPolygon("round-diamond",r)}this.generatePolygon("pentagon",Cs(5,0)),this.generateRoundPolygon("round-pentagon",Cs(5,0)),this.generatePolygon("hexagon",Cs(6,0)),this.generateRoundPolygon("round-hexagon",Cs(6,0)),this.generatePolygon("heptagon",Cs(7,0)),this.generateRoundPolygon("round-heptagon",Cs(7,0)),this.generatePolygon("octagon",Cs(8,0)),this.generateRoundPolygon("round-octagon",Cs(8,0));var n=new Array(20);{var i=OS(5,0),a=OS(5,Math.PI/5),s=.5*(3-Math.sqrt(5));s*=1.57;for(var o=0;o<a.length/2;o++)a[o*2]*=s,a[o*2+1]*=s;for(var o=0;o<20/4;o++)n[o*4]=i[o*2],n[o*4+1]=i[o*2+1],n[o*4+2]=a[o*2],n[o*4+3]=a[o*2+1]}n=YM(n),this.generatePolygon("star",n),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.generatePolygon("right-rhomboid",[-.333,-1,1,-1,.333,1,-1,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);{var l=[-1,-1,.25,-1,1,0,.25,1,-1,1];this.generatePolygon("tag",l),this.generateRoundPolygon("round-tag",l)}t.makePolygon=function(u){var c=u.join("$"),h="polygon-"+c,p;return(p=this[h])?p:e.generatePolygon(h,u)}};var n0={};n0.timeToRender=function(){return this.redrawTotalTime/this.redrawCount};n0.redraw=function(t){t=t||WM();var e=this;e.averageRedrawTime===void 0&&(e.averageRedrawTime=0),e.lastRedrawTime===void 0&&(e.lastRedrawTime=0),e.lastDrawTime===void 0&&(e.lastDrawTime=0),e.requestedFrame=!0,e.renderOptions=t};n0.beforeRender=function(t,e){if(!this.destroyed){e==null&&Kn("Priority is not optional for beforeRender");var r=this.beforeRenderCallbacks;r.push({fn:t,priority:e}),r.sort(function(n,i){return i.priority-n.priority})}};var BN=function(e,r,n){for(var i=e.beforeRenderCallbacks,a=0;a<i.length;a++)i[a].fn(r,n)};n0.startRenderLoop=function(){var t=this,e=t.cy;if(!t.renderLoopStarted){t.renderLoopStarted=!0;var r=function(i){if(!t.destroyed){if(!e.batching())if(t.requestedFrame&&!t.skipFrame){BN(t,!0,i);var a=vc();t.render(t.renderOptions);var s=t.lastDrawTime=vc();t.averageRedrawTime===void 0&&(t.averageRedrawTime=s-a),t.redrawCount===void 0&&(t.redrawCount=0),t.redrawCount++,t.redrawTotalTime===void 0&&(t.redrawTotalTime=0);var o=s-a;t.redrawTotalTime+=o,t.lastRedrawTime=o,t.averageRedrawTime=t.averageRedrawTime/2+o/2,t.requestedFrame=!1}else BN(t,!1,i);t.skipFrame=!1,ax(r)}};ax(r)}};var Ez=function(e){this.init(e)},XA=Ez,pm=XA.prototype;pm.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"];pm.init=function(t){var e=this;e.options=t,e.cy=t.cy;var r=e.container=t.cy.container(),n=e.cy.window();if(n){var i=n.document,a=i.head,s="__________cytoscape_stylesheet",o="__________cytoscape_container",l=i.getElementById(s)!=null;if(r.className.indexOf(o)<0&&(r.className=(r.className||"")+" "+o),!l){var u=i.createElement("style");u.id=s,u.textContent="."+o+" { position: relative; }",a.insertBefore(u,a.children[0])}var c=n.getComputedStyle(r),h=c.getPropertyValue("position");h==="static"&&an("A Cytoscape container has style position:static and so can not use UI extensions properly")}e.selection=[void 0,void 0,void 0,void 0,0],e.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],e.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},e.dragData={possibleDragElements:[]},e.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},e.redraws=0,e.showFps=t.showFps,e.debug=t.debug,e.webgl=t.webgl,e.hideEdgesOnViewport=t.hideEdgesOnViewport,e.textureOnViewport=t.textureOnViewport,e.wheelSensitivity=t.wheelSensitivity,e.motionBlurEnabled=t.motionBlur,e.forcedPixelRatio=kt(t.pixelRatio)?t.pixelRatio:null,e.motionBlur=t.motionBlur,e.motionBlurOpacity=t.motionBlurOpacity,e.motionBlurTransparency=1-e.motionBlurOpacity,e.motionBlurPxRatio=1,e.mbPxRBlurry=1,e.minMbLowQualFrames=4,e.fullQualityMb=!1,e.clearedForMotionBlur=[],e.desktopTapThreshold=t.desktopTapThreshold,e.desktopTapThreshold2=t.desktopTapThreshold*t.desktopTapThreshold,e.touchTapThreshold=t.touchTapThreshold,e.touchTapThreshold2=t.touchTapThreshold*t.touchTapThreshold,e.tapholdDuration=500,e.bindings=[],e.beforeRenderCallbacks=[],e.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},e.registerNodeShapes(),e.registerArrowShapes(),e.registerCalculationListeners()};pm.notify=function(t,e){var r=this,n=r.cy;if(!this.destroyed){if(t==="init"){r.load();return}if(t==="destroy"){r.destroy();return}(t==="add"||t==="remove"||t==="move"&&n.hasCompoundNodes()||t==="load"||t==="zorder"||t==="mount")&&r.invalidateCachedZSortedEles(),t==="viewport"&&r.redrawHint("select",!0),t==="gc"&&r.redrawHint("gc",!0),(t==="load"||t==="resize"||t==="mount")&&(r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container)),r.redrawHint("eles",!0),r.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()}};pm.destroy=function(){var t=this;t.destroyed=!0,t.cy.stopAnimationLoop();for(var e=0;e<t.bindings.length;e++){var r=t.bindings[e],n=r,i=n.target;(i.off||i.removeEventListener).apply(i,n.args)}if(t.bindings=[],t.beforeRenderCallbacks=[],t.onUpdateEleCalcsFns=[],t.removeObserver&&t.removeObserver.disconnect(),t.styleObserver&&t.styleObserver.disconnect(),t.resizeObserver&&t.resizeObserver.disconnect(),t.labelCalcDiv)try{document.body.removeChild(t.labelCalcDiv)}catch{}};pm.isHeadless=function(){return!1};[g_,ZA,YA,fm,wc,n0].forEach(function(t){ar(pm,t)});var d2=1e3/60,QA={setupDequeueing:function(e){return function(){var n=this,i=this.renderer;if(!n.dequeueingSetup){n.dequeueingSetup=!0;var a=Qv(function(){i.redrawHint("eles",!0),i.redrawHint("drag",!0),i.redraw()},e.deqRedrawThreshold),s=function(u,c){var h=vc(),p=i.averageRedrawTime,g=i.lastRedrawTime,y=[],S=i.cy.extent(),w=i.getPixelRatio();for(u||i.flushRenderedStyleQueue();;){var C=vc(),_=C-h,T=C-c;if(g<d2){var N=d2-(u?p:0);if(T>=e.deqFastCost*N)break}else if(u){if(_>=e.deqCost*g||_>=e.deqAvgCost*p)break}else if(T>=e.deqNoDrawCost*d2)break;var R=e.deq(n,w,S);if(R.length>0)for(var I=0;I<R.length;I++)y.push(R[I]);else break}y.length>0&&(e.onDeqd(n,y),!u&&e.shouldRedraw(n,y,w,S)&&a())},o=e.priority||t_;i.beforeRender(s,o(n))}}}},Tz=(function(){function t(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:sx;ah(this,t),this.idsByKey=new dc,this.keyForId=new dc,this.cachesByLvl=new dc,this.lvls=[],this.getKey=e,this.doesEleInvalidateKey=r}return sh(t,[{key:"getIdsFor",value:function(r){r==null&&Kn("Can not get id list for null key");var n=this.idsByKey,i=this.idsByKey.get(r);return i||(i=new um,n.set(r,i)),i}},{key:"addIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).add(n)}},{key:"deleteIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).delete(n)}},{key:"getNumberOfIdsForKey",value:function(r){return r==null?0:this.getIdsFor(r).size}},{key:"updateKeyMappingFor",value:function(r){var n=r.id(),i=this.keyForId.get(n),a=this.getKey(r);this.deleteIdForKey(i,n),this.addIdForKey(a,n),this.keyForId.set(n,a)}},{key:"deleteKeyMappingFor",value:function(r){var n=r.id(),i=this.keyForId.get(n);this.deleteIdForKey(i,n),this.keyForId.delete(n)}},{key:"keyHasChangedFor",value:function(r){var n=r.id(),i=this.keyForId.get(n),a=this.getKey(r);return i!==a}},{key:"isInvalid",value:function(r){return this.keyHasChangedFor(r)||this.doesEleInvalidateKey(r)}},{key:"getCachesAt",value:function(r){var n=this.cachesByLvl,i=this.lvls,a=n.get(r);return a||(a=new dc,n.set(r,a),i.push(r)),a}},{key:"getCache",value:function(r,n){return this.getCachesAt(n).get(r)}},{key:"get",value:function(r,n){var i=this.getKey(r),a=this.getCache(i,n);return a!=null&&this.updateKeyMappingFor(r),a}},{key:"getForCachedKey",value:function(r,n){var i=this.keyForId.get(r.id()),a=this.getCache(i,n);return a}},{key:"hasCache",value:function(r,n){return this.getCachesAt(n).has(r)}},{key:"has",value:function(r,n){var i=this.getKey(r);return this.hasCache(i,n)}},{key:"setCache",value:function(r,n,i){i.key=r,this.getCachesAt(n).set(r,i)}},{key:"set",value:function(r,n,i){var a=this.getKey(r);this.setCache(a,n,i),this.updateKeyMappingFor(r)}},{key:"deleteCache",value:function(r,n){this.getCachesAt(n).delete(r)}},{key:"delete",value:function(r,n){var i=this.getKey(r);this.deleteCache(i,n)}},{key:"invalidateKey",value:function(r){var n=this;this.lvls.forEach(function(i){return n.deleteCache(r,i)})}},{key:"invalidate",value:function(r){var n=r.id(),i=this.keyForId.get(n);this.deleteKeyMappingFor(r);var a=this.doesEleInvalidateKey(r);return a&&this.invalidateKey(i),a||this.getNumberOfIdsForKey(i)===0}}])})(),zN=25,sy=50,Vy=-4,KS=3,JA=7.99,Nz=8,Pz=1024,Mz=1024,Az=1024,Lz=.2,Rz=.8,Oz=10,Dz=.15,Iz=.1,jz=.9,Fz=.9,Bz=100,zz=1,Op={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},Uz=Ha({getKey:null,doesEleInvalidateKey:sx,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:GM,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),qg=function(e,r){var n=this;n.renderer=e,n.onDequeues=[];var i=Uz(r);ar(n,i),n.lookup=new Tz(i.getKey,i.doesEleInvalidateKey),n.setupDequeueing()},Ki=qg.prototype;Ki.reasons=Op;Ki.getTextureQueue=function(t){var e=this;return e.eleImgCaches=e.eleImgCaches||{},e.eleImgCaches[t]=e.eleImgCaches[t]||[]};Ki.getRetiredTextureQueue=function(t){var e=this,r=e.eleImgCaches.retired=e.eleImgCaches.retired||{},n=r[t]=r[t]||[];return n};Ki.getElementQueue=function(){var t=this,e=t.eleCacheQueue=t.eleCacheQueue||new Jv(function(r,n){return n.reqs-r.reqs});return e};Ki.getElementKeyToQueue=function(){var t=this,e=t.eleKeyToCacheQueue=t.eleKeyToCacheQueue||{};return e};Ki.getElement=function(t,e,r,n,i){var a=this,s=this.renderer,o=s.cy.zoom(),l=this.lookup;if(!e||e.w===0||e.h===0||isNaN(e.w)||isNaN(e.h)||!t.visible()||t.removed()||!a.allowEdgeTxrCaching&&t.isEdge()||!a.allowParentTxrCaching&&t.isParent())return null;if(n==null&&(n=Math.ceil(n_(o*r))),n<Vy)n=Vy;else if(o>=JA||n>KS)return null;var u=Math.pow(2,n),c=e.h*u,h=e.w*u,p=s.eleTextBiggerThanMin(t,u);if(!this.isVisible(t,p))return null;var g=l.get(t,n);if(g&&g.invalidated&&(g.invalidated=!1,g.texture.invalidatedWidth-=g.width),g)return g;var y;if(c<=zN?y=zN:c<=sy?y=sy:y=Math.ceil(c/sy)*sy,c>Az||h>Mz)return null;var S=a.getTextureQueue(y),w=S[S.length-2],C=function(){return a.recycleTexture(y,h)||a.addTexture(y,h)};w||(w=S[S.length-1]),w||(w=C()),w.width-w.usedWidth<h&&(w=C());for(var _=function(Z){return Z&&Z.scaledLabelShown===p},T=i&&i===Op.dequeue,N=i&&i===Op.highQuality,R=i&&i===Op.downscale,I,j=n+1;j<=KS;j++){var O=l.get(t,j);if(O){I=O;break}}var F=I&&I.level===n+1?I:null,z=function(){w.context.drawImage(F.texture.canvas,F.x,0,F.width,F.height,w.usedWidth,0,h,c)};if(w.context.setTransform(1,0,0,1,0,0),w.context.clearRect(w.usedWidth,0,h,y),_(F))z();else if(_(I))if(N){for(var V=I.level;V>n;V--)F=a.getElement(t,e,r,V,Op.downscale);z()}else return a.queueElement(t,I.level-1),I;else{var q;if(!T&&!N&&!R)for(var D=n-1;D>=Vy;D--){var U=l.get(t,D);if(U){q=U;break}}if(_(q))return a.queueElement(t,n),q;w.context.translate(w.usedWidth,0),w.context.scale(u,u),this.drawElement(w.context,t,e,p,!1),w.context.scale(1/u,1/u),w.context.translate(-w.usedWidth,0)}return g={x:w.usedWidth,texture:w,level:n,scale:u,width:h,height:c,scaledLabelShown:p},w.usedWidth+=Math.ceil(h+Nz),w.eleCaches.push(g),l.set(t,n,g),a.checkTextureFullness(w),g};Ki.invalidateElements=function(t){for(var e=0;e<t.length;e++)this.invalidateElement(t[e])};Ki.invalidateElement=function(t){var e=this,r=e.lookup,n=[],i=r.isInvalid(t);if(i){for(var a=Vy;a<=KS;a++){var s=r.getForCachedKey(t,a);s&&n.push(s)}var o=r.invalidate(t);if(o)for(var l=0;l<n.length;l++){var u=n[l],c=u.texture;c.invalidatedWidth+=u.width,u.invalidated=!0,e.checkTextureUtility(c)}e.removeFromQueue(t)}};Ki.checkTextureUtility=function(t){t.invalidatedWidth>=Lz*t.width&&this.retireTexture(t)};Ki.checkTextureFullness=function(t){var e=this,r=e.getTextureQueue(t.height);t.usedWidth/t.width>Rz&&t.fullnessChecks>=Oz?Yd(r,t):t.fullnessChecks++};Ki.retireTexture=function(t){var e=this,r=t.height,n=e.getTextureQueue(r),i=this.lookup;Yd(n,t),t.retired=!0;for(var a=t.eleCaches,s=0;s<a.length;s++){var o=a[s];i.deleteCache(o.key,o.level)}r_(a);var l=e.getRetiredTextureQueue(r);l.push(t)};Ki.addTexture=function(t,e){var r=this,n=r.getTextureQueue(t),i={};return n.push(i),i.eleCaches=[],i.height=t,i.width=Math.max(Pz,e),i.usedWidth=0,i.invalidatedWidth=0,i.fullnessChecks=0,i.canvas=r.renderer.makeOffscreenCanvas(i.width,i.height),i.context=i.canvas.getContext("2d"),i};Ki.recycleTexture=function(t,e){for(var r=this,n=r.getTextureQueue(t),i=r.getRetiredTextureQueue(t),a=0;a<i.length;a++){var s=i[a];if(s.width>=e)return s.retired=!1,s.usedWidth=0,s.invalidatedWidth=0,s.fullnessChecks=0,r_(s.eleCaches),s.context.setTransform(1,0,0,1,0,0),s.context.clearRect(0,0,s.width,s.height),Yd(i,s),n.push(s),s}};Ki.queueElement=function(t,e){var r=this,n=r.getElementQueue(),i=r.getElementKeyToQueue(),a=this.getKey(t),s=i[a];if(s)s.level=Math.max(s.level,e),s.eles.merge(t),s.reqs++,n.updateItem(s);else{var o={eles:t.spawn().merge(t),level:e,reqs:1,key:a};n.push(o),i[a]=o}};Ki.dequeue=function(t){for(var e=this,r=e.getElementQueue(),n=e.getElementKeyToQueue(),i=[],a=e.lookup,s=0;s<zz&&r.size()>0;s++){var o=r.pop(),l=o.key,u=o.eles[0],c=a.hasCache(u,o.level);if(n[l]=null,c)continue;i.push(o);var h=e.getBoundingBox(u);e.getElement(u,h,t,o.level,Op.dequeue)}return i};Ki.removeFromQueue=function(t){var e=this,r=e.getElementQueue(),n=e.getElementKeyToQueue(),i=this.getKey(t),a=n[i];a!=null&&(a.eles.length===1?(a.reqs=e_,r.updateItem(a),r.pop(),n[i]=null):a.eles.unmerge(t))};Ki.onDequeue=function(t){this.onDequeues.push(t)};Ki.offDequeue=function(t){Yd(this.onDequeues,t)};Ki.setupDequeueing=QA.setupDequeueing({deqRedrawThreshold:Bz,deqCost:Dz,deqAvgCost:Iz,deqNoDrawCost:jz,deqFastCost:Fz,deq:function(e,r,n){return e.dequeue(r,n)},onDeqd:function(e,r){for(var n=0;n<e.onDequeues.length;n++){var i=e.onDequeues[n];i(r)}},shouldRedraw:function(e,r,n,i){for(var a=0;a<r.length;a++)for(var s=r[a].eles,o=0;o<s.length;o++){var l=s[o].boundingBox();if(a_(l,i))return!0}return!1},priority:function(e){return e.renderer.beforeRenderPriorities.eleTxrDeq}});var Gz=1,ev=-4,px=2,Vz=3.99,Hz=50,Wz=50,qz=.15,$z=.1,Kz=.9,Zz=.9,Yz=1,UN=250,Xz=4e3*4e3,GN=32767,Qz=!0,eL=function(e){var r=this,n=r.renderer=e,i=n.cy;r.layersByLevel={},r.firstGet=!0,r.lastInvalidationTime=vc()-2*UN,r.skipping=!1,r.eleTxrDeqs=i.collection(),r.scheduleElementRefinement=Qv(function(){r.refineElementTextures(r.eleTxrDeqs),r.eleTxrDeqs.unmerge(r.eleTxrDeqs)},Wz),n.beforeRender(function(s,o){o-r.lastInvalidationTime<=UN?r.skipping=!0:r.skipping=!1},n.beforeRenderPriorities.lyrTxrSkip);var a=function(o,l){return l.reqs-o.reqs};r.layersQueue=new Jv(a),r.setupDequeueing()},Wa=eL.prototype,VN=0,Jz=Math.pow(2,53)-1;Wa.makeLayer=function(t,e){var r=Math.pow(2,e),n=Math.ceil(t.w*r),i=Math.ceil(t.h*r),a=this.renderer.makeOffscreenCanvas(n,i),s={id:VN=++VN%Jz,bb:t,level:e,width:n,height:i,canvas:a,context:a.getContext("2d"),eles:[],elesQueue:[],reqs:0},o=s.context,l=-s.bb.x1,u=-s.bb.y1;return o.scale(r,r),o.translate(l,u),s};Wa.getLayers=function(t,e,r){var n=this,i=n.renderer,a=i.cy,s=a.zoom(),o=n.firstGet;if(n.firstGet=!1,r==null){if(r=Math.ceil(n_(s*e)),r<ev)r=ev;else if(s>=Vz||r>px)return null}n.validateLayersElesOrdering(r,t);var l=n.layersByLevel,u=Math.pow(2,r),c=l[r]=l[r]||[],h,p=n.levelIsComplete(r,t),g,y=function(){var z=function(G){if(n.validateLayersElesOrdering(G,t),n.levelIsComplete(G,t))return g=l[G],!0},V=function(G){if(!g)for(var Z=r+G;ev<=Z&&Z<=px&&!z(Z);Z+=G);};V(1),V(-1);for(var q=c.length-1;q>=0;q--){var D=c[q];D.invalid&&Yd(c,D)}};if(!p)y();else return c;var S=function(){if(!h){h=Es();for(var z=0;z<t.length;z++)Y9(h,t[z].boundingBox())}return h},w=function(z){z=z||{};var V=z.after;S();var q=Math.ceil(h.w*u),D=Math.ceil(h.h*u);if(q>GN||D>GN)return null;var U=q*D;if(U>Xz)return null;var G=n.makeLayer(h,r);if(V!=null){var Z=c.indexOf(V)+1;c.splice(Z,0,G)}else(z.insert===void 0||z.insert)&&c.unshift(G);return G};if(n.skipping&&!o)return null;for(var C=null,_=t.length/Gz,T=!o,N=0;N<t.length;N++){var R=t[N],I=R._private.rscratch,j=I.imgLayerCaches=I.imgLayerCaches||{},O=j[r];if(O){C=O;continue}if((!C||C.eles.length>=_||!KM(C.bb,R.boundingBox()))&&(C=w({insert:!0,after:C}),!C))return null;g||T?n.queueLayer(C,R):n.drawEleInLayer(C,R,r,e),C.eles.push(R),j[r]=C}return g||(T?null:c)};Wa.getEleLevelForLayerLevel=function(t,e){return t};Wa.drawEleInLayer=function(t,e,r,n){var i=this,a=this.renderer,s=t.context,o=e.boundingBox();o.w===0||o.h===0||!e.visible()||(r=i.getEleLevelForLayerLevel(r,n),a.setImgSmoothing(s,!1),a.drawCachedElement(s,e,null,null,r,Qz),a.setImgSmoothing(s,!0))};Wa.levelIsComplete=function(t,e){var r=this,n=r.layersByLevel[t];if(!n||n.length===0)return!1;for(var i=0,a=0;a<n.length;a++){var s=n[a];if(s.reqs>0||s.invalid)return!1;i+=s.eles.length}return i===e.length};Wa.validateLayersElesOrdering=function(t,e){var r=this.layersByLevel[t];if(r)for(var n=0;n<r.length;n++){for(var i=r[n],a=-1,s=0;s<e.length;s++)if(i.eles[0]===e[s]){a=s;break}if(a<0){this.invalidateLayer(i);continue}for(var o=a,s=0;s<i.eles.length;s++)if(i.eles[s]!==e[o+s]){this.invalidateLayer(i);break}}};Wa.updateElementsInLayers=function(t,e){for(var r=this,n=Kv(t[0]),i=0;i<t.length;i++)for(var a=n?null:t[i],s=n?t[i]:t[i].ele,o=s._private.rscratch,l=o.imgLayerCaches=o.imgLayerCaches||{},u=ev;u<=px;u++){var c=l[u];c&&(a&&r.getEleLevelForLayerLevel(c.level)!==a.level||e(c,s,a))}};Wa.haveLayers=function(){for(var t=this,e=!1,r=ev;r<=px;r++){var n=t.layersByLevel[r];if(n&&n.length>0){e=!0;break}}return e};Wa.invalidateElements=function(t){var e=this;t.length!==0&&(e.lastInvalidationTime=vc(),!(t.length===0||!e.haveLayers())&&e.updateElementsInLayers(t,function(n,i,a){e.invalidateLayer(n)}))};Wa.invalidateLayer=function(t){if(this.lastInvalidationTime=vc(),!t.invalid){var e=t.level,r=t.eles,n=this.layersByLevel[e];Yd(n,t),t.elesQueue=[],t.invalid=!0,t.replacement&&(t.replacement.invalid=!0);for(var i=0;i<r.length;i++){var a=r[i]._private.rscratch.imgLayerCaches;a&&(a[e]=null)}}};Wa.refineElementTextures=function(t){var e=this;e.updateElementsInLayers(t,function(n,i,a){var s=n.replacement;if(s||(s=n.replacement=e.makeLayer(n.bb,n.level),s.replaces=n,s.eles=n.eles),!s.reqs)for(var o=0;o<s.eles.length;o++)e.queueLayer(s,s.eles[o])})};Wa.enqueueElementRefinement=function(t){this.eleTxrDeqs.merge(t),this.scheduleElementRefinement()};Wa.queueLayer=function(t,e){var r=this,n=r.layersQueue,i=t.elesQueue,a=i.hasId=i.hasId||{};if(!t.replacement){if(e){if(a[e.id()])return;i.push(e),a[e.id()]=!0}t.reqs?(t.reqs++,n.updateItem(t)):(t.reqs=1,n.push(t))}};Wa.dequeue=function(t){for(var e=this,r=e.layersQueue,n=[],i=0;i<Yz&&r.size()!==0;){var a=r.peek();if(a.replacement){r.pop();continue}if(a.replaces&&a!==a.replaces.replacement){r.pop();continue}if(a.invalid){r.pop();continue}var s=a.elesQueue.shift();s&&(e.drawEleInLayer(a,s,a.level,t),i++),n.length===0&&n.push(!0),a.elesQueue.length===0&&(r.pop(),a.reqs=0,a.replaces&&e.applyLayerReplacement(a),e.requestRedraw())}return n};Wa.applyLayerReplacement=function(t){var e=this,r=e.layersByLevel[t.level],n=t.replaces,i=r.indexOf(n);if(!(i<0||n.invalid)){r[i]=t;for(var a=0;a<t.eles.length;a++){var s=t.eles[a]._private,o=s.imgLayerCaches=s.imgLayerCaches||{};o&&(o[t.level]=t)}e.requestRedraw()}};Wa.requestRedraw=Qv(function(){var t=this.renderer;t.redrawHint("eles",!0),t.redrawHint("drag",!0),t.redraw()},100);Wa.setupDequeueing=QA.setupDequeueing({deqRedrawThreshold:Hz,deqCost:qz,deqAvgCost:$z,deqNoDrawCost:Kz,deqFastCost:Zz,deq:function(e,r){return e.dequeue(r)},onDeqd:t_,shouldRedraw:GM,priority:function(e){return e.renderer.beforeRenderPriorities.lyrTxrDeq}});var tL={},HN;function eU(t,e){for(var r=0;r<e.length;r++){var n=e[r];t.lineTo(n.x,n.y)}}function tU(t,e,r){for(var n,i=0;i<e.length;i++){var a=e[i];i===0&&(n=a),t.lineTo(a.x,a.y)}t.quadraticCurveTo(r.x,r.y,n.x,n.y)}function WN(t,e,r){t.beginPath&&t.beginPath();for(var n=e,i=0;i<n.length;i++){var a=n[i];t.lineTo(a.x,a.y)}var s=r,o=r[0];t.moveTo(o.x,o.y);for(var i=1;i<s.length;i++){var a=s[i];t.lineTo(a.x,a.y)}t.closePath&&t.closePath()}function rU(t,e,r,n,i){t.beginPath&&t.beginPath(),t.arc(r,n,i,0,Math.PI*2,!1);var a=e,s=a[0];t.moveTo(s.x,s.y);for(var o=0;o<a.length;o++){var l=a[o];t.lineTo(l.x,l.y)}t.closePath&&t.closePath()}function nU(t,e,r,n){t.arc(e,r,n,0,Math.PI*2,!1)}tL.arrowShapeImpl=function(t){return(HN||(HN={polygon:eU,"triangle-backcurve":tU,"triangle-tee":WN,"circle-triangle":rU,"triangle-cross":WN,circle:nU}))[t]};var Lu={};Lu.drawElement=function(t,e,r,n,i,a){var s=this;e.isNode()?s.drawNode(t,e,r,n,i,a):s.drawEdge(t,e,r,n,i,a)};Lu.drawElementOverlay=function(t,e){var r=this;e.isNode()?r.drawNodeOverlay(t,e):r.drawEdgeOverlay(t,e)};Lu.drawElementUnderlay=function(t,e){var r=this;e.isNode()?r.drawNodeUnderlay(t,e):r.drawEdgeUnderlay(t,e)};Lu.drawCachedElementPortion=function(t,e,r,n,i,a,s,o){var l=this,u=r.getBoundingBox(e);if(!(u.w===0||u.h===0)){var c=r.getElement(e,u,n,i,a);if(c!=null){var h=o(l,e);if(h===0)return;var p=s(l,e),g=u.x1,y=u.y1,S=u.w,w=u.h,C,_,T,N,R;if(p!==0){var I=r.getRotationPoint(e);T=I.x,N=I.y,t.translate(T,N),t.rotate(p),R=l.getImgSmoothing(t),R||l.setImgSmoothing(t,!0);var j=r.getRotationOffset(e);C=j.x,_=j.y}else C=g,_=y;var O;h!==1&&(O=t.globalAlpha,t.globalAlpha=O*h),t.drawImage(c.texture.canvas,c.x,0,c.width,c.height,C,_,S,w),h!==1&&(t.globalAlpha=O),p!==0&&(t.rotate(-p),t.translate(-T,-N),R||l.setImgSmoothing(t,!1))}else r.drawElement(t,e)}};var iU=function(){return 0},aU=function(e,r){return e.getTextAngle(r,null)},sU=function(e,r){return e.getTextAngle(r,"source")},oU=function(e,r){return e.getTextAngle(r,"target")},lU=function(e,r){return r.effectiveOpacity()},h2=function(e,r){return r.pstyle("text-opacity").pfValue*r.effectiveOpacity()};Lu.drawCachedElement=function(t,e,r,n,i,a){var s=this,o=s.data,l=o.eleTxrCache,u=o.lblTxrCache,c=o.slbTxrCache,h=o.tlbTxrCache,p=e.boundingBox(),g=a===!0?l.reasons.highQuality:null;if(!(p.w===0||p.h===0||!e.visible())&&(!n||a_(p,n))){var y=e.isEdge(),S=e.element()._private.rscratch.badLine;s.drawElementUnderlay(t,e),s.drawCachedElementPortion(t,e,l,r,i,g,iU,lU),(!y||!S)&&s.drawCachedElementPortion(t,e,u,r,i,g,aU,h2),y&&!S&&(s.drawCachedElementPortion(t,e,c,r,i,g,sU,h2),s.drawCachedElementPortion(t,e,h,r,i,g,oU,h2)),s.drawElementOverlay(t,e)}};Lu.drawElements=function(t,e){for(var r=this,n=0;n<e.length;n++){var i=e[n];r.drawElement(t,i)}};Lu.drawCachedElements=function(t,e,r,n){for(var i=this,a=0;a<e.length;a++){var s=e[a];i.drawCachedElement(t,s,r,n)}};Lu.drawCachedNodes=function(t,e,r,n){for(var i=this,a=0;a<e.length;a++){var s=e[a];s.isNode()&&i.drawCachedElement(t,s,r,n)}};Lu.drawLayeredElements=function(t,e,r,n){var i=this,a=i.data.lyrTxrCache.getLayers(e,r);if(a)for(var s=0;s<a.length;s++){var o=a[s],l=o.bb;l.w===0||l.h===0||t.drawImage(o.canvas,l.x1,l.y1,l.w,l.h)}else i.drawCachedElements(t,e,r,n)};var Sc={};Sc.drawEdge=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o=e._private.rscratch;if(!(a&&!e.visible())&&!(o.badLine||o.allpts==null||isNaN(o.allpts[0]))){var l;r&&(l=r,t.translate(-l.x1,-l.y1));var u=a?e.pstyle("opacity").value:1,c=a?e.pstyle("line-opacity").value:1,h=e.pstyle("curve-style").value,p=e.pstyle("line-style").value,g=e.pstyle("width").pfValue,y=e.pstyle("line-cap").value,S=e.pstyle("line-outline-width").value,w=e.pstyle("line-outline-color").value,C=u*c,_=u*c,T=function(){var G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:C;h==="straight-triangle"?(s.eleStrokeStyle(t,e,G),s.drawEdgeTrianglePath(e,t,o.allpts)):(t.lineWidth=g,t.lineCap=y,s.eleStrokeStyle(t,e,G),s.drawEdgePath(e,t,o.allpts,p),t.lineCap="butt")},N=function(){var G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:C;if(t.lineWidth=g+S,t.lineCap=y,S>0)s.colorStrokeStyle(t,w[0],w[1],w[2],G);else{t.lineCap="butt";return}h==="straight-triangle"?s.drawEdgeTrianglePath(e,t,o.allpts):(s.drawEdgePath(e,t,o.allpts,p),t.lineCap="butt")},R=function(){i&&s.drawEdgeOverlay(t,e)},I=function(){i&&s.drawEdgeUnderlay(t,e)},j=function(){var G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_;s.drawArrowheads(t,e,G)},O=function(){s.drawElementText(t,e,null,n)};t.lineJoin="round";var F=e.pstyle("ghost").value==="yes";if(F){var z=e.pstyle("ghost-offset-x").pfValue,V=e.pstyle("ghost-offset-y").pfValue,q=e.pstyle("ghost-opacity").value,D=C*q;t.translate(z,V),T(D),j(D),t.translate(-z,-V)}else N();I(),T(),j(),R(),O(),r&&t.translate(l.x1,l.y1)}};var rL=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(r,n){if(n.visible()){var i=n.pstyle("".concat(e,"-opacity")).value;if(i!==0){var a=this,s=a.usePaths(),o=n._private.rscratch,l=n.pstyle("".concat(e,"-padding")).pfValue,u=2*l,c=n.pstyle("".concat(e,"-color")).value;r.lineWidth=u,o.edgeType==="self"&&!s?r.lineCap="butt":r.lineCap="round",a.colorStrokeStyle(r,c[0],c[1],c[2],i),a.drawEdgePath(n,r,o.allpts,"solid")}}}};Sc.drawEdgeOverlay=rL("overlay");Sc.drawEdgeUnderlay=rL("underlay");Sc.drawEdgePath=function(t,e,r,n){var i=t._private.rscratch,a=e,s,o=!1,l=this.usePaths(),u=t.pstyle("line-dash-pattern").pfValue,c=t.pstyle("line-dash-offset").pfValue;if(l){var h=r.join("$"),p=i.pathCacheKey&&i.pathCacheKey===h;p?(s=e=i.pathCache,o=!0):(s=e=new Path2D,i.pathCacheKey=h,i.pathCache=s)}if(a.setLineDash)switch(n){case"dotted":a.setLineDash([1,1]);break;case"dashed":a.setLineDash(u),a.lineDashOffset=c;break;case"solid":a.setLineDash([]);break}if(!o&&!i.badLine)switch(e.beginPath&&e.beginPath(),e.moveTo(r[0],r[1]),i.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var g=2;g+3<r.length;g+=4)e.quadraticCurveTo(r[g],r[g+1],r[g+2],r[g+3]);break;case"straight":case"haystack":for(var y=2;y+1<r.length;y+=2)e.lineTo(r[y],r[y+1]);break;case"segments":if(i.isRound){var S=Ys(i.roundCorners),w;try{for(S.s();!(w=S.n()).done;){var C=w.value;HA(e,C)}}catch(T){S.e(T)}finally{S.f()}e.lineTo(r[r.length-2],r[r.length-1])}else for(var _=2;_+1<r.length;_+=2)e.lineTo(r[_],r[_+1]);break}e=a,l?e.stroke(s):e.stroke(),e.setLineDash&&e.setLineDash([])};Sc.drawEdgeTrianglePath=function(t,e,r){e.fillStyle=e.strokeStyle;for(var n=t.pstyle("width").pfValue,i=0;i+1<r.length;i+=2){var a=[r[i+2]-r[i],r[i+3]-r[i+1]],s=Math.sqrt(a[0]*a[0]+a[1]*a[1]),o=[a[1]/s,-a[0]/s],l=[o[0]*n/2,o[1]*n/2];e.beginPath(),e.moveTo(r[i]-l[0],r[i+1]-l[1]),e.lineTo(r[i]+l[0],r[i+1]+l[1]),e.lineTo(r[i+2],r[i+3]),e.closePath(),e.fill()}};Sc.drawArrowheads=function(t,e,r){var n=e._private.rscratch,i=n.edgeType==="haystack";i||this.drawArrowhead(t,e,"source",n.arrowStartX,n.arrowStartY,n.srcArrowAngle,r),this.drawArrowhead(t,e,"mid-target",n.midX,n.midY,n.midtgtArrowAngle,r),this.drawArrowhead(t,e,"mid-source",n.midX,n.midY,n.midsrcArrowAngle,r),i||this.drawArrowhead(t,e,"target",n.arrowEndX,n.arrowEndY,n.tgtArrowAngle,r)};Sc.drawArrowhead=function(t,e,r,n,i,a,s){if(!(isNaN(n)||n==null||isNaN(i)||i==null||isNaN(a)||a==null)){var o=this,l=e.pstyle(r+"-arrow-shape").value;if(l!=="none"){var u=e.pstyle(r+"-arrow-fill").value==="hollow"?"both":"filled",c=e.pstyle(r+"-arrow-fill").value,h=e.pstyle("width").pfValue,p=e.pstyle(r+"-arrow-width"),g=p.value==="match-line"?h:p.pfValue;p.units==="%"&&(g*=h);var y=e.pstyle("opacity").value;s===void 0&&(s=y);var S=t.globalCompositeOperation;(s!==1||c==="hollow")&&(t.globalCompositeOperation="destination-out",o.colorFillStyle(t,255,255,255,1),o.colorStrokeStyle(t,255,255,255,1),o.drawArrowShape(e,t,u,h,l,g,n,i,a),t.globalCompositeOperation=S);var w=e.pstyle(r+"-arrow-color").value;o.colorFillStyle(t,w[0],w[1],w[2],s),o.colorStrokeStyle(t,w[0],w[1],w[2],s),o.drawArrowShape(e,t,c,h,l,g,n,i,a)}}};Sc.drawArrowShape=function(t,e,r,n,i,a,s,o,l){var u=this,c=this.usePaths()&&i!=="triangle-cross",h=!1,p,g=e,y={x:s,y:o},S=t.pstyle("arrow-scale").value,w=this.getArrowWidth(n,S),C=u.arrowShapes[i];if(c){var _=u.arrowPathCache=u.arrowPathCache||[],T=pf(i),N=_[T];N!=null?(p=e=N,h=!0):(p=e=new Path2D,_[T]=p)}h||(e.beginPath&&e.beginPath(),c?C.draw(e,1,0,{x:0,y:0},1):C.draw(e,w,l,y,n),e.closePath&&e.closePath()),e=g,c&&(e.translate(s,o),e.rotate(l),e.scale(w,w)),(r==="filled"||r==="both")&&(c?e.fill(p):e.fill()),(r==="hollow"||r==="both")&&(e.lineWidth=a/(c?w:1),e.lineJoin="miter",c?e.stroke(p):e.stroke()),c&&(e.scale(1/w,1/w),e.rotate(-l),e.translate(-s,-o))};var x_={};x_.safeDrawImage=function(t,e,r,n,i,a,s,o,l,u){if(!(i<=0||a<=0||l<=0||u<=0))try{t.drawImage(e,r,n,i,a,s,o,l,u)}catch(c){an(c)}};x_.drawInscribedImage=function(t,e,r,n,i){var a=this,s=r.position(),o=s.x,l=s.y,u=r.cy().style(),c=u.getIndexedStyle.bind(u),h=c(r,"background-fit","value",n),p=c(r,"background-repeat","value",n),g=r.width(),y=r.height(),S=r.padding()*2,w=g+(c(r,"background-width-relative-to","value",n)==="inner"?0:S),C=y+(c(r,"background-height-relative-to","value",n)==="inner"?0:S),_=r._private.rscratch,T=c(r,"background-clip","value",n),N=T==="node",R=c(r,"background-image-opacity","value",n)*i,I=c(r,"background-image-smoothing","value",n),j=r.pstyle("corner-radius").value;j!=="auto"&&(j=r.pstyle("corner-radius").pfValue);var O=e.width||e.cachedW,F=e.height||e.cachedH;(O==null||F==null)&&(document.body.appendChild(e),O=e.cachedW=e.width||e.offsetWidth,F=e.cachedH=e.height||e.offsetHeight,document.body.removeChild(e));var z=O,V=F;if(c(r,"background-width","value",n)!=="auto"&&(c(r,"background-width","units",n)==="%"?z=c(r,"background-width","pfValue",n)*w:z=c(r,"background-width","pfValue",n)),c(r,"background-height","value",n)!=="auto"&&(c(r,"background-height","units",n)==="%"?V=c(r,"background-height","pfValue",n)*C:V=c(r,"background-height","pfValue",n)),!(z===0||V===0)){if(h==="contain"){var q=Math.min(w/z,C/V);z*=q,V*=q}else if(h==="cover"){var q=Math.max(w/z,C/V);z*=q,V*=q}var D=o-w/2,U=c(r,"background-position-x","units",n),G=c(r,"background-position-x","pfValue",n);U==="%"?D+=(w-z)*G:D+=G;var Z=c(r,"background-offset-x","units",n),K=c(r,"background-offset-x","pfValue",n);Z==="%"?D+=(w-z)*K:D+=K;var Q=l-C/2,ne=c(r,"background-position-y","units",n),te=c(r,"background-position-y","pfValue",n);ne==="%"?Q+=(C-V)*te:Q+=te;var X=c(r,"background-offset-y","units",n),re=c(r,"background-offset-y","pfValue",n);X==="%"?Q+=(C-V)*re:Q+=re,_.pathCache&&(D-=o,Q-=l,o=0,l=0);var he=t.globalAlpha;t.globalAlpha=R;var oe=a.getImgSmoothing(t),se=!1;if(I==="no"&&oe?(a.setImgSmoothing(t,!1),se=!0):I==="yes"&&!oe&&(a.setImgSmoothing(t,!0),se=!0),p==="no-repeat")N&&(t.save(),_.pathCache?t.clip(_.pathCache):(a.nodeShapes[a.getNodeShape(r)].draw(t,o,l,w,C,j,_),t.clip())),a.safeDrawImage(t,e,0,0,O,F,D,Q,z,V),N&&t.restore();else{var fe=t.createPattern(e,p);t.fillStyle=fe,a.nodeShapes[a.getNodeShape(r)].draw(t,o,l,w,C,j,_),t.translate(D,Q),t.fill(),t.translate(-D,-Q)}t.globalAlpha=he,se&&a.setImgSmoothing(t,oe)}};var Mf={};Mf.eleTextBiggerThanMin=function(t,e){if(!e){var r=t.cy().zoom(),n=this.getPixelRatio(),i=Math.ceil(n_(r*n));e=Math.pow(2,i)}var a=t.pstyle("font-size").pfValue*e,s=t.pstyle("min-zoomed-font-size").pfValue;return!(a<s)};Mf.drawElementText=function(t,e,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this;if(n==null){if(a&&!s.eleTextBiggerThanMin(e))return}else if(n===!1)return;if(e.isNode()){var o=e.pstyle("label");if(!o||!o.value)return;var l=s.getLabelJustification(e);t.textAlign=l,t.textBaseline="bottom"}else{var u=e.element()._private.rscratch.badLine,c=e.pstyle("label"),h=e.pstyle("source-label"),p=e.pstyle("target-label");if(u||(!c||!c.value)&&(!h||!h.value)&&(!p||!p.value))return;t.textAlign="center",t.textBaseline="bottom"}var g=!r,y;r&&(y=r,t.translate(-y.x1,-y.y1)),i==null?(s.drawText(t,e,null,g,a),e.isEdge()&&(s.drawText(t,e,"source",g,a),s.drawText(t,e,"target",g,a))):s.drawText(t,e,i,g,a),r&&t.translate(y.x1,y.y1)};Mf.getFontCache=function(t){var e;this.fontCaches=this.fontCaches||[];for(var r=0;r<this.fontCaches.length;r++)if(e=this.fontCaches[r],e.context===t)return e;return e={context:t},this.fontCaches.push(e),e};Mf.setupTextStyle=function(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=e.pstyle("font-style").strValue,i=e.pstyle("font-size").pfValue+"px",a=e.pstyle("font-family").strValue,s=e.pstyle("font-weight").strValue,o=r?e.effectiveOpacity()*e.pstyle("text-opacity").value:1,l=e.pstyle("text-outline-opacity").value*o,u=e.pstyle("color").value,c=e.pstyle("text-outline-color").value;t.font=n+" "+s+" "+i+" "+a,t.lineJoin="round",this.colorFillStyle(t,u[0],u[1],u[2],o),this.colorStrokeStyle(t,c[0],c[1],c[2],l)};function uU(t,e,r,n,i){var a=Math.min(n,i),s=a/2,o=e+n/2,l=r+i/2;t.beginPath(),t.arc(o,l,s,0,Math.PI*2),t.closePath()}function qN(t,e,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:5,s=Math.min(a,n/2,i/2);t.beginPath(),t.moveTo(e+s,r),t.lineTo(e+n-s,r),t.quadraticCurveTo(e+n,r,e+n,r+s),t.lineTo(e+n,r+i-s),t.quadraticCurveTo(e+n,r+i,e+n-s,r+i),t.lineTo(e+s,r+i),t.quadraticCurveTo(e,r+i,e,r+i-s),t.lineTo(e,r+s),t.quadraticCurveTo(e,r,e+s,r),t.closePath()}Mf.getTextAngle=function(t,e){var r,n=t._private,i=n.rscratch,a=e?e+"-":"",s=t.pstyle(a+"text-rotation");if(s.strValue==="autorotate"){var o=$s(i,"labelAngle",e);r=t.isEdge()?o:0}else s.strValue==="none"?r=0:r=s.pfValue;return r};Mf.drawText=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=e._private,s=a.rscratch,o=i?e.effectiveOpacity():1;if(!(i&&(o===0||e.pstyle("text-opacity").value===0))){r==="main"&&(r=null);var l=$s(s,"labelX",r),u=$s(s,"labelY",r),c,h,p=this.getLabelText(e,r);if(p!=null&&p!==""&&!isNaN(l)&&!isNaN(u)){this.setupTextStyle(t,e,i);var g=r?r+"-":"",y=$s(s,"labelWidth",r),S=$s(s,"labelHeight",r),w=e.pstyle(g+"text-margin-x").pfValue,C=e.pstyle(g+"text-margin-y").pfValue,_=e.isEdge(),T=e.pstyle("text-halign").value,N=e.pstyle("text-valign").value;_&&(T="center",N="center"),l+=w,u+=C;var R;switch(n?R=this.getTextAngle(e,r):R=0,R!==0&&(c=l,h=u,t.translate(c,h),t.rotate(R),l=0,u=0),N){case"top":break;case"center":u+=S/2;break;case"bottom":u+=S;break}var I=e.pstyle("text-background-opacity").value,j=e.pstyle("text-border-opacity").value,O=e.pstyle("text-border-width").pfValue,F=e.pstyle("text-background-padding").pfValue,z=e.pstyle("text-background-shape").strValue,V=z==="round-rectangle"||z==="roundrectangle",q=z==="circle",D=2;if(I>0||O>0&&j>0){var U=t.fillStyle,G=t.strokeStyle,Z=t.lineWidth,K=e.pstyle("text-background-color").value,Q=e.pstyle("text-border-color").value,ne=e.pstyle("text-border-style").value,te=I>0,X=O>0&&j>0,re=l-F;switch(T){case"left":re-=y;break;case"center":re-=y/2;break}var he=u-S-F,oe=y+2*F,se=S+2*F;if(te&&(t.fillStyle="rgba(".concat(K[0],",").concat(K[1],",").concat(K[2],",").concat(I*o,")")),X&&(t.strokeStyle="rgba(".concat(Q[0],",").concat(Q[1],",").concat(Q[2],",").concat(j*o,")"),t.lineWidth=O,t.setLineDash))switch(ne){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash([4,2]);break;case"double":t.lineWidth=O/4,t.setLineDash([]);break;default:t.setLineDash([]);break}if(V?(t.beginPath(),qN(t,re,he,oe,se,D)):q?(t.beginPath(),uU(t,re,he,oe,se)):(t.beginPath(),t.rect(re,he,oe,se)),te&&t.fill(),X&&t.stroke(),X&&ne==="double"){var fe=O/2;t.beginPath(),V?qN(t,re+fe,he+fe,oe-2*fe,se-2*fe,D):t.rect(re+fe,he+fe,oe-2*fe,se-2*fe),t.stroke()}t.fillStyle=U,t.strokeStyle=G,t.lineWidth=Z,t.setLineDash&&t.setLineDash([])}var ae=2*e.pstyle("text-outline-width").pfValue;if(ae>0&&(t.lineWidth=ae),e.pstyle("text-wrap").value==="wrap"){var pe=$s(s,"labelWrapCachedLines",r),ye=$s(s,"labelLineHeight",r),ve=y/2,ue=this.getLabelJustification(e);switch(ue==="auto"||(T==="left"?ue==="left"?l+=-y:ue==="center"&&(l+=-ve):T==="center"?ue==="left"?l+=-ve:ue==="right"&&(l+=ve):T==="right"&&(ue==="center"?l+=ve:ue==="right"&&(l+=y))),N){case"top":u-=(pe.length-1)*ye;break;case"center":case"bottom":u-=(pe.length-1)*ye;break}for(var xe=0;xe<pe.length;xe++)ae>0&&t.strokeText(pe[xe],l,u),t.fillText(pe[xe],l,u),u+=ye}else ae>0&&t.strokeText(p,l,u),t.fillText(p,l,u);R!==0&&(t.rotate(-R),t.translate(-c,-h))}}};var lh={};lh.drawNode=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o,l,u=e._private,c=u.rscratch,h=e.position();if(!(!kt(h.x)||!kt(h.y))&&!(a&&!e.visible())){var p=a?e.effectiveOpacity():1,g=s.usePaths(),y,S=!1,w=e.padding();o=e.width()+2*w,l=e.height()+2*w;var C;r&&(C=r,t.translate(-C.x1,-C.y1));for(var _=e.pstyle("background-image"),T=_.value,N=new Array(T.length),R=new Array(T.length),I=0,j=0;j<T.length;j++){var O=T[j],F=N[j]=O!=null&&O!=="none";if(F){var z=e.cy().style().getIndexedStyle(e,"background-image-crossorigin","value",j);I++,R[j]=s.getCachedImage(O,z,function(){u.backgroundTimestamp=Date.now(),e.emitAndNotify("background")})}}var V=e.pstyle("background-blacken").value,q=e.pstyle("border-width").pfValue,D=e.pstyle("background-opacity").value*p,U=e.pstyle("border-color").value,G=e.pstyle("border-style").value,Z=e.pstyle("border-join").value,K=e.pstyle("border-cap").value,Q=e.pstyle("border-position").value,ne=e.pstyle("border-dash-pattern").pfValue,te=e.pstyle("border-dash-offset").pfValue,X=e.pstyle("border-opacity").value*p,re=e.pstyle("outline-width").pfValue,he=e.pstyle("outline-color").value,oe=e.pstyle("outline-style").value,se=e.pstyle("outline-opacity").value*p,fe=e.pstyle("outline-offset").value,ae=e.pstyle("corner-radius").value;ae!=="auto"&&(ae=e.pstyle("corner-radius").pfValue);var pe=function(){var ut=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D;s.eleFillStyle(t,e,ut)},ye=function(){var ut=arguments.length>0&&arguments[0]!==void 0?arguments[0]:X;s.colorStrokeStyle(t,U[0],U[1],U[2],ut)},ve=function(){var ut=arguments.length>0&&arguments[0]!==void 0?arguments[0]:se;s.colorStrokeStyle(t,he[0],he[1],he[2],ut)},ue=function(ut,Fe,de,ge){var ke=s.nodePathCache=s.nodePathCache||[],Ee=UM(de==="polygon"?de+","+ge.join(","):de,""+Fe,""+ut,""+ae),Le=ke[Ee],Qe,Ve=!1;return Le!=null?(Qe=Le,Ve=!0,c.pathCache=Qe):(Qe=new Path2D,ke[Ee]=c.pathCache=Qe),{path:Qe,cacheHit:Ve}},xe=e.pstyle("shape").strValue,Se=e.pstyle("shape-polygon-points").pfValue;if(g){t.translate(h.x,h.y);var Oe=ue(o,l,xe,Se);y=Oe.path,S=Oe.cacheHit}var Ae=function(){if(!S){var ut=h;g&&(ut={x:0,y:0}),s.nodeShapes[s.getNodeShape(e)].draw(y||t,ut.x,ut.y,o,l,ae,c)}g?t.fill(y):t.fill()},tt=function(){for(var ut=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p,Fe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,de=u.backgrounding,ge=0,ke=0;ke<R.length;ke++){var Ee=e.cy().style().getIndexedStyle(e,"background-image-containment","value",ke);if(Fe&&Ee==="over"||!Fe&&Ee==="inside"){ge++;continue}N[ke]&&R[ke].complete&&!R[ke].error&&(ge++,s.drawInscribedImage(t,R[ke],e,ke,ut))}u.backgrounding=ge!==I,de!==u.backgrounding&&e.updateStyle(!1)},rt=function(){var ut=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,Fe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p;s.hasPie(e)&&(s.drawPie(t,e,Fe),ut&&(g||s.nodeShapes[s.getNodeShape(e)].draw(t,h.x,h.y,o,l,ae,c)))},dt=function(){var ut=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,Fe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p;s.hasStripe(e)&&(t.save(),g?t.clip(c.pathCache):(s.nodeShapes[s.getNodeShape(e)].draw(t,h.x,h.y,o,l,ae,c),t.clip()),s.drawStripe(t,e,Fe),t.restore(),ut&&(g||s.nodeShapes[s.getNodeShape(e)].draw(t,h.x,h.y,o,l,ae,c)))},_t=function(){var ut=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p,Fe=(V>0?V:-V)*ut,de=V>0?0:255;V!==0&&(s.colorFillStyle(t,de,de,de,Fe),g?t.fill(y):t.fill())},Xe=function(){if(q>0){if(t.lineWidth=q,t.lineCap=K,t.lineJoin=Z,t.setLineDash)switch(G){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash(ne),t.lineDashOffset=te;break;case"solid":case"double":t.setLineDash([]);break}if(Q!=="center"){if(t.save(),t.lineWidth*=2,Q==="inside")g?t.clip(y):t.clip();else{var ut=new Path2D;ut.rect(-o/2-q,-l/2-q,o+2*q,l+2*q),ut.addPath(y),t.clip(ut,"evenodd")}g?t.stroke(y):t.stroke(),t.restore()}else g?t.stroke(y):t.stroke();if(G==="double"){t.lineWidth=q/3;var Fe=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",g?t.stroke(y):t.stroke(),t.globalCompositeOperation=Fe}t.setLineDash&&t.setLineDash([])}},ht=function(){if(re>0){if(t.lineWidth=re,t.lineCap="butt",t.setLineDash)switch(oe){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash([4,2]);break;case"solid":case"double":t.setLineDash([]);break}var ut=h;g&&(ut={x:0,y:0});var Fe=s.getNodeShape(e),de=q;Q==="inside"&&(de=0),Q==="outside"&&(de*=2);var ge=(o+de+(re+fe))/o,ke=(l+de+(re+fe))/l,Ee=o*ge,Le=l*ke,Qe=s.nodeShapes[Fe].points,Ve;if(g){var xt=ue(Ee,Le,Fe,Qe);Ve=xt.path}if(Fe==="ellipse")s.drawEllipsePath(Ve||t,ut.x,ut.y,Ee,Le);else if(["round-diamond","round-heptagon","round-hexagon","round-octagon","round-pentagon","round-polygon","round-triangle","round-tag"].includes(Fe)){var ze=0,$e=0,wt=0;Fe==="round-diamond"?ze=(de+fe+re)*1.4:Fe==="round-heptagon"?(ze=(de+fe+re)*1.075,wt=-(de/2+fe+re)/35):Fe==="round-hexagon"?ze=(de+fe+re)*1.12:Fe==="round-pentagon"?(ze=(de+fe+re)*1.13,wt=-(de/2+fe+re)/15):Fe==="round-tag"?(ze=(de+fe+re)*1.12,$e=(de/2+re+fe)*.07):Fe==="round-triangle"&&(ze=(de+fe+re)*(Math.PI/2),wt=-(de+fe/2+re)/Math.PI),ze!==0&&(ge=(o+ze)/o,Ee=o*ge,["round-hexagon","round-tag"].includes(Fe)||(ke=(l+ze)/l,Le=l*ke)),ae=ae==="auto"?XM(Ee,Le):ae;for(var Pt=Ee/2,Ct=Le/2,Vt=ae+(de+re+fe)/2,Yt=new Array(Qe.length/2),Lr=new Array(Qe.length/2),kr=0;kr<Qe.length/2;kr++)Yt[kr]={x:ut.x+$e+Pt*Qe[kr*2],y:ut.y+wt+Ct*Qe[kr*2+1]};var Qr,Jr,_r,hn,vr=Yt.length;for(Jr=Yt[vr-1],Qr=0;Qr<vr;Qr++)_r=Yt[Qr%vr],hn=Yt[(Qr+1)%vr],Lr[Qr]=v_(Jr,_r,hn,Vt),Jr=_r,_r=hn;s.drawRoundPolygonPath(Ve||t,ut.x+$e,ut.y+wt,o*ge,l*ke,Qe,Lr)}else if(["roundrectangle","round-rectangle"].includes(Fe))ae=ae==="auto"?Xd(Ee,Le):ae,s.drawRoundRectanglePath(Ve||t,ut.x,ut.y,Ee,Le,ae+(de+re+fe)/2);else if(["cutrectangle","cut-rectangle"].includes(Fe))ae=ae==="auto"?s_():ae,s.drawCutRectanglePath(Ve||t,ut.x,ut.y,Ee,Le,null,ae+(de+re+fe)/4);else if(["bottomroundrectangle","bottom-round-rectangle"].includes(Fe))ae=ae==="auto"?Xd(Ee,Le):ae,s.drawBottomRoundRectanglePath(Ve||t,ut.x,ut.y,Ee,Le,ae+(de+re+fe)/2);else if(Fe==="barrel")s.drawBarrelPath(Ve||t,ut.x,ut.y,Ee,Le);else if(Fe.startsWith("polygon")||["rhomboid","right-rhomboid","round-tag","tag","vee"].includes(Fe)){var Et=(de+re+fe)/o;Qe=ox(lx(Qe,Et)),s.drawPolygonPath(Ve||t,ut.x,ut.y,o,l,Qe)}else{var Br=(de+re+fe)/o;Qe=ox(lx(Qe,-Br)),s.drawPolygonPath(Ve||t,ut.x,ut.y,o,l,Qe)}if(g?t.stroke(Ve):t.stroke(),oe==="double"){t.lineWidth=de/3;var Xn=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",g?t.stroke(Ve):t.stroke(),t.globalCompositeOperation=Xn}t.setLineDash&&t.setLineDash([])}},ct=function(){i&&s.drawNodeOverlay(t,e,h,o,l)},vt=function(){i&&s.drawNodeUnderlay(t,e,h,o,l)},lt=function(){s.drawElementText(t,e,null,n)},Lt=e.pstyle("ghost").value==="yes";if(Lt){var jt=e.pstyle("ghost-offset-x").pfValue,Ne=e.pstyle("ghost-offset-y").pfValue,qe=e.pstyle("ghost-opacity").value,bt=qe*p;t.translate(jt,Ne),ve(),ht(),pe(qe*D),Ae(),tt(bt,!0),ye(qe*X),Xe(),rt(V!==0||q!==0),dt(V!==0||q!==0),tt(bt,!1),_t(bt),t.translate(-jt,-Ne)}g&&t.translate(-h.x,-h.y),vt(),g&&t.translate(h.x,h.y),ve(),ht(),pe(),Ae(),tt(p,!0),ye(),Xe(),rt(V!==0||q!==0),dt(V!==0||q!==0),tt(p,!1),_t(),g&&t.translate(-h.x,-h.y),lt(),ct(),r&&t.translate(C.x1,C.y1)}};var nL=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(r,n,i,a,s){var o=this;if(n.visible()){var l=n.pstyle("".concat(e,"-padding")).pfValue,u=n.pstyle("".concat(e,"-opacity")).value,c=n.pstyle("".concat(e,"-color")).value,h=n.pstyle("".concat(e,"-shape")).value,p=n.pstyle("".concat(e,"-corner-radius")).value;if(u>0){if(i=i||n.position(),a==null||s==null){var g=n.padding();a=n.width()+2*g,s=n.height()+2*g}o.colorFillStyle(r,c[0],c[1],c[2],u),o.nodeShapes[h].draw(r,i.x,i.y,a+l*2,s+l*2,p),r.fill()}}}};lh.drawNodeOverlay=nL("overlay");lh.drawNodeUnderlay=nL("underlay");lh.hasPie=function(t){return t=t[0],t._private.hasPie};lh.hasStripe=function(t){return t=t[0],t._private.hasStripe};lh.drawPie=function(t,e,r,n){e=e[0],n=n||e.position();var i=e.cy().style(),a=e.pstyle("pie-size"),s=e.pstyle("pie-hole"),o=e.pstyle("pie-start-angle").pfValue,l=n.x,u=n.y,c=e.width(),h=e.height(),p=Math.min(c,h)/2,g,y=0,S=this.usePaths();if(S&&(l=0,u=0),a.units==="%"?p=p*a.pfValue:a.pfValue!==void 0&&(p=a.pfValue/2),s.units==="%"?g=p*s.pfValue:s.pfValue!==void 0&&(g=s.pfValue/2),!(g>=p))for(var w=1;w<=i.pieBackgroundN;w++){var C=e.pstyle("pie-"+w+"-background-size").value,_=e.pstyle("pie-"+w+"-background-color").value,T=e.pstyle("pie-"+w+"-background-opacity").value*r,N=C/100;N+y>1&&(N=1-y);var R=1.5*Math.PI+2*Math.PI*y;R+=o;var I=2*Math.PI*N,j=R+I;C===0||y>=1||y+N>1||(g===0?(t.beginPath(),t.moveTo(l,u),t.arc(l,u,p,R,j),t.closePath()):(t.beginPath(),t.arc(l,u,p,R,j),t.arc(l,u,g,j,R,!0),t.closePath()),this.colorFillStyle(t,_[0],_[1],_[2],T),t.fill(),y+=N)}};lh.drawStripe=function(t,e,r,n){e=e[0],n=n||e.position();var i=e.cy().style(),a=n.x,s=n.y,o=e.width(),l=e.height(),u=0,c=this.usePaths();t.save();var h=e.pstyle("stripe-direction").value,p=e.pstyle("stripe-size");switch(h){case"vertical":break;case"righward":t.rotate(-Math.PI/2);break}var g=o,y=l;p.units==="%"?(g=g*p.pfValue,y=y*p.pfValue):p.pfValue!==void 0&&(g=p.pfValue,y=p.pfValue),c&&(a=0,s=0),s-=g/2,a-=y/2;for(var S=1;S<=i.stripeBackgroundN;S++){var w=e.pstyle("stripe-"+S+"-background-size").value,C=e.pstyle("stripe-"+S+"-background-color").value,_=e.pstyle("stripe-"+S+"-background-opacity").value*r,T=w/100;T+u>1&&(T=1-u),!(w===0||u>=1||u+T>1)&&(t.beginPath(),t.rect(a,s+y*u,g,y*T),t.closePath(),this.colorFillStyle(t,C[0],C[1],C[2],_),t.fill(),u+=T)}t.restore()};var Ms={},cU=100;Ms.getPixelRatio=function(){var t=this.data.contexts[0];if(this.forcedPixelRatio!=null)return this.forcedPixelRatio;var e=this.cy.window(),r=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(e.devicePixelRatio||1)/r};Ms.paintCache=function(t){for(var e=this.paintCaches=this.paintCaches||[],r=!0,n,i=0;i<e.length;i++)if(n=e[i],n.context===t){r=!1;break}return r&&(n={context:t},e.push(n)),n};Ms.createGradientStyleFor=function(t,e,r,n,i){var a,s=this.usePaths(),o=r.pstyle(e+"-gradient-stop-colors").value,l=r.pstyle(e+"-gradient-stop-positions").pfValue;if(n==="radial-gradient")if(r.isEdge()){var u=r.sourceEndpoint(),c=r.targetEndpoint(),h=r.midpoint(),p=mf(u,h),g=mf(c,h);a=t.createRadialGradient(h.x,h.y,0,h.x,h.y,Math.max(p,g))}else{var y=s?{x:0,y:0}:r.position(),S=r.paddedWidth(),w=r.paddedHeight();a=t.createRadialGradient(y.x,y.y,0,y.x,y.y,Math.max(S,w))}else if(r.isEdge()){var C=r.sourceEndpoint(),_=r.targetEndpoint();a=t.createLinearGradient(C.x,C.y,_.x,_.y)}else{var T=s?{x:0,y:0}:r.position(),N=r.paddedWidth(),R=r.paddedHeight(),I=N/2,j=R/2,O=r.pstyle("background-gradient-direction").value;switch(O){case"to-bottom":a=t.createLinearGradient(T.x,T.y-j,T.x,T.y+j);break;case"to-top":a=t.createLinearGradient(T.x,T.y+j,T.x,T.y-j);break;case"to-left":a=t.createLinearGradient(T.x+I,T.y,T.x-I,T.y);break;case"to-right":a=t.createLinearGradient(T.x-I,T.y,T.x+I,T.y);break;case"to-bottom-right":case"to-right-bottom":a=t.createLinearGradient(T.x-I,T.y-j,T.x+I,T.y+j);break;case"to-top-right":case"to-right-top":a=t.createLinearGradient(T.x-I,T.y+j,T.x+I,T.y-j);break;case"to-bottom-left":case"to-left-bottom":a=t.createLinearGradient(T.x+I,T.y-j,T.x-I,T.y+j);break;case"to-top-left":case"to-left-top":a=t.createLinearGradient(T.x+I,T.y+j,T.x-I,T.y-j);break}}if(!a)return null;for(var F=l.length===o.length,z=o.length,V=0;V<z;V++)a.addColorStop(F?l[V]:V/(z-1),"rgba("+o[V][0]+","+o[V][1]+","+o[V][2]+","+i+")");return a};Ms.gradientFillStyle=function(t,e,r,n){var i=this.createGradientStyleFor(t,"background",e,r,n);if(!i)return null;t.fillStyle=i};Ms.colorFillStyle=function(t,e,r,n,i){t.fillStyle="rgba("+e+","+r+","+n+","+i+")"};Ms.eleFillStyle=function(t,e,r){var n=e.pstyle("background-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientFillStyle(t,e,n,r);else{var i=e.pstyle("background-color").value;this.colorFillStyle(t,i[0],i[1],i[2],r)}};Ms.gradientStrokeStyle=function(t,e,r,n){var i=this.createGradientStyleFor(t,"line",e,r,n);if(!i)return null;t.strokeStyle=i};Ms.colorStrokeStyle=function(t,e,r,n,i){t.strokeStyle="rgba("+e+","+r+","+n+","+i+")"};Ms.eleStrokeStyle=function(t,e,r){var n=e.pstyle("line-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientStrokeStyle(t,e,n,r);else{var i=e.pstyle("line-color").value;this.colorStrokeStyle(t,i[0],i[1],i[2],r)}};Ms.matchCanvasSize=function(t){var e=this,r=e.data,n=e.findContainerClientCoords(),i=n[2],a=n[3],s=e.getPixelRatio(),o=e.motionBlurPxRatio;(t===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE]||t===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG])&&(s=o);var l=i*s,u=a*s,c;if(!(l===e.canvasWidth&&u===e.canvasHeight)){e.fontCaches=null;var h=r.canvasContainer;h.style.width=i+"px",h.style.height=a+"px";for(var p=0;p<e.CANVAS_LAYERS;p++)c=r.canvases[p],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";for(var p=0;p<e.BUFFER_COUNT;p++)c=r.bufferCanvases[p],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";e.textureMult=1,s<=1&&(c=r.bufferCanvases[e.TEXTURE_BUFFER],e.textureMult=2,c.width=l*e.textureMult,c.height=u*e.textureMult),e.canvasWidth=l,e.canvasHeight=u,e.pixelRatio=s}};Ms.renderTo=function(t,e,r,n){this.render({forcedContext:t,forcedZoom:e,forcedPan:r,drawAllLayers:!0,forcedPxRatio:n})};Ms.clearCanvas=function(){var t=this,e=t.data;function r(n){n.clearRect(0,0,t.canvasWidth,t.canvasHeight)}r(e.contexts[t.NODE]),r(e.contexts[t.DRAG])};Ms.render=function(t){var e=this;t=t||WM();var r=e.cy,n=t.forcedContext,i=t.drawAllLayers,a=t.drawOnlyNodeLayer,s=t.forcedZoom,o=t.forcedPan,l=t.forcedPxRatio===void 0?this.getPixelRatio():t.forcedPxRatio,u=e.data,c=u.canvasNeedsRedraw,h=e.textureOnViewport&&!n&&(e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming),p=t.motionBlur!==void 0?t.motionBlur:e.motionBlur,g=e.motionBlurPxRatio,y=r.hasCompoundNodes(),S=e.hoverData.draggingEles,w=!!(e.hoverData.selecting||e.touchData.selecting);p=p&&!n&&e.motionBlurEnabled&&!w;var C=p;n||(e.prevPxRatio!==l&&(e.invalidateContainerClientCoordsCache(),e.matchCanvasSize(e.container),e.redrawHint("eles",!0),e.redrawHint("drag",!0)),e.prevPxRatio=l),!n&&e.motionBlurTimeout&&clearTimeout(e.motionBlurTimeout),p&&(e.mbFrames==null&&(e.mbFrames=0),e.mbFrames++,e.mbFrames<3&&(C=!1),e.mbFrames>e.minMbLowQualFrames&&(e.motionBlurPxRatio=e.mbPxRBlurry)),e.clearingMotionBlur&&(e.motionBlurPxRatio=1),e.textureDrawLastFrame&&!h&&(c[e.NODE]=!0,c[e.SELECT_BOX]=!0);var _=r.style(),T=r.zoom(),N=s!==void 0?s:T,R=r.pan(),I={x:R.x,y:R.y},j={zoom:T,pan:{x:R.x,y:R.y}},O=e.prevViewport,F=O===void 0||j.zoom!==O.zoom||j.pan.x!==O.pan.x||j.pan.y!==O.pan.y;!F&&!(S&&!y)&&(e.motionBlurPxRatio=1),o&&(I=o),N*=l,I.x*=l,I.y*=l;var z=e.getCachedZSortedEles();function V(ye,ve,ue,xe,Se){var Oe=ye.globalCompositeOperation;ye.globalCompositeOperation="destination-out",e.colorFillStyle(ye,255,255,255,e.motionBlurTransparency),ye.fillRect(ve,ue,xe,Se),ye.globalCompositeOperation=Oe}function q(ye,ve){var ue,xe,Se,Oe;!e.clearingMotionBlur&&(ye===u.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]||ye===u.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG])?(ue={x:R.x*g,y:R.y*g},xe=T*g,Se=e.canvasWidth*g,Oe=e.canvasHeight*g):(ue=I,xe=N,Se=e.canvasWidth,Oe=e.canvasHeight),ye.setTransform(1,0,0,1,0,0),ve==="motionBlur"?V(ye,0,0,Se,Oe):!n&&(ve===void 0||ve)&&ye.clearRect(0,0,Se,Oe),i||(ye.translate(ue.x,ue.y),ye.scale(xe,xe)),o&&ye.translate(o.x,o.y),s&&ye.scale(s,s)}if(h||(e.textureDrawLastFrame=!1),h){if(e.textureDrawLastFrame=!0,!e.textureCache){e.textureCache={},e.textureCache.bb=r.mutableElements().boundingBox(),e.textureCache.texture=e.data.bufferCanvases[e.TEXTURE_BUFFER];var D=e.data.bufferContexts[e.TEXTURE_BUFFER];D.setTransform(1,0,0,1,0,0),D.clearRect(0,0,e.canvasWidth*e.textureMult,e.canvasHeight*e.textureMult),e.render({forcedContext:D,drawOnlyNodeLayer:!0,forcedPxRatio:l*e.textureMult});var j=e.textureCache.viewport={zoom:r.zoom(),pan:r.pan(),width:e.canvasWidth,height:e.canvasHeight};j.mpan={x:(0-j.pan.x)/j.zoom,y:(0-j.pan.y)/j.zoom}}c[e.DRAG]=!1,c[e.NODE]=!1;var U=u.contexts[e.NODE],G=e.textureCache.texture,j=e.textureCache.viewport;U.setTransform(1,0,0,1,0,0),p?V(U,0,0,j.width,j.height):U.clearRect(0,0,j.width,j.height);var Z=_.core("outside-texture-bg-color").value,K=_.core("outside-texture-bg-opacity").value;e.colorFillStyle(U,Z[0],Z[1],Z[2],K),U.fillRect(0,0,j.width,j.height);var T=r.zoom();q(U,!1),U.clearRect(j.mpan.x,j.mpan.y,j.width/j.zoom/l,j.height/j.zoom/l),U.drawImage(G,j.mpan.x,j.mpan.y,j.width/j.zoom/l,j.height/j.zoom/l)}else e.textureOnViewport&&!n&&(e.textureCache=null);var Q=r.extent(),ne=e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming||e.hoverData.draggingEles||e.cy.animated(),te=e.hideEdgesOnViewport&&ne,X=[];if(X[e.NODE]=!c[e.NODE]&&p&&!e.clearedForMotionBlur[e.NODE]||e.clearingMotionBlur,X[e.NODE]&&(e.clearedForMotionBlur[e.NODE]=!0),X[e.DRAG]=!c[e.DRAG]&&p&&!e.clearedForMotionBlur[e.DRAG]||e.clearingMotionBlur,X[e.DRAG]&&(e.clearedForMotionBlur[e.DRAG]=!0),c[e.NODE]||i||a||X[e.NODE]){var re=p&&!X[e.NODE]&&g!==1,U=n||(re?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]:u.contexts[e.NODE]),he=p&&!re?"motionBlur":void 0;q(U,he),te?e.drawCachedNodes(U,z.nondrag,l,Q):e.drawLayeredElements(U,z.nondrag,l,Q),e.debug&&e.drawDebugPoints(U,z.nondrag),!i&&!p&&(c[e.NODE]=!1)}if(!a&&(c[e.DRAG]||i||X[e.DRAG])){var re=p&&!X[e.DRAG]&&g!==1,U=n||(re?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG]:u.contexts[e.DRAG]);q(U,p&&!re?"motionBlur":void 0),te?e.drawCachedNodes(U,z.drag,l,Q):e.drawCachedElements(U,z.drag,l,Q),e.debug&&e.drawDebugPoints(U,z.drag),!i&&!p&&(c[e.DRAG]=!1)}if(this.drawSelectionRectangle(t,q),p&&g!==1){var oe=u.contexts[e.NODE],se=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE],fe=u.contexts[e.DRAG],ae=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG],pe=function(ve,ue,xe){ve.setTransform(1,0,0,1,0,0),xe||!C?ve.clearRect(0,0,e.canvasWidth,e.canvasHeight):V(ve,0,0,e.canvasWidth,e.canvasHeight);var Se=g;ve.drawImage(ue,0,0,e.canvasWidth*Se,e.canvasHeight*Se,0,0,e.canvasWidth,e.canvasHeight)};(c[e.NODE]||X[e.NODE])&&(pe(oe,se,X[e.NODE]),c[e.NODE]=!1),(c[e.DRAG]||X[e.DRAG])&&(pe(fe,ae,X[e.DRAG]),c[e.DRAG]=!1)}e.prevViewport=j,e.clearingMotionBlur&&(e.clearingMotionBlur=!1,e.motionBlurCleared=!0,e.motionBlur=!0),p&&(e.motionBlurTimeout=setTimeout(function(){e.motionBlurTimeout=null,e.clearedForMotionBlur[e.NODE]=!1,e.clearedForMotionBlur[e.DRAG]=!1,e.motionBlur=!1,e.clearingMotionBlur=!h,e.mbFrames=0,c[e.NODE]=!0,c[e.DRAG]=!0,e.redraw()},cU)),n||r.emit("render")};var Wm;Ms.drawSelectionRectangle=function(t,e){var r=this,n=r.cy,i=r.data,a=n.style(),s=t.drawOnlyNodeLayer,o=t.drawAllLayers,l=i.canvasNeedsRedraw,u=t.forcedContext;if(r.showFps||!s&&l[r.SELECT_BOX]&&!o){var c=u||i.contexts[r.SELECT_BOX];if(e(c),r.selection[4]==1&&(r.hoverData.selecting||r.touchData.selecting)){var h=r.cy.zoom(),p=a.core("selection-box-border-width").value/h;c.lineWidth=p,c.fillStyle="rgba("+a.core("selection-box-color").value[0]+","+a.core("selection-box-color").value[1]+","+a.core("selection-box-color").value[2]+","+a.core("selection-box-opacity").value+")",c.fillRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]),p>0&&(c.strokeStyle="rgba("+a.core("selection-box-border-color").value[0]+","+a.core("selection-box-border-color").value[1]+","+a.core("selection-box-border-color").value[2]+","+a.core("selection-box-opacity").value+")",c.strokeRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]))}if(i.bgActivePosistion&&!r.hoverData.selecting){var h=r.cy.zoom(),g=i.bgActivePosistion;c.fillStyle="rgba("+a.core("active-bg-color").value[0]+","+a.core("active-bg-color").value[1]+","+a.core("active-bg-color").value[2]+","+a.core("active-bg-opacity").value+")",c.beginPath(),c.arc(g.x,g.y,a.core("active-bg-size").pfValue/h,0,2*Math.PI),c.fill()}var y=r.lastRedrawTime;if(r.showFps&&y){y=Math.round(y);var S=Math.round(1e3/y),w="1 frame = "+y+" ms = "+S+" fps";if(c.setTransform(1,0,0,1,0,0),c.fillStyle="rgba(255, 0, 0, 0.75)",c.strokeStyle="rgba(255, 0, 0, 0.75)",c.font="30px Arial",!Wm){var C=c.measureText(w);Wm=C.actualBoundingBoxAscent}c.fillText(w,0,Wm);var _=60;c.strokeRect(0,Wm+10,250,20),c.fillRect(0,Wm+10,250*Math.min(S/_,1),20)}o||(l[r.SELECT_BOX]=!1)}};function $N(t,e,r){var n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n));return n}function dU(t,e,r){var n=$N(t,t.VERTEX_SHADER,e),i=$N(t,t.FRAGMENT_SHADER,r),a=t.createProgram();if(t.attachShader(a,n),t.attachShader(a,i),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new Error("Could not initialize shaders");return a}function hU(t,e,r){r===void 0&&(r=e);var n=t.makeOffscreenCanvas(e,r),i=n.context=n.getContext("2d");return n.clear=function(){return i.clearRect(0,0,n.width,n.height)},n.clear(),n}function b_(t){var e=t.pixelRatio,r=t.cy.zoom(),n=t.cy.pan();return{zoom:r*e,pan:{x:n.x*e,y:n.y*e}}}function fU(t){var e=t.pixelRatio,r=t.cy.zoom();return r*e}function pU(t,e,r,n,i){var a=n*r+e.x,s=i*r+e.y;return s=Math.round(t.canvasHeight-s),[a,s]}function mU(t){return t.pstyle("background-fill").value!=="solid"||t.pstyle("background-image").strValue!=="none"?!1:t.pstyle("border-width").value===0||t.pstyle("border-opacity").value===0?!0:t.pstyle("border-style").value==="solid"}function gU(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Vh(t,e,r){var n=t[0]/255,i=t[1]/255,a=t[2]/255,s=e,o=r||new Array(4);return o[0]=n*s,o[1]=i*s,o[2]=a*s,o[3]=s,o}function vp(t,e){var r=e||new Array(4);return r[0]=(t>>0&255)/255,r[1]=(t>>8&255)/255,r[2]=(t>>16&255)/255,r[3]=(t>>24&255)/255,r}function vU(t){return t[0]+(t[1]<<8)+(t[2]<<16)+(t[3]<<24)}function yU(t,e){var r=t.createTexture();return r.buffer=function(n){t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)},r.deleteTexture=function(){t.deleteTexture(r)},r}function iL(t,e){switch(e){case"float":return[1,t.FLOAT,4];case"vec2":return[2,t.FLOAT,4];case"vec3":return[3,t.FLOAT,4];case"vec4":return[4,t.FLOAT,4];case"int":return[1,t.INT,4];case"ivec2":return[2,t.INT,4]}}function aL(t,e,r){switch(e){case t.FLOAT:return new Float32Array(r);case t.INT:return new Int32Array(r)}}function xU(t,e,r,n,i,a){switch(e){case t.FLOAT:return new Float32Array(r.buffer,a*n,i);case t.INT:return new Int32Array(r.buffer,a*n,i)}}function bU(t,e,r,n){var i=iL(t,e),a=Di(i,2),s=a[0],o=a[1],l=aL(t,o,n),u=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW),o===t.FLOAT?t.vertexAttribPointer(r,s,o,!1,0,0):o===t.INT&&t.vertexAttribIPointer(r,s,o,0,0),t.enableVertexAttribArray(r),t.bindBuffer(t.ARRAY_BUFFER,null),u}function vu(t,e,r,n){var i=iL(t,r),a=Di(i,3),s=a[0],o=a[1],l=a[2],u=aL(t,o,e*s),c=s*l,h=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,e*c,t.DYNAMIC_DRAW),t.enableVertexAttribArray(n),o===t.FLOAT?t.vertexAttribPointer(n,s,o,!1,c,0):o===t.INT&&t.vertexAttribIPointer(n,s,o,c,0),t.vertexAttribDivisor(n,1),t.bindBuffer(t.ARRAY_BUFFER,null);for(var p=new Array(e),g=0;g<e;g++)p[g]=xU(t,o,u,c,s,g);return h.dataArray=u,h.stride=c,h.size=s,h.getView=function(y){return p[y]},h.setPoint=function(y,S,w){var C=p[y];C[0]=S,C[1]=w},h.bufferSubData=function(y){t.bindBuffer(t.ARRAY_BUFFER,h),y?t.bufferSubData(t.ARRAY_BUFFER,0,u,0,y*s):t.bufferSubData(t.ARRAY_BUFFER,0,u)},h}function wU(t,e,r){for(var n=9,i=new Float32Array(e*n),a=new Array(e),s=0;s<e;s++){var o=s*n*4;a[s]=new Float32Array(i.buffer,o,n)}var l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,i.byteLength,t.DYNAMIC_DRAW);for(var u=0;u<3;u++){var c=r+u;t.enableVertexAttribArray(c),t.vertexAttribPointer(c,3,t.FLOAT,!1,36,u*12),t.vertexAttribDivisor(c,1)}return t.bindBuffer(t.ARRAY_BUFFER,null),l.getMatrixView=function(h){return a[h]},l.setData=function(h,p){a[p].set(h,0)},l.bufferSubData=function(){t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferSubData(t.ARRAY_BUFFER,0,i)},l}function SU(t){var e=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,e);var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.bindFramebuffer(t.FRAMEBUFFER,null),e.setFramebufferAttachmentSizes=function(n,i){t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,i,0,t.RGBA,t.UNSIGNED_BYTE,null)},e}var KN=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function f2(){var t=new KN(9);return KN!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ZN(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function kU(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=r[0],g=r[1],y=r[2],S=r[3],w=r[4],C=r[5],_=r[6],T=r[7],N=r[8];return t[0]=p*n+g*s+y*u,t[1]=p*i+g*o+y*c,t[2]=p*a+g*l+y*h,t[3]=S*n+w*s+C*u,t[4]=S*i+w*o+C*c,t[5]=S*a+w*l+C*h,t[6]=_*n+T*s+N*u,t[7]=_*i+T*o+N*c,t[8]=_*a+T*l+N*h,t}function Hy(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=r[0],g=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=s,t[4]=o,t[5]=l,t[6]=p*n+g*s+u,t[7]=p*i+g*o+c,t[8]=p*a+g*l+h,t}function YN(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=Math.sin(r),g=Math.cos(r);return t[0]=g*n+p*s,t[1]=g*i+p*o,t[2]=g*a+p*l,t[3]=g*s-p*n,t[4]=g*o-p*i,t[5]=g*l-p*a,t[6]=u,t[7]=c,t[8]=h,t}function ZS(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function _U(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}var CU=(function(){function t(e,r,n,i){ah(this,t),this.debugID=Math.floor(Math.random()*1e4),this.r=e,this.texSize=r,this.texRows=n,this.texHeight=Math.floor(r/n),this.enableWrapping=!0,this.locked=!1,this.texture=null,this.needsBuffer=!0,this.freePointer={x:0,row:0},this.keyToLocation=new Map,this.canvas=i(e,r,r),this.scratch=i(e,r,this.texHeight,"scratch")}return sh(t,[{key:"lock",value:function(){this.locked=!0}},{key:"getKeys",value:function(){return new Set(this.keyToLocation.keys())}},{key:"getScale",value:function(r){var n=r.w,i=r.h,a=this.texHeight,s=this.texSize,o=a/i,l=n*o,u=i*o;return l>s&&(o=s/n,l=n*o,u=i*o),{scale:o,texW:l,texH:u}}},{key:"draw",value:function(r,n,i){var a=this;if(this.locked)throw new Error("can't draw, atlas is locked");var s=this.texSize,o=this.texRows,l=this.texHeight,u=this.getScale(n),c=u.scale,h=u.texW,p=u.texH,g=function(T,N){if(i&&N){var R=N.context,I=T.x,j=T.row,O=I,F=l*j;R.save(),R.translate(O,F),R.scale(c,c),i(R,n),R.restore()}},y=[null,null],S=function(){g(a.freePointer,a.canvas),y[0]={x:a.freePointer.x,y:a.freePointer.row*l,w:h,h:p},y[1]={x:a.freePointer.x+h,y:a.freePointer.row*l,w:0,h:p},a.freePointer.x+=h,a.freePointer.x==s&&(a.freePointer.x=0,a.freePointer.row++)},w=function(){var T=a.scratch,N=a.canvas;T.clear(),g({x:0,row:0},T);var R=s-a.freePointer.x,I=h-R,j=l;{var O=a.freePointer.x,F=a.freePointer.row*l,z=R;N.context.drawImage(T,0,0,z,j,O,F,z,j),y[0]={x:O,y:F,w:z,h:p}}{var V=R,q=(a.freePointer.row+1)*l,D=I;N&&N.context.drawImage(T,V,0,D,j,0,q,D,j),y[1]={x:0,y:q,w:D,h:p}}a.freePointer.x=I,a.freePointer.row++},C=function(){a.freePointer.x=0,a.freePointer.row++};if(this.freePointer.x+h<=s)S();else{if(this.freePointer.row>=o-1)return!1;this.freePointer.x===s?(C(),S()):this.enableWrapping?w():(C(),S())}return this.keyToLocation.set(r,y),this.needsBuffer=!0,y}},{key:"getOffsets",value:function(r){return this.keyToLocation.get(r)}},{key:"isEmpty",value:function(){return this.freePointer.x===0&&this.freePointer.row===0}},{key:"canFit",value:function(r){if(this.locked)return!1;var n=this.texSize,i=this.texRows,a=this.getScale(r),s=a.texW;return this.freePointer.x+s>n?this.freePointer.row<i-1:!0}},{key:"bufferIfNeeded",value:function(r){this.texture||(this.texture=yU(r,this.debugID)),this.needsBuffer&&(this.texture.buffer(this.canvas),this.needsBuffer=!1,this.locked&&(this.canvas=null,this.scratch=null))}},{key:"dispose",value:function(){this.texture&&(this.texture.deleteTexture(),this.texture=null),this.canvas=null,this.scratch=null,this.locked=!0}}])})(),EU=(function(){function t(e,r,n,i){ah(this,t),this.r=e,this.texSize=r,this.texRows=n,this.createTextureCanvas=i,this.atlases=[],this.styleKeyToAtlas=new Map,this.markedKeys=new Set}return sh(t,[{key:"getKeys",value:function(){return new Set(this.styleKeyToAtlas.keys())}},{key:"_createAtlas",value:function(){var r=this.r,n=this.texSize,i=this.texRows,a=this.createTextureCanvas;return new CU(r,n,i,a)}},{key:"_getScratchCanvas",value:function(){if(!this.scratch){var r=this.r,n=this.texSize,i=this.texRows,a=this.createTextureCanvas,s=Math.floor(n/i);this.scratch=a(r,n,s,"scratch")}return this.scratch}},{key:"draw",value:function(r,n,i){var a=this.styleKeyToAtlas.get(r);return a||(a=this.atlases[this.atlases.length-1],(!a||!a.canFit(n))&&(a&&a.lock(),a=this._createAtlas(),this.atlases.push(a)),a.draw(r,n,i),this.styleKeyToAtlas.set(r,a)),a}},{key:"getAtlas",value:function(r){return this.styleKeyToAtlas.get(r)}},{key:"hasAtlas",value:function(r){return this.styleKeyToAtlas.has(r)}},{key:"markKeyForGC",value:function(r){this.markedKeys.add(r)}},{key:"gc",value:function(){var r=this,n=this.markedKeys;if(n.size===0){console.log("nothing to garbage collect");return}var i=[],a=new Map,s=null,o=Ys(this.atlases),l;try{var u=function(){var h=l.value,p=h.getKeys(),g=TU(n,p);if(g.size===0)return i.push(h),p.forEach(function(R){return a.set(R,h)}),1;s||(s=r._createAtlas(),i.push(s));var y=Ys(p),S;try{for(y.s();!(S=y.n()).done;){var w=S.value;if(!g.has(w)){var C=h.getOffsets(w),_=Di(C,2),T=_[0],N=_[1];s.canFit({w:T.w+N.w,h:T.h})||(s.lock(),s=r._createAtlas(),i.push(s)),h.canvas&&(r._copyTextureToNewAtlas(w,h,s),a.set(w,s))}}}catch(R){y.e(R)}finally{y.f()}h.dispose()};for(o.s();!(l=o.n()).done;)u()}catch(c){o.e(c)}finally{o.f()}this.atlases=i,this.styleKeyToAtlas=a,this.markedKeys=new Set}},{key:"_copyTextureToNewAtlas",value:function(r,n,i){var a=n.getOffsets(r),s=Di(a,2),o=s[0],l=s[1];if(l.w===0)i.draw(r,o,function(p){p.drawImage(n.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h)});else{var u=this._getScratchCanvas();u.clear(),u.context.drawImage(n.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h),u.context.drawImage(n.canvas,l.x,l.y,l.w,l.h,o.w,0,l.w,l.h);var c=o.w+l.w,h=o.h;i.draw(r,{w:c,h},function(p){p.drawImage(u,0,0,c,h,0,0,c,h)})}}},{key:"getCounts",value:function(){return{keyCount:this.styleKeyToAtlas.size,atlasCount:new Set(this.styleKeyToAtlas.values()).size}}}])})();function TU(t,e){return t.intersection?t.intersection(e):new Set(nx(t).filter(function(r){return e.has(r)}))}var NU=(function(){function t(e,r){ah(this,t),this.r=e,this.globalOptions=r,this.atlasSize=r.webglTexSize,this.maxAtlasesPerBatch=r.webglTexPerBatch,this.renderTypes=new Map,this.collections=new Map,this.typeAndIdToKey=new Map}return sh(t,[{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"addAtlasCollection",value:function(r,n){var i=this.globalOptions,a=i.webglTexSize,s=i.createTextureCanvas,o=n.texRows,l=this._cacheScratchCanvas(s),u=new EU(this.r,a,o,l);this.collections.set(r,u)}},{key:"addRenderType",value:function(r,n){var i=n.collection;if(!this.collections.has(i))throw new Error("invalid atlas collection name '".concat(i,"'"));var a=this.collections.get(i),s=ar({type:r,atlasCollection:a},n);this.renderTypes.set(r,s)}},{key:"getRenderTypeOpts",value:function(r){return this.renderTypes.get(r)}},{key:"getAtlasCollection",value:function(r){return this.collections.get(r)}},{key:"_cacheScratchCanvas",value:function(r){var n=-1,i=-1,a=null;return function(s,o,l,u){return u?((!a||o!=n||l!=i)&&(n=o,i=l,a=r(s,o,l)),a):r(s,o,l)}}},{key:"_key",value:function(r,n){return"".concat(r,"-").concat(n)}},{key:"invalidate",value:function(r){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.forceRedraw,s=a===void 0?!1:a,o=i.filterEle,l=o===void 0?function(){return!0}:o,u=i.filterType,c=u===void 0?function(){return!0}:u,h=!1,p=!1,g=Ys(r),y;try{for(g.s();!(y=g.n()).done;){var S=y.value;if(l(S)){var w=Ys(this.renderTypes.values()),C;try{var _=function(){var N=C.value,R=N.type;if(c(R)){var I=n.collections.get(N.collection),j=N.getKey(S),O=Array.isArray(j)?j:[j];if(s)O.forEach(function(q){return I.markKeyForGC(q)}),p=!0;else{var F=N.getID?N.getID(S):S.id(),z=n._key(R,F),V=n.typeAndIdToKey.get(z);V!==void 0&&!gU(O,V)&&(h=!0,n.typeAndIdToKey.delete(z),V.forEach(function(q){return I.markKeyForGC(q)}))}}};for(w.s();!(C=w.n()).done;)_()}catch(T){w.e(T)}finally{w.f()}}}}catch(T){g.e(T)}finally{g.f()}return p&&(this.gc(),h=!1),h}},{key:"gc",value:function(){var r=Ys(this.collections.values()),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;i.gc()}}catch(a){r.e(a)}finally{r.f()}}},{key:"getOrCreateAtlas",value:function(r,n,i,a){var s=this.renderTypes.get(n),o=this.collections.get(s.collection),l=!1,u=o.draw(a,i,function(p){s.drawClipped?(p.save(),p.beginPath(),p.rect(0,0,i.w,i.h),p.clip(),s.drawElement(p,r,i,!0,!0),p.restore()):s.drawElement(p,r,i,!0,!0),l=!0});if(l){var c=s.getID?s.getID(r):r.id(),h=this._key(n,c);this.typeAndIdToKey.has(h)?this.typeAndIdToKey.get(h).push(a):this.typeAndIdToKey.set(h,[a])}return u}},{key:"getAtlasInfo",value:function(r,n){var i=this,a=this.renderTypes.get(n),s=a.getKey(r),o=Array.isArray(s)?s:[s];return o.map(function(l){var u=a.getBoundingBox(r,l),c=i.getOrCreateAtlas(r,n,u,l),h=c.getOffsets(l),p=Di(h,2),g=p[0],y=p[1];return{atlas:c,tex:g,tex1:g,tex2:y,bb:u}})}},{key:"getDebugInfo",value:function(){var r=[],n=Ys(this.collections),i;try{for(n.s();!(i=n.n()).done;){var a=Di(i.value,2),s=a[0],o=a[1],l=o.getCounts(),u=l.keyCount,c=l.atlasCount;r.push({type:s,keyCount:u,atlasCount:c})}}catch(h){n.e(h)}finally{n.f()}return r}}])})(),PU=(function(){function t(e){ah(this,t),this.globalOptions=e,this.atlasSize=e.webglTexSize,this.maxAtlasesPerBatch=e.webglTexPerBatch,this.batchAtlases=[]}return sh(t,[{key:"getMaxAtlasesPerBatch",value:function(){return this.maxAtlasesPerBatch}},{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"getIndexArray",value:function(){return Array.from({length:this.maxAtlasesPerBatch},function(r,n){return n})}},{key:"startBatch",value:function(){this.batchAtlases=[]}},{key:"getAtlasCount",value:function(){return this.batchAtlases.length}},{key:"getAtlases",value:function(){return this.batchAtlases}},{key:"canAddToCurrentBatch",value:function(r){return this.batchAtlases.length===this.maxAtlasesPerBatch?this.batchAtlases.includes(r):!0}},{key:"getAtlasIndexForBatch",value:function(r){var n=this.batchAtlases.indexOf(r);if(n<0){if(this.batchAtlases.length===this.maxAtlasesPerBatch)throw new Error("cannot add more atlases to batch");this.batchAtlases.push(r),n=this.batchAtlases.length-1}return n}}])})(),MU=`
  float circleSD(vec2 p, float r) {
    return distance(vec2(0), p) - r; // signed distance
  }
`,AU=`
  float rectangleSD(vec2 p, vec2 b) {
    vec2 d = abs(p)-b;
    return distance(vec2(0),max(d,0.0)) + min(max(d.x,d.y),0.0);
  }
`,LU=`
  float roundRectangleSD(vec2 p, vec2 b, vec4 cr) {
    cr.xy = (p.x > 0.0) ? cr.xy : cr.zw;
    cr.x  = (p.y > 0.0) ? cr.x  : cr.y;
    vec2 q = abs(p) - b + cr.x;
    return min(max(q.x, q.y), 0.0) + distance(vec2(0), max(q, 0.0)) - cr.x;
  }
`,RU=`
  float ellipseSD(vec2 p, vec2 ab) {
    p = abs( p ); // symmetry

    // find root with Newton solver
    vec2 q = ab*(p-ab);
    float w = (q.x<q.y)? 1.570796327 : 0.0;
    for( int i=0; i<5; i++ ) {
      vec2 cs = vec2(cos(w),sin(w));
      vec2 u = ab*vec2( cs.x,cs.y);
      vec2 v = ab*vec2(-cs.y,cs.x);
      w = w + dot(p-u,v)/(dot(p-u,u)+dot(v,v));
    }
    
    // compute final point and distance
    float d = length(p-ab*vec2(cos(w),sin(w)));
    
    // return signed distance
    return (dot(p/ab,p/ab)>1.0) ? d : -d;
  }
`,tv={SCREEN:{name:"screen",screen:!0},PICKING:{name:"picking",picking:!0}},mx={IGNORE:1,USE_BB:2},p2=0,XN=1,QN=2,m2=3,yp=4,oy=5,qm=6,$m=7,OU=(function(){function t(e,r,n){ah(this,t),this.r=e,this.gl=r,this.maxInstances=n.webglBatchSize,this.atlasSize=n.webglTexSize,this.bgColor=n.bgColor,this.debug=n.webglDebug,this.batchDebugInfo=[],n.enableWrapping=!0,n.createTextureCanvas=hU,this.atlasManager=new NU(e,n),this.batchManager=new PU(n),this.simpleShapeOptions=new Map,this.program=this._createShaderProgram(tv.SCREEN),this.pickingProgram=this._createShaderProgram(tv.PICKING),this.vao=this._createVAO()}return sh(t,[{key:"addAtlasCollection",value:function(r,n){this.atlasManager.addAtlasCollection(r,n)}},{key:"addTextureAtlasRenderType",value:function(r,n){this.atlasManager.addRenderType(r,n)}},{key:"addSimpleShapeRenderType",value:function(r,n){this.simpleShapeOptions.set(r,n)}},{key:"invalidate",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.type,a=this.atlasManager;return i?a.invalidate(r,{filterType:function(o){return o===i},forceRedraw:!0}):a.invalidate(r)}},{key:"gc",value:function(){this.atlasManager.gc()}},{key:"_createShaderProgram",value:function(r){var n=this.gl,i=`#version 300 es
      precision highp float;

      uniform mat3 uPanZoomMatrix;
      uniform int  uAtlasSize;
      
      // instanced
      in vec2 aPosition; // a vertex from the unit square
      
      in mat3 aTransform; // used to transform verticies, eg into a bounding box
      in int aVertType; // the type of thing we are rendering

      // the z-index that is output when using picking mode
      in vec4 aIndex;
      
      // For textures
      in int aAtlasId; // which shader unit/atlas to use
      in vec4 aTex; // x/y/w/h of texture in atlas

      // for edges
      in vec4 aPointAPointB;
      in vec4 aPointCPointD;
      in vec2 aLineWidth; // also used for node border width

      // simple shapes
      in vec4 aCornerRadius; // for round-rectangle [top-right, bottom-right, top-left, bottom-left]
      in vec4 aColor; // also used for edges
      in vec4 aBorderColor; // aLineWidth is used for border width

      // output values passed to the fragment shader
      out vec2 vTexCoord;
      out vec4 vColor;
      out vec2 vPosition;
      // flat values are not interpolated
      flat out int vAtlasId; 
      flat out int vVertType;
      flat out vec2 vTopRight;
      flat out vec2 vBotLeft;
      flat out vec4 vCornerRadius;
      flat out vec4 vBorderColor;
      flat out vec2 vBorderWidth;
      flat out vec4 vIndex;
      
      void main(void) {
        int vid = gl_VertexID;
        vec2 position = aPosition; // TODO make this a vec3, simplifies some code below

        if(aVertType == `.concat(p2,`) {
          float texX = aTex.x; // texture coordinates
          float texY = aTex.y;
          float texW = aTex.z;
          float texH = aTex.w;

          if(vid == 1 || vid == 2 || vid == 4) {
            texX += texW;
          }
          if(vid == 2 || vid == 4 || vid == 5) {
            texY += texH;
          }

          float d = float(uAtlasSize);
          vTexCoord = vec2(texX / d, texY / d); // tex coords must be between 0 and 1

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(yp," || aVertType == ").concat($m,` 
             || aVertType == `).concat(oy," || aVertType == ").concat(qm,`) { // simple shapes

          // the bounding box is needed by the fragment shader
          vBotLeft  = (aTransform * vec3(0, 0, 1)).xy; // flat
          vTopRight = (aTransform * vec3(1, 1, 1)).xy; // flat
          vPosition = (aTransform * vec3(position, 1)).xy; // will be interpolated

          // calculations are done in the fragment shader, just pass these along
          vColor = aColor;
          vCornerRadius = aCornerRadius;
          vBorderColor = aBorderColor;
          vBorderWidth = aLineWidth;

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(XN,`) {
          vec2 source = aPointAPointB.xy;
          vec2 target = aPointAPointB.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          // stretch the unit square into a long skinny rectangle
          vec2 xBasis = target - source;
          vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
          vec2 point = source + xBasis * position.x + yBasis * aLineWidth[0] * position.y;

          gl_Position = vec4(uPanZoomMatrix * vec3(point, 1.0), 1.0);
          vColor = aColor;
        } 
        else if(aVertType == `).concat(QN,`) {
          vec2 pointA = aPointAPointB.xy;
          vec2 pointB = aPointAPointB.zw;
          vec2 pointC = aPointCPointD.xy;
          vec2 pointD = aPointCPointD.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          vec2 p0, p1, p2, pos;
          if(position.x == 0.0) { // The left side of the unit square
            p0 = pointA;
            p1 = pointB;
            p2 = pointC;
            pos = position;
          } else { // The right side of the unit square, use same approach but flip the geometry upside down
            p0 = pointD;
            p1 = pointC;
            p2 = pointB;
            pos = vec2(0.0, -position.y);
          }

          vec2 p01 = p1 - p0;
          vec2 p12 = p2 - p1;
          vec2 p21 = p1 - p2;

          // Find the normal vector.
          vec2 tangent = normalize(normalize(p12) + normalize(p01));
          vec2 normal = vec2(-tangent.y, tangent.x);

          // Find the vector perpendicular to p0 -> p1.
          vec2 p01Norm = normalize(vec2(-p01.y, p01.x));

          // Determine the bend direction.
          float sigma = sign(dot(p01 + p21, normal));
          float width = aLineWidth[0];

          if(sign(pos.y) == -sigma) {
            // This is an intersecting vertex. Adjust the position so that there's no overlap.
            vec2 point = 0.5 * width * normal * -sigma / dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          } else {
            // This is a non-intersecting vertex. Treat it like a mitre join.
            vec2 point = 0.5 * width * normal * sigma * dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          }

          vColor = aColor;
        } 
        else if(aVertType == `).concat(m2,` && vid < 3) {
          // massage the first triangle into an edge arrow
          if(vid == 0)
            position = vec2(-0.15, -0.3);
          if(vid == 1)
            position = vec2(  0.0,  0.0);
          if(vid == 2)
            position = vec2( 0.15, -0.3);

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
          vColor = aColor;
        }
        else {
          gl_Position = vec4(2.0, 0.0, 0.0, 1.0); // discard vertex by putting it outside webgl clip space
        }

        vAtlasId = aAtlasId;
        vVertType = aVertType;
        vIndex = aIndex;
      }
    `),a=this.batchManager.getIndexArray(),s=`#version 300 es
      precision highp float;

      // declare texture unit for each texture atlas in the batch
      `.concat(a.map(function(u){return"uniform sampler2D uTexture".concat(u,";")}).join(`
	`),`

      uniform vec4 uBGColor;
      uniform float uZoom;

      in vec2 vTexCoord;
      in vec4 vColor;
      in vec2 vPosition; // model coordinates

      flat in int vAtlasId;
      flat in vec4 vIndex;
      flat in int vVertType;
      flat in vec2 vTopRight;
      flat in vec2 vBotLeft;
      flat in vec4 vCornerRadius;
      flat in vec4 vBorderColor;
      flat in vec2 vBorderWidth;

      out vec4 outColor;

      `).concat(MU,`
      `).concat(AU,`
      `).concat(LU,`
      `).concat(RU,`

      vec4 blend(vec4 top, vec4 bot) { // blend colors with premultiplied alpha
        return vec4( 
          top.rgb + (bot.rgb * (1.0 - top.a)),
          top.a   + (bot.a   * (1.0 - top.a)) 
        );
      }

      vec4 distInterp(vec4 cA, vec4 cB, float d) { // interpolate color using Signed Distance
        // scale to the zoom level so that borders don't look blurry when zoomed in
        // note 1.5 is an aribitrary value chosen because it looks good
        return mix(cA, cB, 1.0 - smoothstep(0.0, 1.5 / uZoom, abs(d))); 
      }

      void main(void) {
        if(vVertType == `).concat(p2,`) {
          // look up the texel from the texture unit
          `).concat(a.map(function(u){return"if(vAtlasId == ".concat(u,") outColor = texture(uTexture").concat(u,", vTexCoord);")}).join(`
	else `),`
        } 
        else if(vVertType == `).concat(m2,`) {
          // mimics how canvas renderer uses context.globalCompositeOperation = 'destination-out';
          outColor = blend(vColor, uBGColor);
          outColor.a = 1.0; // make opaque, masks out line under arrow
        }
        else if(vVertType == `).concat(yp,` && vBorderWidth == vec2(0.0)) { // simple rectangle with no border
          outColor = vColor; // unit square is already transformed to the rectangle, nothing else needs to be done
        }
        else if(vVertType == `).concat(yp," || vVertType == ").concat($m,` 
          || vVertType == `).concat(oy," || vVertType == ").concat(qm,`) { // use SDF

          float outerBorder = vBorderWidth[0];
          float innerBorder = vBorderWidth[1];
          float borderPadding = outerBorder * 2.0;
          float w = vTopRight.x - vBotLeft.x - borderPadding;
          float h = vTopRight.y - vBotLeft.y - borderPadding;
          vec2 b = vec2(w/2.0, h/2.0); // half width, half height
          vec2 p = vPosition - vec2(vTopRight.x - b[0] - outerBorder, vTopRight.y - b[1] - outerBorder); // translate to center

          float d; // signed distance
          if(vVertType == `).concat(yp,`) {
            d = rectangleSD(p, b);
          } else if(vVertType == `).concat($m,` && w == h) {
            d = circleSD(p, b.x); // faster than ellipse
          } else if(vVertType == `).concat($m,`) {
            d = ellipseSD(p, b);
          } else {
            d = roundRectangleSD(p, b, vCornerRadius.wzyx);
          }

          // use the distance to interpolate a color to smooth the edges of the shape, doesn't need multisampling
          // we must smooth colors inwards, because we can't change pixels outside the shape's bounding box
          if(d > 0.0) {
            if(d > outerBorder) {
              discard;
            } else {
              outColor = distInterp(vBorderColor, vec4(0), d - outerBorder);
            }
          } else {
            if(d > innerBorder) {
              vec4 outerColor = outerBorder == 0.0 ? vec4(0) : vBorderColor;
              vec4 innerBorderColor = blend(vBorderColor, vColor);
              outColor = distInterp(innerBorderColor, outerColor, d);
            } 
            else {
              vec4 outerColor;
              if(innerBorder == 0.0 && outerBorder == 0.0) {
                outerColor = vec4(0);
              } else if(innerBorder == 0.0) {
                outerColor = vBorderColor;
              } else {
                outerColor = blend(vBorderColor, vColor);
              }
              outColor = distInterp(vColor, outerColor, d - innerBorder);
            }
          }
        }
        else {
          outColor = vColor;
        }

        `).concat(r.picking?`if(outColor.a == 0.0) discard;
             else outColor = vIndex;`:"",`
      }
    `),o=dU(n,i,s);o.aPosition=n.getAttribLocation(o,"aPosition"),o.aIndex=n.getAttribLocation(o,"aIndex"),o.aVertType=n.getAttribLocation(o,"aVertType"),o.aTransform=n.getAttribLocation(o,"aTransform"),o.aAtlasId=n.getAttribLocation(o,"aAtlasId"),o.aTex=n.getAttribLocation(o,"aTex"),o.aPointAPointB=n.getAttribLocation(o,"aPointAPointB"),o.aPointCPointD=n.getAttribLocation(o,"aPointCPointD"),o.aLineWidth=n.getAttribLocation(o,"aLineWidth"),o.aColor=n.getAttribLocation(o,"aColor"),o.aCornerRadius=n.getAttribLocation(o,"aCornerRadius"),o.aBorderColor=n.getAttribLocation(o,"aBorderColor"),o.uPanZoomMatrix=n.getUniformLocation(o,"uPanZoomMatrix"),o.uAtlasSize=n.getUniformLocation(o,"uAtlasSize"),o.uBGColor=n.getUniformLocation(o,"uBGColor"),o.uZoom=n.getUniformLocation(o,"uZoom"),o.uTextures=[];for(var l=0;l<this.batchManager.getMaxAtlasesPerBatch();l++)o.uTextures.push(n.getUniformLocation(o,"uTexture".concat(l)));return o}},{key:"_createVAO",value:function(){var r=[0,0,1,0,1,1,0,0,1,1,0,1];this.vertexCount=r.length/2;var n=this.maxInstances,i=this.gl,a=this.program,s=i.createVertexArray();return i.bindVertexArray(s),bU(i,"vec2",a.aPosition,r),this.transformBuffer=wU(i,n,a.aTransform),this.indexBuffer=vu(i,n,"vec4",a.aIndex),this.vertTypeBuffer=vu(i,n,"int",a.aVertType),this.atlasIdBuffer=vu(i,n,"int",a.aAtlasId),this.texBuffer=vu(i,n,"vec4",a.aTex),this.pointAPointBBuffer=vu(i,n,"vec4",a.aPointAPointB),this.pointCPointDBuffer=vu(i,n,"vec4",a.aPointCPointD),this.lineWidthBuffer=vu(i,n,"vec2",a.aLineWidth),this.colorBuffer=vu(i,n,"vec4",a.aColor),this.cornerRadiusBuffer=vu(i,n,"vec4",a.aCornerRadius),this.borderColorBuffer=vu(i,n,"vec4",a.aBorderColor),i.bindVertexArray(null),s}},{key:"buffers",get:function(){var r=this;return this._buffers||(this._buffers=Object.keys(this).filter(function(n){return Rd(n,"Buffer")}).map(function(n){return r[n]})),this._buffers}},{key:"startFrame",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:tv.SCREEN;this.panZoomMatrix=r,this.renderTarget=n,this.batchDebugInfo=[],this.wrappedCount=0,this.simpleCount=0,this.startBatch()}},{key:"startBatch",value:function(){this.instanceCount=0,this.batchManager.startBatch()}},{key:"endFrame",value:function(){this.endBatch()}},{key:"_isVisible",value:function(r,n){return r.visible()?n&&n.isVisible?n.isVisible(r):!0:!1}},{key:"drawTexture",value:function(r,n,i){var a=this.atlasManager,s=this.batchManager,o=a.getRenderTypeOpts(i);if(this._isVisible(r,o)&&!(r.isEdge()&&!this._isValidEdge(r))){if(this.renderTarget.picking&&o.getTexPickingMode){var l=o.getTexPickingMode(r);if(l===mx.IGNORE)return;if(l==mx.USE_BB){this.drawPickingRectangle(r,n,i);return}}var u=a.getAtlasInfo(r,i),c=Ys(u),h;try{for(c.s();!(h=c.n()).done;){var p=h.value,g=p.atlas,y=p.tex1,S=p.tex2;s.canAddToCurrentBatch(g)||this.endBatch();for(var w=s.getAtlasIndexForBatch(g),C=0,_=[[y,!0],[S,!1]];C<_.length;C++){var T=Di(_[C],2),N=T[0],R=T[1];if(N.w!=0){var I=this.instanceCount;this.vertTypeBuffer.getView(I)[0]=p2;var j=this.indexBuffer.getView(I);vp(n,j);var O=this.atlasIdBuffer.getView(I);O[0]=w;var F=this.texBuffer.getView(I);F[0]=N.x,F[1]=N.y,F[2]=N.w,F[3]=N.h;var z=this.transformBuffer.getMatrixView(I);this.setTransformMatrix(r,z,o,p,R),this.instanceCount++,R||this.wrappedCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}catch(V){c.e(V)}finally{c.f()}}}},{key:"setTransformMatrix",value:function(r,n,i,a){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=0;if(i.shapeProps&&i.shapeProps.padding&&(o=r.pstyle(i.shapeProps.padding).pfValue),a){var l=a.bb,u=a.tex1,c=a.tex2,h=u.w/(u.w+c.w);s||(h=1-h);var p=this._getAdjustedBB(l,o,s,h);this._applyTransformMatrix(n,p,i,r)}else{var g=i.getBoundingBox(r),y=this._getAdjustedBB(g,o,!0,1);this._applyTransformMatrix(n,y,i,r)}}},{key:"_applyTransformMatrix",value:function(r,n,i,a){var s,o;ZN(r);var l=i.getRotation?i.getRotation(a):0;if(l!==0){var u=i.getRotationPoint(a),c=u.x,h=u.y;Hy(r,r,[c,h]),YN(r,r,l);var p=i.getRotationOffset(a);s=p.x+(n.xOffset||0),o=p.y+(n.yOffset||0)}else s=n.x1,o=n.y1;Hy(r,r,[s,o]),ZS(r,r,[n.w,n.h])}},{key:"_getAdjustedBB",value:function(r,n,i,a){var s=r.x1,o=r.y1,l=r.w,u=r.h,c=r.yOffset;n&&(s-=n,o-=n,l+=2*n,u+=2*n);var h=0,p=l*a;return i&&a<1?l=p:!i&&a<1&&(h=l-p,s+=h,l=p),{x1:s,y1:o,w:l,h:u,xOffset:h,yOffset:c}}},{key:"drawPickingRectangle",value:function(r,n,i){var a=this.atlasManager.getRenderTypeOpts(i),s=this.instanceCount;this.vertTypeBuffer.getView(s)[0]=yp;var o=this.indexBuffer.getView(s);vp(n,o);var l=this.colorBuffer.getView(s);Vh([0,0,0],1,l);var u=this.transformBuffer.getMatrixView(s);this.setTransformMatrix(r,u,a),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}},{key:"drawNode",value:function(r,n,i){var a=this.simpleShapeOptions.get(i);if(this._isVisible(r,a)){var s=a.shapeProps,o=this._getVertTypeForShape(r,s.shape);if(o===void 0||a.isSimple&&!a.isSimple(r)){this.drawTexture(r,n,i);return}var l=this.instanceCount;if(this.vertTypeBuffer.getView(l)[0]=o,o===oy||o===qm){var u=a.getBoundingBox(r),c=this._getCornerRadius(r,s.radius,u),h=this.cornerRadiusBuffer.getView(l);h[0]=c,h[1]=c,h[2]=c,h[3]=c,o===qm&&(h[0]=0,h[2]=0)}var p=this.indexBuffer.getView(l);vp(n,p);var g=r.pstyle(s.color).value,y=r.pstyle(s.opacity).value,S=this.colorBuffer.getView(l);Vh(g,y,S);var w=this.lineWidthBuffer.getView(l);if(w[0]=0,w[1]=0,s.border){var C=r.pstyle("border-width").value;if(C>0){var _=r.pstyle("border-color").value,T=r.pstyle("border-opacity").value,N=this.borderColorBuffer.getView(l);Vh(_,T,N);var R=r.pstyle("border-position").value;if(R==="inside")w[0]=0,w[1]=-C;else if(R==="outside")w[0]=C,w[1]=0;else{var I=C/2;w[0]=I,w[1]=-I}}}var j=this.transformBuffer.getMatrixView(l);this.setTransformMatrix(r,j,a),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}},{key:"_getVertTypeForShape",value:function(r,n){var i=r.pstyle(n).value;switch(i){case"rectangle":return yp;case"ellipse":return $m;case"roundrectangle":case"round-rectangle":return oy;case"bottom-round-rectangle":return qm;default:return}}},{key:"_getCornerRadius",value:function(r,n,i){var a=i.w,s=i.h;if(r.pstyle(n).value==="auto")return Xd(a,s);var o=r.pstyle(n).pfValue,l=a/2,u=s/2;return Math.min(o,u,l)}},{key:"drawEdgeArrow",value:function(r,n,i){if(r.visible()){var a=r._private.rscratch,s,o,l;if(i==="source"?(s=a.arrowStartX,o=a.arrowStartY,l=a.srcArrowAngle):(s=a.arrowEndX,o=a.arrowEndY,l=a.tgtArrowAngle),!(isNaN(s)||s==null||isNaN(o)||o==null||isNaN(l)||l==null)){var u=r.pstyle(i+"-arrow-shape").value;if(u!=="none"){var c=r.pstyle(i+"-arrow-color").value,h=r.pstyle("opacity").value,p=r.pstyle("line-opacity").value,g=h*p,y=r.pstyle("width").pfValue,S=r.pstyle("arrow-scale").value,w=this.r.getArrowWidth(y,S),C=this.instanceCount,_=this.transformBuffer.getMatrixView(C);ZN(_),Hy(_,_,[s,o]),ZS(_,_,[w,w]),YN(_,_,l),this.vertTypeBuffer.getView(C)[0]=m2;var T=this.indexBuffer.getView(C);vp(n,T);var N=this.colorBuffer.getView(C);Vh(c,g,N),this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"drawEdgeLine",value:function(r,n){if(r.visible()){var i=this._getEdgePoints(r);if(i){var a=r.pstyle("opacity").value,s=r.pstyle("line-opacity").value,o=r.pstyle("width").pfValue,l=r.pstyle("line-color").value,u=a*s;if(i.length/2+this.instanceCount>this.maxInstances&&this.endBatch(),i.length==4){var c=this.instanceCount;this.vertTypeBuffer.getView(c)[0]=XN;var h=this.indexBuffer.getView(c);vp(n,h);var p=this.colorBuffer.getView(c);Vh(l,u,p);var g=this.lineWidthBuffer.getView(c);g[0]=o;var y=this.pointAPointBBuffer.getView(c);y[0]=i[0],y[1]=i[1],y[2]=i[2],y[3]=i[3],this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}else for(var S=0;S<i.length-2;S+=2){var w=this.instanceCount;this.vertTypeBuffer.getView(w)[0]=QN;var C=this.indexBuffer.getView(w);vp(n,C);var _=this.colorBuffer.getView(w);Vh(l,u,_);var T=this.lineWidthBuffer.getView(w);T[0]=o;var N=i[S-2],R=i[S-1],I=i[S],j=i[S+1],O=i[S+2],F=i[S+3],z=i[S+4],V=i[S+5];S==0&&(N=2*I-O+.001,R=2*j-F+.001),S==i.length-4&&(z=2*O-I+.001,V=2*F-j+.001);var q=this.pointAPointBBuffer.getView(w);q[0]=N,q[1]=R,q[2]=I,q[3]=j;var D=this.pointCPointDBuffer.getView(w);D[0]=O,D[1]=F,D[2]=z,D[3]=V,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"_isValidEdge",value:function(r){var n=r._private.rscratch;return!(n.badLine||n.allpts==null||isNaN(n.allpts[0]))}},{key:"_getEdgePoints",value:function(r){var n=r._private.rscratch;if(this._isValidEdge(r)){var i=n.allpts;if(i.length==4)return i;var a=this._getNumSegments(r);return this._getCurveSegmentPoints(i,a)}}},{key:"_getNumSegments",value:function(r){var n=15;return Math.min(Math.max(n,5),this.maxInstances)}},{key:"_getCurveSegmentPoints",value:function(r,n){if(r.length==4)return r;for(var i=Array((n+1)*2),a=0;a<=n;a++)if(a==0)i[0]=r[0],i[1]=r[1];else if(a==n)i[a*2]=r[r.length-2],i[a*2+1]=r[r.length-1];else{var s=a/n;this._setCurvePoint(r,s,i,a*2)}return i}},{key:"_setCurvePoint",value:function(r,n,i,a){if(r.length<=2)i[a]=r[0],i[a+1]=r[1];else{for(var s=Array(r.length-2),o=0;o<s.length;o+=2){var l=(1-n)*r[o]+n*r[o+2],u=(1-n)*r[o+1]+n*r[o+3];s[o]=l,s[o+1]=u}return this._setCurvePoint(s,n,i,a)}}},{key:"endBatch",value:function(){var r=this.gl,n=this.vao,i=this.vertexCount,a=this.instanceCount;if(a!==0){var s=this.renderTarget.picking?this.pickingProgram:this.program;r.useProgram(s),r.bindVertexArray(n);var o=Ys(this.buffers),l;try{for(o.s();!(l=o.n()).done;){var u=l.value;u.bufferSubData(a)}}catch(y){o.e(y)}finally{o.f()}for(var c=this.batchManager.getAtlases(),h=0;h<c.length;h++)c[h].bufferIfNeeded(r);for(var p=0;p<c.length;p++)r.activeTexture(r.TEXTURE0+p),r.bindTexture(r.TEXTURE_2D,c[p].texture),r.uniform1i(s.uTextures[p],p);r.uniform1f(s.uZoom,fU(this.r)),r.uniformMatrix3fv(s.uPanZoomMatrix,!1,this.panZoomMatrix),r.uniform1i(s.uAtlasSize,this.batchManager.getAtlasSize());var g=Vh(this.bgColor,1);r.uniform4fv(s.uBGColor,g),r.drawArraysInstanced(r.TRIANGLES,0,i,a),r.bindVertexArray(null),r.bindTexture(r.TEXTURE_2D,null),this.debug&&this.batchDebugInfo.push({count:a,atlasCount:c.length}),this.startBatch()}}},{key:"getDebugInfo",value:function(){var r=this.atlasManager.getDebugInfo(),n=r.reduce(function(s,o){return s+o.atlasCount},0),i=this.batchDebugInfo,a=i.reduce(function(s,o){return s+o.count},0);return{atlasInfo:r,totalAtlases:n,wrappedCount:this.wrappedCount,simpleCount:this.simpleCount,batchCount:i.length,batchInfo:i,totalInstances:a}}}])})(),sL={};sL.initWebgl=function(t,e){var r=this,n=r.data.contexts[r.WEBGL];t.bgColor=DU(r),t.webglTexSize=Math.min(t.webglTexSize,n.getParameter(n.MAX_TEXTURE_SIZE)),t.webglTexRows=Math.min(t.webglTexRows,54),t.webglTexRowsNodes=Math.min(t.webglTexRowsNodes,54),t.webglBatchSize=Math.min(t.webglBatchSize,16384),t.webglTexPerBatch=Math.min(t.webglTexPerBatch,n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)),r.webglDebug=t.webglDebug,r.webglDebugShowAtlases=t.webglDebugShowAtlases,r.pickingFrameBuffer=SU(n),r.pickingFrameBuffer.needsDraw=!0,r.drawing=new OU(r,n,t);var i=function(h){return function(p){return r.getTextAngle(p,h)}},a=function(h){return function(p){var g=p.pstyle(h);return g&&g.value}},s=function(h){return function(p){return p.pstyle("".concat(h,"-opacity")).value>0}},o=function(h){var p=h.pstyle("text-events").strValue==="yes";return p?mx.USE_BB:mx.IGNORE},l=function(h){var p=h.position(),g=p.x,y=p.y,S=h.outerWidth(),w=h.outerHeight();return{w:S,h:w,x1:g-S/2,y1:y-w/2}};r.drawing.addAtlasCollection("node",{texRows:t.webglTexRowsNodes}),r.drawing.addAtlasCollection("label",{texRows:t.webglTexRows}),r.drawing.addTextureAtlasRenderType("node-body",{collection:"node",getKey:e.getStyleKey,getBoundingBox:e.getElementBox,drawElement:e.drawElement}),r.drawing.addSimpleShapeRenderType("node-body",{getBoundingBox:l,isSimple:mU,shapeProps:{shape:"shape",color:"background-color",opacity:"background-opacity",radius:"corner-radius",border:!0}}),r.drawing.addSimpleShapeRenderType("node-overlay",{getBoundingBox:l,isVisible:s("overlay"),shapeProps:{shape:"overlay-shape",color:"overlay-color",opacity:"overlay-opacity",padding:"overlay-padding",radius:"overlay-corner-radius"}}),r.drawing.addSimpleShapeRenderType("node-underlay",{getBoundingBox:l,isVisible:s("underlay"),shapeProps:{shape:"underlay-shape",color:"underlay-color",opacity:"underlay-opacity",padding:"underlay-padding",radius:"underlay-corner-radius"}}),r.drawing.addTextureAtlasRenderType("label",{collection:"label",getTexPickingMode:o,getKey:g2(e.getLabelKey,null),getBoundingBox:v2(e.getLabelBox,null),drawClipped:!0,drawElement:e.drawLabel,getRotation:i(null),getRotationPoint:e.getLabelRotationPoint,getRotationOffset:e.getLabelRotationOffset,isVisible:a("label")}),r.drawing.addTextureAtlasRenderType("edge-source-label",{collection:"label",getTexPickingMode:o,getKey:g2(e.getSourceLabelKey,"source"),getBoundingBox:v2(e.getSourceLabelBox,"source"),drawClipped:!0,drawElement:e.drawSourceLabel,getRotation:i("source"),getRotationPoint:e.getSourceLabelRotationPoint,getRotationOffset:e.getSourceLabelRotationOffset,isVisible:a("source-label")}),r.drawing.addTextureAtlasRenderType("edge-target-label",{collection:"label",getTexPickingMode:o,getKey:g2(e.getTargetLabelKey,"target"),getBoundingBox:v2(e.getTargetLabelBox,"target"),drawClipped:!0,drawElement:e.drawTargetLabel,getRotation:i("target"),getRotationPoint:e.getTargetLabelRotationPoint,getRotationOffset:e.getTargetLabelRotationOffset,isVisible:a("target-label")});var u=Qv(function(){console.log("garbage collect flag set"),r.data.gc=!0},1e4);r.onUpdateEleCalcs(function(c,h){var p=!1;h&&h.length>0&&(p|=r.drawing.invalidate(h)),p&&u()}),IU(r)};function DU(t){var e=t.cy.container(),r=e&&e.style&&e.style.backgroundColor||"white";return OM(r)}function oL(t,e){var r=t._private.rscratch;return $s(r,"labelWrapCachedLines",e)||[]}var g2=function(e,r){return function(n){var i=e(n),a=oL(n,r);return a.length>1?a.map(function(s,o){return"".concat(i,"_").concat(o)}):i}},v2=function(e,r){return function(n,i){var a=e(n);if(typeof i=="string"){var s=i.indexOf("_");if(s>0){var o=Number(i.substring(s+1)),l=oL(n,r),u=a.h/l.length,c=u*o,h=a.y1+c;return{x1:a.x1,w:a.w,y1:h,h:u,yOffset:c}}}return a}};function IU(t){{var e=t.render;t.render=function(a){a=a||{};var s=t.cy;t.webgl&&(s.zoom()>JA?(jU(t),e.call(t,a)):(FU(t),uL(t,a,tv.SCREEN)))}}{var r=t.matchCanvasSize;t.matchCanvasSize=function(a){r.call(t,a),t.pickingFrameBuffer.setFramebufferAttachmentSizes(t.canvasWidth,t.canvasHeight),t.pickingFrameBuffer.needsDraw=!0}}t.findNearestElements=function(a,s,o,l){return HU(t,a,s)};{var n=t.invalidateCachedZSortedEles;t.invalidateCachedZSortedEles=function(){n.call(t),t.pickingFrameBuffer.needsDraw=!0}}{var i=t.notify;t.notify=function(a,s){i.call(t,a,s),a==="viewport"||a==="bounds"?t.pickingFrameBuffer.needsDraw=!0:a==="background"&&t.drawing.invalidate(s,{type:"node-body"})}}}function jU(t){var e=t.data.contexts[t.WEBGL];e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}function FU(t){var e=function(n){n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,t.canvasWidth,t.canvasHeight),n.restore()};e(t.data.contexts[t.NODE]),e(t.data.contexts[t.DRAG])}function BU(t){var e=t.canvasWidth,r=t.canvasHeight,n=b_(t),i=n.pan,a=n.zoom,s=f2();Hy(s,s,[i.x,i.y]),ZS(s,s,[a,a]);var o=f2();_U(o,e,r);var l=f2();return kU(l,o,s),l}function lL(t,e){var r=t.canvasWidth,n=t.canvasHeight,i=b_(t),a=i.pan,s=i.zoom;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,r,n),e.translate(a.x,a.y),e.scale(s,s)}function zU(t,e){t.drawSelectionRectangle(e,function(r){return lL(t,r)})}function UU(t){var e=t.data.contexts[t.NODE];e.save(),lL(t,e),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.moveTo(-1e3,0),e.lineTo(1e3,0),e.stroke(),e.beginPath(),e.moveTo(0,-1e3),e.lineTo(0,1e3),e.stroke(),e.restore()}function GU(t){var e=function(i,a,s){for(var o=i.atlasManager.getAtlasCollection(a),l=t.data.contexts[t.NODE],u=o.atlases,c=0;c<u.length;c++){var h=u[c],p=h.canvas;if(p){var g=p.width,y=p.height,S=g*c,w=p.height*s,C=.4;l.save(),l.scale(C,C),l.drawImage(p,S,w),l.strokeStyle="black",l.rect(S,w,g,y),l.stroke(),l.restore()}}},r=0;e(t.drawing,"node",r++),e(t.drawing,"label",r++)}function VU(t,e,r,n,i){var a,s,o,l,u=b_(t),c=u.pan,h=u.zoom;{var p=pU(t,c,h,e,r),g=Di(p,2),y=g[0],S=g[1],w=6;a=y-w/2,s=S-w/2,o=w,l=w}if(o===0||l===0)return[];var C=t.data.contexts[t.WEBGL];C.bindFramebuffer(C.FRAMEBUFFER,t.pickingFrameBuffer),t.pickingFrameBuffer.needsDraw&&(C.viewport(0,0,C.canvas.width,C.canvas.height),uL(t,null,tv.PICKING),t.pickingFrameBuffer.needsDraw=!1);var _=o*l,T=new Uint8Array(_*4);C.readPixels(a,s,o,l,C.RGBA,C.UNSIGNED_BYTE,T),C.bindFramebuffer(C.FRAMEBUFFER,null);for(var N=new Set,R=0;R<_;R++){var I=T.slice(R*4,R*4+4),j=vU(I)-1;j>=0&&N.add(j)}return N}function HU(t,e,r){var n=VU(t,e,r),i=t.getCachedZSortedEles(),a,s,o=Ys(n),l;try{for(o.s();!(l=o.n()).done;){var u=l.value,c=i[u];if(!a&&c.isNode()&&(a=c),!s&&c.isEdge()&&(s=c),a&&s)break}}catch(h){o.e(h)}finally{o.f()}return[a,s].filter(Boolean)}function y2(t,e,r){var n=t.drawing;e+=1,r.isNode()?(n.drawNode(r,e,"node-underlay"),n.drawNode(r,e,"node-body"),n.drawTexture(r,e,"label"),n.drawNode(r,e,"node-overlay")):(n.drawEdgeLine(r,e),n.drawEdgeArrow(r,e,"source"),n.drawEdgeArrow(r,e,"target"),n.drawTexture(r,e,"label"),n.drawTexture(r,e,"edge-source-label"),n.drawTexture(r,e,"edge-target-label"))}function uL(t,e,r){var n;t.webglDebug&&(n=performance.now());var i=t.drawing,a=0;if(r.screen&&t.data.canvasNeedsRedraw[t.SELECT_BOX]&&zU(t,e),t.data.canvasNeedsRedraw[t.NODE]||r.picking){var s=t.data.contexts[t.WEBGL];r.screen?(s.clearColor(0,0,0,0),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA)):s.disable(s.BLEND),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.viewport(0,0,s.canvas.width,s.canvas.height);var o=BU(t),l=t.getCachedZSortedEles();if(a=l.length,i.startFrame(o,r),r.screen){for(var u=0;u<l.nondrag.length;u++)y2(t,u,l.nondrag[u]);for(var c=0;c<l.drag.length;c++)y2(t,c,l.drag[c])}else if(r.picking)for(var h=0;h<l.length;h++)y2(t,h,l[h]);i.endFrame(),r.screen&&t.webglDebugShowAtlases&&(UU(t),GU(t)),t.data.canvasNeedsRedraw[t.NODE]=!1,t.data.canvasNeedsRedraw[t.DRAG]=!1}if(t.webglDebug){var p=performance.now(),g=!1,y=Math.ceil(p-n),S=i.getDebugInfo(),w=["".concat(a," elements"),"".concat(S.totalInstances," instances"),"".concat(S.batchCount," batches"),"".concat(S.totalAtlases," atlases"),"".concat(S.wrappedCount," wrapped textures"),"".concat(S.simpleCount," simple shapes")].join(", ");if(g)console.log("WebGL (".concat(r.name,") - time ").concat(y,"ms, ").concat(w));else{console.log("WebGL (".concat(r.name,") - frame time ").concat(y,"ms")),console.log("Totals:"),console.log("  ".concat(w)),console.log("Texture Atlases Used:");var C=S.atlasInfo,_=Ys(C),T;try{for(_.s();!(T=_.n()).done;){var N=T.value;console.log("  ".concat(N.type,": ").concat(N.keyCount," keys, ").concat(N.atlasCount," atlases"))}}catch(R){_.e(R)}finally{_.f()}console.log("")}}t.data.gc&&(console.log("Garbage Collect!"),t.data.gc=!1,i.gc())}var uh={};uh.drawPolygonPath=function(t,e,r,n,i,a){var s=n/2,o=i/2;t.beginPath&&t.beginPath(),t.moveTo(e+s*a[0],r+o*a[1]);for(var l=1;l<a.length/2;l++)t.lineTo(e+s*a[l*2],r+o*a[l*2+1]);t.closePath()};uh.drawRoundPolygonPath=function(t,e,r,n,i,a,s){s.forEach(function(o){return HA(t,o)}),t.closePath()};uh.drawRoundRectanglePath=function(t,e,r,n,i,a){var s=n/2,o=i/2,l=a==="auto"?Xd(n,i):Math.min(a,o,s);t.beginPath&&t.beginPath(),t.moveTo(e,r-o),t.arcTo(e+s,r-o,e+s,r,l),t.arcTo(e+s,r+o,e,r+o,l),t.arcTo(e-s,r+o,e-s,r,l),t.arcTo(e-s,r-o,e,r-o,l),t.lineTo(e,r-o),t.closePath()};uh.drawBottomRoundRectanglePath=function(t,e,r,n,i,a){var s=n/2,o=i/2,l=a==="auto"?Xd(n,i):a;t.beginPath&&t.beginPath(),t.moveTo(e,r-o),t.lineTo(e+s,r-o),t.lineTo(e+s,r),t.arcTo(e+s,r+o,e,r+o,l),t.arcTo(e-s,r+o,e-s,r,l),t.lineTo(e-s,r-o),t.lineTo(e,r-o),t.closePath()};uh.drawCutRectanglePath=function(t,e,r,n,i,a,s){var o=n/2,l=i/2,u=s==="auto"?s_():s;t.beginPath&&t.beginPath(),t.moveTo(e-o+u,r-l),t.lineTo(e+o-u,r-l),t.lineTo(e+o,r-l+u),t.lineTo(e+o,r+l-u),t.lineTo(e+o-u,r+l),t.lineTo(e-o+u,r+l),t.lineTo(e-o,r+l-u),t.lineTo(e-o,r-l+u),t.closePath()};uh.drawBarrelPath=function(t,e,r,n,i){var a=n/2,s=i/2,o=e-a,l=e+a,u=r-s,c=r+s,h=DS(n,i),p=h.widthOffset,g=h.heightOffset,y=h.ctrlPtOffsetPct*p;t.beginPath&&t.beginPath(),t.moveTo(o,u+g),t.lineTo(o,c-g),t.quadraticCurveTo(o+y,c,o+p,c),t.lineTo(l-p,c),t.quadraticCurveTo(l-y,c,l,c-g),t.lineTo(l,u+g),t.quadraticCurveTo(l-y,u,l-p,u),t.lineTo(o+p,u),t.quadraticCurveTo(o+y,u,o,u+g),t.closePath()};var JN=Math.sin(0),e5=Math.cos(0),YS={},XS={},cL=Math.PI/40;for(var xp=0*Math.PI;xp<2*Math.PI;xp+=cL)YS[xp]=Math.sin(xp),XS[xp]=Math.cos(xp);uh.drawEllipsePath=function(t,e,r,n,i){if(t.beginPath&&t.beginPath(),t.ellipse)t.ellipse(e,r,n/2,i/2,0,0,2*Math.PI);else for(var a,s,o=n/2,l=i/2,u=0*Math.PI;u<2*Math.PI;u+=cL)a=e-o*YS[u]*JN+o*XS[u]*e5,s=r+l*XS[u]*JN+l*YS[u]*e5,u===0?t.moveTo(a,s):t.lineTo(a,s);t.closePath()};var i0={};i0.createBuffer=function(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,[r,r.getContext("2d")]};i0.bufferCanvasImage=function(t){var e=this.cy,r=e.mutableElements(),n=r.boundingBox(),i=this.findContainerClientCoords(),a=t.full?Math.ceil(n.w):i[2],s=t.full?Math.ceil(n.h):i[3],o=kt(t.maxWidth)||kt(t.maxHeight),l=this.getPixelRatio(),u=1;if(t.scale!==void 0)a*=t.scale,s*=t.scale,u=t.scale;else if(o){var c=1/0,h=1/0;kt(t.maxWidth)&&(c=u*t.maxWidth/a),kt(t.maxHeight)&&(h=u*t.maxHeight/s),u=Math.min(c,h),a*=u,s*=u}o||(a*=l,s*=l,u*=l);var p=document.createElement("canvas");p.width=a,p.height=s,p.style.width=a+"px",p.style.height=s+"px";var g=p.getContext("2d");if(a>0&&s>0){g.clearRect(0,0,a,s),g.globalCompositeOperation="source-over";var y=this.getCachedZSortedEles();if(t.full)g.translate(-n.x1*u,-n.y1*u),g.scale(u,u),this.drawElements(g,y),g.scale(1/u,1/u),g.translate(n.x1*u,n.y1*u);else{var S=e.pan(),w={x:S.x*u,y:S.y*u};u*=e.zoom(),g.translate(w.x,w.y),g.scale(u,u),this.drawElements(g,y),g.scale(1/u,1/u),g.translate(-w.x,-w.y)}t.bg&&(g.globalCompositeOperation="destination-over",g.fillStyle=t.bg,g.rect(0,0,a,s),g.fill())}return p};function WU(t,e){for(var r=atob(t),n=new ArrayBuffer(r.length),i=new Uint8Array(n),a=0;a<r.length;a++)i[a]=r.charCodeAt(a);return new Blob([n],{type:e})}function t5(t){var e=t.indexOf(",");return t.substr(e+1)}function dL(t,e,r){var n=function(){return e.toDataURL(r,t.quality)};switch(t.output){case"blob-promise":return new cm(function(i,a){try{e.toBlob(function(s){s!=null?i(s):a(new Error("`canvas.toBlob()` sent a null value in its callback"))},r,t.quality)}catch(s){a(s)}});case"blob":return WU(t5(n()),r);case"base64":return t5(n());default:return n()}}i0.png=function(t){return dL(t,this.bufferCanvasImage(t),"image/png")};i0.jpg=function(t){return dL(t,this.bufferCanvasImage(t),"image/jpeg")};var hL={};hL.nodeShapeImpl=function(t,e,r,n,i,a,s,o){switch(t){case"ellipse":return this.drawEllipsePath(e,r,n,i,a);case"polygon":return this.drawPolygonPath(e,r,n,i,a,s);case"round-polygon":return this.drawRoundPolygonPath(e,r,n,i,a,s,o);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(e,r,n,i,a,o);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(e,r,n,i,a,s,o);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(e,r,n,i,a,o);case"barrel":return this.drawBarrelPath(e,r,n,i,a)}};var qU=fL,Er=fL.prototype;Er.CANVAS_LAYERS=3;Er.SELECT_BOX=0;Er.DRAG=1;Er.NODE=2;Er.WEBGL=3;Er.CANVAS_TYPES=["2d","2d","2d","webgl2"];Er.BUFFER_COUNT=3;Er.TEXTURE_BUFFER=0;Er.MOTIONBLUR_BUFFER_NODE=1;Er.MOTIONBLUR_BUFFER_DRAG=2;function fL(t){var e=this,r=e.cy.window(),n=r.document;t.webgl&&(Er.CANVAS_LAYERS=e.CANVAS_LAYERS=4,console.log("webgl rendering enabled")),e.data={canvases:new Array(Er.CANVAS_LAYERS),contexts:new Array(Er.CANVAS_LAYERS),canvasNeedsRedraw:new Array(Er.CANVAS_LAYERS),bufferCanvases:new Array(Er.BUFFER_COUNT),bufferContexts:new Array(Er.CANVAS_LAYERS)};var i="-webkit-tap-highlight-color",a="rgba(0,0,0,0)";e.data.canvasContainer=n.createElement("div");var s=e.data.canvasContainer.style;e.data.canvasContainer.style[i]=a,s.position="relative",s.zIndex="0",s.overflow="hidden";var o=t.cy.container();o.appendChild(e.data.canvasContainer),o.style[i]=a;var l={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};zj()&&(l["-ms-touch-action"]="none",l["touch-action"]="none");for(var u=0;u<Er.CANVAS_LAYERS;u++){var c=e.data.canvases[u]=n.createElement("canvas"),h=Er.CANVAS_TYPES[u];e.data.contexts[u]=c.getContext(h),e.data.contexts[u]||Kn("Could not create canvas of type "+h),Object.keys(l).forEach(function(ye){c.style[ye]=l[ye]}),c.style.position="absolute",c.setAttribute("data-id","layer"+u),c.style.zIndex=String(Er.CANVAS_LAYERS-u),e.data.canvasContainer.appendChild(c),e.data.canvasNeedsRedraw[u]=!1}e.data.topCanvas=e.data.canvases[0],e.data.canvases[Er.NODE].setAttribute("data-id","layer"+Er.NODE+"-node"),e.data.canvases[Er.SELECT_BOX].setAttribute("data-id","layer"+Er.SELECT_BOX+"-selectbox"),e.data.canvases[Er.DRAG].setAttribute("data-id","layer"+Er.DRAG+"-drag"),e.data.canvases[Er.WEBGL]&&e.data.canvases[Er.WEBGL].setAttribute("data-id","layer"+Er.WEBGL+"-webgl");for(var u=0;u<Er.BUFFER_COUNT;u++)e.data.bufferCanvases[u]=n.createElement("canvas"),e.data.bufferContexts[u]=e.data.bufferCanvases[u].getContext("2d"),e.data.bufferCanvases[u].style.position="absolute",e.data.bufferCanvases[u].setAttribute("data-id","buffer"+u),e.data.bufferCanvases[u].style.zIndex=String(-u-1),e.data.bufferCanvases[u].style.visibility="hidden";e.pathsEnabled=!0;var p=Es(),g=function(ve){return{x:(ve.x1+ve.x2)/2,y:(ve.y1+ve.y2)/2}},y=function(ve){return{x:-ve.w/2,y:-ve.h/2}},S=function(ve){var ue=ve[0]._private,xe=ue.oldBackgroundTimestamp===ue.backgroundTimestamp;return!xe},w=function(ve){return ve[0]._private.nodeKey},C=function(ve){return ve[0]._private.labelStyleKey},_=function(ve){return ve[0]._private.sourceLabelStyleKey},T=function(ve){return ve[0]._private.targetLabelStyleKey},N=function(ve,ue,xe,Se,Oe){return e.drawElement(ve,ue,xe,!1,!1,Oe)},R=function(ve,ue,xe,Se,Oe){return e.drawElementText(ve,ue,xe,Se,"main",Oe)},I=function(ve,ue,xe,Se,Oe){return e.drawElementText(ve,ue,xe,Se,"source",Oe)},j=function(ve,ue,xe,Se,Oe){return e.drawElementText(ve,ue,xe,Se,"target",Oe)},O=function(ve){return ve.boundingBox(),ve[0]._private.bodyBounds},F=function(ve){return ve.boundingBox(),ve[0]._private.labelBounds.main||p},z=function(ve){return ve.boundingBox(),ve[0]._private.labelBounds.source||p},V=function(ve){return ve.boundingBox(),ve[0]._private.labelBounds.target||p},q=function(ve,ue){return ue},D=function(ve){return g(O(ve))},U=function(ve,ue,xe){var Se=ve?ve+"-":"";return{x:ue.x+xe.pstyle(Se+"text-margin-x").pfValue,y:ue.y+xe.pstyle(Se+"text-margin-y").pfValue}},G=function(ve,ue,xe){var Se=ve[0]._private.rscratch;return{x:Se[ue],y:Se[xe]}},Z=function(ve){return U("",G(ve,"labelX","labelY"),ve)},K=function(ve){return U("source",G(ve,"sourceLabelX","sourceLabelY"),ve)},Q=function(ve){return U("target",G(ve,"targetLabelX","targetLabelY"),ve)},ne=function(ve){return y(O(ve))},te=function(ve){return y(z(ve))},X=function(ve){return y(V(ve))},re=function(ve){var ue=F(ve),xe=y(F(ve));if(ve.isNode()){switch(ve.pstyle("text-halign").value){case"left":xe.x=-ue.w-(ue.leftPad||0);break;case"right":xe.x=-(ue.rightPad||0);break}switch(ve.pstyle("text-valign").value){case"top":xe.y=-ue.h-(ue.topPad||0);break;case"bottom":xe.y=-(ue.botPad||0);break}}return xe},he=e.data.eleTxrCache=new qg(e,{getKey:w,doesEleInvalidateKey:S,drawElement:N,getBoundingBox:O,getRotationPoint:D,getRotationOffset:ne,allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),oe=e.data.lblTxrCache=new qg(e,{getKey:C,drawElement:R,getBoundingBox:F,getRotationPoint:Z,getRotationOffset:re,isVisible:q}),se=e.data.slbTxrCache=new qg(e,{getKey:_,drawElement:I,getBoundingBox:z,getRotationPoint:K,getRotationOffset:te,isVisible:q}),fe=e.data.tlbTxrCache=new qg(e,{getKey:T,drawElement:j,getBoundingBox:V,getRotationPoint:Q,getRotationOffset:X,isVisible:q}),ae=e.data.lyrTxrCache=new eL(e);e.onUpdateEleCalcs(function(ve,ue){he.invalidateElements(ue),oe.invalidateElements(ue),se.invalidateElements(ue),fe.invalidateElements(ue),ae.invalidateElements(ue);for(var xe=0;xe<ue.length;xe++){var Se=ue[xe]._private;Se.oldBackgroundTimestamp=Se.backgroundTimestamp}});var pe=function(ve){for(var ue=0;ue<ve.length;ue++)ae.enqueueElementRefinement(ve[ue].ele)};he.onDequeue(pe),oe.onDequeue(pe),se.onDequeue(pe),fe.onDequeue(pe),t.webgl&&e.initWebgl(t,{getStyleKey:w,getLabelKey:C,getSourceLabelKey:_,getTargetLabelKey:T,drawElement:N,drawLabel:R,drawSourceLabel:I,drawTargetLabel:j,getElementBox:O,getLabelBox:F,getSourceLabelBox:z,getTargetLabelBox:V,getElementRotationPoint:D,getElementRotationOffset:ne,getLabelRotationPoint:Z,getSourceLabelRotationPoint:K,getTargetLabelRotationPoint:Q,getLabelRotationOffset:re,getSourceLabelRotationOffset:te,getTargetLabelRotationOffset:X})}Er.redrawHint=function(t,e){var r=this;switch(t){case"eles":r.data.canvasNeedsRedraw[Er.NODE]=e;break;case"drag":r.data.canvasNeedsRedraw[Er.DRAG]=e;break;case"select":r.data.canvasNeedsRedraw[Er.SELECT_BOX]=e;break;case"gc":r.data.gc=!0;break}};var $U=typeof Path2D<"u";Er.path2dEnabled=function(t){if(t===void 0)return this.pathsEnabled;this.pathsEnabled=!!t};Er.usePaths=function(){return $U&&this.pathsEnabled};Er.setImgSmoothing=function(t,e){t.imageSmoothingEnabled!=null?t.imageSmoothingEnabled=e:(t.webkitImageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e)};Er.getImgSmoothing=function(t){return t.imageSmoothingEnabled!=null?t.imageSmoothingEnabled:t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled};Er.makeOffscreenCanvas=function(t,e){var r;if((typeof OffscreenCanvas>"u"?"undefined":qi(OffscreenCanvas))!=="undefined")r=new OffscreenCanvas(t,e);else{var n=this.cy.window(),i=n.document;r=i.createElement("canvas"),r.width=t,r.height=e}return r};[tL,Lu,Sc,x_,Mf,lh,Ms,sL,uh,i0,hL].forEach(function(t){ar(Er,t)});var KU=[{name:"null",impl:UA},{name:"base",impl:XA},{name:"canvas",impl:qU}],ZU=[{type:"layout",extensions:bz},{type:"renderer",extensions:KU}],pL={},mL={};function gL(t,e,r){var n=r,i=function(O){an("Can not register `"+e+"` for `"+t+"` since `"+O+"` already exists in the prototype and can not be overridden")};if(t==="core"){if(Ev.prototype[e])return i(e);Ev.prototype[e]=r}else if(t==="collection"){if(za.prototype[e])return i(e);za.prototype[e]=r}else if(t==="layout"){for(var a=function(O){this.options=O,r.call(this,O),Vr(this._private)||(this._private={}),this._private.cy=O.cy,this._private.listeners=[],this.createEmitter()},s=a.prototype=Object.create(r.prototype),o=[],l=0;l<o.length;l++){var u=o[l];s[u]=s[u]||function(){return this}}s.start&&!s.run?s.run=function(){return this.start(),this}:!s.start&&s.run&&(s.start=function(){return this.run(),this});var c=r.prototype.stop;s.stop=function(){var j=this.options;if(j&&j.animate){var O=this.animations;if(O)for(var F=0;F<O.length;F++)O[F].stop()}return c?c.call(this):this.emit("layoutstop"),this},s.destroy||(s.destroy=function(){return this}),s.cy=function(){return this._private.cy};var h=function(O){return O._private.cy},p={addEventFields:function(O,F){F.layout=O,F.cy=h(O),F.target=O},bubble:function(){return!0},parent:function(O){return h(O)}};ar(s,{createEmitter:function(){return this._private.emitter=new M1(p,this),this},emitter:function(){return this._private.emitter},on:function(O,F){return this.emitter().on(O,F),this},one:function(O,F){return this.emitter().one(O,F),this},once:function(O,F){return this.emitter().one(O,F),this},removeListener:function(O,F){return this.emitter().removeListener(O,F),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},emit:function(O,F){return this.emitter().emit(O,F),this}}),nn.eventAliasesOn(s),n=a}else if(t==="renderer"&&e!=="null"&&e!=="base"){var g=vL("renderer","base"),y=g.prototype,S=r,w=r.prototype,C=function(){g.apply(this,arguments),S.apply(this,arguments)},_=C.prototype;for(var T in y){var N=y[T],R=w[T]!=null;if(R)return i(T);_[T]=N}for(var I in w)_[I]=w[I];y.clientFunctions.forEach(function(j){_[j]=_[j]||function(){Kn("Renderer does not implement `renderer."+j+"()` on its prototype")}}),n=C}else if(t==="__proto__"||t==="constructor"||t==="prototype")return Kn(t+" is an illegal type to be registered, possibly lead to prototype pollutions");return DM({map:pL,keys:[t,e],value:n})}function vL(t,e){return IM({map:pL,keys:[t,e]})}function YU(t,e,r,n,i){return DM({map:mL,keys:[t,e,r,n],value:i})}function XU(t,e,r,n){return IM({map:mL,keys:[t,e,r,n]})}var QS=function(){if(arguments.length===2)return vL.apply(null,arguments);if(arguments.length===3)return gL.apply(null,arguments);if(arguments.length===4)return XU.apply(null,arguments);if(arguments.length===5)return YU.apply(null,arguments);Kn("Invalid extension access syntax")};Ev.prototype.extension=QS;ZU.forEach(function(t){t.extensions.forEach(function(e){gL(t.type,e.name,e.impl)})});var gx=function(){if(!(this instanceof gx))return new gx;this.length=0},yf=gx.prototype;yf.instanceString=function(){return"stylesheet"};yf.selector=function(t){var e=this.length++;return this[e]={selector:t,properties:[]},this};yf.css=function(t,e){var r=this.length-1;if(Zt(t))this[r].properties.push({name:t,value:e});else if(Vr(t))for(var n=t,i=Object.keys(n),a=0;a<i.length;a++){var s=i[a],o=n[s];if(o!=null){var l=ma.properties[s]||ma.properties[b1(s)];if(l!=null){var u=l.name,c=o;this[r].properties.push({name:u,value:c})}}}return this};yf.style=yf.css;yf.generateStyle=function(t){var e=new ma(t);return this.appendToStyle(e)};yf.appendToStyle=function(t){for(var e=0;e<this.length;e++){var r=this[e],n=r.selector,i=r.properties;t.selector(n);for(var a=0;a<i.length;a++){var s=i[a];t.css(s.name,s.value)}}return t};var QU="3.33.1",xf=function(e){if(e===void 0&&(e={}),Vr(e))return new Ev(e);if(Zt(e))return QS.apply(QS,arguments)};xf.use=function(t){var e=Array.prototype.slice.call(arguments,1);return e.unshift(xf),t.apply(null,e),this};xf.warnings=function(t){return VM(t)};xf.version=QU;xf.stylesheet=xf.Stylesheet=gx;const{string:ly,array:r5,object:uy,number:Km,bool:mo,oneOfType:bp,any:cy,func:Zm}=Sj,JU={id:ly,className:ly,style:bp([ly,uy]),elements:bp([r5,cy]),stylesheet:bp([r5,cy]),layout:bp([uy,cy]),pan:bp([uy,cy]),zoom:Km,panningEnabled:mo,userPanningEnabled:mo,minZoom:Km,maxZoom:Km,zoomingEnabled:mo,userZoomingEnabled:mo,boxSelectionEnabled:mo,autoungrabify:mo,autolock:mo,autounselectify:mo,get:Zm,toJson:Zm,diff:Zm,forEach:Zm,cy:Zm,headless:mo,styleEnabled:mo,hideEdgesOnViewport:mo,textureOnViewport:mo,motionBlur:mo,motionBlurOpacity:Km,wheelSensitivity:Km,pixelRatio:bp([ly,uy])},yL=(t,e)=>{if(((a,s)=>a==null||s==null)(t,e)&&(t!=null||e!=null))return!0;if(t===e)return!1;if(typeof t!="object"||typeof e!="object")return t!==e;const r=Object.keys(t),n=Object.keys(e),i=a=>t[a]!==e[a];return r.length!==n.length||!(!r.some(i)&&!n.some(i))},Al=(t,e)=>t!=null?t[e]:null,eG={diff:yL,get:Al,toJson:t=>t,forEach:(t,e)=>t.forEach(e),elements:[{data:{id:"a",label:"Example node A"}},{data:{id:"b",label:"Example node B"}},{data:{id:"e",source:"a",target:"b"}}],stylesheet:[{selector:"node",style:{label:"data(label)"}}],zoom:1,pan:{x:0,y:0}},dy=(t,e,r,n)=>r(Al(t,n),Al(e,n)),tG=(t,e,r,n,i,a,s)=>{t.batch(()=>{(n===yL||dy(e,r,n,"elements"))&&aG(t,Al(e,"elements"),Al(r,"elements"),i,a,s,n),dy(e,r,n,"stylesheet")&&iG(t,Al(e,"stylesheet"),Al(r,"stylesheet"),i),["zoom","minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","pan","panningEnabled","userPanningEnabled","boxSelectionEnabled","autoungrabify","autolock","autounselectify"].forEach(o=>{dy(e,r,n,o)&&rG(t,o,Al(e,o),Al(r,o),i)})}),dy(e,r,n,"layout")&&nG(t,Al(e,"layout"),Al(r,"layout"),i)},rG=(t,e,r,n,i)=>{t[e](i(n))},nG=(t,e,r,n)=>{const i=n(r);i!=null&&t.layout(i).run()},iG=(t,e,r,n)=>{const i=t.style();i?.fromJson(n(r)).update()},aG=(t,e,r,n,i,a,s)=>{const o=[],l=t.collection(),u=[],c={},h={},p=g=>i(i(g,"data"),"id");a(r,g=>{const y=p(g);h[y]=g}),e!=null&&a(e,g=>{const y=p(g);c[y]=g,(S=>h[S]!=null)(y)||l.merge(t.getElementById(y))}),a(r,g=>{const y=p(g),S=(w=>c[w])(y);(w=>c[w]!=null)(y)?u.push({ele1:S,ele2:g}):o.push(n(g))}),l.length>0&&t.remove(l),o.length>0&&t.add(o),u.forEach(({ele1:g,ele2:y})=>sG(t,g,y,n,i,s))},sG=(t,e,r,n,i,a)=>{const s=i(i(r,"data"),"id"),o=t.getElementById(s),l={};["data","position","selected","selectable","locked","grabbable","classes"].forEach(c=>{const h=i(r,c);a(h,i(e,c))&&(l[c]=n(h))});const u=i(r,"scratch");a(u,i(e,"scratch"))&&o.scratch(n(u)),Object.keys(l).length>0&&o.json(l)};class oG extends ir.Component{static get propTypes(){return JU}static get defaultProps(){return eG}static normalizeElements(e){if(e.length!=null)return e;{let{nodes:r,edges:n}=e;return r==null&&(r=[]),n==null&&(n=[]),r.concat(n)}}constructor(e){super(e),this.displayName="CytoscapeComponent",this.containerRef=ir.createRef()}componentDidMount(){const e=this.containerRef.current,{global:r,headless:n,styleEnabled:i,hideEdgesOnViewport:a,textureOnViewport:s,motionBlur:o,motionBlurOpacity:l,wheelSensitivity:u,pixelRatio:c}=this.props,h=this._cy=new xf({container:e,headless:n,styleEnabled:i,hideEdgesOnViewport:a,textureOnViewport:s,motionBlur:o,motionBlurOpacity:l,wheelSensitivity:u,pixelRatio:c});r&&(window[r]=h),this.updateCytoscape(null,this.props)}updateCytoscape(e,r){const n=this._cy,{diff:i,toJson:a,get:s,forEach:o}=r;tG(n,e,r,i,a,s,o),r.cy!=null&&r.cy(n)}componentDidUpdate(e){this.updateCytoscape(e,this.props)}componentWillUnmount(){this._cy.destroy()}render(){const{id:e,className:r,style:n}=this.props;return ir.createElement("div",{ref:this.containerRef,id:e,className:r,style:n})}}const lG=[{selector:"node",style:{"background-color":"#1f2937",label:"data(label)",color:"#cbd5e1","font-family":"Outfit, sans-serif","font-size":"12px","text-valign":"bottom","text-margin-y":8,width:40,height:40,"border-width":2,"border-color":"#475569","text-outline-width":2,"text-outline-color":"#050508","overlay-padding":6,"z-index":10}},{selector:'node[category="Individual"]',style:{"background-color":"rgba(49, 46, 129, 0.9)","border-color":"#6366f1",shape:"ellipse",width:50,height:50}},{selector:'node[category="Location"]',style:{"background-color":"rgba(6, 78, 59, 0.9)","border-color":"#10b981",shape:"hexagon",width:60,height:60}},{selector:'node[category="Group"]',style:{"background-color":"rgba(88, 28, 135, 0.9)","border-color":"#a855f7",shape:"round-rectangle"}},{selector:"edge",style:{width:2,"line-color":"#334155","target-arrow-color":"#334155","target-arrow-shape":"triangle","curve-style":"bezier"}},{selector:".faded",style:{opacity:.1,"text-opacity":0,events:"no"}},{selector:".highlighted",style:{"border-width":4,"border-color":"#6366f1",width:70,height:70,"z-index":9999}}],uG=()=>{const{username:t,projectName:e}=Va(),{setRightPanelTab:r,setRightOpen:n}=bo(),i=Ga(),[a,s]=ie.useState([]),[o,l]=ie.useState(""),[u,c]=ie.useState("ALL"),[h,p]=ie.useState(!0),[g,y]=ie.useState(null),[S,w]=ie.useState(!1),[C,_]=ie.useState({}),T=ie.useRef(null),[N,R]=ie.useState(null);ie.useEffect(()=>{r&&r("CONTEXT"),O();const q=()=>{console.log(">>> Relationships updated, reloading graph data..."),O()};return window.addEventListener("relationships-update",q),()=>{window.removeEventListener("relationships-update",q)}},[]),ie.useEffect(()=>{r&&r("CONTEXT");const q=setInterval(()=>{const D=document.getElementById("global-right-panel-portal");D&&(console.log("[GeneralGraphView] Portal found, clearing before use"),D.innerHTML="",R(D),clearInterval(q))},100);return()=>{clearInterval(q),console.log("[GeneralGraphView] Cleanup: clearing portal");const D=document.getElementById("global-right-panel-portal");D&&(D.innerHTML=""),r&&r("NOTEBOOKS")}},[]);const I=()=>{_({...g}),w(!0)},j=async()=>{try{p(!0),await Ke.put(`/world-bible/entities/${g.id}`,C),y({...C,isFull:!0}),w(!1),O()}catch(q){console.error("Failed to save entity changes",q),alert("Error al guardar los cambios.")}finally{p(!1)}},O=async()=>{p(!0);try{const q=await Ke.get("/world-bible/graph");if(q&&q.nodes){const D=q.nodes.map(G=>({...G,group:"nodes"})),U=q.edges.map(G=>({...G,group:"edges"}));console.log("Loaded graph:",D.length,"nodes,",U.length,"edges"),s([...D,...U])}}catch(q){console.error("Failed to load graph data",q),i("/")}finally{p(!1)}},F=()=>{if(!T.current)return;T.current.layout({name:"cose",animate:!0,padding:50,fit:!0,nodeOverlap:20,componentSpacing:100}).run()};ie.useEffect(()=>{T.current&&(F(),T.current.on("select","node",async q=>{const U=q.target.data();y(U),w(!1),n(!0);try{const G=await Ke.get(`/world-bible/entities/${U.id}`);y(Z=>({...Z,...G,isFull:!0}))}catch(G){console.error("Error fetching full node details",G)}}),T.current.on("unselect","node",()=>{y(null),w(!1)}))},[a]);const z=(q,D=u)=>{if(!T.current)return;const U=T.current;U.batch(()=>{if(U.elements().removeClass("highlighted faded"),!q&&D==="ALL"){U.animate({fit:{padding:50},duration:500});return}const Z=U.nodes().filter(K=>{const Q=!q||K.data("label").toLowerCase().includes(q.toLowerCase()),ne=D==="ALL"||K.data("category")===D;return Q&&ne});Z.length>0?(U.elements().not(Z).addClass("faded"),Z.addClass("highlighted"),Z.connectedEdges().addClass("highlighted"),q&&U.animate({fit:{eles:Z,padding:80},duration:500})):U.elements().addClass("faded")})};ie.useEffect(()=>{z(o,u)},[o,u]);const V=()=>m.jsxs("div",{className:"p-6 flex flex-col h-full animate-in fade-in slide-in-from-right-4 duration-500 space-y-8",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"size-8 rounded bg-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-primary-foreground text-sm",children:"hub"})}),m.jsx("h2",{className:"font-bold text-sm tracking-tight uppercase",children:"Network Controls"})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("input",{className:"bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-xs w-full outline-none focus:ring-1 focus:ring-primary placeholder:text-slate-600 text-slate-200",placeholder:"Find cosmic entity...",value:o,onChange:q=>l(q.target.value),onKeyDown:q=>q.key==="Enter"&&z()}),m.jsx("button",{onClick:z,className:"px-4 bg-primary/20 hover:bg-primary/30 border border-primary/30 rounded-xl text-primary transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-base",children:"search"})})]}),m.jsxs("div",{className:"flex items-center justify-between pt-2",children:[m.jsxs("div",{className:"flex gap-2",children:[m.jsx("button",{onClick:F,className:"p-2.5 bg-white/5 hover:bg-white/10 rounded-xl text-slate-400 hover:text-white transition-colors border border-white/5",title:"Re-simulate Gravity",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"refresh"})}),m.jsx("button",{onClick:()=>T.current?.fit(),className:"p-2.5 bg-white/5 hover:bg-white/10 rounded-xl text-slate-400 hover:text-white transition-colors border border-white/5",title:"Fit View",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"fit_screen"})})]}),m.jsx("div",{className:"flex flex-wrap gap-2 text-[8px] uppercase font-black",children:[{id:"ALL",color:"bg-slate-500",label:"All"},{id:"Individual",color:"bg-indigo-500",label:"IND"},{id:"Location",color:"bg-emerald-500",label:"LOC"},{id:"Group",color:"bg-purple-500",label:"GRP"}].map(q=>m.jsxs("button",{onClick:()=>c(q.id),className:`flex items-center gap-1.5 px-2 py-1 rounded-md border transition-all ${u===q.id?"bg-white/10 border-white/20 text-white":"bg-transparent border-transparent text-slate-500 hover:text-slate-300"}`,children:[m.jsx("div",{className:`size-1.5 rounded-full ${q.color} ${u===q.id?"ring-2 ring-white/20 shadow-[0_0_5px_rgba(255,255,255,0.2)]":""}`}),q.label]},q.id))})]})]}),m.jsx("div",{className:"h-px bg-white/5"}),g?m.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500 pb-20",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-14 rounded-2xl flex items-center justify-center text-white shadow-2xl ${g.category==="Individual"?"bg-indigo-600 shadow-indigo-500/20":g.category==="Location"?"bg-emerald-600 shadow-emerald-500/20":"bg-purple-600 shadow-purple-500/20"}`,children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:g.category==="Individual"?"person":g.category==="Location"?"location_on":"groups"})}),m.jsxs("div",{className:"flex-1 min-w-0",children:[S?m.jsx("input",{className:"w-full bg-white/5 border-b border-primary/50 text-xl font-serif font-black text-white outline-none",value:C.nombre||"",onChange:q=>_({...C,nombre:q.target.value})}):m.jsx("h3",{className:"text-2xl font-serif font-black text-white leading-tight truncate",children:g.label||g.nombre}),m.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[m.jsx("span",{className:"text-[10px] font-black uppercase tracking-tighter text-slate-500",children:g.category}),m.jsx("div",{className:"size-1 rounded-full bg-slate-700"}),m.jsxs("span",{className:"text-[10px] font-bold text-primary",children:["ID: ",g.id]})]})]})]}),S?m.jsx("textarea",{className:"w-full bg-white/5 border border-white/10 rounded-xl p-3 text-xs text-slate-400 font-serif outline-none h-24 focus:border-primary/50",value:C.descripcion||"",onChange:q=>_({...C,descripcion:q.target.value})}):m.jsx("p",{className:"text-sm text-slate-400 font-serif leading-relaxed italic opacity-80 border-l-2 border-white/5 pl-4",children:g.description||g.summary||"No description available for this cosmic entity."})]}),!S&&m.jsxs("div",{className:"space-y-4",children:[m.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-xs",children:"account_tree"})," Conexiones Activas"]}),m.jsxs("div",{className:"space-y-2",children:[(()=>{const q=String(g.id);return a.filter(G=>G.group==="edges"&&(G.data.source===q||G.data.target===q)).slice(0,5).map(G=>{const Z=G.data.source===q?G.data.target:G.data.source,K=a.find(Q=>String(Q.data.id)===String(Z));return m.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-white/[0.02] border border-white/5 group/rel",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"size-1.5 rounded-full bg-primary/40 group-hover/rel:bg-primary transition-colors"}),m.jsx("span",{className:"text-xs text-slate-300 font-medium",children:K?.data.label||"Unknown"})]}),m.jsx("span",{className:"px-2 py-0.5 rounded bg-primary/10 text-primary text-[8px] font-black uppercase tracking-tighter",children:G.data.label||"Vnculo"})]},G.data.id)})})(),a.filter(q=>q.group==="edges"&&(String(q.data.source)===String(g.id)||String(q.data.target)===String(g.id))).length===0&&m.jsx("p",{className:"text-xs text-slate-500 italic text-center py-4",children:"No hay conexiones activas"})]})]}),g.isFull&&m.jsx("div",{className:"space-y-8 animate-in slide-in-from-bottom-4",children:g.attributes&&Object.keys(g.attributes).length>0&&m.jsxs("div",{className:"space-y-4",children:[m.jsx("div",{className:"flex justify-between items-center",children:m.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-xs",children:"list"})," Atributos"]})}),m.jsx("div",{className:"grid grid-cols-1 gap-2",children:Object.entries(S?C.attributes:g.attributes).map(([q,D])=>typeof D!="object"&&m.jsxs("div",{className:"flex flex-col gap-1 p-3 rounded-xl bg-white/[0.02] border border-white/5",children:[m.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest",children:q.replace(/_/g," ")}),S?m.jsx("input",{className:"w-full bg-transparent border-none text-xs text-slate-200 outline-none",value:String(D),onChange:U=>{const G={...C.attributes,[q]:U.target.value};_({...C,attributes:G})}}):m.jsx("span",{className:"text-xs text-slate-200 font-medium truncate max-w-full",title:String(D),children:String(D).length>100?String(D).substring(0,100)+"...":String(D)})]},q))})]})}),m.jsx("div",{className:"pt-6 border-t border-white/5 space-y-3",children:S?m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{onClick:()=>w(!1),className:"flex-1 py-4 bg-white/5 text-slate-400 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:text-white transition-all border border-white/5",children:"Cancelar"}),m.jsx("button",{onClick:j,className:"flex-[2] py-4 bg-primary text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-primary/20 transition-all hover:scale-[1.02]",children:"Guardar Cambios"})]}):m.jsxs(m.Fragment,{children:[m.jsxs("button",{onClick:I,className:"w-full py-4 bg-primary text-white rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all flex items-center justify-center gap-2 hover:scale-[1.02] active:scale-95 shadow-xl shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-base",children:"edit"}),m.jsx("span",{children:"Editar Nodo"})]}),m.jsxs("button",{onClick:()=>{if(!T.current)return;const q=T.current.$id(g.id);T.current.animate({center:{eles:q},zoom:2})},className:"w-full py-4 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-400 transition-all flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-base",children:"center_focus_strong"}),m.jsx("span",{children:"Centrar en Mapa"})]})]})})]}):m.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-500 text-center opacity-40 py-12",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-4",children:"touch_app"}),m.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest leading-loose",children:["Select a node",m.jsx("br",{}),"to reveal its secrets"]})]})]});return m.jsxs("div",{className:"w-full h-full flex bg-background-dark relative overflow-hidden font-display text-foreground",children:[N&&eo.createPortal(V(),N),a.length===0&&!h&&m.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 pointer-events-none",children:m.jsx("div",{className:"text-muted text-lg font-serif italic text-slate-600",children:"The void is empty. Document your world in the Bible."})}),m.jsx(oG,{elements:a,stylesheet:lG,style:{width:"100%",height:"100%"},cy:q=>{T.current=q},minZoom:.2,maxZoom:3,wheelSensitivity:.3,className:"bg-background-dark"})]})},cG=({id:t})=>{const{id:e}=Va(),r=Ga(),[n,i]=ie.useState("overview"),[a,s]=ie.useState(null),[o,l]=ie.useState(!0),[u,c]=ie.useState(!1);ie.useEffect(()=>{h()},[t]);const h=async()=>{l(!0);try{const S=await Ke.get(`/bd/entidadindividual/${t}`);s(S)}catch(S){console.error("Error loading character:",S)}finally{l(!1)}},p=async()=>{try{await Ke.patch("/bd/modificar",{...a,tipoEntidad:"entidadindividual"}),c(!1)}catch(S){console.error("Error saving:",S)}},g=async()=>{if(window.confirm("Move this character to the Trash Bin?"))try{await Ke.delete(`/bd/entidadindividual/${t}`),r(`/project/${e}`)}catch(S){console.error(S)}},y=(S,w)=>{s(C=>({...C,[S]:w}))};return o?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Summoning entity..."}):a?m.jsxs("div",{className:"flex h-full",children:[m.jsxs("div",{className:"flex-1 flex flex-col overflow-y-auto custom-scrollbar p-8 gap-6",children:[m.jsxs("div",{className:"flex items-start gap-6",children:[m.jsx("div",{className:"relative",children:m.jsx(Kk,{url:a.imagenUrl||"https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=1976&auto=format&fit=crop",size:"xl",className:"rounded-2xl border-2 border-primary shadow-[0_0_30px_rgba(99,102,242,0.3)]"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[m.jsx("span",{className:"text-xs font-bold text-primary bg-primary/10 px-2 py-0.5 rounded border border-primary/20",children:a.estado||"ACTIVE"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:a.tipo||"Unknown"})]}),m.jsxs("h1",{className:"text-4xl font-bold text-white mb-2",children:[a.nombre," ",a.apellidos]}),m.jsx("p",{className:"text-lg text-slate-300",children:a.origen||"Traveling the void"})]}),m.jsxs("div",{className:"flex gap-2",children:[!u&&m.jsx(Dn,{className:"border-red-500/30 text-red-400 hover:bg-red-500/10",icon:"delete",onClick:g,children:"Delete"}),m.jsx(Dn,{variant:"secondary",icon:u?"close":"edit",onClick:()=>c(!u),children:u?"Cancel":"Edit Profile"}),u&&m.jsx(Dn,{variant:"primary",icon:"save",onClick:p,children:"Save Changes"})]})]}),m.jsx("div",{className:"border-b border-glass-border flex gap-6",children:["Overview","Biography","Attributes & Stats","Relationships"].map(S=>m.jsx("button",{onClick:()=>i(S.toLowerCase()),className:`pb-4 px-2 text-sm font-bold border-b-2 transition-colors ${n===S.toLowerCase()?"text-primary border-primary":"text-slate-500 border-transparent hover:text-white"}`,children:S},S))}),m.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[m.jsx("div",{className:"col-span-1 space-y-6",children:m.jsxs(ti,{className:"p-4",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"fingerprint"})," Identity"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Name"}),m.jsx("input",{type:"text",value:a.nombre,onChange:S=>y("nombre",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Surnames"}),m.jsx("input",{type:"text",value:a.apellidos||"",onChange:S=>y("apellidos",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Type / Species"}),m.jsx("input",{type:"text",value:a.tipo||"",onChange:S=>y("tipo",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Origin"}),m.jsx("input",{type:"text",value:a.origen||"",onChange:S=>y("origen",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]})]})]})}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(ti,{className:"p-6 relative overflow-hidden group",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"auto_stories"})," Narrative & Connections"]}),!u&&m.jsx("span",{className:"text-[10px] text-slate-600 bg-white/5 px-2 py-1 rounded",children:"Read Only"})]}),m.jsxs("div",{className:"mb-8",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mb-3 opacity-80",children:"Biography"}),m.jsx("textarea",{value:a.descripcion||"",onChange:S=>y("descripcion",S.target.value),readOnly:!u,className:`w-full bg-transparent border-none outline-none text-slate-300 text-sm leading-relaxed resize-none custom-scrollbar ${u?"min-h-[150px] placeholder-white/20":"h-auto overflow-hidden"}`,placeholder:"Write the history of this person..."}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mt-6 mb-3 opacity-80",children:"Behavior & Personality"}),m.jsx("textarea",{value:a.comportamiento||"",onChange:S=>y("comportamiento",S.target.value),readOnly:!u,className:`w-full bg-transparent border-none outline-none text-slate-300 text-sm leading-relaxed resize-none custom-scrollbar ${u?"min-h-[100px]":"h-auto overflow-hidden"}`,placeholder:"How does this person act?"})]}),m.jsxs("div",{className:"pt-6 border-t border-white/5",children:[m.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mb-4 flex items-center gap-2 opacity-80",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"hub"})," Established Connections"]}),a.relaciones&&a.relaciones.length>0?m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:a.relaciones.map((S,w)=>m.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/5 hover:border-primary/30 transition-colors",children:[m.jsx("div",{className:"size-8 rounded-full bg-white/10 flex items-center justify-center text-xs font-bold",children:S.entidadDestino?.nombre?.charAt(0)||"?"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("div",{className:"text-sm font-bold text-white truncate",children:S.entidadDestino?.nombre||"Unknown"}),m.jsx("div",{className:"text-[10px] text-primary truncate",children:S.tipoRelacion||"Connected"})]})]},w))}):m.jsx("div",{className:"p-6 text-center bg-white/5 rounded-xl border border-dashed border-white/10",children:m.jsx("p",{className:"text-xs text-slate-500 italic",children:"No relationships recorded yet."})})]})]})})]})]}),m.jsxs("div",{className:"w-80 border-l border-glass-border bg-surface-dark/50 hidden xl:flex flex-col",children:[m.jsxs("div",{className:"p-4 border-b border-glass-border flex justify-between items-center",children:[m.jsx("span",{className:"text-xs font-bold text-slate-500",children:"QUICK NOTES"}),m.jsx("button",{className:"text-slate-400 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"open_in_new"})})]}),m.jsx("div",{className:"p-4 flex-1",children:m.jsx("textarea",{className:"w-full h-full bg-transparent border-none outline-none text-sm text-slate-300 placeholder-slate-600 resize-none",placeholder:"Draft a quick scene or jot down notes for Elara here..."})}),m.jsx("div",{className:"p-2 border-t border-glass-border text-right text-[10px] text-slate-600",children:"0 words"})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Character not found in the archives."})},n5=({id:t})=>{const[e,r]=ie.useState(null),[n,i]=ie.useState(!0),[a,s]=ie.useState(!1);ie.useEffect(()=>{o()},[t]);const o=async()=>{i(!0);try{const c=await Ke.get(`/bd/zona/${t}`);r(c)}catch(c){console.error("Error loading location:",c)}finally{i(!1)}},l=async()=>{try{await Ke.patch("/bd/modificar",{...e,tipoEntidad:"zona"}),s(!1)}catch(c){console.error("Error saving:",c)}},u=(c,h)=>{r(p=>({...p,[c]:h}))};return n?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Scanning terrain..."}):e?m.jsxs("div",{className:"flex h-full overflow-y-auto custom-scrollbar p-8 flex-col gap-8",children:[m.jsxs("header",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[m.jsx("span",{className:"text-xs font-bold text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded border border-emerald-400/20",children:"LOCATION"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:e.tipo||"Wilderness"})]}),m.jsx("h1",{className:"text-5xl font-manrope font-black text-white tracking-tight",children:e.nombre}),m.jsx("p",{className:"text-slate-400 mt-2",children:e.apellidos||"Uncharted territory"})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(Dn,{variant:"secondary",icon:a?"close":"edit",onClick:()=>s(!a),children:a?"Cancel":"Edit Location"}),a&&m.jsx(Dn,{variant:"primary",icon:"save",onClick:l,children:"Update Records"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[m.jsxs("div",{className:"col-span-1 space-y-6",children:[m.jsxs(ti,{className:"p-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"straighten"})," Geography & Scale"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Size / Scale"}),m.jsx("input",{type:"text",value:e.tamanno||"",onChange:c=>u("tamanno",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Development Level"}),m.jsx("input",{type:"text",value:e.desarrollo||"",onChange:c=>u("desarrollo",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]})]})]}),m.jsxs(ti,{className:"p-6",children:[m.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4",children:"Quick Stats"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"bg-white/5 p-3 rounded-xl border border-white/5",children:[m.jsx("span",{className:"text-[10px] text-slate-500 block",children:"Density"}),m.jsx("span",{className:"text-white font-bold",children:"Medium"})]}),m.jsxs("div",{className:"bg-white/5 p-3 rounded-xl border border-white/5",children:[m.jsx("span",{className:"text-[10px] text-slate-500 block",children:"Security"}),m.jsx("span",{className:"text-emerald-400 font-bold",children:"Stable"})]})]})]})]}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(ti,{className:"p-8",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"description"})," Topographic Records & Lore"]}),m.jsx("textarea",{value:e.descripcion||"",onChange:c=>u("descripcion",c.target.value),readOnly:!a,className:"w-full bg-transparent border-none outline-none text-slate-300 text-lg leading-relaxed min-h-[400px] resize-none",placeholder:"Describe the vistas, the smells, and the secrets of this place..."})]})})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Location not found in the maps."})},dG=({id:t})=>{const[e,r]=ie.useState(null),[n,i]=ie.useState(!0),[a,s]=ie.useState(!1);ie.useEffect(()=>{o()},[t]);const o=async()=>{i(!0);try{const c=await Ke.get(`/bd/entidadcolectiva/${t}`);r(c)}catch(c){console.error("Error loading collective:",c)}finally{i(!1)}},l=async()=>{try{await Ke.patch("/bd/modificar",{...e,tipoEntidad:"entidadcolectiva"}),s(!1)}catch(c){console.error("Error saving:",c)}},u=(c,h)=>{r(p=>({...p,[c]:h}))};return n?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Gathering intelligence..."}):e?m.jsxs("div",{className:"flex h-full overflow-y-auto custom-scrollbar p-8 flex-col gap-8",children:[m.jsxs("header",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[m.jsx("span",{className:"text-xs font-bold text-indigo-400 bg-indigo-400/10 px-2 py-0.5 rounded border border-indigo-400/20",children:"COLLECTIVE"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:e.tipo||"Organization"})]}),m.jsx("h1",{className:"text-5xl font-manrope font-black text-white tracking-tight",children:e.nombre}),m.jsxs("p",{className:"text-slate-400 mt-2",children:[e.cantidadMiembros||"Unknown"," members"]})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(Dn,{variant:"secondary",icon:a?"close":"edit",onClick:()=>s(!a),children:a?"Cancel":"Edit Collective"}),a&&m.jsx(Dn,{variant:"primary",icon:"save",onClick:l,children:"Update Dossier"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[m.jsx("div",{className:"col-span-1 space-y-6",children:m.jsxs(ti,{className:"p-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"group_work"})," Group Dynamics"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Scale / Members"}),m.jsx("input",{type:"text",value:e.cantidadMiembros||"",onChange:c=>u("cantidadMiembros",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Behavior / Alignment"}),m.jsx("input",{type:"text",value:e.comportamiento||"",onChange:c=>u("comportamiento",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]})]})]})}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(ti,{className:"p-8",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"history_edu"})," Mandate & History"]}),m.jsx("textarea",{value:e.descripcion||"",onChange:c=>u("descripcion",c.target.value),readOnly:!a,className:"w-full bg-transparent border-none outline-none text-slate-300 text-lg leading-relaxed min-h-[400px] resize-none",placeholder:"Detail the motives, the structure, and the legacy of this group..."})]})})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Collective not found in the records."})},hG=()=>m.jsx("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300",children:m.jsxs("main",{className:"flex-1 flex flex-col p-12 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("header",{className:"mb-12 space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2 text-slate-500 font-bold text-[10px] tracking-widest uppercase",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"grid_view"}),m.jsx("span",{children:"Universo Alpha"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{children:"Galaxia Andrmeda"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{className:"text-white",children:"Sistema Solar"})]}),m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsxs("div",{className:"space-y-4 max-w-3xl",children:[m.jsxs("div",{className:"flex items-center gap-3 px-3 py-1 rounded bg-orange-500/10 text-orange-400 border border-orange-500/20 inline-block",children:[m.jsx("span",{className:"material-symbols-outlined text-[14px]",children:"sunny"}),m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Sistema Planetario"}),m.jsx("span",{className:"text-[9px] font-bold text-slate-600 tracking-widest ml-2",children:"ID: SYS-SOL-001"})]}),m.jsx("h1",{className:"text-6xl font-manrope font-black text-white tracking-tight",children:"Sistema Solar"}),m.jsx("p",{className:"text-slate-400 text-lg leading-relaxed",children:"Sistema planetario principal ubicado en el Brazo de Orin, hogar de la nica vida biolgica compleja confirmada en el sector galctico Alpha-9."})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{className:"p-3 rounded-2xl bg-white/5 hover:bg-red-500/10 text-slate-500 hover:text-red-400 border border-white/5 transition-all outline-none",children:m.jsx("span",{className:"material-symbols-outlined",children:"delete"})}),m.jsx(Dn,{variant:"primary",icon:"save",children:"Guardar"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-12",children:[m.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"sell"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Etiquetas"}),m.jsx("span",{className:"ml-auto text-[9px] font-bold text-slate-600 px-1.5 py-0.5 rounded bg-white/5",children:"3 ACTIVAS"})]}),m.jsxs("div",{className:"flex flex-wrap gap-2",children:[m.jsx(x2,{label:"Estrella Tipo G",color:"amber",icon:"star"}),m.jsx(x2,{label:"Vida Confirmada",color:"emerald",icon:"tempest"}),m.jsx(x2,{label:"Rico en Agua",color:"cyan",icon:"water_drop"}),m.jsx("button",{className:"size-8 rounded-full border border-dashed border-white/10 flex items-center justify-center text-slate-600 hover:text-white hover:border-white/30 transition-all",children:"+"})]})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"analytics"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Atributos Principales"}),m.jsx("button",{className:"ml-auto text-slate-600 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"settings"})})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx(hy,{label:"Forma / Estructura",value:"Heliosfrica Estndar",icon:"hive"}),m.jsx(hy,{label:"Composicin",value:"Hidrgeno (74%), Helio (24%)",icon:"experiment"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx(hy,{label:"Edad (Aos)",value:"4.6 MM",unit:"Aos"}),m.jsx(hy,{label:"Ciclo Orbital",value:"230 MM",unit:"Aos"})]})]})]}),m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"menu_book"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Notas de Lore"})]}),m.jsx("textarea",{className:"w-full h-48 bg-white/5 border border-white/5 rounded-[2rem] p-6 text-sm text-slate-400 placeholder:text-slate-700 focus:border-primary/50 outline-none transition-all resize-none leading-relaxed italic shadow-inner",defaultValue:"El sistema contiene un cinturn de asteroides inusualmente denso entre el 4 y 5 planeta. Se teoriza que es el remanente de una colisin planetaria antigua conocida como 'El Gran Impacto' en las escrituras sagradas de los habitantes de Terra."})]})]}),m.jsx("div",{className:"lg:col-span-2",children:m.jsxs(ti,{className:"h-full border-white/5 bg-surface-dark/40 overflow-hidden flex flex-col shadow-2xl",children:[m.jsxs("header",{className:"p-8 border-b border-white/5 flex justify-between items-center",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/20 text-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined",children:"hub"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-bold text-white text-lg tracking-tight",children:"Contenido Interno (Planetas)"}),m.jsx("p",{className:"text-[10px] font-medium text-slate-500 mt-0.5",children:"Arrastra para reordenar la jerarqua orbital"})]})]}),m.jsxs("div",{className:"px-3 py-1 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 text-[10px] font-black uppercase tracking-widest flex items-center gap-2",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-emerald-500 animate-pulse"}),"8 Entidades"]})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-3",children:[m.jsx(Ym,{name:"Mercurio",type:"Rocoso",stats:"430C | 88 Das",icon:"public"}),m.jsx(Ym,{name:"Venus",type:"Atmsfera",stats:"462C | 225 Das",icon:"public"}),m.jsx(Ym,{name:"Tierra",type:"Habitable",stats:"8B Hab | 1 Luna",icon:"public",active:!0}),m.jsx(Ym,{name:"Marte",type:"Desierto",stats:"-60C | 2 Lunas",icon:"public"}),m.jsx(Ym,{name:"Cinturn Asteroides",type:"Anillo",stats:">1M Obj",icon:"grain"})]}),m.jsx("div",{className:"p-8 bg-black/20 border-t border-white/5",children:m.jsxs("button",{className:"w-full py-4 rounded-[1.5rem] border-2 border-dashed border-white/10 text-slate-500 hover:text-white hover:border-primary/50 hover:bg-primary/5 transition-all flex items-center justify-center gap-3 font-black uppercase text-[10px] tracking-[0.2em]",children:[m.jsx("span",{className:"material-symbols-outlined",children:"add"}),"Aadir Nueva Entidad"]})})]})})]})]})}),x2=({label:t,color:e,icon:r})=>m.jsxs("div",{className:`px-4 py-1.5 rounded-xl bg-${e}-500/10 text-${e}-400 border border-${e}-500/20 flex items-center gap-2 text-[10px] font-black uppercase tracking-widest shadow-lg`,children:[m.jsx("span",{className:"material-symbols-outlined text-[14px]",children:r}),t]}),hy=({label:t,value:e,unit:r,icon:n})=>m.jsxs("div",{className:"space-y-2",children:[m.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest text-slate-600 ml-1",children:t}),m.jsxs("div",{className:"w-full bg-white/5 border border-white/5 rounded-2xl px-5 py-3.5 flex items-center justify-between group hover:border-white/10 transition-all",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[n&&m.jsx("span",{className:"material-symbols-outlined text-slate-500 text-lg group-hover:text-primary transition-colors",children:n}),m.jsx("span",{className:"text-sm font-bold text-slate-300",children:e})]}),r&&m.jsx("span",{className:"text-[10px] font-black text-slate-600 uppercase tracking-widest",children:r})]})]}),Ym=({name:t,type:e,stats:r,icon:n,active:i})=>m.jsxs("div",{className:`group flex items-center gap-6 p-4 rounded-2xl transition-all cursor-pointer ${i?"bg-primary/10 border border-primary/20 shadow-xl":"hover:bg-white/5 border border-transparent"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-slate-700 group-hover:text-slate-500",children:"drag_indicator"}),m.jsx("div",{className:`size-12 rounded-xl flex items-center justify-center ${i?"bg-primary text-white shadow-lg shadow-primary/30":"bg-surface-dark border border-white/5 text-slate-500"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:n})}),m.jsx("div",{className:"flex-1",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("h4",{className:"text-sm font-bold text-white group-hover:text-primary transition-colors",children:t}),m.jsx("span",{className:`text-[8px] font-black px-1.5 py-0.5 rounded uppercase tracking-widest ${i?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/30":"bg-white/5 text-slate-600"}`,children:e})]})}),m.jsx("div",{className:"flex flex-col items-end gap-1",children:m.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500",children:[m.jsx("span",{className:"material-symbols-outlined text-[12px]",children:"analytics"}),m.jsx("span",{className:"text-[10px] font-mono tracking-tight group-hover:text-slate-300",children:r})]})}),m.jsxs("div",{className:"flex gap-2 ml-4",children:[m.jsx("button",{className:"p-2 rounded-lg text-slate-700 hover:text-white hover:bg-white/5 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"edit_note"})}),i?m.jsx("button",{className:"size-8 rounded-full bg-primary text-white flex items-center justify-center shadow-lg",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"arrow_forward"})}):m.jsx("button",{className:"p-2 rounded-lg text-slate-700 hover:text-white hover:bg-white/5 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"open_in_new"})})]})]}),fG=()=>m.jsx("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300",children:m.jsxs("main",{className:"flex-1 flex flex-col p-12 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("header",{className:"mb-12 space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2 text-slate-500 font-bold text-[10px] tracking-widest uppercase",children:[m.jsx("span",{children:"Sistema Solar"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{children:"Kepler-186f"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{className:"text-white",children:"Territorios"})]}),m.jsxs("div",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[m.jsx("h1",{className:"text-6xl font-manrope font-black text-white tracking-tight",children:"Kepler-186f"}),m.jsx("span",{className:"material-symbols-outlined text-4xl text-primary",children:"public"})]}),m.jsx("p",{className:"text-slate-400 text-lg max-w-2xl leading-relaxed",children:"Gestin geopoltica y geogrfica de la superficie planetaria. Administra biomas, asentamientos y recursos estratgicos."})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx(Dn,{variant:"secondary",icon:"map",children:"Ver Atlas"}),m.jsx(Dn,{variant:"primary",icon:"add",children:"Nuevo Territorio"})]})]})]}),m.jsxs("section",{className:"space-y-8",children:[m.jsxs(ti,{className:"p-2 flex items-center justify-between border-white/5",children:[m.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[m.jsxs("div",{className:"relative flex-1 max-w-sm",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-sm",children:"search"}),m.jsx("input",{type:"text",placeholder:"Buscar por nombre...",className:"w-full bg-transparent border-none rounded-xl py-2 pl-9 pr-4 text-xs focus:ring-1 focus:ring-primary/30 outline-none transition-all"})]}),m.jsx("div",{className:"w-px h-6 bg-white/5 mx-2"}),m.jsx(b2,{label:"Bioma: Todos"}),m.jsx(b2,{label:"Poblacin"}),m.jsx(b2,{label:"Estado"})]}),m.jsxs("div",{className:"flex items-center gap-1 p-1 bg-white/5 rounded-lg",children:[m.jsx("button",{className:"p-1.5 rounded-md text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"format_list_bulleted"})}),m.jsx("button",{className:"p-1.5 rounded-md bg-white/10 text-white shadow-sm",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"grid_view"})})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[m.jsx(w2,{title:"Nueva Neo-Tokyo",desc:"Metrpolis vertical construida sobre las...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuAYF5Q6W3o1w1f1",badges:["Capital"],stats:["15M","Templado","Costero"],color:"cyan"}),m.jsx(w2,{title:"Mar de Dunas",desc:"Extensin rida rica en especia slica...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuBYG6R7X4p2x2g2",stats:["Hostil","rido"],color:"amber"}),m.jsx(w2,{title:"Sanctum Bio-Domo",desc:"Instalacin de investigacin...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuCZ H7S8Y5q3z3h3",badges:["Ciencia"],stats:["5K","Jungla"],color:"purple"}),m.jsxs("div",{className:"group border-2 border-dashed border-white/5 rounded-[2.5rem] flex flex-col items-center justify-center p-12 gap-4 hover:border-primary/30 hover:bg-primary/5 transition-all cursor-pointer",children:[m.jsx("div",{className:"size-16 rounded-3xl bg-white/5 flex items-center justify-center group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-600 group-hover:text-primary",children:"add_location_alt"})}),m.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-slate-600 group-hover:text-white",children:"Aadir Territorio"})]})]})]})]})}),b2=({label:t})=>m.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl hover:bg-white/5 transition-all group",children:[m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-white",children:t}),m.jsx("span",{className:"material-symbols-outlined text-slate-600 text-[14px]",children:"expand_more"})]}),w2=({title:t,desc:e,image:r,badges:n=[],stats:i=[],color:a})=>m.jsxs("div",{className:"group relative rounded-[2.5rem] overflow-hidden border border-white/5 bg-surface-dark/50 hover:border-white/10 transition-all shadow-2xl",children:[m.jsxs("div",{className:"h-48 overflow-hidden relative",children:[m.jsx("img",{src:r,alt:t,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-60 group-hover:opacity-100"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-surface-dark via-transparent to-transparent"}),m.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:n.map(s=>m.jsxs("span",{className:`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest bg-${a==="cyan"?"primary":a==="amber"?"amber-500":"purple-500"}/20 text-${a==="cyan"?"primary":a==="amber"?"amber-400":"purple-400"} border border-white/10 backdrop-blur-md flex items-center gap-1.5`,children:[m.jsx("span",{className:"material-symbols-outlined text-[12px]",children:s==="Capital"?"star":"science"}),s]},s))})]}),m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("header",{className:"flex justify-between items-start",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"text-2xl font-manrope font-black text-white mb-2 group-hover:text-primary transition-colors",children:t}),m.jsx("p",{className:"text-xs text-slate-500 leading-relaxed line-clamp-2",children:e})]}),m.jsx("button",{className:"p-2 text-slate-700 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined",children:"more_vert"})})]}),m.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(s=>m.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-white/5 border border-white/5 text-[9px] font-black text-slate-400 uppercase tracking-widest",children:[m.jsx("div",{className:`size-1.5 rounded-full bg-${a==="cyan"?"primary":a==="amber"?"amber-500":"purple-500"}/50`}),s]},s))}),m.jsxs("div",{className:"flex gap-3 pt-2",children:[m.jsxs("button",{className:"flex-1 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 text-[10px] font-black uppercase tracking-widest text-slate-300 flex items-center justify-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-50",children:"edit"})," Editar"]}),m.jsxs("button",{className:"flex-1 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 text-[10px] font-black uppercase tracking-widest text-slate-300 flex items-center justify-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-50",children:"map"})," Ubicacin"]})]})]})]}),pG=()=>{const{type:t,entityId:e}=Va(),r=()=>{const n=t?.toLowerCase();switch(n){case"character":case"entidadindividual":return m.jsx(cG,{id:e});case"location":case"zona":return m.jsx(n5,{id:e});case"culture":case"entidadcolectiva":return m.jsx(dG,{id:e});case"universe":case"galaxy":case"system":return m.jsx(hG,{id:e,type:n});case"planet":return m.jsx(fG,{id:e});case"construccion":return m.jsx(n5,{id:e});case"efectos":return m.jsxs("div",{className:"p-8 text-white",children:["Effect/Spell View for ID: ",e]});case"interaccion":return m.jsxs("div",{className:"p-8 text-white",children:["Interaction/Event View for ID: ",e]});case"magic":return m.jsxs("div",{className:"p-8 text-white",children:["Magic System View for ID: ",id]});default:return m.jsxs("div",{className:"p-8 text-white",children:["Unknown Entity Type: ",t]})}};return m.jsx("div",{className:"flex-1 bg-background-dark overflow-hidden",children:r()})},mG=()=>{const{t}=Ps(),{setRightPanelTab:e,setRightOpen:r,setRightPanelTitle:n,setRightPanelMode:i}=bo(),[a,s]=ie.useState([]),[o,l]=ie.useState(null),[u,c]=ie.useState([]),[h,p]=ie.useState(!0),[g,y]=ie.useState(!1),[S,w]=ie.useState(!1),[C,_]=ie.useState({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:0}),[T,N]=ie.useState({nombre:"",descripcion:""}),[R,I]=ie.useState(null),[j,O]=ie.useState(null),[F,z]=ie.useState(null),[V,q]=ie.useState([]),[D,U]=ie.useState(""),[G,Z]=ie.useState([]),[K,Q]=ie.useState("eventos");u.find(Ne=>Ne.id===F);const[ne,te]=ie.useState(null),X=ir.useRef(!1);ie.useEffect(()=>{e&&e("CONTEXT");const Ne=setInterval(()=>{const qe=document.getElementById("global-right-panel-portal");qe&&(te(qe),clearInterval(Ne))},50);return()=>{console.log("[TimelineView] Cleanup: unmounting, clearing portal"),clearInterval(Ne);const qe=document.getElementById("global-right-panel-portal");qe?(console.log("[TimelineView] Portal found, clearing innerHTML"),qe.innerHTML=""):console.log("[TimelineView] Portal NOT found"),n&&n(null),e&&e("NOTEBOOKS")}},[e]);const[re,he]=ie.useState([]),[oe,se]=ie.useState(null);ie.useEffect(()=>{X.current||(X.current=!0,ae())},[]);const fe=Ne=>{n(m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{children:t("timeline.title").toUpperCase()}),Ne&&m.jsx("span",{className:"text-[10px] text-slate-400 font-medium normal-case tracking-normal mt-0.5",children:Ne})]}))};ie.useEffect(()=>{if(K==="eventos"||K==="anexos")if(o){const qe=re.flatMap(bt=>bt.lineasTemporales||[]).find(bt=>bt.id===o);fe(qe?.nombre)}else fe(null);else K==="universo"&&n(t("timeline.multiverse"))},[o,K,re]);const ae=async()=>{try{const Ne=await Ke.get("/multiverso/list");if(he(Ne),!o&&Ne.length>0){const qe=Ne[0];qe.lineasTemporales&&qe.lineasTemporales.length>0&&l(qe.lineasTemporales[0].id)}}catch(Ne){console.error("Failed to load multiverse",Ne)}};ie.useEffect(()=>{o?pe(o):c([])},[o]);const pe=async Ne=>{try{const qe=await Ke.get(`/timeline/linea/${Ne}/eventos`);qe.sort((bt,at)=>(bt.ordenAbsoluto||0)-(at.ordenAbsoluto||0)),c(qe)}catch(qe){console.error("Failed to load events",qe)}},ye=async()=>{if(!o||!C.nombre)return;const Ne={...C,ordenAbsoluto:parseInt(C.ordenAbsoluto)||0};try{R?await Ke.put(`/timeline/evento/${R.id}`,{...Ne,lineaTiempo:{id:o}}):await Ke.post("/timeline/evento",{...Ne,lineaTiempo:{id:o}}),_({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:0}),I(null),pe(o)}catch(qe){console.error(qe)}},ve=Ne=>{I(Ne),z(Ne.id),_({nombre:Ne.nombre,descripcion:Ne.descripcion,fechaTexto:Ne.fechaTexto,ordenAbsoluto:Ne.ordenAbsoluto||0}),Q("eventos"),r(!0),ue(Ne.id)},ue=async Ne=>{try{const bt=(await Ke.get("/bd/relacion")).filter(Fe=>Fe.idOrigen===Ne&&Fe.tipoOrigen==="evento"||Fe.idDestino===Ne&&Fe.tipoDestino==="evento"),at=await Ke.get("/world-bible/entities"),ut=bt.map(Fe=>{const de=Fe.idOrigen===Ne?Fe.idDestino:Fe.idOrigen,ge=at.find(ke=>ke.id===de);return ge?{...ge,relId:Fe.id}:null}).filter(Boolean);q(ut)}catch(qe){console.error(qe)}},xe=async Ne=>{if(U(Ne),Ne.length<2){Z([]);return}try{const bt=(await Ke.get("/world-bible/entities")).filter(at=>at.nombre.toLowerCase().includes(Ne.toLowerCase())&&at.tipoEspecial!=="map"&&at.tipoEspecial!=="timeline").slice(0,5);Z(bt)}catch(qe){console.error(qe)}},Se=async Ne=>{if(F)try{await Ke.put("/bd/insertar",{tipoEntidad:"relacion",tipoOrigen:"evento",idOrigen:F,tipoDestino:"entidad",idDestino:Ne.id,descripcion:"Anexo de evento"}),U(""),Z([]),ue(F)}catch(qe){console.error(qe)}},Oe=async Ne=>{try{await Ke.delete(`/bd/relacion/${Ne}`),ue(F)}catch(qe){console.error(qe)}},Ae=async()=>{if(!(!T.nombre||!T.universoId))try{const Ne=await Ke.post("/timeline/linea",{...T,esRaiz:!1,universo:{id:T.universoId}});w(!1),N({nombre:"",descripcion:"",universoId:null}),await ae(),l(Ne.id)}catch(Ne){console.error("Error creating timeline:",Ne)}},[tt,rt]=ie.useState({nombre:"",descripcion:""}),dt=async()=>{if(tt.nombre)try{const Ne=await Ke.post("/multiverso/crear",tt);rt({nombre:"",descripcion:""}),r(!1),await ae()}catch(Ne){console.error("Error creating universe",Ne)}},_t=async()=>{if(oe)try{await Ke.put(`/multiverso/${oe}`,{nombre:tt.nombre,descripcion:tt.descripcion}),r(!1),await ae()}catch(Ne){console.error("Error updating universe",Ne)}},Xe=async()=>{if(oe&&window.confirm(t("timeline.delete_universe_confirm")))try{await Ke.delete(`/multiverso/${oe}`),r(!1),se(null),await ae()}catch(Ne){console.error("Error deleting universe",Ne)}};ie.useEffect(()=>{if(K==="universe-create")rt({nombre:"",descripcion:""});else if(K==="universe-edit"&&oe){const Ne=re.find(qe=>qe.id===oe);Ne&&rt({nombre:Ne.nombre,descripcion:Ne.descripcion||""})}},[K,oe,re]);const[ht,ct]=ie.useState({open:!1,type:null,id:null,title:"",message:""}),vt=(Ne,qe)=>{qe.stopPropagation(),ct({open:!0,type:"TIMELINE",id:Ne,title:t("timeline.delete_line"),message:t("bible.delete_folder_msg")})},lt=(Ne,qe)=>{qe.stopPropagation(),ct({open:!0,type:"EVENT",id:Ne,title:t("timeline.delete_event"),message:t("common.are_you_sure")})},Lt=async()=>{const{type:Ne,id:qe}=ht;if(!(!Ne||!qe))try{if(Ne==="TIMELINE"){if(await Ke.delete(`/timeline/linea/${qe}`),o===qe){const at=re.flatMap(ut=>ut.lineasTemporales||[]).filter(ut=>ut.id!==qe);l(at.length>0?at[0].id:null)}await ae()}else Ne==="EVENT"&&(await Ke.delete(`/timeline/evento/${qe}`),pe(o),R&&R.id===qe&&I(null))}catch(bt){console.error(bt),alert(t("common.error_delete"))}},jt=m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"p-4 border-b border-white/5",children:m.jsxs("div",{className:"flex bg-black/40 rounded-lg p-1 overflow-x-auto gap-1",children:[m.jsx("button",{onClick:()=>Q("eventos"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${K==="eventos"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:t("timeline.events_tab")}),m.jsx("button",{onClick:()=>Q("anexos"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${K==="anexos"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:t("timeline.annexes_tab")}),m.jsx("button",{onClick:()=>Q("universo"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${K==="universo"?"bg-amber-600 text-white shadow-lg":"text-slate-500 hover:text-amber-500/80"}`,children:t("timeline.multiverse")})]})}),m.jsxs("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:[K==="eventos"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsxs("h3",{className:"text-xs font-black uppercase text-primary mb-4 flex items-center justify-between",children:[t(R?"timeline.edit_event":"timeline.add_event"),R&&m.jsx("button",{onClick:()=>{I(null),_({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:u.length+1})},className:"text-[10px] text-slate-500 hover:text-white underline",children:t("common.cancel").toUpperCase()})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.event_name")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:C.nombre,onChange:Ne=>_({...C,nombre:Ne.target.value}),placeholder:t("timeline.event_name")})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.date_label")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:C.fechaTexto,onChange:Ne=>_({...C,fechaTexto:Ne.target.value}),placeholder:"e.g. Year 500"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.order")}),m.jsx("input",{type:"text",className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:C.ordenAbsoluto,onChange:Ne=>{const qe=Ne.target.value;/^[-+]?\d*$/.test(qe)&&_({...C,ordenAbsoluto:qe})},placeholder:"+/- Num"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.description")}),m.jsx("textarea",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary h-24 resize-none",value:C.descripcion,onChange:Ne=>_({...C,descripcion:Ne.target.value}),placeholder:t("timeline.description")})]}),m.jsx("div",{className:"pt-2",children:m.jsx(Dn,{variant:"primary",onClick:ye,className:"w-full justify-center",children:t(R?"timeline.save_changes":"timeline.create_event")})}),R&&m.jsx("button",{onClick:Ne=>lt(R.id,Ne),className:"w-full text-center text-xs text-red-500 hover:text-red-400 py-2 border border-red-500/20 rounded-lg hover:bg-red-500/10 transition-colors",children:t("timeline.delete_event_btn")})]})]})}),K==="anexos"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:F?m.jsx("div",{className:"space-y-6",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsx("h3",{className:"text-xs font-black uppercase text-primary mb-4",children:"Anexar Entidades"}),m.jsxs("div",{className:"relative mb-4",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-sm",children:"search"}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg pl-9 pr-4 py-2 text-xs text-white outline-none focus:border-primary",placeholder:"Buscar personaje, lugar...",value:D,onChange:Ne=>xe(Ne.target.value)}),G.length>0&&m.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-surface-dark border border-white/10 rounded-xl shadow-2xl z-50 overflow-hidden",children:G.map(Ne=>m.jsxs("button",{onClick:()=>Se(Ne),className:"w-full px-4 py-2 hover:bg-primary/20 text-left text-[10px] font-bold text-white/70 hover:text-white flex items-center justify-between",children:[m.jsx("span",{children:Ne.nombre}),m.jsx("span",{className:"text-[8px] opacity-40 uppercase",children:Ne.categoria})]},Ne.id))})]}),m.jsxs("div",{className:"space-y-2",children:[V.map(Ne=>m.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/5 rounded-lg border border-white/5 group",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-xs text-primary/50",children:"link"}),m.jsx("span",{className:"text-xs font-bold text-slate-300",children:Ne.nombre})]}),m.jsx("button",{onClick:()=>Oe(Ne.relId),className:"opacity-0 group-hover:opacity-100 text-slate-500 hover:text-red-500 transition-opacity",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"link_off"})})]},Ne.id)),V.length===0&&m.jsx("p",{className:"text-[10px] text-slate-600 italic",children:"No hay entidades anexadas a este evento."})]})]})}):m.jsx("div",{className:"p-10 text-center opacity-30 italic text-xs",children:"Selecciona un evento para ver sus anexos."})}),K==="universo"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsx("h3",{className:"text-xs font-black uppercase text-amber-500 mb-4",children:t(oe?"timeline.universe_settings":"timeline.new_universe")}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.universe_name")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:tt.nombre,onChange:Ne=>rt({...tt,nombre:Ne.target.value}),placeholder:"e.g. Alternate Reality 1"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:"Description"}),m.jsx("textarea",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary h-24 resize-none",value:tt.descripcion,onChange:Ne=>rt({...tt,descripcion:Ne.target.value}),placeholder:t("timeline.universe_desc")})]}),m.jsx("div",{className:"pt-2",children:m.jsx(Dn,{variant:"primary",onClick:oe?_t:dt,className:"w-full justify-center",children:t(oe?"common.save":"common.create")})}),oe&&m.jsx("button",{onClick:Xe,className:"w-full text-center text-xs text-red-500 hover:text-red-400 py-2 border border-red-500/20 rounded-lg hover:bg-red-500/10 transition-colors",children:t("common.delete")})]})]})})]})]});return m.jsxs("div",{className:"flex h-screen bg-background-dark text-white overflow-hidden",children:[ne&&eo.createPortal(jt,ne),m.jsxs("aside",{className:"w-64 bg-surface-dark border-r border-white/5 flex flex-col p-4 z-20 shrink-0",children:[m.jsxs("header",{className:"flex justify-between items-center mb-6",children:[m.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-primary",children:t("timeline.multiverse")}),m.jsx("button",{onClick:()=>{i("CUSTOM"),Q("universo"),se(null),rt({nombre:"",descripcion:""}),r(!0)},className:"text-slate-400 hover:text-white",title:"New Universe",children:m.jsx("span",{className:"material-symbols-outlined",children:"add_circle"})})]}),m.jsx("div",{className:"space-y-6 overflow-y-auto flex-1 custom-scrollbar",children:re.map(Ne=>m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center justify-between group",children:[m.jsx("h3",{className:`text-[10px] font-bold uppercase pl-2 cursor-pointer ${oe===Ne.id?"text-white":"text-slate-500"}`,onClick:()=>{se(Ne.id),rt({nombre:Ne.nombre,descripcion:Ne.descripcion||""}),Q("universo"),i("CUSTOM"),r(!0)},children:Ne.nombre}),m.jsx("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:m.jsx("button",{onClick:()=>{N({...T,universoId:Ne.id}),w(!0)},className:"text-slate-500 hover:text-primary",title:"Add Timeline here",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})})]}),S&&T.universoId===Ne.id&&m.jsxs("div",{className:"ml-2 mb-2 p-2 bg-black/20 rounded-lg animate-in fade-in",children:[m.jsx("input",{className:"w-full bg-transparent border-b border-white/20 text-xs p-1 outline-none focus:border-primary mb-1",placeholder:"Timeline Name",value:T.nombre,onChange:qe=>N({...T,nombre:qe.target.value}),autoFocus:!0,onKeyDown:qe=>qe.key==="Enter"&&Ae()}),m.jsxs("div",{className:"flex justify-end gap-1",children:[m.jsx("button",{onClick:()=>w(!1),className:"text-[10px] text-slate-500 hover:text-white",children:t("common.cancel").toUpperCase()}),m.jsx("button",{onClick:Ae,className:"text-[10px] font-bold text-primary",children:t("common.create").toUpperCase()})]})]}),m.jsxs("div",{className:"space-y-1 pl-2 border-l border-white/5 ml-1",children:[Ne.lineasTemporales&&Ne.lineasTemporales.map(qe=>m.jsxs("div",{onClick:()=>{l(qe.id),Q("eventos"),i("CUSTOM"),r(!0)},className:`group flex items-center justify-between p-2 rounded-lg cursor-pointer transition-all ${o===qe.id?"bg-primary/10 text-white shadow-[0_0_10px_rgba(var(--primary-rgb),0.1)]":"text-slate-400 hover:bg-white/5"}`,children:[m.jsx("span",{className:"text-xs truncate",children:qe.nombre}),m.jsx("button",{onClick:bt=>vt(qe.id,bt),className:"opacity-0 group-hover:opacity-100 text-slate-500 hover:text-red-500 transition-opacity",children:m.jsx("span",{className:"material-symbols-outlined text-[10px]",children:"delete"})})]},qe.id)),(!Ne.lineasTemporales||Ne.lineasTemporales.length===0)&&m.jsx("div",{className:"p-2 text-[10px] italic text-slate-600",children:t("timeline.no_timelines")})]})]},Ne.id))})]}),m.jsxs("main",{className:"flex-1 relative flex flex-col h-full overflow-hidden bg-background-dark",children:[m.jsx("div",{className:"h-16 border-b border-white/5 bg-background-dark/80 backdrop-blur flex items-center px-8 z-10 shrink-0",children:m.jsx("div",{children:(()=>{const qe=re.flatMap(bt=>bt.lineasTemporales||[]).find(bt=>bt.id===o);return m.jsxs(m.Fragment,{children:[m.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[qe?.esRaiz&&m.jsx("span",{className:"text-amber-400 material-symbols-outlined",children:"star"}),qe?.nombre||t("timeline.select_timeline")]}),m.jsx("p",{className:"text-xs text-slate-500",children:qe?.descripcion})]})})()})}),m.jsx("div",{className:"flex-1 overflow-y-auto p-8 relative custom-scrollbar z-10",children:m.jsxs("div",{className:"max-w-2xl mx-auto relative pl-8 border-l-2 border-white/10 space-y-8 pb-32",children:[u.length===0&&m.jsx("div",{className:"text-center text-slate-600 italic py-20",children:t("timeline.no_events")}),u.map((Ne,qe)=>m.jsxs("div",{className:"relative group animate-in fade-in slide-in-from-bottom-4",style:{animationDelay:`${qe*50}ms`},children:[m.jsx("div",{className:"absolute top-6 -left-[41px] size-4 rounded-full bg-white/20 border-4 border-background-dark group-hover:bg-primary transition-colors cursor-pointer",onClick:()=>ve(Ne)}),m.jsxs("div",{className:`ml-4 bg-surface-dark/50 border border-white/5 p-5 rounded-2xl hover:border-primary/30 transition-all hover:bg-surface-dark group-hover:translate-x-1 duration-300 relative group/card ${F===Ne.id?"ring-2 ring-primary border-primary/50 bg-primary/5":""}`,children:[m.jsxs("div",{className:"absolute top-3 right-3 opacity-0 group-hover/card:opacity-100 transition-opacity flex gap-1 bg-black/50 rounded-lg backdrop-blur-sm border border-white/5 p-1",children:[m.jsx("button",{onClick:()=>ve(Ne),className:"p-1.5 text-slate-400 hover:text-white hover:bg-white/10 rounded transition-colors",title:"Edit",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),m.jsx("button",{onClick:bt=>lt(Ne.id,bt),className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-500/10 rounded transition-colors",title:"Delete",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsx("div",{className:"flex justify-between items-start",onClick:()=>ve(Ne),children:m.jsxs("div",{className:"cursor-pointer",children:[m.jsxs("div",{className:"flex flex-col mb-1",children:[m.jsx("h3",{className:"text-lg font-bold text-white",children:Ne.nombre}),m.jsx("span",{className:"text-xs font-mono font-bold text-primary opacity-80",children:Ne.fechaTexto})]}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:Ne.descripcion})]})})]})]},Ne.id))]})})]}),m.jsx(qv,{isOpen:ht.open,onClose:()=>ct({...ht,open:!1}),onConfirm:Lt,title:ht.title,message:ht.message,confirmText:t("common.delete"),type:"danger"})]})},gG=({onCancel:t,onCreate:e})=>{const[r,n]=ie.useState(1),[i,a]=ie.useState("regional"),[s,o]=ie.useState("upload"),[l,u]=ie.useState(null),[c,h]=ie.useState(""),p=ir.useRef(null),g=w=>{const C=w.target.files?.[0];C&&C.type.startsWith("image/")&&(u(C),o("upload"))},y=()=>{p.current?.click()},S=()=>{e(s,c||"Nuevo Mapa",l)};return m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-background-dark/80 backdrop-blur-xl animate-in fade-in duration-300",children:m.jsx("div",{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto no-scrollbar relative animate-in zoom-in-95 duration-500",children:m.jsxs(ti,{className:"p-0 border-white/10 shadow-[0_0_100px_rgba(0,0,0,0.5)] overflow-hidden",children:[m.jsxs("header",{className:"p-8 border-b border-white/5 flex justify-between items-center bg-white/[0.02]",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-12 rounded-2xl bg-primary/20 text-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:"add_location_alt"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl font-manrope font-black text-white tracking-tight",children:"Crear Nuevo Mapa / Zona"}),m.jsx("p",{className:"text-xs text-slate-500 font-medium",children:"Configura los detalles para tu nueva entrada cartogrfica."})]})]}),m.jsx("button",{onClick:t,className:"text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsxs("div",{className:"p-12 space-y-12",children:[m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===1?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"1"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Identidad y Jerarqua"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 pl-12",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Nombre del Mapa"}),m.jsx("input",{type:"text",placeholder:"ej. La Costa de Zafiro",value:c,onChange:w=>h(w.target.value),className:"w-full bg-white/5 border border-white/5 rounded-2xl px-4 py-3 text-sm text-white focus:border-primary/50 transition-all outline-none"})]}),m.jsxs("div",{className:"space-y-1.5 row-span-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Descripcin"}),m.jsx("textarea",{placeholder:"Breve descripcin de la geografa, clima o importancia...",className:"w-full h-[120px] bg-white/5 border border-white/5 rounded-2xl p-4 text-sm text-white focus:border-primary/50 outline-none transition-all resize-none"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Zona Padre (Opcional)"}),m.jsxs("select",{className:"w-full bg-[#1a1a20] border border-white/5 rounded-2xl px-4 py-3 text-sm text-white focus:border-primary/50 outline-none appearance-none",children:[m.jsx("option",{className:"bg-[#1a1a20] text-white",children:"Ninguna (Nivel Superior)"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",children:"Reino de Aethelgard"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",children:"Continente de Aurum"})]}),m.jsx("p",{className:"text-[9px] text-slate-500 italic mt-1 ml-1 text-primary/70",children:"Seleccionar un padre convierte esto en sub-zona."})]})]})]}),m.jsx("div",{className:"h-px w-full bg-white/5"}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===2?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"2"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Tipo de Mapa"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 pl-12",children:[m.jsx(S2,{active:i==="world",onClick:()=>a("world"),icon:"public",label:"Mapa Mundial",desc:"Continentes, ocanos, escala global."}),m.jsx(S2,{active:i==="regional",onClick:()=>a("regional"),icon:"map",label:"Mapa Regional",desc:"Reinos, provincias, biomas."}),m.jsx(S2,{active:i==="local",onClick:()=>a("local"),icon:"location_city",label:"Ciudad / Local",desc:"Ciudades, mazmorras, mapas de batalla."})]})]}),m.jsx("div",{className:"h-px w-full bg-white/5"}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===3?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"3"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Fuente del Lienzo"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pl-12",children:[m.jsx("input",{ref:p,type:"file",accept:"image/*",onChange:g,className:"hidden"}),m.jsx(i5,{active:s==="upload",onClick:y,icon:"cloud_upload",label:l?l.name:"Cargar Archivo de Imagen",desc:l?"Archivo seleccionado":"Arrastra y suelta o haz clic para buscar",subdesc:"JPG, PNG, WEBP  MAX 25MB"}),m.jsx(i5,{active:s==="blank",onClick:()=>o("blank"),icon:"brush",label:"Lienzo en Blanco",desc:"Crear un nuevo dibujo desde cero",subdesc:"4096 px x 4096 px"})]})]})]}),m.jsxs("footer",{className:"p-8 bg-white/[0.02] border-t border-white/5 flex justify-between items-center",children:[m.jsx("button",{onClick:t,className:"text-sm font-bold text-slate-500 hover:text-white transition-colors",children:"Cancelar"}),m.jsxs("div",{className:"flex items-center gap-6",children:[m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-slate-600",children:"Cambios guardados localmente"}),m.jsx(Dn,{variant:"primary",className:"px-10 py-3 shadow-xl",onClick:S,children:"Crear Mapa"})]})]})]})})})},S2=({active:t,onClick:e,icon:r,label:n,desc:i})=>m.jsxs("div",{onClick:e,className:`p-6 rounded-3xl border transition-all cursor-pointer group ${t?"bg-primary/10 border-primary shadow-lg shadow-primary/10":"bg-white/5 border-white/5 hover:border-white/10"}`,children:[m.jsx("div",{className:`size-10 rounded-xl mb-4 flex items-center justify-center transition-all ${t?"bg-primary text-white":"bg-white/5 text-slate-500 group-hover:text-slate-300"}`,children:m.jsx("span",{className:"material-symbols-outlined",children:r})}),m.jsx("h3",{className:`text-sm font-bold mb-1 transition-colors ${t?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:n}),m.jsx("p",{className:"text-[10px] text-slate-500 leading-relaxed font-medium",children:i})]}),i5=({active:t,onClick:e,icon:r,label:n,desc:i,subdesc:a})=>m.jsxs("div",{onClick:e,className:`p-10 rounded-[2.5rem] border transition-all cursor-pointer group flex flex-col items-center text-center gap-4 ${t?"bg-primary/5 border-primary shadow-lg":"bg-white/[0.02] border-white/5 hover:border-white/10 hover:bg-white/[0.04]"}`,children:[m.jsx("div",{className:`size-16 rounded-[2rem] flex items-center justify-center transition-all ${t?"bg-primary text-white shadow-xl shadow-primary/20":"bg-white/5 text-slate-600 group-hover:text-slate-400"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:r})}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("h3",{className:`font-bold transition-colors ${t?"text-white":"text-slate-400"}`,children:n}),m.jsx("p",{className:"text-xs text-slate-500 font-medium",children:i})]}),m.jsx("div",{className:"flex gap-2 mt-2",children:a.split("").map((s,o)=>m.jsx("span",{className:"px-2 py-1 rounded bg-black/20 text-[8px] font-black text-slate-600 tracking-tighter uppercase whitespace-nowrap",children:s.trim()},o))})]});var Wy={exports:{}},Xm={},k2={},_2={},a5;function Tr(){return a5||(a5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t._registerNode=t.Konva=t.glob=void 0;const e=Math.PI/180;function r(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}t.glob=typeof aE<"u"?aE:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},t.Konva={_global:t.glob,version:"9.3.16",isBrowser:r(),isUnminified:/param/.test((function(i){}).toString()),dblClickWindow:400,getAngle(i){return t.Konva.angleDeg?i*e:i},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return t.Konva.DD.isDragging},isTransforming(){var i;return(i=t.Konva.Transformer)===null||i===void 0?void 0:i.isTransforming()},isDragReady(){return!!t.Konva.DD.node},releaseCanvasOnDestroy:!0,document:t.glob.document,_injectGlobal(i){t.glob.Konva=i}};const n=i=>{t.Konva[i.prototype.getClassName()]=i};t._registerNode=n,t.Konva._injectGlobal(t.Konva)})(_2)),_2}var C2={},s5;function pi(){return s5||(s5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Util=t.Transform=void 0;const e=Tr();class r{constructor(N=[1,0,0,1,0,0]){this.dirty=!1,this.m=N&&N.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new r(this.m)}copyInto(N){N.m[0]=this.m[0],N.m[1]=this.m[1],N.m[2]=this.m[2],N.m[3]=this.m[3],N.m[4]=this.m[4],N.m[5]=this.m[5]}point(N){const R=this.m;return{x:R[0]*N.x+R[2]*N.y+R[4],y:R[1]*N.x+R[3]*N.y+R[5]}}translate(N,R){return this.m[4]+=this.m[0]*N+this.m[2]*R,this.m[5]+=this.m[1]*N+this.m[3]*R,this}scale(N,R){return this.m[0]*=N,this.m[1]*=N,this.m[2]*=R,this.m[3]*=R,this}rotate(N){const R=Math.cos(N),I=Math.sin(N),j=this.m[0]*R+this.m[2]*I,O=this.m[1]*R+this.m[3]*I,F=this.m[0]*-I+this.m[2]*R,z=this.m[1]*-I+this.m[3]*R;return this.m[0]=j,this.m[1]=O,this.m[2]=F,this.m[3]=z,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(N,R){const I=this.m[0]+this.m[2]*R,j=this.m[1]+this.m[3]*R,O=this.m[2]+this.m[0]*N,F=this.m[3]+this.m[1]*N;return this.m[0]=I,this.m[1]=j,this.m[2]=O,this.m[3]=F,this}multiply(N){const R=this.m[0]*N.m[0]+this.m[2]*N.m[1],I=this.m[1]*N.m[0]+this.m[3]*N.m[1],j=this.m[0]*N.m[2]+this.m[2]*N.m[3],O=this.m[1]*N.m[2]+this.m[3]*N.m[3],F=this.m[0]*N.m[4]+this.m[2]*N.m[5]+this.m[4],z=this.m[1]*N.m[4]+this.m[3]*N.m[5]+this.m[5];return this.m[0]=R,this.m[1]=I,this.m[2]=j,this.m[3]=O,this.m[4]=F,this.m[5]=z,this}invert(){const N=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),R=this.m[3]*N,I=-this.m[1]*N,j=-this.m[2]*N,O=this.m[0]*N,F=N*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),z=N*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=R,this.m[1]=I,this.m[2]=j,this.m[3]=O,this.m[4]=F,this.m[5]=z,this}getMatrix(){return this.m}decompose(){const N=this.m[0],R=this.m[1],I=this.m[2],j=this.m[3],O=this.m[4],F=this.m[5],z=N*j-R*I,V={x:O,y:F,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(N!=0||R!=0){const q=Math.sqrt(N*N+R*R);V.rotation=R>0?Math.acos(N/q):-Math.acos(N/q),V.scaleX=q,V.scaleY=z/q,V.skewX=(N*I+R*j)/z,V.skewY=0}else if(I!=0||j!=0){const q=Math.sqrt(I*I+j*j);V.rotation=Math.PI/2-(j>0?Math.acos(-I/q):-Math.acos(I/q)),V.scaleX=z/q,V.scaleY=q,V.skewX=0,V.skewY=(N*I+R*j)/z}return V.rotation=t.Util._getRotation(V.rotation),V}}t.Transform=r;let n="[object Array]",i="[object Number]",a="[object String]",s="[object Boolean]",o=Math.PI/180,l=180/Math.PI,u="#",c="",h="0",p="Konva warning: ",g="Konva error: ",y="rgb(",S={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},w=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,C=[];const _=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(T){setTimeout(T,60)};t.Util={_isElement(T){return!!(T&&T.nodeType==1)},_isFunction(T){return!!(T&&T.constructor&&T.call&&T.apply)},_isPlainObject(T){return!!T&&T.constructor===Object},_isArray(T){return Object.prototype.toString.call(T)===n},_isNumber(T){return Object.prototype.toString.call(T)===i&&!isNaN(T)&&isFinite(T)},_isString(T){return Object.prototype.toString.call(T)===a},_isBoolean(T){return Object.prototype.toString.call(T)===s},isObject(T){return T instanceof Object},isValidSelector(T){if(typeof T!="string")return!1;const N=T[0];return N==="#"||N==="."||N===N.toUpperCase()},_sign(T){return T===0||T>0?1:-1},requestAnimFrame(T){C.push(T),C.length===1&&_(function(){const N=C;C=[],N.forEach(function(R){R()})})},createCanvasElement(){const T=document.createElement("canvas");try{T.style=T.style||{}}catch{}return T},createImageElement(){return document.createElement("img")},_isInDocument(T){for(;T=T.parentNode;)if(T==document)return!0;return!1},_urlToImage(T,N){const R=t.Util.createImageElement();R.onload=function(){N(R)},R.src=T},_rgbToHex(T,N,R){return((1<<24)+(T<<16)+(N<<8)+R).toString(16).slice(1)},_hexToRgb(T){T=T.replace(u,c);const N=parseInt(T,16);return{r:N>>16&255,g:N>>8&255,b:N&255}},getRandomColor(){let T=(Math.random()*16777215<<0).toString(16);for(;T.length<6;)T=h+T;return u+T},getRGB(T){let N;return T in S?(N=S[T],{r:N[0],g:N[1],b:N[2]}):T[0]===u?this._hexToRgb(T.substring(1)):T.substr(0,4)===y?(N=w.exec(T.replace(/ /g,"")),{r:parseInt(N[1],10),g:parseInt(N[2],10),b:parseInt(N[3],10)}):{r:0,g:0,b:0}},colorToRGBA(T){return T=T||"black",t.Util._namedColorToRBA(T)||t.Util._hex3ColorToRGBA(T)||t.Util._hex4ColorToRGBA(T)||t.Util._hex6ColorToRGBA(T)||t.Util._hex8ColorToRGBA(T)||t.Util._rgbColorToRGBA(T)||t.Util._rgbaColorToRGBA(T)||t.Util._hslColorToRGBA(T)},_namedColorToRBA(T){const N=S[T.toLowerCase()];return N?{r:N[0],g:N[1],b:N[2],a:1}:null},_rgbColorToRGBA(T){if(T.indexOf("rgb(")===0){T=T.match(/rgb\(([^)]+)\)/)[1];const N=T.split(/ *, */).map(Number);return{r:N[0],g:N[1],b:N[2],a:1}}},_rgbaColorToRGBA(T){if(T.indexOf("rgba(")===0){T=T.match(/rgba\(([^)]+)\)/)[1];const N=T.split(/ *, */).map((R,I)=>R.slice(-1)==="%"?I===3?parseInt(R)/100:parseInt(R)/100*255:Number(R));return{r:N[0],g:N[1],b:N[2],a:N[3]}}},_hex8ColorToRGBA(T){if(T[0]==="#"&&T.length===9)return{r:parseInt(T.slice(1,3),16),g:parseInt(T.slice(3,5),16),b:parseInt(T.slice(5,7),16),a:parseInt(T.slice(7,9),16)/255}},_hex6ColorToRGBA(T){if(T[0]==="#"&&T.length===7)return{r:parseInt(T.slice(1,3),16),g:parseInt(T.slice(3,5),16),b:parseInt(T.slice(5,7),16),a:1}},_hex4ColorToRGBA(T){if(T[0]==="#"&&T.length===5)return{r:parseInt(T[1]+T[1],16),g:parseInt(T[2]+T[2],16),b:parseInt(T[3]+T[3],16),a:parseInt(T[4]+T[4],16)/255}},_hex3ColorToRGBA(T){if(T[0]==="#"&&T.length===4)return{r:parseInt(T[1]+T[1],16),g:parseInt(T[2]+T[2],16),b:parseInt(T[3]+T[3],16),a:1}},_hslColorToRGBA(T){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(T)){const[N,...R]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(T),I=Number(R[0])/360,j=Number(R[1])/100,O=Number(R[2])/100;let F,z,V;if(j===0)return V=O*255,{r:Math.round(V),g:Math.round(V),b:Math.round(V),a:1};O<.5?F=O*(1+j):F=O+j-O*j;const q=2*O-F,D=[0,0,0];for(let U=0;U<3;U++)z=I+1/3*-(U-1),z<0&&z++,z>1&&z--,6*z<1?V=q+(F-q)*6*z:2*z<1?V=F:3*z<2?V=q+(F-q)*(2/3-z)*6:V=q,D[U]=V*255;return{r:Math.round(D[0]),g:Math.round(D[1]),b:Math.round(D[2]),a:1}}},haveIntersection(T,N){return!(N.x>T.x+T.width||N.x+N.width<T.x||N.y>T.y+T.height||N.y+N.height<T.y)},cloneObject(T){const N={};for(const R in T)this._isPlainObject(T[R])?N[R]=this.cloneObject(T[R]):this._isArray(T[R])?N[R]=this.cloneArray(T[R]):N[R]=T[R];return N},cloneArray(T){return T.slice(0)},degToRad(T){return T*o},radToDeg(T){return T*l},_degToRad(T){return t.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),t.Util.degToRad(T)},_radToDeg(T){return t.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),t.Util.radToDeg(T)},_getRotation(T){return e.Konva.angleDeg?t.Util.radToDeg(T):T},_capitalize(T){return T.charAt(0).toUpperCase()+T.slice(1)},throw(T){throw new Error(g+T)},error(T){console.error(g+T)},warn(T){e.Konva.showWarnings&&console.warn(p+T)},each(T,N){for(const R in T)N(R,T[R])},_inRange(T,N,R){return N<=T&&T<R},_getProjectionToSegment(T,N,R,I,j,O){let F,z,V;const q=(T-R)*(T-R)+(N-I)*(N-I);if(q==0)F=T,z=N,V=(j-R)*(j-R)+(O-I)*(O-I);else{const D=((j-T)*(R-T)+(O-N)*(I-N))/q;D<0?(F=T,z=N,V=(T-j)*(T-j)+(N-O)*(N-O)):D>1?(F=R,z=I,V=(R-j)*(R-j)+(I-O)*(I-O)):(F=T+D*(R-T),z=N+D*(I-N),V=(F-j)*(F-j)+(z-O)*(z-O))}return[F,z,V]},_getProjectionToLine(T,N,R){const I=t.Util.cloneObject(T);let j=Number.MAX_VALUE;return N.forEach(function(O,F){if(!R&&F===N.length-1)return;const z=N[(F+1)%N.length],V=t.Util._getProjectionToSegment(O.x,O.y,z.x,z.y,T.x,T.y),q=V[0],D=V[1],U=V[2];U<j&&(I.x=q,I.y=D,j=U)}),I},_prepareArrayForTween(T,N,R){let I,j=[],O=[];if(T.length>N.length){const z=N;N=T,T=z}for(I=0;I<T.length;I+=2)j.push({x:T[I],y:T[I+1]});for(I=0;I<N.length;I+=2)O.push({x:N[I],y:N[I+1]});const F=[];return O.forEach(function(z){const V=t.Util._getProjectionToLine(z,j,R);F.push(V.x),F.push(V.y)}),F},_prepareToStringify(T){let N;T.visitedByCircularReferenceRemoval=!0;for(const R in T)if(T.hasOwnProperty(R)&&T[R]&&typeof T[R]=="object"){if(N=Object.getOwnPropertyDescriptor(T,R),T[R].visitedByCircularReferenceRemoval||t.Util._isElement(T[R]))if(N.configurable)delete T[R];else return null;else if(t.Util._prepareToStringify(T[R])===null)if(N.configurable)delete T[R];else return null}return delete T.visitedByCircularReferenceRemoval,T},_assign(T,N){for(const R in N)T[R]=N[R];return T},_getFirstPointerId(T){return T.touches?T.changedTouches[0].identifier:T.pointerId||999},releaseCanvas(...T){e.Konva.releaseCanvasOnDestroy&&T.forEach(N=>{N.width=0,N.height=0})},drawRoundedRectPath(T,N,R,I){let j=0,O=0,F=0,z=0;typeof I=="number"?j=O=F=z=Math.min(I,N/2,R/2):(j=Math.min(I[0]||0,N/2,R/2),O=Math.min(I[1]||0,N/2,R/2),z=Math.min(I[2]||0,N/2,R/2),F=Math.min(I[3]||0,N/2,R/2)),T.moveTo(j,0),T.lineTo(N-O,0),T.arc(N-O,O,O,Math.PI*3/2,0,!1),T.lineTo(N,R-z),T.arc(N-z,R-z,z,0,Math.PI/2,!1),T.lineTo(F,R),T.arc(F,R-F,F,Math.PI/2,Math.PI,!1),T.lineTo(0,j),T.arc(j,j,j,Math.PI,Math.PI*3/2,!1)}}})(C2)),C2}var Qm={},E2={},qs={},o5;function Dr(){if(o5)return qs;o5=1,Object.defineProperty(qs,"__esModule",{value:!0}),qs.RGBComponent=n,qs.alphaComponent=i,qs.getNumberValidator=a,qs.getNumberOrArrayOfNumbersValidator=s,qs.getNumberOrAutoValidator=o,qs.getStringValidator=l,qs.getStringOrGradientValidator=u,qs.getFunctionValidator=c,qs.getNumberArrayValidator=h,qs.getBooleanValidator=p,qs.getComponentValidator=g;const t=Tr(),e=pi();function r(y){return e.Util._isString(y)?'"'+y+'"':Object.prototype.toString.call(y)==="[object Number]"||e.Util._isBoolean(y)?y:Object.prototype.toString.call(y)}function n(y){return y>255?255:y<0?0:Math.round(y)}function i(y){return y>1?1:y<1e-4?1e-4:y}function a(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isNumber(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a number.'),y}}function s(y){if(t.Konva.isUnminified)return function(S,w){const C=e.Util._isNumber(S),_=e.Util._isArray(S)&&S.length==y;return!C&&!_&&e.Util.warn(r(S)+' is a not valid value for "'+w+'" attribute. The value should be a number or Array<number>('+y+")"),S}}function o(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isNumber(y)||y==="auto"||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a number or "auto".'),y}}function l(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isString(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a string.'),y}}function u(){if(t.Konva.isUnminified)return function(y,S){const w=e.Util._isString(y),C=Object.prototype.toString.call(y)==="[object CanvasGradient]"||y&&y.addColorStop;return w||C||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a string or a native gradient.'),y}}function c(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isFunction(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a function.'),y}}function h(){if(t.Konva.isUnminified)return function(y,S){const w=Int8Array?Object.getPrototypeOf(Int8Array):null;return w&&y instanceof w||(e.Util._isArray(y)?y.forEach(function(C){e.Util._isNumber(C)||e.Util.warn('"'+S+'" attribute has non numeric element '+C+". Make sure that all elements are numbers.")}):e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a array of numbers.')),y}}function p(){if(t.Konva.isUnminified)return function(y,S){return y===!0||y===!1||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a boolean.'),y}}function g(y){if(t.Konva.isUnminified)return function(S,w){return S==null||e.Util.isObject(S)||e.Util.warn(r(S)+' is a not valid value for "'+w+'" attribute. The value should be an object with properties '+y),S}}return qs}var l5;function Ar(){return l5||(l5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;const e=pi(),r=Dr(),n="get",i="set";t.Factory={addGetterSetter(a,s,o,l,u){t.Factory.addGetter(a,s,o),t.Factory.addSetter(a,s,l,u),t.Factory.addOverloadedGetterSetter(a,s)},addGetter(a,s,o){const l=n+e.Util._capitalize(s);a.prototype[l]=a.prototype[l]||function(){const u=this.attrs[s];return u===void 0?o:u}},addSetter(a,s,o,l){const u=i+e.Util._capitalize(s);a.prototype[u]||t.Factory.overWriteSetter(a,s,o,l)},overWriteSetter(a,s,o,l){const u=i+e.Util._capitalize(s);a.prototype[u]=function(c){return o&&c!==void 0&&c!==null&&(c=o.call(this,c,s)),this._setAttr(s,c),l&&l.call(this),this}},addComponentsGetterSetter(a,s,o,l,u){let c=o.length,h=e.Util._capitalize,p=n+h(s),g=i+h(s),y,S;a.prototype[p]=function(){const C={};for(y=0;y<c;y++)S=o[y],C[S]=this.getAttr(s+h(S));return C};const w=(0,r.getComponentValidator)(o);a.prototype[g]=function(C){let _=this.attrs[s],T;l&&(C=l.call(this,C)),w&&w.call(this,C,s);for(T in C)C.hasOwnProperty(T)&&this._setAttr(s+h(T),C[T]);return C||o.forEach(N=>{this._setAttr(s+h(N),void 0)}),this._fireChangeEvent(s,_,C),u&&u.call(this),this},t.Factory.addOverloadedGetterSetter(a,s)},addOverloadedGetterSetter(a,s){const o=e.Util._capitalize(s),l=i+o,u=n+o;a.prototype[s]=function(){return arguments.length?(this[l](arguments[0]),this):this[u]()}},addDeprecatedGetterSetter(a,s,o,l){e.Util.error("Adding deprecated "+s);const u=n+e.Util._capitalize(s),c=s+" property is deprecated and will be removed soon. Look at Konva change log for more information.";a.prototype[u]=function(){e.Util.error(c);const h=this.attrs[s];return h===void 0?o:h},t.Factory.addSetter(a,s,l,function(){e.Util.error(c)}),t.Factory.addOverloadedGetterSetter(a,s)},backCompat(a,s){e.Util.each(s,function(o,l){const u=a.prototype[l],c=n+e.Util._capitalize(o),h=i+e.Util._capitalize(o);function p(){u.apply(this,arguments),e.Util.error('"'+o+'" method is deprecated and will be removed soon. Use ""'+l+'" instead.')}a.prototype[o]=p,a.prototype[c]=p,a.prototype[h]=p})},afterSetFilter(){this._filterUpToDate=!1}}})(E2)),E2}var nc={},ic={},u5;function xL(){if(u5)return ic;u5=1,Object.defineProperty(ic,"__esModule",{value:!0}),ic.HitContext=ic.SceneContext=ic.Context=void 0;const t=pi(),e=Tr();function r(C){let _=[],T=C.length,N=t.Util,R,I;for(R=0;R<T;R++)I=C[R],N._isNumber(I)?I=Math.round(I*1e3)/1e3:N._isString(I)||(I=I+""),_.push(I);return _}const n=",",i="(",a=")",s="([",o="])",l=";",u="()",c="=",h=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],p=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],g=100;let y=class{constructor(_){this.canvas=_,e.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(_){_.fillEnabled()&&this._fill(_)}_fill(_){}strokeShape(_){_.hasStroke()&&this._stroke(_)}_stroke(_){}fillStrokeShape(_){_.attrs.fillAfterStrokeEnabled?(this.strokeShape(_),this.fillShape(_)):(this.fillShape(_),this.strokeShape(_))}getTrace(_,T){let N=this.traceArr,R=N.length,I="",j,O,F,z;for(j=0;j<R;j++)O=N[j],F=O.method,F?(z=O.args,I+=F,_?I+=u:t.Util._isArray(z[0])?I+=s+z.join(n)+o:(T&&(z=z.map(V=>typeof V=="number"?Math.floor(V):V)),I+=i+z.join(n)+a)):(I+=O.property,_||(I+=c+O.val)),I+=l;return I}clearTrace(){this.traceArr=[]}_trace(_){let T=this.traceArr,N;T.push(_),N=T.length,N>=g&&T.shift()}reset(){const _=this.getCanvas().getPixelRatio();this.setTransform(1*_,0,0,1*_,0,0)}getCanvas(){return this.canvas}clear(_){const T=this.getCanvas();_?this.clearRect(_.x||0,_.y||0,_.width||0,_.height||0):this.clearRect(0,0,T.getWidth()/T.pixelRatio,T.getHeight()/T.pixelRatio)}_applyLineCap(_){const T=_.attrs.lineCap;T&&this.setAttr("lineCap",T)}_applyOpacity(_){const T=_.getAbsoluteOpacity();T!==1&&this.setAttr("globalAlpha",T)}_applyLineJoin(_){const T=_.attrs.lineJoin;T&&this.setAttr("lineJoin",T)}setAttr(_,T){this._context[_]=T}arc(_,T,N,R,I,j){this._context.arc(_,T,N,R,I,j)}arcTo(_,T,N,R,I){this._context.arcTo(_,T,N,R,I)}beginPath(){this._context.beginPath()}bezierCurveTo(_,T,N,R,I,j){this._context.bezierCurveTo(_,T,N,R,I,j)}clearRect(_,T,N,R){this._context.clearRect(_,T,N,R)}clip(..._){this._context.clip.apply(this._context,_)}closePath(){this._context.closePath()}createImageData(_,T){const N=arguments;if(N.length===2)return this._context.createImageData(_,T);if(N.length===1)return this._context.createImageData(_)}createLinearGradient(_,T,N,R){return this._context.createLinearGradient(_,T,N,R)}createPattern(_,T){return this._context.createPattern(_,T)}createRadialGradient(_,T,N,R,I,j){return this._context.createRadialGradient(_,T,N,R,I,j)}drawImage(_,T,N,R,I,j,O,F,z){const V=arguments,q=this._context;V.length===3?q.drawImage(_,T,N):V.length===5?q.drawImage(_,T,N,R,I):V.length===9&&q.drawImage(_,T,N,R,I,j,O,F,z)}ellipse(_,T,N,R,I,j,O,F){this._context.ellipse(_,T,N,R,I,j,O,F)}isPointInPath(_,T,N,R){return N?this._context.isPointInPath(N,_,T,R):this._context.isPointInPath(_,T,R)}fill(..._){this._context.fill.apply(this._context,_)}fillRect(_,T,N,R){this._context.fillRect(_,T,N,R)}strokeRect(_,T,N,R){this._context.strokeRect(_,T,N,R)}fillText(_,T,N,R){R?this._context.fillText(_,T,N,R):this._context.fillText(_,T,N)}measureText(_){return this._context.measureText(_)}getImageData(_,T,N,R){return this._context.getImageData(_,T,N,R)}lineTo(_,T){this._context.lineTo(_,T)}moveTo(_,T){this._context.moveTo(_,T)}rect(_,T,N,R){this._context.rect(_,T,N,R)}roundRect(_,T,N,R,I){this._context.roundRect(_,T,N,R,I)}putImageData(_,T,N){this._context.putImageData(_,T,N)}quadraticCurveTo(_,T,N,R){this._context.quadraticCurveTo(_,T,N,R)}restore(){this._context.restore()}rotate(_){this._context.rotate(_)}save(){this._context.save()}scale(_,T){this._context.scale(_,T)}setLineDash(_){this._context.setLineDash?this._context.setLineDash(_):"mozDash"in this._context?this._context.mozDash=_:"webkitLineDash"in this._context&&(this._context.webkitLineDash=_)}getLineDash(){return this._context.getLineDash()}setTransform(_,T,N,R,I,j){this._context.setTransform(_,T,N,R,I,j)}stroke(_){_?this._context.stroke(_):this._context.stroke()}strokeText(_,T,N,R){this._context.strokeText(_,T,N,R)}transform(_,T,N,R,I,j){this._context.transform(_,T,N,R,I,j)}translate(_,T){this._context.translate(_,T)}_enableTrace(){let _=this,T=h.length,N=this.setAttr,R,I;const j=function(O){let F=_[O],z;_[O]=function(){return I=r(Array.prototype.slice.call(arguments,0)),z=F.apply(_,arguments),_._trace({method:O,args:I}),z}};for(R=0;R<T;R++)j(h[R]);_.setAttr=function(){N.apply(_,arguments);const O=arguments[0];let F=arguments[1];(O==="shadowOffsetX"||O==="shadowOffsetY"||O==="shadowBlur")&&(F=F/this.canvas.getPixelRatio()),_._trace({property:O,val:F})}}_applyGlobalCompositeOperation(_){const T=_.attrs.globalCompositeOperation;!T||T==="source-over"||this.setAttr("globalCompositeOperation",T)}};ic.Context=y,p.forEach(function(C){Object.defineProperty(y.prototype,C,{get(){return this._context[C]},set(_){this._context[C]=_}})});class S extends y{constructor(_,{willReadFrequently:T=!1}={}){super(_),this._context=_._canvas.getContext("2d",{willReadFrequently:T})}_fillColor(_){const T=_.fill();this.setAttr("fillStyle",T),_._fillFunc(this)}_fillPattern(_){this.setAttr("fillStyle",_._getFillPattern()),_._fillFunc(this)}_fillLinearGradient(_){const T=_._getLinearGradient();T&&(this.setAttr("fillStyle",T),_._fillFunc(this))}_fillRadialGradient(_){const T=_._getRadialGradient();T&&(this.setAttr("fillStyle",T),_._fillFunc(this))}_fill(_){const T=_.fill(),N=_.getFillPriority();if(T&&N==="color"){this._fillColor(_);return}const R=_.getFillPatternImage();if(R&&N==="pattern"){this._fillPattern(_);return}const I=_.getFillLinearGradientColorStops();if(I&&N==="linear-gradient"){this._fillLinearGradient(_);return}const j=_.getFillRadialGradientColorStops();if(j&&N==="radial-gradient"){this._fillRadialGradient(_);return}T?this._fillColor(_):R?this._fillPattern(_):I?this._fillLinearGradient(_):j&&this._fillRadialGradient(_)}_strokeLinearGradient(_){const T=_.getStrokeLinearGradientStartPoint(),N=_.getStrokeLinearGradientEndPoint(),R=_.getStrokeLinearGradientColorStops(),I=this.createLinearGradient(T.x,T.y,N.x,N.y);if(R){for(let j=0;j<R.length;j+=2)I.addColorStop(R[j],R[j+1]);this.setAttr("strokeStyle",I)}}_stroke(_){const T=_.dash(),N=_.getStrokeScaleEnabled();if(_.hasStroke()){if(!N){this.save();const I=this.getCanvas().getPixelRatio();this.setTransform(I,0,0,I,0,0)}this._applyLineCap(_),T&&_.dashEnabled()&&(this.setLineDash(T),this.setAttr("lineDashOffset",_.dashOffset())),this.setAttr("lineWidth",_.strokeWidth()),_.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),_.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(_):this.setAttr("strokeStyle",_.stroke()),_._strokeFunc(this),N||this.restore()}}_applyShadow(_){var T,N,R;const I=(T=_.getShadowRGBA())!==null&&T!==void 0?T:"black",j=(N=_.getShadowBlur())!==null&&N!==void 0?N:5,O=(R=_.getShadowOffset())!==null&&R!==void 0?R:{x:0,y:0},F=_.getAbsoluteScale(),z=this.canvas.getPixelRatio(),V=F.x*z,q=F.y*z;this.setAttr("shadowColor",I),this.setAttr("shadowBlur",j*Math.min(Math.abs(V),Math.abs(q))),this.setAttr("shadowOffsetX",O.x*V),this.setAttr("shadowOffsetY",O.y*q)}}ic.SceneContext=S;class w extends y{constructor(_){super(_),this._context=_._canvas.getContext("2d",{willReadFrequently:!0})}_fill(_){this.save(),this.setAttr("fillStyle",_.colorKey),_._fillFuncHit(this),this.restore()}strokeShape(_){_.hasHitStroke()&&this._stroke(_)}_stroke(_){if(_.hasHitStroke()){const T=_.getStrokeScaleEnabled();if(!T){this.save();const I=this.getCanvas().getPixelRatio();this.setTransform(I,0,0,I,0,0)}this._applyLineCap(_);const N=_.hitStrokeWidth(),R=N==="auto"?_.strokeWidth():N;this.setAttr("lineWidth",R),this.setAttr("strokeStyle",_.colorKey),_._strokeFuncHit(this),T||this.restore()}}}return ic.HitContext=w,ic}var c5;function F1(){if(c5)return nc;c5=1,Object.defineProperty(nc,"__esModule",{value:!0}),nc.HitCanvas=nc.SceneCanvas=nc.Canvas=void 0;const t=pi(),e=xL(),r=Tr(),n=Ar(),i=Dr();let a;function s(){if(a)return a;const c=t.Util.createCanvasElement(),h=c.getContext("2d");return a=(function(){const p=r.Konva._global.devicePixelRatio||1,g=h.webkitBackingStorePixelRatio||h.mozBackingStorePixelRatio||h.msBackingStorePixelRatio||h.oBackingStorePixelRatio||h.backingStorePixelRatio||1;return p/g})(),t.Util.releaseCanvas(c),a}let o=class{constructor(h){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const g=(h||{}).pixelRatio||r.Konva.pixelRatio||s();this.pixelRatio=g,this._canvas=t.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(h){const p=this.pixelRatio;this.pixelRatio=h,this.setSize(this.getWidth()/p,this.getHeight()/p)}setWidth(h){this.width=this._canvas.width=h*this.pixelRatio,this._canvas.style.width=h+"px";const p=this.pixelRatio;this.getContext()._context.scale(p,p)}setHeight(h){this.height=this._canvas.height=h*this.pixelRatio,this._canvas.style.height=h+"px";const p=this.pixelRatio;this.getContext()._context.scale(p,p)}getWidth(){return this.width}getHeight(){return this.height}setSize(h,p){this.setWidth(h||0),this.setHeight(p||0)}toDataURL(h,p){try{return this._canvas.toDataURL(h,p)}catch{try{return this._canvas.toDataURL()}catch(y){return t.Util.error("Unable to get data URL. "+y.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};nc.Canvas=o,n.Factory.addGetterSetter(o,"pixelRatio",void 0,(0,i.getNumberValidator)());class l extends o{constructor(h={width:0,height:0,willReadFrequently:!1}){super(h),this.context=new e.SceneContext(this,{willReadFrequently:h.willReadFrequently}),this.setSize(h.width,h.height)}}nc.SceneCanvas=l;class u extends o{constructor(h={width:0,height:0}){super(h),this.hitCanvas=!0,this.context=new e.HitContext(this),this.setSize(h.width,h.height)}}return nc.HitCanvas=u,nc}var T2={},d5;function w_(){return d5||(d5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DD=void 0;const e=Tr(),r=pi();t.DD={get isDragging(){let n=!1;return t.DD._dragElements.forEach(i=>{i.dragStatus==="dragging"&&(n=!0)}),n},justDragged:!1,get node(){let n;return t.DD._dragElements.forEach(i=>{n=i.node}),n},_dragElements:new Map,_drag(n){const i=[];t.DD._dragElements.forEach((a,s)=>{const{node:o}=a,l=o.getStage();l.setPointersPositions(n),a.pointerId===void 0&&(a.pointerId=r.Util._getFirstPointerId(n));const u=l._changedPointerPositions.find(c=>c.id===a.pointerId);if(u){if(a.dragStatus!=="dragging"){const c=o.dragDistance();if(Math.max(Math.abs(u.x-a.startPointerPos.x),Math.abs(u.y-a.startPointerPos.y))<c||(o.startDrag({evt:n}),!o.isDragging()))return}o._setDragPosition(n,a),i.push(o)}}),i.forEach(a=>{a.fire("dragmove",{type:"dragmove",target:a,evt:n},!0)})},_endDragBefore(n){const i=[];t.DD._dragElements.forEach(a=>{const{node:s}=a,o=s.getStage();if(n&&o.setPointersPositions(n),!o._changedPointerPositions.find(c=>c.id===a.pointerId))return;(a.dragStatus==="dragging"||a.dragStatus==="stopped")&&(t.DD.justDragged=!0,e.Konva._mouseListenClick=!1,e.Konva._touchListenClick=!1,e.Konva._pointerListenClick=!1,a.dragStatus="stopped");const u=a.node.getLayer()||a.node instanceof e.Konva.Stage&&a.node;u&&i.indexOf(u)===-1&&i.push(u)}),i.forEach(a=>{a.draw()})},_endDragAfter(n){t.DD._dragElements.forEach((i,a)=>{i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:n},!0),i.dragStatus!=="dragging"&&t.DD._dragElements.delete(a)})}},e.Konva.isBrowser&&(window.addEventListener("mouseup",t.DD._endDragBefore,!0),window.addEventListener("touchend",t.DD._endDragBefore,!0),window.addEventListener("touchcancel",t.DD._endDragBefore,!0),window.addEventListener("mousemove",t.DD._drag),window.addEventListener("touchmove",t.DD._drag),window.addEventListener("mouseup",t.DD._endDragAfter,!1),window.addEventListener("touchend",t.DD._endDragAfter,!1),window.addEventListener("touchcancel",t.DD._endDragAfter,!1))})(T2)),T2}var h5;function Ei(){if(h5)return Qm;h5=1,Object.defineProperty(Qm,"__esModule",{value:!0}),Qm.Node=void 0;const t=pi(),e=Ar(),r=F1(),n=Tr(),i=w_(),a=Dr(),s="absoluteOpacity",o="allEventListeners",l="absoluteTransform",u="absoluteScale",c="canvas",h="Change",p="children",g="konva",y="listening",S="mouseenter",w="mouseleave",C="set",_="Shape",T=" ",N="stage",R="transform",I="Stage",j="visible",O=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(T);let F=1;class z{constructor(D){this._id=F++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(D),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(D){(D===R||D===l)&&this._cache.get(D)?this._cache.get(D).dirty=!0:D?this._cache.delete(D):this._cache.clear()}_getCache(D,U){let G=this._cache.get(D);return(G===void 0||(D===R||D===l)&&G.dirty===!0)&&(G=U.call(this),this._cache.set(D,G)),G}_calculate(D,U,G){if(!this._attachedDepsListeners.get(D)){const Z=U.map(K=>K+"Change.konva").join(T);this.on(Z,()=>{this._clearCache(D)}),this._attachedDepsListeners.set(D,!0)}return this._getCache(D,G)}_getCanvasCache(){return this._cache.get(c)}_clearSelfAndDescendantCache(D){this._clearCache(D),D===l&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(c)){const{scene:D,filter:U,hit:G}=this._cache.get(c);t.Util.releaseCanvas(D,U,G),this._cache.delete(c)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(D){const U=D||{};let G={};(U.x===void 0||U.y===void 0||U.width===void 0||U.height===void 0)&&(G=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let Z=Math.ceil(U.width||G.width),K=Math.ceil(U.height||G.height),Q=U.pixelRatio,ne=U.x===void 0?Math.floor(G.x):U.x,te=U.y===void 0?Math.floor(G.y):U.y,X=U.offset||0,re=U.drawBorder||!1,he=U.hitCanvasPixelRatio||1;if(!Z||!K){t.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const oe=Math.abs(Math.round(G.x)-ne)>.5?1:0,se=Math.abs(Math.round(G.y)-te)>.5?1:0;Z+=X*2+oe,K+=X*2+se,ne-=X,te-=X;const fe=new r.SceneCanvas({pixelRatio:Q,width:Z,height:K}),ae=new r.SceneCanvas({pixelRatio:Q,width:0,height:0,willReadFrequently:!0}),pe=new r.HitCanvas({pixelRatio:he,width:Z,height:K}),ye=fe.getContext(),ve=pe.getContext();return pe.isCache=!0,fe.isCache=!0,this._cache.delete(c),this._filterUpToDate=!1,U.imageSmoothingEnabled===!1&&(fe.getContext()._context.imageSmoothingEnabled=!1,ae.getContext()._context.imageSmoothingEnabled=!1),ye.save(),ve.save(),ye.translate(-ne,-te),ve.translate(-ne,-te),this._isUnderCache=!0,this._clearSelfAndDescendantCache(s),this._clearSelfAndDescendantCache(u),this.drawScene(fe,this),this.drawHit(pe,this),this._isUnderCache=!1,ye.restore(),ve.restore(),re&&(ye.save(),ye.beginPath(),ye.rect(0,0,Z,K),ye.closePath(),ye.setAttr("strokeStyle","red"),ye.setAttr("lineWidth",5),ye.stroke(),ye.restore()),this._cache.set(c,{scene:fe,filter:ae,hit:pe,x:ne,y:te}),this._requestDraw(),this}isCached(){return this._cache.has(c)}getClientRect(D){throw new Error('abstract "getClientRect" method call')}_transformedRect(D,U){const G=[{x:D.x,y:D.y},{x:D.x+D.width,y:D.y},{x:D.x+D.width,y:D.y+D.height},{x:D.x,y:D.y+D.height}];let Z=1/0,K=1/0,Q=-1/0,ne=-1/0;const te=this.getAbsoluteTransform(U);return G.forEach(function(X){const re=te.point(X);Z===void 0&&(Z=Q=re.x,K=ne=re.y),Z=Math.min(Z,re.x),K=Math.min(K,re.y),Q=Math.max(Q,re.x),ne=Math.max(ne,re.y)}),{x:Z,y:K,width:Q-Z,height:ne-K}}_drawCachedSceneCanvas(D){D.save(),D._applyOpacity(this),D._applyGlobalCompositeOperation(this);const U=this._getCanvasCache();D.translate(U.x,U.y);const G=this._getCachedSceneCanvas(),Z=G.pixelRatio;D.drawImage(G._canvas,0,0,G.width/Z,G.height/Z),D.restore()}_drawCachedHitCanvas(D){const U=this._getCanvasCache(),G=U.hit;D.save(),D.translate(U.x,U.y),D.drawImage(G._canvas,0,0,G.width/G.pixelRatio,G.height/G.pixelRatio),D.restore()}_getCachedSceneCanvas(){let D=this.filters(),U=this._getCanvasCache(),G=U.scene,Z=U.filter,K=Z.getContext(),Q,ne,te,X;if(D){if(!this._filterUpToDate){const re=G.pixelRatio;Z.setSize(G.width/G.pixelRatio,G.height/G.pixelRatio);try{for(Q=D.length,K.clear(),K.drawImage(G._canvas,0,0,G.getWidth()/re,G.getHeight()/re),ne=K.getImageData(0,0,Z.getWidth(),Z.getHeight()),te=0;te<Q;te++){if(X=D[te],typeof X!="function"){t.Util.error("Filter should be type of function, but got "+typeof X+" instead. Please check correct filters");continue}X.call(this,ne),K.putImageData(ne,0,0)}}catch(he){t.Util.error("Unable to apply filter. "+he.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return Z}return G}on(D,U){if(this._cache&&this._cache.delete(o),arguments.length===3)return this._delegate.apply(this,arguments);let G=D.split(T),Z=G.length,K,Q,ne,te,X;for(K=0;K<Z;K++)Q=G[K],ne=Q.split("."),te=ne[0],X=ne[1]||"",this.eventListeners[te]||(this.eventListeners[te]=[]),this.eventListeners[te].push({name:X,handler:U});return this}off(D,U){let G=(D||"").split(T),Z=G.length,K,Q,ne,te,X,re;if(this._cache&&this._cache.delete(o),!D)for(Q in this.eventListeners)this._off(Q);for(K=0;K<Z;K++)if(ne=G[K],te=ne.split("."),X=te[0],re=te[1],X)this.eventListeners[X]&&this._off(X,re,U);else for(Q in this.eventListeners)this._off(Q,re,U);return this}dispatchEvent(D){const U={target:this,type:D.type,evt:D};return this.fire(D.type,U),this}addEventListener(D,U){return this.on(D,function(G){U.call(this,G.evt)}),this}removeEventListener(D){return this.off(D),this}_delegate(D,U,G){const Z=this;this.on(D,function(K){const Q=K.target.findAncestors(U,!0,Z);for(let ne=0;ne<Q.length;ne++)K=t.Util.cloneObject(K),K.currentTarget=Q[ne],G.call(Q[ne],K)})}remove(){return this.isDragging()&&this.stopDrag(),i.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(s),this._clearSelfAndDescendantCache(u),this._clearSelfAndDescendantCache(N),this._clearSelfAndDescendantCache(j),this._clearSelfAndDescendantCache(y)}_remove(){this._clearCaches();const D=this.getParent();D&&D.children&&(D.children.splice(this.index,1),D._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(D){const U="get"+t.Util._capitalize(D);return t.Util._isFunction(this[U])?this[U]():this.attrs[D]}getAncestors(){let D=this.getParent(),U=[];for(;D;)U.push(D),D=D.getParent();return U}getAttrs(){return this.attrs||{}}setAttrs(D){return this._batchTransformChanges(()=>{let U,G;if(!D)return this;for(U in D)U!==p&&(G=C+t.Util._capitalize(U),t.Util._isFunction(this[G])?this[G](D[U]):this._setAttr(U,D[U]))}),this}isListening(){return this._getCache(y,this._isListening)}_isListening(D){if(!this.listening())return!1;const G=this.getParent();return G&&G!==D&&this!==D?G._isListening(D):!0}isVisible(){return this._getCache(j,this._isVisible)}_isVisible(D){if(!this.visible())return!1;const G=this.getParent();return G&&G!==D&&this!==D?G._isVisible(D):!0}shouldDrawHit(D,U=!1){if(D)return this._isVisible(D)&&this._isListening(D);const G=this.getLayer();let Z=!1;i.DD._dragElements.forEach(Q=>{Q.dragStatus==="dragging"&&(Q.node.nodeType==="Stage"||Q.node.getLayer()===G)&&(Z=!0)});const K=!U&&!n.Konva.hitOnDragEnabled&&(Z||n.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!K}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let D=this.getDepth(),U=this,G=0,Z,K,Q,ne;function te(re){for(Z=[],K=re.length,Q=0;Q<K;Q++)ne=re[Q],G++,ne.nodeType!==_&&(Z=Z.concat(ne.getChildren().slice())),ne._id===U._id&&(Q=K);Z.length>0&&Z[0].getDepth()<=D&&te(Z)}const X=this.getStage();return U.nodeType!==I&&X&&te(X.getChildren()),G}getDepth(){let D=0,U=this.parent;for(;U;)D++,U=U.parent;return D}_batchTransformChanges(D){this._batchingTransformChange=!0,D(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(R),this._clearSelfAndDescendantCache(l)),this._needClearTransformCache=!1}setPosition(D){return this._batchTransformChanges(()=>{this.x(D.x),this.y(D.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const D=this.getStage();if(!D)return null;const U=D.getPointerPosition();if(!U)return null;const G=this.getAbsoluteTransform().copy();return G.invert(),G.point(U)}getAbsolutePosition(D){let U=!1,G=this.parent;for(;G;){if(G.isCached()){U=!0;break}G=G.parent}U&&!D&&(D=!0);const Z=this.getAbsoluteTransform(D).getMatrix(),K=new t.Transform,Q=this.offset();return K.m=Z.slice(),K.translate(Q.x,Q.y),K.getTranslation()}setAbsolutePosition(D){const{x:U,y:G,...Z}=this._clearTransform();this.attrs.x=U,this.attrs.y=G,this._clearCache(R);const K=this._getAbsoluteTransform().copy();return K.invert(),K.translate(D.x,D.y),D={x:this.attrs.x+K.getTranslation().x,y:this.attrs.y+K.getTranslation().y},this._setTransform(Z),this.setPosition({x:D.x,y:D.y}),this._clearCache(R),this._clearSelfAndDescendantCache(l),this}_setTransform(D){let U;for(U in D)this.attrs[U]=D[U]}_clearTransform(){const D={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,D}move(D){let U=D.x,G=D.y,Z=this.x(),K=this.y();return U!==void 0&&(Z+=U),G!==void 0&&(K+=G),this.setPosition({x:Z,y:K}),this}_eachAncestorReverse(D,U){let G=[],Z=this.getParent(),K,Q;if(!(U&&U._id===this._id)){for(G.unshift(this);Z&&(!U||Z._id!==U._id);)G.unshift(Z),Z=Z.parent;for(K=G.length,Q=0;Q<K;Q++)D(G[Q])}}rotate(D){return this.rotation(this.rotation()+D),this}moveToTop(){if(!this.parent)return t.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const D=this.index,U=this.parent.getChildren().length;return D<U-1?(this.parent.children.splice(D,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return t.Util.warn("Node has no parent. moveUp function is ignored."),!1;const D=this.index,U=this.parent.getChildren().length;return D<U-1?(this.parent.children.splice(D,1),this.parent.children.splice(D+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return t.Util.warn("Node has no parent. moveDown function is ignored."),!1;const D=this.index;return D>0?(this.parent.children.splice(D,1),this.parent.children.splice(D-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return t.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const D=this.index;return D>0?(this.parent.children.splice(D,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(D){if(!this.parent)return t.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(D<0||D>=this.parent.children.length)&&t.Util.warn("Unexpected value "+D+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const U=this.index;return this.parent.children.splice(U,1),this.parent.children.splice(D,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(s,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let D=this.opacity();const U=this.getParent();return U&&!U._isUnderCache&&(D*=U.getAbsoluteOpacity()),D}moveTo(D){return this.getParent()!==D&&(this._remove(),D.add(this)),this}toObject(){let D=this.getAttrs(),U,G,Z,K,Q;const ne={attrs:{},className:this.getClassName()};for(U in D)G=D[U],Q=t.Util.isObject(G)&&!t.Util._isPlainObject(G)&&!t.Util._isArray(G),!Q&&(Z=typeof this[U]=="function"&&this[U],delete D[U],K=Z?Z.call(this):null,D[U]=G,K!==G&&(ne.attrs[U]=G));return t.Util._prepareToStringify(ne)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(D,U,G){const Z=[];U&&this._isMatch(D)&&Z.push(this);let K=this.parent;for(;K;){if(K===G)return Z;K._isMatch(D)&&Z.push(K),K=K.parent}return Z}isAncestorOf(D){return!1}findAncestor(D,U,G){return this.findAncestors(D,U,G)[0]}_isMatch(D){if(!D)return!1;if(typeof D=="function")return D(this);let U=D.replace(/ /g,"").split(","),G=U.length,Z,K;for(Z=0;Z<G;Z++)if(K=U[Z],t.Util.isValidSelector(K)||(t.Util.warn('Selector "'+K+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),t.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),t.Util.warn("Konva is awesome, right?")),K.charAt(0)==="#"){if(this.id()===K.slice(1))return!0}else if(K.charAt(0)==="."){if(this.hasName(K.slice(1)))return!0}else if(this.className===K||this.nodeType===K)return!0;return!1}getLayer(){const D=this.getParent();return D?D.getLayer():null}getStage(){return this._getCache(N,this._getStage)}_getStage(){const D=this.getParent();return D?D.getStage():null}fire(D,U={},G){return U.target=U.target||this,G?this._fireAndBubble(D,U):this._fire(D,U),this}getAbsoluteTransform(D){return D?this._getAbsoluteTransform(D):this._getCache(l,this._getAbsoluteTransform)}_getAbsoluteTransform(D){let U;if(D)return U=new t.Transform,this._eachAncestorReverse(function(G){const Z=G.transformsEnabled();Z==="all"?U.multiply(G.getTransform()):Z==="position"&&U.translate(G.x()-G.offsetX(),G.y()-G.offsetY())},D),U;{U=this._cache.get(l)||new t.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(U):U.reset();const G=this.transformsEnabled();if(G==="all")U.multiply(this.getTransform());else if(G==="position"){const Z=this.attrs.x||0,K=this.attrs.y||0,Q=this.attrs.offsetX||0,ne=this.attrs.offsetY||0;U.translate(Z-Q,K-ne)}return U.dirty=!1,U}}getAbsoluteScale(D){let U=this;for(;U;)U._isUnderCache&&(D=U),U=U.getParent();const Z=this.getAbsoluteTransform(D).decompose();return{x:Z.scaleX,y:Z.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(R,this._getTransform)}_getTransform(){var D,U;const G=this._cache.get(R)||new t.Transform;G.reset();const Z=this.x(),K=this.y(),Q=n.Konva.getAngle(this.rotation()),ne=(D=this.attrs.scaleX)!==null&&D!==void 0?D:1,te=(U=this.attrs.scaleY)!==null&&U!==void 0?U:1,X=this.attrs.skewX||0,re=this.attrs.skewY||0,he=this.attrs.offsetX||0,oe=this.attrs.offsetY||0;return(Z!==0||K!==0)&&G.translate(Z,K),Q!==0&&G.rotate(Q),(X!==0||re!==0)&&G.skew(X,re),(ne!==1||te!==1)&&G.scale(ne,te),(he!==0||oe!==0)&&G.translate(-1*he,-1*oe),G.dirty=!1,G}clone(D){let U=t.Util.cloneObject(this.attrs),G,Z,K,Q,ne;for(G in D)U[G]=D[G];const te=new this.constructor(U);for(G in this.eventListeners)for(Z=this.eventListeners[G],K=Z.length,Q=0;Q<K;Q++)ne=Z[Q],ne.name.indexOf(g)<0&&(te.eventListeners[G]||(te.eventListeners[G]=[]),te.eventListeners[G].push(ne));return te}_toKonvaCanvas(D){D=D||{};const U=this.getClientRect(),G=this.getStage(),Z=D.x!==void 0?D.x:Math.floor(U.x),K=D.y!==void 0?D.y:Math.floor(U.y),Q=D.pixelRatio||1,ne=new r.SceneCanvas({width:D.width||Math.ceil(U.width)||(G?G.width():0),height:D.height||Math.ceil(U.height)||(G?G.height():0),pixelRatio:Q}),te=ne.getContext(),X=new r.SceneCanvas({width:ne.width/ne.pixelRatio+Math.abs(Z),height:ne.height/ne.pixelRatio+Math.abs(K),pixelRatio:ne.pixelRatio});return D.imageSmoothingEnabled===!1&&(te._context.imageSmoothingEnabled=!1),te.save(),(Z||K)&&te.translate(-1*Z,-1*K),this.drawScene(ne,void 0,X),te.restore(),ne}toCanvas(D){return this._toKonvaCanvas(D)._canvas}toDataURL(D){D=D||{};const U=D.mimeType||null,G=D.quality||null,Z=this._toKonvaCanvas(D).toDataURL(U,G);return D.callback&&D.callback(Z),Z}toImage(D){return new Promise((U,G)=>{try{const Z=D?.callback;Z&&delete D.callback,t.Util._urlToImage(this.toDataURL(D),function(K){U(K),Z?.(K)})}catch(Z){G(Z)}})}toBlob(D){return new Promise((U,G)=>{try{const Z=D?.callback;Z&&delete D.callback,this.toCanvas(D).toBlob(K=>{U(K),Z?.(K)},D?.mimeType,D?.quality)}catch(Z){G(Z)}})}setSize(D){return this.width(D.width),this.height(D.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():n.Konva.dragDistance}_off(D,U,G){let Z=this.eventListeners[D],K,Q,ne;for(K=0;K<Z.length;K++)if(Q=Z[K].name,ne=Z[K].handler,(Q!=="konva"||U==="konva")&&(!U||Q===U)&&(!G||G===ne)){if(Z.splice(K,1),Z.length===0){delete this.eventListeners[D];break}K--}}_fireChangeEvent(D,U,G){this._fire(D+h,{oldVal:U,newVal:G})}addName(D){if(!this.hasName(D)){const U=this.name(),G=U?U+" "+D:D;this.name(G)}return this}hasName(D){if(!D)return!1;const U=this.name();return U?(U||"").split(/\s/g).indexOf(D)!==-1:!1}removeName(D){const U=(this.name()||"").split(/\s/g),G=U.indexOf(D);return G!==-1&&(U.splice(G,1),this.name(U.join(" "))),this}setAttr(D,U){const G=this[C+t.Util._capitalize(D)];return t.Util._isFunction(G)?G.call(this,U):this._setAttr(D,U),this}_requestDraw(){if(n.Konva.autoDrawEnabled){const D=this.getLayer()||this.getStage();D?.batchDraw()}}_setAttr(D,U){const G=this.attrs[D];G===U&&!t.Util.isObject(U)||(U==null?delete this.attrs[D]:this.attrs[D]=U,this._shouldFireChangeEvents&&this._fireChangeEvent(D,G,U),this._requestDraw())}_setComponentAttr(D,U,G){let Z;G!==void 0&&(Z=this.attrs[D],Z||(this.attrs[D]=this.getAttr(D)),this.attrs[D][U]=G,this._fireChangeEvent(D,Z,G))}_fireAndBubble(D,U,G){if(U&&this.nodeType===_&&(U.target=this),!((D===S||D===w)&&(G&&(this===G||this.isAncestorOf&&this.isAncestorOf(G))||this.nodeType==="Stage"&&!G))){this._fire(D,U);const K=(D===S||D===w)&&G&&G.isAncestorOf&&G.isAncestorOf(this)&&!G.isAncestorOf(this.parent);(U&&!U.cancelBubble||!U)&&this.parent&&this.parent.isListening()&&!K&&(G&&G.parent?this._fireAndBubble.call(this.parent,D,U,G):this._fireAndBubble.call(this.parent,D,U))}}_getProtoListeners(D){var U,G,Z;const K=(U=this._cache.get(o))!==null&&U!==void 0?U:{};let Q=K?.[D];if(Q===void 0){Q=[];let ne=Object.getPrototypeOf(this);for(;ne;){const te=(Z=(G=ne.eventListeners)===null||G===void 0?void 0:G[D])!==null&&Z!==void 0?Z:[];Q.push(...te),ne=Object.getPrototypeOf(ne)}K[D]=Q,this._cache.set(o,K)}return Q}_fire(D,U){U=U||{},U.currentTarget=this,U.type=D;const G=this._getProtoListeners(D);if(G)for(var Z=0;Z<G.length;Z++)G[Z].handler.call(this,U);const K=this.eventListeners[D];if(K)for(var Z=0;Z<K.length;Z++)K[Z].handler.call(this,U)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(D){const U=D?D.pointerId:void 0,G=this.getStage(),Z=this.getAbsolutePosition();if(!G)return;const K=G._getPointerById(U)||G._changedPointerPositions[0]||Z;i.DD._dragElements.set(this._id,{node:this,startPointerPos:K,offset:{x:K.x-Z.x,y:K.y-Z.y},dragStatus:"ready",pointerId:U})}startDrag(D,U=!0){i.DD._dragElements.has(this._id)||this._createDragElement(D);const G=i.DD._dragElements.get(this._id);G.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:D&&D.evt},U)}_setDragPosition(D,U){const G=this.getStage()._getPointerById(U.pointerId);if(!G)return;let Z={x:G.x-U.offset.x,y:G.y-U.offset.y};const K=this.dragBoundFunc();if(K!==void 0){const Q=K.call(this,Z,D);Q?Z=Q:t.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==Z.x||this._lastPos.y!==Z.y)&&(this.setAbsolutePosition(Z),this._requestDraw()),this._lastPos=Z}stopDrag(D){const U=i.DD._dragElements.get(this._id);U&&(U.dragStatus="stopped"),i.DD._endDragBefore(D),i.DD._endDragAfter(D)}setDraggable(D){this._setAttr("draggable",D),this._dragChange()}isDragging(){const D=i.DD._dragElements.get(this._id);return D?D.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(D){if(!(!(D.evt.button!==void 0)||n.Konva.dragButtons.indexOf(D.evt.button)>=0)||this.isDragging())return;let Z=!1;i.DD._dragElements.forEach(K=>{this.isAncestorOf(K.node)&&(Z=!0)}),Z||this._createDragElement(D)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const U=i.DD._dragElements.get(this._id),G=U&&U.dragStatus==="dragging",Z=U&&U.dragStatus==="ready";G?this.stopDrag():Z&&i.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(D={x:0,y:0}){const U=this.getStage();if(!U)return!1;const G={x:-D.x,y:-D.y,width:U.width()+2*D.x,height:U.height()+2*D.y};return t.Util.haveIntersection(G,this.getClientRect())}static create(D,U){return t.Util._isString(D)&&(D=JSON.parse(D)),this._createNode(D,U)}static _createNode(D,U){let G=z.prototype.getClassName.call(D),Z=D.children,K,Q,ne;U&&(D.attrs.container=U),n.Konva[G]||(t.Util.warn('Can not find a node with class name "'+G+'". Fallback to "Shape".'),G="Shape");const te=n.Konva[G];if(K=new te(D.attrs),Z)for(Q=Z.length,ne=0;ne<Q;ne++)K.add(z._createNode(Z[ne]));return K}}Qm.Node=z,z.prototype.nodeType="Node",z.prototype._attrsAffectingSize=[],z.prototype.eventListeners={},z.prototype.on.call(z.prototype,O,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(R),this._clearSelfAndDescendantCache(l)}),z.prototype.on.call(z.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(j)}),z.prototype.on.call(z.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(y)}),z.prototype.on.call(z.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(s)});const V=e.Factory.addGetterSetter;return V(z,"zIndex"),V(z,"absolutePosition"),V(z,"position"),V(z,"x",0,(0,a.getNumberValidator)()),V(z,"y",0,(0,a.getNumberValidator)()),V(z,"globalCompositeOperation","source-over",(0,a.getStringValidator)()),V(z,"opacity",1,(0,a.getNumberValidator)()),V(z,"name","",(0,a.getStringValidator)()),V(z,"id","",(0,a.getStringValidator)()),V(z,"rotation",0,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(z,"scale",["x","y"]),V(z,"scaleX",1,(0,a.getNumberValidator)()),V(z,"scaleY",1,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(z,"skew",["x","y"]),V(z,"skewX",0,(0,a.getNumberValidator)()),V(z,"skewY",0,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(z,"offset",["x","y"]),V(z,"offsetX",0,(0,a.getNumberValidator)()),V(z,"offsetY",0,(0,a.getNumberValidator)()),V(z,"dragDistance",null,(0,a.getNumberValidator)()),V(z,"width",0,(0,a.getNumberValidator)()),V(z,"height",0,(0,a.getNumberValidator)()),V(z,"listening",!0,(0,a.getBooleanValidator)()),V(z,"preventDefault",!0,(0,a.getBooleanValidator)()),V(z,"filters",null,function(q){return this._filterUpToDate=!1,q}),V(z,"visible",!0,(0,a.getBooleanValidator)()),V(z,"transformsEnabled","all",(0,a.getStringValidator)()),V(z,"size"),V(z,"dragBoundFunc"),V(z,"draggable",!1,(0,a.getBooleanValidator)()),e.Factory.backCompat(z,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Qm}var Jm={},f5;function B1(){if(f5)return Jm;f5=1,Object.defineProperty(Jm,"__esModule",{value:!0}),Jm.Container=void 0;const t=Ar(),e=Ei(),r=Dr();let n=class extends e.Node{constructor(){super(...arguments),this.children=[]}getChildren(a){if(!a)return this.children||[];const s=this.children||[],o=[];return s.forEach(function(l){a(l)&&o.push(l)}),o}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.destroy()}),this.children=[],this._requestDraw(),this}add(...a){if(a.length===0)return this;if(a.length>1){for(let o=0;o<a.length;o++)this.add(a[o]);return this}const s=a[0];return s.getParent()?(s.moveTo(this),this):(this._validateAdd(s),s.index=this.getChildren().length,s.parent=this,s._clearCaches(),this.getChildren().push(s),this._fire("add",{child:s}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(a){return this._generalFind(a,!1)}findOne(a){const s=this._generalFind(a,!0);return s.length>0?s[0]:void 0}_generalFind(a,s){const o=[];return this._descendants(l=>{const u=l._isMatch(a);return u&&o.push(l),!!(u&&s)}),o}_descendants(a){let s=!1;const o=this.getChildren();for(const l of o){if(s=a(l),s)return!0;if(l.hasChildren()&&(s=l._descendants(a),s))return!0}return!1}toObject(){const a=e.Node.prototype.toObject.call(this);return a.children=[],this.getChildren().forEach(s=>{a.children.push(s.toObject())}),a}isAncestorOf(a){let s=a.getParent();for(;s;){if(s._id===this._id)return!0;s=s.getParent()}return!1}clone(a){const s=e.Node.prototype.clone.call(this,a);return this.getChildren().forEach(function(o){s.add(o.clone())}),s}getAllIntersections(a){const s=[];return this.find("Shape").forEach(o=>{o.isVisible()&&o.intersects(a)&&s.push(o)}),s}_clearSelfAndDescendantCache(a){var s;super._clearSelfAndDescendantCache(a),!this.isCached()&&((s=this.children)===null||s===void 0||s.forEach(function(o){o._clearSelfAndDescendantCache(a)}))}_setChildrenIndices(){var a;(a=this.children)===null||a===void 0||a.forEach(function(s,o){s.index=o}),this._requestDraw()}drawScene(a,s,o){const l=this.getLayer(),u=a||l&&l.getCanvas(),c=u&&u.getContext(),h=this._getCanvasCache(),p=h&&h.scene,g=u&&u.isCache;if(!this.isVisible()&&!g)return this;if(p){c.save();const y=this.getAbsoluteTransform(s).getMatrix();c.transform(y[0],y[1],y[2],y[3],y[4],y[5]),this._drawCachedSceneCanvas(c),c.restore()}else this._drawChildren("drawScene",u,s,o);return this}drawHit(a,s){if(!this.shouldDrawHit(s))return this;const o=this.getLayer(),l=a||o&&o.hitCanvas,u=l&&l.getContext(),c=this._getCanvasCache();if(c&&c.hit){u.save();const p=this.getAbsoluteTransform(s).getMatrix();u.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._drawCachedHitCanvas(u),u.restore()}else this._drawChildren("drawHit",l,s);return this}_drawChildren(a,s,o,l){var u;const c=s&&s.getContext(),h=this.clipWidth(),p=this.clipHeight(),g=this.clipFunc(),y=typeof h=="number"&&typeof p=="number"||g,S=o===this;if(y){c.save();const C=this.getAbsoluteTransform(o);let _=C.getMatrix();c.transform(_[0],_[1],_[2],_[3],_[4],_[5]),c.beginPath();let T;if(g)T=g.call(this,c,this);else{const N=this.clipX(),R=this.clipY();c.rect(N||0,R||0,h,p)}c.clip.apply(c,T),_=C.copy().invert().getMatrix(),c.transform(_[0],_[1],_[2],_[3],_[4],_[5])}const w=!S&&this.globalCompositeOperation()!=="source-over"&&a==="drawScene";w&&(c.save(),c._applyGlobalCompositeOperation(this)),(u=this.children)===null||u===void 0||u.forEach(function(C){C[a](s,o,l)}),w&&c.restore(),y&&c.restore()}getClientRect(a={}){var s;const o=a.skipTransform,l=a.relativeTo;let u,c,h,p,g={x:1/0,y:1/0,width:0,height:0};const y=this;(s=this.children)===null||s===void 0||s.forEach(function(C){if(!C.visible())return;const _=C.getClientRect({relativeTo:y,skipShadow:a.skipShadow,skipStroke:a.skipStroke});_.width===0&&_.height===0||(u===void 0?(u=_.x,c=_.y,h=_.x+_.width,p=_.y+_.height):(u=Math.min(u,_.x),c=Math.min(c,_.y),h=Math.max(h,_.x+_.width),p=Math.max(p,_.y+_.height)))});const S=this.find("Shape");let w=!1;for(let C=0;C<S.length;C++)if(S[C]._isVisible(this)){w=!0;break}return w&&u!==void 0?g={x:u,y:c,width:h-u,height:p-c}:g={x:0,y:0,width:0,height:0},o?g:this._transformedRect(g,l)}};return Jm.Container=n,t.Factory.addComponentsGetterSetter(n,"clip",["x","y","width","height"]),t.Factory.addGetterSetter(n,"clipX",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipY",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipWidth",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipHeight",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipFunc"),Jm}var N2={},xd={},p5;function bL(){if(p5)return xd;p5=1,Object.defineProperty(xd,"__esModule",{value:!0}),xd.getCapturedShape=n,xd.createEvent=i,xd.hasPointerCapture=a,xd.setPointerCapture=s,xd.releaseCapture=o;const t=Tr(),e=new Map,r=t.Konva._global.PointerEvent!==void 0;function n(l){return e.get(l)}function i(l){return{evt:l,pointerId:l.pointerId}}function a(l,u){return e.get(l)===u}function s(l,u){o(l),u.getStage()&&(e.set(l,u),r&&u._fire("gotpointercapture",i(new PointerEvent("gotpointercapture"))))}function o(l,u){const c=e.get(l);if(!c)return;const h=c.getStage();h&&h.content,e.delete(l),r&&c._fire("lostpointercapture",i(new PointerEvent("lostpointercapture")))}return xd}var m5;function vG(){return m5||(m5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.stages=void 0;const e=pi(),r=Ar(),n=B1(),i=Tr(),a=F1(),s=w_(),o=Tr(),l=bL(),u="Stage",c="string",h="px",p="mouseout",g="mouseleave",y="mouseover",S="mouseenter",w="mousemove",C="mousedown",_="mouseup",T="pointermove",N="pointerdown",R="pointerup",I="pointercancel",j="lostpointercapture",O="pointerout",F="pointerleave",z="pointerover",V="pointerenter",q="contextmenu",D="touchstart",U="touchend",G="touchmove",Z="touchcancel",K="wheel",Q=5,ne=[[S,"_pointerenter"],[C,"_pointerdown"],[w,"_pointermove"],[_,"_pointerup"],[g,"_pointerleave"],[D,"_pointerdown"],[G,"_pointermove"],[U,"_pointerup"],[Z,"_pointercancel"],[y,"_pointerover"],[K,"_wheel"],[q,"_contextmenu"],[N,"_pointerdown"],[T,"_pointermove"],[R,"_pointerup"],[I,"_pointercancel"],[j,"_lostpointercapture"]],te={mouse:{[O]:p,[F]:g,[z]:y,[V]:S,[T]:w,[N]:C,[R]:_,[I]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[O]:"touchout",[F]:"touchleave",[z]:"touchover",[V]:"touchenter",[T]:G,[N]:D,[R]:U,[I]:Z,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[O]:O,[F]:F,[z]:z,[V]:V,[T]:T,[N]:N,[R]:R,[I]:I,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},X=fe=>fe.indexOf("pointer")>=0?"pointer":fe.indexOf("touch")>=0?"touch":"mouse",re=fe=>{const ae=X(fe);if(ae==="pointer")return i.Konva.pointerEventsEnabled&&te.pointer;if(ae==="touch")return te.touch;if(ae==="mouse")return te.mouse};function he(fe={}){return(fe.clipFunc||fe.clipWidth||fe.clipHeight)&&e.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),fe}const oe="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";t.stages=[];class se extends n.Container{constructor(ae){super(he(ae)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),t.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{he(this.attrs)}),this._checkVisibility()}_validateAdd(ae){const pe=ae.getType()==="Layer",ye=ae.getType()==="FastLayer";pe||ye||e.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const ae=this.visible()?"":"none";this.content.style.display=ae}setContainer(ae){if(typeof ae===c){if(ae.charAt(0)==="."){const ye=ae.slice(1);ae=document.getElementsByClassName(ye)[0]}else{var pe;ae.charAt(0)!=="#"?pe=ae:pe=ae.slice(1),ae=document.getElementById(pe)}if(!ae)throw"Can not find container in document with id "+pe}return this._setAttr("container",ae),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),ae.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){let ae=this.children,pe=ae.length,ye;for(ye=0;ye<pe;ye++)ae[ye].clear();return this}clone(ae){return ae||(ae={}),ae.container=typeof document<"u"&&document.createElement("div"),n.Container.prototype.clone.call(this,ae)}destroy(){super.destroy();const ae=this.content;ae&&e.Util._isInDocument(ae)&&this.container().removeChild(ae);const pe=t.stages.indexOf(this);return pe>-1&&t.stages.splice(pe,1),e.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const ae=this._pointerPositions[0]||this._changedPointerPositions[0];return ae?{x:ae.x,y:ae.y}:(e.Util.warn(oe),null)}_getPointerById(ae){return this._pointerPositions.find(pe=>pe.id===ae)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(ae){ae=ae||{},ae.x=ae.x||0,ae.y=ae.y||0,ae.width=ae.width||this.width(),ae.height=ae.height||this.height();const pe=new a.SceneCanvas({width:ae.width,height:ae.height,pixelRatio:ae.pixelRatio||1}),ye=pe.getContext()._context,ve=this.children;return(ae.x||ae.y)&&ye.translate(-1*ae.x,-1*ae.y),ve.forEach(function(ue){if(!ue.isVisible())return;const xe=ue._toKonvaCanvas(ae);ye.drawImage(xe._canvas,ae.x,ae.y,xe.getWidth()/xe.getPixelRatio(),xe.getHeight()/xe.getPixelRatio())}),pe}getIntersection(ae){if(!ae)return null;let pe=this.children,ye=pe.length,ve=ye-1,ue;for(ue=ve;ue>=0;ue--){const xe=pe[ue].getIntersection(ae);if(xe)return xe}return null}_resizeDOM(){const ae=this.width(),pe=this.height();this.content&&(this.content.style.width=ae+h,this.content.style.height=pe+h),this.bufferCanvas.setSize(ae,pe),this.bufferHitCanvas.setSize(ae,pe),this.children.forEach(ye=>{ye.setSize({width:ae,height:pe}),ye.draw()})}add(ae,...pe){if(arguments.length>1){for(let ve=0;ve<arguments.length;ve++)this.add(arguments[ve]);return this}super.add(ae);const ye=this.children.length;return ye>Q&&e.Util.warn("The stage has "+ye+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),ae.setSize({width:this.width(),height:this.height()}),ae.draw(),i.Konva.isBrowser&&this.content.appendChild(ae.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(ae){return l.hasPointerCapture(ae,this)}setPointerCapture(ae){l.setPointerCapture(ae,this)}releaseCapture(ae){l.releaseCapture(ae,this)}getLayers(){return this.children}_bindContentEvents(){i.Konva.isBrowser&&ne.forEach(([ae,pe])=>{this.content.addEventListener(ae,ye=>{this[pe](ye)},{passive:!1})})}_pointerenter(ae){this.setPointersPositions(ae);const pe=re(ae.type);pe&&this._fire(pe.pointerenter,{evt:ae,target:this,currentTarget:this})}_pointerover(ae){this.setPointersPositions(ae);const pe=re(ae.type);pe&&this._fire(pe.pointerover,{evt:ae,target:this,currentTarget:this})}_getTargetShape(ae){let pe=this[ae+"targetShape"];return pe&&!pe.getStage()&&(pe=null),pe}_pointerleave(ae){const pe=re(ae.type),ye=X(ae.type);if(!pe)return;this.setPointersPositions(ae);const ve=this._getTargetShape(ye),ue=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;ve&&ue?(ve._fireAndBubble(pe.pointerout,{evt:ae}),ve._fireAndBubble(pe.pointerleave,{evt:ae}),this._fire(pe.pointerleave,{evt:ae,target:this,currentTarget:this}),this[ye+"targetShape"]=null):ue&&(this._fire(pe.pointerleave,{evt:ae,target:this,currentTarget:this}),this._fire(pe.pointerout,{evt:ae,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(ae){const pe=re(ae.type),ye=X(ae.type);if(!pe)return;this.setPointersPositions(ae);let ve=!1;this._changedPointerPositions.forEach(ue=>{const xe=this.getIntersection(ue);if(s.DD.justDragged=!1,i.Konva["_"+ye+"ListenClick"]=!0,!xe||!xe.isListening()){this[ye+"ClickStartShape"]=void 0;return}i.Konva.capturePointerEventsEnabled&&xe.setPointerCapture(ue.id),this[ye+"ClickStartShape"]=xe,xe._fireAndBubble(pe.pointerdown,{evt:ae,pointerId:ue.id}),ve=!0;const Se=ae.type.indexOf("touch")>=0;xe.preventDefault()&&ae.cancelable&&Se&&ae.preventDefault()}),ve||this._fire(pe.pointerdown,{evt:ae,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(ae){const pe=re(ae.type),ye=X(ae.type);if(!pe||(i.Konva.isDragging()&&s.DD.node.preventDefault()&&ae.cancelable&&ae.preventDefault(),this.setPointersPositions(ae),!(!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled)))return;const ue={};let xe=!1;const Se=this._getTargetShape(ye);this._changedPointerPositions.forEach(Oe=>{const Ae=l.getCapturedShape(Oe.id)||this.getIntersection(Oe),tt=Oe.id,rt={evt:ae,pointerId:tt},dt=Se!==Ae;if(dt&&Se&&(Se._fireAndBubble(pe.pointerout,{...rt},Ae),Se._fireAndBubble(pe.pointerleave,{...rt},Ae)),Ae){if(ue[Ae._id])return;ue[Ae._id]=!0}Ae&&Ae.isListening()?(xe=!0,dt&&(Ae._fireAndBubble(pe.pointerover,{...rt},Se),Ae._fireAndBubble(pe.pointerenter,{...rt},Se),this[ye+"targetShape"]=Ae),Ae._fireAndBubble(pe.pointermove,{...rt})):Se&&(this._fire(pe.pointerover,{evt:ae,target:this,currentTarget:this,pointerId:tt}),this[ye+"targetShape"]=null)}),xe||this._fire(pe.pointermove,{evt:ae,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(ae){const pe=re(ae.type),ye=X(ae.type);if(!pe)return;this.setPointersPositions(ae);const ve=this[ye+"ClickStartShape"],ue=this[ye+"ClickEndShape"],xe={};let Se=!1;this._changedPointerPositions.forEach(Oe=>{const Ae=l.getCapturedShape(Oe.id)||this.getIntersection(Oe);if(Ae){if(Ae.releaseCapture(Oe.id),xe[Ae._id])return;xe[Ae._id]=!0}const tt=Oe.id,rt={evt:ae,pointerId:tt};let dt=!1;i.Konva["_"+ye+"InDblClickWindow"]?(dt=!0,clearTimeout(this[ye+"DblTimeout"])):s.DD.justDragged||(i.Konva["_"+ye+"InDblClickWindow"]=!0,clearTimeout(this[ye+"DblTimeout"])),this[ye+"DblTimeout"]=setTimeout(function(){i.Konva["_"+ye+"InDblClickWindow"]=!1},i.Konva.dblClickWindow),Ae&&Ae.isListening()?(Se=!0,this[ye+"ClickEndShape"]=Ae,Ae._fireAndBubble(pe.pointerup,{...rt}),i.Konva["_"+ye+"ListenClick"]&&ve&&ve===Ae&&(Ae._fireAndBubble(pe.pointerclick,{...rt}),dt&&ue&&ue===Ae&&Ae._fireAndBubble(pe.pointerdblclick,{...rt}))):(this[ye+"ClickEndShape"]=null,i.Konva["_"+ye+"ListenClick"]&&this._fire(pe.pointerclick,{evt:ae,target:this,currentTarget:this,pointerId:tt}),dt&&this._fire(pe.pointerdblclick,{evt:ae,target:this,currentTarget:this,pointerId:tt}))}),Se||this._fire(pe.pointerup,{evt:ae,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),i.Konva["_"+ye+"ListenClick"]=!1,ae.cancelable&&ye!=="touch"&&ae.preventDefault()}_contextmenu(ae){this.setPointersPositions(ae);const pe=this.getIntersection(this.getPointerPosition());pe&&pe.isListening()?pe._fireAndBubble(q,{evt:ae}):this._fire(q,{evt:ae,target:this,currentTarget:this})}_wheel(ae){this.setPointersPositions(ae);const pe=this.getIntersection(this.getPointerPosition());pe&&pe.isListening()?pe._fireAndBubble(K,{evt:ae}):this._fire(K,{evt:ae,target:this,currentTarget:this})}_pointercancel(ae){this.setPointersPositions(ae);const pe=l.getCapturedShape(ae.pointerId)||this.getIntersection(this.getPointerPosition());pe&&pe._fireAndBubble(R,l.createEvent(ae)),l.releaseCapture(ae.pointerId)}_lostpointercapture(ae){l.releaseCapture(ae.pointerId)}setPointersPositions(ae){let pe=this._getContentPosition(),ye=null,ve=null;ae=ae||window.event,ae.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(ae.touches,ue=>{this._pointerPositions.push({id:ue.identifier,x:(ue.clientX-pe.left)/pe.scaleX,y:(ue.clientY-pe.top)/pe.scaleY})}),Array.prototype.forEach.call(ae.changedTouches||ae.touches,ue=>{this._changedPointerPositions.push({id:ue.identifier,x:(ue.clientX-pe.left)/pe.scaleX,y:(ue.clientY-pe.top)/pe.scaleY})})):(ye=(ae.clientX-pe.left)/pe.scaleX,ve=(ae.clientY-pe.top)/pe.scaleY,this.pointerPos={x:ye,y:ve},this._pointerPositions=[{x:ye,y:ve,id:e.Util._getFirstPointerId(ae)}],this._changedPointerPositions=[{x:ye,y:ve,id:e.Util._getFirstPointerId(ae)}])}_setPointerPosition(ae){e.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(ae)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const ae=this.content.getBoundingClientRect();return{top:ae.top,left:ae.left,scaleX:ae.width/this.content.clientWidth||1,scaleY:ae.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new a.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new a.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!i.Konva.isBrowser)return;const ae=this.container();if(!ae)throw"Stage has no container. A container is required.";ae.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),ae.appendChild(this.content),this._resizeDOM()}cache(){return e.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(ae){ae.batchDraw()}),this}}t.Stage=se,se.prototype.nodeType=u,(0,o._registerNode)(se),r.Factory.addGetterSetter(se,"container"),i.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{t.stages.forEach(fe=>{fe.batchDraw()})})})(N2)),N2}var eg={},P2={},g5;function xa(){return g5||(g5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=t.shapes=void 0;const e=Tr(),r=pi(),n=Ar(),i=Ei(),a=Dr(),s=Tr(),o=bL(),l="hasShadow",u="shadowRGBA",c="patternImage",h="linearGradient",p="radialGradient";let g;function y(){return g||(g=r.Util.createCanvasElement().getContext("2d"),g)}t.shapes={};function S(F){const z=this.attrs.fillRule;z?F.fill(z):F.fill()}function w(F){F.stroke()}function C(F){const z=this.attrs.fillRule;z?F.fill(z):F.fill()}function _(F){F.stroke()}function T(){this._clearCache(l)}function N(){this._clearCache(u)}function R(){this._clearCache(c)}function I(){this._clearCache(h)}function j(){this._clearCache(p)}class O extends i.Node{constructor(z){super(z);let V;for(;V=r.Util.getRandomColor(),!(V&&!(V in t.shapes)););this.colorKey=V,t.shapes[V]=this}getContext(){return r.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return r.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(l,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(c,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const V=y().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(V&&V.setTransform){const q=new r.Transform;q.translate(this.fillPatternX(),this.fillPatternY()),q.rotate(e.Konva.getAngle(this.fillPatternRotation())),q.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),q.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const D=q.getMatrix(),U=typeof DOMMatrix>"u"?{a:D[0],b:D[1],c:D[2],d:D[3],e:D[4],f:D[5]}:new DOMMatrix(D);V.setTransform(U)}return V}}_getLinearGradient(){return this._getCache(h,this.__getLinearGradient)}__getLinearGradient(){const z=this.fillLinearGradientColorStops();if(z){const V=y(),q=this.fillLinearGradientStartPoint(),D=this.fillLinearGradientEndPoint(),U=V.createLinearGradient(q.x,q.y,D.x,D.y);for(let G=0;G<z.length;G+=2)U.addColorStop(z[G],z[G+1]);return U}}_getRadialGradient(){return this._getCache(p,this.__getRadialGradient)}__getRadialGradient(){const z=this.fillRadialGradientColorStops();if(z){const V=y(),q=this.fillRadialGradientStartPoint(),D=this.fillRadialGradientEndPoint(),U=V.createRadialGradient(q.x,q.y,this.fillRadialGradientStartRadius(),D.x,D.y,this.fillRadialGradientEndRadius());for(let G=0;G<z.length;G+=2)U.addColorStop(z[G],z[G+1]);return U}}getShadowRGBA(){return this._getCache(u,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const z=r.Util.colorToRGBA(this.shadowColor());if(z)return"rgba("+z.r+","+z.g+","+z.b+","+z.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const z=this.hitStrokeWidth();return z==="auto"?this.hasStroke():this.strokeEnabled()&&!!z}intersects(z){const V=this.getStage();if(!V)return!1;const q=V.bufferHitCanvas;return q.getContext().clear(),this.drawHit(q,void 0,!0),q.context.getImageData(Math.round(z.x),Math.round(z.y),1,1).data[3]>0}destroy(){return i.Node.prototype.destroy.call(this),delete t.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(z){var V;if(!((V=this.attrs.perfectDrawEnabled)!==null&&V!==void 0?V:!0))return!1;const D=z||this.hasFill(),U=this.hasStroke(),G=this.getAbsoluteOpacity()!==1;if(D&&U&&G)return!0;const Z=this.hasShadow(),K=this.shadowForStrokeEnabled();return!!(D&&U&&Z&&K)}setStrokeHitEnabled(z){r.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),z?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const z=this.size();return{x:this._centroid?-z.width/2:0,y:this._centroid?-z.height/2:0,width:z.width,height:z.height}}getClientRect(z={}){let V=!1,q=this.getParent();for(;q;){if(q.isCached()){V=!0;break}q=q.getParent()}const D=z.skipTransform,U=z.relativeTo||V&&this.getStage()||void 0,G=this.getSelfRect(),K=!z.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,Q=G.width+K,ne=G.height+K,te=!z.skipShadow&&this.hasShadow(),X=te?this.shadowOffsetX():0,re=te?this.shadowOffsetY():0,he=Q+Math.abs(X),oe=ne+Math.abs(re),se=te&&this.shadowBlur()||0,fe=he+se*2,ae=oe+se*2,pe={width:fe,height:ae,x:-(K/2+se)+Math.min(X,0)+G.x,y:-(K/2+se)+Math.min(re,0)+G.y};return D?pe:this._transformedRect(pe,U)}drawScene(z,V,q){const D=this.getLayer();let U=z||D.getCanvas(),G=U.getContext(),Z=this._getCanvasCache(),K=this.getSceneFunc(),Q=this.hasShadow(),ne,te;const X=U.isCache,re=V===this;if(!this.isVisible()&&!re)return this;if(Z){G.save();const oe=this.getAbsoluteTransform(V).getMatrix();return G.transform(oe[0],oe[1],oe[2],oe[3],oe[4],oe[5]),this._drawCachedSceneCanvas(G),G.restore(),this}if(!K)return this;if(G.save(),this._useBufferCanvas()&&!X){ne=this.getStage();const oe=q||ne.bufferCanvas;te=oe.getContext(),te.clear(),te.save(),te._applyLineJoin(this);var he=this.getAbsoluteTransform(V).getMatrix();te.transform(he[0],he[1],he[2],he[3],he[4],he[5]),K.call(this,te,this),te.restore();const se=oe.pixelRatio;Q&&G._applyShadow(this),G._applyOpacity(this),G._applyGlobalCompositeOperation(this),G.drawImage(oe._canvas,0,0,oe.width/se,oe.height/se)}else{if(G._applyLineJoin(this),!re){var he=this.getAbsoluteTransform(V).getMatrix();G.transform(he[0],he[1],he[2],he[3],he[4],he[5]),G._applyOpacity(this),G._applyGlobalCompositeOperation(this)}Q&&G._applyShadow(this),K.call(this,G,this)}return G.restore(),this}drawHit(z,V,q=!1){if(!this.shouldDrawHit(V,q))return this;const D=this.getLayer(),U=z||D.hitCanvas,G=U&&U.getContext(),Z=this.hitFunc()||this.sceneFunc(),K=this._getCanvasCache(),Q=K&&K.hit;if(this.colorKey||r.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),Q){G.save();const te=this.getAbsoluteTransform(V).getMatrix();return G.transform(te[0],te[1],te[2],te[3],te[4],te[5]),this._drawCachedHitCanvas(G),G.restore(),this}if(!Z)return this;if(G.save(),G._applyLineJoin(this),!(this===V)){const te=this.getAbsoluteTransform(V).getMatrix();G.transform(te[0],te[1],te[2],te[3],te[4],te[5])}return Z.call(this,G,this),G.restore(),this}drawHitFromCache(z=0){let V=this._getCanvasCache(),q=this._getCachedSceneCanvas(),D=V.hit,U=D.getContext(),G=D.getWidth(),Z=D.getHeight(),K,Q,ne,te,X,re;U.clear(),U.drawImage(q._canvas,0,0,G,Z);try{for(K=U.getImageData(0,0,G,Z),Q=K.data,ne=Q.length,te=r.Util._hexToRgb(this.colorKey),X=0;X<ne;X+=4)re=Q[X+3],re>z?(Q[X]=te.r,Q[X+1]=te.g,Q[X+2]=te.b,Q[X+3]=255):Q[X+3]=0;U.putImageData(K,0,0)}catch(he){r.Util.error("Unable to draw hit graph from cached scene canvas. "+he.message)}return this}hasPointerCapture(z){return o.hasPointerCapture(z,this)}setPointerCapture(z){o.setPointerCapture(z,this)}releaseCapture(z){o.releaseCapture(z,this)}}t.Shape=O,O.prototype._fillFunc=S,O.prototype._strokeFunc=w,O.prototype._fillFuncHit=C,O.prototype._strokeFuncHit=_,O.prototype._centroid=!1,O.prototype.nodeType="Shape",(0,s._registerNode)(O),O.prototype.eventListeners={},O.prototype.on.call(O.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",T),O.prototype.on.call(O.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",N),O.prototype.on.call(O.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",R),O.prototype.on.call(O.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",I),O.prototype.on.call(O.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",j),n.Factory.addGetterSetter(O,"stroke",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(O,"strokeWidth",2,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillAfterStrokeEnabled",!1),n.Factory.addGetterSetter(O,"hitStrokeWidth","auto",(0,a.getNumberOrAutoValidator)()),n.Factory.addGetterSetter(O,"strokeHitEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(O,"perfectDrawEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(O,"shadowForStrokeEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(O,"lineJoin"),n.Factory.addGetterSetter(O,"lineCap"),n.Factory.addGetterSetter(O,"sceneFunc"),n.Factory.addGetterSetter(O,"hitFunc"),n.Factory.addGetterSetter(O,"dash"),n.Factory.addGetterSetter(O,"dashOffset",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"shadowColor",void 0,(0,a.getStringValidator)()),n.Factory.addGetterSetter(O,"shadowBlur",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"shadowOpacity",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(O,"shadowOffset",["x","y"]),n.Factory.addGetterSetter(O,"shadowOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"shadowOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillPatternImage"),n.Factory.addGetterSetter(O,"fill",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(O,"fillPatternX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillPatternY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillLinearGradientColorStops"),n.Factory.addGetterSetter(O,"strokeLinearGradientColorStops"),n.Factory.addGetterSetter(O,"fillRadialGradientStartRadius",0),n.Factory.addGetterSetter(O,"fillRadialGradientEndRadius",0),n.Factory.addGetterSetter(O,"fillRadialGradientColorStops"),n.Factory.addGetterSetter(O,"fillPatternRepeat","repeat"),n.Factory.addGetterSetter(O,"fillEnabled",!0),n.Factory.addGetterSetter(O,"strokeEnabled",!0),n.Factory.addGetterSetter(O,"shadowEnabled",!0),n.Factory.addGetterSetter(O,"dashEnabled",!0),n.Factory.addGetterSetter(O,"strokeScaleEnabled",!0),n.Factory.addGetterSetter(O,"fillPriority","color"),n.Factory.addComponentsGetterSetter(O,"fillPatternOffset",["x","y"]),n.Factory.addGetterSetter(O,"fillPatternOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillPatternOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(O,"fillPatternScale",["x","y"]),n.Factory.addGetterSetter(O,"fillPatternScaleX",1,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillPatternScaleY",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(O,"fillLinearGradientStartPoint",["x","y"]),n.Factory.addComponentsGetterSetter(O,"strokeLinearGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(O,"fillLinearGradientStartPointX",0),n.Factory.addGetterSetter(O,"strokeLinearGradientStartPointX",0),n.Factory.addGetterSetter(O,"fillLinearGradientStartPointY",0),n.Factory.addGetterSetter(O,"strokeLinearGradientStartPointY",0),n.Factory.addComponentsGetterSetter(O,"fillLinearGradientEndPoint",["x","y"]),n.Factory.addComponentsGetterSetter(O,"strokeLinearGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(O,"fillLinearGradientEndPointX",0),n.Factory.addGetterSetter(O,"strokeLinearGradientEndPointX",0),n.Factory.addGetterSetter(O,"fillLinearGradientEndPointY",0),n.Factory.addGetterSetter(O,"strokeLinearGradientEndPointY",0),n.Factory.addComponentsGetterSetter(O,"fillRadialGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(O,"fillRadialGradientStartPointX",0),n.Factory.addGetterSetter(O,"fillRadialGradientStartPointY",0),n.Factory.addComponentsGetterSetter(O,"fillRadialGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(O,"fillRadialGradientEndPointX",0),n.Factory.addGetterSetter(O,"fillRadialGradientEndPointY",0),n.Factory.addGetterSetter(O,"fillPatternRotation",0),n.Factory.addGetterSetter(O,"fillRule",void 0,(0,a.getStringValidator)()),n.Factory.backCompat(O,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(P2)),P2}var v5;function wL(){if(v5)return eg;v5=1,Object.defineProperty(eg,"__esModule",{value:!0}),eg.Layer=void 0;const t=pi(),e=B1(),r=Ei(),n=Ar(),i=F1(),a=Dr(),s=xa(),o=Tr(),l="#",u="beforeDraw",c="draw",h=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],p=h.length;class g extends e.Container{constructor(S){super(S),this.canvas=new i.SceneCanvas,this.hitCanvas=new i.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(S){return this.getContext().clear(S),this.getHitCanvas().getContext().clear(S),this}setZIndex(S){super.setZIndex(S);const w=this.getStage();return w&&w.content&&(w.content.removeChild(this.getNativeCanvasElement()),S<w.children.length-1?w.content.insertBefore(this.getNativeCanvasElement(),w.children[S+1].getCanvas()._canvas):w.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){r.Node.prototype.moveToTop.call(this);const S=this.getStage();return S&&S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!r.Node.prototype.moveUp.call(this))return!1;const w=this.getStage();return!w||!w.content?!1:(w.content.removeChild(this.getNativeCanvasElement()),this.index<w.children.length-1?w.content.insertBefore(this.getNativeCanvasElement(),w.children[this.index+1].getCanvas()._canvas):w.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(r.Node.prototype.moveDown.call(this)){const S=this.getStage();if(S){const w=S.children;S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.insertBefore(this.getNativeCanvasElement(),w[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(r.Node.prototype.moveToBottom.call(this)){const S=this.getStage();if(S){const w=S.children;S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.insertBefore(this.getNativeCanvasElement(),w[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const S=this.getNativeCanvasElement();return r.Node.prototype.remove.call(this),S&&S.parentNode&&t.Util._isInDocument(S)&&S.parentNode.removeChild(S),this}getStage(){return this.parent}setSize({width:S,height:w}){return this.canvas.setSize(S,w),this.hitCanvas.setSize(S,w),this._setSmoothEnabled(),this}_validateAdd(S){const w=S.getType();w!=="Group"&&w!=="Shape"&&t.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(S){return S=S||{},S.width=S.width||this.getWidth(),S.height=S.height||this.getHeight(),S.x=S.x!==void 0?S.x:this.x(),S.y=S.y!==void 0?S.y:this.y(),r.Node.prototype._toKonvaCanvas.call(this,S)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){t.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){t.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,t.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(S){if(!this.isListening()||!this.isVisible())return null;let w=1,C=!1;for(;;){for(let _=0;_<p;_++){const T=h[_],N=this._getIntersection({x:S.x+T.x*w,y:S.y+T.y*w}),R=N.shape;if(R)return R;if(C=!!N.antialiased,!N.antialiased)break}if(C)w+=1;else return null}}_getIntersection(S){const w=this.hitCanvas.pixelRatio,C=this.hitCanvas.context.getImageData(Math.round(S.x*w),Math.round(S.y*w),1,1).data,_=C[3];if(_===255){const T=t.Util._rgbToHex(C[0],C[1],C[2]),N=s.shapes[l+T];return N?{shape:N}:{antialiased:!0}}else if(_>0)return{antialiased:!0};return{}}drawScene(S,w){const C=this.getLayer(),_=S||C&&C.getCanvas();return this._fire(u,{node:this}),this.clearBeforeDraw()&&_.getContext().clear(),e.Container.prototype.drawScene.call(this,_,w),this._fire(c,{node:this}),this}drawHit(S,w){const C=this.getLayer(),_=S||C&&C.hitCanvas;return C&&C.clearBeforeDraw()&&C.getHitCanvas().getContext().clear(),e.Container.prototype.drawHit.call(this,_,w),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(S){t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(S)}getHitGraphEnabled(S){return t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const S=this.parent;!!this.hitCanvas._canvas.parentNode?S.content.removeChild(this.hitCanvas._canvas):S.content.appendChild(this.hitCanvas._canvas)}destroy(){return t.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}return eg.Layer=g,g.prototype.nodeType="Layer",(0,o._registerNode)(g),n.Factory.addGetterSetter(g,"imageSmoothingEnabled",!0),n.Factory.addGetterSetter(g,"clearBeforeDraw",!0),n.Factory.addGetterSetter(g,"hitGraphEnabled",!0,(0,a.getBooleanValidator)()),eg}var tg={},y5;function yG(){if(y5)return tg;y5=1,Object.defineProperty(tg,"__esModule",{value:!0}),tg.FastLayer=void 0;const t=pi(),e=wL(),r=Tr();let n=class extends e.Layer{constructor(a){super(a),this.listening(!1),t.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return tg.FastLayer=n,n.prototype.nodeType="FastLayer",(0,r._registerNode)(n),tg}var rg={},x5;function S_(){if(x5)return rg;x5=1,Object.defineProperty(rg,"__esModule",{value:!0}),rg.Group=void 0;const t=pi(),e=B1(),r=Tr();let n=class extends e.Container{_validateAdd(a){const s=a.getType();s!=="Group"&&s!=="Shape"&&t.Util.throw("You may only add groups and shapes to groups.")}};return rg.Group=n,n.prototype.nodeType="Group",(0,r._registerNode)(n),rg}var ng={},b5;function k_(){if(b5)return ng;b5=1,Object.defineProperty(ng,"__esModule",{value:!0}),ng.Animation=void 0;const t=Tr(),e=pi(),r=(function(){return t.glob.performance&&t.glob.performance.now?function(){return t.glob.performance.now()}:function(){return new Date().getTime()}})();let n=class Ep{constructor(a,s){this.id=Ep.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:r(),frameRate:0},this.func=a,this.setLayers(s)}setLayers(a){let s=[];return a&&(s=Array.isArray(a)?a:[a]),this.layers=s,this}getLayers(){return this.layers}addLayer(a){const s=this.layers,o=s.length;for(let l=0;l<o;l++)if(s[l]._id===a._id)return!1;return this.layers.push(a),!0}isRunning(){const s=Ep.animations,o=s.length;for(let l=0;l<o;l++)if(s[l].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=r(),Ep._addAnimation(this),this}stop(){return Ep._removeAnimation(this),this}_updateFrameObject(a){this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(a){this.animations.push(a),this._handleAnimation()}static _removeAnimation(a){const s=a.id,o=this.animations,l=o.length;for(let u=0;u<l;u++)if(o[u].id===s){this.animations.splice(u,1);break}}static _runFrames(){const a={},s=this.animations;for(let o=0;o<s.length;o++){const l=s[o],u=l.layers,c=l.func;l._updateFrameObject(r());const h=u.length;let p;if(c?p=c.call(l,l.frame)!==!1:p=!0,!!p)for(let g=0;g<h;g++){const y=u[g];y._id!==void 0&&(a[y._id]=y)}}for(const o in a)a.hasOwnProperty(o)&&a[o].batchDraw()}static _animationLoop(){const a=Ep;a.animations.length?(a._runFrames(),e.Util.requestAnimFrame(a._animationLoop)):a.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,e.Util.requestAnimFrame(this._animationLoop))}};return ng.Animation=n,n.animations=[],n.animIdCounter=0,n.animRunning=!1,ng}var M2={},w5;function xG(){return w5||(w5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Easings=t.Tween=void 0;const e=pi(),r=k_(),n=Ei(),i=Tr();let a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},s=1,o=2,l=3,u=0,c=["fill","stroke","shadowColor"];class h{constructor(y,S,w,C,_,T,N){this.prop=y,this.propFunc=S,this.begin=C,this._pos=C,this.duration=T,this._change=0,this.prevPos=0,this.yoyo=N,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=w,this._change=_-this.begin,this.pause()}fire(y){const S=this[y];S&&S()}setTime(y){y>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():y<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=y,this.update())}getTime(){return this._time}setPosition(y){this.prevPos=this._pos,this.propFunc(y),this._pos=y}getPosition(y){return y===void 0&&(y=this._time),this.func(y,this.begin,this._change,this.duration)}play(){this.state=o,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=l,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(y){this.pause(),this._time=y,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const y=this.getTimer()-this._startTime;this.state===o?this.setTime(y):this.state===l&&this.setTime(this.duration-y)}pause(){this.state=s,this.fire("onPause")}getTimer(){return new Date().getTime()}}class p{constructor(y){let S=this,w=y.node,C=w._id,_,T=y.easing||t.Easings.Linear,N=!!y.yoyo,R;typeof y.duration>"u"?_=.3:y.duration===0?_=.001:_=y.duration,this.node=w,this._id=u++;const I=w.getLayer()||(w instanceof i.Konva.Stage?w.getLayers():null);I||e.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new r.Animation(function(){S.tween.onEnterFrame()},I),this.tween=new h(R,function(j){S._tweenFunc(j)},T,0,1,_*1e3,N),this._addListeners(),p.attrs[C]||(p.attrs[C]={}),p.attrs[C][this._id]||(p.attrs[C][this._id]={}),p.tweens[C]||(p.tweens[C]={});for(R in y)a[R]===void 0&&this._addAttr(R,y[R]);this.reset(),this.onFinish=y.onFinish,this.onReset=y.onReset,this.onUpdate=y.onUpdate}_addAttr(y,S){let w=this.node,C=w._id,_,T,N,R,I,j,O,F;if(N=p.tweens[C][y],N&&delete p.attrs[C][N][y],_=w.getAttr(y),e.Util._isArray(S))if(T=[],I=Math.max(S.length,_.length),y==="points"&&S.length!==_.length&&(S.length>_.length?(O=_,_=e.Util._prepareArrayForTween(_,S,w.closed())):(j=S,S=e.Util._prepareArrayForTween(S,_,w.closed()))),y.indexOf("fill")===0)for(R=0;R<I;R++)if(R%2===0)T.push(S[R]-_[R]);else{const z=e.Util.colorToRGBA(_[R]);F=e.Util.colorToRGBA(S[R]),_[R]=z,T.push({r:F.r-z.r,g:F.g-z.g,b:F.b-z.b,a:F.a-z.a})}else for(R=0;R<I;R++)T.push(S[R]-_[R]);else c.indexOf(y)!==-1?(_=e.Util.colorToRGBA(_),F=e.Util.colorToRGBA(S),T={r:F.r-_.r,g:F.g-_.g,b:F.b-_.b,a:F.a-_.a}):T=S-_;p.attrs[C][this._id][y]={start:_,diff:T,end:S,trueEnd:j,trueStart:O},p.tweens[C][y]=this._id}_tweenFunc(y){let S=this.node,w=p.attrs[S._id][this._id],C,_,T,N,R,I,j,O;for(C in w){if(_=w[C],T=_.start,N=_.diff,O=_.end,e.Util._isArray(T))if(R=[],j=Math.max(T.length,O.length),C.indexOf("fill")===0)for(I=0;I<j;I++)I%2===0?R.push((T[I]||0)+N[I]*y):R.push("rgba("+Math.round(T[I].r+N[I].r*y)+","+Math.round(T[I].g+N[I].g*y)+","+Math.round(T[I].b+N[I].b*y)+","+(T[I].a+N[I].a*y)+")");else for(I=0;I<j;I++)R.push((T[I]||0)+N[I]*y);else c.indexOf(C)!==-1?R="rgba("+Math.round(T.r+N.r*y)+","+Math.round(T.g+N.g*y)+","+Math.round(T.b+N.b*y)+","+(T.a+N.a*y)+")":R=T+N*y;S.setAttr(C,R)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const y=this.node,S=p.attrs[y._id][this._id];S.points&&S.points.trueEnd&&y.setAttr("points",S.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const y=this.node,S=p.attrs[y._id][this._id];S.points&&S.points.trueStart&&y.points(S.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(y){return this.tween.seek(y*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){let y=this.node._id,S=this._id,w=p.tweens[y],C;this.pause();for(C in w)delete p.tweens[y][C];delete p.attrs[y][S]}}t.Tween=p,p.attrs={},p.tweens={},n.Node.prototype.to=function(g){const y=g.onFinish;g.node=this,g.onFinish=function(){this.destroy(),y&&y()},new p(g).play()},t.Easings={BackEaseIn(g,y,S,w){return S*(g/=w)*g*((1.70158+1)*g-1.70158)+y},BackEaseOut(g,y,S,w){return S*((g=g/w-1)*g*((1.70158+1)*g+1.70158)+1)+y},BackEaseInOut(g,y,S,w){let C=1.70158;return(g/=w/2)<1?S/2*(g*g*(((C*=1.525)+1)*g-C))+y:S/2*((g-=2)*g*(((C*=1.525)+1)*g+C)+2)+y},ElasticEaseIn(g,y,S,w,C,_){let T=0;return g===0?y:(g/=w)===1?y+S:(_||(_=w*.3),!C||C<Math.abs(S)?(C=S,T=_/4):T=_/(2*Math.PI)*Math.asin(S/C),-(C*Math.pow(2,10*(g-=1))*Math.sin((g*w-T)*(2*Math.PI)/_))+y)},ElasticEaseOut(g,y,S,w,C,_){let T=0;return g===0?y:(g/=w)===1?y+S:(_||(_=w*.3),!C||C<Math.abs(S)?(C=S,T=_/4):T=_/(2*Math.PI)*Math.asin(S/C),C*Math.pow(2,-10*g)*Math.sin((g*w-T)*(2*Math.PI)/_)+S+y)},ElasticEaseInOut(g,y,S,w,C,_){let T=0;return g===0?y:(g/=w/2)===2?y+S:(_||(_=w*(.3*1.5)),!C||C<Math.abs(S)?(C=S,T=_/4):T=_/(2*Math.PI)*Math.asin(S/C),g<1?-.5*(C*Math.pow(2,10*(g-=1))*Math.sin((g*w-T)*(2*Math.PI)/_))+y:C*Math.pow(2,-10*(g-=1))*Math.sin((g*w-T)*(2*Math.PI)/_)*.5+S+y)},BounceEaseOut(g,y,S,w){return(g/=w)<1/2.75?S*(7.5625*g*g)+y:g<2/2.75?S*(7.5625*(g-=1.5/2.75)*g+.75)+y:g<2.5/2.75?S*(7.5625*(g-=2.25/2.75)*g+.9375)+y:S*(7.5625*(g-=2.625/2.75)*g+.984375)+y},BounceEaseIn(g,y,S,w){return S-t.Easings.BounceEaseOut(w-g,0,S,w)+y},BounceEaseInOut(g,y,S,w){return g<w/2?t.Easings.BounceEaseIn(g*2,0,S,w)*.5+y:t.Easings.BounceEaseOut(g*2-w,0,S,w)*.5+S*.5+y},EaseIn(g,y,S,w){return S*(g/=w)*g+y},EaseOut(g,y,S,w){return-S*(g/=w)*(g-2)+y},EaseInOut(g,y,S,w){return(g/=w/2)<1?S/2*g*g+y:-S/2*(--g*(g-2)-1)+y},StrongEaseIn(g,y,S,w){return S*(g/=w)*g*g*g*g+y},StrongEaseOut(g,y,S,w){return S*((g=g/w-1)*g*g*g*g+1)+y},StrongEaseInOut(g,y,S,w){return(g/=w/2)<1?S/2*g*g*g*g*g+y:S/2*((g-=2)*g*g*g*g+2)+y},Linear(g,y,S,w){return S*g/w+y}}})(M2)),M2}var S5;function JS(){return S5||(S5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;const e=Tr(),r=pi(),n=Ei(),i=B1(),a=vG(),s=wL(),o=yG(),l=S_(),u=w_(),c=xa(),h=k_(),p=xG(),g=xL(),y=F1();t.Konva=r.Util._assign(e.Konva,{Util:r.Util,Transform:r.Transform,Node:n.Node,Container:i.Container,Stage:a.Stage,stages:a.stages,Layer:s.Layer,FastLayer:o.FastLayer,Group:l.Group,DD:u.DD,Shape:c.Shape,shapes:c.shapes,Animation:h.Animation,Tween:p.Tween,Easings:p.Easings,Context:g.Context,Canvas:y.Canvas}),t.default=t.Konva})(k2)),k2}var ig={},k5;function bG(){if(k5)return ig;k5=1,Object.defineProperty(ig,"__esModule",{value:!0}),ig.Arc=void 0;const t=Ar(),e=xa(),r=Tr(),n=Dr(),i=Tr();let a=class extends e.Shape{_sceneFunc(o){const l=r.Konva.getAngle(this.angle()),u=this.clockwise();o.beginPath(),o.arc(0,0,this.outerRadius(),0,l,u),o.arc(0,0,this.innerRadius(),l,0,!u),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(o){this.outerRadius(o/2)}setHeight(o){this.outerRadius(o/2)}getSelfRect(){const o=this.innerRadius(),l=this.outerRadius(),u=this.clockwise(),c=r.Konva.getAngle(u?360-this.angle():this.angle()),h=Math.cos(Math.min(c,Math.PI)),p=1,g=Math.sin(Math.min(Math.max(Math.PI,c),3*Math.PI/2)),y=Math.sin(Math.min(c,Math.PI/2)),S=h*(h>0?o:l),w=p*l,C=g*(g>0?o:l),_=y*(y>0?l:o);return{x:S,y:u?-1*_:C,width:w-S,height:_-C}}};return ig.Arc=a,a.prototype._centroid=!0,a.prototype.className="Arc",a.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"innerRadius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"outerRadius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"clockwise",!1,(0,n.getBooleanValidator)()),ig}var ag={},sg={},_5;function SL(){if(_5)return sg;_5=1,Object.defineProperty(sg,"__esModule",{value:!0}),sg.Line=void 0;const t=Ar(),e=Tr(),r=xa(),n=Dr();function i(o,l,u,c,h,p,g){const y=Math.sqrt(Math.pow(u-o,2)+Math.pow(c-l,2)),S=Math.sqrt(Math.pow(h-u,2)+Math.pow(p-c,2)),w=g*y/(y+S),C=g*S/(y+S),_=u-w*(h-o),T=c-w*(p-l),N=u+C*(h-o),R=c+C*(p-l);return[_,T,N,R]}function a(o,l){const u=o.length,c=[];for(let h=2;h<u-2;h+=2){const p=i(o[h-2],o[h-1],o[h],o[h+1],o[h+2],o[h+3],l);isNaN(p[0])||(c.push(p[0]),c.push(p[1]),c.push(o[h]),c.push(o[h+1]),c.push(p[2]),c.push(p[3]))}return c}class s extends r.Shape{constructor(l){super(l),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(l){let u=this.points(),c=u.length,h=this.tension(),p=this.closed(),g=this.bezier(),y,S,w;if(c){if(l.beginPath(),l.moveTo(u[0],u[1]),h!==0&&c>4){for(y=this.getTensionPoints(),S=y.length,w=p?0:4,p||l.quadraticCurveTo(y[0],y[1],y[2],y[3]);w<S-2;)l.bezierCurveTo(y[w++],y[w++],y[w++],y[w++],y[w++],y[w++]);p||l.quadraticCurveTo(y[S-2],y[S-1],u[c-2],u[c-1])}else if(g)for(w=2;w<c;)l.bezierCurveTo(u[w++],u[w++],u[w++],u[w++],u[w++],u[w++]);else for(w=2;w<c;w+=2)l.lineTo(u[w],u[w+1]);p?(l.closePath(),l.fillStrokeShape(this)):l.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():a(this.points(),this.tension())}_getTensionPointsClosed(){const l=this.points(),u=l.length,c=this.tension(),h=i(l[u-2],l[u-1],l[0],l[1],l[2],l[3],c),p=i(l[u-4],l[u-3],l[u-2],l[u-1],l[0],l[1],c),g=a(l,c);return[h[2],h[3]].concat(g).concat([p[0],p[1],l[u-2],l[u-1],p[2],p[3],h[0],h[1],l[0],l[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let l=this.points();if(l.length<4)return{x:l[0]||0,y:l[1]||0,width:0,height:0};this.tension()!==0?l=[l[0],l[1],...this._getTensionPoints(),l[l.length-2],l[l.length-1]]:l=this.points();let u=l[0],c=l[0],h=l[1],p=l[1],g,y;for(let S=0;S<l.length/2;S++)g=l[S*2],y=l[S*2+1],u=Math.min(u,g),c=Math.max(c,g),h=Math.min(h,y),p=Math.max(p,y);return{x:u,y:h,width:c-u,height:p-h}}}return sg.Line=s,s.prototype.className="Line",s.prototype._attrsAffectingSize=["points","bezier","tension"],(0,e._registerNode)(s),t.Factory.addGetterSetter(s,"closed",!1),t.Factory.addGetterSetter(s,"bezier",!1),t.Factory.addGetterSetter(s,"tension",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(s,"points",[],(0,n.getNumberArrayValidator)()),sg}var og={},A2={},C5;function wG(){return C5||(C5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.t2length=t.getQuadraticArcLength=t.getCubicArcLength=t.binomialCoefficients=t.cValues=t.tValues=void 0,t.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],t.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],t.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const e=(s,o,l)=>{let u,c;const p=l/2;u=0;for(let g=0;g<20;g++)c=p*t.tValues[20][g]+p,u+=t.cValues[20][g]*n(s,o,c);return p*u};t.getCubicArcLength=e;const r=(s,o,l)=>{l===void 0&&(l=1);const u=s[0]-2*s[1]+s[2],c=o[0]-2*o[1]+o[2],h=2*s[1]-2*s[0],p=2*o[1]-2*o[0],g=4*(u*u+c*c),y=4*(u*h+c*p),S=h*h+p*p;if(g===0)return l*Math.sqrt(Math.pow(s[2]-s[0],2)+Math.pow(o[2]-o[0],2));const w=y/(2*g),C=S/g,_=l+w,T=C-w*w,N=_*_+T>0?Math.sqrt(_*_+T):0,R=w*w+T>0?Math.sqrt(w*w+T):0,I=w+Math.sqrt(w*w+T)!==0?T*Math.log(Math.abs((_+N)/(w+R))):0;return Math.sqrt(g)/2*(_*N-w*R+I)};t.getQuadraticArcLength=r;function n(s,o,l){const u=i(1,l,s),c=i(1,l,o),h=u*u+c*c;return Math.sqrt(h)}const i=(s,o,l)=>{const u=l.length-1;let c,h;if(u===0)return 0;if(s===0){h=0;for(let p=0;p<=u;p++)h+=t.binomialCoefficients[u][p]*Math.pow(1-o,u-p)*Math.pow(o,p)*l[p];return h}else{c=new Array(u);for(let p=0;p<u;p++)c[p]=u*(l[p+1]-l[p]);return i(s-1,o,c)}},a=(s,o,l)=>{let u=1,c=s/o,h=(s-l(c))/o,p=0;for(;u>.001;){const g=l(c+h),y=Math.abs(s-g)/o;if(y<u)u=y,c+=h;else{const S=l(c-h),w=Math.abs(s-S)/o;w<u?(u=w,c-=h):h/=2}if(p++,p>500)break}return c};t.t2length=a})(A2)),A2}var E5;function __(){if(E5)return og;E5=1,Object.defineProperty(og,"__esModule",{value:!0}),og.Path=void 0;const t=Ar(),e=xa(),r=Tr(),n=wG();class i extends e.Shape{constructor(s){super(s),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=i.parsePathData(this.data()),this.pathLength=i.getPathLength(this.dataArray)}_sceneFunc(s){const o=this.dataArray;s.beginPath();let l=!1;for(let N=0;N<o.length;N++){const R=o[N].command,I=o[N].points;switch(R){case"L":s.lineTo(I[0],I[1]);break;case"M":s.moveTo(I[0],I[1]);break;case"C":s.bezierCurveTo(I[0],I[1],I[2],I[3],I[4],I[5]);break;case"Q":s.quadraticCurveTo(I[0],I[1],I[2],I[3]);break;case"A":var u=I[0],c=I[1],h=I[2],p=I[3],g=I[4],y=I[5],S=I[6],w=I[7],C=h>p?h:p,_=h>p?1:h/p,T=h>p?p/h:1;s.translate(u,c),s.rotate(S),s.scale(_,T),s.arc(0,0,C,g,g+y,1-w),s.scale(1/_,1/T),s.rotate(-S),s.translate(-u,-c);break;case"z":l=!0,s.closePath();break}}!l&&!this.hasFill()?s.strokeShape(this):s.fillStrokeShape(this)}getSelfRect(){let s=[];this.dataArray.forEach(function(g){if(g.command==="A"){const y=g.points[4],S=g.points[5],w=g.points[4]+S;let C=Math.PI/180;if(Math.abs(y-w)<C&&(C=Math.abs(y-w)),S<0)for(let _=y-C;_>w;_-=C){const T=i.getPointOnEllipticalArc(g.points[0],g.points[1],g.points[2],g.points[3],_,0);s.push(T.x,T.y)}else for(let _=y+C;_<w;_+=C){const T=i.getPointOnEllipticalArc(g.points[0],g.points[1],g.points[2],g.points[3],_,0);s.push(T.x,T.y)}}else if(g.command==="C")for(let y=0;y<=1;y+=.01){const S=i.getPointOnCubicBezier(y,g.start.x,g.start.y,g.points[0],g.points[1],g.points[2],g.points[3],g.points[4],g.points[5]);s.push(S.x,S.y)}else s=s.concat(g.points)});let o=s[0],l=s[0],u=s[1],c=s[1],h,p;for(let g=0;g<s.length/2;g++)h=s[g*2],p=s[g*2+1],isNaN(h)||(o=Math.min(o,h),l=Math.max(l,h)),isNaN(p)||(u=Math.min(u,p),c=Math.max(c,p));return{x:o,y:u,width:l-o,height:c-u}}getLength(){return this.pathLength}getPointAtLength(s){return i.getPointAtLengthOfDataArray(s,this.dataArray)}static getLineLength(s,o,l,u){return Math.sqrt((l-s)*(l-s)+(u-o)*(u-o))}static getPathLength(s){let o=0;for(let l=0;l<s.length;++l)o+=s[l].pathLength;return o}static getPointAtLengthOfDataArray(s,o){let l,u=0,c=o.length;if(!c)return null;for(;u<c&&s>o[u].pathLength;)s-=o[u].pathLength,++u;if(u===c)return l=o[u-1].points.slice(-2),{x:l[0],y:l[1]};if(s<.01)return l=o[u].points.slice(0,2),{x:l[0],y:l[1]};const h=o[u],p=h.points;switch(h.command){case"L":return i.getPointOnLine(s,h.start.x,h.start.y,p[0],p[1]);case"C":return i.getPointOnCubicBezier((0,n.t2length)(s,i.getPathLength(o),N=>(0,n.getCubicArcLength)([h.start.x,p[0],p[2],p[4]],[h.start.y,p[1],p[3],p[5]],N)),h.start.x,h.start.y,p[0],p[1],p[2],p[3],p[4],p[5]);case"Q":return i.getPointOnQuadraticBezier((0,n.t2length)(s,i.getPathLength(o),N=>(0,n.getQuadraticArcLength)([h.start.x,p[0],p[2]],[h.start.y,p[1],p[3]],N)),h.start.x,h.start.y,p[0],p[1],p[2],p[3]);case"A":var g=p[0],y=p[1],S=p[2],w=p[3],C=p[4],_=p[5],T=p[6];return C+=_*s/h.pathLength,i.getPointOnEllipticalArc(g,y,S,w,C,T)}return null}static getPointOnLine(s,o,l,u,c,h,p){h=h??o,p=p??l;const g=this.getLineLength(o,l,u,c);if(g<1e-10)return{x:o,y:l};if(u===o)return{x:h,y:p+(c>l?s:-s)};const y=(c-l)/(u-o),S=Math.sqrt(s*s/(1+y*y))*(u<o?-1:1),w=y*S;if(Math.abs(p-l-y*(h-o))<1e-10)return{x:h+S,y:p+w};const C=((h-o)*(u-o)+(p-l)*(c-l))/(g*g),_=o+C*(u-o),T=l+C*(c-l),N=this.getLineLength(h,p,_,T),R=Math.sqrt(s*s-N*N),I=Math.sqrt(R*R/(1+y*y))*(u<o?-1:1),j=y*I;return{x:_+I,y:T+j}}static getPointOnCubicBezier(s,o,l,u,c,h,p,g,y){function S(R){return R*R*R}function w(R){return 3*R*R*(1-R)}function C(R){return 3*R*(1-R)*(1-R)}function _(R){return(1-R)*(1-R)*(1-R)}const T=g*S(s)+h*w(s)+u*C(s)+o*_(s),N=y*S(s)+p*w(s)+c*C(s)+l*_(s);return{x:T,y:N}}static getPointOnQuadraticBezier(s,o,l,u,c,h,p){function g(_){return _*_}function y(_){return 2*_*(1-_)}function S(_){return(1-_)*(1-_)}const w=h*g(s)+u*y(s)+o*S(s),C=p*g(s)+c*y(s)+l*S(s);return{x:w,y:C}}static getPointOnEllipticalArc(s,o,l,u,c,h){const p=Math.cos(h),g=Math.sin(h),y={x:l*Math.cos(c),y:u*Math.sin(c)};return{x:s+(y.x*p-y.y*g),y:o+(y.x*g+y.y*p)}}static parsePathData(s){if(!s)return[];let o=s;const l=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];o=o.replace(new RegExp(" ","g"),",");for(var u=0;u<l.length;u++)o=o.replace(new RegExp(l[u],"g"),"|"+l[u]);const c=o.split("|"),h=[],p=[];let g=0,y=0;const S=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let w;for(u=1;u<c.length;u++){let D=c[u],U=D.charAt(0);for(D=D.slice(1),p.length=0;w=S.exec(D);)p.push(w[0]);const G=[];for(let Z=0,K=p.length;Z<K;Z++){if(p[Z]==="00"){G.push(0,0);continue}const Q=parseFloat(p[Z]);isNaN(Q)?G.push(0):G.push(Q)}for(;G.length>0&&!isNaN(G[0]);){let Z="",K=[];const Q=g,ne=y;var C,_,T,N,R,I,j,O,F,z;switch(U){case"l":g+=G.shift(),y+=G.shift(),Z="L",K.push(g,y);break;case"L":g=G.shift(),y=G.shift(),K.push(g,y);break;case"m":var V=G.shift(),q=G.shift();if(g+=V,y+=q,Z="M",h.length>2&&h[h.length-1].command==="z"){for(let te=h.length-2;te>=0;te--)if(h[te].command==="M"){g=h[te].points[0]+V,y=h[te].points[1]+q;break}}K.push(g,y),U="l";break;case"M":g=G.shift(),y=G.shift(),Z="M",K.push(g,y),U="L";break;case"h":g+=G.shift(),Z="L",K.push(g,y);break;case"H":g=G.shift(),Z="L",K.push(g,y);break;case"v":y+=G.shift(),Z="L",K.push(g,y);break;case"V":y=G.shift(),Z="L",K.push(g,y);break;case"C":K.push(G.shift(),G.shift(),G.shift(),G.shift()),g=G.shift(),y=G.shift(),K.push(g,y);break;case"c":K.push(g+G.shift(),y+G.shift(),g+G.shift(),y+G.shift()),g+=G.shift(),y+=G.shift(),Z="C",K.push(g,y);break;case"S":_=g,T=y,C=h[h.length-1],C.command==="C"&&(_=g+(g-C.points[2]),T=y+(y-C.points[3])),K.push(_,T,G.shift(),G.shift()),g=G.shift(),y=G.shift(),Z="C",K.push(g,y);break;case"s":_=g,T=y,C=h[h.length-1],C.command==="C"&&(_=g+(g-C.points[2]),T=y+(y-C.points[3])),K.push(_,T,g+G.shift(),y+G.shift()),g+=G.shift(),y+=G.shift(),Z="C",K.push(g,y);break;case"Q":K.push(G.shift(),G.shift()),g=G.shift(),y=G.shift(),K.push(g,y);break;case"q":K.push(g+G.shift(),y+G.shift()),g+=G.shift(),y+=G.shift(),Z="Q",K.push(g,y);break;case"T":_=g,T=y,C=h[h.length-1],C.command==="Q"&&(_=g+(g-C.points[0]),T=y+(y-C.points[1])),g=G.shift(),y=G.shift(),Z="Q",K.push(_,T,g,y);break;case"t":_=g,T=y,C=h[h.length-1],C.command==="Q"&&(_=g+(g-C.points[0]),T=y+(y-C.points[1])),g+=G.shift(),y+=G.shift(),Z="Q",K.push(_,T,g,y);break;case"A":N=G.shift(),R=G.shift(),I=G.shift(),j=G.shift(),O=G.shift(),F=g,z=y,g=G.shift(),y=G.shift(),Z="A",K=this.convertEndpointToCenterParameterization(F,z,g,y,j,O,N,R,I);break;case"a":N=G.shift(),R=G.shift(),I=G.shift(),j=G.shift(),O=G.shift(),F=g,z=y,g+=G.shift(),y+=G.shift(),Z="A",K=this.convertEndpointToCenterParameterization(F,z,g,y,j,O,N,R,I);break}h.push({command:Z||U,points:K,start:{x:Q,y:ne},pathLength:this.calcLength(Q,ne,Z||U,K)})}(U==="z"||U==="Z")&&h.push({command:"z",points:[],start:void 0,pathLength:0})}return h}static calcLength(s,o,l,u){let c,h,p,g;const y=i;switch(l){case"L":return y.getLineLength(s,o,u[0],u[1]);case"C":return(0,n.getCubicArcLength)([s,u[0],u[2],u[4]],[o,u[1],u[3],u[5]],1);case"Q":return(0,n.getQuadraticArcLength)([s,u[0],u[2]],[o,u[1],u[3]],1);case"A":c=0;var S=u[4],w=u[5],C=u[4]+w,_=Math.PI/180;if(Math.abs(S-C)<_&&(_=Math.abs(S-C)),h=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],S,0),w<0)for(g=S-_;g>C;g-=_)p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],g,0),c+=y.getLineLength(h.x,h.y,p.x,p.y),h=p;else for(g=S+_;g<C;g+=_)p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],g,0),c+=y.getLineLength(h.x,h.y,p.x,p.y),h=p;return p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],C,0),c+=y.getLineLength(h.x,h.y,p.x,p.y),c}return 0}static convertEndpointToCenterParameterization(s,o,l,u,c,h,p,g,y){const S=y*(Math.PI/180),w=Math.cos(S)*(s-l)/2+Math.sin(S)*(o-u)/2,C=-1*Math.sin(S)*(s-l)/2+Math.cos(S)*(o-u)/2,_=w*w/(p*p)+C*C/(g*g);_>1&&(p*=Math.sqrt(_),g*=Math.sqrt(_));let T=Math.sqrt((p*p*(g*g)-p*p*(C*C)-g*g*(w*w))/(p*p*(C*C)+g*g*(w*w)));c===h&&(T*=-1),isNaN(T)&&(T=0);const N=T*p*C/g,R=T*-g*w/p,I=(s+l)/2+Math.cos(S)*N-Math.sin(S)*R,j=(o+u)/2+Math.sin(S)*N+Math.cos(S)*R,O=function(G){return Math.sqrt(G[0]*G[0]+G[1]*G[1])},F=function(G,Z){return(G[0]*Z[0]+G[1]*Z[1])/(O(G)*O(Z))},z=function(G,Z){return(G[0]*Z[1]<G[1]*Z[0]?-1:1)*Math.acos(F(G,Z))},V=z([1,0],[(w-N)/p,(C-R)/g]),q=[(w-N)/p,(C-R)/g],D=[(-1*w-N)/p,(-1*C-R)/g];let U=z(q,D);return F(q,D)<=-1&&(U=Math.PI),F(q,D)>=1&&(U=0),h===0&&U>0&&(U=U-2*Math.PI),h===1&&U<0&&(U=U+2*Math.PI),[I,j,p,g,V,U,S,h]}}return og.Path=i,i.prototype.className="Path",i.prototype._attrsAffectingSize=["data"],(0,r._registerNode)(i),t.Factory.addGetterSetter(i,"data"),og}var T5;function SG(){if(T5)return ag;T5=1,Object.defineProperty(ag,"__esModule",{value:!0}),ag.Arrow=void 0;const t=Ar(),e=SL(),r=Dr(),n=Tr(),i=__();let a=class extends e.Line{_sceneFunc(o){super._sceneFunc(o);const l=Math.PI*2,u=this.points();let c=u;const h=this.tension()!==0&&u.length>4;h&&(c=this.getTensionPoints());const p=this.pointerLength(),g=u.length;let y,S;if(h){const _=[c[c.length-4],c[c.length-3],c[c.length-2],c[c.length-1],u[g-2],u[g-1]],T=i.Path.calcLength(c[c.length-4],c[c.length-3],"C",_),N=i.Path.getPointOnQuadraticBezier(Math.min(1,1-p/T),_[0],_[1],_[2],_[3],_[4],_[5]);y=u[g-2]-N.x,S=u[g-1]-N.y}else y=u[g-2]-u[g-4],S=u[g-1]-u[g-3];const w=(Math.atan2(S,y)+l)%l,C=this.pointerWidth();this.pointerAtEnding()&&(o.save(),o.beginPath(),o.translate(u[g-2],u[g-1]),o.rotate(w),o.moveTo(0,0),o.lineTo(-p,C/2),o.lineTo(-p,-C/2),o.closePath(),o.restore(),this.__fillStroke(o)),this.pointerAtBeginning()&&(o.save(),o.beginPath(),o.translate(u[0],u[1]),h?(y=(c[0]+c[2])/2-u[0],S=(c[1]+c[3])/2-u[1]):(y=u[2]-u[0],S=u[3]-u[1]),o.rotate((Math.atan2(-S,-y)+l)%l),o.moveTo(0,0),o.lineTo(-p,C/2),o.lineTo(-p,-C/2),o.closePath(),o.restore(),this.__fillStroke(o))}__fillStroke(o){const l=this.dashEnabled();l&&(this.attrs.dashEnabled=!1,o.setLineDash([])),o.fillStrokeShape(this),l&&(this.attrs.dashEnabled=!0)}getSelfRect(){const o=super.getSelfRect(),l=this.pointerWidth()/2;return{x:o.x-l,y:o.y-l,width:o.width+l*2,height:o.height+l*2}}};return ag.Arrow=a,a.prototype.className="Arrow",(0,n._registerNode)(a),t.Factory.addGetterSetter(a,"pointerLength",10,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"pointerWidth",10,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"pointerAtBeginning",!1),t.Factory.addGetterSetter(a,"pointerAtEnding",!0),ag}var lg={},N5;function kG(){if(N5)return lg;N5=1,Object.defineProperty(lg,"__esModule",{value:!0}),lg.Circle=void 0;const t=Ar(),e=xa(),r=Dr(),n=Tr();class i extends e.Shape{_sceneFunc(s){s.beginPath(),s.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(s){this.radius()!==s/2&&this.radius(s/2)}setHeight(s){this.radius()!==s/2&&this.radius(s/2)}}return lg.Circle=i,i.prototype._centroid=!0,i.prototype.className="Circle",i.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"radius",0,(0,r.getNumberValidator)()),lg}var ug={},P5;function _G(){if(P5)return ug;P5=1,Object.defineProperty(ug,"__esModule",{value:!0}),ug.Ellipse=void 0;const t=Ar(),e=xa(),r=Dr(),n=Tr();let i=class extends e.Shape{_sceneFunc(s){const o=this.radiusX(),l=this.radiusY();s.beginPath(),s.save(),o!==l&&s.scale(1,l/o),s.arc(0,0,o,0,Math.PI*2,!1),s.restore(),s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(s){this.radiusX(s/2)}setHeight(s){this.radiusY(s/2)}};return ug.Ellipse=i,i.prototype.className="Ellipse",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,n._registerNode)(i),t.Factory.addComponentsGetterSetter(i,"radius",["x","y"]),t.Factory.addGetterSetter(i,"radiusX",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"radiusY",0,(0,r.getNumberValidator)()),ug}var cg={},M5;function CG(){if(M5)return cg;M5=1,Object.defineProperty(cg,"__esModule",{value:!0}),cg.Image=void 0;const t=pi(),e=Ar(),r=xa(),n=Tr(),i=Dr();class a extends r.Shape{constructor(o){super(o),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const o=this.image();o&&o.complete||o&&o.readyState===4||o&&o.addEventListener&&o.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){const o=!!this.cornerRadius(),l=this.hasShadow();return o&&l?!0:super._useBufferCanvas(!0)}_sceneFunc(o){const l=this.getWidth(),u=this.getHeight(),c=this.cornerRadius(),h=this.attrs.image;let p;if(h){const g=this.attrs.cropWidth,y=this.attrs.cropHeight;g&&y?p=[h,this.cropX(),this.cropY(),g,y,0,0,l,u]:p=[h,0,0,l,u]}(this.hasFill()||this.hasStroke()||c)&&(o.beginPath(),c?t.Util.drawRoundedRectPath(o,l,u,c):o.rect(0,0,l,u),o.closePath(),o.fillStrokeShape(this)),h&&(c&&o.clip(),o.drawImage.apply(o,p))}_hitFunc(o){const l=this.width(),u=this.height(),c=this.cornerRadius();o.beginPath(),c?t.Util.drawRoundedRectPath(o,l,u,c):o.rect(0,0,l,u),o.closePath(),o.fillStrokeShape(this)}getWidth(){var o,l;return(o=this.attrs.width)!==null&&o!==void 0?o:(l=this.image())===null||l===void 0?void 0:l.width}getHeight(){var o,l;return(o=this.attrs.height)!==null&&o!==void 0?o:(l=this.image())===null||l===void 0?void 0:l.height}static fromURL(o,l,u=null){const c=t.Util.createImageElement();c.onload=function(){const h=new a({image:c});l(h)},c.onerror=u,c.crossOrigin="Anonymous",c.src=o}}return cg.Image=a,a.prototype.className="Image",(0,n._registerNode)(a),e.Factory.addGetterSetter(a,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),e.Factory.addGetterSetter(a,"image"),e.Factory.addComponentsGetterSetter(a,"crop",["x","y","width","height"]),e.Factory.addGetterSetter(a,"cropX",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropY",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropWidth",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropHeight",0,(0,i.getNumberValidator)()),cg}var Hh={},A5;function EG(){if(A5)return Hh;A5=1,Object.defineProperty(Hh,"__esModule",{value:!0}),Hh.Tag=Hh.Label=void 0;const t=Ar(),e=xa(),r=S_(),n=Dr(),i=Tr(),a=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],s="Change.konva",o="none",l="up",u="right",c="down",h="left",p=a.length;let g=class extends r.Group{constructor(w){super(w),this.on("add.konva",function(C){this._addListeners(C.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(w){let C=this,_;const T=function(){C._sync()};for(_=0;_<p;_++)w.on(a[_]+s,T)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let w=this.getText(),C=this.getTag(),_,T,N,R,I,j,O;if(w&&C){switch(_=w.width(),T=w.height(),N=C.pointerDirection(),R=C.pointerWidth(),O=C.pointerHeight(),I=0,j=0,N){case l:I=_/2,j=-1*O;break;case u:I=_+R,j=T/2;break;case c:I=_/2,j=T+O;break;case h:I=-1*R,j=T/2;break}C.setAttrs({x:-1*I,y:-1*j,width:_,height:T}),w.setAttrs({x:-1*I,y:-1*j})}}};Hh.Label=g,g.prototype.className="Label",(0,i._registerNode)(g);class y extends e.Shape{_sceneFunc(w){const C=this.width(),_=this.height(),T=this.pointerDirection(),N=this.pointerWidth(),R=this.pointerHeight(),I=this.cornerRadius();let j=0,O=0,F=0,z=0;typeof I=="number"?j=O=F=z=Math.min(I,C/2,_/2):(j=Math.min(I[0]||0,C/2,_/2),O=Math.min(I[1]||0,C/2,_/2),z=Math.min(I[2]||0,C/2,_/2),F=Math.min(I[3]||0,C/2,_/2)),w.beginPath(),w.moveTo(j,0),T===l&&(w.lineTo((C-N)/2,0),w.lineTo(C/2,-1*R),w.lineTo((C+N)/2,0)),w.lineTo(C-O,0),w.arc(C-O,O,O,Math.PI*3/2,0,!1),T===u&&(w.lineTo(C,(_-R)/2),w.lineTo(C+N,_/2),w.lineTo(C,(_+R)/2)),w.lineTo(C,_-z),w.arc(C-z,_-z,z,0,Math.PI/2,!1),T===c&&(w.lineTo((C+N)/2,_),w.lineTo(C/2,_+R),w.lineTo((C-N)/2,_)),w.lineTo(F,_),w.arc(F,_-F,F,Math.PI/2,Math.PI,!1),T===h&&(w.lineTo(0,(_+R)/2),w.lineTo(-1*N,_/2),w.lineTo(0,(_-R)/2)),w.lineTo(0,j),w.arc(j,j,j,Math.PI,Math.PI*3/2,!1),w.closePath(),w.fillStrokeShape(this)}getSelfRect(){let w=0,C=0,_=this.pointerWidth(),T=this.pointerHeight(),N=this.pointerDirection(),R=this.width(),I=this.height();return N===l?(C-=T,I+=T):N===c?I+=T:N===h?(w-=_*1.5,R+=_):N===u&&(R+=_*1.5),{x:w,y:C,width:R,height:I}}}return Hh.Tag=y,y.prototype.className="Tag",(0,i._registerNode)(y),t.Factory.addGetterSetter(y,"pointerDirection",o),t.Factory.addGetterSetter(y,"pointerWidth",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(y,"pointerHeight",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(y,"cornerRadius",0,(0,n.getNumberOrArrayOfNumbersValidator)(4)),Hh}var dg={},L5;function kL(){if(L5)return dg;L5=1,Object.defineProperty(dg,"__esModule",{value:!0}),dg.Rect=void 0;const t=Ar(),e=xa(),r=Tr(),n=pi(),i=Dr();class a extends e.Shape{_sceneFunc(o){const l=this.cornerRadius(),u=this.width(),c=this.height();o.beginPath(),l?n.Util.drawRoundedRectPath(o,u,c,l):o.rect(0,0,u,c),o.closePath(),o.fillStrokeShape(this)}}return dg.Rect=a,a.prototype.className="Rect",(0,r._registerNode)(a),t.Factory.addGetterSetter(a,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),dg}var hg={},R5;function TG(){if(R5)return hg;R5=1,Object.defineProperty(hg,"__esModule",{value:!0}),hg.RegularPolygon=void 0;const t=Ar(),e=xa(),r=Dr(),n=Tr();let i=class extends e.Shape{_sceneFunc(s){const o=this._getPoints();s.beginPath(),s.moveTo(o[0].x,o[0].y);for(let l=1;l<o.length;l++)s.lineTo(o[l].x,o[l].y);s.closePath(),s.fillStrokeShape(this)}_getPoints(){const s=this.attrs.sides,o=this.attrs.radius||0,l=[];for(let u=0;u<s;u++)l.push({x:o*Math.sin(u*2*Math.PI/s),y:-1*o*Math.cos(u*2*Math.PI/s)});return l}getSelfRect(){const s=this._getPoints();let o=s[0].x,l=s[0].y,u=s[0].x,c=s[0].y;return s.forEach(h=>{o=Math.min(o,h.x),l=Math.max(l,h.x),u=Math.min(u,h.y),c=Math.max(c,h.y)}),{x:o,y:u,width:l-o,height:c-u}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(s){this.radius(s/2)}setHeight(s){this.radius(s/2)}};return hg.RegularPolygon=i,i.prototype.className="RegularPolygon",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"radius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"sides",0,(0,r.getNumberValidator)()),hg}var fg={},O5;function NG(){if(O5)return fg;O5=1,Object.defineProperty(fg,"__esModule",{value:!0}),fg.Ring=void 0;const t=Ar(),e=xa(),r=Dr(),n=Tr(),i=Math.PI*2;let a=class extends e.Shape{_sceneFunc(o){o.beginPath(),o.arc(0,0,this.innerRadius(),0,i,!1),o.moveTo(this.outerRadius(),0),o.arc(0,0,this.outerRadius(),i,0,!0),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(o){this.outerRadius(o/2)}setHeight(o){this.outerRadius(o/2)}};return fg.Ring=a,a.prototype.className="Ring",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(a),t.Factory.addGetterSetter(a,"innerRadius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"outerRadius",0,(0,r.getNumberValidator)()),fg}var pg={},D5;function PG(){if(D5)return pg;D5=1,Object.defineProperty(pg,"__esModule",{value:!0}),pg.Sprite=void 0;const t=Ar(),e=xa(),r=k_(),n=Dr(),i=Tr();let a=class extends e.Shape{constructor(o){super(o),this._updated=!0,this.anim=new r.Animation(()=>{const l=this._updated;return this._updated=!1,l}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(o){const l=this.animation(),u=this.frameIndex(),c=u*4,h=this.animations()[l],p=this.frameOffsets(),g=h[c+0],y=h[c+1],S=h[c+2],w=h[c+3],C=this.image();if((this.hasFill()||this.hasStroke())&&(o.beginPath(),o.rect(0,0,S,w),o.closePath(),o.fillStrokeShape(this)),C)if(p){const _=p[l],T=u*2;o.drawImage(C,g,y,S,w,_[T+0],_[T+1],S,w)}else o.drawImage(C,g,y,S,w,0,0,S,w)}_hitFunc(o){const l=this.animation(),u=this.frameIndex(),c=u*4,h=this.animations()[l],p=this.frameOffsets(),g=h[c+2],y=h[c+3];if(o.beginPath(),p){const S=p[l],w=u*2;o.rect(S[w+0],S[w+1],g,y)}else o.rect(0,0,g,y);o.closePath(),o.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const o=this;this.interval=setInterval(function(){o._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const o=this.getLayer();this.anim.setLayers(o),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const o=this.frameIndex(),l=this.animation(),u=this.animations(),c=u[l],h=c.length/4;o<h-1?this.frameIndex(o+1):this.frameIndex(0)}};return pg.Sprite=a,a.prototype.className="Sprite",(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"animation"),t.Factory.addGetterSetter(a,"animations"),t.Factory.addGetterSetter(a,"frameOffsets"),t.Factory.addGetterSetter(a,"image"),t.Factory.addGetterSetter(a,"frameIndex",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"frameRate",17,(0,n.getNumberValidator)()),t.Factory.backCompat(a,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),pg}var mg={},I5;function MG(){if(I5)return mg;I5=1,Object.defineProperty(mg,"__esModule",{value:!0}),mg.Star=void 0;const t=Ar(),e=xa(),r=Dr(),n=Tr();let i=class extends e.Shape{_sceneFunc(s){const o=this.innerRadius(),l=this.outerRadius(),u=this.numPoints();s.beginPath(),s.moveTo(0,0-l);for(let c=1;c<u*2;c++){const h=c%2===0?l:o,p=h*Math.sin(c*Math.PI/u),g=-1*h*Math.cos(c*Math.PI/u);s.lineTo(p,g)}s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(s){this.outerRadius(s/2)}setHeight(s){this.outerRadius(s/2)}};return mg.Star=i,i.prototype.className="Star",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"numPoints",5,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"innerRadius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"outerRadius",0,(0,r.getNumberValidator)()),mg}var wp={},j5;function _L(){if(j5)return wp;j5=1,Object.defineProperty(wp,"__esModule",{value:!0}),wp.Text=void 0,wp.stringToArray=s;const t=pi(),e=Ar(),r=xa(),n=Tr(),i=Dr(),a=Tr();function s(re){return[...re].reduce((he,oe,se,fe)=>(new RegExp("\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?(?:\\u200D\\p{Emoji_Presentation})+","u").test(oe)?he.push(oe):new RegExp("\\p{Regional_Indicator}{2}","u").test(oe+(fe[se+1]||""))?he.push(oe+fe[se+1]):se>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(oe)?he[he.length-1]+=oe:he.push(oe),he),[])}const o="auto",l="center",u="inherit",c="justify",h="Change.konva",p="2d",g="-",y="left",S="text",w="Text",C="top",_="bottom",T="middle",N="normal",R="px ",I=" ",j="right",O="rtl",F="word",z="char",V="none",q="",D=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],U=D.length;function G(re){return re.split(",").map(he=>{he=he.trim();const oe=he.indexOf(" ")>=0,se=he.indexOf('"')>=0||he.indexOf("'")>=0;return oe&&!se&&(he=`"${he}"`),he}).join(", ")}let Z;function K(){return Z||(Z=t.Util.createCanvasElement().getContext(p),Z)}function Q(re){re.fillText(this._partialText,this._partialTextX,this._partialTextY)}function ne(re){re.setAttr("miterLimit",2),re.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function te(re){return re=re||{},!re.fillLinearGradientColorStops&&!re.fillRadialGradientColorStops&&!re.fillPatternImage&&(re.fill=re.fill||"black"),re}class X extends r.Shape{constructor(he){super(te(he)),this._partialTextX=0,this._partialTextY=0;for(let oe=0;oe<U;oe++)this.on(D[oe]+h,this._setTextData);this._setTextData()}_sceneFunc(he){const oe=this.textArr,se=oe.length;if(!this.text())return;let fe=this.padding(),ae=this.fontSize(),pe=this.lineHeight()*ae,ye=this.verticalAlign(),ve=this.direction(),ue=0,xe=this.align(),Se=this.getWidth(),Oe=this.letterSpacing(),Ae=this.fill(),tt=this.textDecoration(),rt=tt.indexOf("underline")!==-1,dt=tt.indexOf("line-through")!==-1,_t;ve=ve===u?he.direction:ve;let Xe=pe/2,ht=T;if(n.Konva._fixTextRendering){const ut=this.measureSize("M");ht="alphabetic",Xe=(ut.fontBoundingBoxAscent-ut.fontBoundingBoxDescent)/2+pe/2}var ct=0,vt=0;for(ve===O&&he.setAttr("direction",ve),he.setAttr("font",this._getContextFont()),he.setAttr("textBaseline",ht),he.setAttr("textAlign",y),ye===T?ue=(this.getHeight()-se*pe-fe*2)/2:ye===_&&(ue=this.getHeight()-se*pe-fe*2),he.translate(fe,ue+fe),_t=0;_t<se;_t++){var ct=0,vt=0,lt=oe[_t],Lt=lt.text,jt=lt.width,Ne=lt.lastInParagraph,qe,bt,at;if(he.save(),xe===j?ct+=Se-jt-fe*2:xe===l&&(ct+=(Se-jt-fe*2)/2),rt){he.save(),he.beginPath();const de=n.Konva._fixTextRendering?Math.round(ae/4):Math.round(ae/2),ge=ct,ke=Xe+vt+de;he.moveTo(ge,ke),qe=Lt.split(" ").length-1,bt=qe===0,at=xe===c&&!Ne?Se-fe*2:jt,he.lineTo(ge+Math.round(at),ke),he.lineWidth=ae/15;const Ee=this._getLinearGradient();he.strokeStyle=Ee||Ae,he.stroke(),he.restore()}if(dt){he.save(),he.beginPath();const de=n.Konva._fixTextRendering?-Math.round(ae/4):0;he.moveTo(ct,Xe+vt+de),qe=Lt.split(" ").length-1,bt=qe===0,at=xe===c&&Ne&&!bt?Se-fe*2:jt,he.lineTo(ct+Math.round(at),Xe+vt+de),he.lineWidth=ae/15;const ge=this._getLinearGradient();he.strokeStyle=ge||Ae,he.stroke(),he.restore()}if(ve!==O&&(Oe!==0||xe===c)){qe=Lt.split(" ").length-1;const de=s(Lt);for(let ge=0;ge<de.length;ge++){const ke=de[ge];ke===" "&&!Ne&&xe===c&&(ct+=(Se-fe*2-jt)/qe),this._partialTextX=ct,this._partialTextY=Xe+vt,this._partialText=ke,he.fillStrokeShape(this),ct+=this.measureSize(ke).width+Oe}}else Oe!==0&&he.setAttr("letterSpacing",`${Oe}px`),this._partialTextX=ct,this._partialTextY=Xe+vt,this._partialText=Lt,he.fillStrokeShape(this);he.restore(),se>1&&(Xe+=pe)}}_hitFunc(he){const oe=this.getWidth(),se=this.getHeight();he.beginPath(),he.rect(0,0,oe,se),he.closePath(),he.fillStrokeShape(this)}setText(he){const oe=t.Util._isString(he)?he:he==null?"":he+"";return this._setAttr(S,oe),this}getWidth(){return this.attrs.width===o||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===o||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return t.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(he){var oe,se,fe,ae,pe,ye,ve,ue,xe,Se,Oe;let Ae=K(),tt=this.fontSize(),rt;Ae.save(),Ae.font=this._getContextFont(),rt=Ae.measureText(he),Ae.restore();const dt=tt/100;return{actualBoundingBoxAscent:(oe=rt.actualBoundingBoxAscent)!==null&&oe!==void 0?oe:71.58203125*dt,actualBoundingBoxDescent:(se=rt.actualBoundingBoxDescent)!==null&&se!==void 0?se:0,actualBoundingBoxLeft:(fe=rt.actualBoundingBoxLeft)!==null&&fe!==void 0?fe:-7.421875*dt,actualBoundingBoxRight:(ae=rt.actualBoundingBoxRight)!==null&&ae!==void 0?ae:75.732421875*dt,alphabeticBaseline:(pe=rt.alphabeticBaseline)!==null&&pe!==void 0?pe:0,emHeightAscent:(ye=rt.emHeightAscent)!==null&&ye!==void 0?ye:100*dt,emHeightDescent:(ve=rt.emHeightDescent)!==null&&ve!==void 0?ve:-20*dt,fontBoundingBoxAscent:(ue=rt.fontBoundingBoxAscent)!==null&&ue!==void 0?ue:91*dt,fontBoundingBoxDescent:(xe=rt.fontBoundingBoxDescent)!==null&&xe!==void 0?xe:21*dt,hangingBaseline:(Se=rt.hangingBaseline)!==null&&Se!==void 0?Se:72.80000305175781*dt,ideographicBaseline:(Oe=rt.ideographicBaseline)!==null&&Oe!==void 0?Oe:-21*dt,width:rt.width,height:tt}}_getContextFont(){return this.fontStyle()+I+this.fontVariant()+I+(this.fontSize()+R)+G(this.fontFamily())}_addTextLine(he){this.align()===c&&(he=he.trim());const se=this._getTextWidth(he);return this.textArr.push({text:he,width:se,lastInParagraph:!1})}_getTextWidth(he){const oe=this.letterSpacing(),se=he.length;return K().measureText(he).width+(se?oe*(se-1):0)}_setTextData(){let he=this.text().split(`
`),oe=+this.fontSize(),se=0,fe=this.lineHeight()*oe,ae=this.attrs.width,pe=this.attrs.height,ye=ae!==o&&ae!==void 0,ve=pe!==o&&pe!==void 0,ue=this.padding(),xe=ae-ue*2,Se=pe-ue*2,Oe=0,Ae=this.wrap(),tt=Ae!==V,rt=Ae!==z&&tt,dt=this.ellipsis();this.textArr=[],K().font=this._getContextFont();const _t=dt?this._getTextWidth(q):0;for(let ht=0,ct=he.length;ht<ct;++ht){let vt=he[ht],lt=this._getTextWidth(vt);if(ye&&lt>xe)for(;vt.length>0;){let Lt=0,jt=vt.length,Ne="",qe=0;for(;Lt<jt;){const bt=Lt+jt>>>1,at=vt.slice(0,bt+1),ut=this._getTextWidth(at)+_t;ut<=xe?(Lt=bt+1,Ne=at,qe=ut):jt=bt}if(Ne){if(rt){var Xe;const at=vt[Ne.length];(at===I||at===g)&&qe<=xe?Xe=Ne.length:Xe=Math.max(Ne.lastIndexOf(I),Ne.lastIndexOf(g))+1,Xe>0&&(Lt=Xe,Ne=Ne.slice(0,Lt),qe=this._getTextWidth(Ne))}if(Ne=Ne.trimRight(),this._addTextLine(Ne),se=Math.max(se,qe),Oe+=fe,this._shouldHandleEllipsis(Oe)){this._tryToAddEllipsisToLastLine();break}if(vt=vt.slice(Lt),vt=vt.trimLeft(),vt.length>0&&(lt=this._getTextWidth(vt),lt<=xe)){this._addTextLine(vt),Oe+=fe,se=Math.max(se,lt);break}}else break}else this._addTextLine(vt),Oe+=fe,se=Math.max(se,lt),this._shouldHandleEllipsis(Oe)&&ht<ct-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),ve&&Oe+fe>Se)break}this.textHeight=oe,this.textWidth=se}_shouldHandleEllipsis(he){const oe=+this.fontSize(),se=this.lineHeight()*oe,fe=this.attrs.height,ae=fe!==o&&fe!==void 0,pe=this.padding(),ye=fe-pe*2;return!(this.wrap()!==V)||ae&&he+se>ye}_tryToAddEllipsisToLastLine(){const he=this.attrs.width,oe=he!==o&&he!==void 0,se=this.padding(),fe=he-se*2,ae=this.ellipsis(),pe=this.textArr[this.textArr.length-1];!pe||!ae||(oe&&(this._getTextWidth(pe.text+q)<fe||(pe.text=pe.text.slice(0,pe.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(pe.text+q))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const he=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,oe=this.hasShadow();return he&&oe?!0:super._useBufferCanvas()}}return wp.Text=X,X.prototype._fillFunc=Q,X.prototype._strokeFunc=ne,X.prototype.className=w,X.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,a._registerNode)(X),e.Factory.overWriteSetter(X,"width",(0,i.getNumberOrAutoValidator)()),e.Factory.overWriteSetter(X,"height",(0,i.getNumberOrAutoValidator)()),e.Factory.addGetterSetter(X,"direction",u),e.Factory.addGetterSetter(X,"fontFamily","Arial"),e.Factory.addGetterSetter(X,"fontSize",12,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(X,"fontStyle",N),e.Factory.addGetterSetter(X,"fontVariant",N),e.Factory.addGetterSetter(X,"padding",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(X,"align",y),e.Factory.addGetterSetter(X,"verticalAlign",C),e.Factory.addGetterSetter(X,"lineHeight",1,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(X,"wrap",F),e.Factory.addGetterSetter(X,"ellipsis",!1,(0,i.getBooleanValidator)()),e.Factory.addGetterSetter(X,"letterSpacing",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(X,"text","",(0,i.getStringValidator)()),e.Factory.addGetterSetter(X,"textDecoration",""),wp}var gg={},F5;function AG(){if(F5)return gg;F5=1,Object.defineProperty(gg,"__esModule",{value:!0}),gg.TextPath=void 0;const t=pi(),e=Ar(),r=xa(),n=__(),i=_L(),a=Dr(),s=Tr(),o="",l="normal";function u(p){p.fillText(this.partialText,0,0)}function c(p){p.strokeText(this.partialText,0,0)}let h=class extends r.Shape{constructor(g){super(g),this.dummyCanvas=t.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return n.Path.getPathLength(this.dataArray)}_getPointAtLength(g){if(!this.attrs.data)return null;const y=this.pathLength;return g-1>y?null:n.Path.getPointAtLengthOfDataArray(g,this.dataArray)}_readDataAttribute(){this.dataArray=n.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(g){g.setAttr("font",this._getContextFont()),g.setAttr("textBaseline",this.textBaseline()),g.setAttr("textAlign","left"),g.save();const y=this.textDecoration(),S=this.fill(),w=this.fontSize(),C=this.glyphInfo;y==="underline"&&g.beginPath();for(let _=0;_<C.length;_++){g.save();const T=C[_].p0;g.translate(T.x,T.y),g.rotate(C[_].rotation),this.partialText=C[_].text,g.fillStrokeShape(this),y==="underline"&&(_===0&&g.moveTo(0,w/2+1),g.lineTo(w,w/2+1)),g.restore()}y==="underline"&&(g.strokeStyle=S,g.lineWidth=w/20,g.stroke()),g.restore()}_hitFunc(g){g.beginPath();const y=this.glyphInfo;if(y.length>=1){const S=y[0].p0;g.moveTo(S.x,S.y)}for(let S=0;S<y.length;S++){const w=y[S].p1;g.lineTo(w.x,w.y)}g.setAttr("lineWidth",this.fontSize()),g.setAttr("strokeStyle",this.colorKey),g.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return t.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(g){return i.Text.prototype.setText.call(this,g)}_getContextFont(){return i.Text.prototype._getContextFont.call(this)}_getTextSize(g){const S=this.dummyCanvas.getContext("2d");S.save(),S.font=this._getContextFont();const w=S.measureText(g);return S.restore(),{width:w.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:g,height:y}=this._getTextSize(this.attrs.text);if(this.textWidth=g,this.textHeight=y,this.glyphInfo=[],!this.attrs.data)return null;const S=this.letterSpacing(),w=this.align(),C=this.kerningFunc(),_=Math.max(this.textWidth+((this.attrs.text||"").length-1)*S,0);let T=0;w==="center"&&(T=Math.max(0,this.pathLength/2-_/2)),w==="right"&&(T=Math.max(0,this.pathLength-_));const N=(0,i.stringToArray)(this.text());let R=T;for(let I=0;I<N.length;I++){const j=this._getPointAtLength(R);if(!j)return;let O=this._getTextSize(N[I]).width+S;if(N[I]===" "&&w==="justify"){const U=this.text().split(" ").length-1;O+=(this.pathLength-_)/U}const F=this._getPointAtLength(R+O);if(!F)return;const z=n.Path.getLineLength(j.x,j.y,F.x,F.y);let V=0;if(C)try{V=C(N[I-1],N[I])*this.fontSize()}catch{V=0}j.x+=V,F.x+=V,this.textWidth+=V;const q=n.Path.getPointOnLine(V+z/2,j.x,j.y,F.x,F.y),D=Math.atan2(F.y-j.y,F.x-j.x);this.glyphInfo.push({transposeX:q.x,transposeY:q.y,text:N[I],rotation:D,p0:j,p1:F}),R+=O}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const g=[];this.glyphInfo.forEach(function(R){g.push(R.p0.x),g.push(R.p0.y),g.push(R.p1.x),g.push(R.p1.y)});let y=g[0]||0,S=g[0]||0,w=g[1]||0,C=g[1]||0,_,T;for(let R=0;R<g.length/2;R++)_=g[R*2],T=g[R*2+1],y=Math.min(y,_),S=Math.max(S,_),w=Math.min(w,T),C=Math.max(C,T);const N=this.fontSize();return{x:y-N/2,y:w-N/2,width:S-y+N,height:C-w+N}}destroy(){return t.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return gg.TextPath=h,h.prototype._fillFunc=u,h.prototype._strokeFunc=c,h.prototype._fillFuncHit=u,h.prototype._strokeFuncHit=c,h.prototype.className="TextPath",h.prototype._attrsAffectingSize=["text","fontSize","data"],(0,s._registerNode)(h),e.Factory.addGetterSetter(h,"data"),e.Factory.addGetterSetter(h,"fontFamily","Arial"),e.Factory.addGetterSetter(h,"fontSize",12,(0,a.getNumberValidator)()),e.Factory.addGetterSetter(h,"fontStyle",l),e.Factory.addGetterSetter(h,"align","left"),e.Factory.addGetterSetter(h,"letterSpacing",0,(0,a.getNumberValidator)()),e.Factory.addGetterSetter(h,"textBaseline","middle"),e.Factory.addGetterSetter(h,"fontVariant",l),e.Factory.addGetterSetter(h,"text",o),e.Factory.addGetterSetter(h,"textDecoration",null),e.Factory.addGetterSetter(h,"kerningFunc",null),gg}var vg={},B5;function LG(){if(B5)return vg;B5=1,Object.defineProperty(vg,"__esModule",{value:!0}),vg.Transformer=void 0;const t=pi(),e=Ar(),r=Ei(),n=xa(),i=kL(),a=S_(),s=Tr(),o=Dr(),l=Tr(),u="tr-konva",c=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(O=>O+`.${u}`).join(" "),h="nodesRect",p=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],g={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},y="ontouchstart"in s.Konva._global;function S(O,F,z){if(O==="rotater")return z;F+=t.Util.degToRad(g[O]||0);const V=(t.Util.radToDeg(F)%360+360)%360;return t.Util._inRange(V,315+22.5,360)||t.Util._inRange(V,0,22.5)?"ns-resize":t.Util._inRange(V,45-22.5,45+22.5)?"nesw-resize":t.Util._inRange(V,90-22.5,90+22.5)?"ew-resize":t.Util._inRange(V,135-22.5,135+22.5)?"nwse-resize":t.Util._inRange(V,180-22.5,180+22.5)?"ns-resize":t.Util._inRange(V,225-22.5,225+22.5)?"nesw-resize":t.Util._inRange(V,270-22.5,270+22.5)?"ew-resize":t.Util._inRange(V,315-22.5,315+22.5)?"nwse-resize":(t.Util.error("Transformer has unknown angle for cursor detection: "+V),"pointer")}const w=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function C(O){return{x:O.x+O.width/2*Math.cos(O.rotation)+O.height/2*Math.sin(-O.rotation),y:O.y+O.height/2*Math.cos(O.rotation)+O.width/2*Math.sin(O.rotation)}}function _(O,F,z){const V=z.x+(O.x-z.x)*Math.cos(F)-(O.y-z.y)*Math.sin(F),q=z.y+(O.x-z.x)*Math.sin(F)+(O.y-z.y)*Math.cos(F);return{...O,rotation:O.rotation+F,x:V,y:q}}function T(O,F){const z=C(O);return _(O,F,z)}function N(O,F,z){let V=F;for(let q=0;q<O.length;q++){const D=s.Konva.getAngle(O[q]),U=Math.abs(D-F)%(Math.PI*2);Math.min(U,Math.PI*2-U)<z&&(V=D)}return V}let R=0;class I extends a.Group{constructor(F){super(F),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(c,this.update),this.getNode()&&this.update()}attachTo(F){return this.setNode(F),this}setNode(F){return t.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([F])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return u+this._id}setNodes(F=[]){this._nodes&&this._nodes.length&&this.detach();const z=F.filter(q=>q.isAncestorOf(this)?(t.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=F=z,F.length===1&&this.useSingleNodeRotation()?this.rotation(F[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(q=>{const D=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()},U=q._attrsAffectingSize.map(G=>G+"Change."+this._getEventNamespace()).join(" ");q.on(U,D),q.on(p.map(G=>G+`.${this._getEventNamespace()}`).join(" "),D),q.on(`absoluteTransformChange.${this._getEventNamespace()}`,D),this._proxyDrag(q)}),this._resetTransformCache(),this.findOne(".top-left")&&this.update(),this}_proxyDrag(F){let z;F.on(`dragstart.${this._getEventNamespace()}`,V=>{z=F.getAbsolutePosition(),!this.isDragging()&&F!==this.findOne(".back")&&this.startDrag(V,!1)}),F.on(`dragmove.${this._getEventNamespace()}`,V=>{if(!z)return;const q=F.getAbsolutePosition(),D=q.x-z.x,U=q.y-z.y;this.nodes().forEach(G=>{if(G===F||G.isDragging())return;const Z=G.getAbsolutePosition();G.setAbsolutePosition({x:Z.x+D,y:Z.y+U}),G.startDrag(V)}),z=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(F=>{F.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(h),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(h,this.__getNodeRect)}__getNodeShape(F,z=this.rotation(),V){const q=F.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),D=F.getAbsoluteScale(V),U=F.getAbsolutePosition(V),G=q.x*D.x-F.offsetX()*D.x,Z=q.y*D.y-F.offsetY()*D.y,K=(s.Konva.getAngle(F.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),Q={x:U.x+G*Math.cos(K)+Z*Math.sin(-K),y:U.y+Z*Math.cos(K)+G*Math.sin(K),width:q.width*D.x,height:q.height*D.y,rotation:K};return _(Q,-s.Konva.getAngle(z),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const z=[];this.nodes().map(K=>{const Q=K.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),ne=[{x:Q.x,y:Q.y},{x:Q.x+Q.width,y:Q.y},{x:Q.x+Q.width,y:Q.y+Q.height},{x:Q.x,y:Q.y+Q.height}],te=K.getAbsoluteTransform();ne.forEach(function(X){const re=te.point(X);z.push(re)})});const V=new t.Transform;V.rotate(-s.Konva.getAngle(this.rotation()));let q=1/0,D=1/0,U=-1/0,G=-1/0;z.forEach(function(K){const Q=V.point(K);q===void 0&&(q=U=Q.x,D=G=Q.y),q=Math.min(q,Q.x),D=Math.min(D,Q.y),U=Math.max(U,Q.x),G=Math.max(G,Q.y)}),V.invert();const Z=V.point({x:q,y:D});return{x:Z.x,y:Z.y,width:U-q,height:G-D,rotation:s.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),w.forEach(F=>{this._createAnchor(F)}),this._createAnchor("rotater")}_createAnchor(F){const z=new i.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:F+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:y?10:"auto"}),V=this;z.on("mousedown touchstart",function(q){V._handleMouseDown(q)}),z.on("dragstart",q=>{z.stopDrag(),q.cancelBubble=!0}),z.on("dragend",q=>{q.cancelBubble=!0}),z.on("mouseenter",()=>{const q=s.Konva.getAngle(this.rotation()),D=this.rotateAnchorCursor(),U=S(F,q,D);z.getStage().content&&(z.getStage().content.style.cursor=U),this._cursorChange=!0}),z.on("mouseout",()=>{z.getStage().content&&(z.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(z)}_createBack(){const F=new n.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(z,V){const q=V.getParent(),D=q.padding();z.beginPath(),z.rect(-D,-D,V.width()+D*2,V.height()+D*2),z.moveTo(V.width()/2,-D),q.rotateEnabled()&&q.rotateLineVisible()&&z.lineTo(V.width()/2,-q.rotateAnchorOffset()*t.Util._sign(V.height())-D),z.fillStrokeShape(V)},hitFunc:(z,V)=>{if(!this.shouldOverdrawWholeArea())return;const q=this.padding();z.beginPath(),z.rect(-q,-q,V.width()+q*2,V.height()+q*2),z.fillStrokeShape(V)}});this.add(F),this._proxyDrag(F),F.on("dragstart",z=>{z.cancelBubble=!0}),F.on("dragmove",z=>{z.cancelBubble=!0}),F.on("dragend",z=>{z.cancelBubble=!0}),this.on("dragmove",z=>{this.update()})}_handleMouseDown(F){if(this._transforming)return;this._movingAnchorName=F.target.name().split(" ")[0];const z=this._getNodeRect(),V=z.width,q=z.height,D=Math.sqrt(Math.pow(V,2)+Math.pow(q,2));this.sin=Math.abs(q/D),this.cos=Math.abs(V/D),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const U=F.target.getAbsolutePosition(),G=F.target.getStage().getPointerPosition();this._anchorDragOffset={x:G.x-U.x,y:G.y-U.y},R++,this._fire("transformstart",{evt:F.evt,target:this.getNode()}),this._nodes.forEach(Z=>{Z._fire("transformstart",{evt:F.evt,target:Z})})}_handleMouseMove(F){let z,V,q;const D=this.findOne("."+this._movingAnchorName),U=D.getStage();U.setPointersPositions(F);const G=U.getPointerPosition();let Z={x:G.x-this._anchorDragOffset.x,y:G.y-this._anchorDragOffset.y};const K=D.getAbsolutePosition();this.anchorDragBoundFunc()&&(Z=this.anchorDragBoundFunc()(K,Z,F)),D.setAbsolutePosition(Z);const Q=D.getAbsolutePosition();if(K.x===Q.x&&K.y===Q.y)return;if(this._movingAnchorName==="rotater"){const ye=this._getNodeRect();z=D.x()-ye.width/2,V=-D.y()+ye.height/2;let ve=Math.atan2(-V,z)+Math.PI/2;ye.height<0&&(ve-=Math.PI);const xe=s.Konva.getAngle(this.rotation())+ve,Se=s.Konva.getAngle(this.rotationSnapTolerance()),Ae=N(this.rotationSnaps(),xe,Se)-ye.rotation,tt=T(ye,Ae);this._fitNodesInto(tt,F);return}const ne=this.shiftBehavior();let te;ne==="inverted"?te=this.keepRatio()&&!F.shiftKey:ne==="none"?te=this.keepRatio():te=this.keepRatio()||F.shiftKey;var se=this.centeredScaling()||F.altKey;if(this._movingAnchorName==="top-left"){if(te){var X=se?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};q=Math.sqrt(Math.pow(X.x-D.x(),2)+Math.pow(X.y-D.y(),2));var re=this.findOne(".top-left").x()>X.x?-1:1,he=this.findOne(".top-left").y()>X.y?-1:1;z=q*this.cos*re,V=q*this.sin*he,this.findOne(".top-left").x(X.x-z),this.findOne(".top-left").y(X.y-V)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(D.y());else if(this._movingAnchorName==="top-right"){if(te){var X=se?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};q=Math.sqrt(Math.pow(D.x()-X.x,2)+Math.pow(X.y-D.y(),2));var re=this.findOne(".top-right").x()<X.x?-1:1,he=this.findOne(".top-right").y()>X.y?-1:1;z=q*this.cos*re,V=q*this.sin*he,this.findOne(".top-right").x(X.x+z),this.findOne(".top-right").y(X.y-V)}var oe=D.position();this.findOne(".top-left").y(oe.y),this.findOne(".bottom-right").x(oe.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(D.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(D.x());else if(this._movingAnchorName==="bottom-left"){if(te){var X=se?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};q=Math.sqrt(Math.pow(X.x-D.x(),2)+Math.pow(D.y()-X.y,2));var re=X.x<D.x()?-1:1,he=D.y()<X.y?-1:1;z=q*this.cos*re,V=q*this.sin*he,D.x(X.x-z),D.y(X.y+V)}oe=D.position(),this.findOne(".top-left").x(oe.x),this.findOne(".bottom-right").y(oe.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(D.y());else if(this._movingAnchorName==="bottom-right"){if(te){var X=se?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};q=Math.sqrt(Math.pow(D.x()-X.x,2)+Math.pow(D.y()-X.y,2));var re=this.findOne(".bottom-right").x()<X.x?-1:1,he=this.findOne(".bottom-right").y()<X.y?-1:1;z=q*this.cos*re,V=q*this.sin*he,this.findOne(".bottom-right").x(X.x+z),this.findOne(".bottom-right").y(X.y+V)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var se=this.centeredScaling()||F.altKey;if(se){const ye=this.findOne(".top-left"),ve=this.findOne(".bottom-right"),ue=ye.x(),xe=ye.y(),Se=this.getWidth()-ve.x(),Oe=this.getHeight()-ve.y();ve.move({x:-ue,y:-xe}),ye.move({x:Se,y:Oe})}const fe=this.findOne(".top-left").getAbsolutePosition();z=fe.x,V=fe.y;const ae=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),pe=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:z,y:V,width:ae,height:pe,rotation:s.Konva.getAngle(this.rotation())},F)}_handleMouseUp(F){this._removeEvents(F)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(F){var z;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const V=this.getNode();R--,this._fire("transformend",{evt:F,target:V}),(z=this.getLayer())===null||z===void 0||z.batchDraw(),V&&this._nodes.forEach(q=>{var D;q._fire("transformend",{evt:F,target:q}),(D=q.getLayer())===null||D===void 0||D.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(F,z){const V=this._getNodeRect(),q=1;if(t.Util._inRange(F.width,-this.padding()*2-q,q)){this.update();return}if(t.Util._inRange(F.height,-this.padding()*2-q,q)){this.update();return}const D=new t.Transform;if(D.rotate(s.Konva.getAngle(this.rotation())),this._movingAnchorName&&F.width<0&&this._movingAnchorName.indexOf("left")>=0){const te=D.point({x:-this.padding()*2,y:0});F.x+=te.x,F.y+=te.y,F.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=te.x,this._anchorDragOffset.y-=te.y}else if(this._movingAnchorName&&F.width<0&&this._movingAnchorName.indexOf("right")>=0){const te=D.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=te.x,this._anchorDragOffset.y-=te.y,F.width+=this.padding()*2}if(this._movingAnchorName&&F.height<0&&this._movingAnchorName.indexOf("top")>=0){const te=D.point({x:0,y:-this.padding()*2});F.x+=te.x,F.y+=te.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=te.x,this._anchorDragOffset.y-=te.y,F.height+=this.padding()*2}else if(this._movingAnchorName&&F.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const te=D.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=te.x,this._anchorDragOffset.y-=te.y,F.height+=this.padding()*2}if(this.boundBoxFunc()){const te=this.boundBoxFunc()(V,F);te?F=te:t.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const U=1e7,G=new t.Transform;G.translate(V.x,V.y),G.rotate(V.rotation),G.scale(V.width/U,V.height/U);const Z=new t.Transform,K=F.width/U,Q=F.height/U;this.flipEnabled()===!1?(Z.translate(F.x,F.y),Z.rotate(F.rotation),Z.translate(F.width<0?F.width:0,F.height<0?F.height:0),Z.scale(Math.abs(K),Math.abs(Q))):(Z.translate(F.x,F.y),Z.rotate(F.rotation),Z.scale(K,Q));const ne=Z.multiply(G.invert());this._nodes.forEach(te=>{var X;const re=te.getParent().getAbsoluteTransform(),he=te.getTransform().copy();he.translate(te.offsetX(),te.offsetY());const oe=new t.Transform;oe.multiply(re.copy().invert()).multiply(ne).multiply(re).multiply(he);const se=oe.decompose();te.setAttrs(se),(X=te.getLayer())===null||X===void 0||X.batchDraw()}),this.rotation(t.Util._getRotation(F.rotation)),this._nodes.forEach(te=>{this._fire("transform",{evt:z,target:te}),te._fire("transform",{evt:z,target:te})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(F,z){this.findOne(F).setAttrs(z)}update(){var F;const z=this._getNodeRect();this.rotation(t.Util._getRotation(z.rotation));const V=z.width,q=z.height,D=this.enabledAnchors(),U=this.resizeEnabled(),G=this.padding(),Z=this.anchorSize(),K=this.find("._anchor");K.forEach(ne=>{ne.setAttrs({width:Z,height:Z,offsetX:Z/2,offsetY:Z/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:Z/2+G,offsetY:Z/2+G,visible:U&&D.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:V/2,y:0,offsetY:Z/2+G,visible:U&&D.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:V,y:0,offsetX:Z/2-G,offsetY:Z/2+G,visible:U&&D.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:q/2,offsetX:Z/2+G,visible:U&&D.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:V,y:q/2,offsetX:Z/2-G,visible:U&&D.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:q,offsetX:Z/2+G,offsetY:Z/2-G,visible:U&&D.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:V/2,y:q,offsetY:Z/2-G,visible:U&&D.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:V,y:q,offsetX:Z/2-G,offsetY:Z/2-G,visible:U&&D.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:V/2,y:-this.rotateAnchorOffset()*t.Util._sign(q)-G,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:V,height:q,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const Q=this.anchorStyleFunc();Q&&K.forEach(ne=>{Q(ne)}),(F=this.getLayer())===null||F===void 0||F.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const F=this.findOne("."+this._movingAnchorName);F&&F.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),a.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return r.Node.prototype.toObject.call(this)}clone(F){return r.Node.prototype.clone.call(this,F)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}vg.Transformer=I,I.isTransforming=()=>R>0;function j(O){return O instanceof Array||t.Util.warn("enabledAnchors value should be an array"),O instanceof Array&&O.forEach(function(F){w.indexOf(F)===-1&&t.Util.warn("Unknown anchor name: "+F+". Available names are: "+w.join(", "))}),O||[]}return I.prototype.className="Transformer",(0,l._registerNode)(I),e.Factory.addGetterSetter(I,"enabledAnchors",w,j),e.Factory.addGetterSetter(I,"flipEnabled",!0,(0,o.getBooleanValidator)()),e.Factory.addGetterSetter(I,"resizeEnabled",!0),e.Factory.addGetterSetter(I,"anchorSize",10,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"rotateEnabled",!0),e.Factory.addGetterSetter(I,"rotateLineVisible",!0),e.Factory.addGetterSetter(I,"rotationSnaps",[]),e.Factory.addGetterSetter(I,"rotateAnchorOffset",50,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"rotateAnchorCursor","crosshair"),e.Factory.addGetterSetter(I,"rotationSnapTolerance",5,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"borderEnabled",!0),e.Factory.addGetterSetter(I,"anchorStroke","rgb(0, 161, 255)"),e.Factory.addGetterSetter(I,"anchorStrokeWidth",1,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"anchorFill","white"),e.Factory.addGetterSetter(I,"anchorCornerRadius",0,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"borderStroke","rgb(0, 161, 255)"),e.Factory.addGetterSetter(I,"borderStrokeWidth",1,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"borderDash"),e.Factory.addGetterSetter(I,"keepRatio",!0),e.Factory.addGetterSetter(I,"shiftBehavior","default"),e.Factory.addGetterSetter(I,"centeredScaling",!1),e.Factory.addGetterSetter(I,"ignoreStroke",!1),e.Factory.addGetterSetter(I,"padding",0,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"node"),e.Factory.addGetterSetter(I,"nodes"),e.Factory.addGetterSetter(I,"boundBoxFunc"),e.Factory.addGetterSetter(I,"anchorDragBoundFunc"),e.Factory.addGetterSetter(I,"anchorStyleFunc"),e.Factory.addGetterSetter(I,"shouldOverdrawWholeArea",!1),e.Factory.addGetterSetter(I,"useSingleNodeRotation",!0),e.Factory.backCompat(I,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),vg}var yg={},z5;function RG(){if(z5)return yg;z5=1,Object.defineProperty(yg,"__esModule",{value:!0}),yg.Wedge=void 0;const t=Ar(),e=xa(),r=Tr(),n=Dr(),i=Tr();let a=class extends e.Shape{_sceneFunc(o){o.beginPath(),o.arc(0,0,this.radius(),0,r.Konva.getAngle(this.angle()),this.clockwise()),o.lineTo(0,0),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(o){this.radius(o/2)}setHeight(o){this.radius(o/2)}};return yg.Wedge=a,a.prototype.className="Wedge",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["radius"],(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"radius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"clockwise",!1),t.Factory.backCompat(a,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),yg}var xg={},U5;function OG(){if(U5)return xg;U5=1,Object.defineProperty(xg,"__esModule",{value:!0}),xg.Blur=void 0;const t=Ar(),e=Ei(),r=Dr();function n(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],a=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function s(l,u){const c=l.data,h=l.width,p=l.height;let g,y,S,w,C,_,T,N,R,I,j,O,F,z,V,q,D,U,G,Z,K,Q,ne,te,X=u+u+1,re=h-1,he=p-1,oe=u+1,se=oe*(oe+1)/2,fe=new n,ae=null,pe=fe,ye=null,ve=null,ue=i[u],xe=a[u];for(S=1;S<X;S++)pe=pe.next=new n,S===oe&&(ae=pe);for(pe.next=fe,T=_=0,y=0;y<p;y++){for(q=D=U=G=N=R=I=j=0,O=oe*(Z=c[_]),F=oe*(K=c[_+1]),z=oe*(Q=c[_+2]),V=oe*(ne=c[_+3]),N+=se*Z,R+=se*K,I+=se*Q,j+=se*ne,pe=fe,S=0;S<oe;S++)pe.r=Z,pe.g=K,pe.b=Q,pe.a=ne,pe=pe.next;for(S=1;S<oe;S++)w=_+((re<S?re:S)<<2),N+=(pe.r=Z=c[w])*(te=oe-S),R+=(pe.g=K=c[w+1])*te,I+=(pe.b=Q=c[w+2])*te,j+=(pe.a=ne=c[w+3])*te,q+=Z,D+=K,U+=Q,G+=ne,pe=pe.next;for(ye=fe,ve=ae,g=0;g<h;g++)c[_+3]=ne=j*ue>>xe,ne!==0?(ne=255/ne,c[_]=(N*ue>>xe)*ne,c[_+1]=(R*ue>>xe)*ne,c[_+2]=(I*ue>>xe)*ne):c[_]=c[_+1]=c[_+2]=0,N-=O,R-=F,I-=z,j-=V,O-=ye.r,F-=ye.g,z-=ye.b,V-=ye.a,w=T+((w=g+u+1)<re?w:re)<<2,q+=ye.r=c[w],D+=ye.g=c[w+1],U+=ye.b=c[w+2],G+=ye.a=c[w+3],N+=q,R+=D,I+=U,j+=G,ye=ye.next,O+=Z=ve.r,F+=K=ve.g,z+=Q=ve.b,V+=ne=ve.a,q-=Z,D-=K,U-=Q,G-=ne,ve=ve.next,_+=4;T+=h}for(g=0;g<h;g++){for(D=U=G=q=R=I=j=N=0,_=g<<2,O=oe*(Z=c[_]),F=oe*(K=c[_+1]),z=oe*(Q=c[_+2]),V=oe*(ne=c[_+3]),N+=se*Z,R+=se*K,I+=se*Q,j+=se*ne,pe=fe,S=0;S<oe;S++)pe.r=Z,pe.g=K,pe.b=Q,pe.a=ne,pe=pe.next;for(C=h,S=1;S<=u;S++)_=C+g<<2,N+=(pe.r=Z=c[_])*(te=oe-S),R+=(pe.g=K=c[_+1])*te,I+=(pe.b=Q=c[_+2])*te,j+=(pe.a=ne=c[_+3])*te,q+=Z,D+=K,U+=Q,G+=ne,pe=pe.next,S<he&&(C+=h);for(_=g,ye=fe,ve=ae,y=0;y<p;y++)w=_<<2,c[w+3]=ne=j*ue>>xe,ne>0?(ne=255/ne,c[w]=(N*ue>>xe)*ne,c[w+1]=(R*ue>>xe)*ne,c[w+2]=(I*ue>>xe)*ne):c[w]=c[w+1]=c[w+2]=0,N-=O,R-=F,I-=z,j-=V,O-=ye.r,F-=ye.g,z-=ye.b,V-=ye.a,w=g+((w=y+oe)<he?w:he)*h<<2,N+=q+=ye.r=c[w],R+=D+=ye.g=c[w+1],I+=U+=ye.b=c[w+2],j+=G+=ye.a=c[w+3],ye=ye.next,O+=Z=ve.r,F+=K=ve.g,z+=Q=ve.b,V+=ne=ve.a,q-=Z,D-=K,U-=Q,G-=ne,ve=ve.next,_+=h}}const o=function(u){const c=Math.round(this.blurRadius());c>0&&s(u,c)};return xg.Blur=o,t.Factory.addGetterSetter(e.Node,"blurRadius",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),xg}var bg={},G5;function DG(){if(G5)return bg;G5=1,Object.defineProperty(bg,"__esModule",{value:!0}),bg.Brighten=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){let a=this.brightness()*255,s=i.data,o=s.length,l;for(l=0;l<o;l+=4)s[l]+=a,s[l+1]+=a,s[l+2]+=a};return bg.Brighten=n,t.Factory.addGetterSetter(e.Node,"brightness",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),bg}var wg={},V5;function IG(){if(V5)return wg;V5=1,Object.defineProperty(wg,"__esModule",{value:!0}),wg.Contrast=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){const a=Math.pow((this.contrast()+100)/100,2);let s=i.data,o=s.length,l=150,u=150,c=150,h;for(h=0;h<o;h+=4)l=s[h],u=s[h+1],c=s[h+2],l/=255,l-=.5,l*=a,l+=.5,l*=255,u/=255,u-=.5,u*=a,u+=.5,u*=255,c/=255,c-=.5,c*=a,c+=.5,c*=255,l=l<0?0:l>255?255:l,u=u<0?0:u>255?255:u,c=c<0?0:c>255?255:c,s[h]=l,s[h+1]=u,s[h+2]=c};return wg.Contrast=n,t.Factory.addGetterSetter(e.Node,"contrast",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),wg}var Sg={},H5;function jG(){if(H5)return Sg;H5=1,Object.defineProperty(Sg,"__esModule",{value:!0}),Sg.Emboss=void 0;const t=Ar(),e=Ei(),r=pi(),n=Dr(),i=function(a){let s=this.embossStrength()*10,o=this.embossWhiteLevel()*255,l=this.embossDirection(),u=this.embossBlend(),c=0,h=0,p=a.data,g=a.width,y=a.height,S=g*4,w=y;switch(l){case"top-left":c=-1,h=-1;break;case"top":c=-1,h=0;break;case"top-right":c=-1,h=1;break;case"right":c=0,h=1;break;case"bottom-right":c=1,h=1;break;case"bottom":c=1,h=0;break;case"bottom-left":c=1,h=-1;break;case"left":c=0,h=-1;break;default:r.Util.error("Unknown emboss direction: "+l)}do{const C=(w-1)*S;let _=c;w+_<1&&(_=0),w+_>y&&(_=0);const T=(w-1+_)*g*4;let N=g;do{const R=C+(N-1)*4;let I=h;N+I<1&&(I=0),N+I>g&&(I=0);const j=T+(N-1+I)*4,O=p[R]-p[j],F=p[R+1]-p[j+1],z=p[R+2]-p[j+2];let V=O;const q=V>0?V:-V,D=F>0?F:-F,U=z>0?z:-z;if(D>q&&(V=F),U>q&&(V=z),V*=s,u){const G=p[R]+V,Z=p[R+1]+V,K=p[R+2]+V;p[R]=G>255?255:G<0?0:G,p[R+1]=Z>255?255:Z<0?0:Z,p[R+2]=K>255?255:K<0?0:K}else{let G=o-V;G<0?G=0:G>255&&(G=255),p[R]=p[R+1]=p[R+2]=G}}while(--N)}while(--w)};return Sg.Emboss=i,t.Factory.addGetterSetter(e.Node,"embossStrength",.5,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossWhiteLevel",.5,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossDirection","top-left",null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossBlend",!1,null,t.Factory.afterSetFilter),Sg}var kg={},W5;function FG(){if(W5)return kg;W5=1,Object.defineProperty(kg,"__esModule",{value:!0}),kg.Enhance=void 0;const t=Ar(),e=Ei(),r=Dr();function n(a,s,o,l,u){let c=o-s,h=u-l,p;return c===0?l+h/2:h===0?l:(p=(a-s)/c,p=h*p+l,p)}const i=function(a){let s=a.data,o=s.length,l=s[0],u=l,c,h=s[1],p=h,g,y=s[2],S=y,w,C;const _=this.enhance();if(_===0)return;for(C=0;C<o;C+=4)c=s[C+0],c<l?l=c:c>u&&(u=c),g=s[C+1],g<h?h=g:g>p&&(p=g),w=s[C+2],w<y?y=w:w>S&&(S=w);u===l&&(u=255,l=0),p===h&&(p=255,h=0),S===y&&(S=255,y=0);let T,N,R,I,j,O,F,z,V;for(_>0?(N=u+_*(255-u),R=l-_*(l-0),j=p+_*(255-p),O=h-_*(h-0),z=S+_*(255-S),V=y-_*(y-0)):(T=(u+l)*.5,N=u+_*(u-T),R=l+_*(l-T),I=(p+h)*.5,j=p+_*(p-I),O=h+_*(h-I),F=(S+y)*.5,z=S+_*(S-F),V=y+_*(y-F)),C=0;C<o;C+=4)s[C+0]=n(s[C+0],l,u,R,N),s[C+1]=n(s[C+1],h,p,O,j),s[C+2]=n(s[C+2],y,S,V,z)};return kg.Enhance=i,t.Factory.addGetterSetter(e.Node,"enhance",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),kg}var _g={},q5;function BG(){if(q5)return _g;q5=1,Object.defineProperty(_g,"__esModule",{value:!0}),_g.Grayscale=void 0;const t=function(e){let r=e.data,n=r.length,i,a;for(i=0;i<n;i+=4)a=.34*r[i]+.5*r[i+1]+.16*r[i+2],r[i]=a,r[i+1]=a,r[i+2]=a};return _g.Grayscale=t,_g}var Cg={},$5;function zG(){if($5)return Cg;$5=1,Object.defineProperty(Cg,"__esModule",{value:!0}),Cg.HSL=void 0;const t=Ar(),e=Ei(),r=Dr();t.Factory.addGetterSetter(e.Node,"hue",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"saturation",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"luminance",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter);const n=function(i){let a=i.data,s=a.length,o=1,l=Math.pow(2,this.saturation()),u=Math.abs(this.hue()+360)%360,c=this.luminance()*127,h;const p=o*l*Math.cos(u*Math.PI/180),g=o*l*Math.sin(u*Math.PI/180),y=.299*o+.701*p+.167*g,S=.587*o-.587*p+.33*g,w=.114*o-.114*p-.497*g,C=.299*o-.299*p-.328*g,_=.587*o+.413*p+.035*g,T=.114*o-.114*p+.293*g,N=.299*o-.3*p+1.25*g,R=.587*o-.586*p-1.05*g,I=.114*o+.886*p-.2*g;let j,O,F,z;for(h=0;h<s;h+=4)j=a[h+0],O=a[h+1],F=a[h+2],z=a[h+3],a[h+0]=y*j+S*O+w*F+c,a[h+1]=C*j+_*O+T*F+c,a[h+2]=N*j+R*O+I*F+c,a[h+3]=z};return Cg.HSL=n,Cg}var Eg={},K5;function UG(){if(K5)return Eg;K5=1,Object.defineProperty(Eg,"__esModule",{value:!0}),Eg.HSV=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){const a=i.data,s=a.length,o=Math.pow(2,this.value()),l=Math.pow(2,this.saturation()),u=Math.abs(this.hue()+360)%360,c=o*l*Math.cos(u*Math.PI/180),h=o*l*Math.sin(u*Math.PI/180),p=.299*o+.701*c+.167*h,g=.587*o-.587*c+.33*h,y=.114*o-.114*c-.497*h,S=.299*o-.299*c-.328*h,w=.587*o+.413*c+.035*h,C=.114*o-.114*c+.293*h,_=.299*o-.3*c+1.25*h,T=.587*o-.586*c-1.05*h,N=.114*o+.886*c-.2*h;let R,I,j,O;for(let F=0;F<s;F+=4)R=a[F+0],I=a[F+1],j=a[F+2],O=a[F+3],a[F+0]=p*R+g*I+y*j,a[F+1]=S*R+w*I+C*j,a[F+2]=_*R+T*I+N*j,a[F+3]=O};return Eg.HSV=n,t.Factory.addGetterSetter(e.Node,"hue",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"saturation",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"value",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Eg}var Tg={},Z5;function GG(){if(Z5)return Tg;Z5=1,Object.defineProperty(Tg,"__esModule",{value:!0}),Tg.Invert=void 0;const t=function(e){let r=e.data,n=r.length,i;for(i=0;i<n;i+=4)r[i]=255-r[i],r[i+1]=255-r[i+1],r[i+2]=255-r[i+2]};return Tg.Invert=t,Tg}var Ng={},Y5;function VG(){if(Y5)return Ng;Y5=1,Object.defineProperty(Ng,"__esModule",{value:!0}),Ng.Kaleidoscope=void 0;const t=Ar(),e=Ei(),r=pi(),n=Dr(),i=function(o,l,u){let c=o.data,h=l.data,p=o.width,g=o.height,y=u.polarCenterX||p/2,S=u.polarCenterY||g/2,w,C,_,T=0,N=0,R=0,I=0,j,O=Math.sqrt(y*y+S*S);C=p-y,_=g-S,j=Math.sqrt(C*C+_*_),O=j>O?j:O;let F=g,z=p,V,q,D=360/z*Math.PI/180,U,G;for(q=0;q<z;q+=1)for(U=Math.sin(q*D),G=Math.cos(q*D),V=0;V<F;V+=1)C=Math.floor(y+O*V/F*G),_=Math.floor(S+O*V/F*U),w=(_*p+C)*4,T=c[w+0],N=c[w+1],R=c[w+2],I=c[w+3],w=(q+V*p)*4,h[w+0]=T,h[w+1]=N,h[w+2]=R,h[w+3]=I},a=function(o,l,u){let c=o.data,h=l.data,p=o.width,g=o.height,y=u.polarCenterX||p/2,S=u.polarCenterY||g/2,w,C,_,T,N,R=0,I=0,j=0,O=0,F,z=Math.sqrt(y*y+S*S);C=p-y,_=g-S,F=Math.sqrt(C*C+_*_),z=F>z?F:z;let V=g,q=p,D,U,G=0,Z,K;for(C=0;C<p;C+=1)for(_=0;_<g;_+=1)T=C-y,N=_-S,D=Math.sqrt(T*T+N*N)*V/z,U=(Math.atan2(N,T)*180/Math.PI+360+G)%360,U=U*q/360,Z=Math.floor(U),K=Math.floor(D),w=(K*p+Z)*4,R=c[w+0],I=c[w+1],j=c[w+2],O=c[w+3],w=(_*p+C)*4,h[w+0]=R,h[w+1]=I,h[w+2]=j,h[w+3]=O},s=function(o){const l=o.width,u=o.height;let c,h,p,g,y,S,w,C,_,T,N=Math.round(this.kaleidoscopePower());const R=Math.round(this.kaleidoscopeAngle()),I=Math.floor(l*(R%360)/360);if(N<1)return;const j=r.Util.createCanvasElement();j.width=l,j.height=u;const O=j.getContext("2d").getImageData(0,0,l,u);r.Util.releaseCanvas(j),i(o,O,{polarCenterX:l/2,polarCenterY:u/2});let F=l/Math.pow(2,N);for(;F<=8;)F=F*2,N-=1;F=Math.ceil(F);let z=F,V=0,q=z,D=1;for(I+F>l&&(V=z,q=0,D=-1),h=0;h<u;h+=1)for(c=V;c!==q;c+=D)p=Math.round(c+I)%l,_=(l*h+p)*4,y=O.data[_+0],S=O.data[_+1],w=O.data[_+2],C=O.data[_+3],T=(l*h+c)*4,O.data[T+0]=y,O.data[T+1]=S,O.data[T+2]=w,O.data[T+3]=C;for(h=0;h<u;h+=1)for(z=Math.floor(F),g=0;g<N;g+=1){for(c=0;c<z+1;c+=1)_=(l*h+c)*4,y=O.data[_+0],S=O.data[_+1],w=O.data[_+2],C=O.data[_+3],T=(l*h+z*2-c-1)*4,O.data[T+0]=y,O.data[T+1]=S,O.data[T+2]=w,O.data[T+3]=C;z*=2}a(O,o,{})};return Ng.Kaleidoscope=s,t.Factory.addGetterSetter(e.Node,"kaleidoscopePower",2,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"kaleidoscopeAngle",0,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),Ng}var Pg={},X5;function HG(){if(X5)return Pg;X5=1,Object.defineProperty(Pg,"__esModule",{value:!0}),Pg.Mask=void 0;const t=Ar(),e=Ei(),r=Dr();function n(p,g,y){let S=(y*p.width+g)*4;const w=[];return w.push(p.data[S++],p.data[S++],p.data[S++],p.data[S++]),w}function i(p,g){return Math.sqrt(Math.pow(p[0]-g[0],2)+Math.pow(p[1]-g[1],2)+Math.pow(p[2]-g[2],2))}function a(p){const g=[0,0,0];for(let y=0;y<p.length;y++)g[0]+=p[y][0],g[1]+=p[y][1],g[2]+=p[y][2];return g[0]/=p.length,g[1]/=p.length,g[2]/=p.length,g}function s(p,g){const y=n(p,0,0),S=n(p,p.width-1,0),w=n(p,0,p.height-1),C=n(p,p.width-1,p.height-1),_=g||10;if(i(y,S)<_&&i(S,C)<_&&i(C,w)<_&&i(w,y)<_){const T=a([S,y,C,w]),N=[];for(let R=0;R<p.width*p.height;R++){const I=i(T,[p.data[R*4],p.data[R*4+1],p.data[R*4+2]]);N[R]=I<_?0:255}return N}}function o(p,g){for(let y=0;y<p.width*p.height;y++)p.data[4*y+3]=g[y]}function l(p,g,y){const S=[1,1,1,1,0,1,1,1,1],w=Math.round(Math.sqrt(S.length)),C=Math.floor(w/2),_=[];for(let T=0;T<y;T++)for(let N=0;N<g;N++){const R=T*g+N;let I=0;for(let j=0;j<w;j++)for(let O=0;O<w;O++){const F=T+j-C,z=N+O-C;if(F>=0&&F<y&&z>=0&&z<g){const V=F*g+z,q=S[j*w+O];I+=p[V]*q}}_[R]=I===2040?255:0}return _}function u(p,g,y){const S=[1,1,1,1,1,1,1,1,1],w=Math.round(Math.sqrt(S.length)),C=Math.floor(w/2),_=[];for(let T=0;T<y;T++)for(let N=0;N<g;N++){const R=T*g+N;let I=0;for(let j=0;j<w;j++)for(let O=0;O<w;O++){const F=T+j-C,z=N+O-C;if(F>=0&&F<y&&z>=0&&z<g){const V=F*g+z,q=S[j*w+O];I+=p[V]*q}}_[R]=I>=1020?255:0}return _}function c(p,g,y){const S=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],w=Math.round(Math.sqrt(S.length)),C=Math.floor(w/2),_=[];for(let T=0;T<y;T++)for(let N=0;N<g;N++){const R=T*g+N;let I=0;for(let j=0;j<w;j++)for(let O=0;O<w;O++){const F=T+j-C,z=N+O-C;if(F>=0&&F<y&&z>=0&&z<g){const V=F*g+z,q=S[j*w+O];I+=p[V]*q}}_[R]=I}return _}const h=function(p){let g=this.threshold(),y=s(p,g);return y&&(y=l(y,p.width,p.height),y=u(y,p.width,p.height),y=c(y,p.width,p.height),o(p,y)),p};return Pg.Mask=h,t.Factory.addGetterSetter(e.Node,"threshold",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Pg}var Mg={},Q5;function WG(){if(Q5)return Mg;Q5=1,Object.defineProperty(Mg,"__esModule",{value:!0}),Mg.Noise=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){const a=this.noise()*255,s=i.data,o=s.length,l=a/2;for(let u=0;u<o;u+=4)s[u+0]+=l-2*l*Math.random(),s[u+1]+=l-2*l*Math.random(),s[u+2]+=l-2*l*Math.random()};return Mg.Noise=n,t.Factory.addGetterSetter(e.Node,"noise",.2,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Mg}var Ag={},J5;function qG(){if(J5)return Ag;J5=1,Object.defineProperty(Ag,"__esModule",{value:!0}),Ag.Pixelate=void 0;const t=Ar(),e=pi(),r=Ei(),n=Dr(),i=function(a){let s=Math.ceil(this.pixelSize()),o=a.width,l=a.height,u,c,h,p,g,y,S,w=Math.ceil(o/s),C=Math.ceil(l/s),_,T,N,R,I,j,O,F=a.data;if(s<=0){e.Util.error("pixelSize value can not be <= 0");return}for(I=0;I<w;I+=1)for(j=0;j<C;j+=1){for(p=0,g=0,y=0,S=0,_=I*s,T=_+s,N=j*s,R=N+s,O=0,u=_;u<T;u+=1)if(!(u>=o))for(c=N;c<R;c+=1)c>=l||(h=(o*c+u)*4,p+=F[h+0],g+=F[h+1],y+=F[h+2],S+=F[h+3],O+=1);for(p=p/O,g=g/O,y=y/O,S=S/O,u=_;u<T;u+=1)if(!(u>=o))for(c=N;c<R;c+=1)c>=l||(h=(o*c+u)*4,F[h+0]=p,F[h+1]=g,F[h+2]=y,F[h+3]=S)}};return Ag.Pixelate=i,t.Factory.addGetterSetter(r.Node,"pixelSize",8,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),Ag}var Lg={},e4;function $G(){if(e4)return Lg;e4=1,Object.defineProperty(Lg,"__esModule",{value:!0}),Lg.Posterize=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){let a=Math.round(this.levels()*254)+1,s=i.data,o=s.length,l=255/a,u;for(u=0;u<o;u+=1)s[u]=Math.floor(s[u]/l)*l};return Lg.Posterize=n,t.Factory.addGetterSetter(e.Node,"levels",.5,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Lg}var Rg={},t4;function KG(){if(t4)return Rg;t4=1,Object.defineProperty(Rg,"__esModule",{value:!0}),Rg.RGB=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){let a=i.data,s=a.length,o=this.red(),l=this.green(),u=this.blue(),c,h;for(c=0;c<s;c+=4)h=(.34*a[c]+.5*a[c+1]+.16*a[c+2])/255,a[c]=h*o,a[c+1]=h*l,a[c+2]=h*u,a[c+3]=a[c+3]};return Rg.RGB=n,t.Factory.addGetterSetter(e.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"blue",0,r.RGBComponent,t.Factory.afterSetFilter),Rg}var Og={},r4;function ZG(){if(r4)return Og;r4=1,Object.defineProperty(Og,"__esModule",{value:!0}),Og.RGBA=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){const a=i.data,s=a.length,o=this.red(),l=this.green(),u=this.blue(),c=this.alpha();for(let h=0;h<s;h+=4){const p=1-c;a[h]=o*c+a[h]*p,a[h+1]=l*c+a[h+1]*p,a[h+2]=u*c+a[h+2]*p}};return Og.RGBA=n,t.Factory.addGetterSetter(e.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"blue",0,r.RGBComponent,t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"alpha",1,function(i){return this._filterUpToDate=!1,i>1?1:i<0?0:i}),Og}var Dg={},n4;function YG(){if(n4)return Dg;n4=1,Object.defineProperty(Dg,"__esModule",{value:!0}),Dg.Sepia=void 0;const t=function(e){let r=e.data,n=r.length,i,a,s,o;for(i=0;i<n;i+=4)a=r[i+0],s=r[i+1],o=r[i+2],r[i+0]=Math.min(255,a*.393+s*.769+o*.189),r[i+1]=Math.min(255,a*.349+s*.686+o*.168),r[i+2]=Math.min(255,a*.272+s*.534+o*.131)};return Dg.Sepia=t,Dg}var Ig={},i4;function XG(){if(i4)return Ig;i4=1,Object.defineProperty(Ig,"__esModule",{value:!0}),Ig.Solarize=void 0;const t=function(e){const r=e.data,n=e.width,i=e.height,a=n*4;let s=i;do{const o=(s-1)*a;let l=n;do{const u=o+(l-1)*4;let c=r[u],h=r[u+1],p=r[u+2];c>127&&(c=255-c),h>127&&(h=255-h),p>127&&(p=255-p),r[u]=c,r[u+1]=h,r[u+2]=p}while(--l)}while(--s)};return Ig.Solarize=t,Ig}var jg={},a4;function QG(){if(a4)return jg;a4=1,Object.defineProperty(jg,"__esModule",{value:!0}),jg.Threshold=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){const a=this.threshold()*255,s=i.data,o=s.length;for(let l=0;l<o;l+=1)s[l]=s[l]<a?0:255};return jg.Threshold=n,t.Factory.addGetterSetter(e.Node,"threshold",.5,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),jg}var s4;function JG(){if(s4)return Xm;s4=1,Object.defineProperty(Xm,"__esModule",{value:!0}),Xm.Konva=void 0;const t=JS(),e=bG(),r=SG(),n=kG(),i=_G(),a=CG(),s=EG(),o=SL(),l=__(),u=kL(),c=TG(),h=NG(),p=PG(),g=MG(),y=_L(),S=AG(),w=LG(),C=RG(),_=OG(),T=DG(),N=IG(),R=jG(),I=FG(),j=BG(),O=zG(),F=UG(),z=GG(),V=VG(),q=HG(),D=WG(),U=qG(),G=$G(),Z=KG(),K=ZG(),Q=YG(),ne=XG(),te=QG();return Xm.Konva=t.Konva.Util._assign(t.Konva,{Arc:e.Arc,Arrow:r.Arrow,Circle:n.Circle,Ellipse:i.Ellipse,Image:a.Image,Label:s.Label,Tag:s.Tag,Line:o.Line,Path:l.Path,Rect:u.Rect,RegularPolygon:c.RegularPolygon,Ring:h.Ring,Sprite:p.Sprite,Star:g.Star,Text:y.Text,TextPath:S.TextPath,Transformer:w.Transformer,Wedge:C.Wedge,Filters:{Blur:_.Blur,Brighten:T.Brighten,Contrast:N.Contrast,Emboss:R.Emboss,Enhance:I.Enhance,Grayscale:j.Grayscale,HSL:O.HSL,HSV:F.HSV,Invert:z.Invert,Kaleidoscope:V.Kaleidoscope,Mask:q.Mask,Noise:D.Noise,Pixelate:U.Pixelate,Posterize:G.Posterize,RGB:Z.RGB,RGBA:K.RGBA,Sepia:Q.Sepia,Solarize:ne.Solarize,Threshold:te.Threshold}}),Xm}var eV=Wy.exports,o4;function tV(){if(o4)return Wy.exports;o4=1,Object.defineProperty(eV,"__esModule",{value:!0});const t=JG();return Wy.exports=t.Konva,Wy.exports}tV();var fy={exports:{}},l4;function rV(){return l4||(l4=1,(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;var r=JS();Object.defineProperty(e,"Konva",{enumerable:!0,get:function(){return r.Konva}});const n=JS();t.exports=n.Konva})(fy,fy.exports)),fy.exports}var nV=rV();const Nv=Tf(nV);var L2={exports:{}};var R2,u4;function iV(){return u4||(u4=1,R2=function(e){var r={},n=sm(),i=Vk(),a=Object.assign;function s(x){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+x,M=1;M<arguments.length;M++)b+="&args[]="+encodeURIComponent(arguments[M]);return"Minified React error #"+x+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),u=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),g=Symbol.for("react.provider"),y=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),_=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),N=Symbol.for("react.offscreen"),R=Symbol.iterator;function I(x){return x===null||typeof x!="object"?null:(x=R&&x[R]||x["@@iterator"],typeof x=="function"?x:null)}function j(x){if(x==null)return null;if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x;switch(x){case c:return"Fragment";case u:return"Portal";case p:return"Profiler";case h:return"StrictMode";case w:return"Suspense";case C:return"SuspenseList"}if(typeof x=="object")switch(x.$$typeof){case y:return(x.displayName||"Context")+".Consumer";case g:return(x._context.displayName||"Context")+".Provider";case S:var b=x.render;return x=x.displayName,x||(x=b.displayName||b.name||"",x=x!==""?"ForwardRef("+x+")":"ForwardRef"),x;case _:return b=x.displayName||null,b!==null?b:j(x.type)||"Memo";case T:b=x._payload,x=x._init;try{return j(x(b))}catch{}}return null}function O(x){var b=x.type;switch(x.tag){case 24:return"Cache";case 9:return(b.displayName||"Context")+".Consumer";case 10:return(b._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return x=b.render,x=x.displayName||x.name||"",b.displayName||(x!==""?"ForwardRef("+x+")":"ForwardRef");case 7:return"Fragment";case 5:return b;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(b);case 8:return b===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b}return null}function F(x){var b=x,M=x;if(x.alternate)for(;b.return;)b=b.return;else{x=b;do b=x,(b.flags&4098)!==0&&(M=b.return),x=b.return;while(x)}return b.tag===3?M:null}function z(x){if(F(x)!==x)throw Error(s(188))}function V(x){var b=x.alternate;if(!b){if(b=F(x),b===null)throw Error(s(188));return b!==x?null:x}for(var M=x,B=b;;){var $=M.return;if($===null)break;var ee=$.alternate;if(ee===null){if(B=$.return,B!==null){M=B;continue}break}if($.child===ee.child){for(ee=$.child;ee;){if(ee===M)return z($),x;if(ee===B)return z($),b;ee=ee.sibling}throw Error(s(188))}if(M.return!==B.return)M=$,B=ee;else{for(var me=!1,Te=$.child;Te;){if(Te===M){me=!0,M=$,B=ee;break}if(Te===B){me=!0,B=$,M=ee;break}Te=Te.sibling}if(!me){for(Te=ee.child;Te;){if(Te===M){me=!0,M=ee,B=$;break}if(Te===B){me=!0,B=ee,M=$;break}Te=Te.sibling}if(!me)throw Error(s(189))}}if(M.alternate!==B)throw Error(s(190))}if(M.tag!==3)throw Error(s(188));return M.stateNode.current===M?x:b}function q(x){return x=V(x),x!==null?D(x):null}function D(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){var b=D(x);if(b!==null)return b;x=x.sibling}return null}function U(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){if(x.tag!==4){var b=U(x);if(b!==null)return b}x=x.sibling}return null}var G=Array.isArray,Z=e.getPublicInstance,K=e.getRootHostContext,Q=e.getChildHostContext,ne=e.prepareForCommit,te=e.resetAfterCommit,X=e.createInstance,re=e.appendInitialChild,he=e.finalizeInitialChildren,oe=e.prepareUpdate,se=e.shouldSetTextContent,fe=e.createTextInstance,ae=e.scheduleTimeout,pe=e.cancelTimeout,ye=e.noTimeout,ve=e.isPrimaryRenderer,ue=e.supportsMutation,xe=e.supportsPersistence,Se=e.supportsHydration,Oe=e.getInstanceFromNode,Ae=e.preparePortalMount,tt=e.getCurrentEventPriority,rt=e.detachDeletedInstance,dt=e.supportsMicrotasks,_t=e.scheduleMicrotask,Xe=e.supportsTestSelectors,ht=e.findFiberRoot,ct=e.getBoundingRect,vt=e.getTextContent,lt=e.isHiddenSubtree,Lt=e.matchAccessibilityRole,jt=e.setFocusIfFocusable,Ne=e.setupIntersectionObserver,qe=e.appendChild,bt=e.appendChildToContainer,at=e.commitTextUpdate,ut=e.commitMount,Fe=e.commitUpdate,de=e.insertBefore,ge=e.insertInContainerBefore,ke=e.removeChild,Ee=e.removeChildFromContainer,Le=e.resetTextContent,Qe=e.hideInstance,Ve=e.hideTextInstance,xt=e.unhideInstance,ze=e.unhideTextInstance,$e=e.clearContainer,wt=e.cloneInstance,Pt=e.createContainerChildSet,Ct=e.appendChildToContainerChildSet,Vt=e.finalizeContainerChildren,Yt=e.replaceContainerChildren,Lr=e.cloneHiddenInstance,kr=e.cloneHiddenTextInstance,Qr=e.canHydrateInstance,Jr=e.canHydrateTextInstance,_r=e.canHydrateSuspenseInstance,hn=e.isSuspenseInstancePending,vr=e.isSuspenseInstanceFallback,Et=e.getSuspenseInstanceFallbackErrorDetails,Br=e.registerSuspenseInstanceRetry,Xn=e.getNextHydratableSibling,Zi=e.getFirstHydratableChild,ds=e.getFirstHydratableChildWithinContainer,As=e.getFirstHydratableChildWithinSuspenseInstance,ni=e.hydrateInstance,sn=e.hydrateTextInstance,kn=e.hydrateSuspenseInstance,In=e.getNextHydratableInstanceAfterSuspenseInstance,Ls=e.commitHydratedContainer,gi=e.commitHydratedSuspenseInstance,ko=e.clearSuspenseBoundary,qa=e.clearSuspenseBoundaryFromContainer,Ru=e.shouldDeleteUnhydratedTailInstances,_o=e.didNotMatchHydratedContainerTextInstance,on=e.didNotMatchHydratedTextInstance,Co;function hs(x){if(Co===void 0)try{throw Error()}catch(M){var b=M.stack.trim().match(/\n( *(at )?)/);Co=b&&b[1]||""}return`
`+Co+x}var ro=!1;function Yi(x,b){if(!x||ro)return"";ro=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(gt){var B=gt}Reflect.construct(x,[],b)}else{try{b.call()}catch(gt){B=gt}x.call(b.prototype)}else{try{throw Error()}catch(gt){B=gt}x()}}catch(gt){if(gt&&B&&typeof gt.stack=="string"){for(var $=gt.stack.split(`
`),ee=B.stack.split(`
`),me=$.length-1,Te=ee.length-1;1<=me&&0<=Te&&$[me]!==ee[Te];)Te--;for(;1<=me&&0<=Te;me--,Te--)if($[me]!==ee[Te]){if(me!==1||Te!==1)do if(me--,Te--,0>Te||$[me]!==ee[Te]){var Ue=`
`+$[me].replace(" at new "," at ");return x.displayName&&Ue.includes("<anonymous>")&&(Ue=Ue.replace("<anonymous>",x.displayName)),Ue}while(1<=me&&0<=Te);break}}}finally{ro=!1,Error.prepareStackTrace=M}return(x=x?x.displayName||x.name:"")?hs(x):""}var no=Object.prototype.hasOwnProperty,Ge=[],Ye=-1;function nt(x){return{current:x}}function pt(x){0>Ye||(x.current=Ge[Ye],Ge[Ye]=null,Ye--)}function Ze(x,b){Ye++,Ge[Ye]=x.current,x.current=b}var Dt={},Nr=nt(Dt),Pr=nt(!1),Fr=Dt;function vi(x,b){var M=x.type.contextTypes;if(!M)return Dt;var B=x.stateNode;if(B&&B.__reactInternalMemoizedUnmaskedChildContext===b)return B.__reactInternalMemoizedMaskedChildContext;var $={},ee;for(ee in M)$[ee]=b[ee];return B&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=b,x.__reactInternalMemoizedMaskedChildContext=$),$}function zt(x){return x=x.childContextTypes,x!=null}function Ir(){pt(Pr),pt(Nr)}function al(x,b,M){if(Nr.current!==Dt)throw Error(s(168));Ze(Nr,b),Ze(Pr,M)}function Jt(x,b,M){var B=x.stateNode;if(b=b.childContextTypes,typeof B.getChildContext!="function")return M;B=B.getChildContext();for(var $ in B)if(!($ in b))throw Error(s(108,O(x)||"Unknown",$));return a({},M,B)}function tr(x){return x=(x=x.stateNode)&&x.__reactInternalMemoizedMergedChildContext||Dt,Fr=Nr.current,Ze(Nr,x),Ze(Pr,Pr.current),!0}function Rr(x,b,M){var B=x.stateNode;if(!B)throw Error(s(169));M?(x=Jt(x,b,Fr),B.__reactInternalMemoizedMergedChildContext=x,pt(Pr),pt(Nr),Ze(Nr,x)):pt(Pr),Ze(Pr,M)}var er=Math.clz32?Math.clz32:io,en=Math.log,yn=Math.LN2;function io(x){return x>>>=0,x===0?32:31-(en(x)/yn|0)|0}var xr=64,ao=4194304;function Eo(x){switch(x&-x){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return x&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return x}}function Rs(x,b){var M=x.pendingLanes;if(M===0)return 0;var B=0,$=x.suspendedLanes,ee=x.pingedLanes,me=M&268435455;if(me!==0){var Te=me&~$;Te!==0?B=Eo(Te):(ee&=me,ee!==0&&(B=Eo(ee)))}else me=M&~$,me!==0?B=Eo(me):ee!==0&&(B=Eo(ee));if(B===0)return 0;if(b!==0&&b!==B&&(b&$)===0&&($=B&-B,ee=b&-b,$>=ee||$===16&&(ee&4194240)!==0))return b;if((B&4)!==0&&(B|=M&16),b=x.entangledLanes,b!==0)for(x=x.entanglements,b&=B;0<b;)M=31-er(b),$=1<<M,B|=x[M],b&=~$;return B}function Cc(x,b){switch(x){case 1:case 2:case 4:return b+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ec(x,b){for(var M=x.suspendedLanes,B=x.pingedLanes,$=x.expirationTimes,ee=x.pendingLanes;0<ee;){var me=31-er(ee),Te=1<<me,Ue=$[me];Ue===-1?((Te&M)===0||(Te&B)!==0)&&($[me]=Cc(Te,b)):Ue<=b&&(x.expiredLanes|=Te),ee&=~Te}}function sl(x){return x=x.pendingLanes&-1073741825,x!==0?x:x&1073741824?1073741824:0}function Gl(){var x=xr;return xr<<=1,(xr&4194240)===0&&(xr=64),x}function To(x){for(var b=[],M=0;31>M;M++)b.push(x);return b}function Fi(x,b,M){x.pendingLanes|=b,b!==536870912&&(x.suspendedLanes=0,x.pingedLanes=0),x=x.eventTimes,b=31-er(b),x[b]=M}function so(x,b){var M=x.pendingLanes&~b;x.pendingLanes=b,x.suspendedLanes=0,x.pingedLanes=0,x.expiredLanes&=b,x.mutableReadLanes&=b,x.entangledLanes&=b,b=x.entanglements;var B=x.eventTimes;for(x=x.expirationTimes;0<M;){var $=31-er(M),ee=1<<$;b[$]=0,B[$]=-1,x[$]=-1,M&=~ee}}function $a(x,b){var M=x.entangledLanes|=b;for(x=x.entanglements;M;){var B=31-er(M),$=1<<B;$&b|x[B]&b&&(x[B]|=b),M&=~$}}var br=0;function sr(x){return x&=-x,1<x?4<x?(x&268435455)!==0?16:536870912:4:1}var Qn=i.unstable_scheduleCallback,$r=i.unstable_cancelCallback,gh=i.unstable_shouldYield,ol=i.unstable_requestPaint,jn=i.unstable_now,Vl=i.unstable_ImmediatePriority,Os=i.unstable_UserBlockingPriority,Hl=i.unstable_NormalPriority,Ou=i.unstable_IdlePriority,fn=null,Fn=null;function ll(x){if(Fn&&typeof Fn.onCommitFiberRoot=="function")try{Fn.onCommitFiberRoot(fn,x,void 0,(x.current.flags&128)===128)}catch{}}function Du(x,b){return x===b&&(x!==0||1/x===1/b)||x!==x&&b!==b}var fs=typeof Object.is=="function"?Object.is:Du,Ds=null,No=!1,Wl=!1;function Iu(x){Ds===null?Ds=[x]:Ds.push(x)}function Cr(x){No=!0,Iu(x)}function yi(){if(!Wl&&Ds!==null){Wl=!0;var x=0,b=br;try{var M=Ds;for(br=1;x<M.length;x++){var B=M[x];do B=B(!0);while(B!==null)}Ds=null,No=!1}catch($){throw Ds!==null&&(Ds=Ds.slice(x+1)),Qn(Vl,yi),$}finally{br=b,Wl=!1}}return null}var ii=[],ba=0,ql=null,ul=0,xi=[],wa=0,Bn=null,Xi=1,ps="";function Sa(x,b){ii[ba++]=ul,ii[ba++]=ql,ql=x,ul=b}function Of(x,b,M){xi[wa++]=Xi,xi[wa++]=ps,xi[wa++]=Bn,Bn=x;var B=Xi;x=ps;var $=32-er(B)-1;B&=~(1<<$),M+=1;var ee=32-er(b)+$;if(30<ee){var me=$-$%5;ee=(B&(1<<me)-1).toString(32),B>>=me,$-=me,Xi=1<<32-er(b)+$|M<<$|B,ps=ee+x}else Xi=1<<ee|M<<$|B,ps=x}function Qi(x){x.return!==null&&(Sa(x,1),Of(x,1,0))}function ju(x){for(;x===ql;)ql=ii[--ba],ii[ba]=null,ul=ii[--ba],ii[ba]=null;for(;x===Bn;)Bn=xi[--wa],xi[wa]=null,ps=xi[--wa],xi[wa]=null,Xi=xi[--wa],xi[wa]=null}var ai=null,_n=null,tn=!1,$l=!1,ka=null;function Df(x,b){var M=ks(5,null,null,0);M.elementType="DELETED",M.stateNode=b,M.return=x,b=x.deletions,b===null?(x.deletions=[M],x.flags|=16):b.push(M)}function Fu(x,b){switch(x.tag){case 5:return b=Qr(b,x.type,x.pendingProps),b!==null?(x.stateNode=b,ai=x,_n=Zi(b),!0):!1;case 6:return b=Jr(b,x.pendingProps),b!==null?(x.stateNode=b,ai=x,_n=null,!0):!1;case 13:if(b=_r(b),b!==null){var M=Bn!==null?{id:Xi,overflow:ps}:null;return x.memoizedState={dehydrated:b,treeContext:M,retryLane:1073741824},M=ks(18,null,null,0),M.stateNode=b,M.return=x,x.child=M,ai=x,_n=null,!0}return!1;default:return!1}}function Tc(x){return(x.mode&1)!==0&&(x.flags&128)===0}function vh(x){if(tn){var b=_n;if(b){var M=b;if(!Fu(x,b)){if(Tc(x))throw Error(s(418));b=Xn(M);var B=ai;b&&Fu(x,b)?Df(B,M):(x.flags=x.flags&-4097|2,tn=!1,ai=x)}}else{if(Tc(x))throw Error(s(418));x.flags=x.flags&-4097|2,tn=!1,ai=x}}}function If(x){for(x=x.return;x!==null&&x.tag!==5&&x.tag!==3&&x.tag!==13;)x=x.return;ai=x}function Kl(x){if(!Se||x!==ai)return!1;if(!tn)return If(x),tn=!0,!1;if(x.tag!==3&&(x.tag!==5||Ru(x.type)&&!se(x.type,x.memoizedProps))){var b=_n;if(b){if(Tc(x))throw jf(),Error(s(418));for(;b;)Df(x,b),b=Xn(b)}}if(If(x),x.tag===13){if(!Se)throw Error(s(316));if(x=x.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(s(317));_n=In(x)}else _n=ai?Xn(x.stateNode):null;return!0}function jf(){for(var x=_n;x;)x=Xn(x)}function Po(){Se&&(_n=ai=null,$l=tn=!1)}function Nc(x){ka===null?ka=[x]:ka.push(x)}var Pc=o.ReactCurrentBatchConfig;function Is(x,b){if(fs(x,b))return!0;if(typeof x!="object"||x===null||typeof b!="object"||b===null)return!1;var M=Object.keys(x),B=Object.keys(b);if(M.length!==B.length)return!1;for(B=0;B<M.length;B++){var $=M[B];if(!no.call(b,$)||!fs(x[$],b[$]))return!1}return!0}function ym(x){switch(x.tag){case 5:return hs(x.type);case 16:return hs("Lazy");case 13:return hs("Suspense");case 19:return hs("SuspenseList");case 0:case 2:case 15:return x=Yi(x.type,!1),x;case 11:return x=Yi(x.type.render,!1),x;case 1:return x=Yi(x.type,!0),x;default:return""}}function ms(x,b,M){if(x=M.ref,x!==null&&typeof x!="function"&&typeof x!="object"){if(M._owner){if(M=M._owner,M){if(M.tag!==1)throw Error(s(309));var B=M.stateNode}if(!B)throw Error(s(147,x));var $=B,ee=""+x;return b!==null&&b.ref!==null&&typeof b.ref=="function"&&b.ref._stringRef===ee?b.ref:(b=function(me){var Te=$.refs;me===null?delete Te[ee]:Te[ee]=me},b._stringRef=ee,b)}if(typeof x!="string")throw Error(s(284));if(!M._owner)throw Error(s(290,x))}return x}function Bi(x,b){throw x=Object.prototype.toString.call(b),Error(s(31,x==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":x))}function yh(x){var b=x._init;return b(x._payload)}function xh(x){function b(je,Pe){if(x){var He=je.deletions;He===null?(je.deletions=[Pe],je.flags|=16):He.push(Pe)}}function M(je,Pe){if(!x)return null;for(;Pe!==null;)b(je,Pe),Pe=Pe.sibling;return null}function B(je,Pe){for(je=new Map;Pe!==null;)Pe.key!==null?je.set(Pe.key,Pe):je.set(Pe.index,Pe),Pe=Pe.sibling;return je}function $(je,Pe){return je=pu(je,Pe),je.index=0,je.sibling=null,je}function ee(je,Pe,He){return je.index=He,x?(He=je.alternate,He!==null?(He=He.index,He<Pe?(je.flags|=2,Pe):He):(je.flags|=2,Pe)):(je.flags|=1048576,Pe)}function me(je){return x&&je.alternate===null&&(je.flags|=2),je}function Te(je,Pe,He,At){return Pe===null||Pe.tag!==6?(Pe=ad(He,je.mode,At),Pe.return=je,Pe):(Pe=$(Pe,He),Pe.return=je,Pe)}function Ue(je,Pe,He,At){var $t=He.type;return $t===c?It(je,Pe,He.props.children,At,He.key):Pe!==null&&(Pe.elementType===$t||typeof $t=="object"&&$t!==null&&$t.$$typeof===T&&yh($t)===Pe.type)?(At=$(Pe,He.props),At.ref=ms(je,Pe,He),At.return=je,At):(At=np(He.type,He.key,He.props,null,je.mode,At),At.ref=ms(je,Pe,He),At.return=je,At)}function gt(je,Pe,He,At){return Pe===null||Pe.tag!==4||Pe.stateNode.containerInfo!==He.containerInfo||Pe.stateNode.implementation!==He.implementation?(Pe=ip(He,je.mode,At),Pe.return=je,Pe):(Pe=$(Pe,He.children||[]),Pe.return=je,Pe)}function It(je,Pe,He,At,$t){return Pe===null||Pe.tag!==7?(Pe=Gi(He,je.mode,At,$t),Pe.return=je,Pe):(Pe=$(Pe,He),Pe.return=je,Pe)}function ur(je,Pe,He){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number")return Pe=ad(""+Pe,je.mode,He),Pe.return=je,Pe;if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case l:return He=np(Pe.type,Pe.key,Pe.props,null,je.mode,He),He.ref=ms(je,null,Pe),He.return=je,He;case u:return Pe=ip(Pe,je.mode,He),Pe.return=je,Pe;case T:var At=Pe._init;return ur(je,At(Pe._payload),He)}if(G(Pe)||I(Pe))return Pe=Gi(Pe,je.mode,He,null),Pe.return=je,Pe;Bi(je,Pe)}return null}function Mt(je,Pe,He,At){var $t=Pe!==null?Pe.key:null;if(typeof He=="string"&&He!==""||typeof He=="number")return $t!==null?null:Te(je,Pe,""+He,At);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case l:return He.key===$t?Ue(je,Pe,He,At):null;case u:return He.key===$t?gt(je,Pe,He,At):null;case T:return $t=He._init,Mt(je,Pe,$t(He._payload),At)}if(G(He)||I(He))return $t!==null?null:It(je,Pe,He,At,null);Bi(je,He)}return null}function gn(je,Pe,He,At,$t){if(typeof At=="string"&&At!==""||typeof At=="number")return je=je.get(He)||null,Te(Pe,je,""+At,$t);if(typeof At=="object"&&At!==null){switch(At.$$typeof){case l:return je=je.get(At.key===null?He:At.key)||null,Ue(Pe,je,At,$t);case u:return je=je.get(At.key===null?He:At.key)||null,gt(Pe,je,At,$t);case T:var mr=At._init;return gn(je,Pe,He,mr(At._payload),$t)}if(G(At)||I(At))return je=je.get(He)||null,It(Pe,je,At,$t,null);Bi(Pe,At)}return null}function Xr(je,Pe,He,At){for(var $t=null,mr=null,cr=Pe,jr=Pe=0,_i=null;cr!==null&&jr<He.length;jr++){cr.index>jr?(_i=cr,cr=null):_i=cr.sibling;var Or=Mt(je,cr,He[jr],At);if(Or===null){cr===null&&(cr=_i);break}x&&cr&&Or.alternate===null&&b(je,cr),Pe=ee(Or,Pe,jr),mr===null?$t=Or:mr.sibling=Or,mr=Or,cr=_i}if(jr===He.length)return M(je,cr),tn&&Sa(je,jr),$t;if(cr===null){for(;jr<He.length;jr++)cr=ur(je,He[jr],At),cr!==null&&(Pe=ee(cr,Pe,jr),mr===null?$t=cr:mr.sibling=cr,mr=cr);return tn&&Sa(je,jr),$t}for(cr=B(je,cr);jr<He.length;jr++)_i=gn(cr,je,jr,He[jr],At),_i!==null&&(x&&_i.alternate!==null&&cr.delete(_i.key===null?jr:_i.key),Pe=ee(_i,Pe,jr),mr===null?$t=_i:mr.sibling=_i,mr=_i);return x&&cr.forEach(function(la){return b(je,la)}),tn&&Sa(je,jr),$t}function Ra(je,Pe,He,At){var $t=I(He);if(typeof $t!="function")throw Error(s(150));if(He=$t.call(He),He==null)throw Error(s(151));for(var mr=$t=null,cr=Pe,jr=Pe=0,_i=null,Or=He.next();cr!==null&&!Or.done;jr++,Or=He.next()){cr.index>jr?(_i=cr,cr=null):_i=cr.sibling;var la=Mt(je,cr,Or.value,At);if(la===null){cr===null&&(cr=_i);break}x&&cr&&la.alternate===null&&b(je,cr),Pe=ee(la,Pe,jr),mr===null?$t=la:mr.sibling=la,mr=la,cr=_i}if(Or.done)return M(je,cr),tn&&Sa(je,jr),$t;if(cr===null){for(;!Or.done;jr++,Or=He.next())Or=ur(je,Or.value,At),Or!==null&&(Pe=ee(Or,Pe,jr),mr===null?$t=Or:mr.sibling=Or,mr=Or);return tn&&Sa(je,jr),$t}for(cr=B(je,cr);!Or.done;jr++,Or=He.next())Or=gn(cr,je,jr,Or.value,At),Or!==null&&(x&&Or.alternate!==null&&cr.delete(Or.key===null?jr:Or.key),Pe=ee(Or,Pe,jr),mr===null?$t=Or:mr.sibling=Or,mr=Or);return x&&cr.forEach(function(cb){return b(je,cb)}),tn&&Sa(je,jr),$t}function Go(je,Pe,He,At){if(typeof He=="object"&&He!==null&&He.type===c&&He.key===null&&(He=He.props.children),typeof He=="object"&&He!==null){switch(He.$$typeof){case l:e:{for(var $t=He.key,mr=Pe;mr!==null;){if(mr.key===$t){if($t=He.type,$t===c){if(mr.tag===7){M(je,mr.sibling),Pe=$(mr,He.props.children),Pe.return=je,je=Pe;break e}}else if(mr.elementType===$t||typeof $t=="object"&&$t!==null&&$t.$$typeof===T&&yh($t)===mr.type){M(je,mr.sibling),Pe=$(mr,He.props),Pe.ref=ms(je,mr,He),Pe.return=je,je=Pe;break e}M(je,mr);break}else b(je,mr);mr=mr.sibling}He.type===c?(Pe=Gi(He.props.children,je.mode,At,He.key),Pe.return=je,je=Pe):(At=np(He.type,He.key,He.props,null,je.mode,At),At.ref=ms(je,Pe,He),At.return=je,je=At)}return me(je);case u:e:{for(mr=He.key;Pe!==null;){if(Pe.key===mr)if(Pe.tag===4&&Pe.stateNode.containerInfo===He.containerInfo&&Pe.stateNode.implementation===He.implementation){M(je,Pe.sibling),Pe=$(Pe,He.children||[]),Pe.return=je,je=Pe;break e}else{M(je,Pe);break}else b(je,Pe);Pe=Pe.sibling}Pe=ip(He,je.mode,At),Pe.return=je,je=Pe}return me(je);case T:return mr=He._init,Go(je,Pe,mr(He._payload),At)}if(G(He))return Xr(je,Pe,He,At);if(I(He))return Ra(je,Pe,He,At);Bi(je,He)}return typeof He=="string"&&He!==""||typeof He=="number"?(He=""+He,Pe!==null&&Pe.tag===6?(M(je,Pe.sibling),Pe=$(Pe,He),Pe.return=je,je=Pe):(M(je,Pe),Pe=ad(He,je.mode,At),Pe.return=je,je=Pe),me(je)):M(je,Pe)}return Go}var cl=xh(!0),Mc=xh(!1),Zl=nt(null),Ac=null,Yl=null,Lc=null;function bh(){Lc=Yl=Ac=null}function Ka(x,b,M){ve?(Ze(Zl,b._currentValue),b._currentValue=M):(Ze(Zl,b._currentValue2),b._currentValue2=M)}function js(x){var b=Zl.current;pt(Zl),ve?x._currentValue=b:x._currentValue2=b}function dl(x,b,M){for(;x!==null;){var B=x.alternate;if((x.childLanes&b)!==b?(x.childLanes|=b,B!==null&&(B.childLanes|=b)):B!==null&&(B.childLanes&b)!==b&&(B.childLanes|=b),x===M)break;x=x.return}}function Ji(x,b){Ac=x,Lc=Yl=null,x=x.dependencies,x!==null&&x.firstContext!==null&&((x.lanes&b)!==0&&(Vn=!0),x.firstContext=null)}function _a(x){var b=ve?x._currentValue:x._currentValue2;if(Lc!==x)if(x={context:x,memoizedValue:b,next:null},Yl===null){if(Ac===null)throw Error(s(308));Yl=x,Ac.dependencies={lanes:0,firstContext:x}}else Yl=Yl.next=x;return b}var Ca=null;function Rc(x){Ca===null?Ca=[x]:Ca.push(x)}function hl(x,b,M,B){var $=b.interleaved;return $===null?(M.next=M,Rc(b)):(M.next=$.next,$.next=M),b.interleaved=M,Za(x,B)}function Za(x,b){x.lanes|=b;var M=x.alternate;for(M!==null&&(M.lanes|=b),M=x,x=x.return;x!==null;)x.childLanes|=b,M=x.alternate,M!==null&&(M.childLanes|=b),M=x,x=x.return;return M.tag===3?M.stateNode:null}var Pi=!1;function wh(x){x.updateQueue={baseState:x.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function oo(x,b){x=x.updateQueue,b.updateQueue===x&&(b.updateQueue={baseState:x.baseState,firstBaseUpdate:x.firstBaseUpdate,lastBaseUpdate:x.lastBaseUpdate,shared:x.shared,effects:x.effects})}function Ya(x,b){return{eventTime:x,lane:b,tag:0,payload:null,callback:null,next:null}}function lo(x,b,M){var B=x.updateQueue;if(B===null)return null;if(B=B.shared,(fr&2)!==0){var $=B.pending;return $===null?b.next=b:(b.next=$.next,$.next=b),B.pending=b,Za(x,M)}return $=B.interleaved,$===null?(b.next=b,Rc(B)):(b.next=$.next,$.next=b),B.interleaved=b,Za(x,M)}function fl(x,b,M){if(b=b.updateQueue,b!==null&&(b=b.shared,(M&4194240)!==0)){var B=b.lanes;B&=x.pendingLanes,M|=B,b.lanes=M,$a(x,M)}}function Xl(x,b){var M=x.updateQueue,B=x.alternate;if(B!==null&&(B=B.updateQueue,M===B)){var $=null,ee=null;if(M=M.firstBaseUpdate,M!==null){do{var me={eventTime:M.eventTime,lane:M.lane,tag:M.tag,payload:M.payload,callback:M.callback,next:null};ee===null?$=ee=me:ee=ee.next=me,M=M.next}while(M!==null);ee===null?$=ee=b:ee=ee.next=b}else $=ee=b;M={baseState:B.baseState,firstBaseUpdate:$,lastBaseUpdate:ee,shared:B.shared,effects:B.effects},x.updateQueue=M;return}x=M.lastBaseUpdate,x===null?M.firstBaseUpdate=b:x.next=b,M.lastBaseUpdate=b}function Mi(x,b,M,B){var $=x.updateQueue;Pi=!1;var ee=$.firstBaseUpdate,me=$.lastBaseUpdate,Te=$.shared.pending;if(Te!==null){$.shared.pending=null;var Ue=Te,gt=Ue.next;Ue.next=null,me===null?ee=gt:me.next=gt,me=Ue;var It=x.alternate;It!==null&&(It=It.updateQueue,Te=It.lastBaseUpdate,Te!==me&&(Te===null?It.firstBaseUpdate=gt:Te.next=gt,It.lastBaseUpdate=Ue))}if(ee!==null){var ur=$.baseState;me=0,It=gt=Ue=null,Te=ee;do{var Mt=Te.lane,gn=Te.eventTime;if((B&Mt)===Mt){It!==null&&(It=It.next={eventTime:gn,lane:0,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null});e:{var Xr=x,Ra=Te;switch(Mt=b,gn=M,Ra.tag){case 1:if(Xr=Ra.payload,typeof Xr=="function"){ur=Xr.call(gn,ur,Mt);break e}ur=Xr;break e;case 3:Xr.flags=Xr.flags&-65537|128;case 0:if(Xr=Ra.payload,Mt=typeof Xr=="function"?Xr.call(gn,ur,Mt):Xr,Mt==null)break e;ur=a({},ur,Mt);break e;case 2:Pi=!0}}Te.callback!==null&&Te.lane!==0&&(x.flags|=64,Mt=$.effects,Mt===null?$.effects=[Te]:Mt.push(Te))}else gn={eventTime:gn,lane:Mt,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null},It===null?(gt=It=gn,Ue=ur):It=It.next=gn,me|=Mt;if(Te=Te.next,Te===null){if(Te=$.shared.pending,Te===null)break;Mt=Te,Te=Mt.next,Mt.next=null,$.lastBaseUpdate=Mt,$.shared.pending=null}}while(!0);if(It===null&&(Ue=ur),$.baseState=Ue,$.firstBaseUpdate=gt,$.lastBaseUpdate=It,b=$.shared.interleaved,b!==null){$=b;do me|=$.lane,$=$.next;while($!==b)}else ee===null&&($.shared.lanes=0);Cl|=me,x.lanes=me,x.memoizedState=ur}}function Ff(x,b,M){if(x=b.effects,b.effects=null,x!==null)for(b=0;b<x.length;b++){var B=x[b],$=B.callback;if($!==null){if(B.callback=null,B=M,typeof $!="function")throw Error(s(191,$));$.call(B)}}}var Ea={},Xa=nt(Ea),ea=nt(Ea),gs=nt(Ea);function Ta(x){if(x===Ea)throw Error(s(174));return x}function Ql(x,b){Ze(gs,b),Ze(ea,x),Ze(Xa,Ea),x=K(b),pt(Xa),Ze(Xa,x)}function Fs(){pt(Xa),pt(ea),pt(gs)}function Bu(x){var b=Ta(gs.current),M=Ta(Xa.current);b=Q(M,x.type,b),M!==b&&(Ze(ea,x),Ze(Xa,b))}function Jl(x){ea.current===x&&(pt(Xa),pt(ea))}var Hr=nt(0);function pl(x){for(var b=x;b!==null;){if(b.tag===13){var M=b.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||hn(M)||vr(M)))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if((b.flags&128)!==0)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var zu=[];function Oc(){for(var x=0;x<zu.length;x++){var b=zu[x];ve?b._workInProgressVersionPrimary=null:b._workInProgressVersionSecondary=null}zu.length=0}var ta=o.ReactCurrentDispatcher,Bs=o.ReactCurrentBatchConfig,Mo=0,ln=null,zn=null,Un=null,eu=!1,ra=!1,Ao=0,tu=0;function An(){throw Error(s(321))}function ml(x,b){if(b===null)return!1;for(var M=0;M<b.length&&M<x.length;M++)if(!fs(x[M],b[M]))return!1;return!0}function ru(x,b,M,B,$,ee){if(Mo=ee,ln=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,ta.current=x===null||x.memoizedState===null?Tt:Xt,x=M(B,$),ra){ee=0;do{if(ra=!1,Ao=0,25<=ee)throw Error(s(301));ee+=1,Un=zn=null,b.updateQueue=null,ta.current=hr,x=M(B,$)}while(ra)}if(ta.current=Je,b=zn!==null&&zn.next!==null,Mo=0,Un=zn=ln=null,eu=!1,b)throw Error(s(300));return x}function Dc(){var x=Ao!==0;return Ao=0,x}function bi(){var x={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Un===null?ln.memoizedState=Un=x:Un=Un.next=x,Un}function wi(){if(zn===null){var x=ln.alternate;x=x!==null?x.memoizedState:null}else x=zn.next;var b=Un===null?ln.memoizedState:Un.next;if(b!==null)Un=b,zn=x;else{if(x===null)throw Error(s(310));zn=x,x={memoizedState:zn.memoizedState,baseState:zn.baseState,baseQueue:zn.baseQueue,queue:zn.queue,next:null},Un===null?ln.memoizedState=Un=x:Un=Un.next=x}return Un}function Qa(x,b){return typeof b=="function"?b(x):b}function Uu(x){var b=wi(),M=b.queue;if(M===null)throw Error(s(311));M.lastRenderedReducer=x;var B=zn,$=B.baseQueue,ee=M.pending;if(ee!==null){if($!==null){var me=$.next;$.next=ee.next,ee.next=me}B.baseQueue=$=ee,M.pending=null}if($!==null){ee=$.next,B=B.baseState;var Te=me=null,Ue=null,gt=ee;do{var It=gt.lane;if((Mo&It)===It)Ue!==null&&(Ue=Ue.next={lane:0,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null}),B=gt.hasEagerState?gt.eagerState:x(B,gt.action);else{var ur={lane:It,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null};Ue===null?(Te=Ue=ur,me=B):Ue=Ue.next=ur,ln.lanes|=It,Cl|=It}gt=gt.next}while(gt!==null&&gt!==ee);Ue===null?me=B:Ue.next=Te,fs(B,b.memoizedState)||(Vn=!0),b.memoizedState=B,b.baseState=me,b.baseQueue=Ue,M.lastRenderedState=B}if(x=M.interleaved,x!==null){$=x;do ee=$.lane,ln.lanes|=ee,Cl|=ee,$=$.next;while($!==x)}else $===null&&(M.lanes=0);return[b.memoizedState,M.dispatch]}function gl(x){var b=wi(),M=b.queue;if(M===null)throw Error(s(311));M.lastRenderedReducer=x;var B=M.dispatch,$=M.pending,ee=b.memoizedState;if($!==null){M.pending=null;var me=$=$.next;do ee=x(ee,me.action),me=me.next;while(me!==$);fs(ee,b.memoizedState)||(Vn=!0),b.memoizedState=ee,b.baseQueue===null&&(b.baseState=ee),M.lastRenderedState=ee}return[ee,B]}function Sh(){}function vs(x,b){var M=ln,B=wi(),$=b(),ee=!fs(B.memoizedState,$);if(ee&&(B.memoizedState=$,Vn=!0),B=B.queue,Gu(vl.bind(null,M,B,x),[x]),B.getSnapshot!==b||ee||Un!==null&&Un.memoizedState.tag&1){if(M.flags|=2048,Ro(9,jc.bind(null,M,B,$,b),void 0,null),cn===null)throw Error(s(349));(Mo&30)!==0||Ic(M,b,$)}return $}function Ic(x,b,M){x.flags|=16384,x={getSnapshot:b,value:M},b=ln.updateQueue,b===null?(b={lastEffect:null,stores:null},ln.updateQueue=b,b.stores=[x]):(M=b.stores,M===null?b.stores=[x]:M.push(x))}function jc(x,b,M,B){b.value=M,b.getSnapshot=B,kh(b)&&Ja(x)}function vl(x,b,M){return M(function(){kh(b)&&Ja(x)})}function kh(x){var b=x.getSnapshot;x=x.value;try{var M=b();return!fs(x,M)}catch{return!0}}function Ja(x){var b=Za(x,1);b!==null&&sa(b,x,1,-1)}function Lo(x){var b=bi();return typeof x=="function"&&(x=x()),b.memoizedState=b.baseState=x,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qa,lastRenderedState:x},b.queue=x,x=x.dispatch=ce.bind(null,ln,x),[b.memoizedState,x]}function Ro(x,b,M,B){return x={tag:x,create:b,destroy:M,deps:B,next:null},b=ln.updateQueue,b===null?(b={lastEffect:null,stores:null},ln.updateQueue=b,b.lastEffect=x.next=x):(M=b.lastEffect,M===null?b.lastEffect=x.next=x:(B=M.next,M.next=x,x.next=B,b.lastEffect=x)),x}function _h(){return wi().memoizedState}function Fc(x,b,M,B){var $=bi();ln.flags|=x,$.memoizedState=Ro(1|b,M,void 0,B===void 0?null:B)}function uo(x,b,M,B){var $=wi();B=B===void 0?null:B;var ee=void 0;if(zn!==null){var me=zn.memoizedState;if(ee=me.destroy,B!==null&&ml(B,me.deps)){$.memoizedState=Ro(b,M,ee,B);return}}ln.flags|=x,$.memoizedState=Ro(1|b,M,ee,B)}function Ch(x,b){return Fc(8390656,8,x,b)}function Gu(x,b){return uo(2048,8,x,b)}function Bc(x,b){return uo(4,2,x,b)}function Kr(x,b){return uo(4,4,x,b)}function zc(x,b){if(typeof b=="function")return x=x(),b(x),function(){b(null)};if(b!=null)return x=x(),b.current=x,function(){b.current=null}}function nu(x,b,M){return M=M!=null?M.concat([x]):null,uo(4,4,zc.bind(null,b,x),M)}function Oo(){}function Eh(x,b){var M=wi();b=b===void 0?null:b;var B=M.memoizedState;return B!==null&&b!==null&&ml(b,B[1])?B[0]:(M.memoizedState=[x,b],x)}function f(x,b){var M=wi();b=b===void 0?null:b;var B=M.memoizedState;return B!==null&&b!==null&&ml(b,B[1])?B[0]:(x=x(),M.memoizedState=[x,b],x)}function k(x,b,M){return(Mo&21)===0?(x.baseState&&(x.baseState=!1,Vn=!0),x.memoizedState=M):(fs(M,b)||(M=Gl(),ln.lanes|=M,Cl|=M,x.baseState=!0),b)}function P(x,b){var M=br;br=M!==0&&4>M?M:4,x(!0);var B=Bs.transition;Bs.transition={};try{x(!1),b()}finally{br=M,Bs.transition=B}}function H(){return wi().memoizedState}function J(x,b,M){var B=ki(x);if(M={lane:B,action:M,hasEagerState:!1,eagerState:null,next:null},we(x))Me(b,M);else if(M=hl(x,b,M,B),M!==null){var $=xn();sa(M,x,B,$),Ie(M,b,B)}}function ce(x,b,M){var B=ki(x),$={lane:B,action:M,hasEagerState:!1,eagerState:null,next:null};if(we(x))Me(b,$);else{var ee=x.alternate;if(x.lanes===0&&(ee===null||ee.lanes===0)&&(ee=b.lastRenderedReducer,ee!==null))try{var me=b.lastRenderedState,Te=ee(me,M);if($.hasEagerState=!0,$.eagerState=Te,fs(Te,me)){var Ue=b.interleaved;Ue===null?($.next=$,Rc(b)):($.next=Ue.next,Ue.next=$),b.interleaved=$;return}}catch{}M=hl(x,b,$,B),M!==null&&($=xn(),sa(M,x,B,$),Ie(M,b,B))}}function we(x){var b=x.alternate;return x===ln||b!==null&&b===ln}function Me(x,b){ra=eu=!0;var M=x.pending;M===null?b.next=b:(b.next=M.next,M.next=b),x.pending=b}function Ie(x,b,M){if((M&4194240)!==0){var B=b.lanes;B&=x.pendingLanes,M|=B,b.lanes=M,$a(x,M)}}var Je={readContext:_a,useCallback:An,useContext:An,useEffect:An,useImperativeHandle:An,useInsertionEffect:An,useLayoutEffect:An,useMemo:An,useReducer:An,useRef:An,useState:An,useDebugValue:An,useDeferredValue:An,useTransition:An,useMutableSource:An,useSyncExternalStore:An,useId:An,unstable_isNewReconciler:!1},Tt={readContext:_a,useCallback:function(x,b){return bi().memoizedState=[x,b===void 0?null:b],x},useContext:_a,useEffect:Ch,useImperativeHandle:function(x,b,M){return M=M!=null?M.concat([x]):null,Fc(4194308,4,zc.bind(null,b,x),M)},useLayoutEffect:function(x,b){return Fc(4194308,4,x,b)},useInsertionEffect:function(x,b){return Fc(4,2,x,b)},useMemo:function(x,b){var M=bi();return b=b===void 0?null:b,x=x(),M.memoizedState=[x,b],x},useReducer:function(x,b,M){var B=bi();return b=M!==void 0?M(b):b,B.memoizedState=B.baseState=b,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:x,lastRenderedState:b},B.queue=x,x=x.dispatch=J.bind(null,ln,x),[B.memoizedState,x]},useRef:function(x){var b=bi();return x={current:x},b.memoizedState=x},useState:Lo,useDebugValue:Oo,useDeferredValue:function(x){return bi().memoizedState=x},useTransition:function(){var x=Lo(!1),b=x[0];return x=P.bind(null,x[1]),bi().memoizedState=x,[b,x]},useMutableSource:function(){},useSyncExternalStore:function(x,b,M){var B=ln,$=bi();if(tn){if(M===void 0)throw Error(s(407));M=M()}else{if(M=b(),cn===null)throw Error(s(349));(Mo&30)!==0||Ic(B,b,M)}$.memoizedState=M;var ee={value:M,getSnapshot:b};return $.queue=ee,Ch(vl.bind(null,B,ee,x),[x]),B.flags|=2048,Ro(9,jc.bind(null,B,ee,M,b),void 0,null),M},useId:function(){var x=bi(),b=cn.identifierPrefix;if(tn){var M=ps,B=Xi;M=(B&~(1<<32-er(B)-1)).toString(32)+M,b=":"+b+"R"+M,M=Ao++,0<M&&(b+="H"+M.toString(32)),b+=":"}else M=tu++,b=":"+b+"r"+M.toString(32)+":";return x.memoizedState=b},unstable_isNewReconciler:!1},Xt={readContext:_a,useCallback:Eh,useContext:_a,useEffect:Gu,useImperativeHandle:nu,useInsertionEffect:Bc,useLayoutEffect:Kr,useMemo:f,useReducer:Uu,useRef:_h,useState:function(){return Uu(Qa)},useDebugValue:Oo,useDeferredValue:function(x){var b=wi();return k(b,zn.memoizedState,x)},useTransition:function(){var x=Uu(Qa)[0],b=wi().memoizedState;return[x,b]},useMutableSource:Sh,useSyncExternalStore:vs,useId:H,unstable_isNewReconciler:!1},hr={readContext:_a,useCallback:Eh,useContext:_a,useEffect:Gu,useImperativeHandle:nu,useInsertionEffect:Bc,useLayoutEffect:Kr,useMemo:f,useReducer:gl,useRef:_h,useState:function(){return gl(Qa)},useDebugValue:Oo,useDeferredValue:function(x){var b=wi();return zn===null?b.memoizedState=x:k(b,zn.memoizedState,x)},useTransition:function(){var x=gl(Qa)[0],b=wi().memoizedState;return[x,b]},useMutableSource:Sh,useSyncExternalStore:vs,useId:H,unstable_isNewReconciler:!1};function Zr(x,b){if(x&&x.defaultProps){b=a({},b),x=x.defaultProps;for(var M in x)b[M]===void 0&&(b[M]=x[M]);return b}return b}function Gn(x,b,M,B){b=x.memoizedState,M=M(B,b),M=M==null?b:a({},b,M),x.memoizedState=M,x.lanes===0&&(x.updateQueue.baseState=M)}var Ai={isMounted:function(x){return(x=x._reactInternals)?F(x)===x:!1},enqueueSetState:function(x,b,M){x=x._reactInternals;var B=xn(),$=ki(x),ee=Ya(B,$);ee.payload=b,M!=null&&(ee.callback=M),b=lo(x,ee,$),b!==null&&(sa(b,x,$,B),fl(b,x,$))},enqueueReplaceState:function(x,b,M){x=x._reactInternals;var B=xn(),$=ki(x),ee=Ya(B,$);ee.tag=1,ee.payload=b,M!=null&&(ee.callback=M),b=lo(x,ee,$),b!==null&&(sa(b,x,$,B),fl(b,x,$))},enqueueForceUpdate:function(x,b){x=x._reactInternals;var M=xn(),B=ki(x),$=Ya(M,B);$.tag=2,b!=null&&($.callback=b),b=lo(x,$,B),b!==null&&(sa(b,x,B,M),fl(b,x,B))}};function zi(x,b,M,B,$,ee,me){return x=x.stateNode,typeof x.shouldComponentUpdate=="function"?x.shouldComponentUpdate(B,ee,me):b.prototype&&b.prototype.isPureReactComponent?!Is(M,B)||!Is($,ee):!0}function yl(x,b,M){var B=!1,$=Dt,ee=b.contextType;return typeof ee=="object"&&ee!==null?ee=_a(ee):($=zt(b)?Fr:Nr.current,B=b.contextTypes,ee=(B=B!=null)?vi(x,$):Dt),b=new b(M,ee),x.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Ai,x.stateNode=b,b._reactInternals=x,B&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=$,x.__reactInternalMemoizedMaskedChildContext=ee),b}function Uc(x,b,M,B){x=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(M,B),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(M,B),b.state!==x&&Ai.enqueueReplaceState(b,b.state,null)}function zs(x,b,M,B){var $=x.stateNode;$.props=M,$.state=x.memoizedState,$.refs={},wh(x);var ee=b.contextType;typeof ee=="object"&&ee!==null?$.context=_a(ee):(ee=zt(b)?Fr:Nr.current,$.context=vi(x,ee)),$.state=x.memoizedState,ee=b.getDerivedStateFromProps,typeof ee=="function"&&(Gn(x,b,ee,M),$.state=x.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(b=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),b!==$.state&&Ai.enqueueReplaceState($,$.state,null),Mi(x,M,$,B),$.state=x.memoizedState),typeof $.componentDidMount=="function"&&(x.flags|=4194308)}function xl(x,b){try{var M="",B=b;do M+=ym(B),B=B.return;while(B);var $=M}catch(ee){$=`
Error generating stack: `+ee.message+`
`+ee.stack}return{value:x,source:b,stack:$,digest:null}}function co(x,b,M){return{value:x,source:null,stack:M??null,digest:b??null}}function es(x,b){try{console.error(b.value)}catch(M){setTimeout(function(){throw M})}}var iu=typeof WeakMap=="function"?WeakMap:Map;function zr(x,b,M){M=Ya(-1,M),M.tag=3,M.payload={element:null};var B=b.value;return M.callback=function(){Wn||(Wn=!0,oi=B),es(x,b)},M}function bl(x,b,M){M=Ya(-1,M),M.tag=3;var B=x.type.getDerivedStateFromError;if(typeof B=="function"){var $=b.value;M.payload=function(){return B($)},M.callback=function(){es(x,b)}}var ee=x.stateNode;return ee!==null&&typeof ee.componentDidCatch=="function"&&(M.callback=function(){es(x,b),typeof B!="function"&&(fo===null?fo=new Set([this]):fo.add(this));var me=b.stack;this.componentDidCatch(b.value,{componentStack:me!==null?me:""})}),M}function Bf(x,b,M){var B=x.pingCache;if(B===null){B=x.pingCache=new iu;var $=new Set;B.set(b,$)}else $=B.get(b),$===void 0&&($=new Set,B.set(b,$));$.has(M)||($.add(M),x=k0.bind(null,x,b,M),b.then(x,x))}function zf(x){do{var b;if((b=x.tag===13)&&(b=x.memoizedState,b=b!==null?b.dehydrated!==null:!0),b)return x;x=x.return}while(x!==null);return null}function Do(x,b,M,B,$){return(x.mode&1)===0?(x===b?x.flags|=65536:(x.flags|=128,M.flags|=131072,M.flags&=-52805,M.tag===1&&(M.alternate===null?M.tag=17:(b=Ya(-1,1),b.tag=2,lo(M,b,1))),M.lanes|=1),x):(x.flags|=65536,x.lanes=$,x)}var wl=o.ReactCurrentOwner,Vn=!1;function si(x,b,M,B){b.child=x===null?Mc(b,null,M,B):cl(b,x.child,M,B)}function Uf(x,b,M,B,$){M=M.render;var ee=b.ref;return Ji(b,$),B=ru(x,b,M,B,ee,$),M=Dc(),x!==null&&!Vn?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~$,kl(x,b,$)):(tn&&M&&Qi(b),b.flags|=1,si(x,b,B,$),b.child)}function Vu(x,b,M,B,$){if(x===null){var ee=M.type;return typeof ee=="function"&&!rd(ee)&&ee.defaultProps===void 0&&M.compare===null&&M.defaultProps===void 0?(b.tag=15,b.type=ee,Sl(x,b,ee,B,$)):(x=np(M.type,null,B,b,b.mode,$),x.ref=b.ref,x.return=b,b.child=x)}if(ee=x.child,(x.lanes&$)===0){var me=ee.memoizedProps;if(M=M.compare,M=M!==null?M:Is,M(me,B)&&x.ref===b.ref)return kl(x,b,$)}return b.flags|=1,x=pu(ee,B),x.ref=b.ref,x.return=b,b.child=x}function Sl(x,b,M,B,$){if(x!==null){var ee=x.memoizedProps;if(Is(ee,B)&&x.ref===b.ref)if(Vn=!1,b.pendingProps=B=ee,(x.lanes&$)!==0)(x.flags&131072)!==0&&(Vn=!0);else return b.lanes=x.lanes,kl(x,b,$)}return Io(x,b,M,B,$)}function pn(x,b,M){var B=b.pendingProps,$=B.children,ee=x!==null?x.memoizedState:null;if(B.mode==="hidden")if((b.mode&1)===0)b.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ze(cu,Si),Si|=M;else{if((M&1073741824)===0)return x=ee!==null?ee.baseLanes|M:M,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:x,cachePool:null,transitions:null},b.updateQueue=null,Ze(cu,Si),Si|=x,null;b.memoizedState={baseLanes:0,cachePool:null,transitions:null},B=ee!==null?ee.baseLanes:M,Ze(cu,Si),Si|=B}else ee!==null?(B=ee.baseLanes|M,b.memoizedState=null):B=M,Ze(cu,Si),Si|=B;return si(x,b,$,M),b.child}function un(x,b){var M=b.ref;(x===null&&M!==null||x!==null&&x.ref!==M)&&(b.flags|=512,b.flags|=2097152)}function Io(x,b,M,B,$){var ee=zt(M)?Fr:Nr.current;return ee=vi(b,ee),Ji(b,$),M=ru(x,b,M,B,ee,$),B=Dc(),x!==null&&!Vn?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~$,kl(x,b,$)):(tn&&B&&Qi(b),b.flags|=1,si(x,b,M,$),b.child)}function Ui(x,b,M,B,$){if(zt(M)){var ee=!0;tr(b)}else ee=!1;if(Ji(b,$),b.stateNode===null)Th(x,b),yl(b,M,B),zs(b,M,B,$),B=!0;else if(x===null){var me=b.stateNode,Te=b.memoizedProps;me.props=Te;var Ue=me.context,gt=M.contextType;typeof gt=="object"&&gt!==null?gt=_a(gt):(gt=zt(M)?Fr:Nr.current,gt=vi(b,gt));var It=M.getDerivedStateFromProps,ur=typeof It=="function"||typeof me.getSnapshotBeforeUpdate=="function";ur||typeof me.UNSAFE_componentWillReceiveProps!="function"&&typeof me.componentWillReceiveProps!="function"||(Te!==B||Ue!==gt)&&Uc(b,me,B,gt),Pi=!1;var Mt=b.memoizedState;me.state=Mt,Mi(b,B,me,$),Ue=b.memoizedState,Te!==B||Mt!==Ue||Pr.current||Pi?(typeof It=="function"&&(Gn(b,M,It,B),Ue=b.memoizedState),(Te=Pi||zi(b,M,Te,B,Mt,Ue,gt))?(ur||typeof me.UNSAFE_componentWillMount!="function"&&typeof me.componentWillMount!="function"||(typeof me.componentWillMount=="function"&&me.componentWillMount(),typeof me.UNSAFE_componentWillMount=="function"&&me.UNSAFE_componentWillMount()),typeof me.componentDidMount=="function"&&(b.flags|=4194308)):(typeof me.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=B,b.memoizedState=Ue),me.props=B,me.state=Ue,me.context=gt,B=Te):(typeof me.componentDidMount=="function"&&(b.flags|=4194308),B=!1)}else{me=b.stateNode,oo(x,b),Te=b.memoizedProps,gt=b.type===b.elementType?Te:Zr(b.type,Te),me.props=gt,ur=b.pendingProps,Mt=me.context,Ue=M.contextType,typeof Ue=="object"&&Ue!==null?Ue=_a(Ue):(Ue=zt(M)?Fr:Nr.current,Ue=vi(b,Ue));var gn=M.getDerivedStateFromProps;(It=typeof gn=="function"||typeof me.getSnapshotBeforeUpdate=="function")||typeof me.UNSAFE_componentWillReceiveProps!="function"&&typeof me.componentWillReceiveProps!="function"||(Te!==ur||Mt!==Ue)&&Uc(b,me,B,Ue),Pi=!1,Mt=b.memoizedState,me.state=Mt,Mi(b,B,me,$);var Xr=b.memoizedState;Te!==ur||Mt!==Xr||Pr.current||Pi?(typeof gn=="function"&&(Gn(b,M,gn,B),Xr=b.memoizedState),(gt=Pi||zi(b,M,gt,B,Mt,Xr,Ue)||!1)?(It||typeof me.UNSAFE_componentWillUpdate!="function"&&typeof me.componentWillUpdate!="function"||(typeof me.componentWillUpdate=="function"&&me.componentWillUpdate(B,Xr,Ue),typeof me.UNSAFE_componentWillUpdate=="function"&&me.UNSAFE_componentWillUpdate(B,Xr,Ue)),typeof me.componentDidUpdate=="function"&&(b.flags|=4),typeof me.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof me.componentDidUpdate!="function"||Te===x.memoizedProps&&Mt===x.memoizedState||(b.flags|=4),typeof me.getSnapshotBeforeUpdate!="function"||Te===x.memoizedProps&&Mt===x.memoizedState||(b.flags|=1024),b.memoizedProps=B,b.memoizedState=Xr),me.props=B,me.state=Xr,me.context=Ue,B=gt):(typeof me.componentDidUpdate!="function"||Te===x.memoizedProps&&Mt===x.memoizedState||(b.flags|=4),typeof me.getSnapshotBeforeUpdate!="function"||Te===x.memoizedProps&&Mt===x.memoizedState||(b.flags|=1024),B=!1)}return na(x,b,M,B,ee,$)}function na(x,b,M,B,$,ee){un(x,b);var me=(b.flags&128)!==0;if(!B&&!me)return $&&Rr(b,M,!1),kl(x,b,ee);B=b.stateNode,wl.current=b;var Te=me&&typeof M.getDerivedStateFromError!="function"?null:B.render();return b.flags|=1,x!==null&&me?(b.child=cl(b,x.child,null,ee),b.child=cl(b,null,Te,ee)):si(x,b,Te,ee),b.memoizedState=B.state,$&&Rr(b,M,!0),b.child}function au(x){var b=x.stateNode;b.pendingContext?al(x,b.pendingContext,b.pendingContext!==b.context):b.context&&al(x,b.context,!1),Ql(x,b.containerInfo)}function Hu(x,b,M,B,$){return Po(),Nc($),b.flags|=256,si(x,b,M,B),b.child}var ia={dehydrated:null,treeContext:null,retryLane:0};function Gc(x){return{baseLanes:x,cachePool:null,transitions:null}}function xm(x,b,M){var B=b.pendingProps,$=Hr.current,ee=!1,me=(b.flags&128)!==0,Te;if((Te=me)||(Te=x!==null&&x.memoizedState===null?!1:($&2)!==0),Te?(ee=!0,b.flags&=-129):(x===null||x.memoizedState!==null)&&($|=1),Ze(Hr,$&1),x===null)return vh(b),x=b.memoizedState,x!==null&&(x=x.dehydrated,x!==null)?((b.mode&1)===0?b.lanes=1:vr(x)?b.lanes=8:b.lanes=1073741824,null):(me=B.children,x=B.fallback,ee?(B=b.mode,ee=b.child,me={mode:"hidden",children:me},(B&1)===0&&ee!==null?(ee.childLanes=0,ee.pendingProps=me):ee=nd(me,B,0,null),x=Gi(x,B,M,null),ee.return=b,x.return=b,ee.sibling=x,b.child=ee,b.child.memoizedState=Gc(M),b.memoizedState=ia,x):Gf(b,me));if($=x.memoizedState,$!==null&&(Te=$.dehydrated,Te!==null))return v0(x,b,me,B,Te,$,M);if(ee){ee=B.fallback,me=b.mode,$=x.child,Te=$.sibling;var Ue={mode:"hidden",children:B.children};return(me&1)===0&&b.child!==$?(B=b.child,B.childLanes=0,B.pendingProps=Ue,b.deletions=null):(B=pu($,Ue),B.subtreeFlags=$.subtreeFlags&14680064),Te!==null?ee=pu(Te,ee):(ee=Gi(ee,me,M,null),ee.flags|=2),ee.return=b,B.return=b,B.sibling=ee,b.child=B,B=ee,ee=b.child,me=x.child.memoizedState,me=me===null?Gc(M):{baseLanes:me.baseLanes|M,cachePool:null,transitions:me.transitions},ee.memoizedState=me,ee.childLanes=x.childLanes&~M,b.memoizedState=ia,B}return ee=x.child,x=ee.sibling,B=pu(ee,{mode:"visible",children:B.children}),(b.mode&1)===0&&(B.lanes=M),B.return=b,B.sibling=null,x!==null&&(M=b.deletions,M===null?(b.deletions=[x],b.flags|=16):M.push(x)),b.child=B,b.memoizedState=null,B}function Gf(x,b){return b=nd({mode:"visible",children:b},x.mode,0,null),b.return=x,x.child=b}function Wu(x,b,M,B){return B!==null&&Nc(B),cl(b,x.child,null,M),x=Gf(b,b.pendingProps.children),x.flags|=2,b.memoizedState=null,x}function v0(x,b,M,B,$,ee,me){if(M)return b.flags&256?(b.flags&=-257,B=co(Error(s(422))),Wu(x,b,me,B)):b.memoizedState!==null?(b.child=x.child,b.flags|=128,null):(ee=B.fallback,$=b.mode,B=nd({mode:"visible",children:B.children},$,0,null),ee=Gi(ee,$,me,null),ee.flags|=2,B.return=b,ee.return=b,B.sibling=ee,b.child=B,(b.mode&1)!==0&&cl(b,x.child,null,me),b.child.memoizedState=Gc(me),b.memoizedState=ia,ee);if((b.mode&1)===0)return Wu(x,b,me,null);if(vr($))return B=Et($).digest,ee=Error(s(419)),B=co(ee,B,void 0),Wu(x,b,me,B);if(M=(me&x.childLanes)!==0,Vn||M){if(B=cn,B!==null){switch(me&-me){case 4:$=2;break;case 16:$=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:$=32;break;case 536870912:$=268435456;break;default:$=0}$=($&(B.suspendedLanes|me))!==0?0:$,$!==0&&$!==ee.retryLane&&(ee.retryLane=$,Za(x,$),sa(B,x,$,-1))}return td(),B=co(Error(s(421))),Wu(x,b,me,B)}return hn($)?(b.flags|=128,b.child=x.child,b=C0.bind(null,x),Br($,b),null):(x=ee.treeContext,Se&&(_n=As($),ai=b,tn=!0,ka=null,$l=!1,x!==null&&(xi[wa++]=Xi,xi[wa++]=ps,xi[wa++]=Bn,Xi=x.id,ps=x.overflow,Bn=b)),b=Gf(b,B.children),b.flags|=4096,b)}function jo(x,b,M){x.lanes|=b;var B=x.alternate;B!==null&&(B.lanes|=b),dl(x.return,b,M)}function Vc(x,b,M,B,$){var ee=x.memoizedState;ee===null?x.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:B,tail:M,tailMode:$}:(ee.isBackwards=b,ee.rendering=null,ee.renderingStartTime=0,ee.last=B,ee.tail=M,ee.tailMode=$)}function Vf(x,b,M){var B=b.pendingProps,$=B.revealOrder,ee=B.tail;if(si(x,b,B.children,M),B=Hr.current,(B&2)!==0)B=B&1|2,b.flags|=128;else{if(x!==null&&(x.flags&128)!==0)e:for(x=b.child;x!==null;){if(x.tag===13)x.memoizedState!==null&&jo(x,M,b);else if(x.tag===19)jo(x,M,b);else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===b)break e;for(;x.sibling===null;){if(x.return===null||x.return===b)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}B&=1}if(Ze(Hr,B),(b.mode&1)===0)b.memoizedState=null;else switch($){case"forwards":for(M=b.child,$=null;M!==null;)x=M.alternate,x!==null&&pl(x)===null&&($=M),M=M.sibling;M=$,M===null?($=b.child,b.child=null):($=M.sibling,M.sibling=null),Vc(b,!1,$,M,ee);break;case"backwards":for(M=null,$=b.child,b.child=null;$!==null;){if(x=$.alternate,x!==null&&pl(x)===null){b.child=$;break}x=$.sibling,$.sibling=M,M=$,$=x}Vc(b,!0,M,null,ee);break;case"together":Vc(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function Th(x,b){(b.mode&1)===0&&x!==null&&(x.alternate=null,b.alternate=null,b.flags|=2)}function kl(x,b,M){if(x!==null&&(b.dependencies=x.dependencies),Cl|=b.lanes,(M&b.childLanes)===0)return null;if(x!==null&&b.child!==x.child)throw Error(s(153));if(b.child!==null){for(x=b.child,M=pu(x,x.pendingProps),b.child=M,M.return=b;x.sibling!==null;)x=x.sibling,M=M.sibling=pu(x,x.pendingProps),M.return=b;M.sibling=null}return b.child}function su(x,b,M){switch(b.tag){case 3:au(b),Po();break;case 5:Bu(b);break;case 1:zt(b.type)&&tr(b);break;case 4:Ql(b,b.stateNode.containerInfo);break;case 10:Ka(b,b.type._context,b.memoizedProps.value);break;case 13:var B=b.memoizedState;if(B!==null)return B.dehydrated!==null?(Ze(Hr,Hr.current&1),b.flags|=128,null):(M&b.child.childLanes)!==0?xm(x,b,M):(Ze(Hr,Hr.current&1),x=kl(x,b,M),x!==null?x.sibling:null);Ze(Hr,Hr.current&1);break;case 19:if(B=(M&b.childLanes)!==0,(x.flags&128)!==0){if(B)return Vf(x,b,M);b.flags|=128}var $=b.memoizedState;if($!==null&&($.rendering=null,$.tail=null,$.lastEffect=null),Ze(Hr,Hr.current),B)break;return null;case 22:case 23:return b.lanes=0,pn(x,b,M)}return kl(x,b,M)}function Na(x){x.flags|=4}function qu(x,b){if(x!==null&&x.child===b.child)return!0;if((b.flags&16)!==0)return!1;for(x=b.child;x!==null;){if((x.flags&12854)!==0||(x.subtreeFlags&12854)!==0)return!1;x=x.sibling}return!0}var ou,lu,Pa,Ma;if(ue)ou=function(x,b){for(var M=b.child;M!==null;){if(M.tag===5||M.tag===6)re(x,M.stateNode);else if(M.tag!==4&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===b)break;for(;M.sibling===null;){if(M.return===null||M.return===b)return;M=M.return}M.sibling.return=M.return,M=M.sibling}},lu=function(){},Pa=function(x,b,M,B,$){if(x=x.memoizedProps,x!==B){var ee=b.stateNode,me=Ta(Xa.current);M=oe(ee,M,x,B,$,me),(b.updateQueue=M)&&Na(b)}},Ma=function(x,b,M,B){M!==B&&Na(b)};else if(xe){ou=function(x,b,M,B){for(var $=b.child;$!==null;){if($.tag===5){var ee=$.stateNode;M&&B&&(ee=Lr(ee,$.type,$.memoizedProps,$)),re(x,ee)}else if($.tag===6)ee=$.stateNode,M&&B&&(ee=kr(ee,$.memoizedProps,$)),re(x,ee);else if($.tag!==4){if($.tag===22&&$.memoizedState!==null)ee=$.child,ee!==null&&(ee.return=$),ou(x,$,!0,!0);else if($.child!==null){$.child.return=$,$=$.child;continue}}if($===b)break;for(;$.sibling===null;){if($.return===null||$.return===b)return;$=$.return}$.sibling.return=$.return,$=$.sibling}};var uu=function(x,b,M,B){for(var $=b.child;$!==null;){if($.tag===5){var ee=$.stateNode;M&&B&&(ee=Lr(ee,$.type,$.memoizedProps,$)),Ct(x,ee)}else if($.tag===6)ee=$.stateNode,M&&B&&(ee=kr(ee,$.memoizedProps,$)),Ct(x,ee);else if($.tag!==4){if($.tag===22&&$.memoizedState!==null)ee=$.child,ee!==null&&(ee.return=$),uu(x,$,!0,!0);else if($.child!==null){$.child.return=$,$=$.child;continue}}if($===b)break;for(;$.sibling===null;){if($.return===null||$.return===b)return;$=$.return}$.sibling.return=$.return,$=$.sibling}};lu=function(x,b){var M=b.stateNode;if(!qu(x,b)){x=M.containerInfo;var B=Pt(x);uu(B,b,!1,!1),M.pendingChildren=B,Na(b),Vt(x,B)}},Pa=function(x,b,M,B,$){var ee=x.stateNode,me=x.memoizedProps;if((x=qu(x,b))&&me===B)b.stateNode=ee;else{var Te=b.stateNode,Ue=Ta(Xa.current),gt=null;me!==B&&(gt=oe(Te,M,me,B,$,Ue)),x&&gt===null?b.stateNode=ee:(ee=wt(ee,gt,M,me,B,b,x,Te),he(ee,M,B,$,Ue)&&Na(b),b.stateNode=ee,x?Na(b):ou(ee,b,!1,!1))}},Ma=function(x,b,M,B){M!==B?(x=Ta(gs.current),M=Ta(Xa.current),b.stateNode=fe(B,x,M,b),Na(b)):b.stateNode=x.stateNode}}else lu=function(){},Pa=function(){},Ma=function(){};function ys(x,b){if(!tn)switch(x.tailMode){case"hidden":b=x.tail;for(var M=null;b!==null;)b.alternate!==null&&(M=b),b=b.sibling;M===null?x.tail=null:M.sibling=null;break;case"collapsed":M=x.tail;for(var B=null;M!==null;)M.alternate!==null&&(B=M),M=M.sibling;B===null?b||x.tail===null?x.tail=null:x.tail.sibling=null:B.sibling=null}}function Cn(x){var b=x.alternate!==null&&x.alternate.child===x.child,M=0,B=0;if(b)for(var $=x.child;$!==null;)M|=$.lanes|$.childLanes,B|=$.subtreeFlags&14680064,B|=$.flags&14680064,$.return=x,$=$.sibling;else for($=x.child;$!==null;)M|=$.lanes|$.childLanes,B|=$.subtreeFlags,B|=$.flags,$.return=x,$=$.sibling;return x.subtreeFlags|=B,x.childLanes=M,b}function $u(x,b,M){var B=b.pendingProps;switch(ju(b),b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Cn(b),null;case 1:return zt(b.type)&&Ir(),Cn(b),null;case 3:return M=b.stateNode,Fs(),pt(Pr),pt(Nr),Oc(),M.pendingContext&&(M.context=M.pendingContext,M.pendingContext=null),(x===null||x.child===null)&&(Kl(b)?Na(b):x===null||x.memoizedState.isDehydrated&&(b.flags&256)===0||(b.flags|=1024,ka!==null&&(tp(ka),ka=null))),lu(x,b),Cn(b),null;case 5:Jl(b),M=Ta(gs.current);var $=b.type;if(x!==null&&b.stateNode!=null)Pa(x,b,$,B,M),x.ref!==b.ref&&(b.flags|=512,b.flags|=2097152);else{if(!B){if(b.stateNode===null)throw Error(s(166));return Cn(b),null}if(x=Ta(Xa.current),Kl(b)){if(!Se)throw Error(s(175));x=ni(b.stateNode,b.type,b.memoizedProps,M,x,b,!$l),b.updateQueue=x,x!==null&&Na(b)}else{var ee=X($,B,M,x,b);ou(ee,b,!1,!1),b.stateNode=ee,he(ee,$,B,M,x)&&Na(b)}b.ref!==null&&(b.flags|=512,b.flags|=2097152)}return Cn(b),null;case 6:if(x&&b.stateNode!=null)Ma(x,b,x.memoizedProps,B);else{if(typeof B!="string"&&b.stateNode===null)throw Error(s(166));if(x=Ta(gs.current),M=Ta(Xa.current),Kl(b)){if(!Se)throw Error(s(176));if(x=b.stateNode,M=b.memoizedProps,(B=sn(x,M,b,!$l))&&($=ai,$!==null))switch($.tag){case 3:_o($.stateNode.containerInfo,x,M,($.mode&1)!==0);break;case 5:on($.type,$.memoizedProps,$.stateNode,x,M,($.mode&1)!==0)}B&&Na(b)}else b.stateNode=fe(B,x,M,b)}return Cn(b),null;case 13:if(pt(Hr),B=b.memoizedState,x===null||x.memoizedState!==null&&x.memoizedState.dehydrated!==null){if(tn&&_n!==null&&(b.mode&1)!==0&&(b.flags&128)===0)jf(),Po(),b.flags|=98560,$=!1;else if($=Kl(b),B!==null&&B.dehydrated!==null){if(x===null){if(!$)throw Error(s(318));if(!Se)throw Error(s(344));if($=b.memoizedState,$=$!==null?$.dehydrated:null,!$)throw Error(s(317));kn($,b)}else Po(),(b.flags&128)===0&&(b.memoizedState=null),b.flags|=4;Cn(b),$=!1}else ka!==null&&(tp(ka),ka=null),$=!0;if(!$)return b.flags&65536?b:null}return(b.flags&128)!==0?(b.lanes=M,b):(M=B!==null,M!==(x!==null&&x.memoizedState!==null)&&M&&(b.child.flags|=8192,(b.mode&1)!==0&&(x===null||(Hr.current&1)!==0?Tn===0&&(Tn=3):td())),b.updateQueue!==null&&(b.flags|=4),Cn(b),null);case 4:return Fs(),lu(x,b),x===null&&Ae(b.stateNode.containerInfo),Cn(b),null;case 10:return js(b.type._context),Cn(b),null;case 17:return zt(b.type)&&Ir(),Cn(b),null;case 19:if(pt(Hr),$=b.memoizedState,$===null)return Cn(b),null;if(B=(b.flags&128)!==0,ee=$.rendering,ee===null)if(B)ys($,!1);else{if(Tn!==0||x!==null&&(x.flags&128)!==0)for(x=b.child;x!==null;){if(ee=pl(x),ee!==null){for(b.flags|=128,ys($,!1),x=ee.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),b.subtreeFlags=0,x=M,M=b.child;M!==null;)B=M,$=x,B.flags&=14680066,ee=B.alternate,ee===null?(B.childLanes=0,B.lanes=$,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=ee.childLanes,B.lanes=ee.lanes,B.child=ee.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=ee.memoizedProps,B.memoizedState=ee.memoizedState,B.updateQueue=ee.updateQueue,B.type=ee.type,$=ee.dependencies,B.dependencies=$===null?null:{lanes:$.lanes,firstContext:$.firstContext}),M=M.sibling;return Ze(Hr,Hr.current&1|2),b.child}x=x.sibling}$.tail!==null&&jn()>Oh&&(b.flags|=128,B=!0,ys($,!1),b.lanes=4194304)}else{if(!B)if(x=pl(ee),x!==null){if(b.flags|=128,B=!0,x=x.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),ys($,!0),$.tail===null&&$.tailMode==="hidden"&&!ee.alternate&&!tn)return Cn(b),null}else 2*jn()-$.renderingStartTime>Oh&&M!==1073741824&&(b.flags|=128,B=!0,ys($,!1),b.lanes=4194304);$.isBackwards?(ee.sibling=b.child,b.child=ee):(x=$.last,x!==null?x.sibling=ee:b.child=ee,$.last=ee)}return $.tail!==null?(b=$.tail,$.rendering=b,$.tail=b.sibling,$.renderingStartTime=jn(),b.sibling=null,x=Hr.current,Ze(Hr,B?x&1|2:x&1),b):(Cn(b),null);case 22:case 23:return rp(),M=b.memoizedState!==null,x!==null&&x.memoizedState!==null!==M&&(b.flags|=8192),M&&(b.mode&1)!==0?(Si&1073741824)!==0&&(Cn(b),ue&&b.subtreeFlags&6&&(b.flags|=8192)):Cn(b),null;case 24:return null;case 25:return null}throw Error(s(156,b.tag))}function y0(x,b){switch(ju(b),b.tag){case 1:return zt(b.type)&&Ir(),x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 3:return Fs(),pt(Pr),pt(Nr),Oc(),x=b.flags,(x&65536)!==0&&(x&128)===0?(b.flags=x&-65537|128,b):null;case 5:return Jl(b),null;case 13:if(pt(Hr),x=b.memoizedState,x!==null&&x.dehydrated!==null){if(b.alternate===null)throw Error(s(340));Po()}return x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 19:return pt(Hr),null;case 4:return Fs(),null;case 10:return js(b.type._context),null;case 22:case 23:return rp(),null;case 24:return null;default:return null}}var Hc=!1,Li=!1,xs=typeof WeakSet=="function"?WeakSet:Set,St=null;function Yr(x,b){var M=x.ref;if(M!==null)if(typeof M=="function")try{M(null)}catch(B){bn(x,b,B)}else M.current=null}function bs(x,b,M){try{M()}catch(B){bn(x,b,B)}}var bm=!1;function x0(x,b){for(ne(x.containerInfo),St=b;St!==null;)if(x=St,b=x.child,(x.subtreeFlags&1028)!==0&&b!==null)b.return=x,St=b;else for(;St!==null;){x=St;try{var M=x.alternate;if((x.flags&1024)!==0)switch(x.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var B=M.memoizedProps,$=M.memoizedState,ee=x.stateNode,me=ee.getSnapshotBeforeUpdate(x.elementType===x.type?B:Zr(x.type,B),$);ee.__reactInternalSnapshotBeforeUpdate=me}break;case 3:ue&&$e(x.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(Te){bn(x,x.return,Te)}if(b=x.sibling,b!==null){b.return=x.return,St=b;break}St=x.return}return M=bm,bm=!1,M}function Ku(x,b,M){var B=b.updateQueue;if(B=B!==null?B.lastEffect:null,B!==null){var $=B=B.next;do{if(($.tag&x)===x){var ee=$.destroy;$.destroy=void 0,ee!==void 0&&bs(b,M,ee)}$=$.next}while($!==B)}}function Wc(x,b){if(b=b.updateQueue,b=b!==null?b.lastEffect:null,b!==null){var M=b=b.next;do{if((M.tag&x)===x){var B=M.create;M.destroy=B()}M=M.next}while(M!==b)}}function Hf(x){var b=x.ref;if(b!==null){var M=x.stateNode;x.tag===5?x=Z(M):x=M,typeof b=="function"?b(x):b.current=x}}function Nh(x){var b=x.alternate;b!==null&&(x.alternate=null,Nh(b)),x.child=null,x.deletions=null,x.sibling=null,x.tag===5&&(b=x.stateNode,b!==null&&rt(b)),x.stateNode=null,x.return=null,x.dependencies=null,x.memoizedProps=null,x.memoizedState=null,x.pendingProps=null,x.stateNode=null,x.updateQueue=null}function wm(x){return x.tag===5||x.tag===3||x.tag===4}function Zu(x){e:for(;;){for(;x.sibling===null;){if(x.return===null||wm(x.return))return null;x=x.return}for(x.sibling.return=x.return,x=x.sibling;x.tag!==5&&x.tag!==6&&x.tag!==18;){if(x.flags&2||x.child===null||x.tag===4)continue e;x.child.return=x,x=x.child}if(!(x.flags&2))return x.stateNode}}function Ph(x,b,M){var B=x.tag;if(B===5||B===6)x=x.stateNode,b?ge(M,x,b):bt(M,x);else if(B!==4&&(x=x.child,x!==null))for(Ph(x,b,M),x=x.sibling;x!==null;)Ph(x,b,M),x=x.sibling}function Sm(x,b,M){var B=x.tag;if(B===5||B===6)x=x.stateNode,b?de(M,x,b):qe(M,x);else if(B!==4&&(x=x.child,x!==null))for(Sm(x,b,M),x=x.sibling;x!==null;)Sm(x,b,M),x=x.sibling}var Jn=null,ts=!1;function ho(x,b,M){for(M=M.child;M!==null;)Wf(x,b,M),M=M.sibling}function Wf(x,b,M){if(Fn&&typeof Fn.onCommitFiberUnmount=="function")try{Fn.onCommitFiberUnmount(fn,M)}catch{}switch(M.tag){case 5:Li||Yr(M,b);case 6:if(ue){var B=Jn,$=ts;Jn=null,ho(x,b,M),Jn=B,ts=$,Jn!==null&&(ts?Ee(Jn,M.stateNode):ke(Jn,M.stateNode))}else ho(x,b,M);break;case 18:ue&&Jn!==null&&(ts?qa(Jn,M.stateNode):ko(Jn,M.stateNode));break;case 4:ue?(B=Jn,$=ts,Jn=M.stateNode.containerInfo,ts=!0,ho(x,b,M),Jn=B,ts=$):(xe&&(B=M.stateNode.containerInfo,$=Pt(B),Yt(B,$)),ho(x,b,M));break;case 0:case 11:case 14:case 15:if(!Li&&(B=M.updateQueue,B!==null&&(B=B.lastEffect,B!==null))){$=B=B.next;do{var ee=$,me=ee.destroy;ee=ee.tag,me!==void 0&&((ee&2)!==0||(ee&4)!==0)&&bs(M,b,me),$=$.next}while($!==B)}ho(x,b,M);break;case 1:if(!Li&&(Yr(M,b),B=M.stateNode,typeof B.componentWillUnmount=="function"))try{B.props=M.memoizedProps,B.state=M.memoizedState,B.componentWillUnmount()}catch(Te){bn(M,b,Te)}ho(x,b,M);break;case 21:ho(x,b,M);break;case 22:M.mode&1?(Li=(B=Li)||M.memoizedState!==null,ho(x,b,M),Li=B):ho(x,b,M);break;default:ho(x,b,M)}}function Yu(x){var b=x.updateQueue;if(b!==null){x.updateQueue=null;var M=x.stateNode;M===null&&(M=x.stateNode=new xs),b.forEach(function(B){var $=ob.bind(null,x,B);M.has(B)||(M.add(B),B.then($,$))})}}function Us(x,b){var M=b.deletions;if(M!==null)for(var B=0;B<M.length;B++){var $=M[B];try{var ee=x,me=b;if(ue){var Te=me;e:for(;Te!==null;){switch(Te.tag){case 5:Jn=Te.stateNode,ts=!1;break e;case 3:Jn=Te.stateNode.containerInfo,ts=!0;break e;case 4:Jn=Te.stateNode.containerInfo,ts=!0;break e}Te=Te.return}if(Jn===null)throw Error(s(160));Wf(ee,me,$),Jn=null,ts=!1}else Wf(ee,me,$);var Ue=$.alternate;Ue!==null&&(Ue.return=null),$.return=null}catch(gt){bn($,b,gt)}}if(b.subtreeFlags&12854)for(b=b.child;b!==null;)Mh(b,x),b=b.sibling}function Mh(x,b){var M=x.alternate,B=x.flags;switch(x.tag){case 0:case 11:case 14:case 15:if(Us(b,x),ws(x),B&4){try{Ku(3,x,x.return),Wc(3,x)}catch(Mt){bn(x,x.return,Mt)}try{Ku(5,x,x.return)}catch(Mt){bn(x,x.return,Mt)}}break;case 1:Us(b,x),ws(x),B&512&&M!==null&&Yr(M,M.return);break;case 5:if(Us(b,x),ws(x),B&512&&M!==null&&Yr(M,M.return),ue){if(x.flags&32){var $=x.stateNode;try{Le($)}catch(Mt){bn(x,x.return,Mt)}}if(B&4&&($=x.stateNode,$!=null)){var ee=x.memoizedProps;if(M=M!==null?M.memoizedProps:ee,B=x.type,b=x.updateQueue,x.updateQueue=null,b!==null)try{Fe($,b,B,M,ee,x)}catch(Mt){bn(x,x.return,Mt)}}}break;case 6:if(Us(b,x),ws(x),B&4&&ue){if(x.stateNode===null)throw Error(s(162));$=x.stateNode,ee=x.memoizedProps,M=M!==null?M.memoizedProps:ee;try{at($,M,ee)}catch(Mt){bn(x,x.return,Mt)}}break;case 3:if(Us(b,x),ws(x),B&4){if(ue&&Se&&M!==null&&M.memoizedState.isDehydrated)try{Ls(b.containerInfo)}catch(Mt){bn(x,x.return,Mt)}if(xe){$=b.containerInfo,ee=b.pendingChildren;try{Yt($,ee)}catch(Mt){bn(x,x.return,Mt)}}}break;case 4:if(Us(b,x),ws(x),B&4&&xe){ee=x.stateNode,$=ee.containerInfo,ee=ee.pendingChildren;try{Yt($,ee)}catch(Mt){bn(x,x.return,Mt)}}break;case 13:Us(b,x),ws(x),$=x.child,$.flags&8192&&(ee=$.memoizedState!==null,$.stateNode.isHidden=ee,!ee||$.alternate!==null&&$.alternate.memoizedState!==null||(Xc=jn())),B&4&&Yu(x);break;case 22:var me=M!==null&&M.memoizedState!==null;if(x.mode&1?(Li=(M=Li)||me,Us(b,x),Li=M):Us(b,x),ws(x),B&8192){if(M=x.memoizedState!==null,(x.stateNode.isHidden=M)&&!me&&(x.mode&1)!==0)for(St=x,B=x.child;B!==null;){for(b=St=B;St!==null;){me=St;var Te=me.child;switch(me.tag){case 0:case 11:case 14:case 15:Ku(4,me,me.return);break;case 1:Yr(me,me.return);var Ue=me.stateNode;if(typeof Ue.componentWillUnmount=="function"){var gt=me,It=me.return;try{var ur=gt;Ue.props=ur.memoizedProps,Ue.state=ur.memoizedState,Ue.componentWillUnmount()}catch(Mt){bn(gt,It,Mt)}}break;case 5:Yr(me,me.return);break;case 22:if(me.memoizedState!==null){Kf(b);continue}}Te!==null?(Te.return=me,St=Te):Kf(b)}B=B.sibling}if(ue){e:if(B=null,ue)for(b=x;;){if(b.tag===5){if(B===null){B=b;try{$=b.stateNode,M?Qe($):xt(b.stateNode,b.memoizedProps)}catch(Mt){bn(x,x.return,Mt)}}}else if(b.tag===6){if(B===null)try{ee=b.stateNode,M?Ve(ee):ze(ee,b.memoizedProps)}catch(Mt){bn(x,x.return,Mt)}}else if((b.tag!==22&&b.tag!==23||b.memoizedState===null||b===x)&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===x)break e;for(;b.sibling===null;){if(b.return===null||b.return===x)break e;B===b&&(B=null),b=b.return}B===b&&(B=null),b.sibling.return=b.return,b=b.sibling}}}break;case 19:Us(b,x),ws(x),B&4&&Yu(x);break;case 21:break;default:Us(b,x),ws(x)}}function ws(x){var b=x.flags;if(b&2){try{if(ue){e:{for(var M=x.return;M!==null;){if(wm(M)){var B=M;break e}M=M.return}throw Error(s(160))}switch(B.tag){case 5:var $=B.stateNode;B.flags&32&&(Le($),B.flags&=-33);var ee=Zu(x);Sm(x,ee,$);break;case 3:case 4:var me=B.stateNode.containerInfo,Te=Zu(x);Ph(x,Te,me);break;default:throw Error(s(161))}}}catch(Ue){bn(x,x.return,Ue)}x.flags&=-3}b&4096&&(x.flags&=-4097)}function qc(x,b,M){St=x,qf(x)}function qf(x,b,M){for(var B=(x.mode&1)!==0;St!==null;){var $=St,ee=$.child;if($.tag===22&&B){var me=$.memoizedState!==null||Hc;if(!me){var Te=$.alternate,Ue=Te!==null&&Te.memoizedState!==null||Li;Te=Hc;var gt=Li;if(Hc=me,(Li=Ue)&&!gt)for(St=$;St!==null;)me=St,Ue=me.child,me.tag===22&&me.memoizedState!==null?Zf($):Ue!==null?(Ue.return=me,St=Ue):Zf($);for(;ee!==null;)St=ee,qf(ee),ee=ee.sibling;St=$,Hc=Te,Li=gt}$f(x)}else($.subtreeFlags&8772)!==0&&ee!==null?(ee.return=$,St=ee):$f(x)}}function $f(x){for(;St!==null;){var b=St;if((b.flags&8772)!==0){var M=b.alternate;try{if((b.flags&8772)!==0)switch(b.tag){case 0:case 11:case 15:Li||Wc(5,b);break;case 1:var B=b.stateNode;if(b.flags&4&&!Li)if(M===null)B.componentDidMount();else{var $=b.elementType===b.type?M.memoizedProps:Zr(b.type,M.memoizedProps);B.componentDidUpdate($,M.memoizedState,B.__reactInternalSnapshotBeforeUpdate)}var ee=b.updateQueue;ee!==null&&Ff(b,ee,B);break;case 3:var me=b.updateQueue;if(me!==null){if(M=null,b.child!==null)switch(b.child.tag){case 5:M=Z(b.child.stateNode);break;case 1:M=b.child.stateNode}Ff(b,me,M)}break;case 5:var Te=b.stateNode;M===null&&b.flags&4&&ut(Te,b.type,b.memoizedProps,b);break;case 6:break;case 4:break;case 12:break;case 13:if(Se&&b.memoizedState===null){var Ue=b.alternate;if(Ue!==null){var gt=Ue.memoizedState;if(gt!==null){var It=gt.dehydrated;It!==null&&gi(It)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}Li||b.flags&512&&Hf(b)}catch(ur){bn(b,b.return,ur)}}if(b===x){St=null;break}if(M=b.sibling,M!==null){M.return=b.return,St=M;break}St=b.return}}function Kf(x){for(;St!==null;){var b=St;if(b===x){St=null;break}var M=b.sibling;if(M!==null){M.return=b.return,St=M;break}St=b.return}}function Zf(x){for(;St!==null;){var b=St;try{switch(b.tag){case 0:case 11:case 15:var M=b.return;try{Wc(4,b)}catch(Ue){bn(b,M,Ue)}break;case 1:var B=b.stateNode;if(typeof B.componentDidMount=="function"){var $=b.return;try{B.componentDidMount()}catch(Ue){bn(b,$,Ue)}}var ee=b.return;try{Hf(b)}catch(Ue){bn(b,ee,Ue)}break;case 5:var me=b.return;try{Hf(b)}catch(Ue){bn(b,me,Ue)}}}catch(Ue){bn(b,b.return,Ue)}if(b===x){St=null;break}var Te=b.sibling;if(Te!==null){Te.return=b.return,St=Te;break}St=b.return}}var _l=0,Aa=1,Fo=2,$c=3,Ah=4;if(typeof Symbol=="function"&&Symbol.for){var Ss=Symbol.for;_l=Ss("selector.component"),Aa=Ss("selector.has_pseudo_class"),Fo=Ss("selector.role"),$c=Ss("selector.test_id"),Ah=Ss("selector.text")}function Bo(x){var b=Oe(x);if(b!=null){if(typeof b.memoizedProps["data-testname"]!="string")throw Error(s(364));return b}if(x=ht(x),x===null)throw Error(s(362));return x.stateNode.current}function Lh(x,b){switch(b.$$typeof){case _l:if(x.type===b.value)return!0;break;case Aa:e:{b=b.value,x=[x,0];for(var M=0;M<x.length;){var B=x[M++],$=x[M++],ee=b[$];if(B.tag!==5||!lt(B)){for(;ee!=null&&Lh(B,ee);)$++,ee=b[$];if($===b.length){b=!0;break e}else for(B=B.child;B!==null;)x.push(B,$),B=B.sibling}}b=!1}return b;case Fo:if(x.tag===5&&Lt(x.stateNode,b.value))return!0;break;case Ah:if((x.tag===5||x.tag===6)&&(x=vt(x),x!==null&&0<=x.indexOf(b.value)))return!0;break;case $c:if(x.tag===5&&(x=x.memoizedProps["data-testname"],typeof x=="string"&&x.toLowerCase()===b.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function Yf(x){switch(x.$$typeof){case _l:return"<"+(j(x.value)||"Unknown")+">";case Aa:return":has("+(Yf(x)||"")+")";case Fo:return'[role="'+x.value+'"]';case Ah:return'"'+x.value+'"';case $c:return'[data-testname="'+x.value+'"]';default:throw Error(s(365))}}function zo(x,b){var M=[];x=[x,0];for(var B=0;B<x.length;){var $=x[B++],ee=x[B++],me=b[ee];if($.tag!==5||!lt($)){for(;me!=null&&Lh($,me);)ee++,me=b[ee];if(ee===b.length)M.push($);else for($=$.child;$!==null;)x.push($,ee),$=$.sibling}}return M}function Uo(x,b){if(!Xe)throw Error(s(363));x=Bo(x),x=zo(x,b),b=[],x=Array.from(x);for(var M=0;M<x.length;){var B=x[M++];if(B.tag===5)lt(B)||b.push(B.stateNode);else for(B=B.child;B!==null;)x.push(B),B=B.sibling}return b}var Xf=Math.ceil,Rh=o.ReactCurrentDispatcher,Kc=o.ReactCurrentOwner,Hn=o.ReactCurrentBatchConfig,fr=0,cn=null,En=null,ei=0,Si=0,cu=nt(0),Tn=0,Zc=null,Cl=0,mn=0,Yc=0,Xu=null,aa=null,Xc=0,Oh=1/0,La=null;function rn(){Oh=jn()+500}var Wn=!1,oi=null,fo=null,du=!1,Gs=null,Qf=0,li=0,Dh=null,Qc=-1,Jc=0;function xn(){return(fr&6)!==0?jn():Qc!==-1?Qc:Qc=jn()}function ki(x){return(x.mode&1)===0?1:(fr&2)!==0&&ei!==0?ei&-ei:Pc.transition!==null?(Jc===0&&(Jc=Gl()),Jc):(x=br,x!==0?x:tt())}function sa(x,b,M,B){if(50<li)throw li=0,Dh=null,Error(s(185));Fi(x,M,B),((fr&2)===0||x!==cn)&&(x===cn&&((fr&2)===0&&(mn|=M),Tn===4&&El(x,ei)),oa(x,B),M===1&&fr===0&&(b.mode&1)===0&&(rn(),No&&yi()))}function oa(x,b){var M=x.callbackNode;Ec(x,b);var B=Rs(x,x===cn?ei:0);if(B===0)M!==null&&$r(M),x.callbackNode=null,x.callbackPriority=0;else if(b=B&-B,x.callbackPriority!==b){if(M!=null&&$r(M),b===1)x.tag===0?Cr(km.bind(null,x)):Iu(km.bind(null,x)),dt?_t(function(){(fr&6)===0&&yi()}):Qn(Vl,yi),M=null;else{switch(sr(B)){case 1:M=Vl;break;case 4:M=Os;break;case 16:M=Hl;break;case 536870912:M=Ou;break;default:M=Hl}M=Mm(M,Jf.bind(null,x))}x.callbackPriority=b,x.callbackNode=M}}function Jf(x,b){if(Qc=-1,Jc=0,(fr&6)!==0)throw Error(s(327));var M=x.callbackNode;if(Tl()&&x.callbackNode!==M)return null;var B=Rs(x,x===cn?ei:0);if(B===0)return null;if((B&30)!==0||(B&x.expiredLanes)!==0||b)b=Qu(x,B);else{b=B;var $=fr;fr|=2;var ee=Cm();(cn!==x||ei!==b)&&(La=null,rn(),hu(x,b));do try{Em();break}catch(Te){ed(x,Te)}while(!0);bh(),Rh.current=ee,fr=$,En!==null?b=0:(cn=null,ei=0,b=Tn)}if(b!==0){if(b===2&&($=sl(x),$!==0&&(B=$,b=ep(x,$))),b===1)throw M=Zc,hu(x,0),El(x,B),oa(x,jn()),M;if(b===6)El(x,B);else{if($=x.current.alternate,(B&30)===0&&!b0($)&&(b=Qu(x,B),b===2&&(ee=sl(x),ee!==0&&(B=ee,b=ep(x,ee))),b===1))throw M=Zc,hu(x,0),El(x,B),oa(x,jn()),M;switch(x.finishedWork=$,x.finishedLanes=B,b){case 0:case 1:throw Error(s(345));case 2:fu(x,aa,La);break;case 3:if(El(x,B),(B&130023424)===B&&(b=Xc+500-jn(),10<b)){if(Rs(x,0)!==0)break;if($=x.suspendedLanes,($&B)!==B){xn(),x.pingedLanes|=x.suspendedLanes&$;break}x.timeoutHandle=ae(fu.bind(null,x,aa,La),b);break}fu(x,aa,La);break;case 4:if(El(x,B),(B&4194240)===B)break;for(b=x.eventTimes,$=-1;0<B;){var me=31-er(B);ee=1<<me,me=b[me],me>$&&($=me),B&=~ee}if(B=$,B=jn()-B,B=(120>B?120:480>B?480:1080>B?1080:1920>B?1920:3e3>B?3e3:4320>B?4320:1960*Xf(B/1960))-B,10<B){x.timeoutHandle=ae(fu.bind(null,x,aa,La),B);break}fu(x,aa,La);break;case 5:fu(x,aa,La);break;default:throw Error(s(329))}}}return oa(x,jn()),x.callbackNode===M?Jf.bind(null,x):null}function ep(x,b){var M=Xu;return x.current.memoizedState.isDehydrated&&(hu(x,b).flags|=256),x=Qu(x,b),x!==2&&(b=aa,aa=M,b!==null&&tp(b)),x}function tp(x){aa===null?aa=x:aa.push.apply(aa,x)}function b0(x){for(var b=x;;){if(b.flags&16384){var M=b.updateQueue;if(M!==null&&(M=M.stores,M!==null))for(var B=0;B<M.length;B++){var $=M[B],ee=$.getSnapshot;$=$.value;try{if(!fs(ee(),$))return!1}catch{return!1}}}if(M=b.child,b.subtreeFlags&16384&&M!==null)M.return=b,b=M;else{if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function El(x,b){for(b&=~Yc,b&=~mn,x.suspendedLanes|=b,x.pingedLanes&=~b,x=x.expirationTimes;0<b;){var M=31-er(b),B=1<<M;x[M]=-1,b&=~B}}function km(x){if((fr&6)!==0)throw Error(s(327));Tl();var b=Rs(x,0);if((b&1)===0)return oa(x,jn()),null;var M=Qu(x,b);if(x.tag!==0&&M===2){var B=sl(x);B!==0&&(b=B,M=ep(x,B))}if(M===1)throw M=Zc,hu(x,0),El(x,b),oa(x,jn()),M;if(M===6)throw Error(s(345));return x.finishedWork=x.current.alternate,x.finishedLanes=b,fu(x,aa,La),oa(x,jn()),null}function _m(x){Gs!==null&&Gs.tag===0&&(fr&6)===0&&Tl();var b=fr;fr|=1;var M=Hn.transition,B=br;try{if(Hn.transition=null,br=1,x)return x()}finally{br=B,Hn.transition=M,fr=b,(fr&6)===0&&yi()}}function rp(){Si=cu.current,pt(cu)}function hu(x,b){x.finishedWork=null,x.finishedLanes=0;var M=x.timeoutHandle;if(M!==ye&&(x.timeoutHandle=ye,pe(M)),En!==null)for(M=En.return;M!==null;){var B=M;switch(ju(B),B.tag){case 1:B=B.type.childContextTypes,B!=null&&Ir();break;case 3:Fs(),pt(Pr),pt(Nr),Oc();break;case 5:Jl(B);break;case 4:Fs();break;case 13:pt(Hr);break;case 19:pt(Hr);break;case 10:js(B.type._context);break;case 22:case 23:rp()}M=M.return}if(cn=x,En=x=pu(x.current,null),ei=Si=b,Tn=0,Zc=null,Yc=mn=Cl=0,aa=Xu=null,Ca!==null){for(b=0;b<Ca.length;b++)if(M=Ca[b],B=M.interleaved,B!==null){M.interleaved=null;var $=B.next,ee=M.pending;if(ee!==null){var me=ee.next;ee.next=$,B.next=me}M.pending=B}Ca=null}return x}function ed(x,b){do{var M=En;try{if(bh(),ta.current=Je,eu){for(var B=ln.memoizedState;B!==null;){var $=B.queue;$!==null&&($.pending=null),B=B.next}eu=!1}if(Mo=0,Un=zn=ln=null,ra=!1,Ao=0,Kc.current=null,M===null||M.return===null){Tn=1,Zc=b,En=null;break}e:{var ee=x,me=M.return,Te=M,Ue=b;if(b=ei,Te.flags|=32768,Ue!==null&&typeof Ue=="object"&&typeof Ue.then=="function"){var gt=Ue,It=Te,ur=It.tag;if((It.mode&1)===0&&(ur===0||ur===11||ur===15)){var Mt=It.alternate;Mt?(It.updateQueue=Mt.updateQueue,It.memoizedState=Mt.memoizedState,It.lanes=Mt.lanes):(It.updateQueue=null,It.memoizedState=null)}var gn=zf(me);if(gn!==null){gn.flags&=-257,Do(gn,me,Te,ee,b),gn.mode&1&&Bf(ee,gt,b),b=gn,Ue=gt;var Xr=b.updateQueue;if(Xr===null){var Ra=new Set;Ra.add(Ue),b.updateQueue=Ra}else Xr.add(Ue);break e}else{if((b&1)===0){Bf(ee,gt,b),td();break e}Ue=Error(s(426))}}else if(tn&&Te.mode&1){var Go=zf(me);if(Go!==null){(Go.flags&65536)===0&&(Go.flags|=256),Do(Go,me,Te,ee,b),Nc(xl(Ue,Te));break e}}ee=Ue=xl(Ue,Te),Tn!==4&&(Tn=2),Xu===null?Xu=[ee]:Xu.push(ee),ee=me;do{switch(ee.tag){case 3:ee.flags|=65536,b&=-b,ee.lanes|=b;var je=zr(ee,Ue,b);Xl(ee,je);break e;case 1:Te=Ue;var Pe=ee.type,He=ee.stateNode;if((ee.flags&128)===0&&(typeof Pe.getDerivedStateFromError=="function"||He!==null&&typeof He.componentDidCatch=="function"&&(fo===null||!fo.has(He)))){ee.flags|=65536,b&=-b,ee.lanes|=b;var At=bl(ee,Te,b);Xl(ee,At);break e}}ee=ee.return}while(ee!==null)}Nm(M)}catch($t){b=$t,En===M&&M!==null&&(En=M=M.return);continue}break}while(!0)}function Cm(){var x=Rh.current;return Rh.current=Je,x===null?Je:x}function td(){(Tn===0||Tn===3||Tn===2)&&(Tn=4),cn===null||(Cl&268435455)===0&&(mn&268435455)===0||El(cn,ei)}function Qu(x,b){var M=fr;fr|=2;var B=Cm();(cn!==x||ei!==b)&&(La=null,hu(x,b));do try{w0();break}catch($){ed(x,$)}while(!0);if(bh(),fr=M,Rh.current=B,En!==null)throw Error(s(261));return cn=null,ei=0,Tn}function w0(){for(;En!==null;)Tm(En)}function Em(){for(;En!==null&&!gh();)Tm(En)}function Tm(x){var b=E0(x.alternate,x,Si);x.memoizedProps=x.pendingProps,b===null?Nm(x):En=b,Kc.current=null}function Nm(x){var b=x;do{var M=b.alternate;if(x=b.return,(b.flags&32768)===0){if(M=$u(M,b,Si),M!==null){En=M;return}}else{if(M=y0(M,b),M!==null){M.flags&=32767,En=M;return}if(x!==null)x.flags|=32768,x.subtreeFlags=0,x.deletions=null;else{Tn=6,En=null;return}}if(b=b.sibling,b!==null){En=b;return}En=b=x}while(b!==null);Tn===0&&(Tn=5)}function fu(x,b,M){var B=br,$=Hn.transition;try{Hn.transition=null,br=1,S0(x,b,M,B)}finally{Hn.transition=$,br=B}return null}function S0(x,b,M,B){do Tl();while(Gs!==null);if((fr&6)!==0)throw Error(s(327));M=x.finishedWork;var $=x.finishedLanes;if(M===null)return null;if(x.finishedWork=null,x.finishedLanes=0,M===x.current)throw Error(s(177));x.callbackNode=null,x.callbackPriority=0;var ee=M.lanes|M.childLanes;if(so(x,ee),x===cn&&(En=cn=null,ei=0),(M.subtreeFlags&2064)===0&&(M.flags&2064)===0||du||(du=!0,Mm(Hl,function(){return Tl(),null})),ee=(M.flags&15990)!==0,(M.subtreeFlags&15990)!==0||ee){ee=Hn.transition,Hn.transition=null;var me=br;br=1;var Te=fr;fr|=4,Kc.current=null,x0(x,M),Mh(M,x),te(x.containerInfo),x.current=M,qc(M),ol(),fr=Te,br=me,Hn.transition=ee}else x.current=M;if(du&&(du=!1,Gs=x,Qf=$),ee=x.pendingLanes,ee===0&&(fo=null),ll(M.stateNode),oa(x,jn()),b!==null)for(B=x.onRecoverableError,M=0;M<b.length;M++)$=b[M],B($.value,{componentStack:$.stack,digest:$.digest});if(Wn)throw Wn=!1,x=oi,oi=null,x;return(Qf&1)!==0&&x.tag!==0&&Tl(),ee=x.pendingLanes,(ee&1)!==0?x===Dh?li++:(li=0,Dh=x):li=0,yi(),null}function Tl(){if(Gs!==null){var x=sr(Qf),b=Hn.transition,M=br;try{if(Hn.transition=null,br=16>x?16:x,Gs===null)var B=!1;else{if(x=Gs,Gs=null,Qf=0,(fr&6)!==0)throw Error(s(331));var $=fr;for(fr|=4,St=x.current;St!==null;){var ee=St,me=ee.child;if((St.flags&16)!==0){var Te=ee.deletions;if(Te!==null){for(var Ue=0;Ue<Te.length;Ue++){var gt=Te[Ue];for(St=gt;St!==null;){var It=St;switch(It.tag){case 0:case 11:case 15:Ku(8,It,ee)}var ur=It.child;if(ur!==null)ur.return=It,St=ur;else for(;St!==null;){It=St;var Mt=It.sibling,gn=It.return;if(Nh(It),It===gt){St=null;break}if(Mt!==null){Mt.return=gn,St=Mt;break}St=gn}}}var Xr=ee.alternate;if(Xr!==null){var Ra=Xr.child;if(Ra!==null){Xr.child=null;do{var Go=Ra.sibling;Ra.sibling=null,Ra=Go}while(Ra!==null)}}St=ee}}if((ee.subtreeFlags&2064)!==0&&me!==null)me.return=ee,St=me;else e:for(;St!==null;){if(ee=St,(ee.flags&2048)!==0)switch(ee.tag){case 0:case 11:case 15:Ku(9,ee,ee.return)}var je=ee.sibling;if(je!==null){je.return=ee.return,St=je;break e}St=ee.return}}var Pe=x.current;for(St=Pe;St!==null;){me=St;var He=me.child;if((me.subtreeFlags&2064)!==0&&He!==null)He.return=me,St=He;else e:for(me=Pe;St!==null;){if(Te=St,(Te.flags&2048)!==0)try{switch(Te.tag){case 0:case 11:case 15:Wc(9,Te)}}catch($t){bn(Te,Te.return,$t)}if(Te===me){St=null;break e}var At=Te.sibling;if(At!==null){At.return=Te.return,St=At;break e}St=Te.return}}if(fr=$,yi(),Fn&&typeof Fn.onPostCommitFiberRoot=="function")try{Fn.onPostCommitFiberRoot(fn,x)}catch{}B=!0}return B}finally{br=M,Hn.transition=b}}return!1}function Pm(x,b,M){b=xl(M,b),b=zr(x,b,1),x=lo(x,b,1),b=xn(),x!==null&&(Fi(x,1,b),oa(x,b))}function bn(x,b,M){if(x.tag===3)Pm(x,x,M);else for(;b!==null;){if(b.tag===3){Pm(b,x,M);break}else if(b.tag===1){var B=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof B.componentDidCatch=="function"&&(fo===null||!fo.has(B))){x=xl(M,x),x=bl(b,x,1),b=lo(b,x,1),x=xn(),b!==null&&(Fi(b,1,x),oa(b,x));break}}b=b.return}}function k0(x,b,M){var B=x.pingCache;B!==null&&B.delete(b),b=xn(),x.pingedLanes|=x.suspendedLanes&M,cn===x&&(ei&M)===M&&(Tn===4||Tn===3&&(ei&130023424)===ei&&500>jn()-Xc?hu(x,0):Yc|=M),oa(x,b)}function _0(x,b){b===0&&((x.mode&1)===0?b=1:(b=ao,ao<<=1,(ao&130023424)===0&&(ao=4194304)));var M=xn();x=Za(x,b),x!==null&&(Fi(x,b,M),oa(x,M))}function C0(x){var b=x.memoizedState,M=0;b!==null&&(M=b.retryLane),_0(x,M)}function ob(x,b){var M=0;switch(x.tag){case 13:var B=x.stateNode,$=x.memoizedState;$!==null&&(M=$.retryLane);break;case 19:B=x.stateNode;break;default:throw Error(s(314))}B!==null&&B.delete(b),_0(x,M)}var E0;E0=function(x,b,M){if(x!==null)if(x.memoizedProps!==b.pendingProps||Pr.current)Vn=!0;else{if((x.lanes&M)===0&&(b.flags&128)===0)return Vn=!1,su(x,b,M);Vn=(x.flags&131072)!==0}else Vn=!1,tn&&(b.flags&1048576)!==0&&Of(b,ul,b.index);switch(b.lanes=0,b.tag){case 2:var B=b.type;Th(x,b),x=b.pendingProps;var $=vi(b,Nr.current);Ji(b,M),$=ru(null,b,B,x,$,M);var ee=Dc();return b.flags|=1,typeof $=="object"&&$!==null&&typeof $.render=="function"&&$.$$typeof===void 0?(b.tag=1,b.memoizedState=null,b.updateQueue=null,zt(B)?(ee=!0,tr(b)):ee=!1,b.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,wh(b),$.updater=Ai,b.stateNode=$,$._reactInternals=b,zs(b,B,x,M),b=na(null,b,B,!0,ee,M)):(b.tag=0,tn&&ee&&Qi(b),si(null,b,$,M),b=b.child),b;case 16:B=b.elementType;e:{switch(Th(x,b),x=b.pendingProps,$=B._init,B=$(B._payload),b.type=B,$=b.tag=lb(B),x=Zr(B,x),$){case 0:b=Io(null,b,B,x,M);break e;case 1:b=Ui(null,b,B,x,M);break e;case 11:b=Uf(null,b,B,x,M);break e;case 14:b=Vu(null,b,B,Zr(B.type,x),M);break e}throw Error(s(306,B,""))}return b;case 0:return B=b.type,$=b.pendingProps,$=b.elementType===B?$:Zr(B,$),Io(x,b,B,$,M);case 1:return B=b.type,$=b.pendingProps,$=b.elementType===B?$:Zr(B,$),Ui(x,b,B,$,M);case 3:e:{if(au(b),x===null)throw Error(s(387));B=b.pendingProps,ee=b.memoizedState,$=ee.element,oo(x,b),Mi(b,B,null,M);var me=b.memoizedState;if(B=me.element,Se&&ee.isDehydrated)if(ee={element:B,isDehydrated:!1,cache:me.cache,pendingSuspenseBoundaries:me.pendingSuspenseBoundaries,transitions:me.transitions},b.updateQueue.baseState=ee,b.memoizedState=ee,b.flags&256){$=xl(Error(s(423)),b),b=Hu(x,b,B,M,$);break e}else if(B!==$){$=xl(Error(s(424)),b),b=Hu(x,b,B,M,$);break e}else for(Se&&(_n=ds(b.stateNode.containerInfo),ai=b,tn=!0,ka=null,$l=!1),M=Mc(b,null,B,M),b.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(Po(),B===$){b=kl(x,b,M);break e}si(x,b,B,M)}b=b.child}return b;case 5:return Bu(b),x===null&&vh(b),B=b.type,$=b.pendingProps,ee=x!==null?x.memoizedProps:null,me=$.children,se(B,$)?me=null:ee!==null&&se(B,ee)&&(b.flags|=32),un(x,b),si(x,b,me,M),b.child;case 6:return x===null&&vh(b),null;case 13:return xm(x,b,M);case 4:return Ql(b,b.stateNode.containerInfo),B=b.pendingProps,x===null?b.child=cl(b,null,B,M):si(x,b,B,M),b.child;case 11:return B=b.type,$=b.pendingProps,$=b.elementType===B?$:Zr(B,$),Uf(x,b,B,$,M);case 7:return si(x,b,b.pendingProps,M),b.child;case 8:return si(x,b,b.pendingProps.children,M),b.child;case 12:return si(x,b,b.pendingProps.children,M),b.child;case 10:e:{if(B=b.type._context,$=b.pendingProps,ee=b.memoizedProps,me=$.value,Ka(b,B,me),ee!==null)if(fs(ee.value,me)){if(ee.children===$.children&&!Pr.current){b=kl(x,b,M);break e}}else for(ee=b.child,ee!==null&&(ee.return=b);ee!==null;){var Te=ee.dependencies;if(Te!==null){me=ee.child;for(var Ue=Te.firstContext;Ue!==null;){if(Ue.context===B){if(ee.tag===1){Ue=Ya(-1,M&-M),Ue.tag=2;var gt=ee.updateQueue;if(gt!==null){gt=gt.shared;var It=gt.pending;It===null?Ue.next=Ue:(Ue.next=It.next,It.next=Ue),gt.pending=Ue}}ee.lanes|=M,Ue=ee.alternate,Ue!==null&&(Ue.lanes|=M),dl(ee.return,M,b),Te.lanes|=M;break}Ue=Ue.next}}else if(ee.tag===10)me=ee.type===b.type?null:ee.child;else if(ee.tag===18){if(me=ee.return,me===null)throw Error(s(341));me.lanes|=M,Te=me.alternate,Te!==null&&(Te.lanes|=M),dl(me,M,b),me=ee.sibling}else me=ee.child;if(me!==null)me.return=ee;else for(me=ee;me!==null;){if(me===b){me=null;break}if(ee=me.sibling,ee!==null){ee.return=me.return,me=ee;break}me=me.return}ee=me}si(x,b,$.children,M),b=b.child}return b;case 9:return $=b.type,B=b.pendingProps.children,Ji(b,M),$=_a($),B=B($),b.flags|=1,si(x,b,B,M),b.child;case 14:return B=b.type,$=Zr(B,b.pendingProps),$=Zr(B.type,$),Vu(x,b,B,$,M);case 15:return Sl(x,b,b.type,b.pendingProps,M);case 17:return B=b.type,$=b.pendingProps,$=b.elementType===B?$:Zr(B,$),Th(x,b),b.tag=1,zt(B)?(x=!0,tr(b)):x=!1,Ji(b,M),yl(b,B,$),zs(b,B,$,M),na(null,b,B,!0,x,M);case 19:return Vf(x,b,M);case 22:return pn(x,b,M)}throw Error(s(156,b.tag))};function Mm(x,b){return Qn(x,b)}function T0(x,b,M,B){this.tag=x,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=B,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ks(x,b,M,B){return new T0(x,b,M,B)}function rd(x){return x=x.prototype,!(!x||!x.isReactComponent)}function lb(x){if(typeof x=="function")return rd(x)?1:0;if(x!=null){if(x=x.$$typeof,x===S)return 11;if(x===_)return 14}return 2}function pu(x,b){var M=x.alternate;return M===null?(M=ks(x.tag,b,x.key,x.mode),M.elementType=x.elementType,M.type=x.type,M.stateNode=x.stateNode,M.alternate=x,x.alternate=M):(M.pendingProps=b,M.type=x.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=x.flags&14680064,M.childLanes=x.childLanes,M.lanes=x.lanes,M.child=x.child,M.memoizedProps=x.memoizedProps,M.memoizedState=x.memoizedState,M.updateQueue=x.updateQueue,b=x.dependencies,M.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},M.sibling=x.sibling,M.index=x.index,M.ref=x.ref,M}function np(x,b,M,B,$,ee){var me=2;if(B=x,typeof x=="function")rd(x)&&(me=1);else if(typeof x=="string")me=5;else e:switch(x){case c:return Gi(M.children,$,ee,b);case h:me=8,$|=8;break;case p:return x=ks(12,M,b,$|2),x.elementType=p,x.lanes=ee,x;case w:return x=ks(13,M,b,$),x.elementType=w,x.lanes=ee,x;case C:return x=ks(19,M,b,$),x.elementType=C,x.lanes=ee,x;case N:return nd(M,$,ee,b);default:if(typeof x=="object"&&x!==null)switch(x.$$typeof){case g:me=10;break e;case y:me=9;break e;case S:me=11;break e;case _:me=14;break e;case T:me=16,B=null;break e}throw Error(s(130,x==null?x:typeof x,""))}return b=ks(me,M,b,$),b.elementType=x,b.type=B,b.lanes=ee,b}function Gi(x,b,M,B){return x=ks(7,x,B,b),x.lanes=M,x}function nd(x,b,M,B){return x=ks(22,x,B,b),x.elementType=N,x.lanes=M,x.stateNode={isHidden:!1},x}function ad(x,b,M){return x=ks(6,x,null,b),x.lanes=M,x}function ip(x,b,M){return b=ks(4,x.children!==null?x.children:[],x.key,b),b.lanes=M,b.stateNode={containerInfo:x.containerInfo,pendingChildren:null,implementation:x.implementation},b}function N0(x,b,M,B,$){this.tag=b,this.containerInfo=x,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ye,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=To(0),this.expirationTimes=To(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=To(0),this.identifierPrefix=B,this.onRecoverableError=$,Se&&(this.mutableSourceEagerHydrationData=null)}function Am(x,b,M,B,$,ee,me,Te,Ue){return x=new N0(x,b,M,Te,Ue),b===1?(b=1,ee===!0&&(b|=8)):b=0,ee=ks(3,null,null,b),x.current=ee,ee.stateNode=x,ee.memoizedState={element:B,isDehydrated:M,cache:null,transitions:null,pendingSuspenseBoundaries:null},wh(ee),x}function ap(x){if(!x)return Dt;x=x._reactInternals;e:{if(F(x)!==x||x.tag!==1)throw Error(s(170));var b=x;do{switch(b.tag){case 3:b=b.stateNode.context;break e;case 1:if(zt(b.type)){b=b.stateNode.__reactInternalMemoizedMergedChildContext;break e}}b=b.return}while(b!==null);throw Error(s(171))}if(x.tag===1){var M=x.type;if(zt(M))return Jt(x,M,b)}return b}function Ju(x){var b=x._reactInternals;if(b===void 0)throw typeof x.render=="function"?Error(s(188)):(x=Object.keys(x).join(","),Error(s(268,x)));return x=q(b),x===null?null:x.stateNode}function sp(x,b){if(x=x.memoizedState,x!==null&&x.dehydrated!==null){var M=x.retryLane;x.retryLane=M!==0&&M<b?M:b}}function sd(x,b){sp(x,b),(x=x.alternate)&&sp(x,b)}function ub(x){return x=q(x),x===null?null:x.stateNode}function P0(){return null}return r.attemptContinuousHydration=function(x){if(x.tag===13){var b=Za(x,134217728);if(b!==null){var M=xn();sa(b,x,134217728,M)}sd(x,134217728)}},r.attemptDiscreteHydration=function(x){if(x.tag===13){var b=Za(x,1);if(b!==null){var M=xn();sa(b,x,1,M)}sd(x,1)}},r.attemptHydrationAtCurrentPriority=function(x){if(x.tag===13){var b=ki(x),M=Za(x,b);if(M!==null){var B=xn();sa(M,x,b,B)}sd(x,b)}},r.attemptSynchronousHydration=function(x){switch(x.tag){case 3:var b=x.stateNode;if(b.current.memoizedState.isDehydrated){var M=Eo(b.pendingLanes);M!==0&&($a(b,M|1),oa(b,jn()),(fr&6)===0&&(rn(),yi()))}break;case 13:_m(function(){var B=Za(x,1);if(B!==null){var $=xn();sa(B,x,1,$)}}),sd(x,1)}},r.batchedUpdates=function(x,b){var M=fr;fr|=1;try{return x(b)}finally{fr=M,fr===0&&(rn(),No&&yi())}},r.createComponentSelector=function(x){return{$$typeof:_l,value:x}},r.createContainer=function(x,b,M,B,$,ee,me){return Am(x,b,!1,null,M,B,$,ee,me)},r.createHasPseudoClassSelector=function(x){return{$$typeof:Aa,value:x}},r.createHydrationContainer=function(x,b,M,B,$,ee,me,Te,Ue){return x=Am(M,B,!0,x,$,ee,me,Te,Ue),x.context=ap(null),M=x.current,B=xn(),$=ki(M),ee=Ya(B,$),ee.callback=b??null,lo(M,ee,$),x.current.lanes=$,Fi(x,$,B),oa(x,B),x},r.createPortal=function(x,b,M){var B=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:B==null?null:""+B,children:x,containerInfo:b,implementation:M}},r.createRoleSelector=function(x){return{$$typeof:Fo,value:x}},r.createTestNameSelector=function(x){return{$$typeof:$c,value:x}},r.createTextSelector=function(x){return{$$typeof:Ah,value:x}},r.deferredUpdates=function(x){var b=br,M=Hn.transition;try{return Hn.transition=null,br=16,x()}finally{br=b,Hn.transition=M}},r.discreteUpdates=function(x,b,M,B,$){var ee=br,me=Hn.transition;try{return Hn.transition=null,br=1,x(b,M,B,$)}finally{br=ee,Hn.transition=me,fr===0&&rn()}},r.findAllNodes=Uo,r.findBoundingRects=function(x,b){if(!Xe)throw Error(s(363));b=Uo(x,b),x=[];for(var M=0;M<b.length;M++)x.push(ct(b[M]));for(b=x.length-1;0<b;b--){M=x[b];for(var B=M.x,$=B+M.width,ee=M.y,me=ee+M.height,Te=b-1;0<=Te;Te--)if(b!==Te){var Ue=x[Te],gt=Ue.x,It=gt+Ue.width,ur=Ue.y,Mt=ur+Ue.height;if(B>=gt&&ee>=ur&&$<=It&&me<=Mt){x.splice(b,1);break}else if(B!==gt||M.width!==Ue.width||Mt<ee||ur>me){if(!(ee!==ur||M.height!==Ue.height||It<B||gt>$)){gt>B&&(Ue.width+=gt-B,Ue.x=B),It<$&&(Ue.width=$-gt),x.splice(b,1);break}}else{ur>ee&&(Ue.height+=ur-ee,Ue.y=ee),Mt<me&&(Ue.height=me-ur),x.splice(b,1);break}}}return x},r.findHostInstance=Ju,r.findHostInstanceWithNoPortals=function(x){return x=V(x),x=x!==null?U(x):null,x===null?null:x.stateNode},r.findHostInstanceWithWarning=function(x){return Ju(x)},r.flushControlled=function(x){var b=fr;fr|=1;var M=Hn.transition,B=br;try{Hn.transition=null,br=1,x()}finally{br=B,Hn.transition=M,fr=b,fr===0&&(rn(),yi())}},r.flushPassiveEffects=Tl,r.flushSync=_m,r.focusWithin=function(x,b){if(!Xe)throw Error(s(363));for(x=Bo(x),b=zo(x,b),b=Array.from(b),x=0;x<b.length;){var M=b[x++];if(!lt(M)){if(M.tag===5&&jt(M.stateNode))return!0;for(M=M.child;M!==null;)b.push(M),M=M.sibling}}return!1},r.getCurrentUpdatePriority=function(){return br},r.getFindAllNodesFailureDescription=function(x,b){if(!Xe)throw Error(s(363));var M=0,B=[];x=[Bo(x),0];for(var $=0;$<x.length;){var ee=x[$++],me=x[$++],Te=b[me];if((ee.tag!==5||!lt(ee))&&(Lh(ee,Te)&&(B.push(Yf(Te)),me++,me>M&&(M=me)),me<b.length))for(ee=ee.child;ee!==null;)x.push(ee,me),ee=ee.sibling}if(M<b.length){for(x=[];M<b.length;M++)x.push(Yf(b[M]));return`findAllNodes was able to match part of the selector:
  `+(B.join(" > ")+`

No matching component was found for:
  `)+x.join(" > ")}return null},r.getPublicRootInstance=function(x){return x=x.current,x.child?x.child.tag===5?Z(x.child.stateNode):x.child.stateNode:null},r.injectIntoDevTools=function(x){if(x={bundleType:x.bundleType,version:x.version,rendererPackageName:x.rendererPackageName,rendererConfig:x.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:ub,findFiberByHostInstance:x.findFiberByHostInstance||P0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")x=!1;else{var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)x=!0;else{try{fn=b.inject(x),Fn=b}catch{}x=!!b.checkDCE}}return x},r.isAlreadyRendering=function(){return!1},r.observeVisibleRects=function(x,b,M,B){if(!Xe)throw Error(s(363));x=Uo(x,b);var $=Ne(x,M,B).disconnect;return{disconnect:function(){$()}}},r.registerMutableSourceForHydration=function(x,b){var M=b._getVersion;M=M(b._source),x.mutableSourceEagerHydrationData==null?x.mutableSourceEagerHydrationData=[b,M]:x.mutableSourceEagerHydrationData.push(b,M)},r.runWithPriority=function(x,b){var M=br;try{return br=x,b()}finally{br=M}},r.shouldError=function(){return null},r.shouldSuspend=function(){return!1},r.updateContainer=function(x,b,M,B){var $=b.current,ee=xn(),me=ki($);return M=ap(M),b.context===null?b.context=M:b.pendingContext=M,b=Ya(ee,me),b.payload={element:x},B=B===void 0?null:B,B!==null&&(b.callback=B),x=lo($,b,me),x!==null&&(sa(x,$,me,ee),fl(x,$,me)),me},r}),R2}var c4;function aV(){return c4||(c4=1,L2.exports=iV()),L2.exports}var sV=aV();const oV=Tf(sV);var O2={exports:{}},bd={};var d4;function lV(){return d4||(d4=1,bd.ConcurrentRoot=1,bd.ContinuousEventPriority=4,bd.DefaultEventPriority=16,bd.DiscreteEventPriority=1,bd.IdleEventPriority=536870912,bd.LegacyRoot=0),bd}var h4;function uV(){return h4||(h4=1,O2.exports=lV()),O2.exports}var CL=uV(),cV=Tr();const f4={children:!0,ref:!0,key:!0,style:!0,forwardedRef:!0,unstable_applyCache:!0,unstable_applyDrawHitFromCache:!0};let p4=!1,m4=!1;const C_=".react-konva-event",dV=`ReactKonva: You have a Konva node with draggable = true and position defined but no onDragMove or onDragEnd events are handled.
Position of a node will be changed during drag&drop, so you should update state of the react app as well.
Consider to add onDragMove or onDragEnd events.
For more info see: https://github.com/konvajs/react-konva/issues/256
`,hV=`ReactKonva: You are using "zIndex" attribute for a Konva node.
react-konva may get confused with ordering. Just define correct order of elements in your render function of a component.
For more info see: https://github.com/konvajs/react-konva/issues/194
`,fV={};function z1(t,e,r=fV){if(!p4&&"zIndex"in e&&(console.warn(hV),p4=!0),!m4&&e.draggable){var n=e.x!==void 0||e.y!==void 0,i=e.onDragEnd||e.onDragMove;n&&!i&&(console.warn(dV),m4=!0)}for(var a in r)if(!f4[a]){var s=a.slice(0,2)==="on",o=r[a]!==e[a];if(s&&o){var l=a.substr(2).toLowerCase();l.substr(0,7)==="content"&&(l="content"+l.substr(7,1).toUpperCase()+l.substr(8)),t.off(l,r[a])}var u=!e.hasOwnProperty(a);u&&t.setAttr(a,void 0)}var c=e._useStrictMode,h={},p=!1;const g={};for(var a in e)if(!f4[a]){var s=a.slice(0,2)==="on",y=r[a]!==e[a];if(s&&y){var l=a.substr(2).toLowerCase();l.substr(0,7)==="content"&&(l="content"+l.substr(7,1).toUpperCase()+l.substr(8)),e[a]&&(g[l]=e[a])}!s&&(e[a]!==r[a]||c&&e[a]!==t.getAttr(a))&&(p=!0,h[a]=e[a])}p&&(t.setAttrs(h),ch(t));for(var l in g)t.on(l+C_,g[l])}function ch(t){if(!cV.Konva.autoDrawEnabled){var e=t.getLayer()||t.getStage();e&&e.batchDraw()}}var D2=Vk();const EL={},pV={};Nv.Node.prototype._applyProps=z1;function mV(t,e){if(typeof e=="string"){console.error(`Do not use plain text as child of Konva.Node. You are using text: ${e}`);return}t.add(e),ch(t)}function gV(t,e,r){let n=Nv[t];n||(console.error(`Konva has no node with the type ${t}. Group will be used instead. If you use minimal version of react-konva, just import required nodes into Konva: "import "konva/lib/shapes/${t}"  If you want to render DOM elements as part of canvas tree take a look into this demo: https://konvajs.github.io/docs/react/DOM_Portal.html`),n=Nv.Group);const i={},a={};for(var s in e){var o=s.slice(0,2)==="on";o?a[s]=e[s]:i[s]=e[s]}const l=new n(i);return z1(l,a),l}function vV(t,e,r){console.error(`Text components are not supported for now in ReactKonva. Your text is: "${t}"`)}function yV(t,e,r){return!1}function xV(t){return t}function bV(){return null}function wV(){return null}function SV(t,e,r,n){return pV}function kV(){}function _V(t){}function CV(t,e){return!1}function EV(){return EL}function TV(){return EL}const NV=setTimeout,PV=clearTimeout,MV=-1;function AV(t,e){return!1}const LV=!1,RV=!0,OV=!0;function DV(t,e){e.parent===t?e.moveToTop():t.add(e),ch(t)}function IV(t,e){e.parent===t?e.moveToTop():t.add(e),ch(t)}function TL(t,e,r){e._remove(),t.add(e),e.setZIndex(r.getZIndex()),ch(t)}function jV(t,e,r){TL(t,e,r)}function FV(t,e){e.destroy(),e.off(C_),ch(t)}function BV(t,e){e.destroy(),e.off(C_),ch(t)}function zV(t,e,r){console.error(`Text components are not yet supported in ReactKonva. You text is: "${r}"`)}function UV(t,e,r){}function GV(t,e,r,n,i){z1(t,i,n)}function VV(t){t.hide(),ch(t)}function HV(t){}function WV(t,e){(e.visible==null||e.visible)&&t.show()}function qV(t,e){}function $V(t){}function KV(){}const ZV=()=>CL.DefaultEventPriority,YV=Object.freeze(Object.defineProperty({__proto__:null,appendChild:DV,appendChildToContainer:IV,appendInitialChild:mV,cancelTimeout:PV,clearContainer:$V,commitMount:UV,commitTextUpdate:zV,commitUpdate:GV,createInstance:gV,createTextInstance:vV,detachDeletedInstance:KV,finalizeInitialChildren:yV,getChildHostContext:TV,getCurrentEventPriority:ZV,getPublicInstance:xV,getRootHostContext:EV,hideInstance:VV,hideTextInstance:HV,idlePriority:D2.unstable_IdlePriority,insertBefore:TL,insertInContainerBefore:jV,isPrimaryRenderer:LV,noTimeout:MV,now:D2.unstable_now,prepareForCommit:bV,preparePortalMount:wV,prepareUpdate:SV,removeChild:FV,removeChildFromContainer:BV,resetAfterCommit:kV,resetTextContent:_V,run:D2.unstable_runWithPriority,scheduleTimeout:NV,shouldDeprioritizeSubtree:CV,shouldSetTextContent:AV,supportsMutation:OV,unhideInstance:WV,unhideTextInstance:qV,warnsIfNotActing:RV},Symbol.toStringTag,{value:"Module"}));var XV=Object.defineProperty,QV=Object.defineProperties,JV=Object.getOwnPropertyDescriptors,g4=Object.getOwnPropertySymbols,eH=Object.prototype.hasOwnProperty,tH=Object.prototype.propertyIsEnumerable,v4=(t,e,r)=>e in t?XV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y4=(t,e)=>{for(var r in e||(e={}))eH.call(e,r)&&v4(t,r,e[r]);if(g4)for(var r of g4(e))tH.call(e,r)&&v4(t,r,e[r]);return t},rH=(t,e)=>QV(t,JV(e)),x4,b4;typeof window<"u"&&((x4=window.document)!=null&&x4.createElement||((b4=window.navigator)==null?void 0:b4.product)==="ReactNative")?ie.useLayoutEffect:ie.useEffect;function NL(t,e,r){if(!t)return;if(r(t)===!0)return t;let n=t.child;for(;n;){const i=NL(n,e,r);if(i)return i;n=n.sibling}}function PL(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const w4=console.error;console.error=function(){const t=[...arguments].join("");if(t?.startsWith("Warning:")&&t.includes("useContext")){console.error=w4;return}return w4.apply(this,arguments)};const E_=PL(ie.createContext(null));class ML extends ie.Component{render(){return ie.createElement(E_.Provider,{value:this._reactInternals},this.props.children)}}function nH(){const t=ie.useContext(E_);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=ie.useId();return ie.useMemo(()=>{for(const n of[t,t?.alternate]){if(!n)continue;const i=NL(n,!1,a=>{let s=a.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(i)return i}},[t,e])}function iH(){const t=nH(),[e]=ie.useState(()=>new Map);e.clear();let r=t;for(;r;){if(r.type&&typeof r.type=="object"){const i=r.type._context===void 0&&r.type.Provider===r.type?r.type:r.type._context;i&&i!==E_&&!e.has(i)&&e.set(i,ie.useContext(PL(i)))}r=r.return}return e}function aH(){const t=iH();return ie.useMemo(()=>Array.from(t.keys()).reduce((e,r)=>n=>ie.createElement(e,null,ie.createElement(r.Provider,rH(y4({},n),{value:t.get(r)}))),e=>ie.createElement(ML,y4({},e))),[t])}function sH(t){const e=ir.useRef({});return ir.useLayoutEffect(()=>{e.current=t}),ir.useLayoutEffect(()=>()=>{e.current={}},[]),e.current}const oH=t=>{const e=ir.useRef(),r=ir.useRef(),n=ir.useRef(),i=sH(t),a=aH(),s=o=>{const{forwardedRef:l}=t;l&&(typeof l=="function"?l(o):l.current=o)};return ir.useLayoutEffect(()=>(r.current=new Nv.Stage({width:t.width,height:t.height,container:e.current}),s(r.current),n.current=$g.createContainer(r.current,CL.LegacyRoot,!1,null),$g.updateContainer(ir.createElement(a,{},t.children),n.current),()=>{Nv.isBrowser&&(s(null),$g.updateContainer(null,n.current,null),r.current.destroy())}),[]),ir.useLayoutEffect(()=>{s(r.current),z1(r.current,t,i),$g.updateContainer(ir.createElement(a,{},t.children),n.current,null)}),ir.createElement("div",{ref:e,id:t.id,accessKey:t.accessKey,className:t.className,role:t.role,style:t.style,tabIndex:t.tabIndex,title:t.title})},vx="Layer",yx="Rect",lH="Circle",AL="Line",uH="Image",cH="Text",dH="Path",LL="Transformer",$g=oV(YV);$g.injectIntoDevTools({findHostInstanceByFiber:()=>null,bundleType:0,version:ir.version,rendererPackageName:"react-konva"});const RL=ir.forwardRef((t,e)=>ir.createElement(ML,{},ir.createElement(oH,{...t,forwardedRef:e}))),hH=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,initialValue:a="",placeholder:s="",confirmText:o="Confirmar",cancelText:l="Cancelar"})=>{const[u,c]=ie.useState(a),h=ie.useRef(null);if(ie.useEffect(()=>{c(a)},[a,t]),ie.useEffect(()=>{t&&h.current&&setTimeout(()=>h.current.focus(),50)},[t]),!t)return null;const p=g=>{g.preventDefault(),r(u),e()};return eo.createPortal(m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-in fade-in duration-300",children:m.jsxs("div",{className:"bg-[#0f0f13] border border-white/10 rounded-2xl p-6 shadow-2xl shadow-black/50 w-full max-w-md space-y-5 animate-in zoom-in-95 slide-in-from-bottom-2 duration-300 relative overflow-hidden ring-1 ring-white/5",onClick:g=>g.stopPropagation(),children:[m.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary to-transparent opacity-70"}),m.jsx("div",{className:"absolute -top-10 -right-10 size-40 bg-primary/5 rounded-full blur-3xl pointer-events-none"}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-bold text-white tracking-tight",children:n}),i&&m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed mt-2",children:i})]}),m.jsxs("form",{onSubmit:p,className:"space-y-6",children:[m.jsx("input",{ref:h,type:"text",value:u,onChange:g=>c(g.target.value),placeholder:s,className:"w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3.5 text-white placeholder-slate-600 focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all font-sans text-sm shadow-inner"}),m.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[m.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-sm text-slate-400 hover:text-white transition-colors",children:l}),m.jsx(Dn,{type:"submit",variant:"primary",disabled:!u.trim(),children:o})]})]})]})}),document.body)},fH=({settings:t,onUpdate:e})=>{const{t:r}=Ps();if(!t)return null;const n=(i,a)=>{e({...t,[i]:a})};return m.jsxs("div",{className:"p-6 space-y-8 animate-in fade-in slide-in-from-right-4",children:[m.jsxs("div",{className:"flex items-center gap-3 text-slate-400 mb-2",children:[m.jsx("span",{className:"material-symbols-outlined",children:"tune"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest",children:r("map.settings")||"Settings"})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("label",{className:"text-sm font-bold text-white flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-slate-500",children:"grid_4x4"}),r("map.show_grid")||"Show Grid"]}),m.jsx("input",{type:"checkbox",checked:t.showGrid||!1,onChange:i=>n("showGrid",i.target.checked),className:"accent-primary size-5 rounded cursor-pointer"})]}),t.showGrid&&m.jsxs("div",{children:[m.jsxs("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:[r("map.grid_size")||"Grid Size"," (px)"]}),m.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:t.gridSize||50,onChange:i=>n("gridSize",parseInt(i.target.value)),className:"w-full accent-primary mb-2"}),m.jsxs("div",{className:"flex justify-between text-[10px] font-mono text-slate-500",children:[m.jsx("span",{children:"20px"}),m.jsxs("span",{className:"text-primary font-bold",children:[t.gridSize||50,"px"]}),m.jsx("span",{children:"200px"})]})]})]}),m.jsx("div",{className:"h-px bg-white/5 my-4"}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("h4",{className:"text-[10px] uppercase font-bold text-slate-500 tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"aspect_ratio"}),r("map.dimensions")||"Dimensions"]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-600 mb-1 block",children:"Width"}),m.jsx("input",{type:"number",value:t.width||800,onChange:i=>n("width",parseInt(i.target.value)),className:"w-full bg-black/30 border border-white/10 rounded-lg p-2 text-white font-mono text-xs focus:border-primary outline-none"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-600 mb-1 block",children:"Height"}),m.jsx("input",{type:"number",value:t.height||600,onChange:i=>n("height",parseInt(i.target.value)),className:"w-full bg-black/30 border border-white/10 rounded-lg p-2 text-white font-mono text-xs focus:border-primary outline-none"})]})]})]}),m.jsx("div",{className:"h-px bg-white/5 my-4"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("h4",{className:"text-[10px] uppercase font-bold text-slate-500 tracking-widest mb-2 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"image"}),r("map.background")||"Background"]}),t.bgImage?m.jsxs("div",{className:"w-full h-32 rounded-xl border border-white/10 overflow-hidden relative group",children:[m.jsx("img",{src:t.bgImage,className:"w-full h-full object-cover opacity-50"}),m.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:m.jsxs("span",{className:"text-xs font-mono text-white/50",children:[t.width,"x",t.height]})})]}):m.jsx("div",{className:"p-4 rounded-xl border border-dashed border-white/10 text-center text-xs text-slate-500",children:"No background image"})]})]})},I2=({stepNumber:t,title:e,isOpen:r,onClick:n,children:i})=>m.jsxs("div",{className:`border border-white/10 rounded-2xl bg-[#13141f] overflow-hidden transition-all duration-300 ${r?"ring-1 ring-primary/50":"opacity-80"}`,children:[m.jsxs("button",{onClick:n,className:"w-full flex items-center justify-between p-6 hover:bg-white/5 transition-colors",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center font-black text-sm ${r?"bg-primary text-white":"bg-white/10 text-slate-400"}`,children:t}),m.jsx("h3",{className:`text-lg font-bold ${r?"text-white":"text-slate-400"}`,children:e})]}),m.jsx("span",{className:`material-symbols-outlined transition-transform duration-300 ${r?"rotate-180 text-primary":"text-slate-500"}`,children:"expand_more"})]}),r&&m.jsx("div",{className:"p-6 pt-0 border-t border-white/5 animate-in fade-in slide-in-from-top-2",children:i})]}),j2=({icon:t,title:e,desc:r,selected:n,onClick:i})=>m.jsxs("div",{onClick:i,className:`p-6 rounded-xl border cursor-pointer transition-all relative group h-full flex flex-col justify-between ${n?"bg-primary/20 border-primary shadow-[0_0_30px_rgba(var(--color-primary),0.3)]":"bg-[#0a0a0c] border-white/10 hover:border-white/30"}`,children:[m.jsxs("div",{className:"mb-4",children:[m.jsx("div",{className:`size-12 rounded-lg flex items-center justify-center mb-4 ${n?"bg-primary text-white":"bg-white/10 text-slate-400 group-hover:text-white group-hover:bg-white/20"}`,children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:t})}),m.jsx("h4",{className:"font-bold text-white mb-1",children:e}),m.jsx("p",{className:"text-xs text-slate-500 leading-relaxed",children:r})]}),n&&m.jsx("div",{className:"absolute top-4 right-4 size-3 bg-primary rounded-full shadow-glow"})]}),pH=({src:t,x:e,y:r,width:n,height:i,...a})=>{const[s,o]=ie.useState(null);return ie.useEffect(()=>{if(!t)return;const l=new window.Image;l.src=t,l.crossOrigin="Anonymous",l.onload=()=>{o(l)}},[t]),m.jsx(uH,{image:s,x:e,y:r,width:n,height:i,...a})},mH=({selectedId:t})=>{const e=ir.useRef();return ir.useEffect(()=>{if(t){const r=e.current.getStage().findOne("#"+t);r&&(e.current.nodes([r]),e.current.getLayer().batchDraw())}else e.current.nodes([])},[t]),m.jsx(LL,{ref:e})},ek=({mode:t})=>{const{username:e,projectName:r,folderId:n,entityId:i}=Va(),a=Ga(),s=Nf(),{setRightOpen:o,setRightPanelTab:l,setAvailableTemplates:u,mapSettings:c,setMapSettings:h}=bo(),[p,g]=ie.useState(t==="create"?"setup":"editor"),[y,S]=ie.useState(null);ie.useEffect(()=>{g(t==="create"?"setup":"editor")},[t]);const[w,C]=ie.useState(s.state?.folderId||null),[_,T]=ie.useState(1),[N,R]=ie.useState({name:"New Map",description:"",parentZone:null,type:"regional",sourceType:"blank",dims:{width:800,height:600},bgImage:null}),[I,j]=ie.useState(!1),[O,F]=ie.useState("brush"),[z,V]=ie.useState([]),[q,D]=ie.useState([]),[U,G]=ie.useState([]),[Z,K]=ie.useState(null),Q=ir.useRef(!1),[ne,te]=ie.useState({isOpen:!1,id:null,text:""}),X=ue=>{(ue.target===ue.target.getStage()||ue.target.name()==="bg-image")&&K(null)},re=ue=>{X(ue);const Se=ue.target.getStage().getPointerPosition();O!=="select"&&(Q.current=!0,O==="brush"||O==="eraser"?V([...z,{id:`line-${Date.now()}`,tool:O,points:[Se.x,Se.y],color:O==="eraser"?"#ffffff":"#df4b26",size:O==="eraser"?20:5}]):O==="rect"?D([...q,{id:`rect-${Date.now()}`,x:Se.x,y:Se.y,width:0,height:0,color:"#df4b26"}]):O==="text"&&(G([...U,{id:`text-${Date.now()}`,x:Se.x,y:Se.y,text:"Double click to edit",fontSize:20,color:"#ffffff"}]),Q.current=!1))},he=ue=>{if(!Q.current)return;const Se=ue.target.getStage().getPointerPosition();O==="brush"||O==="eraser"?V(Oe=>{const Ae=[...Oe],tt={...Ae[Ae.length-1]};return tt.points=tt.points.concat([Se.x,Se.y]),Ae[Ae.length-1]=tt,Ae}):O==="rect"&&D(Oe=>{const Ae=[...Oe],tt={...Ae[Ae.length-1]};return tt.width=Se.x-tt.x,tt.height=Se.y-tt.y,Ae[Ae.length-1]=tt,Ae})},oe=()=>{Q.current=!1};ie.useEffect(()=>{if(o(p==="editor"),p==="editor"){l&&l("CONTEXT");const xe={showGrid:!0,gridSize:50,width:N.dims.width,height:N.dims.height};h(xe)}const ue=setInterval(()=>{const xe=document.getElementById("global-right-panel-portal");xe&&(S(xe),clearInterval(ue))},100);return()=>{clearInterval(ue),l&&l("NOTEBOOKS")}},[p,l]);const se=ue=>{h(ue),R(xe=>({...xe,dims:{width:ue.width,height:ue.height},bgImage:ue.bgImage||xe.bgImage}))};ie.useEffect(()=>{t==="create"&&!w&&n&&(console.log("Resolving folder ID for slug:",n),Ke.get(`/world-bible/folders/${n}`).then(ue=>C(ue.id)).catch(ue=>console.error("Could not resolve folder ID",ue)))},[t,n,w]);const fe=ue=>{const xe=ue.target.files[0];if(xe){const Se=new FileReader;Se.onload=Oe=>{const Ae=new Image;Ae.onload=()=>{R(tt=>({...tt,bgImage:Oe.target.result,dims:{width:Ae.width,height:Ae.height},sourceType:"upload"}))},Ae.src=Oe.target.result},Se.readAsDataURL(xe)}},ae=ir.useRef(null),pe=async()=>{if(!w){alert("Folder context missing. Please start from the folder view again.");return}j(!0);try{let ue=N.bgImage;if(ae.current){const Oe=ae.current.findOne("Transformer");if(Oe&&Oe.nodes([]),ue=ae.current.toDataURL({pixelRatio:.5}),Oe&&Z){const Ae=ae.current.findOne("#"+Z);Ae&&Oe.nodes([Ae])}}const xe={nombre:N.name,tipoEspecial:"map",carpetaId:w,descripcion:N.description,attributes:{type:N.type,width:N.dims.width,height:N.dims.height,bgImage:N.bgImage,layers:{lines:z,rectangles:q,texts:U},snapshotUrl:ue},iconUrl:ue},Se=await Ke.post("/world-bible/entities",xe);window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:w}})),a(`/${e}/${r}/map-editor/edit/${Se.id}`,{replace:!0})}catch(ue){console.error(ue),alert("Error creating map. Check console.")}finally{j(!1)}},ye=ir.useRef(null);ie.useEffect(()=>{(!t||t==="edit")&&i&&Ke.get(`/world-bible/entities/${i}`).then(ue=>{C(ue.carpetaId),ye.current=ue.iconUrl,g("editor");let xe=ue.attributes||{},Se={};const Oe=xe.layers||xe.bgImage;if(!Oe&&ue.descripcion&&ue.descripcion.trim().startsWith("{"))try{Se=JSON.parse(ue.descripcion)}catch(rt){console.error("Error parsing legacy map data",rt)}const Ae=Oe?xe:Se;let tt=ue.descripcion;ue.descripcion&&ue.descripcion.trim().startsWith("{")&&(tt=Se.description||""),R({name:ue.nombre,description:tt||"",parentZone:null,type:Ae.type||"regional",sourceType:Ae.bgImage?"upload":"blank",dims:{width:Ae.width||800,height:Ae.height||600},bgImage:Ae.bgImage}),Ae.layers&&(V(Ae.layers.lines||[]),D(Ae.layers.rectangles||[]),G(Ae.layers.texts||[])),h({name:ue.nombre,description:tt||"",type:Ae.type||"regional",showGrid:!0,gridSize:50,width:Ae.width||800,height:Ae.height||600,bgImage:Ae.bgImage})}).catch(ue=>console.error("Error loading entity",ue))},[t,i]);const ve=async()=>{j(!0);try{let ue=N.bgImage;if(ae.current){K(null);const Se=ae.current.findOne("Transformer");Se&&Se.nodes([]),ue=ae.current.toDataURL({pixelRatio:.5})}const xe={id:i,nombre:N.name,tipoEspecial:"map",carpetaId:w,descripcion:N.description,attributes:{type:N.type,width:N.dims.width,height:N.dims.height,bgImage:N.bgImage,layers:{lines:z,rectangles:q,texts:U},snapshotUrl:ue},iconUrl:ye.current};await Ke.put(`/world-bible/entities/${i}`,xe),a(w?`/${e}/${r}/bible/folder/${w}`:`/${e}/${r}/bible`)}catch(ue){console.error("Save failed",ue),alert("Error saving map")}finally{j(!1)}};return p==="setup"?m.jsxs("div",{className:"flex-1 flex flex-col h-screen bg-[#060608] text-white",children:[m.jsxs("div",{className:"h-16 border-b border-white/5 flex items-center justify-between px-8 bg-[#0a0a0c]",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"p-2 bg-primary/20 rounded-lg text-primary",children:m.jsx("span",{className:"material-symbols-outlined",children:"add_circle"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-lg font-bold leading-tight",children:"Create New Map / Zone"}),m.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-bold tracking-wider",children:"Configure details for your new cartography entry"})]})]}),m.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-white/5 rounded-full text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-8",children:m.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[m.jsx(I2,{stepNumber:"1",title:"Identity & Hierarchy",isOpen:_===1,onClick:()=>T(1),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Map Name"}),m.jsx("input",{autoFocus:!0,value:N.name,onChange:ue=>R({...N,name:ue.target.value}),className:"w-full bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-white focus:border-primary outline-none transition-colors",placeholder:"e.g. The Sapphire Coast"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Parent Zone (Optional)"}),m.jsxs("div",{className:"w-full bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-slate-400 flex items-center justify-between cursor-pointer hover:border-white/20",children:[m.jsx("span",{children:"Current Folder (Default)"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"expand_more"})]}),m.jsx("p",{className:"text-[10px] text-slate-600 mt-2",children:"Selecting a parent makes this a sub-zone."})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Description"}),m.jsx("textarea",{value:N.description,onChange:ue=>R({...N,description:ue.target.value}),className:"w-full h-40 bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-white resize-none focus:border-primary outline-none transition-colors leading-relaxed",placeholder:"Brief description of geography, climate, or importance..."})]})]})}),m.jsx(I2,{stepNumber:"2",title:"Map Type",isOpen:_===2,onClick:()=>T(2),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[m.jsx(j2,{icon:"public",title:"World Map",desc:"Continents, oceans, global scale.",selected:N.type==="world",onClick:()=>R({...N,type:"world"})}),m.jsx(j2,{icon:"map",title:"Regional Map",desc:"Kingdoms, provinces, biomes.",selected:N.type==="regional",onClick:()=>R({...N,type:"regional"})}),m.jsx(j2,{icon:"location_city",title:"City / Local",desc:"Cities, dungeons, battlemaps.",selected:N.type==="local",onClick:()=>R({...N,type:"local"})})]})}),m.jsx(I2,{stepNumber:"3",title:"Canvas Source",isOpen:_===3,onClick:()=>T(3),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m.jsxs("div",{onClick:()=>document.getElementById("map-upload-input").click(),className:`relative p-8 rounded-xl border-2 border-dashed flex flex-col items-center justify-center text-center cursor-pointer transition-all group min-h-[200px] ${N.sourceType==="upload"?"border-primary bg-primary/5":"border-white/10 hover:border-white/30 bg-[#0a0a0c]"}`,children:[m.jsx("input",{id:"map-upload-input",type:"file",accept:"image/*",className:"hidden",onChange:fe}),N.bgImage?m.jsx("img",{src:N.bgImage,alt:"Preview",className:"absolute inset-0 w-full h-full object-cover rounded-xl opacity-50 group-hover:opacity-70"}):m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"size-16 bg-white/5 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-400",children:"cloud_upload"})}),m.jsx("h4",{className:"font-bold text-white",children:"Upload Image File"}),m.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Drag & drop or click to browse"}),m.jsx("p",{className:"text-[10px] text-slate-600 mt-1 uppercase font-bold",children:"JPG, PNG, WEBP  Max 20MB"})]}),N.sourceType==="upload"&&m.jsx("div",{className:"absolute top-4 right-4 size-3 bg-primary rounded-full shadow-glow z-10"})]}),m.jsxs("div",{onClick:()=>R({...N,sourceType:"blank",bgImage:null}),className:`p-8 rounded-xl border flex flex-col items-center justify-center text-center cursor-pointer transition-all min-h-[200px] ${N.sourceType==="blank"?"border-primary bg-primary/5":"border-white/10 hover:border-white/30 bg-[#0a0a0c]"}`,children:[m.jsx("div",{className:"size-16 bg-white/5 rounded-full flex items-center justify-center mb-4",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-400",children:"check_box_outline_blank"})}),m.jsx("h4",{className:"font-bold text-white",children:"Blank Canvas"}),m.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Start a new drawing from scratch"}),N.sourceType==="blank"&&m.jsxs("div",{className:"mt-6 flex items-center gap-2 bg-black/50 p-1 rounded-lg border border-white/10",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 px-2",children:"Size"}),m.jsx("span",{className:"text-xs font-mono text-white",children:"4096 px"}),m.jsx("span",{className:"text-xs text-slate-500",children:"x"}),m.jsx("span",{className:"text-xs font-mono text-white",children:"4096 px"})]})]})]})})]})}),m.jsxs("div",{className:"h-20 border-t border-white/5 bg-[#0a0a0c] flex items-center justify-between px-8 z-20",children:[m.jsx("button",{onClick:()=>a(-1),className:"text-sm font-bold text-slate-500 hover:text-white transition-colors",children:"Cancel"}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("span",{className:"text-xs text-slate-600 italic",children:"Changes saved locally"}),m.jsx(Dn,{variant:"primary",size:"lg",icon:"check",onClick:pe,disabled:!N.name||I,className:"bg-primary hover:bg-primary-light text-white shadow-lg shadow-primary/25 px-8",children:I?"Creating...":"Create Map"})]})]})]}):m.jsxs("div",{className:"flex flex-col h-screen w-full bg-[#0f0f13] text-white overflow-hidden",children:[y&&eo.createPortal(m.jsx(fH,{settings:c,onUpdate:se}),y),m.jsxs("header",{className:"h-14 border-b border-white/5 flex items-center justify-between px-4 bg-[#1a1a20] shrink-0",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-white/5 rounded-full",title:"Back to Collection",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("input",{value:N.name,onChange:ue=>R({...N,name:ue.target.value}),className:"bg-transparent font-bold text-sm outline-none focus:bg-white/5 rounded px-2 -ml-2"}),m.jsxs("span",{className:"text-[10px] text-text-muted px-2",children:[N.dims.width," x ",N.dims.height,"  ",c?.gridSize||50,"px Grid"]})]})]}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsx(Dn,{variant:"primary",size:"sm",icon:"save",onClick:ve,disabled:I,children:I?"Saving...":"Save Changes"})})]}),m.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[m.jsx("div",{className:"w-14 bg-[#1a1a20] border-r border-white/5 flex flex-col items-center py-4 gap-4 z-10",children:[{id:"select",icon:"near_me"},{id:"brush",icon:"brush"},{id:"eraser",icon:"ink_eraser"},{id:"rect",icon:"check_box_outline_blank"},{id:"text",icon:"title"}].map(ue=>m.jsx("button",{onClick:()=>F(ue.id),className:`p-2 rounded-lg transition-colors ${O===ue.id?"bg-primary text-white shadow-lg shadow-primary/30":"hover:bg-white/5 text-slate-400 hover:text-white"}`,children:m.jsx("span",{className:"material-symbols-outlined",children:ue.icon})},ue.id))}),m.jsx("div",{className:"flex-1 overflow-auto bg-[#0f0f13] relative flex items-center justify-center p-8 custom-scrollbar",children:m.jsx("div",{className:"bg-[#1a1a20] shadow-[0_0_50px_rgba(0,0,0,0.5)] flex-none",children:m.jsxs(RL,{ref:ae,width:N.dims.width,height:N.dims.height,onMouseDown:re,onMouseMove:he,onMouseUp:oe,className:"bg-white",children:[m.jsxs(vx,{children:[N.bgImage&&m.jsx(pH,{name:"bg-image",src:N.bgImage,x:0,y:0,width:N.dims.width,height:N.dims.height,onMouseDown:re,onTouchStart:re}),c?.showGrid&&m.jsx(yx,{width:N.dims.width,height:N.dims.height,fillPatternImage:(()=>{const ue=document.createElement("canvas");ue.width=c.gridSize||50,ue.height=c.gridSize||50;const xe=ue.getContext("2d");return xe.strokeStyle="rgba(0,0,0,0.2)",xe.lineWidth=1,xe.strokeRect(0,0,ue.width,ue.height),ue})(),listening:!1})]}),m.jsxs(vx,{children:[z.map((ue,xe)=>m.jsx(AL,{points:ue.points,stroke:ue.color,strokeWidth:ue.size,tension:.5,lineCap:"round",lineJoin:"round",globalCompositeOperation:ue.tool==="eraser"?"destination-out":"source-over"},xe)),q.map((ue,xe)=>m.jsx(yx,{id:ue.id,x:ue.x,y:ue.y,width:ue.width,height:ue.height,stroke:ue.color,strokeWidth:2,draggable:O==="select",onClick:()=>O==="select"&&K(ue.id),onTap:()=>O==="select"&&K(ue.id)},ue.id)),U.map((ue,xe)=>m.jsx(cH,{id:ue.id,x:ue.x,y:ue.y,text:ue.text,fontSize:ue.fontSize,fill:ue.color,draggable:O==="select",onClick:()=>O==="select"&&K(ue.id),onTap:()=>O==="select"&&K(ue.id),onDblClick:Se=>{te({isOpen:!0,id:ue.id,text:ue.text})}},ue.id)),m.jsx(mH,{selectedId:Z})]})]})})})]}),m.jsx(hH,{isOpen:ne.isOpen,onClose:()=>te(ue=>({...ue,isOpen:!1})),title:"Edit Map Text",initialValue:ne.text,onConfirm:ue=>{G(xe=>xe.map(Se=>Se.id===ne.id?{...Se,text:ue}:Se))},confirmText:"Save Text"})]})};function OL(t,e){const r=ie.useRef(e);ie.useEffect(function(){e!==r.current&&t.attributionControl!=null&&(r.current!=null&&t.attributionControl.removeAttribution(r.current),e!=null&&t.attributionControl.addAttribution(e)),r.current=e},[t,e])}const gH=1;function vH(t){return Object.freeze({__version:gH,map:t})}function DL(t,e){return Object.freeze({...t,...e})}const IL=ie.createContext(null),jL=IL.Provider;function T_(){const t=ie.useContext(IL);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function yH(t){function e(r,n){const{instance:i,context:a}=t(r).current;return ie.useImperativeHandle(n,()=>i),r.children==null?null:ir.createElement(jL,{value:a},r.children)}return ie.forwardRef(e)}function xH(t){function e(r,n){const[i,a]=ie.useState(!1),{instance:s}=t(r,a).current;ie.useImperativeHandle(n,()=>s),ie.useEffect(function(){i&&s.update()},[s,i,r.children]);const o=s._contentNode;return o?eo.createPortal(r.children,o):null}return ie.forwardRef(e)}function FL(t,e){const r=ie.useRef();ie.useEffect(function(){return e!=null&&t.instance.on(e),r.current=e,function(){r.current!=null&&t.instance.off(r.current),r.current=null}},[t,e])}function BL(t,e){const r=t.pane??e.pane;return r?{...t,pane:r}:t}function bH(t,e){return function(n,i){const a=T_(),s=t(BL(n,a),a);return OL(a.map,n.attribution),FL(s.current,n.eventHandlers),e(s.current,a,n,i),s}}var Kg={exports:{}};var wH=Kg.exports,S4;function SH(){return S4||(S4=1,(function(t,e){(function(r,n){n(e)})(wH,(function(r){var n="1.9.4";function i(f){var k,P,H,J;for(P=1,H=arguments.length;P<H;P++){J=arguments[P];for(k in J)f[k]=J[k]}return f}var a=Object.create||(function(){function f(){}return function(k){return f.prototype=k,new f}})();function s(f,k){var P=Array.prototype.slice;if(f.bind)return f.bind.apply(f,P.call(arguments,1));var H=P.call(arguments,2);return function(){return f.apply(k,H.length?H.concat(P.call(arguments)):arguments)}}var o=0;function l(f){return"_leaflet_id"in f||(f._leaflet_id=++o),f._leaflet_id}function u(f,k,P){var H,J,ce,we;return we=function(){H=!1,J&&(ce.apply(P,J),J=!1)},ce=function(){H?J=arguments:(f.apply(P,arguments),setTimeout(we,k),H=!0)},ce}function c(f,k,P){var H=k[1],J=k[0],ce=H-J;return f===H&&P?f:((f-J)%ce+ce)%ce+J}function h(){return!1}function p(f,k){if(k===!1)return f;var P=Math.pow(10,k===void 0?6:k);return Math.round(f*P)/P}function g(f){return f.trim?f.trim():f.replace(/^\s+|\s+$/g,"")}function y(f){return g(f).split(/\s+/)}function S(f,k){Object.prototype.hasOwnProperty.call(f,"options")||(f.options=f.options?a(f.options):{});for(var P in k)f.options[P]=k[P];return f.options}function w(f,k,P){var H=[];for(var J in f)H.push(encodeURIComponent(P?J.toUpperCase():J)+"="+encodeURIComponent(f[J]));return(!k||k.indexOf("?")===-1?"?":"&")+H.join("&")}var C=/\{ *([\w_ -]+) *\}/g;function _(f,k){return f.replace(C,function(P,H){var J=k[H];if(J===void 0)throw new Error("No value provided for variable "+P);return typeof J=="function"&&(J=J(k)),J})}var T=Array.isArray||function(f){return Object.prototype.toString.call(f)==="[object Array]"};function N(f,k){for(var P=0;P<f.length;P++)if(f[P]===k)return P;return-1}var R="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function I(f){return window["webkit"+f]||window["moz"+f]||window["ms"+f]}var j=0;function O(f){var k=+new Date,P=Math.max(0,16-(k-j));return j=k+P,window.setTimeout(f,P)}var F=window.requestAnimationFrame||I("RequestAnimationFrame")||O,z=window.cancelAnimationFrame||I("CancelAnimationFrame")||I("CancelRequestAnimationFrame")||function(f){window.clearTimeout(f)};function V(f,k,P){if(P&&F===O)f.call(k);else return F.call(window,s(f,k))}function q(f){f&&z.call(window,f)}var D={__proto__:null,extend:i,create:a,bind:s,get lastId(){return o},stamp:l,throttle:u,wrapNum:c,falseFn:h,formatNum:p,trim:g,splitWords:y,setOptions:S,getParamString:w,template:_,isArray:T,indexOf:N,emptyImageUrl:R,requestFn:F,cancelFn:z,requestAnimFrame:V,cancelAnimFrame:q};function U(){}U.extend=function(f){var k=function(){S(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},P=k.__super__=this.prototype,H=a(P);H.constructor=k,k.prototype=H;for(var J in this)Object.prototype.hasOwnProperty.call(this,J)&&J!=="prototype"&&J!=="__super__"&&(k[J]=this[J]);return f.statics&&i(k,f.statics),f.includes&&(G(f.includes),i.apply(null,[H].concat(f.includes))),i(H,f),delete H.statics,delete H.includes,H.options&&(H.options=P.options?a(P.options):{},i(H.options,f.options)),H._initHooks=[],H.callInitHooks=function(){if(!this._initHooksCalled){P.callInitHooks&&P.callInitHooks.call(this),this._initHooksCalled=!0;for(var ce=0,we=H._initHooks.length;ce<we;ce++)H._initHooks[ce].call(this)}},k},U.include=function(f){var k=this.prototype.options;return i(this.prototype,f),f.options&&(this.prototype.options=k,this.mergeOptions(f.options)),this},U.mergeOptions=function(f){return i(this.prototype.options,f),this},U.addInitHook=function(f){var k=Array.prototype.slice.call(arguments,1),P=typeof f=="function"?f:function(){this[f].apply(this,k)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(P),this};function G(f){if(!(typeof L>"u"||!L||!L.Mixin)){f=T(f)?f:[f];for(var k=0;k<f.length;k++)f[k]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Z={on:function(f,k,P){if(typeof f=="object")for(var H in f)this._on(H,f[H],k);else{f=y(f);for(var J=0,ce=f.length;J<ce;J++)this._on(f[J],k,P)}return this},off:function(f,k,P){if(!arguments.length)delete this._events;else if(typeof f=="object")for(var H in f)this._off(H,f[H],k);else{f=y(f);for(var J=arguments.length===1,ce=0,we=f.length;ce<we;ce++)J?this._off(f[ce]):this._off(f[ce],k,P)}return this},_on:function(f,k,P,H){if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}if(this._listens(f,k,P)===!1){P===this&&(P=void 0);var J={fn:k,ctx:P};H&&(J.once=!0),this._events=this._events||{},this._events[f]=this._events[f]||[],this._events[f].push(J)}},_off:function(f,k,P){var H,J,ce;if(this._events&&(H=this._events[f],!!H)){if(arguments.length===1){if(this._firingCount)for(J=0,ce=H.length;J<ce;J++)H[J].fn=h;delete this._events[f];return}if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}var we=this._listens(f,k,P);if(we!==!1){var Me=H[we];this._firingCount&&(Me.fn=h,this._events[f]=H=H.slice()),H.splice(we,1)}}},fire:function(f,k,P){if(!this.listens(f,P))return this;var H=i({},k,{type:f,target:this,sourceTarget:k&&k.sourceTarget||this});if(this._events){var J=this._events[f];if(J){this._firingCount=this._firingCount+1||1;for(var ce=0,we=J.length;ce<we;ce++){var Me=J[ce],Ie=Me.fn;Me.once&&this.off(f,Ie,Me.ctx),Ie.call(Me.ctx||this,H)}this._firingCount--}}return P&&this._propagateEvent(H),this},listens:function(f,k,P,H){typeof f!="string"&&console.warn('"string" type argument expected');var J=k;typeof k!="function"&&(H=!!k,J=void 0,P=void 0);var ce=this._events&&this._events[f];if(ce&&ce.length&&this._listens(f,J,P)!==!1)return!0;if(H){for(var we in this._eventParents)if(this._eventParents[we].listens(f,k,P,H))return!0}return!1},_listens:function(f,k,P){if(!this._events)return!1;var H=this._events[f]||[];if(!k)return!!H.length;P===this&&(P=void 0);for(var J=0,ce=H.length;J<ce;J++)if(H[J].fn===k&&H[J].ctx===P)return J;return!1},once:function(f,k,P){if(typeof f=="object")for(var H in f)this._on(H,f[H],k,!0);else{f=y(f);for(var J=0,ce=f.length;J<ce;J++)this._on(f[J],k,P,!0)}return this},addEventParent:function(f){return this._eventParents=this._eventParents||{},this._eventParents[l(f)]=f,this},removeEventParent:function(f){return this._eventParents&&delete this._eventParents[l(f)],this},_propagateEvent:function(f){for(var k in this._eventParents)this._eventParents[k].fire(f.type,i({layer:f.target,propagatedFrom:f.target},f),!0)}};Z.addEventListener=Z.on,Z.removeEventListener=Z.clearAllEventListeners=Z.off,Z.addOneTimeEventListener=Z.once,Z.fireEvent=Z.fire,Z.hasEventListeners=Z.listens;var K=U.extend(Z);function Q(f,k,P){this.x=P?Math.round(f):f,this.y=P?Math.round(k):k}var ne=Math.trunc||function(f){return f>0?Math.floor(f):Math.ceil(f)};Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(f){return this.clone()._add(te(f))},_add:function(f){return this.x+=f.x,this.y+=f.y,this},subtract:function(f){return this.clone()._subtract(te(f))},_subtract:function(f){return this.x-=f.x,this.y-=f.y,this},divideBy:function(f){return this.clone()._divideBy(f)},_divideBy:function(f){return this.x/=f,this.y/=f,this},multiplyBy:function(f){return this.clone()._multiplyBy(f)},_multiplyBy:function(f){return this.x*=f,this.y*=f,this},scaleBy:function(f){return new Q(this.x*f.x,this.y*f.y)},unscaleBy:function(f){return new Q(this.x/f.x,this.y/f.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ne(this.x),this.y=ne(this.y),this},distanceTo:function(f){f=te(f);var k=f.x-this.x,P=f.y-this.y;return Math.sqrt(k*k+P*P)},equals:function(f){return f=te(f),f.x===this.x&&f.y===this.y},contains:function(f){return f=te(f),Math.abs(f.x)<=Math.abs(this.x)&&Math.abs(f.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function te(f,k,P){return f instanceof Q?f:T(f)?new Q(f[0],f[1]):f==null?f:typeof f=="object"&&"x"in f&&"y"in f?new Q(f.x,f.y):new Q(f,k,P)}function X(f,k){if(f)for(var P=k?[f,k]:f,H=0,J=P.length;H<J;H++)this.extend(P[H])}X.prototype={extend:function(f){var k,P;if(!f)return this;if(f instanceof Q||typeof f[0]=="number"||"x"in f)k=P=te(f);else if(f=re(f),k=f.min,P=f.max,!k||!P)return this;return!this.min&&!this.max?(this.min=k.clone(),this.max=P.clone()):(this.min.x=Math.min(k.x,this.min.x),this.max.x=Math.max(P.x,this.max.x),this.min.y=Math.min(k.y,this.min.y),this.max.y=Math.max(P.y,this.max.y)),this},getCenter:function(f){return te((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,f)},getBottomLeft:function(){return te(this.min.x,this.max.y)},getTopRight:function(){return te(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(f){var k,P;return typeof f[0]=="number"||f instanceof Q?f=te(f):f=re(f),f instanceof X?(k=f.min,P=f.max):k=P=f,k.x>=this.min.x&&P.x<=this.max.x&&k.y>=this.min.y&&P.y<=this.max.y},intersects:function(f){f=re(f);var k=this.min,P=this.max,H=f.min,J=f.max,ce=J.x>=k.x&&H.x<=P.x,we=J.y>=k.y&&H.y<=P.y;return ce&&we},overlaps:function(f){f=re(f);var k=this.min,P=this.max,H=f.min,J=f.max,ce=J.x>k.x&&H.x<P.x,we=J.y>k.y&&H.y<P.y;return ce&&we},isValid:function(){return!!(this.min&&this.max)},pad:function(f){var k=this.min,P=this.max,H=Math.abs(k.x-P.x)*f,J=Math.abs(k.y-P.y)*f;return re(te(k.x-H,k.y-J),te(P.x+H,P.y+J))},equals:function(f){return f?(f=re(f),this.min.equals(f.getTopLeft())&&this.max.equals(f.getBottomRight())):!1}};function re(f,k){return!f||f instanceof X?f:new X(f,k)}function he(f,k){if(f)for(var P=k?[f,k]:f,H=0,J=P.length;H<J;H++)this.extend(P[H])}he.prototype={extend:function(f){var k=this._southWest,P=this._northEast,H,J;if(f instanceof se)H=f,J=f;else if(f instanceof he){if(H=f._southWest,J=f._northEast,!H||!J)return this}else return f?this.extend(fe(f)||oe(f)):this;return!k&&!P?(this._southWest=new se(H.lat,H.lng),this._northEast=new se(J.lat,J.lng)):(k.lat=Math.min(H.lat,k.lat),k.lng=Math.min(H.lng,k.lng),P.lat=Math.max(J.lat,P.lat),P.lng=Math.max(J.lng,P.lng)),this},pad:function(f){var k=this._southWest,P=this._northEast,H=Math.abs(k.lat-P.lat)*f,J=Math.abs(k.lng-P.lng)*f;return new he(new se(k.lat-H,k.lng-J),new se(P.lat+H,P.lng+J))},getCenter:function(){return new se((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new se(this.getNorth(),this.getWest())},getSouthEast:function(){return new se(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(f){typeof f[0]=="number"||f instanceof se||"lat"in f?f=fe(f):f=oe(f);var k=this._southWest,P=this._northEast,H,J;return f instanceof he?(H=f.getSouthWest(),J=f.getNorthEast()):H=J=f,H.lat>=k.lat&&J.lat<=P.lat&&H.lng>=k.lng&&J.lng<=P.lng},intersects:function(f){f=oe(f);var k=this._southWest,P=this._northEast,H=f.getSouthWest(),J=f.getNorthEast(),ce=J.lat>=k.lat&&H.lat<=P.lat,we=J.lng>=k.lng&&H.lng<=P.lng;return ce&&we},overlaps:function(f){f=oe(f);var k=this._southWest,P=this._northEast,H=f.getSouthWest(),J=f.getNorthEast(),ce=J.lat>k.lat&&H.lat<P.lat,we=J.lng>k.lng&&H.lng<P.lng;return ce&&we},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(f,k){return f?(f=oe(f),this._southWest.equals(f.getSouthWest(),k)&&this._northEast.equals(f.getNorthEast(),k)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function oe(f,k){return f instanceof he?f:new he(f,k)}function se(f,k,P){if(isNaN(f)||isNaN(k))throw new Error("Invalid LatLng object: ("+f+", "+k+")");this.lat=+f,this.lng=+k,P!==void 0&&(this.alt=+P)}se.prototype={equals:function(f,k){if(!f)return!1;f=fe(f);var P=Math.max(Math.abs(this.lat-f.lat),Math.abs(this.lng-f.lng));return P<=(k===void 0?1e-9:k)},toString:function(f){return"LatLng("+p(this.lat,f)+", "+p(this.lng,f)+")"},distanceTo:function(f){return pe.distance(this,fe(f))},wrap:function(){return pe.wrapLatLng(this)},toBounds:function(f){var k=180*f/40075017,P=k/Math.cos(Math.PI/180*this.lat);return oe([this.lat-k,this.lng-P],[this.lat+k,this.lng+P])},clone:function(){return new se(this.lat,this.lng,this.alt)}};function fe(f,k,P){return f instanceof se?f:T(f)&&typeof f[0]!="object"?f.length===3?new se(f[0],f[1],f[2]):f.length===2?new se(f[0],f[1]):null:f==null?f:typeof f=="object"&&"lat"in f?new se(f.lat,"lng"in f?f.lng:f.lon,f.alt):k===void 0?null:new se(f,k,P)}var ae={latLngToPoint:function(f,k){var P=this.projection.project(f),H=this.scale(k);return this.transformation._transform(P,H)},pointToLatLng:function(f,k){var P=this.scale(k),H=this.transformation.untransform(f,P);return this.projection.unproject(H)},project:function(f){return this.projection.project(f)},unproject:function(f){return this.projection.unproject(f)},scale:function(f){return 256*Math.pow(2,f)},zoom:function(f){return Math.log(f/256)/Math.LN2},getProjectedBounds:function(f){if(this.infinite)return null;var k=this.projection.bounds,P=this.scale(f),H=this.transformation.transform(k.min,P),J=this.transformation.transform(k.max,P);return new X(H,J)},infinite:!1,wrapLatLng:function(f){var k=this.wrapLng?c(f.lng,this.wrapLng,!0):f.lng,P=this.wrapLat?c(f.lat,this.wrapLat,!0):f.lat,H=f.alt;return new se(P,k,H)},wrapLatLngBounds:function(f){var k=f.getCenter(),P=this.wrapLatLng(k),H=k.lat-P.lat,J=k.lng-P.lng;if(H===0&&J===0)return f;var ce=f.getSouthWest(),we=f.getNorthEast(),Me=new se(ce.lat-H,ce.lng-J),Ie=new se(we.lat-H,we.lng-J);return new he(Me,Ie)}},pe=i({},ae,{wrapLng:[-180,180],R:6371e3,distance:function(f,k){var P=Math.PI/180,H=f.lat*P,J=k.lat*P,ce=Math.sin((k.lat-f.lat)*P/2),we=Math.sin((k.lng-f.lng)*P/2),Me=ce*ce+Math.cos(H)*Math.cos(J)*we*we,Ie=2*Math.atan2(Math.sqrt(Me),Math.sqrt(1-Me));return this.R*Ie}}),ye=6378137,ve={R:ye,MAX_LATITUDE:85.0511287798,project:function(f){var k=Math.PI/180,P=this.MAX_LATITUDE,H=Math.max(Math.min(P,f.lat),-P),J=Math.sin(H*k);return new Q(this.R*f.lng*k,this.R*Math.log((1+J)/(1-J))/2)},unproject:function(f){var k=180/Math.PI;return new se((2*Math.atan(Math.exp(f.y/this.R))-Math.PI/2)*k,f.x*k/this.R)},bounds:(function(){var f=ye*Math.PI;return new X([-f,-f],[f,f])})()};function ue(f,k,P,H){if(T(f)){this._a=f[0],this._b=f[1],this._c=f[2],this._d=f[3];return}this._a=f,this._b=k,this._c=P,this._d=H}ue.prototype={transform:function(f,k){return this._transform(f.clone(),k)},_transform:function(f,k){return k=k||1,f.x=k*(this._a*f.x+this._b),f.y=k*(this._c*f.y+this._d),f},untransform:function(f,k){return k=k||1,new Q((f.x/k-this._b)/this._a,(f.y/k-this._d)/this._c)}};function xe(f,k,P,H){return new ue(f,k,P,H)}var Se=i({},pe,{code:"EPSG:3857",projection:ve,transformation:(function(){var f=.5/(Math.PI*ve.R);return xe(f,.5,-f,.5)})()}),Oe=i({},Se,{code:"EPSG:900913"});function Ae(f){return document.createElementNS("http://www.w3.org/2000/svg",f)}function tt(f,k){var P="",H,J,ce,we,Me,Ie;for(H=0,ce=f.length;H<ce;H++){for(Me=f[H],J=0,we=Me.length;J<we;J++)Ie=Me[J],P+=(J?"L":"M")+Ie.x+" "+Ie.y;P+=k?Et.svg?"z":"x":""}return P||"M0 0"}var rt=document.documentElement.style,dt="ActiveXObject"in window,_t=dt&&!document.addEventListener,Xe="msLaunchUri"in navigator&&!("documentMode"in document),ht=vr("webkit"),ct=vr("android"),vt=vr("android 2")||vr("android 3"),lt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Lt=ct&&vr("Google")&&lt<537&&!("AudioNode"in window),jt=!!window.opera,Ne=!Xe&&vr("chrome"),qe=vr("gecko")&&!ht&&!jt&&!dt,bt=!Ne&&vr("safari"),at=vr("phantom"),ut="OTransition"in rt,Fe=navigator.platform.indexOf("Win")===0,de=dt&&"transition"in rt,ge="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!vt,ke="MozPerspective"in rt,Ee=!window.L_DISABLE_3D&&(de||ge||ke)&&!ut&&!at,Le=typeof orientation<"u"||vr("mobile"),Qe=Le&&ht,Ve=Le&&ge,xt=!window.PointerEvent&&window.MSPointerEvent,ze=!!(window.PointerEvent||xt),$e="ontouchstart"in window||!!window.TouchEvent,wt=!window.L_NO_TOUCH&&($e||ze),Pt=Le&&jt,Ct=Le&&qe,Vt=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Yt=(function(){var f=!1;try{var k=Object.defineProperty({},"passive",{get:function(){f=!0}});window.addEventListener("testPassiveEventSupport",h,k),window.removeEventListener("testPassiveEventSupport",h,k)}catch{}return f})(),Lr=(function(){return!!document.createElement("canvas").getContext})(),kr=!!(document.createElementNS&&Ae("svg").createSVGRect),Qr=!!kr&&(function(){var f=document.createElement("div");return f.innerHTML="<svg/>",(f.firstChild&&f.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),Jr=!kr&&(function(){try{var f=document.createElement("div");f.innerHTML='<v:shape adj="1"/>';var k=f.firstChild;return k.style.behavior="url(#default#VML)",k&&typeof k.adj=="object"}catch{return!1}})(),_r=navigator.platform.indexOf("Mac")===0,hn=navigator.platform.indexOf("Linux")===0;function vr(f){return navigator.userAgent.toLowerCase().indexOf(f)>=0}var Et={ie:dt,ielt9:_t,edge:Xe,webkit:ht,android:ct,android23:vt,androidStock:Lt,opera:jt,chrome:Ne,gecko:qe,safari:bt,phantom:at,opera12:ut,win:Fe,ie3d:de,webkit3d:ge,gecko3d:ke,any3d:Ee,mobile:Le,mobileWebkit:Qe,mobileWebkit3d:Ve,msPointer:xt,pointer:ze,touch:wt,touchNative:$e,mobileOpera:Pt,mobileGecko:Ct,retina:Vt,passiveEvents:Yt,canvas:Lr,svg:kr,vml:Jr,inlineSvg:Qr,mac:_r,linux:hn},Br=Et.msPointer?"MSPointerDown":"pointerdown",Xn=Et.msPointer?"MSPointerMove":"pointermove",Zi=Et.msPointer?"MSPointerUp":"pointerup",ds=Et.msPointer?"MSPointerCancel":"pointercancel",As={touchstart:Br,touchmove:Xn,touchend:Zi,touchcancel:ds},ni={touchstart:on,touchmove:_o,touchend:_o,touchcancel:_o},sn={},kn=!1;function In(f,k,P){return k==="touchstart"&&Ru(),ni[k]?(P=ni[k].bind(this,P),f.addEventListener(As[k],P,!1),P):(console.warn("wrong event specified:",k),h)}function Ls(f,k,P){if(!As[k]){console.warn("wrong event specified:",k);return}f.removeEventListener(As[k],P,!1)}function gi(f){sn[f.pointerId]=f}function ko(f){sn[f.pointerId]&&(sn[f.pointerId]=f)}function qa(f){delete sn[f.pointerId]}function Ru(){kn||(document.addEventListener(Br,gi,!0),document.addEventListener(Xn,ko,!0),document.addEventListener(Zi,qa,!0),document.addEventListener(ds,qa,!0),kn=!0)}function _o(f,k){if(k.pointerType!==(k.MSPOINTER_TYPE_MOUSE||"mouse")){k.touches=[];for(var P in sn)k.touches.push(sn[P]);k.changedTouches=[k],f(k)}}function on(f,k){k.MSPOINTER_TYPE_TOUCH&&k.pointerType===k.MSPOINTER_TYPE_TOUCH&&fn(k),_o(f,k)}function Co(f){var k={},P,H;for(H in f)P=f[H],k[H]=P&&P.bind?P.bind(f):P;return f=k,k.type="dblclick",k.detail=2,k.isTrusted=!1,k._simulated=!0,k}var hs=200;function ro(f,k){f.addEventListener("dblclick",k);var P=0,H;function J(ce){if(ce.detail!==1){H=ce.detail;return}if(!(ce.pointerType==="mouse"||ce.sourceCapabilities&&!ce.sourceCapabilities.firesTouchEvents)){var we=ll(ce);if(!(we.some(function(Ie){return Ie instanceof HTMLLabelElement&&Ie.attributes.for})&&!we.some(function(Ie){return Ie instanceof HTMLInputElement||Ie instanceof HTMLSelectElement}))){var Me=Date.now();Me-P<=hs?(H++,H===2&&k(Co(ce))):H=1,P=Me}}}return f.addEventListener("click",J),{dblclick:k,simDblclick:J}}function Yi(f,k){f.removeEventListener("dblclick",k.dblclick),f.removeEventListener("click",k.simDblclick)}var no=er(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Ge=er(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ye=Ge==="webkitTransition"||Ge==="OTransition"?Ge+"End":"transitionend";function nt(f){return typeof f=="string"?document.getElementById(f):f}function pt(f,k){var P=f.style[k]||f.currentStyle&&f.currentStyle[k];if((!P||P==="auto")&&document.defaultView){var H=document.defaultView.getComputedStyle(f,null);P=H?H[k]:null}return P==="auto"?null:P}function Ze(f,k,P){var H=document.createElement(f);return H.className=k||"",P&&P.appendChild(H),H}function Dt(f){var k=f.parentNode;k&&k.removeChild(f)}function Nr(f){for(;f.firstChild;)f.removeChild(f.firstChild)}function Pr(f){var k=f.parentNode;k&&k.lastChild!==f&&k.appendChild(f)}function Fr(f){var k=f.parentNode;k&&k.firstChild!==f&&k.insertBefore(f,k.firstChild)}function vi(f,k){if(f.classList!==void 0)return f.classList.contains(k);var P=Jt(f);return P.length>0&&new RegExp("(^|\\s)"+k+"(\\s|$)").test(P)}function zt(f,k){if(f.classList!==void 0)for(var P=y(k),H=0,J=P.length;H<J;H++)f.classList.add(P[H]);else if(!vi(f,k)){var ce=Jt(f);al(f,(ce?ce+" ":"")+k)}}function Ir(f,k){f.classList!==void 0?f.classList.remove(k):al(f,g((" "+Jt(f)+" ").replace(" "+k+" "," ")))}function al(f,k){f.className.baseVal===void 0?f.className=k:f.className.baseVal=k}function Jt(f){return f.correspondingElement&&(f=f.correspondingElement),f.className.baseVal===void 0?f.className:f.className.baseVal}function tr(f,k){"opacity"in f.style?f.style.opacity=k:"filter"in f.style&&Rr(f,k)}function Rr(f,k){var P=!1,H="DXImageTransform.Microsoft.Alpha";try{P=f.filters.item(H)}catch{if(k===1)return}k=Math.round(k*100),P?(P.Enabled=k!==100,P.Opacity=k):f.style.filter+=" progid:"+H+"(opacity="+k+")"}function er(f){for(var k=document.documentElement.style,P=0;P<f.length;P++)if(f[P]in k)return f[P];return!1}function en(f,k,P){var H=k||new Q(0,0);f.style[no]=(Et.ie3d?"translate("+H.x+"px,"+H.y+"px)":"translate3d("+H.x+"px,"+H.y+"px,0)")+(P?" scale("+P+")":"")}function yn(f,k){f._leaflet_pos=k,Et.any3d?en(f,k):(f.style.left=k.x+"px",f.style.top=k.y+"px")}function io(f){return f._leaflet_pos||new Q(0,0)}var xr,ao,Eo;if("onselectstart"in document)xr=function(){sr(window,"selectstart",fn)},ao=function(){$r(window,"selectstart",fn)};else{var Rs=er(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);xr=function(){if(Rs){var f=document.documentElement.style;Eo=f[Rs],f[Rs]="none"}},ao=function(){Rs&&(document.documentElement.style[Rs]=Eo,Eo=void 0)}}function Cc(){sr(window,"dragstart",fn)}function Ec(){$r(window,"dragstart",fn)}var sl,Gl;function To(f){for(;f.tabIndex===-1;)f=f.parentNode;f.style&&(Fi(),sl=f,Gl=f.style.outlineStyle,f.style.outlineStyle="none",sr(window,"keydown",Fi))}function Fi(){sl&&(sl.style.outlineStyle=Gl,sl=void 0,Gl=void 0,$r(window,"keydown",Fi))}function so(f){do f=f.parentNode;while((!f.offsetWidth||!f.offsetHeight)&&f!==document.body);return f}function $a(f){var k=f.getBoundingClientRect();return{x:k.width/f.offsetWidth||1,y:k.height/f.offsetHeight||1,boundingClientRect:k}}var br={__proto__:null,TRANSFORM:no,TRANSITION:Ge,TRANSITION_END:Ye,get:nt,getStyle:pt,create:Ze,remove:Dt,empty:Nr,toFront:Pr,toBack:Fr,hasClass:vi,addClass:zt,removeClass:Ir,setClass:al,getClass:Jt,setOpacity:tr,testProp:er,setTransform:en,setPosition:yn,getPosition:io,get disableTextSelection(){return xr},get enableTextSelection(){return ao},disableImageDrag:Cc,enableImageDrag:Ec,preventOutline:To,restoreOutline:Fi,getSizedParentNode:so,getScale:$a};function sr(f,k,P,H){if(k&&typeof k=="object")for(var J in k)jn(f,J,k[J],P);else{k=y(k);for(var ce=0,we=k.length;ce<we;ce++)jn(f,k[ce],P,H)}return this}var Qn="_leaflet_events";function $r(f,k,P,H){if(arguments.length===1)gh(f),delete f[Qn];else if(k&&typeof k=="object")for(var J in k)Vl(f,J,k[J],P);else if(k=y(k),arguments.length===2)gh(f,function(Me){return N(k,Me)!==-1});else for(var ce=0,we=k.length;ce<we;ce++)Vl(f,k[ce],P,H);return this}function gh(f,k){for(var P in f[Qn]){var H=P.split(/\d/)[0];(!k||k(H))&&Vl(f,H,null,null,P)}}var ol={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function jn(f,k,P,H){var J=k+l(P)+(H?"_"+l(H):"");if(f[Qn]&&f[Qn][J])return this;var ce=function(Me){return P.call(H||f,Me||window.event)},we=ce;!Et.touchNative&&Et.pointer&&k.indexOf("touch")===0?ce=In(f,k,ce):Et.touch&&k==="dblclick"?ce=ro(f,ce):"addEventListener"in f?k==="touchstart"||k==="touchmove"||k==="wheel"||k==="mousewheel"?f.addEventListener(ol[k]||k,ce,Et.passiveEvents?{passive:!1}:!1):k==="mouseenter"||k==="mouseleave"?(ce=function(Me){Me=Me||window.event,No(f,Me)&&we(Me)},f.addEventListener(ol[k],ce,!1)):f.addEventListener(k,we,!1):f.attachEvent("on"+k,ce),f[Qn]=f[Qn]||{},f[Qn][J]=ce}function Vl(f,k,P,H,J){J=J||k+l(P)+(H?"_"+l(H):"");var ce=f[Qn]&&f[Qn][J];if(!ce)return this;!Et.touchNative&&Et.pointer&&k.indexOf("touch")===0?Ls(f,k,ce):Et.touch&&k==="dblclick"?Yi(f,ce):"removeEventListener"in f?f.removeEventListener(ol[k]||k,ce,!1):f.detachEvent("on"+k,ce),f[Qn][J]=null}function Os(f){return f.stopPropagation?f.stopPropagation():f.originalEvent?f.originalEvent._stopped=!0:f.cancelBubble=!0,this}function Hl(f){return jn(f,"wheel",Os),this}function Ou(f){return sr(f,"mousedown touchstart dblclick contextmenu",Os),f._leaflet_disable_click=!0,this}function fn(f){return f.preventDefault?f.preventDefault():f.returnValue=!1,this}function Fn(f){return fn(f),Os(f),this}function ll(f){if(f.composedPath)return f.composedPath();for(var k=[],P=f.target;P;)k.push(P),P=P.parentNode;return k}function Du(f,k){if(!k)return new Q(f.clientX,f.clientY);var P=$a(k),H=P.boundingClientRect;return new Q((f.clientX-H.left)/P.x-k.clientLeft,(f.clientY-H.top)/P.y-k.clientTop)}var fs=Et.linux&&Et.chrome?window.devicePixelRatio:Et.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ds(f){return Et.edge?f.wheelDeltaY/2:f.deltaY&&f.deltaMode===0?-f.deltaY/fs:f.deltaY&&f.deltaMode===1?-f.deltaY*20:f.deltaY&&f.deltaMode===2?-f.deltaY*60:f.deltaX||f.deltaZ?0:f.wheelDelta?(f.wheelDeltaY||f.wheelDelta)/2:f.detail&&Math.abs(f.detail)<32765?-f.detail*20:f.detail?f.detail/-32765*60:0}function No(f,k){var P=k.relatedTarget;if(!P)return!0;try{for(;P&&P!==f;)P=P.parentNode}catch{return!1}return P!==f}var Wl={__proto__:null,on:sr,off:$r,stopPropagation:Os,disableScrollPropagation:Hl,disableClickPropagation:Ou,preventDefault:fn,stop:Fn,getPropagationPath:ll,getMousePosition:Du,getWheelDelta:Ds,isExternalTarget:No,addListener:sr,removeListener:$r},Iu=K.extend({run:function(f,k,P,H){this.stop(),this._el=f,this._inProgress=!0,this._duration=P||.25,this._easeOutPower=1/Math.max(H||.5,.2),this._startPos=io(f),this._offset=k.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=V(this._animate,this),this._step()},_step:function(f){var k=+new Date-this._startTime,P=this._duration*1e3;k<P?this._runFrame(this._easeOut(k/P),f):(this._runFrame(1),this._complete())},_runFrame:function(f,k){var P=this._startPos.add(this._offset.multiplyBy(f));k&&P._round(),yn(this._el,P),this.fire("step")},_complete:function(){q(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(f){return 1-Math.pow(1-f,this._easeOutPower)}}),Cr=K.extend({options:{crs:Se,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(f,k){k=S(this,k),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(f),this._initLayout(),this._onResize=s(this._onResize,this),this._initEvents(),k.maxBounds&&this.setMaxBounds(k.maxBounds),k.zoom!==void 0&&(this._zoom=this._limitZoom(k.zoom)),k.center&&k.zoom!==void 0&&this.setView(fe(k.center),k.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Ge&&Et.any3d&&!Et.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),sr(this._proxy,Ye,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(f,k,P){if(k=k===void 0?this._zoom:this._limitZoom(k),f=this._limitCenter(fe(f),k,this.options.maxBounds),P=P||{},this._stop(),this._loaded&&!P.reset&&P!==!0){P.animate!==void 0&&(P.zoom=i({animate:P.animate},P.zoom),P.pan=i({animate:P.animate,duration:P.duration},P.pan));var H=this._zoom!==k?this._tryAnimatedZoom&&this._tryAnimatedZoom(f,k,P.zoom):this._tryAnimatedPan(f,P.pan);if(H)return clearTimeout(this._sizeTimer),this}return this._resetView(f,k,P.pan&&P.pan.noMoveStart),this},setZoom:function(f,k){return this._loaded?this.setView(this.getCenter(),f,{zoom:k}):(this._zoom=f,this)},zoomIn:function(f,k){return f=f||(Et.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+f,k)},zoomOut:function(f,k){return f=f||(Et.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-f,k)},setZoomAround:function(f,k,P){var H=this.getZoomScale(k),J=this.getSize().divideBy(2),ce=f instanceof Q?f:this.latLngToContainerPoint(f),we=ce.subtract(J).multiplyBy(1-1/H),Me=this.containerPointToLatLng(J.add(we));return this.setView(Me,k,{zoom:P})},_getBoundsCenterZoom:function(f,k){k=k||{},f=f.getBounds?f.getBounds():oe(f);var P=te(k.paddingTopLeft||k.padding||[0,0]),H=te(k.paddingBottomRight||k.padding||[0,0]),J=this.getBoundsZoom(f,!1,P.add(H));if(J=typeof k.maxZoom=="number"?Math.min(k.maxZoom,J):J,J===1/0)return{center:f.getCenter(),zoom:J};var ce=H.subtract(P).divideBy(2),we=this.project(f.getSouthWest(),J),Me=this.project(f.getNorthEast(),J),Ie=this.unproject(we.add(Me).divideBy(2).add(ce),J);return{center:Ie,zoom:J}},fitBounds:function(f,k){if(f=oe(f),!f.isValid())throw new Error("Bounds are not valid.");var P=this._getBoundsCenterZoom(f,k);return this.setView(P.center,P.zoom,k)},fitWorld:function(f){return this.fitBounds([[-90,-180],[90,180]],f)},panTo:function(f,k){return this.setView(f,this._zoom,{pan:k})},panBy:function(f,k){if(f=te(f).round(),k=k||{},!f.x&&!f.y)return this.fire("moveend");if(k.animate!==!0&&!this.getSize().contains(f))return this._resetView(this.unproject(this.project(this.getCenter()).add(f)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Iu,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),k.noMoveStart||this.fire("movestart"),k.animate!==!1){zt(this._mapPane,"leaflet-pan-anim");var P=this._getMapPanePos().subtract(f).round();this._panAnim.run(this._mapPane,P,k.duration||.25,k.easeLinearity)}else this._rawPanBy(f),this.fire("move").fire("moveend");return this},flyTo:function(f,k,P){if(P=P||{},P.animate===!1||!Et.any3d)return this.setView(f,k,P);this._stop();var H=this.project(this.getCenter()),J=this.project(f),ce=this.getSize(),we=this._zoom;f=fe(f),k=k===void 0?we:k;var Me=Math.max(ce.x,ce.y),Ie=Me*this.getZoomScale(we,k),Je=J.distanceTo(H)||1,Tt=1.42,Xt=Tt*Tt;function hr(zr){var bl=zr?-1:1,Bf=zr?Ie:Me,zf=Ie*Ie-Me*Me+bl*Xt*Xt*Je*Je,Do=2*Bf*Xt*Je,wl=zf/Do,Vn=Math.sqrt(wl*wl+1)-wl,si=Vn<1e-9?-18:Math.log(Vn);return si}function Zr(zr){return(Math.exp(zr)-Math.exp(-zr))/2}function Gn(zr){return(Math.exp(zr)+Math.exp(-zr))/2}function Ai(zr){return Zr(zr)/Gn(zr)}var zi=hr(0);function yl(zr){return Me*(Gn(zi)/Gn(zi+Tt*zr))}function Uc(zr){return Me*(Gn(zi)*Ai(zi+Tt*zr)-Zr(zi))/Xt}function zs(zr){return 1-Math.pow(1-zr,1.5)}var xl=Date.now(),co=(hr(1)-zi)/Tt,es=P.duration?1e3*P.duration:1e3*co*.8;function iu(){var zr=(Date.now()-xl)/es,bl=zs(zr)*co;zr<=1?(this._flyToFrame=V(iu,this),this._move(this.unproject(H.add(J.subtract(H).multiplyBy(Uc(bl)/Je)),we),this.getScaleZoom(Me/yl(bl),we),{flyTo:!0})):this._move(f,k)._moveEnd(!0)}return this._moveStart(!0,P.noMoveStart),iu.call(this),this},flyToBounds:function(f,k){var P=this._getBoundsCenterZoom(f,k);return this.flyTo(P.center,P.zoom,k)},setMaxBounds:function(f){return f=oe(f),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),f.isValid()?(this.options.maxBounds=f,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(f){var k=this.options.minZoom;return this.options.minZoom=f,this._loaded&&k!==f&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(f):this},setMaxZoom:function(f){var k=this.options.maxZoom;return this.options.maxZoom=f,this._loaded&&k!==f&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(f):this},panInsideBounds:function(f,k){this._enforcingBounds=!0;var P=this.getCenter(),H=this._limitCenter(P,this._zoom,oe(f));return P.equals(H)||this.panTo(H,k),this._enforcingBounds=!1,this},panInside:function(f,k){k=k||{};var P=te(k.paddingTopLeft||k.padding||[0,0]),H=te(k.paddingBottomRight||k.padding||[0,0]),J=this.project(this.getCenter()),ce=this.project(f),we=this.getPixelBounds(),Me=re([we.min.add(P),we.max.subtract(H)]),Ie=Me.getSize();if(!Me.contains(ce)){this._enforcingBounds=!0;var Je=ce.subtract(Me.getCenter()),Tt=Me.extend(ce).getSize().subtract(Ie);J.x+=Je.x<0?-Tt.x:Tt.x,J.y+=Je.y<0?-Tt.y:Tt.y,this.panTo(this.unproject(J),k),this._enforcingBounds=!1}return this},invalidateSize:function(f){if(!this._loaded)return this;f=i({animate:!1,pan:!0},f===!0?{animate:!0}:f);var k=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var P=this.getSize(),H=k.divideBy(2).round(),J=P.divideBy(2).round(),ce=H.subtract(J);return!ce.x&&!ce.y?this:(f.animate&&f.pan?this.panBy(ce):(f.pan&&this._rawPanBy(ce),this.fire("move"),f.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:k,newSize:P}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(f){if(f=this._locateOptions=i({timeout:1e4,watch:!1},f),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var k=s(this._handleGeolocationResponse,this),P=s(this._handleGeolocationError,this);return f.watch?this._locationWatchId=navigator.geolocation.watchPosition(k,P,f):navigator.geolocation.getCurrentPosition(k,P,f),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(f){if(this._container._leaflet_id){var k=f.code,P=f.message||(k===1?"permission denied":k===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:k,message:"Geolocation error: "+P+"."})}},_handleGeolocationResponse:function(f){if(this._container._leaflet_id){var k=f.coords.latitude,P=f.coords.longitude,H=new se(k,P),J=H.toBounds(f.coords.accuracy*2),ce=this._locateOptions;if(ce.setView){var we=this.getBoundsZoom(J);this.setView(H,ce.maxZoom?Math.min(we,ce.maxZoom):we)}var Me={latlng:H,bounds:J,timestamp:f.timestamp};for(var Ie in f.coords)typeof f.coords[Ie]=="number"&&(Me[Ie]=f.coords[Ie]);this.fire("locationfound",Me)}},addHandler:function(f,k){if(!k)return this;var P=this[f]=new k(this);return this._handlers.push(P),this.options[f]&&P.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Dt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(q(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var f;for(f in this._layers)this._layers[f].remove();for(f in this._panes)Dt(this._panes[f]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(f,k){var P="leaflet-pane"+(f?" leaflet-"+f.replace("Pane","")+"-pane":""),H=Ze("div",P,k||this._mapPane);return f&&(this._panes[f]=H),H},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var f=this.getPixelBounds(),k=this.unproject(f.getBottomLeft()),P=this.unproject(f.getTopRight());return new he(k,P)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(f,k,P){f=oe(f),P=te(P||[0,0]);var H=this.getZoom()||0,J=this.getMinZoom(),ce=this.getMaxZoom(),we=f.getNorthWest(),Me=f.getSouthEast(),Ie=this.getSize().subtract(P),Je=re(this.project(Me,H),this.project(we,H)).getSize(),Tt=Et.any3d?this.options.zoomSnap:1,Xt=Ie.x/Je.x,hr=Ie.y/Je.y,Zr=k?Math.max(Xt,hr):Math.min(Xt,hr);return H=this.getScaleZoom(Zr,H),Tt&&(H=Math.round(H/(Tt/100))*(Tt/100),H=k?Math.ceil(H/Tt)*Tt:Math.floor(H/Tt)*Tt),Math.max(J,Math.min(ce,H))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Q(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(f,k){var P=this._getTopLeftPoint(f,k);return new X(P,P.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(f){return this.options.crs.getProjectedBounds(f===void 0?this.getZoom():f)},getPane:function(f){return typeof f=="string"?this._panes[f]:f},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(f,k){var P=this.options.crs;return k=k===void 0?this._zoom:k,P.scale(f)/P.scale(k)},getScaleZoom:function(f,k){var P=this.options.crs;k=k===void 0?this._zoom:k;var H=P.zoom(f*P.scale(k));return isNaN(H)?1/0:H},project:function(f,k){return k=k===void 0?this._zoom:k,this.options.crs.latLngToPoint(fe(f),k)},unproject:function(f,k){return k=k===void 0?this._zoom:k,this.options.crs.pointToLatLng(te(f),k)},layerPointToLatLng:function(f){var k=te(f).add(this.getPixelOrigin());return this.unproject(k)},latLngToLayerPoint:function(f){var k=this.project(fe(f))._round();return k._subtract(this.getPixelOrigin())},wrapLatLng:function(f){return this.options.crs.wrapLatLng(fe(f))},wrapLatLngBounds:function(f){return this.options.crs.wrapLatLngBounds(oe(f))},distance:function(f,k){return this.options.crs.distance(fe(f),fe(k))},containerPointToLayerPoint:function(f){return te(f).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(f){return te(f).add(this._getMapPanePos())},containerPointToLatLng:function(f){var k=this.containerPointToLayerPoint(te(f));return this.layerPointToLatLng(k)},latLngToContainerPoint:function(f){return this.layerPointToContainerPoint(this.latLngToLayerPoint(fe(f)))},mouseEventToContainerPoint:function(f){return Du(f,this._container)},mouseEventToLayerPoint:function(f){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(f))},mouseEventToLatLng:function(f){return this.layerPointToLatLng(this.mouseEventToLayerPoint(f))},_initContainer:function(f){var k=this._container=nt(f);if(k){if(k._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");sr(k,"scroll",this._onScroll,this),this._containerId=l(k)},_initLayout:function(){var f=this._container;this._fadeAnimated=this.options.fadeAnimation&&Et.any3d,zt(f,"leaflet-container"+(Et.touch?" leaflet-touch":"")+(Et.retina?" leaflet-retina":"")+(Et.ielt9?" leaflet-oldie":"")+(Et.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var k=pt(f,"position");k!=="absolute"&&k!=="relative"&&k!=="fixed"&&k!=="sticky"&&(f.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var f=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),yn(this._mapPane,new Q(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(zt(f.markerPane,"leaflet-zoom-hide"),zt(f.shadowPane,"leaflet-zoom-hide"))},_resetView:function(f,k,P){yn(this._mapPane,new Q(0,0));var H=!this._loaded;this._loaded=!0,k=this._limitZoom(k),this.fire("viewprereset");var J=this._zoom!==k;this._moveStart(J,P)._move(f,k)._moveEnd(J),this.fire("viewreset"),H&&this.fire("load")},_moveStart:function(f,k){return f&&this.fire("zoomstart"),k||this.fire("movestart"),this},_move:function(f,k,P,H){k===void 0&&(k=this._zoom);var J=this._zoom!==k;return this._zoom=k,this._lastCenter=f,this._pixelOrigin=this._getNewPixelOrigin(f),H?P&&P.pinch&&this.fire("zoom",P):((J||P&&P.pinch)&&this.fire("zoom",P),this.fire("move",P)),this},_moveEnd:function(f){return f&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return q(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(f){yn(this._mapPane,this._getMapPanePos().subtract(f))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(f){this._targets={},this._targets[l(this._container)]=this;var k=f?$r:sr;k(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&k(window,"resize",this._onResize,this),Et.any3d&&this.options.transform3DLimit&&(f?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){q(this._resizeRequest),this._resizeRequest=V(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var f=this._getMapPanePos();Math.max(Math.abs(f.x),Math.abs(f.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(f,k){for(var P=[],H,J=k==="mouseout"||k==="mouseover",ce=f.target||f.srcElement,we=!1;ce;){if(H=this._targets[l(ce)],H&&(k==="click"||k==="preclick")&&this._draggableMoved(H)){we=!0;break}if(H&&H.listens(k,!0)&&(J&&!No(ce,f)||(P.push(H),J))||ce===this._container)break;ce=ce.parentNode}return!P.length&&!we&&!J&&this.listens(k,!0)&&(P=[this]),P},_isClickDisabled:function(f){for(;f&&f!==this._container;){if(f._leaflet_disable_click)return!0;f=f.parentNode}},_handleDOMEvent:function(f){var k=f.target||f.srcElement;if(!(!this._loaded||k._leaflet_disable_events||f.type==="click"&&this._isClickDisabled(k))){var P=f.type;P==="mousedown"&&To(k),this._fireDOMEvent(f,P)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(f,k,P){if(f.type==="click"){var H=i({},f);H.type="preclick",this._fireDOMEvent(H,H.type,P)}var J=this._findEventTargets(f,k);if(P){for(var ce=[],we=0;we<P.length;we++)P[we].listens(k,!0)&&ce.push(P[we]);J=ce.concat(J)}if(J.length){k==="contextmenu"&&fn(f);var Me=J[0],Ie={originalEvent:f};if(f.type!=="keypress"&&f.type!=="keydown"&&f.type!=="keyup"){var Je=Me.getLatLng&&(!Me._radius||Me._radius<=10);Ie.containerPoint=Je?this.latLngToContainerPoint(Me.getLatLng()):this.mouseEventToContainerPoint(f),Ie.layerPoint=this.containerPointToLayerPoint(Ie.containerPoint),Ie.latlng=Je?Me.getLatLng():this.layerPointToLatLng(Ie.layerPoint)}for(we=0;we<J.length;we++)if(J[we].fire(k,Ie,!0),Ie.originalEvent._stopped||J[we].options.bubblingMouseEvents===!1&&N(this._mouseEvents,k)!==-1)return}},_draggableMoved:function(f){return f=f.dragging&&f.dragging.enabled()?f:this,f.dragging&&f.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var f=0,k=this._handlers.length;f<k;f++)this._handlers[f].disable()},whenReady:function(f,k){return this._loaded?f.call(k||this,{target:this}):this.on("load",f,k),this},_getMapPanePos:function(){return io(this._mapPane)||new Q(0,0)},_moved:function(){var f=this._getMapPanePos();return f&&!f.equals([0,0])},_getTopLeftPoint:function(f,k){var P=f&&k!==void 0?this._getNewPixelOrigin(f,k):this.getPixelOrigin();return P.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(f,k){var P=this.getSize()._divideBy(2);return this.project(f,k)._subtract(P)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(f,k,P){var H=this._getNewPixelOrigin(P,k);return this.project(f,k)._subtract(H)},_latLngBoundsToNewLayerBounds:function(f,k,P){var H=this._getNewPixelOrigin(P,k);return re([this.project(f.getSouthWest(),k)._subtract(H),this.project(f.getNorthWest(),k)._subtract(H),this.project(f.getSouthEast(),k)._subtract(H),this.project(f.getNorthEast(),k)._subtract(H)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(f){return this.latLngToLayerPoint(f).subtract(this._getCenterLayerPoint())},_limitCenter:function(f,k,P){if(!P)return f;var H=this.project(f,k),J=this.getSize().divideBy(2),ce=new X(H.subtract(J),H.add(J)),we=this._getBoundsOffset(ce,P,k);return Math.abs(we.x)<=1&&Math.abs(we.y)<=1?f:this.unproject(H.add(we),k)},_limitOffset:function(f,k){if(!k)return f;var P=this.getPixelBounds(),H=new X(P.min.add(f),P.max.add(f));return f.add(this._getBoundsOffset(H,k))},_getBoundsOffset:function(f,k,P){var H=re(this.project(k.getNorthEast(),P),this.project(k.getSouthWest(),P)),J=H.min.subtract(f.min),ce=H.max.subtract(f.max),we=this._rebound(J.x,-ce.x),Me=this._rebound(J.y,-ce.y);return new Q(we,Me)},_rebound:function(f,k){return f+k>0?Math.round(f-k)/2:Math.max(0,Math.ceil(f))-Math.max(0,Math.floor(k))},_limitZoom:function(f){var k=this.getMinZoom(),P=this.getMaxZoom(),H=Et.any3d?this.options.zoomSnap:1;return H&&(f=Math.round(f/H)*H),Math.max(k,Math.min(P,f))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Ir(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(f,k){var P=this._getCenterOffset(f)._trunc();return(k&&k.animate)!==!0&&!this.getSize().contains(P)?!1:(this.panBy(P,k),!0)},_createAnimProxy:function(){var f=this._proxy=Ze("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(f),this.on("zoomanim",function(k){var P=no,H=this._proxy.style[P];en(this._proxy,this.project(k.center,k.zoom),this.getZoomScale(k.zoom,1)),H===this._proxy.style[P]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Dt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var f=this.getCenter(),k=this.getZoom();en(this._proxy,this.project(f,k),this.getZoomScale(k,1))},_catchTransitionEnd:function(f){this._animatingZoom&&f.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(f,k,P){if(this._animatingZoom)return!0;if(P=P||{},!this._zoomAnimated||P.animate===!1||this._nothingToAnimate()||Math.abs(k-this._zoom)>this.options.zoomAnimationThreshold)return!1;var H=this.getZoomScale(k),J=this._getCenterOffset(f)._divideBy(1-1/H);return P.animate!==!0&&!this.getSize().contains(J)?!1:(V(function(){this._moveStart(!0,P.noMoveStart||!1)._animateZoom(f,k,!0)},this),!0)},_animateZoom:function(f,k,P,H){this._mapPane&&(P&&(this._animatingZoom=!0,this._animateToCenter=f,this._animateToZoom=k,zt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:f,zoom:k,noUpdate:H}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(s(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Ir(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function yi(f,k){return new Cr(f,k)}var ii=U.extend({options:{position:"topright"},initialize:function(f){S(this,f)},getPosition:function(){return this.options.position},setPosition:function(f){var k=this._map;return k&&k.removeControl(this),this.options.position=f,k&&k.addControl(this),this},getContainer:function(){return this._container},addTo:function(f){this.remove(),this._map=f;var k=this._container=this.onAdd(f),P=this.getPosition(),H=f._controlCorners[P];return zt(k,"leaflet-control"),P.indexOf("bottom")!==-1?H.insertBefore(k,H.firstChild):H.appendChild(k),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Dt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(f){this._map&&f&&f.screenX>0&&f.screenY>0&&this._map.getContainer().focus()}}),ba=function(f){return new ii(f)};Cr.include({addControl:function(f){return f.addTo(this),this},removeControl:function(f){return f.remove(),this},_initControlPos:function(){var f=this._controlCorners={},k="leaflet-",P=this._controlContainer=Ze("div",k+"control-container",this._container);function H(J,ce){var we=k+J+" "+k+ce;f[J+ce]=Ze("div",we,P)}H("top","left"),H("top","right"),H("bottom","left"),H("bottom","right")},_clearControlPos:function(){for(var f in this._controlCorners)Dt(this._controlCorners[f]);Dt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ql=ii.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(f,k,P,H){return P<H?-1:H<P?1:0}},initialize:function(f,k,P){S(this,P),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var H in f)this._addLayer(f[H],H);for(H in k)this._addLayer(k[H],H,!0)},onAdd:function(f){this._initLayout(),this._update(),this._map=f,f.on("zoomend",this._checkDisabledLayers,this);for(var k=0;k<this._layers.length;k++)this._layers[k].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(f){return ii.prototype.addTo.call(this,f),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var f=0;f<this._layers.length;f++)this._layers[f].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(f,k){return this._addLayer(f,k),this._map?this._update():this},addOverlay:function(f,k){return this._addLayer(f,k,!0),this._map?this._update():this},removeLayer:function(f){f.off("add remove",this._onLayerChange,this);var k=this._getLayer(l(f));return k&&this._layers.splice(this._layers.indexOf(k),1),this._map?this._update():this},expand:function(){zt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var f=this._map.getSize().y-(this._container.offsetTop+50);return f<this._section.clientHeight?(zt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=f+"px"):Ir(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Ir(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var f="leaflet-control-layers",k=this._container=Ze("div",f),P=this.options.collapsed;k.setAttribute("aria-haspopup",!0),Ou(k),Hl(k);var H=this._section=Ze("section",f+"-list");P&&(this._map.on("click",this.collapse,this),sr(k,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var J=this._layersLink=Ze("a",f+"-toggle",k);J.href="#",J.title="Layers",J.setAttribute("role","button"),sr(J,{keydown:function(ce){ce.keyCode===13&&this._expandSafely()},click:function(ce){fn(ce),this._expandSafely()}},this),P||this.expand(),this._baseLayersList=Ze("div",f+"-base",H),this._separator=Ze("div",f+"-separator",H),this._overlaysList=Ze("div",f+"-overlays",H),k.appendChild(H)},_getLayer:function(f){for(var k=0;k<this._layers.length;k++)if(this._layers[k]&&l(this._layers[k].layer)===f)return this._layers[k]},_addLayer:function(f,k,P){this._map&&f.on("add remove",this._onLayerChange,this),this._layers.push({layer:f,name:k,overlay:P}),this.options.sortLayers&&this._layers.sort(s(function(H,J){return this.options.sortFunction(H.layer,J.layer,H.name,J.name)},this)),this.options.autoZIndex&&f.setZIndex&&(this._lastZIndex++,f.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Nr(this._baseLayersList),Nr(this._overlaysList),this._layerControlInputs=[];var f,k,P,H,J=0;for(P=0;P<this._layers.length;P++)H=this._layers[P],this._addItem(H),k=k||H.overlay,f=f||!H.overlay,J+=H.overlay?0:1;return this.options.hideSingleBase&&(f=f&&J>1,this._baseLayersList.style.display=f?"":"none"),this._separator.style.display=k&&f?"":"none",this},_onLayerChange:function(f){this._handlingClick||this._update();var k=this._getLayer(l(f.target)),P=k.overlay?f.type==="add"?"overlayadd":"overlayremove":f.type==="add"?"baselayerchange":null;P&&this._map.fire(P,k)},_createRadioElement:function(f,k){var P='<input type="radio" class="leaflet-control-layers-selector" name="'+f+'"'+(k?' checked="checked"':"")+"/>",H=document.createElement("div");return H.innerHTML=P,H.firstChild},_addItem:function(f){var k=document.createElement("label"),P=this._map.hasLayer(f.layer),H;f.overlay?(H=document.createElement("input"),H.type="checkbox",H.className="leaflet-control-layers-selector",H.defaultChecked=P):H=this._createRadioElement("leaflet-base-layers_"+l(this),P),this._layerControlInputs.push(H),H.layerId=l(f.layer),sr(H,"click",this._onInputClick,this);var J=document.createElement("span");J.innerHTML=" "+f.name;var ce=document.createElement("span");k.appendChild(ce),ce.appendChild(H),ce.appendChild(J);var we=f.overlay?this._overlaysList:this._baseLayersList;return we.appendChild(k),this._checkDisabledLayers(),k},_onInputClick:function(){if(!this._preventClick){var f=this._layerControlInputs,k,P,H=[],J=[];this._handlingClick=!0;for(var ce=f.length-1;ce>=0;ce--)k=f[ce],P=this._getLayer(k.layerId).layer,k.checked?H.push(P):k.checked||J.push(P);for(ce=0;ce<J.length;ce++)this._map.hasLayer(J[ce])&&this._map.removeLayer(J[ce]);for(ce=0;ce<H.length;ce++)this._map.hasLayer(H[ce])||this._map.addLayer(H[ce]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var f=this._layerControlInputs,k,P,H=this._map.getZoom(),J=f.length-1;J>=0;J--)k=f[J],P=this._getLayer(k.layerId).layer,k.disabled=P.options.minZoom!==void 0&&H<P.options.minZoom||P.options.maxZoom!==void 0&&H>P.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var f=this._section;this._preventClick=!0,sr(f,"click",fn),this.expand();var k=this;setTimeout(function(){$r(f,"click",fn),k._preventClick=!1})}}),ul=function(f,k,P){return new ql(f,k,P)},xi=ii.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(f){var k="leaflet-control-zoom",P=Ze("div",k+" leaflet-bar"),H=this.options;return this._zoomInButton=this._createButton(H.zoomInText,H.zoomInTitle,k+"-in",P,this._zoomIn),this._zoomOutButton=this._createButton(H.zoomOutText,H.zoomOutTitle,k+"-out",P,this._zoomOut),this._updateDisabled(),f.on("zoomend zoomlevelschange",this._updateDisabled,this),P},onRemove:function(f){f.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(f){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(f.shiftKey?3:1))},_zoomOut:function(f){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(f.shiftKey?3:1))},_createButton:function(f,k,P,H,J){var ce=Ze("a",P,H);return ce.innerHTML=f,ce.href="#",ce.title=k,ce.setAttribute("role","button"),ce.setAttribute("aria-label",k),Ou(ce),sr(ce,"click",Fn),sr(ce,"click",J,this),sr(ce,"click",this._refocusOnMap,this),ce},_updateDisabled:function(){var f=this._map,k="leaflet-disabled";Ir(this._zoomInButton,k),Ir(this._zoomOutButton,k),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||f._zoom===f.getMinZoom())&&(zt(this._zoomOutButton,k),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||f._zoom===f.getMaxZoom())&&(zt(this._zoomInButton,k),this._zoomInButton.setAttribute("aria-disabled","true"))}});Cr.mergeOptions({zoomControl:!0}),Cr.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new xi,this.addControl(this.zoomControl))});var wa=function(f){return new xi(f)},Bn=ii.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(f){var k="leaflet-control-scale",P=Ze("div",k),H=this.options;return this._addScales(H,k+"-line",P),f.on(H.updateWhenIdle?"moveend":"move",this._update,this),f.whenReady(this._update,this),P},onRemove:function(f){f.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(f,k,P){f.metric&&(this._mScale=Ze("div",k,P)),f.imperial&&(this._iScale=Ze("div",k,P))},_update:function(){var f=this._map,k=f.getSize().y/2,P=f.distance(f.containerPointToLatLng([0,k]),f.containerPointToLatLng([this.options.maxWidth,k]));this._updateScales(P)},_updateScales:function(f){this.options.metric&&f&&this._updateMetric(f),this.options.imperial&&f&&this._updateImperial(f)},_updateMetric:function(f){var k=this._getRoundNum(f),P=k<1e3?k+" m":k/1e3+" km";this._updateScale(this._mScale,P,k/f)},_updateImperial:function(f){var k=f*3.2808399,P,H,J;k>5280?(P=k/5280,H=this._getRoundNum(P),this._updateScale(this._iScale,H+" mi",H/P)):(J=this._getRoundNum(k),this._updateScale(this._iScale,J+" ft",J/k))},_updateScale:function(f,k,P){f.style.width=Math.round(this.options.maxWidth*P)+"px",f.innerHTML=k},_getRoundNum:function(f){var k=Math.pow(10,(Math.floor(f)+"").length-1),P=f/k;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:1,k*P}}),Xi=function(f){return new Bn(f)},ps='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Sa=ii.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Et.inlineSvg?ps+" ":"")+"Leaflet</a>"},initialize:function(f){S(this,f),this._attributions={}},onAdd:function(f){f.attributionControl=this,this._container=Ze("div","leaflet-control-attribution"),Ou(this._container);for(var k in f._layers)f._layers[k].getAttribution&&this.addAttribution(f._layers[k].getAttribution());return this._update(),f.on("layeradd",this._addAttribution,this),this._container},onRemove:function(f){f.off("layeradd",this._addAttribution,this)},_addAttribution:function(f){f.layer.getAttribution&&(this.addAttribution(f.layer.getAttribution()),f.layer.once("remove",function(){this.removeAttribution(f.layer.getAttribution())},this))},setPrefix:function(f){return this.options.prefix=f,this._update(),this},addAttribution:function(f){return f?(this._attributions[f]||(this._attributions[f]=0),this._attributions[f]++,this._update(),this):this},removeAttribution:function(f){return f?(this._attributions[f]&&(this._attributions[f]--,this._update()),this):this},_update:function(){if(this._map){var f=[];for(var k in this._attributions)this._attributions[k]&&f.push(k);var P=[];this.options.prefix&&P.push(this.options.prefix),f.length&&P.push(f.join(", ")),this._container.innerHTML=P.join(' <span aria-hidden="true">|</span> ')}}});Cr.mergeOptions({attributionControl:!0}),Cr.addInitHook(function(){this.options.attributionControl&&new Sa().addTo(this)});var Of=function(f){return new Sa(f)};ii.Layers=ql,ii.Zoom=xi,ii.Scale=Bn,ii.Attribution=Sa,ba.layers=ul,ba.zoom=wa,ba.scale=Xi,ba.attribution=Of;var Qi=U.extend({initialize:function(f){this._map=f},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Qi.addTo=function(f,k){return f.addHandler(k,this),this};var ju={Events:Z},ai=Et.touch?"touchstart mousedown":"mousedown",_n=K.extend({options:{clickTolerance:3},initialize:function(f,k,P,H){S(this,H),this._element=f,this._dragStartTarget=k||f,this._preventOutline=P},enable:function(){this._enabled||(sr(this._dragStartTarget,ai,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(_n._dragging===this&&this.finishDrag(!0),$r(this._dragStartTarget,ai,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(f){if(this._enabled&&(this._moved=!1,!vi(this._element,"leaflet-zoom-anim"))){if(f.touches&&f.touches.length!==1){_n._dragging===this&&this.finishDrag();return}if(!(_n._dragging||f.shiftKey||f.which!==1&&f.button!==1&&!f.touches)&&(_n._dragging=this,this._preventOutline&&To(this._element),Cc(),xr(),!this._moving)){this.fire("down");var k=f.touches?f.touches[0]:f,P=so(this._element);this._startPoint=new Q(k.clientX,k.clientY),this._startPos=io(this._element),this._parentScale=$a(P);var H=f.type==="mousedown";sr(document,H?"mousemove":"touchmove",this._onMove,this),sr(document,H?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(f){if(this._enabled){if(f.touches&&f.touches.length>1){this._moved=!0;return}var k=f.touches&&f.touches.length===1?f.touches[0]:f,P=new Q(k.clientX,k.clientY)._subtract(this._startPoint);!P.x&&!P.y||Math.abs(P.x)+Math.abs(P.y)<this.options.clickTolerance||(P.x/=this._parentScale.x,P.y/=this._parentScale.y,fn(f),this._moved||(this.fire("dragstart"),this._moved=!0,zt(document.body,"leaflet-dragging"),this._lastTarget=f.target||f.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),zt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(P),this._moving=!0,this._lastEvent=f,this._updatePosition())}},_updatePosition:function(){var f={originalEvent:this._lastEvent};this.fire("predrag",f),yn(this._element,this._newPos),this.fire("drag",f)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(f){Ir(document.body,"leaflet-dragging"),this._lastTarget&&(Ir(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),$r(document,"mousemove touchmove",this._onMove,this),$r(document,"mouseup touchend touchcancel",this._onUp,this),Ec(),ao();var k=this._moved&&this._moving;this._moving=!1,_n._dragging=!1,k&&this.fire("dragend",{noInertia:f,distance:this._newPos.distanceTo(this._startPos)})}});function tn(f,k,P){var H,J=[1,4,2,8],ce,we,Me,Ie,Je,Tt,Xt,hr;for(ce=0,Tt=f.length;ce<Tt;ce++)f[ce]._code=Is(f[ce],k);for(Me=0;Me<4;Me++){for(Xt=J[Me],H=[],ce=0,Tt=f.length,we=Tt-1;ce<Tt;we=ce++)Ie=f[ce],Je=f[we],Ie._code&Xt?Je._code&Xt||(hr=Pc(Je,Ie,Xt,k,P),hr._code=Is(hr,k),H.push(hr)):(Je._code&Xt&&(hr=Pc(Je,Ie,Xt,k,P),hr._code=Is(hr,k),H.push(hr)),H.push(Ie));f=H}return f}function $l(f,k){var P,H,J,ce,we,Me,Ie,Je,Tt;if(!f||f.length===0)throw new Error("latlngs not passed");Bi(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var Xt=fe([0,0]),hr=oe(f),Zr=hr.getNorthWest().distanceTo(hr.getSouthWest())*hr.getNorthEast().distanceTo(hr.getNorthWest());Zr<1700&&(Xt=ka(f));var Gn=f.length,Ai=[];for(P=0;P<Gn;P++){var zi=fe(f[P]);Ai.push(k.project(fe([zi.lat-Xt.lat,zi.lng-Xt.lng])))}for(Me=Ie=Je=0,P=0,H=Gn-1;P<Gn;H=P++)J=Ai[P],ce=Ai[H],we=J.y*ce.x-ce.y*J.x,Ie+=(J.x+ce.x)*we,Je+=(J.y+ce.y)*we,Me+=we*3;Me===0?Tt=Ai[0]:Tt=[Ie/Me,Je/Me];var yl=k.unproject(te(Tt));return fe([yl.lat+Xt.lat,yl.lng+Xt.lng])}function ka(f){for(var k=0,P=0,H=0,J=0;J<f.length;J++){var ce=fe(f[J]);k+=ce.lat,P+=ce.lng,H++}return fe([k/H,P/H])}var Df={__proto__:null,clipPolygon:tn,polygonCenter:$l,centroid:ka};function Fu(f,k){if(!k||!f.length)return f.slice();var P=k*k;return f=jf(f,P),f=If(f,P),f}function Tc(f,k,P){return Math.sqrt(ms(f,k,P,!0))}function vh(f,k,P){return ms(f,k,P)}function If(f,k){var P=f.length,H=typeof Uint8Array<"u"?Uint8Array:Array,J=new H(P);J[0]=J[P-1]=1,Kl(f,J,k,0,P-1);var ce,we=[];for(ce=0;ce<P;ce++)J[ce]&&we.push(f[ce]);return we}function Kl(f,k,P,H,J){var ce=0,we,Me,Ie;for(Me=H+1;Me<=J-1;Me++)Ie=ms(f[Me],f[H],f[J],!0),Ie>ce&&(we=Me,ce=Ie);ce>P&&(k[we]=1,Kl(f,k,P,H,we),Kl(f,k,P,we,J))}function jf(f,k){for(var P=[f[0]],H=1,J=0,ce=f.length;H<ce;H++)ym(f[H],f[J])>k&&(P.push(f[H]),J=H);return J<ce-1&&P.push(f[ce-1]),P}var Po;function Nc(f,k,P,H,J){var ce=H?Po:Is(f,P),we=Is(k,P),Me,Ie,Je;for(Po=we;;){if(!(ce|we))return[f,k];if(ce&we)return!1;Me=ce||we,Ie=Pc(f,k,Me,P,J),Je=Is(Ie,P),Me===ce?(f=Ie,ce=Je):(k=Ie,we=Je)}}function Pc(f,k,P,H,J){var ce=k.x-f.x,we=k.y-f.y,Me=H.min,Ie=H.max,Je,Tt;return P&8?(Je=f.x+ce*(Ie.y-f.y)/we,Tt=Ie.y):P&4?(Je=f.x+ce*(Me.y-f.y)/we,Tt=Me.y):P&2?(Je=Ie.x,Tt=f.y+we*(Ie.x-f.x)/ce):P&1&&(Je=Me.x,Tt=f.y+we*(Me.x-f.x)/ce),new Q(Je,Tt,J)}function Is(f,k){var P=0;return f.x<k.min.x?P|=1:f.x>k.max.x&&(P|=2),f.y<k.min.y?P|=4:f.y>k.max.y&&(P|=8),P}function ym(f,k){var P=k.x-f.x,H=k.y-f.y;return P*P+H*H}function ms(f,k,P,H){var J=k.x,ce=k.y,we=P.x-J,Me=P.y-ce,Ie=we*we+Me*Me,Je;return Ie>0&&(Je=((f.x-J)*we+(f.y-ce)*Me)/Ie,Je>1?(J=P.x,ce=P.y):Je>0&&(J+=we*Je,ce+=Me*Je)),we=f.x-J,Me=f.y-ce,H?we*we+Me*Me:new Q(J,ce)}function Bi(f){return!T(f[0])||typeof f[0][0]!="object"&&typeof f[0][0]<"u"}function yh(f){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Bi(f)}function xh(f,k){var P,H,J,ce,we,Me,Ie,Je;if(!f||f.length===0)throw new Error("latlngs not passed");Bi(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var Tt=fe([0,0]),Xt=oe(f),hr=Xt.getNorthWest().distanceTo(Xt.getSouthWest())*Xt.getNorthEast().distanceTo(Xt.getNorthWest());hr<1700&&(Tt=ka(f));var Zr=f.length,Gn=[];for(P=0;P<Zr;P++){var Ai=fe(f[P]);Gn.push(k.project(fe([Ai.lat-Tt.lat,Ai.lng-Tt.lng])))}for(P=0,H=0;P<Zr-1;P++)H+=Gn[P].distanceTo(Gn[P+1])/2;if(H===0)Je=Gn[0];else for(P=0,ce=0;P<Zr-1;P++)if(we=Gn[P],Me=Gn[P+1],J=we.distanceTo(Me),ce+=J,ce>H){Ie=(ce-H)/J,Je=[Me.x-Ie*(Me.x-we.x),Me.y-Ie*(Me.y-we.y)];break}var zi=k.unproject(te(Je));return fe([zi.lat+Tt.lat,zi.lng+Tt.lng])}var cl={__proto__:null,simplify:Fu,pointToSegmentDistance:Tc,closestPointOnSegment:vh,clipSegment:Nc,_getEdgeIntersection:Pc,_getBitCode:Is,_sqClosestPointOnSegment:ms,isFlat:Bi,_flat:yh,polylineCenter:xh},Mc={project:function(f){return new Q(f.lng,f.lat)},unproject:function(f){return new se(f.y,f.x)},bounds:new X([-180,-90],[180,90])},Zl={R:6378137,R_MINOR:6356752314245179e-9,bounds:new X([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(f){var k=Math.PI/180,P=this.R,H=f.lat*k,J=this.R_MINOR/P,ce=Math.sqrt(1-J*J),we=ce*Math.sin(H),Me=Math.tan(Math.PI/4-H/2)/Math.pow((1-we)/(1+we),ce/2);return H=-P*Math.log(Math.max(Me,1e-10)),new Q(f.lng*k*P,H)},unproject:function(f){for(var k=180/Math.PI,P=this.R,H=this.R_MINOR/P,J=Math.sqrt(1-H*H),ce=Math.exp(-f.y/P),we=Math.PI/2-2*Math.atan(ce),Me=0,Ie=.1,Je;Me<15&&Math.abs(Ie)>1e-7;Me++)Je=J*Math.sin(we),Je=Math.pow((1-Je)/(1+Je),J/2),Ie=Math.PI/2-2*Math.atan(ce*Je)-we,we+=Ie;return new se(we*k,f.x*k/P)}},Ac={__proto__:null,LonLat:Mc,Mercator:Zl,SphericalMercator:ve},Yl=i({},pe,{code:"EPSG:3395",projection:Zl,transformation:(function(){var f=.5/(Math.PI*Zl.R);return xe(f,.5,-f,.5)})()}),Lc=i({},pe,{code:"EPSG:4326",projection:Mc,transformation:xe(1/180,1,-1/180,.5)}),bh=i({},ae,{projection:Mc,transformation:xe(1,0,-1,0),scale:function(f){return Math.pow(2,f)},zoom:function(f){return Math.log(f)/Math.LN2},distance:function(f,k){var P=k.lng-f.lng,H=k.lat-f.lat;return Math.sqrt(P*P+H*H)},infinite:!0});ae.Earth=pe,ae.EPSG3395=Yl,ae.EPSG3857=Se,ae.EPSG900913=Oe,ae.EPSG4326=Lc,ae.Simple=bh;var Ka=K.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(f){return f.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(f){return f&&f.removeLayer(this),this},getPane:function(f){return this._map.getPane(f?this.options[f]||f:this.options.pane)},addInteractiveTarget:function(f){return this._map._targets[l(f)]=this,this},removeInteractiveTarget:function(f){return delete this._map._targets[l(f)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(f){var k=f.target;if(k.hasLayer(this)){if(this._map=k,this._zoomAnimated=k._zoomAnimated,this.getEvents){var P=this.getEvents();k.on(P,this),this.once("remove",function(){k.off(P,this)},this)}this.onAdd(k),this.fire("add"),k.fire("layeradd",{layer:this})}}});Cr.include({addLayer:function(f){if(!f._layerAdd)throw new Error("The provided object is not a Layer.");var k=l(f);return this._layers[k]?this:(this._layers[k]=f,f._mapToAdd=this,f.beforeAdd&&f.beforeAdd(this),this.whenReady(f._layerAdd,f),this)},removeLayer:function(f){var k=l(f);return this._layers[k]?(this._loaded&&f.onRemove(this),delete this._layers[k],this._loaded&&(this.fire("layerremove",{layer:f}),f.fire("remove")),f._map=f._mapToAdd=null,this):this},hasLayer:function(f){return l(f)in this._layers},eachLayer:function(f,k){for(var P in this._layers)f.call(k,this._layers[P]);return this},_addLayers:function(f){f=f?T(f)?f:[f]:[];for(var k=0,P=f.length;k<P;k++)this.addLayer(f[k])},_addZoomLimit:function(f){(!isNaN(f.options.maxZoom)||!isNaN(f.options.minZoom))&&(this._zoomBoundLayers[l(f)]=f,this._updateZoomLevels())},_removeZoomLimit:function(f){var k=l(f);this._zoomBoundLayers[k]&&(delete this._zoomBoundLayers[k],this._updateZoomLevels())},_updateZoomLevels:function(){var f=1/0,k=-1/0,P=this._getZoomSpan();for(var H in this._zoomBoundLayers){var J=this._zoomBoundLayers[H].options;f=J.minZoom===void 0?f:Math.min(f,J.minZoom),k=J.maxZoom===void 0?k:Math.max(k,J.maxZoom)}this._layersMaxZoom=k===-1/0?void 0:k,this._layersMinZoom=f===1/0?void 0:f,P!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var js=Ka.extend({initialize:function(f,k){S(this,k),this._layers={};var P,H;if(f)for(P=0,H=f.length;P<H;P++)this.addLayer(f[P])},addLayer:function(f){var k=this.getLayerId(f);return this._layers[k]=f,this._map&&this._map.addLayer(f),this},removeLayer:function(f){var k=f in this._layers?f:this.getLayerId(f);return this._map&&this._layers[k]&&this._map.removeLayer(this._layers[k]),delete this._layers[k],this},hasLayer:function(f){var k=typeof f=="number"?f:this.getLayerId(f);return k in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(f){var k=Array.prototype.slice.call(arguments,1),P,H;for(P in this._layers)H=this._layers[P],H[f]&&H[f].apply(H,k);return this},onAdd:function(f){this.eachLayer(f.addLayer,f)},onRemove:function(f){this.eachLayer(f.removeLayer,f)},eachLayer:function(f,k){for(var P in this._layers)f.call(k,this._layers[P]);return this},getLayer:function(f){return this._layers[f]},getLayers:function(){var f=[];return this.eachLayer(f.push,f),f},setZIndex:function(f){return this.invoke("setZIndex",f)},getLayerId:function(f){return l(f)}}),dl=function(f,k){return new js(f,k)},Ji=js.extend({addLayer:function(f){return this.hasLayer(f)?this:(f.addEventParent(this),js.prototype.addLayer.call(this,f),this.fire("layeradd",{layer:f}))},removeLayer:function(f){return this.hasLayer(f)?(f in this._layers&&(f=this._layers[f]),f.removeEventParent(this),js.prototype.removeLayer.call(this,f),this.fire("layerremove",{layer:f})):this},setStyle:function(f){return this.invoke("setStyle",f)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var f=new he;for(var k in this._layers){var P=this._layers[k];f.extend(P.getBounds?P.getBounds():P.getLatLng())}return f}}),_a=function(f,k){return new Ji(f,k)},Ca=U.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(f){S(this,f)},createIcon:function(f){return this._createIcon("icon",f)},createShadow:function(f){return this._createIcon("shadow",f)},_createIcon:function(f,k){var P=this._getIconUrl(f);if(!P){if(f==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var H=this._createImg(P,k&&k.tagName==="IMG"?k:null);return this._setIconStyles(H,f),(this.options.crossOrigin||this.options.crossOrigin==="")&&(H.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),H},_setIconStyles:function(f,k){var P=this.options,H=P[k+"Size"];typeof H=="number"&&(H=[H,H]);var J=te(H),ce=te(k==="shadow"&&P.shadowAnchor||P.iconAnchor||J&&J.divideBy(2,!0));f.className="leaflet-marker-"+k+" "+(P.className||""),ce&&(f.style.marginLeft=-ce.x+"px",f.style.marginTop=-ce.y+"px"),J&&(f.style.width=J.x+"px",f.style.height=J.y+"px")},_createImg:function(f,k){return k=k||document.createElement("img"),k.src=f,k},_getIconUrl:function(f){return Et.retina&&this.options[f+"RetinaUrl"]||this.options[f+"Url"]}});function Rc(f){return new Ca(f)}var hl=Ca.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(f){return typeof hl.imagePath!="string"&&(hl.imagePath=this._detectIconPath()),(this.options.imagePath||hl.imagePath)+Ca.prototype._getIconUrl.call(this,f)},_stripUrl:function(f){var k=function(P,H,J){var ce=H.exec(P);return ce&&ce[J]};return f=k(f,/^url\((['"])?(.+)\1\)$/,2),f&&k(f,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var f=Ze("div","leaflet-default-icon-path",document.body),k=pt(f,"background-image")||pt(f,"backgroundImage");if(document.body.removeChild(f),k=this._stripUrl(k),k)return k;var P=document.querySelector('link[href$="leaflet.css"]');return P?P.href.substring(0,P.href.length-11-1):""}}),Za=Qi.extend({initialize:function(f){this._marker=f},addHooks:function(){var f=this._marker._icon;this._draggable||(this._draggable=new _n(f,f,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),zt(f,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Ir(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(f){var k=this._marker,P=k._map,H=this._marker.options.autoPanSpeed,J=this._marker.options.autoPanPadding,ce=io(k._icon),we=P.getPixelBounds(),Me=P.getPixelOrigin(),Ie=re(we.min._subtract(Me).add(J),we.max._subtract(Me).subtract(J));if(!Ie.contains(ce)){var Je=te((Math.max(Ie.max.x,ce.x)-Ie.max.x)/(we.max.x-Ie.max.x)-(Math.min(Ie.min.x,ce.x)-Ie.min.x)/(we.min.x-Ie.min.x),(Math.max(Ie.max.y,ce.y)-Ie.max.y)/(we.max.y-Ie.max.y)-(Math.min(Ie.min.y,ce.y)-Ie.min.y)/(we.min.y-Ie.min.y)).multiplyBy(H);P.panBy(Je,{animate:!1}),this._draggable._newPos._add(Je),this._draggable._startPos._add(Je),yn(k._icon,this._draggable._newPos),this._onDrag(f),this._panRequest=V(this._adjustPan.bind(this,f))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(f){this._marker.options.autoPan&&(q(this._panRequest),this._panRequest=V(this._adjustPan.bind(this,f)))},_onDrag:function(f){var k=this._marker,P=k._shadow,H=io(k._icon),J=k._map.layerPointToLatLng(H);P&&yn(P,H),k._latlng=J,f.latlng=J,f.oldLatLng=this._oldLatLng,k.fire("move",f).fire("drag",f)},_onDragEnd:function(f){q(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",f)}}),Pi=Ka.extend({options:{icon:new hl,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(f,k){S(this,k),this._latlng=fe(f)},onAdd:function(f){this._zoomAnimated=this._zoomAnimated&&f.options.markerZoomAnimation,this._zoomAnimated&&f.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(f){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&f.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(f){var k=this._latlng;return this._latlng=fe(f),this.update(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},setZIndexOffset:function(f){return this.options.zIndexOffset=f,this.update()},getIcon:function(){return this.options.icon},setIcon:function(f){return this.options.icon=f,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var f=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(f)}return this},_initIcon:function(){var f=this.options,k="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),P=f.icon.createIcon(this._icon),H=!1;P!==this._icon&&(this._icon&&this._removeIcon(),H=!0,f.title&&(P.title=f.title),P.tagName==="IMG"&&(P.alt=f.alt||"")),zt(P,k),f.keyboard&&(P.tabIndex="0",P.setAttribute("role","button")),this._icon=P,f.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&sr(P,"focus",this._panOnFocus,this);var J=f.icon.createShadow(this._shadow),ce=!1;J!==this._shadow&&(this._removeShadow(),ce=!0),J&&(zt(J,k),J.alt=""),this._shadow=J,f.opacity<1&&this._updateOpacity(),H&&this.getPane().appendChild(this._icon),this._initInteraction(),J&&ce&&this.getPane(f.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&$r(this._icon,"focus",this._panOnFocus,this),Dt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Dt(this._shadow),this._shadow=null},_setPos:function(f){this._icon&&yn(this._icon,f),this._shadow&&yn(this._shadow,f),this._zIndex=f.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(f){this._icon&&(this._icon.style.zIndex=this._zIndex+f)},_animateZoom:function(f){var k=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center).round();this._setPos(k)},_initInteraction:function(){if(this.options.interactive&&(zt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Za)){var f=this.options.draggable;this.dragging&&(f=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Za(this),f&&this.dragging.enable()}},setOpacity:function(f){return this.options.opacity=f,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var f=this.options.opacity;this._icon&&tr(this._icon,f),this._shadow&&tr(this._shadow,f)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var f=this._map;if(f){var k=this.options.icon.options,P=k.iconSize?te(k.iconSize):te(0,0),H=k.iconAnchor?te(k.iconAnchor):te(0,0);f.panInside(this._latlng,{paddingTopLeft:H,paddingBottomRight:P.subtract(H)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function wh(f,k){return new Pi(f,k)}var oo=Ka.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(f){this._renderer=f.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(f){return S(this,f),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&f&&Object.prototype.hasOwnProperty.call(f,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Ya=oo.extend({options:{fill:!0,radius:10},initialize:function(f,k){S(this,k),this._latlng=fe(f),this._radius=this.options.radius},setLatLng:function(f){var k=this._latlng;return this._latlng=fe(f),this.redraw(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(f){return this.options.radius=this._radius=f,this.redraw()},getRadius:function(){return this._radius},setStyle:function(f){var k=f&&f.radius||this._radius;return oo.prototype.setStyle.call(this,f),this.setRadius(k),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var f=this._radius,k=this._radiusY||f,P=this._clickTolerance(),H=[f+P,k+P];this._pxBounds=new X(this._point.subtract(H),this._point.add(H))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(f){return f.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function lo(f,k){return new Ya(f,k)}var fl=Ya.extend({initialize:function(f,k,P){if(typeof k=="number"&&(k=i({},P,{radius:k})),S(this,k),this._latlng=fe(f),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(f){return this._mRadius=f,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var f=[this._radius,this._radiusY||this._radius];return new he(this._map.layerPointToLatLng(this._point.subtract(f)),this._map.layerPointToLatLng(this._point.add(f)))},setStyle:oo.prototype.setStyle,_project:function(){var f=this._latlng.lng,k=this._latlng.lat,P=this._map,H=P.options.crs;if(H.distance===pe.distance){var J=Math.PI/180,ce=this._mRadius/pe.R/J,we=P.project([k+ce,f]),Me=P.project([k-ce,f]),Ie=we.add(Me).divideBy(2),Je=P.unproject(Ie).lat,Tt=Math.acos((Math.cos(ce*J)-Math.sin(k*J)*Math.sin(Je*J))/(Math.cos(k*J)*Math.cos(Je*J)))/J;(isNaN(Tt)||Tt===0)&&(Tt=ce/Math.cos(Math.PI/180*k)),this._point=Ie.subtract(P.getPixelOrigin()),this._radius=isNaN(Tt)?0:Ie.x-P.project([Je,f-Tt]).x,this._radiusY=Ie.y-we.y}else{var Xt=H.unproject(H.project(this._latlng).subtract([this._mRadius,0]));this._point=P.latLngToLayerPoint(this._latlng),this._radius=this._point.x-P.latLngToLayerPoint(Xt).x}this._updateBounds()}});function Xl(f,k,P){return new fl(f,k,P)}var Mi=oo.extend({options:{smoothFactor:1,noClip:!1},initialize:function(f,k){S(this,k),this._setLatLngs(f)},getLatLngs:function(){return this._latlngs},setLatLngs:function(f){return this._setLatLngs(f),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(f){for(var k=1/0,P=null,H=ms,J,ce,we=0,Me=this._parts.length;we<Me;we++)for(var Ie=this._parts[we],Je=1,Tt=Ie.length;Je<Tt;Je++){J=Ie[Je-1],ce=Ie[Je];var Xt=H(f,J,ce,!0);Xt<k&&(k=Xt,P=H(f,J,ce))}return P&&(P.distance=Math.sqrt(k)),P},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return xh(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(f,k){return k=k||this._defaultShape(),f=fe(f),k.push(f),this._bounds.extend(f),this.redraw()},_setLatLngs:function(f){this._bounds=new he,this._latlngs=this._convertLatLngs(f)},_defaultShape:function(){return Bi(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(f){for(var k=[],P=Bi(f),H=0,J=f.length;H<J;H++)P?(k[H]=fe(f[H]),this._bounds.extend(k[H])):k[H]=this._convertLatLngs(f[H]);return k},_project:function(){var f=new X;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,f),this._bounds.isValid()&&f.isValid()&&(this._rawPxBounds=f,this._updateBounds())},_updateBounds:function(){var f=this._clickTolerance(),k=new Q(f,f);this._rawPxBounds&&(this._pxBounds=new X([this._rawPxBounds.min.subtract(k),this._rawPxBounds.max.add(k)]))},_projectLatlngs:function(f,k,P){var H=f[0]instanceof se,J=f.length,ce,we;if(H){for(we=[],ce=0;ce<J;ce++)we[ce]=this._map.latLngToLayerPoint(f[ce]),P.extend(we[ce]);k.push(we)}else for(ce=0;ce<J;ce++)this._projectLatlngs(f[ce],k,P)},_clipPoints:function(){var f=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(f))){if(this.options.noClip){this._parts=this._rings;return}var k=this._parts,P,H,J,ce,we,Me,Ie;for(P=0,J=0,ce=this._rings.length;P<ce;P++)for(Ie=this._rings[P],H=0,we=Ie.length;H<we-1;H++)Me=Nc(Ie[H],Ie[H+1],f,H,!0),Me&&(k[J]=k[J]||[],k[J].push(Me[0]),(Me[1]!==Ie[H+1]||H===we-2)&&(k[J].push(Me[1]),J++))}},_simplifyPoints:function(){for(var f=this._parts,k=this.options.smoothFactor,P=0,H=f.length;P<H;P++)f[P]=Fu(f[P],k)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(f,k){var P,H,J,ce,we,Me,Ie=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(P=0,ce=this._parts.length;P<ce;P++)for(Me=this._parts[P],H=0,we=Me.length,J=we-1;H<we;J=H++)if(!(!k&&H===0)&&Tc(f,Me[J],Me[H])<=Ie)return!0;return!1}});function Ff(f,k){return new Mi(f,k)}Mi._flat=yh;var Ea=Mi.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return $l(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(f){var k=Mi.prototype._convertLatLngs.call(this,f),P=k.length;return P>=2&&k[0]instanceof se&&k[0].equals(k[P-1])&&k.pop(),k},_setLatLngs:function(f){Mi.prototype._setLatLngs.call(this,f),Bi(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Bi(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var f=this._renderer._bounds,k=this.options.weight,P=new Q(k,k);if(f=new X(f.min.subtract(P),f.max.add(P)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(f))){if(this.options.noClip){this._parts=this._rings;return}for(var H=0,J=this._rings.length,ce;H<J;H++)ce=tn(this._rings[H],f,!0),ce.length&&this._parts.push(ce)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(f){var k=!1,P,H,J,ce,we,Me,Ie,Je;if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(ce=0,Ie=this._parts.length;ce<Ie;ce++)for(P=this._parts[ce],we=0,Je=P.length,Me=Je-1;we<Je;Me=we++)H=P[we],J=P[Me],H.y>f.y!=J.y>f.y&&f.x<(J.x-H.x)*(f.y-H.y)/(J.y-H.y)+H.x&&(k=!k);return k||Mi.prototype._containsPoint.call(this,f,!0)}});function Xa(f,k){return new Ea(f,k)}var ea=Ji.extend({initialize:function(f,k){S(this,k),this._layers={},f&&this.addData(f)},addData:function(f){var k=T(f)?f:f.features,P,H,J;if(k){for(P=0,H=k.length;P<H;P++)J=k[P],(J.geometries||J.geometry||J.features||J.coordinates)&&this.addData(J);return this}var ce=this.options;if(ce.filter&&!ce.filter(f))return this;var we=gs(f,ce);return we?(we.feature=pl(f),we.defaultOptions=we.options,this.resetStyle(we),ce.onEachFeature&&ce.onEachFeature(f,we),this.addLayer(we)):this},resetStyle:function(f){return f===void 0?this.eachLayer(this.resetStyle,this):(f.options=i({},f.defaultOptions),this._setLayerStyle(f,this.options.style),this)},setStyle:function(f){return this.eachLayer(function(k){this._setLayerStyle(k,f)},this)},_setLayerStyle:function(f,k){f.setStyle&&(typeof k=="function"&&(k=k(f.feature)),f.setStyle(k))}});function gs(f,k){var P=f.type==="Feature"?f.geometry:f,H=P?P.coordinates:null,J=[],ce=k&&k.pointToLayer,we=k&&k.coordsToLatLng||Ql,Me,Ie,Je,Tt;if(!H&&!P)return null;switch(P.type){case"Point":return Me=we(H),Ta(ce,f,Me,k);case"MultiPoint":for(Je=0,Tt=H.length;Je<Tt;Je++)Me=we(H[Je]),J.push(Ta(ce,f,Me,k));return new Ji(J);case"LineString":case"MultiLineString":return Ie=Fs(H,P.type==="LineString"?0:1,we),new Mi(Ie,k);case"Polygon":case"MultiPolygon":return Ie=Fs(H,P.type==="Polygon"?1:2,we),new Ea(Ie,k);case"GeometryCollection":for(Je=0,Tt=P.geometries.length;Je<Tt;Je++){var Xt=gs({geometry:P.geometries[Je],type:"Feature",properties:f.properties},k);Xt&&J.push(Xt)}return new Ji(J);case"FeatureCollection":for(Je=0,Tt=P.features.length;Je<Tt;Je++){var hr=gs(P.features[Je],k);hr&&J.push(hr)}return new Ji(J);default:throw new Error("Invalid GeoJSON object.")}}function Ta(f,k,P,H){return f?f(k,P):new Pi(P,H&&H.markersInheritOptions&&H)}function Ql(f){return new se(f[1],f[0],f[2])}function Fs(f,k,P){for(var H=[],J=0,ce=f.length,we;J<ce;J++)we=k?Fs(f[J],k-1,P):(P||Ql)(f[J]),H.push(we);return H}function Bu(f,k){return f=fe(f),f.alt!==void 0?[p(f.lng,k),p(f.lat,k),p(f.alt,k)]:[p(f.lng,k),p(f.lat,k)]}function Jl(f,k,P,H){for(var J=[],ce=0,we=f.length;ce<we;ce++)J.push(k?Jl(f[ce],Bi(f[ce])?0:k-1,P,H):Bu(f[ce],H));return!k&&P&&J.length>0&&J.push(J[0].slice()),J}function Hr(f,k){return f.feature?i({},f.feature,{geometry:k}):pl(k)}function pl(f){return f.type==="Feature"||f.type==="FeatureCollection"?f:{type:"Feature",properties:{},geometry:f}}var zu={toGeoJSON:function(f){return Hr(this,{type:"Point",coordinates:Bu(this.getLatLng(),f)})}};Pi.include(zu),fl.include(zu),Ya.include(zu),Mi.include({toGeoJSON:function(f){var k=!Bi(this._latlngs),P=Jl(this._latlngs,k?1:0,!1,f);return Hr(this,{type:(k?"Multi":"")+"LineString",coordinates:P})}}),Ea.include({toGeoJSON:function(f){var k=!Bi(this._latlngs),P=k&&!Bi(this._latlngs[0]),H=Jl(this._latlngs,P?2:k?1:0,!0,f);return k||(H=[H]),Hr(this,{type:(P?"Multi":"")+"Polygon",coordinates:H})}}),js.include({toMultiPoint:function(f){var k=[];return this.eachLayer(function(P){k.push(P.toGeoJSON(f).geometry.coordinates)}),Hr(this,{type:"MultiPoint",coordinates:k})},toGeoJSON:function(f){var k=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(k==="MultiPoint")return this.toMultiPoint(f);var P=k==="GeometryCollection",H=[];return this.eachLayer(function(J){if(J.toGeoJSON){var ce=J.toGeoJSON(f);if(P)H.push(ce.geometry);else{var we=pl(ce);we.type==="FeatureCollection"?H.push.apply(H,we.features):H.push(we)}}}),P?Hr(this,{geometries:H,type:"GeometryCollection"}):{type:"FeatureCollection",features:H}}});function Oc(f,k){return new ea(f,k)}var ta=Oc,Bs=Ka.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(f,k,P){this._url=f,this._bounds=oe(k),S(this,P)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(zt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Dt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(f){return this.options.opacity=f,this._image&&this._updateOpacity(),this},setStyle:function(f){return f.opacity&&this.setOpacity(f.opacity),this},bringToFront:function(){return this._map&&Pr(this._image),this},bringToBack:function(){return this._map&&Fr(this._image),this},setUrl:function(f){return this._url=f,this._image&&(this._image.src=f),this},setBounds:function(f){return this._bounds=oe(f),this._map&&this._reset(),this},getEvents:function(){var f={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var f=this._url.tagName==="IMG",k=this._image=f?this._url:Ze("img");if(zt(k,"leaflet-image-layer"),this._zoomAnimated&&zt(k,"leaflet-zoom-animated"),this.options.className&&zt(k,this.options.className),k.onselectstart=h,k.onmousemove=h,k.onload=s(this.fire,this,"load"),k.onerror=s(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(k.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),f){this._url=k.src;return}k.src=this._url,k.alt=this.options.alt},_animateZoom:function(f){var k=this._map.getZoomScale(f.zoom),P=this._map._latLngBoundsToNewLayerBounds(this._bounds,f.zoom,f.center).min;en(this._image,P,k)},_reset:function(){var f=this._image,k=new X(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),P=k.getSize();yn(f,k.min),f.style.width=P.x+"px",f.style.height=P.y+"px"},_updateOpacity:function(){tr(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var f=this.options.errorOverlayUrl;f&&this._url!==f&&(this._url=f,this._image.src=f)},getCenter:function(){return this._bounds.getCenter()}}),Mo=function(f,k,P){return new Bs(f,k,P)},ln=Bs.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var f=this._url.tagName==="VIDEO",k=this._image=f?this._url:Ze("video");if(zt(k,"leaflet-image-layer"),this._zoomAnimated&&zt(k,"leaflet-zoom-animated"),this.options.className&&zt(k,this.options.className),k.onselectstart=h,k.onmousemove=h,k.onloadeddata=s(this.fire,this,"load"),f){for(var P=k.getElementsByTagName("source"),H=[],J=0;J<P.length;J++)H.push(P[J].src);this._url=P.length>0?H:[k.src];return}T(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(k.style,"objectFit")&&(k.style.objectFit="fill"),k.autoplay=!!this.options.autoplay,k.loop=!!this.options.loop,k.muted=!!this.options.muted,k.playsInline=!!this.options.playsInline;for(var ce=0;ce<this._url.length;ce++){var we=Ze("source");we.src=this._url[ce],k.appendChild(we)}}});function zn(f,k,P){return new ln(f,k,P)}var Un=Bs.extend({_initImage:function(){var f=this._image=this._url;zt(f,"leaflet-image-layer"),this._zoomAnimated&&zt(f,"leaflet-zoom-animated"),this.options.className&&zt(f,this.options.className),f.onselectstart=h,f.onmousemove=h}});function eu(f,k,P){return new Un(f,k,P)}var ra=Ka.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(f,k){f&&(f instanceof se||T(f))?(this._latlng=fe(f),S(this,k)):(S(this,f),this._source=k),this.options.content&&(this._content=this.options.content)},openOn:function(f){return f=arguments.length?f:this._source._map,f.hasLayer(this)||f.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(f){return this._map?this.close():(arguments.length?this._source=f:f=this._source,this._prepareOpen(),this.openOn(f._map)),this},onAdd:function(f){this._zoomAnimated=f._zoomAnimated,this._container||this._initLayout(),f._fadeAnimated&&tr(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),f._fadeAnimated&&tr(this._container,1),this.bringToFront(),this.options.interactive&&(zt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(f){f._fadeAnimated?(tr(this._container,0),this._removeTimeout=setTimeout(s(Dt,void 0,this._container),200)):Dt(this._container),this.options.interactive&&(Ir(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(f){return this._latlng=fe(f),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(f){return this._content=f,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var f={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Pr(this._container),this},bringToBack:function(){return this._map&&Fr(this._container),this},_prepareOpen:function(f){var k=this._source;if(!k._map)return!1;if(k instanceof Ji){k=null;var P=this._source._layers;for(var H in P)if(P[H]._map){k=P[H];break}if(!k)return!1;this._source=k}if(!f)if(k.getCenter)f=k.getCenter();else if(k.getLatLng)f=k.getLatLng();else if(k.getBounds)f=k.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(f),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var f=this._contentNode,k=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof k=="string")f.innerHTML=k;else{for(;f.hasChildNodes();)f.removeChild(f.firstChild);f.appendChild(k)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var f=this._map.latLngToLayerPoint(this._latlng),k=te(this.options.offset),P=this._getAnchor();this._zoomAnimated?yn(this._container,f.add(P)):k=k.add(f).add(P);var H=this._containerBottom=-k.y,J=this._containerLeft=-Math.round(this._containerWidth/2)+k.x;this._container.style.bottom=H+"px",this._container.style.left=J+"px"}},_getAnchor:function(){return[0,0]}});Cr.include({_initOverlay:function(f,k,P,H){var J=k;return J instanceof f||(J=new f(H).setContent(k)),P&&J.setLatLng(P),J}}),Ka.include({_initOverlay:function(f,k,P,H){var J=P;return J instanceof f?(S(J,H),J._source=this):(J=k&&!H?k:new f(H,this),J.setContent(P)),J}});var Ao=ra.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(f){return f=arguments.length?f:this._source._map,!f.hasLayer(this)&&f._popup&&f._popup.options.autoClose&&f.removeLayer(f._popup),f._popup=this,ra.prototype.openOn.call(this,f)},onAdd:function(f){ra.prototype.onAdd.call(this,f),f.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof oo||this._source.on("preclick",Os))},onRemove:function(f){ra.prototype.onRemove.call(this,f),f.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof oo||this._source.off("preclick",Os))},getEvents:function(){var f=ra.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(f.preclick=this.close),this.options.keepInView&&(f.moveend=this._adjustPan),f},_initLayout:function(){var f="leaflet-popup",k=this._container=Ze("div",f+" "+(this.options.className||"")+" leaflet-zoom-animated"),P=this._wrapper=Ze("div",f+"-content-wrapper",k);if(this._contentNode=Ze("div",f+"-content",P),Ou(k),Hl(this._contentNode),sr(k,"contextmenu",Os),this._tipContainer=Ze("div",f+"-tip-container",k),this._tip=Ze("div",f+"-tip",this._tipContainer),this.options.closeButton){var H=this._closeButton=Ze("a",f+"-close-button",k);H.setAttribute("role","button"),H.setAttribute("aria-label","Close popup"),H.href="#close",H.innerHTML='<span aria-hidden="true">&#215;</span>',sr(H,"click",function(J){fn(J),this.close()},this)}},_updateLayout:function(){var f=this._contentNode,k=f.style;k.width="",k.whiteSpace="nowrap";var P=f.offsetWidth;P=Math.min(P,this.options.maxWidth),P=Math.max(P,this.options.minWidth),k.width=P+1+"px",k.whiteSpace="",k.height="";var H=f.offsetHeight,J=this.options.maxHeight,ce="leaflet-popup-scrolled";J&&H>J?(k.height=J+"px",zt(f,ce)):Ir(f,ce),this._containerWidth=this._container.offsetWidth},_animateZoom:function(f){var k=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center),P=this._getAnchor();yn(this._container,k.add(P))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var f=this._map,k=parseInt(pt(this._container,"marginBottom"),10)||0,P=this._container.offsetHeight+k,H=this._containerWidth,J=new Q(this._containerLeft,-P-this._containerBottom);J._add(io(this._container));var ce=f.layerPointToContainerPoint(J),we=te(this.options.autoPanPadding),Me=te(this.options.autoPanPaddingTopLeft||we),Ie=te(this.options.autoPanPaddingBottomRight||we),Je=f.getSize(),Tt=0,Xt=0;ce.x+H+Ie.x>Je.x&&(Tt=ce.x+H-Je.x+Ie.x),ce.x-Tt-Me.x<0&&(Tt=ce.x-Me.x),ce.y+P+Ie.y>Je.y&&(Xt=ce.y+P-Je.y+Ie.y),ce.y-Xt-Me.y<0&&(Xt=ce.y-Me.y),(Tt||Xt)&&(this.options.keepInView&&(this._autopanning=!0),f.fire("autopanstart").panBy([Tt,Xt]))}},_getAnchor:function(){return te(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),tu=function(f,k){return new Ao(f,k)};Cr.mergeOptions({closePopupOnClick:!0}),Cr.include({openPopup:function(f,k,P){return this._initOverlay(Ao,f,k,P).openOn(this),this},closePopup:function(f){return f=arguments.length?f:this._popup,f&&f.close(),this}}),Ka.include({bindPopup:function(f,k){return this._popup=this._initOverlay(Ao,this._popup,f,k),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(f){return this._popup&&(this instanceof Ji||(this._popup._source=this),this._popup._prepareOpen(f||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(f){return this._popup&&this._popup.setContent(f),this},getPopup:function(){return this._popup},_openPopup:function(f){if(!(!this._popup||!this._map)){Fn(f);var k=f.layer||f.target;if(this._popup._source===k&&!(k instanceof oo)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(f.latlng);return}this._popup._source=k,this.openPopup(f.latlng)}},_movePopup:function(f){this._popup.setLatLng(f.latlng)},_onKeyPress:function(f){f.originalEvent.keyCode===13&&this._openPopup(f)}});var An=ra.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(f){ra.prototype.onAdd.call(this,f),this.setOpacity(this.options.opacity),f.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(f){ra.prototype.onRemove.call(this,f),f.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var f=ra.prototype.getEvents.call(this);return this.options.permanent||(f.preclick=this.close),f},_initLayout:function(){var f="leaflet-tooltip",k=f+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Ze("div",k),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(f){var k,P,H=this._map,J=this._container,ce=H.latLngToContainerPoint(H.getCenter()),we=H.layerPointToContainerPoint(f),Me=this.options.direction,Ie=J.offsetWidth,Je=J.offsetHeight,Tt=te(this.options.offset),Xt=this._getAnchor();Me==="top"?(k=Ie/2,P=Je):Me==="bottom"?(k=Ie/2,P=0):Me==="center"?(k=Ie/2,P=Je/2):Me==="right"?(k=0,P=Je/2):Me==="left"?(k=Ie,P=Je/2):we.x<ce.x?(Me="right",k=0,P=Je/2):(Me="left",k=Ie+(Tt.x+Xt.x)*2,P=Je/2),f=f.subtract(te(k,P,!0)).add(Tt).add(Xt),Ir(J,"leaflet-tooltip-right"),Ir(J,"leaflet-tooltip-left"),Ir(J,"leaflet-tooltip-top"),Ir(J,"leaflet-tooltip-bottom"),zt(J,"leaflet-tooltip-"+Me),yn(J,f)},_updatePosition:function(){var f=this._map.latLngToLayerPoint(this._latlng);this._setPosition(f)},setOpacity:function(f){this.options.opacity=f,this._container&&tr(this._container,f)},_animateZoom:function(f){var k=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center);this._setPosition(k)},_getAnchor:function(){return te(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),ml=function(f,k){return new An(f,k)};Cr.include({openTooltip:function(f,k,P){return this._initOverlay(An,f,k,P).openOn(this),this},closeTooltip:function(f){return f.close(),this}}),Ka.include({bindTooltip:function(f,k){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(An,this._tooltip,f,k),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(f){if(!(!f&&this._tooltipHandlersAdded)){var k=f?"off":"on",P={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?P.add=this._openTooltip:(P.mouseover=this._openTooltip,P.mouseout=this.closeTooltip,P.click=this._openTooltip,this._map?this._addFocusListeners():P.add=this._addFocusListeners),this._tooltip.options.sticky&&(P.mousemove=this._moveTooltip),this[k](P),this._tooltipHandlersAdded=!f}},openTooltip:function(f){return this._tooltip&&(this instanceof Ji||(this._tooltip._source=this),this._tooltip._prepareOpen(f)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(f){return this._tooltip&&this._tooltip.setContent(f),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(f){var k=typeof f.getElement=="function"&&f.getElement();k&&(sr(k,"focus",function(){this._tooltip._source=f,this.openTooltip()},this),sr(k,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(f){var k=typeof f.getElement=="function"&&f.getElement();k&&k.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(f){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var k=this;this._map.once("moveend",function(){k._openOnceFlag=!1,k._openTooltip(f)});return}this._tooltip._source=f.layer||f.target,this.openTooltip(this._tooltip.options.sticky?f.latlng:void 0)}},_moveTooltip:function(f){var k=f.latlng,P,H;this._tooltip.options.sticky&&f.originalEvent&&(P=this._map.mouseEventToContainerPoint(f.originalEvent),H=this._map.containerPointToLayerPoint(P),k=this._map.layerPointToLatLng(H)),this._tooltip.setLatLng(k)}});var ru=Ca.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(f){var k=f&&f.tagName==="DIV"?f:document.createElement("div"),P=this.options;if(P.html instanceof Element?(Nr(k),k.appendChild(P.html)):k.innerHTML=P.html!==!1?P.html:"",P.bgPos){var H=te(P.bgPos);k.style.backgroundPosition=-H.x+"px "+-H.y+"px"}return this._setIconStyles(k,"icon"),k},createShadow:function(){return null}});function Dc(f){return new ru(f)}Ca.Default=hl;var bi=Ka.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Et.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(f){S(this,f)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(f){f._addZoomLimit(this)},onRemove:function(f){this._removeAllTiles(),Dt(this._container),f._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Pr(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Fr(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(f){return this.options.opacity=f,this._updateOpacity(),this},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var f=this._clampZoom(this._map.getZoom());f!==this._tileZoom&&(this._tileZoom=f,this._updateLevels()),this._update()}return this},getEvents:function(){var f={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=u(this._onMoveEnd,this.options.updateInterval,this)),f.move=this._onMove),this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},createTile:function(){return document.createElement("div")},getTileSize:function(){var f=this.options.tileSize;return f instanceof Q?f:new Q(f,f)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(f){for(var k=this.getPane().children,P=-f(-1/0,1/0),H=0,J=k.length,ce;H<J;H++)ce=k[H].style.zIndex,k[H]!==this._container&&ce&&(P=f(P,+ce));isFinite(P)&&(this.options.zIndex=P+f(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Et.ielt9){tr(this._container,this.options.opacity);var f=+new Date,k=!1,P=!1;for(var H in this._tiles){var J=this._tiles[H];if(!(!J.current||!J.loaded)){var ce=Math.min(1,(f-J.loaded)/200);tr(J.el,ce),ce<1?k=!0:(J.active?P=!0:this._onOpaqueTile(J),J.active=!0)}}P&&!this._noPrune&&this._pruneTiles(),k&&(q(this._fadeFrame),this._fadeFrame=V(this._updateOpacity,this))}},_onOpaqueTile:h,_initContainer:function(){this._container||(this._container=Ze("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var f=this._tileZoom,k=this.options.maxZoom;if(f!==void 0){for(var P in this._levels)P=Number(P),this._levels[P].el.children.length||P===f?(this._levels[P].el.style.zIndex=k-Math.abs(f-P),this._onUpdateLevel(P)):(Dt(this._levels[P].el),this._removeTilesAtZoom(P),this._onRemoveLevel(P),delete this._levels[P]);var H=this._levels[f],J=this._map;return H||(H=this._levels[f]={},H.el=Ze("div","leaflet-tile-container leaflet-zoom-animated",this._container),H.el.style.zIndex=k,H.origin=J.project(J.unproject(J.getPixelOrigin()),f).round(),H.zoom=f,this._setZoomTransform(H,J.getCenter(),J.getZoom()),h(H.el.offsetWidth),this._onCreateLevel(H)),this._level=H,H}},_onUpdateLevel:h,_onRemoveLevel:h,_onCreateLevel:h,_pruneTiles:function(){if(this._map){var f,k,P=this._map.getZoom();if(P>this.options.maxZoom||P<this.options.minZoom){this._removeAllTiles();return}for(f in this._tiles)k=this._tiles[f],k.retain=k.current;for(f in this._tiles)if(k=this._tiles[f],k.current&&!k.active){var H=k.coords;this._retainParent(H.x,H.y,H.z,H.z-5)||this._retainChildren(H.x,H.y,H.z,H.z+2)}for(f in this._tiles)this._tiles[f].retain||this._removeTile(f)}},_removeTilesAtZoom:function(f){for(var k in this._tiles)this._tiles[k].coords.z===f&&this._removeTile(k)},_removeAllTiles:function(){for(var f in this._tiles)this._removeTile(f)},_invalidateAll:function(){for(var f in this._levels)Dt(this._levels[f].el),this._onRemoveLevel(Number(f)),delete this._levels[f];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(f,k,P,H){var J=Math.floor(f/2),ce=Math.floor(k/2),we=P-1,Me=new Q(+J,+ce);Me.z=+we;var Ie=this._tileCoordsToKey(Me),Je=this._tiles[Ie];return Je&&Je.active?(Je.retain=!0,!0):(Je&&Je.loaded&&(Je.retain=!0),we>H?this._retainParent(J,ce,we,H):!1)},_retainChildren:function(f,k,P,H){for(var J=2*f;J<2*f+2;J++)for(var ce=2*k;ce<2*k+2;ce++){var we=new Q(J,ce);we.z=P+1;var Me=this._tileCoordsToKey(we),Ie=this._tiles[Me];if(Ie&&Ie.active){Ie.retain=!0;continue}else Ie&&Ie.loaded&&(Ie.retain=!0);P+1<H&&this._retainChildren(J,ce,P+1,H)}},_resetView:function(f){var k=f&&(f.pinch||f.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),k,k)},_animateZoom:function(f){this._setView(f.center,f.zoom,!0,f.noUpdate)},_clampZoom:function(f){var k=this.options;return k.minNativeZoom!==void 0&&f<k.minNativeZoom?k.minNativeZoom:k.maxNativeZoom!==void 0&&k.maxNativeZoom<f?k.maxNativeZoom:f},_setView:function(f,k,P,H){var J=Math.round(k);this.options.maxZoom!==void 0&&J>this.options.maxZoom||this.options.minZoom!==void 0&&J<this.options.minZoom?J=void 0:J=this._clampZoom(J);var ce=this.options.updateWhenZooming&&J!==this._tileZoom;(!H||ce)&&(this._tileZoom=J,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),J!==void 0&&this._update(f),P||this._pruneTiles(),this._noPrune=!!P),this._setZoomTransforms(f,k)},_setZoomTransforms:function(f,k){for(var P in this._levels)this._setZoomTransform(this._levels[P],f,k)},_setZoomTransform:function(f,k,P){var H=this._map.getZoomScale(P,f.zoom),J=f.origin.multiplyBy(H).subtract(this._map._getNewPixelOrigin(k,P)).round();Et.any3d?en(f.el,J,H):yn(f.el,J)},_resetGrid:function(){var f=this._map,k=f.options.crs,P=this._tileSize=this.getTileSize(),H=this._tileZoom,J=this._map.getPixelWorldBounds(this._tileZoom);J&&(this._globalTileRange=this._pxBoundsToTileRange(J)),this._wrapX=k.wrapLng&&!this.options.noWrap&&[Math.floor(f.project([0,k.wrapLng[0]],H).x/P.x),Math.ceil(f.project([0,k.wrapLng[1]],H).x/P.y)],this._wrapY=k.wrapLat&&!this.options.noWrap&&[Math.floor(f.project([k.wrapLat[0],0],H).y/P.x),Math.ceil(f.project([k.wrapLat[1],0],H).y/P.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(f){var k=this._map,P=k._animatingZoom?Math.max(k._animateToZoom,k.getZoom()):k.getZoom(),H=k.getZoomScale(P,this._tileZoom),J=k.project(f,this._tileZoom).floor(),ce=k.getSize().divideBy(H*2);return new X(J.subtract(ce),J.add(ce))},_update:function(f){var k=this._map;if(k){var P=this._clampZoom(k.getZoom());if(f===void 0&&(f=k.getCenter()),this._tileZoom!==void 0){var H=this._getTiledPixelBounds(f),J=this._pxBoundsToTileRange(H),ce=J.getCenter(),we=[],Me=this.options.keepBuffer,Ie=new X(J.getBottomLeft().subtract([Me,-Me]),J.getTopRight().add([Me,-Me]));if(!(isFinite(J.min.x)&&isFinite(J.min.y)&&isFinite(J.max.x)&&isFinite(J.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Je in this._tiles){var Tt=this._tiles[Je].coords;(Tt.z!==this._tileZoom||!Ie.contains(new Q(Tt.x,Tt.y)))&&(this._tiles[Je].current=!1)}if(Math.abs(P-this._tileZoom)>1){this._setView(f,P);return}for(var Xt=J.min.y;Xt<=J.max.y;Xt++)for(var hr=J.min.x;hr<=J.max.x;hr++){var Zr=new Q(hr,Xt);if(Zr.z=this._tileZoom,!!this._isValidTile(Zr)){var Gn=this._tiles[this._tileCoordsToKey(Zr)];Gn?Gn.current=!0:we.push(Zr)}}if(we.sort(function(zi,yl){return zi.distanceTo(ce)-yl.distanceTo(ce)}),we.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Ai=document.createDocumentFragment();for(hr=0;hr<we.length;hr++)this._addTile(we[hr],Ai);this._level.el.appendChild(Ai)}}}},_isValidTile:function(f){var k=this._map.options.crs;if(!k.infinite){var P=this._globalTileRange;if(!k.wrapLng&&(f.x<P.min.x||f.x>P.max.x)||!k.wrapLat&&(f.y<P.min.y||f.y>P.max.y))return!1}if(!this.options.bounds)return!0;var H=this._tileCoordsToBounds(f);return oe(this.options.bounds).overlaps(H)},_keyToBounds:function(f){return this._tileCoordsToBounds(this._keyToTileCoords(f))},_tileCoordsToNwSe:function(f){var k=this._map,P=this.getTileSize(),H=f.scaleBy(P),J=H.add(P),ce=k.unproject(H,f.z),we=k.unproject(J,f.z);return[ce,we]},_tileCoordsToBounds:function(f){var k=this._tileCoordsToNwSe(f),P=new he(k[0],k[1]);return this.options.noWrap||(P=this._map.wrapLatLngBounds(P)),P},_tileCoordsToKey:function(f){return f.x+":"+f.y+":"+f.z},_keyToTileCoords:function(f){var k=f.split(":"),P=new Q(+k[0],+k[1]);return P.z=+k[2],P},_removeTile:function(f){var k=this._tiles[f];k&&(Dt(k.el),delete this._tiles[f],this.fire("tileunload",{tile:k.el,coords:this._keyToTileCoords(f)}))},_initTile:function(f){zt(f,"leaflet-tile");var k=this.getTileSize();f.style.width=k.x+"px",f.style.height=k.y+"px",f.onselectstart=h,f.onmousemove=h,Et.ielt9&&this.options.opacity<1&&tr(f,this.options.opacity)},_addTile:function(f,k){var P=this._getTilePos(f),H=this._tileCoordsToKey(f),J=this.createTile(this._wrapCoords(f),s(this._tileReady,this,f));this._initTile(J),this.createTile.length<2&&V(s(this._tileReady,this,f,null,J)),yn(J,P),this._tiles[H]={el:J,coords:f,current:!0},k.appendChild(J),this.fire("tileloadstart",{tile:J,coords:f})},_tileReady:function(f,k,P){k&&this.fire("tileerror",{error:k,tile:P,coords:f});var H=this._tileCoordsToKey(f);P=this._tiles[H],P&&(P.loaded=+new Date,this._map._fadeAnimated?(tr(P.el,0),q(this._fadeFrame),this._fadeFrame=V(this._updateOpacity,this)):(P.active=!0,this._pruneTiles()),k||(zt(P.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:P.el,coords:f})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Et.ielt9||!this._map._fadeAnimated?V(this._pruneTiles,this):setTimeout(s(this._pruneTiles,this),250)))},_getTilePos:function(f){return f.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(f){var k=new Q(this._wrapX?c(f.x,this._wrapX):f.x,this._wrapY?c(f.y,this._wrapY):f.y);return k.z=f.z,k},_pxBoundsToTileRange:function(f){var k=this.getTileSize();return new X(f.min.unscaleBy(k).floor(),f.max.unscaleBy(k).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var f in this._tiles)if(!this._tiles[f].loaded)return!1;return!0}});function wi(f){return new bi(f)}var Qa=bi.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(f,k){this._url=f,k=S(this,k),k.detectRetina&&Et.retina&&k.maxZoom>0?(k.tileSize=Math.floor(k.tileSize/2),k.zoomReverse?(k.zoomOffset--,k.minZoom=Math.min(k.maxZoom,k.minZoom+1)):(k.zoomOffset++,k.maxZoom=Math.max(k.minZoom,k.maxZoom-1)),k.minZoom=Math.max(0,k.minZoom)):k.zoomReverse?k.minZoom=Math.min(k.maxZoom,k.minZoom):k.maxZoom=Math.max(k.minZoom,k.maxZoom),typeof k.subdomains=="string"&&(k.subdomains=k.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(f,k){return this._url===f&&k===void 0&&(k=!0),this._url=f,k||this.redraw(),this},createTile:function(f,k){var P=document.createElement("img");return sr(P,"load",s(this._tileOnLoad,this,k,P)),sr(P,"error",s(this._tileOnError,this,k,P)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(P.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(P.referrerPolicy=this.options.referrerPolicy),P.alt="",P.src=this.getTileUrl(f),P},getTileUrl:function(f){var k={r:Et.retina?"@2x":"",s:this._getSubdomain(f),x:f.x,y:f.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var P=this._globalTileRange.max.y-f.y;this.options.tms&&(k.y=P),k["-y"]=P}return _(this._url,i(k,this.options))},_tileOnLoad:function(f,k){Et.ielt9?setTimeout(s(f,this,null,k),0):f(null,k)},_tileOnError:function(f,k,P){var H=this.options.errorTileUrl;H&&k.getAttribute("src")!==H&&(k.src=H),f(P,k)},_onTileRemove:function(f){f.tile.onload=null},_getZoomForUrl:function(){var f=this._tileZoom,k=this.options.maxZoom,P=this.options.zoomReverse,H=this.options.zoomOffset;return P&&(f=k-f),f+H},_getSubdomain:function(f){var k=Math.abs(f.x+f.y)%this.options.subdomains.length;return this.options.subdomains[k]},_abortLoading:function(){var f,k;for(f in this._tiles)if(this._tiles[f].coords.z!==this._tileZoom&&(k=this._tiles[f].el,k.onload=h,k.onerror=h,!k.complete)){k.src=R;var P=this._tiles[f].coords;Dt(k),delete this._tiles[f],this.fire("tileabort",{tile:k,coords:P})}},_removeTile:function(f){var k=this._tiles[f];if(k)return k.el.setAttribute("src",R),bi.prototype._removeTile.call(this,f)},_tileReady:function(f,k,P){if(!(!this._map||P&&P.getAttribute("src")===R))return bi.prototype._tileReady.call(this,f,k,P)}});function Uu(f,k){return new Qa(f,k)}var gl=Qa.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(f,k){this._url=f;var P=i({},this.defaultWmsParams);for(var H in k)H in this.options||(P[H]=k[H]);k=S(this,k);var J=k.detectRetina&&Et.retina?2:1,ce=this.getTileSize();P.width=ce.x*J,P.height=ce.y*J,this.wmsParams=P},onAdd:function(f){this._crs=this.options.crs||f.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var k=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[k]=this._crs.code,Qa.prototype.onAdd.call(this,f)},getTileUrl:function(f){var k=this._tileCoordsToNwSe(f),P=this._crs,H=re(P.project(k[0]),P.project(k[1])),J=H.min,ce=H.max,we=(this._wmsVersion>=1.3&&this._crs===Lc?[J.y,J.x,ce.y,ce.x]:[J.x,J.y,ce.x,ce.y]).join(","),Me=Qa.prototype.getTileUrl.call(this,f);return Me+w(this.wmsParams,Me,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+we},setParams:function(f,k){return i(this.wmsParams,f),k||this.redraw(),this}});function Sh(f,k){return new gl(f,k)}Qa.WMS=gl,Uu.wms=Sh;var vs=Ka.extend({options:{padding:.1},initialize:function(f){S(this,f),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),zt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var f={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(f.zoomanim=this._onAnimZoom),f},_onAnimZoom:function(f){this._updateTransform(f.center,f.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(f,k){var P=this._map.getZoomScale(k,this._zoom),H=this._map.getSize().multiplyBy(.5+this.options.padding),J=this._map.project(this._center,k),ce=H.multiplyBy(-P).add(J).subtract(this._map._getNewPixelOrigin(f,k));Et.any3d?en(this._container,ce,P):yn(this._container,ce)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var f in this._layers)this._layers[f]._reset()},_onZoomEnd:function(){for(var f in this._layers)this._layers[f]._project()},_updatePaths:function(){for(var f in this._layers)this._layers[f]._update()},_update:function(){var f=this.options.padding,k=this._map.getSize(),P=this._map.containerPointToLayerPoint(k.multiplyBy(-f)).round();this._bounds=new X(P,P.add(k.multiplyBy(1+f*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Ic=vs.extend({options:{tolerance:0},getEvents:function(){var f=vs.prototype.getEvents.call(this);return f.viewprereset=this._onViewPreReset,f},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){vs.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var f=this._container=document.createElement("canvas");sr(f,"mousemove",this._onMouseMove,this),sr(f,"click dblclick mousedown mouseup contextmenu",this._onClick,this),sr(f,"mouseout",this._handleMouseOut,this),f._leaflet_disable_events=!0,this._ctx=f.getContext("2d")},_destroyContainer:function(){q(this._redrawRequest),delete this._ctx,Dt(this._container),$r(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var f;this._redrawBounds=null;for(var k in this._layers)f=this._layers[k],f._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){vs.prototype._update.call(this);var f=this._bounds,k=this._container,P=f.getSize(),H=Et.retina?2:1;yn(k,f.min),k.width=H*P.x,k.height=H*P.y,k.style.width=P.x+"px",k.style.height=P.y+"px",Et.retina&&this._ctx.scale(2,2),this._ctx.translate(-f.min.x,-f.min.y),this.fire("update")}},_reset:function(){vs.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(f){this._updateDashArray(f),this._layers[l(f)]=f;var k=f._order={layer:f,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=k),this._drawLast=k,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(f){this._requestRedraw(f)},_removePath:function(f){var k=f._order,P=k.next,H=k.prev;P?P.prev=H:this._drawLast=H,H?H.next=P:this._drawFirst=P,delete f._order,delete this._layers[l(f)],this._requestRedraw(f)},_updatePath:function(f){this._extendRedrawBounds(f),f._project(),f._update(),this._requestRedraw(f)},_updateStyle:function(f){this._updateDashArray(f),this._requestRedraw(f)},_updateDashArray:function(f){if(typeof f.options.dashArray=="string"){var k=f.options.dashArray.split(/[, ]+/),P=[],H,J;for(J=0;J<k.length;J++){if(H=Number(k[J]),isNaN(H))return;P.push(H)}f.options._dashArray=P}else f.options._dashArray=f.options.dashArray},_requestRedraw:function(f){this._map&&(this._extendRedrawBounds(f),this._redrawRequest=this._redrawRequest||V(this._redraw,this))},_extendRedrawBounds:function(f){if(f._pxBounds){var k=(f.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new X,this._redrawBounds.extend(f._pxBounds.min.subtract([k,k])),this._redrawBounds.extend(f._pxBounds.max.add([k,k]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var f=this._redrawBounds;if(f){var k=f.getSize();this._ctx.clearRect(f.min.x,f.min.y,k.x,k.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var f,k=this._redrawBounds;if(this._ctx.save(),k){var P=k.getSize();this._ctx.beginPath(),this._ctx.rect(k.min.x,k.min.y,P.x,P.y),this._ctx.clip()}this._drawing=!0;for(var H=this._drawFirst;H;H=H.next)f=H.layer,(!k||f._pxBounds&&f._pxBounds.intersects(k))&&f._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(f,k){if(this._drawing){var P,H,J,ce,we=f._parts,Me=we.length,Ie=this._ctx;if(Me){for(Ie.beginPath(),P=0;P<Me;P++){for(H=0,J=we[P].length;H<J;H++)ce=we[P][H],Ie[H?"lineTo":"moveTo"](ce.x,ce.y);k&&Ie.closePath()}this._fillStroke(Ie,f)}}},_updateCircle:function(f){if(!(!this._drawing||f._empty())){var k=f._point,P=this._ctx,H=Math.max(Math.round(f._radius),1),J=(Math.max(Math.round(f._radiusY),1)||H)/H;J!==1&&(P.save(),P.scale(1,J)),P.beginPath(),P.arc(k.x,k.y/J,H,0,Math.PI*2,!1),J!==1&&P.restore(),this._fillStroke(P,f)}},_fillStroke:function(f,k){var P=k.options;P.fill&&(f.globalAlpha=P.fillOpacity,f.fillStyle=P.fillColor||P.color,f.fill(P.fillRule||"evenodd")),P.stroke&&P.weight!==0&&(f.setLineDash&&f.setLineDash(k.options&&k.options._dashArray||[]),f.globalAlpha=P.opacity,f.lineWidth=P.weight,f.strokeStyle=P.color,f.lineCap=P.lineCap,f.lineJoin=P.lineJoin,f.stroke())},_onClick:function(f){for(var k=this._map.mouseEventToLayerPoint(f),P,H,J=this._drawFirst;J;J=J.next)P=J.layer,P.options.interactive&&P._containsPoint(k)&&(!(f.type==="click"||f.type==="preclick")||!this._map._draggableMoved(P))&&(H=P);this._fireEvent(H?[H]:!1,f)},_onMouseMove:function(f){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var k=this._map.mouseEventToLayerPoint(f);this._handleMouseHover(f,k)}},_handleMouseOut:function(f){var k=this._hoveredLayer;k&&(Ir(this._container,"leaflet-interactive"),this._fireEvent([k],f,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(f,k){if(!this._mouseHoverThrottled){for(var P,H,J=this._drawFirst;J;J=J.next)P=J.layer,P.options.interactive&&P._containsPoint(k)&&(H=P);H!==this._hoveredLayer&&(this._handleMouseOut(f),H&&(zt(this._container,"leaflet-interactive"),this._fireEvent([H],f,"mouseover"),this._hoveredLayer=H)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,f),this._mouseHoverThrottled=!0,setTimeout(s(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(f,k,P){this._map._fireDOMEvent(k,P||k.type,f)},_bringToFront:function(f){var k=f._order;if(k){var P=k.next,H=k.prev;if(P)P.prev=H;else return;H?H.next=P:P&&(this._drawFirst=P),k.prev=this._drawLast,this._drawLast.next=k,k.next=null,this._drawLast=k,this._requestRedraw(f)}},_bringToBack:function(f){var k=f._order;if(k){var P=k.next,H=k.prev;if(H)H.next=P;else return;P?P.prev=H:H&&(this._drawLast=H),k.prev=null,k.next=this._drawFirst,this._drawFirst.prev=k,this._drawFirst=k,this._requestRedraw(f)}}});function jc(f){return Et.canvas?new Ic(f):null}var vl=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(f){return document.createElement("<lvml:"+f+' class="lvml">')}}catch{}return function(f){return document.createElement("<"+f+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),kh={_initContainer:function(){this._container=Ze("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(vs.prototype._update.call(this),this.fire("update"))},_initPath:function(f){var k=f._container=vl("shape");zt(k,"leaflet-vml-shape "+(this.options.className||"")),k.coordsize="1 1",f._path=vl("path"),k.appendChild(f._path),this._updateStyle(f),this._layers[l(f)]=f},_addPath:function(f){var k=f._container;this._container.appendChild(k),f.options.interactive&&f.addInteractiveTarget(k)},_removePath:function(f){var k=f._container;Dt(k),f.removeInteractiveTarget(k),delete this._layers[l(f)]},_updateStyle:function(f){var k=f._stroke,P=f._fill,H=f.options,J=f._container;J.stroked=!!H.stroke,J.filled=!!H.fill,H.stroke?(k||(k=f._stroke=vl("stroke")),J.appendChild(k),k.weight=H.weight+"px",k.color=H.color,k.opacity=H.opacity,H.dashArray?k.dashStyle=T(H.dashArray)?H.dashArray.join(" "):H.dashArray.replace(/( *, *)/g," "):k.dashStyle="",k.endcap=H.lineCap.replace("butt","flat"),k.joinstyle=H.lineJoin):k&&(J.removeChild(k),f._stroke=null),H.fill?(P||(P=f._fill=vl("fill")),J.appendChild(P),P.color=H.fillColor||H.color,P.opacity=H.fillOpacity):P&&(J.removeChild(P),f._fill=null)},_updateCircle:function(f){var k=f._point.round(),P=Math.round(f._radius),H=Math.round(f._radiusY||P);this._setPath(f,f._empty()?"M0 0":"AL "+k.x+","+k.y+" "+P+","+H+" 0,"+65535*360)},_setPath:function(f,k){f._path.v=k},_bringToFront:function(f){Pr(f._container)},_bringToBack:function(f){Fr(f._container)}},Ja=Et.vml?vl:Ae,Lo=vs.extend({_initContainer:function(){this._container=Ja("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ja("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Dt(this._container),$r(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){vs.prototype._update.call(this);var f=this._bounds,k=f.getSize(),P=this._container;(!this._svgSize||!this._svgSize.equals(k))&&(this._svgSize=k,P.setAttribute("width",k.x),P.setAttribute("height",k.y)),yn(P,f.min),P.setAttribute("viewBox",[f.min.x,f.min.y,k.x,k.y].join(" ")),this.fire("update")}},_initPath:function(f){var k=f._path=Ja("path");f.options.className&&zt(k,f.options.className),f.options.interactive&&zt(k,"leaflet-interactive"),this._updateStyle(f),this._layers[l(f)]=f},_addPath:function(f){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(f._path),f.addInteractiveTarget(f._path)},_removePath:function(f){Dt(f._path),f.removeInteractiveTarget(f._path),delete this._layers[l(f)]},_updatePath:function(f){f._project(),f._update()},_updateStyle:function(f){var k=f._path,P=f.options;k&&(P.stroke?(k.setAttribute("stroke",P.color),k.setAttribute("stroke-opacity",P.opacity),k.setAttribute("stroke-width",P.weight),k.setAttribute("stroke-linecap",P.lineCap),k.setAttribute("stroke-linejoin",P.lineJoin),P.dashArray?k.setAttribute("stroke-dasharray",P.dashArray):k.removeAttribute("stroke-dasharray"),P.dashOffset?k.setAttribute("stroke-dashoffset",P.dashOffset):k.removeAttribute("stroke-dashoffset")):k.setAttribute("stroke","none"),P.fill?(k.setAttribute("fill",P.fillColor||P.color),k.setAttribute("fill-opacity",P.fillOpacity),k.setAttribute("fill-rule",P.fillRule||"evenodd")):k.setAttribute("fill","none"))},_updatePoly:function(f,k){this._setPath(f,tt(f._parts,k))},_updateCircle:function(f){var k=f._point,P=Math.max(Math.round(f._radius),1),H=Math.max(Math.round(f._radiusY),1)||P,J="a"+P+","+H+" 0 1,0 ",ce=f._empty()?"M0 0":"M"+(k.x-P)+","+k.y+J+P*2+",0 "+J+-P*2+",0 ";this._setPath(f,ce)},_setPath:function(f,k){f._path.setAttribute("d",k)},_bringToFront:function(f){Pr(f._path)},_bringToBack:function(f){Fr(f._path)}});Et.vml&&Lo.include(kh);function Ro(f){return Et.svg||Et.vml?new Lo(f):null}Cr.include({getRenderer:function(f){var k=f.options.renderer||this._getPaneRenderer(f.options.pane)||this.options.renderer||this._renderer;return k||(k=this._renderer=this._createRenderer()),this.hasLayer(k)||this.addLayer(k),k},_getPaneRenderer:function(f){if(f==="overlayPane"||f===void 0)return!1;var k=this._paneRenderers[f];return k===void 0&&(k=this._createRenderer({pane:f}),this._paneRenderers[f]=k),k},_createRenderer:function(f){return this.options.preferCanvas&&jc(f)||Ro(f)}});var _h=Ea.extend({initialize:function(f,k){Ea.prototype.initialize.call(this,this._boundsToLatLngs(f),k)},setBounds:function(f){return this.setLatLngs(this._boundsToLatLngs(f))},_boundsToLatLngs:function(f){return f=oe(f),[f.getSouthWest(),f.getNorthWest(),f.getNorthEast(),f.getSouthEast()]}});function Fc(f,k){return new _h(f,k)}Lo.create=Ja,Lo.pointsToPath=tt,ea.geometryToLayer=gs,ea.coordsToLatLng=Ql,ea.coordsToLatLngs=Fs,ea.latLngToCoords=Bu,ea.latLngsToCoords=Jl,ea.getFeature=Hr,ea.asFeature=pl,Cr.mergeOptions({boxZoom:!0});var uo=Qi.extend({initialize:function(f){this._map=f,this._container=f._container,this._pane=f._panes.overlayPane,this._resetStateTimeout=0,f.on("unload",this._destroy,this)},addHooks:function(){sr(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){$r(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Dt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(f){if(!f.shiftKey||f.which!==1&&f.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),xr(),Cc(),this._startPoint=this._map.mouseEventToContainerPoint(f),sr(document,{contextmenu:Fn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(f){this._moved||(this._moved=!0,this._box=Ze("div","leaflet-zoom-box",this._container),zt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(f);var k=new X(this._point,this._startPoint),P=k.getSize();yn(this._box,k.min),this._box.style.width=P.x+"px",this._box.style.height=P.y+"px"},_finish:function(){this._moved&&(Dt(this._box),Ir(this._container,"leaflet-crosshair")),ao(),Ec(),$r(document,{contextmenu:Fn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(f){if(!(f.which!==1&&f.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(s(this._resetState,this),0);var k=new he(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(k).fire("boxzoomend",{boxZoomBounds:k})}},_onKeyDown:function(f){f.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Cr.addInitHook("addHandler","boxZoom",uo),Cr.mergeOptions({doubleClickZoom:!0});var Ch=Qi.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(f){var k=this._map,P=k.getZoom(),H=k.options.zoomDelta,J=f.originalEvent.shiftKey?P-H:P+H;k.options.doubleClickZoom==="center"?k.setZoom(J):k.setZoomAround(f.containerPoint,J)}});Cr.addInitHook("addHandler","doubleClickZoom",Ch),Cr.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Gu=Qi.extend({addHooks:function(){if(!this._draggable){var f=this._map;this._draggable=new _n(f._mapPane,f._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),f.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),f.on("zoomend",this._onZoomEnd,this),f.whenReady(this._onZoomEnd,this))}zt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Ir(this._map._container,"leaflet-grab"),Ir(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var f=this._map;if(f._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var k=oe(this._map.options.maxBounds);this._offsetLimit=re(this._map.latLngToContainerPoint(k.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(k.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;f.fire("movestart").fire("dragstart"),f.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(f){if(this._map.options.inertia){var k=this._lastTime=+new Date,P=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(P),this._times.push(k),this._prunePositions(k)}this._map.fire("move",f).fire("drag",f)},_prunePositions:function(f){for(;this._positions.length>1&&f-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var f=this._map.getSize().divideBy(2),k=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=k.subtract(f).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(f,k){return f-(f-k)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var f=this._draggable._newPos.subtract(this._draggable._startPos),k=this._offsetLimit;f.x<k.min.x&&(f.x=this._viscousLimit(f.x,k.min.x)),f.y<k.min.y&&(f.y=this._viscousLimit(f.y,k.min.y)),f.x>k.max.x&&(f.x=this._viscousLimit(f.x,k.max.x)),f.y>k.max.y&&(f.y=this._viscousLimit(f.y,k.max.y)),this._draggable._newPos=this._draggable._startPos.add(f)}},_onPreDragWrap:function(){var f=this._worldWidth,k=Math.round(f/2),P=this._initialWorldOffset,H=this._draggable._newPos.x,J=(H-k+P)%f+k-P,ce=(H+k+P)%f-k-P,we=Math.abs(J+P)<Math.abs(ce+P)?J:ce;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=we},_onDragEnd:function(f){var k=this._map,P=k.options,H=!P.inertia||f.noInertia||this._times.length<2;if(k.fire("dragend",f),H)k.fire("moveend");else{this._prunePositions(+new Date);var J=this._lastPos.subtract(this._positions[0]),ce=(this._lastTime-this._times[0])/1e3,we=P.easeLinearity,Me=J.multiplyBy(we/ce),Ie=Me.distanceTo([0,0]),Je=Math.min(P.inertiaMaxSpeed,Ie),Tt=Me.multiplyBy(Je/Ie),Xt=Je/(P.inertiaDeceleration*we),hr=Tt.multiplyBy(-Xt/2).round();!hr.x&&!hr.y?k.fire("moveend"):(hr=k._limitOffset(hr,k.options.maxBounds),V(function(){k.panBy(hr,{duration:Xt,easeLinearity:we,noMoveStart:!0,animate:!0})}))}}});Cr.addInitHook("addHandler","dragging",Gu),Cr.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Bc=Qi.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(f){this._map=f,this._setPanDelta(f.options.keyboardPanDelta),this._setZoomDelta(f.options.zoomDelta)},addHooks:function(){var f=this._map._container;f.tabIndex<=0&&(f.tabIndex="0"),sr(f,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),$r(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var f=document.body,k=document.documentElement,P=f.scrollTop||k.scrollTop,H=f.scrollLeft||k.scrollLeft;this._map._container.focus(),window.scrollTo(H,P)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(f){var k=this._panKeys={},P=this.keyCodes,H,J;for(H=0,J=P.left.length;H<J;H++)k[P.left[H]]=[-1*f,0];for(H=0,J=P.right.length;H<J;H++)k[P.right[H]]=[f,0];for(H=0,J=P.down.length;H<J;H++)k[P.down[H]]=[0,f];for(H=0,J=P.up.length;H<J;H++)k[P.up[H]]=[0,-1*f]},_setZoomDelta:function(f){var k=this._zoomKeys={},P=this.keyCodes,H,J;for(H=0,J=P.zoomIn.length;H<J;H++)k[P.zoomIn[H]]=f;for(H=0,J=P.zoomOut.length;H<J;H++)k[P.zoomOut[H]]=-f},_addHooks:function(){sr(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){$r(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(f){if(!(f.altKey||f.ctrlKey||f.metaKey)){var k=f.keyCode,P=this._map,H;if(k in this._panKeys){if(!P._panAnim||!P._panAnim._inProgress)if(H=this._panKeys[k],f.shiftKey&&(H=te(H).multiplyBy(3)),P.options.maxBounds&&(H=P._limitOffset(te(H),P.options.maxBounds)),P.options.worldCopyJump){var J=P.wrapLatLng(P.unproject(P.project(P.getCenter()).add(H)));P.panTo(J)}else P.panBy(H)}else if(k in this._zoomKeys)P.setZoom(P.getZoom()+(f.shiftKey?3:1)*this._zoomKeys[k]);else if(k===27&&P._popup&&P._popup.options.closeOnEscapeKey)P.closePopup();else return;Fn(f)}}});Cr.addInitHook("addHandler","keyboard",Bc),Cr.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Kr=Qi.extend({addHooks:function(){sr(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){$r(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(f){var k=Ds(f),P=this._map.options.wheelDebounceTime;this._delta+=k,this._lastMousePos=this._map.mouseEventToContainerPoint(f),this._startTime||(this._startTime=+new Date);var H=Math.max(P-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s(this._performZoom,this),H),Fn(f)},_performZoom:function(){var f=this._map,k=f.getZoom(),P=this._map.options.zoomSnap||0;f._stop();var H=this._delta/(this._map.options.wheelPxPerZoomLevel*4),J=4*Math.log(2/(1+Math.exp(-Math.abs(H))))/Math.LN2,ce=P?Math.ceil(J/P)*P:J,we=f._limitZoom(k+(this._delta>0?ce:-ce))-k;this._delta=0,this._startTime=null,we&&(f.options.scrollWheelZoom==="center"?f.setZoom(k+we):f.setZoomAround(this._lastMousePos,k+we))}});Cr.addInitHook("addHandler","scrollWheelZoom",Kr);var zc=600;Cr.mergeOptions({tapHold:Et.touchNative&&Et.safari&&Et.mobile,tapTolerance:15});var nu=Qi.extend({addHooks:function(){sr(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){$r(this._map._container,"touchstart",this._onDown,this)},_onDown:function(f){if(clearTimeout(this._holdTimeout),f.touches.length===1){var k=f.touches[0];this._startPos=this._newPos=new Q(k.clientX,k.clientY),this._holdTimeout=setTimeout(s(function(){this._cancel(),this._isTapValid()&&(sr(document,"touchend",fn),sr(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",k))},this),zc),sr(document,"touchend touchcancel contextmenu",this._cancel,this),sr(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function f(){$r(document,"touchend",fn),$r(document,"touchend touchcancel",f)},_cancel:function(){clearTimeout(this._holdTimeout),$r(document,"touchend touchcancel contextmenu",this._cancel,this),$r(document,"touchmove",this._onMove,this)},_onMove:function(f){var k=f.touches[0];this._newPos=new Q(k.clientX,k.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(f,k){var P=new MouseEvent(f,{bubbles:!0,cancelable:!0,view:window,screenX:k.screenX,screenY:k.screenY,clientX:k.clientX,clientY:k.clientY});P._simulated=!0,k.target.dispatchEvent(P)}});Cr.addInitHook("addHandler","tapHold",nu),Cr.mergeOptions({touchZoom:Et.touch,bounceAtZoomLimits:!0});var Oo=Qi.extend({addHooks:function(){zt(this._map._container,"leaflet-touch-zoom"),sr(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Ir(this._map._container,"leaflet-touch-zoom"),$r(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(f){var k=this._map;if(!(!f.touches||f.touches.length!==2||k._animatingZoom||this._zooming)){var P=k.mouseEventToContainerPoint(f.touches[0]),H=k.mouseEventToContainerPoint(f.touches[1]);this._centerPoint=k.getSize()._divideBy(2),this._startLatLng=k.containerPointToLatLng(this._centerPoint),k.options.touchZoom!=="center"&&(this._pinchStartLatLng=k.containerPointToLatLng(P.add(H)._divideBy(2))),this._startDist=P.distanceTo(H),this._startZoom=k.getZoom(),this._moved=!1,this._zooming=!0,k._stop(),sr(document,"touchmove",this._onTouchMove,this),sr(document,"touchend touchcancel",this._onTouchEnd,this),fn(f)}},_onTouchMove:function(f){if(!(!f.touches||f.touches.length!==2||!this._zooming)){var k=this._map,P=k.mouseEventToContainerPoint(f.touches[0]),H=k.mouseEventToContainerPoint(f.touches[1]),J=P.distanceTo(H)/this._startDist;if(this._zoom=k.getScaleZoom(J,this._startZoom),!k.options.bounceAtZoomLimits&&(this._zoom<k.getMinZoom()&&J<1||this._zoom>k.getMaxZoom()&&J>1)&&(this._zoom=k._limitZoom(this._zoom)),k.options.touchZoom==="center"){if(this._center=this._startLatLng,J===1)return}else{var ce=P._add(H)._divideBy(2)._subtract(this._centerPoint);if(J===1&&ce.x===0&&ce.y===0)return;this._center=k.unproject(k.project(this._pinchStartLatLng,this._zoom).subtract(ce),this._zoom)}this._moved||(k._moveStart(!0,!1),this._moved=!0),q(this._animRequest);var we=s(k._move,k,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=V(we,this,!0),fn(f)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,q(this._animRequest),$r(document,"touchmove",this._onTouchMove,this),$r(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Cr.addInitHook("addHandler","touchZoom",Oo),Cr.BoxZoom=uo,Cr.DoubleClickZoom=Ch,Cr.Drag=Gu,Cr.Keyboard=Bc,Cr.ScrollWheelZoom=Kr,Cr.TapHold=nu,Cr.TouchZoom=Oo,r.Bounds=X,r.Browser=Et,r.CRS=ae,r.Canvas=Ic,r.Circle=fl,r.CircleMarker=Ya,r.Class=U,r.Control=ii,r.DivIcon=ru,r.DivOverlay=ra,r.DomEvent=Wl,r.DomUtil=br,r.Draggable=_n,r.Evented=K,r.FeatureGroup=Ji,r.GeoJSON=ea,r.GridLayer=bi,r.Handler=Qi,r.Icon=Ca,r.ImageOverlay=Bs,r.LatLng=se,r.LatLngBounds=he,r.Layer=Ka,r.LayerGroup=js,r.LineUtil=cl,r.Map=Cr,r.Marker=Pi,r.Mixin=ju,r.Path=oo,r.Point=Q,r.PolyUtil=Df,r.Polygon=Ea,r.Polyline=Mi,r.Popup=Ao,r.PosAnimation=Iu,r.Projection=Ac,r.Rectangle=_h,r.Renderer=vs,r.SVG=Lo,r.SVGOverlay=Un,r.TileLayer=Qa,r.Tooltip=An,r.Transformation=ue,r.Util=D,r.VideoOverlay=ln,r.bind=s,r.bounds=re,r.canvas=jc,r.circle=Xl,r.circleMarker=lo,r.control=ba,r.divIcon=Dc,r.extend=i,r.featureGroup=_a,r.geoJSON=Oc,r.geoJson=ta,r.gridLayer=wi,r.icon=Rc,r.imageOverlay=Mo,r.latLng=fe,r.latLngBounds=oe,r.layerGroup=dl,r.map=yi,r.marker=wh,r.point=te,r.polygon=Xa,r.polyline=Ff,r.popup=tu,r.rectangle=Fc,r.setOptions=S,r.stamp=l,r.svg=Ro,r.svgOverlay=eu,r.tileLayer=Uu,r.tooltip=ml,r.transformation=xe,r.version=n,r.videoOverlay=zn;var Eh=window.L;r.noConflict=function(){return window.L=Eh,this},window.L=r}))})(Kg,Kg.exports)),Kg.exports}var Vd=SH();const U1=Tf(Vd);function N_(t,e,r){return Object.freeze({instance:t,context:e,container:r})}function zL(t,e){return e==null?function(n,i){const a=ie.useRef();return a.current||(a.current=t(n,i)),a}:function(n,i){const a=ie.useRef();a.current||(a.current=t(n,i));const s=ie.useRef(n),{instance:o}=a.current;return ie.useEffect(function(){s.current!==n&&(e(o,n,s.current),s.current=n)},[o,n,i]),a}}function kH(t,e){ie.useEffect(function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){e.layerContainer?.removeLayer(t.instance),e.map.removeLayer(t.instance)}},[e,t])}function _H(t){return function(r){const n=T_(),i=t(BL(r,n),n);return OL(n.map,r.attribution),FL(i.current,r.eventHandlers),kH(i.current,n),i}}function UL(t,e){const r=zL(t,e),n=_H(r);return yH(n)}function CH(t,e){const r=zL(t),n=bH(r,e);return xH(n)}function EH(t,e,r){e.bounds instanceof Vd.LatLngBounds&&e.bounds!==r.bounds&&t.setBounds(e.bounds),e.opacity!=null&&e.opacity!==r.opacity&&t.setOpacity(e.opacity),e.zIndex!=null&&e.zIndex!==r.zIndex&&t.setZIndex(e.zIndex)}function TH(){return T_().map}const NH=UL(function({bounds:e,url:r,...n},i){const a=new Vd.ImageOverlay(r,e,n);return N_(a,DL(i,{overlayContainer:a}))},function(e,r,n){if(EH(e,r,n),r.bounds!==n.bounds){const i=r.bounds instanceof Vd.LatLngBounds?r.bounds:new Vd.LatLngBounds(r.bounds);e.setBounds(i)}r.url!==n.url&&e.setUrl(r.url)});function tk(){return tk=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},tk.apply(this,arguments)}function PH({bounds:t,boundsOptions:e,center:r,children:n,className:i,id:a,placeholder:s,style:o,whenReady:l,zoom:u,...c},h){const[p]=ie.useState({className:i,id:a,style:o}),[g,y]=ie.useState(null);ie.useImperativeHandle(h,()=>g?.map??null,[g]);const S=ie.useCallback(C=>{if(C!==null&&g===null){const _=new Vd.Map(C,c);r!=null&&u!=null?_.setView(r,u):t!=null&&_.fitBounds(t,e),l!=null&&_.whenReady(l),y(vH(_))}},[]);ie.useEffect(()=>()=>{g?.map.remove()},[g]);const w=g?ir.createElement(jL,{value:g},n):s??null;return ir.createElement("div",tk({},p,{ref:S}),w)}const MH=ie.forwardRef(PH),AH=UL(function({position:e,...r},n){const i=new Vd.Marker(e,r);return N_(i,DL(n,{overlayContainer:i}))},function(e,r,n){r.position!==n.position&&e.setLatLng(r.position),r.icon!=null&&r.icon!==n.icon&&e.setIcon(r.icon),r.zIndexOffset!=null&&r.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(r.zIndexOffset),r.opacity!=null&&r.opacity!==n.opacity&&e.setOpacity(r.opacity),e.dragging!=null&&r.draggable!==n.draggable&&(r.draggable===!0?e.dragging.enable():e.dragging.disable())}),LH=CH(function(e,r){const n=new Vd.Popup(e,r.overlayContainer);return N_(n,r)},function(e,r,{position:n},i){ie.useEffect(function(){const{instance:s}=e;function o(u){u.popup===s&&(s.update(),i(!0))}function l(u){u.popup===s&&i(!1)}return r.map.on({popupopen:o,popupclose:l}),r.overlayContainer==null?(n!=null&&s.setLatLng(n),s.openOn(r.map)):r.overlayContainer.bindPopup(s),function(){r.map.off({popupopen:o,popupclose:l}),r.overlayContainer?.unbindPopup(),r.map.removeLayer(s)}},[e,r,i,n])});delete U1.Icon.Default.prototype._getIconUrl;U1.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const RH=(t="default")=>{const e=`
        <div class="custom-marker-icon marker-${t}">
            <span class="material-symbols-outlined" style="font-size: 18px; color: white;">
                ${OH(t)}
            </span>
        </div>
    `;return U1.divIcon({html:e,className:"custom-leaflet-marker",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]})},OH=t=>{const e={city:"location_city",dungeon:"castle",landmark:"place",battle:"swords",default:"location_on"};return e[t]||e.default},DH=({bounds:t})=>{const e=TH();return ir.useEffect(()=>{t&&e.fitBounds(t)},[e,t]),null},IH=({mapImage:t,markers:e=[],onMarkerClick:r,imageWidth:n=1920,imageHeight:i=1080})=>{const a=ie.useMemo(()=>[[0,0],[i,n]],[n,i]),s=ie.useMemo(()=>[i/2,n/2],[n,i]),o=e.length>0?e:[];return m.jsxs("div",{className:"w-full h-full relative",children:[m.jsxs(MH,{center:s,zoom:0,minZoom:-2,maxZoom:3,crs:U1.CRS.Simple,style:{height:"100%",width:"100%",background:"#0a0a0c"},zoomControl:!0,attributionControl:!1,children:[t&&m.jsx(NH,{url:t,bounds:a,opacity:1}),m.jsx(DH,{bounds:a}),o.map((l,u)=>{const c=l.position||[i/2,n/2];return m.jsx(AH,{position:c,icon:RH(l.type),eventHandlers:{click:()=>{r&&r(l)}},children:m.jsx(LH,{children:m.jsxs("div",{className:"space-y-2",children:[m.jsx("h3",{className:"text-white font-bold",children:l.label||"Unnamed Location"}),l.description&&m.jsx("p",{className:"text-slate-400 text-sm",children:l.description}),l.entityId&&m.jsxs("a",{href:`#/entity/${l.entityId}`,className:"text-primary hover:underline text-sm inline-flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"open_in_new"}),"View Details"]})]})})},l.id||u)})]}),o.length>0&&m.jsxs("div",{className:"absolute bottom-4 left-4 bg-surface-dark/90 backdrop-blur-xl border border-white/10 rounded-2xl p-4 max-w-xs z-[1000]",children:[m.jsxs("h4",{className:"text-white font-bold text-sm mb-2 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary",children:"map"}),"Locations (",o.length,")"]}),m.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto no-scrollbar",children:[o.slice(0,10).map((l,u)=>m.jsxs("div",{className:"text-xs text-slate-400 flex items-center gap-2 hover:text-white cursor-pointer transition-colors",onClick:()=>r&&r(l),children:[m.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),l.label||`Location ${u+1}`]},l.id||u)),o.length>10&&m.jsxs("p",{className:"text-xs text-slate-500 italic",children:["+",o.length-10," more..."]})]})]})]})},jH=({map:t})=>{const{t:e}=Ps(),[r,n]=ie.useState(null),{setRightPanelContent:i,setRightOpen:a,setRightPanelTitle:s}=bo(),o=t?.nombre||e("maps.explorer"),l=t?.attributes||{};let u={};if(!l.bgImage&&t?.descripcion&&t?.descripcion.startsWith("{"))try{u=JSON.parse(t.descripcion)}catch{}let c=l.bgImage||u.bgImage||t?.iconUrl||null;c&&(c.toLowerCase().includes("duckdns")||c.toLowerCase().includes("nopreview"))&&(c=null);const h=l.markers||[],p=l.imageWidth||1920,g=l.imageHeight||1080;ie.useEffect(()=>{setRightPanelTab("CONTEXT"),s(m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[10px] text-primary font-black uppercase tracking-widest leading-none mb-1",children:"Explorador de Atlas"}),m.jsx("span",{className:"text-white font-serif font-black text-lg truncate",children:o})]})),r?(i(m.jsxs("div",{className:"flex flex-col h-full gap-8 p-6 animate-in slide-in-from-right-4 duration-300 custom-scrollbar overflow-y-auto",children:[m.jsxs("header",{className:"space-y-6",children:[m.jsxs("div",{className:"relative aspect-[4/3] rounded-3xl overflow-hidden border border-white/10 shadow-xl group",children:[m.jsx("img",{src:"https://images.unsplash.com/photo-1533154683836-84ea7a0bc310?auto=format&fit=crop&w=500&q=80",alt:"Detail",className:"w-full h-full object-cover grayscale-[0.4] group-hover:grayscale-0 transition-all duration-700"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background-dark via-transparent to-transparent"}),m.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:m.jsx("button",{onClick:()=>n(null),className:"size-8 rounded-lg bg-black/40 border border-white/10 backdrop-blur-md text-white flex items-center justify-center hover:bg-black/60 transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})}),m.jsx("div",{className:"absolute bottom-4 left-4 flex gap-2",children:m.jsx("span",{className:"px-3 py-1 rounded bg-primary/20 text-primary border border-primary/20 text-[8px] font-black uppercase tracking-widest backdrop-blur-md",children:e("maps.place")})})]}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-2xl font-black text-white leading-tight mb-2",children:r.label||"Ubicacin Desconocida"}),m.jsx("p",{className:"text-slate-500 font-medium text-xs leading-relaxed",children:r.description||"Sin descripcin disponible."})]})]}),m.jsxs("div",{className:"space-y-8",children:[m.jsxs("section",{className:"space-y-4",children:[m.jsx("div",{className:"flex justify-between items-center px-1",children:m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:e("maps.inhabitants")})}),m.jsx("div",{className:"space-y-3",children:m.jsx(FH,{name:"Personaje A",role:"Rol A"})})]}),m.jsxs("section",{className:"space-y-4 pt-6 border-t border-white/5",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Herramientas"}),m.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[m.jsxs("button",{className:"flex items-center gap-3 p-3 rounded-xl bg-white/[0.03] border border-white/5 text-[10px] font-black uppercase text-slate-400 hover:text-white hover:bg-white/10 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"layers"}),"Gestionar Multicapas"]}),m.jsxs("button",{className:"flex items-center gap-3 p-3 rounded-xl bg-white/[0.03] border border-white/5 text-[10px] font-black uppercase text-slate-400 hover:text-white hover:bg-white/10 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"settings_ethernet"}),"Relaciones N:M"]})]})]})]})]})),a(!0)):i(m.jsxs("div",{className:"p-6 text-slate-500 text-center flex flex-col items-center justify-center h-full animate-in fade-in duration-500",children:[m.jsx("div",{className:"size-20 rounded-full bg-primary/5 flex items-center justify-center mb-6 border border-primary/10",children:m.jsx("span",{className:"material-symbols-outlined text-4xl text-primary opacity-40",children:"explore"})}),m.jsx("h3",{className:"text-white font-serif font-black mb-2 text-xl",children:o}),m.jsx("p",{className:"text-xs max-w-[200px] leading-relaxed opacity-60",children:"Navega por el mapa e interacta con los puntos de inters para ver detalles especficos."}),m.jsxs("div",{className:"mt-12 w-full space-y-4 border-t border-white/5 pt-8",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-600 text-left px-2 mb-4",children:"Herramientas Globales"}),m.jsxs("button",{className:"w-full p-4 rounded-2xl bg-white/[0.02] border border-white/5 flex items-center gap-4 hover:bg-white/[0.05] hover:border-primary/20 transition-all group",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary group-hover:scale-110 transition-transform shadow-lg shadow-primary/5",children:m.jsx("span",{className:"material-symbols-outlined",children:"layers"})}),m.jsxs("div",{className:"text-left",children:[m.jsx("span",{className:"block text-[10px] font-black uppercase tracking-widest text-white mb-0.5",children:"Gestionar Multicapas"}),m.jsx("span",{className:"block text-[9px] text-slate-500 font-medium normal-case tracking-normal",children:"Control de elevacin y estratos"})]})]}),m.jsxs("button",{className:"w-full p-4 rounded-2xl bg-white/[0.02] border border-white/5 flex items-center gap-4 hover:bg-white/[0.05] hover:border-primary/20 transition-all group",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary group-hover:scale-110 transition-transform shadow-lg shadow-primary/5",children:m.jsx("span",{className:"material-symbols-outlined",children:"settings_ethernet"})}),m.jsxs("div",{className:"text-left",children:[m.jsx("span",{className:"block text-[10px] font-black uppercase tracking-widest text-white mb-0.5",children:"Relaciones N:M"}),m.jsx("span",{className:"block text-[9px] text-slate-500 font-medium normal-case tracking-normal",children:"Conectar territorios y zonas"})]})]})]})]}))},[r,t]),ie.useEffect(()=>()=>{i(null),s(null),a(!1)},[]);const y=S=>{n(S),a(!0)};return m.jsx("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300 relative",children:m.jsx("main",{className:"flex-1 overflow-hidden relative group z-0",children:m.jsx("div",{className:"absolute inset-4 rounded-[2.5rem] overflow-hidden border border-white/5 shadow-2xl bg-surface-dark",children:c?m.jsx(IH,{mapImage:c,markers:h,onMarkerClick:y,imageWidth:p,imageHeight:g}):m.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-500",children:m.jsxs("div",{className:"text-center space-y-4",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl opacity-20",children:"map"}),m.jsx("p",{children:e("maps.not_found")}),m.jsx("p",{className:"text-xs text-slate-600",children:e("maps.upload_desc")})]})})})})})},FH=({name:t,role:e})=>m.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-2xl bg-white/[0.02] border border-white/5 hover:border-white/10 transition-all cursor-pointer group",children:[m.jsx(Kk,{name:t,size:"sm",className:"border-white/10 group-hover:border-primary/50 transition-all"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h4",{className:"text-xs font-bold text-white truncate",children:t}),m.jsx("p",{className:"text-[10px] text-slate-500 font-medium truncate",children:e})]}),m.jsx("span",{className:"material-symbols-outlined text-slate-700 text-sm group-hover:text-white transition-colors",children:"chevron_right"})]}),BH=({maps:t,onSelectMap:e,onCreateMap:r,onDeleteMap:n,onDuplicateMap:i})=>{const{t:a}=Ps(),{setRightPanelTab:s,setRightOpen:o=()=>{}}=bo(),[l,u]=ie.useState(""),[c,h]=ie.useState("ALL"),[p,g]=ie.useState(null),y=document.getElementById("global-right-panel-portal"),S=t.find(N=>N.id===p),w=t.filter(N=>{const R=N.nombre.toLowerCase().includes(l.toLowerCase()),I=c==="ALL"||(N.attributes?.spatialLevel||"TERRITORY")===c;return R&&I}),C=N=>{let R=N.attributes?.snapshotUrl||N.attributes?.bgImage||N.iconUrl;return R&&(R.toLowerCase().includes("duckdns")||R.toLowerCase().includes("nopreview"))?null:R},_=async(N,R,I)=>{try{const j={...N,attributes:{...N.attributes,[R]:I}};await Ke.put(`/world-bible/entities/${N.id}`,j),window.dispatchEvent(new CustomEvent("map-updated"))}catch(j){console.error("Error updating map attribute",j)}};ie.useEffect(()=>{p&&(s("CONTEXTO"),o(!0))},[p]);const T=()=>m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark animate-in slide-in-from-right duration-500",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 bg-gradient-to-br from-primary/10 to-transparent",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"info"})," ",a("atlas.map_details")||"Detalles del Mapa"]}),m.jsx("button",{onClick:()=>g(null),className:"text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),m.jsx("h4",{className:"text-lg font-serif font-black text-white truncate",children:S.nombre})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar",children:[m.jsx("div",{className:"aspect-[16/9] rounded-2xl bg-black/40 border border-white/5 overflow-hidden group",children:C(S)?m.jsx("img",{src:C(S),className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-700",alt:"Preview"}):m.jsx("div",{className:"w-full h-full flex items-center justify-center opacity-20",children:m.jsx("span",{className:"material-symbols-outlined text-4xl",children:"public"})})}),m.jsx(ti,{title:"JERARQUA ESPACIAL",icon:"layers",children:m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] font-black uppercase text-text-muted mb-2 block tracking-widest",children:"Nivel de Escala"}),m.jsxs("div",{className:"relative",children:[m.jsxs("select",{value:S.attributes?.spatialLevel||"TERRITORY",onChange:N=>_(S,"spatialLevel",N.target.value),className:"w-full appearance-none bg-black/40 border border-white/5 rounded-xl px-4 py-3 text-xs font-bold text-white transition-all hover:bg-white/5 focus:border-primary outline-none",children:[m.jsx("option",{value:"UNIVERSE",children:" UNIVERSO"}),m.jsx("option",{value:"GALAXY",children:" GALAXIA"}),m.jsx("option",{value:"PLANET",children:" CUERPO CELESTE"}),m.jsx("option",{value:"TERRITORY",children:" TERRITORIO"}),m.jsx("option",{value:"ZONE",children:" ZONA"})]}),m.jsx("span",{className:"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-xs text-text-muted pointer-events-none",children:"expand_more"})]})]}),m.jsx("p",{className:"text-[10px] text-slate-500 leading-relaxed italic",children:"Define la escala de este mapa para facilitar su bsqueda y organizacin en el Atlas."})]})}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 px-1",children:"Herramientas Globales"}),m.jsx(Dn,{variant:"secondary",className:"w-full justify-start py-3 bg-white/[0.02] border-white/5",icon:"layers",onClick:()=>{e(S)},children:"Gestionar Multicapas"}),m.jsx(Dn,{variant:"secondary",className:"w-full justify-start py-3 bg-white/[0.02] border-white/5",icon:"alt_route",onClick:()=>{e(S)},children:"Configurar Relaciones N:M"})]}),m.jsxs("div",{className:"space-y-3 pt-4 border-t border-white/5",children:[m.jsx(Dn,{variant:"primary",className:"w-full justify-center py-4 shadow-xl shadow-primary/20",icon:"visibility",onClick:()=>e(S),children:"Abrir Visionador"}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("button",{onClick:()=>i(S),className:"flex items-center justify-center gap-2 py-3 bg-white/5 hover:bg-white/10 rounded-xl text-[10px] font-black uppercase text-slate-300 transition-all border border-white/5",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"content_copy"}),"Duplicar"]}),m.jsxs("button",{onClick:()=>n(S),className:"flex items-center justify-center gap-2 py-3 bg-red-500/10 hover:bg-red-500/20 rounded-xl text-[10px] font-black uppercase text-red-400 transition-all border border-red-500/10",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"}),"Eliminar"]})]})]})]})]});return m.jsxs("div",{className:"flex-1 flex overflow-hidden bg-background-dark",children:[y&&S&&eo.createPortal(T(),y),m.jsxs("div",{className:"flex-1 p-8 overflow-y-auto",children:[m.jsx("div",{className:"max-w-7xl mx-auto space-y-8",children:m.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4 animate-in fade-in slide-in-from-top-4 duration-500",children:[m.jsxs("div",{children:[m.jsxs("h1",{className:"text-3xl font-black text-white uppercase tracking-tight flex items-center gap-3",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-4xl",children:"travel_explore"}),a("nav.atlas")||"Atlas"]}),m.jsx("p",{className:"text-sm text-slate-400 mt-2 max-w-xl",children:"Explora los territorios cartografiados de tu mundo. Gestiona mapas regionales, calabozos y planos astrales desde este centro de comando."})]}),m.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[m.jsxs("div",{className:"relative",children:[m.jsxs("select",{value:c,onChange:N=>h(N.target.value),className:"appearance-none bg-surface-dark border border-glass-border rounded-xl px-4 py-3 pr-10 text-xs font-bold text-white transition-all hover:bg-white/5 focus:border-primary outline-none",children:[m.jsx("option",{value:"ALL",children:"TODA LA ESCALA"}),m.jsx("option",{value:"UNIVERSE",children:"UNIVERSO"}),m.jsx("option",{value:"GALAXY",children:"GALAXIA"}),m.jsx("option",{value:"PLANET",children:"CUERPO CELESTE"}),m.jsx("option",{value:"TERRITORY",children:"TERRITORIO"}),m.jsx("option",{value:"ZONE",children:"ZONA"})]}),m.jsx("span",{className:"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-xs text-text-muted pointer-events-none",children:"expand_more"})]}),m.jsxs("div",{className:"relative flex-1 md:w-64",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500",children:"search"}),m.jsx("input",{type:"text",placeholder:"Buscar mapas...",value:l,onChange:N=>u(N.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl pl-10 pr-4 py-3 text-sm text-white focus:border-primary outline-none transition-all"})]})]})]})}),w.length===0?m.jsxs("div",{className:"flex flex-col items-center justify-center p-20 border-2 border-dashed border-white/5 rounded-3xl bg-white/[0.01] animate-in zoom-in-95 duration-500",children:[m.jsx("div",{className:"size-20 rounded-full bg-white/5 flex items-center justify-center mb-6",children:m.jsx("span",{className:"material-symbols-outlined text-4xl text-slate-600",children:"map"})}),m.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No hay mapas visibles"}),m.jsx("p",{className:"text-slate-500 mb-6 text-center max-w-md",children:"No se encontraron mapas con los filtros actuales."})]}):m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 animate-in fade-in duration-700 pt-12 pb-20",children:w.map((N,R)=>{const I=C(N),j=N.attributes?.layers?.length||0,O=N.attributes?.markers?.length||0;return m.jsxs(ti,{className:`group relative overflow-hidden border-white/5 hover:border-primary/50 transition-all duration-300 hover:-translate-y-1 cursor-pointer ${p===N.id?"ring-2 ring-primary bg-primary/5":""}`,onClick:()=>g(N.id),onDoubleClick:()=>e(N),children:[m.jsxs("div",{className:"aspect-[16/9] w-full bg-black/50 relative overflow-hidden border-b border-white/5",children:[I?m.jsx("img",{src:I,alt:N.nombre,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"}):m.jsxs("div",{className:"w-full h-full flex items-center justify-center bg-surface-light",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl text-white/10 group-hover:text-primary/50 transition-colors",children:"public"}),m.jsx("div",{className:"absolute inset-0 opacity-10 pointer-events-none",style:{backgroundImage:"radial-gradient(#fff 1px, transparent 1px)",backgroundSize:"20px 20px"}})]}),m.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 transform translate-y-[-150%] group-hover:translate-y-0 transition-transform duration-300",children:[i&&m.jsx("button",{onClick:F=>{F.stopPropagation(),i(N)},className:"p-2 bg-black/60 hover:bg-primary text-white rounded-lg backdrop-blur-sm transition-colors",title:"Duplicar Mapa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"content_copy"})}),n&&m.jsx("button",{onClick:F=>{F.stopPropagation(),n(N)},className:"p-2 bg-black/60 hover:bg-red-500 text-white rounded-lg backdrop-blur-sm transition-colors",title:"Eliminar Mapa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]})]}),m.jsxs("div",{className:"p-5",children:[m.jsxs("div",{className:"flex justify-between items-start mb-2",children:[m.jsx("h3",{className:"font-bold text-white text-lg truncate pr-2 group-hover:text-primary transition-colors",children:N.nombre}),m.jsx("span",{className:"shrink-0 text-[10px] font-black uppercase tracking-widest bg-white/5 text-slate-400 px-2 py-1 rounded border border-white/5",children:N.attributes?.spatialLevel||N.attributes?.mapType||"Territorio"})]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 font-medium mt-4",children:[m.jsxs("div",{className:"flex items-center gap-1.5",title:"Capas",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"layers"}),j]}),m.jsxs("div",{className:"flex items-center gap-1.5",title:"Marcadores",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"location_on"}),O]}),m.jsxs("div",{className:"flex-1 text-right text-[10px] uppercase tracking-wider opacity-50",children:["ID: ",N.id]})]})]})]},N.id)})})]})]})},zH=()=>{const{username:t,projectName:e}=Va(),r=Ga(),[n,i]=ie.useState("manager"),[a,s]=ie.useState([]),[o,l]=ie.useState(null),[u,c]=ie.useState(null),[h,p]=ie.useState(null);ir.useEffect(()=>{g();const C=()=>g();return window.addEventListener("map-updated",C),()=>window.removeEventListener("map-updated",C)},[]);const g=async()=>{try{const _=(await Ke.get("/world-bible/entities")).filter(T=>T.tipoEspecial==="map");s(_)}catch(C){console.error("Error loading maps",C)}},y=async C=>{try{const{id:_,slug:T,createdAt:N,updatedAt:R,...I}=C,j=await Ke.post("/world-bible/entities",{...I,nombre:`${C.nombre} (Copia)`,carpetaId:C.carpetaId||C.parent?.id,attributes:{...C.attributes,layers:(C.attributes?.layers||[]).map(O=>({...O,id:crypto.randomUUID()}))}});await g()}catch(_){console.error("Error duplicating map:",_),alert("Error al duplicar el mapa. Verifica la consola.")}},S=async()=>{if(h)try{await Ke.delete(`/world-bible/entities/${h.id}`),p(null),await g()}catch(C){console.error("Error deleting map",C)}},w=async(C,_,T)=>{try{const N=await Ke.get("/world-bible/folders"),R=N.find(j=>j.nombre.toLowerCase().includes("map"))||N[0];if(!R){console.error("No folders available to create map");return}const I=await Ke.post("/world-bible/entities",{nombre:_,carpetaId:R.id,tipoEspecial:"map",categoria:"Location",descripcion:"",iconUrl:"",attributes:{mapType:"regional",layers:[]}});c(I.id),i("wizard"),await g(),setTimeout(()=>{i("editor")},100)}catch(N){console.error("Error creating map:",N)}};return m.jsxs("div",{className:"flex-1 flex flex-col h-full bg-background-dark overflow-hidden",children:[n==="manager"&&m.jsx(BH,{maps:a,onSelectMap:C=>{l(C),i("viewer")},onCreateMap:()=>i("wizard"),onDuplicateMap:y,onDeleteMap:C=>p(C)}),n==="viewer"&&o&&m.jsxs("div",{className:"flex-1 flex flex-col h-full relative",children:[m.jsx("div",{className:"absolute top-4 left-4 z-[1001]",children:m.jsxs("button",{onClick:()=>{i("manager"),window.dispatchEvent(new CustomEvent("clear-right-panel"))},className:"bg-black/60 hover:bg-black/80 text-white backdrop-blur-md px-4 py-2 rounded-xl flex items-center gap-2 border border-white/10 transition-all font-bold text-sm",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"}),"Volver al Atlas"]})}),m.jsx(jH,{map:o})]}),n==="wizard"&&m.jsx(gG,{onCancel:()=>i((a.length>0,"manager")),onCreate:w}),n==="editor"&&m.jsx(ek,{mode:u?"create":"edit",entityId:u,onBack:()=>{i("manager"),c(null)},onSave:async()=>{await g(),u?r(`/local/${e}/entity/${u}`):i("manager"),c(null)}}),m.jsx(qv,{isOpen:!!h,onClose:()=>p(null),onConfirm:S,title:"Eliminar Mapa",message:`Ests seguro de que quieres eliminar el mapa "${h?.nombre}"? Esta accin no se puede deshacer.`,confirmText:"Eliminar",type:"danger"})]})};String.prototype.codePointAt||(function(){var t=(function(){try{var r={},n=Object.defineProperty,i=n(r,r,r)&&n}catch{}return i})(),e=function(r){if(this==null)throw TypeError();var n=String(this),i=n.length,a=r?Number(r):0;if(a!=a&&(a=0),!(a<0||a>=i)){var s=n.charCodeAt(a),o;return s>=55296&&s<=56319&&i>a+1&&(o=n.charCodeAt(a+1),o>=56320&&o<=57343)?(s-55296)*1024+o-56320+65536:s}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e})();function GL(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var UH=new GL,GH=new GL,VL=new Uint8Array(30),HL=new Uint16Array(30),VH=new Uint8Array(30),HH=new Uint16Array(30);function WL(t,e,r,n){var i,a;for(i=0;i<r;++i)t[i]=0;for(i=0;i<30-r;++i)t[i+r]=i/r|0;for(a=n,i=0;i<30;++i)e[i]=a,a+=1<<t[i]}function WH(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[168+r]=280+r;for(r=0;r<112;++r)t.trans[176+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}WH(UH,GH);WL(VL,HL,4,3);WL(VH,HH,2,1);VL[28]=0;HL[28]=258;function Sp(t,e,r,n,i){return Math.pow(1-i,3)*t+3*Math.pow(1-i,2)*i*e+3*(1-i)*Math.pow(i,2)*r+Math.pow(i,3)*n}function dh(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}dh.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};dh.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};dh.prototype.addX=function(t){this.addPoint(t,null)};dh.prototype.addY=function(t){this.addPoint(null,t)};dh.prototype.addBezier=function(t,e,r,n,i,a,s,o){var l=[t,e],u=[r,n],c=[i,a],h=[s,o];this.addPoint(t,e),this.addPoint(s,o);for(var p=0;p<=1;p++){var g=6*l[p]-12*u[p]+6*c[p],y=-3*l[p]+9*u[p]-9*c[p]+3*h[p],S=3*u[p]-3*l[p];if(y===0){if(g===0)continue;var w=-S/g;0<w&&w<1&&(p===0&&this.addX(Sp(l[p],u[p],c[p],h[p],w)),p===1&&this.addY(Sp(l[p],u[p],c[p],h[p],w)));continue}var C=Math.pow(g,2)-4*S*y;if(!(C<0)){var _=(-g+Math.sqrt(C))/(2*y);0<_&&_<1&&(p===0&&this.addX(Sp(l[p],u[p],c[p],h[p],_)),p===1&&this.addY(Sp(l[p],u[p],c[p],h[p],_)));var T=(-g-Math.sqrt(C))/(2*y);0<T&&T<1&&(p===0&&this.addX(Sp(l[p],u[p],c[p],h[p],T)),p===1&&this.addY(Sp(l[p],u[p],c[p],h[p],T)))}}};dh.prototype.addQuad=function(t,e,r,n,i,a){var s=t+.6666666666666666*(r-t),o=e+2/3*(n-e),l=s+1/3*(i-t),u=o+1/3*(a-e);this.addBezier(t,e,s,o,l,u,i,a)};function $i(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}$i.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})};$i.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})};$i.prototype.curveTo=$i.prototype.bezierCurveTo=function(t,e,r,n,i,a){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:i,y:a})};$i.prototype.quadTo=$i.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})};$i.prototype.close=$i.prototype.closePath=function(){this.commands.push({type:"Z"})};$i.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof dh){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)};$i.prototype.getBoundingBox=function(){for(var t=new dh,e=0,r=0,n=0,i=0,a=0;a<this.commands.length;a++){var s=this.commands[a];switch(s.type){case"M":t.addPoint(s.x,s.y),e=n=s.x,r=i=s.y;break;case"L":t.addPoint(s.x,s.y),n=s.x,i=s.y;break;case"Q":t.addQuad(n,i,s.x1,s.y1,s.x,s.y),n=s.x,i=s.y;break;case"C":t.addBezier(n,i,s.x1,s.y1,s.x2,s.y2,s.x,s.y),n=s.x,i=s.y;break;case"Z":n=e,i=r;break;default:throw new Error("Unexpected path command "+s.type)}}return t.isEmpty()&&t.addPoint(0,0),t};$i.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())};$i.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(s){return Math.round(s)===s?""+Math.round(s):s.toFixed(t)}function r(){for(var s=arguments,o="",l=0;l<arguments.length;l+=1){var u=s[l];u>=0&&l>0&&(o+=" "),o+=e(u)}return o}for(var n="",i=0;i<this.commands.length;i+=1){var a=this.commands[i];a.type==="M"?n+="M"+r(a.x,a.y):a.type==="L"?n+="L"+r(a.x,a.y):a.type==="C"?n+="C"+r(a.x1,a.y1,a.x2,a.y2,a.x,a.y):a.type==="Q"?n+="Q"+r(a.x1,a.y1,a.x,a.y):a.type==="Z"&&(n+="Z")}return n};$i.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};$i.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function qL(t){throw new Error(t)}function k4(t,e){t||qL(e)}var pr={fail:qL,argument:k4,assert:k4},_4=32768,C4=2147483648,Kp={},Nt={},lr={};function zl(t){return function(){return t}}Nt.BYTE=function(t){return pr.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]};lr.BYTE=zl(1);Nt.CHAR=function(t){return[t.charCodeAt(0)]};lr.CHAR=zl(1);Nt.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e};lr.CHARARRAY=function(t){return typeof t>"u"?0:t.length};Nt.USHORT=function(t){return[t>>8&255,t&255]};lr.USHORT=zl(2);Nt.SHORT=function(t){return t>=_4&&(t=-(2*_4-t)),[t>>8&255,t&255]};lr.SHORT=zl(2);Nt.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]};lr.UINT24=zl(3);Nt.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]};lr.ULONG=zl(4);Nt.LONG=function(t){return t>=C4&&(t=-(2*C4-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]};lr.LONG=zl(4);Nt.FIXED=Nt.ULONG;lr.FIXED=lr.ULONG;Nt.FWORD=Nt.SHORT;lr.FWORD=lr.SHORT;Nt.UFWORD=Nt.USHORT;lr.UFWORD=lr.USHORT;Nt.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]};lr.LONGDATETIME=zl(8);Nt.TAG=function(t){return pr.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]};lr.TAG=zl(4);Nt.Card8=Nt.BYTE;lr.Card8=lr.BYTE;Nt.Card16=Nt.USHORT;lr.Card16=lr.USHORT;Nt.OffSize=Nt.BYTE;lr.OffSize=lr.BYTE;Nt.SID=Nt.USHORT;lr.SID=lr.USHORT;Nt.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?Nt.NUMBER16(t):Nt.NUMBER32(t)};lr.NUMBER=function(t){return Nt.NUMBER(t).length};Nt.NUMBER16=function(t){return[28,t>>8&255,t&255]};lr.NUMBER16=zl(3);Nt.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]};lr.NUMBER32=zl(5);Nt.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var i="",a=0,s=e.length;a<s;a+=1){var o=e[a];o==="e"?i+=e[++a]==="-"?"c":"b":o==="."?i+="a":o==="-"?i+="e":i+=o}i+=i.length&1?"f":"ff";for(var l=[30],u=0,c=i.length;u<c;u+=2)l.push(parseInt(i.substr(u,2),16));return l};lr.REAL=function(t){return Nt.REAL(t).length};Nt.NAME=Nt.CHARARRAY;lr.NAME=lr.CHARARRAY;Nt.STRING=Nt.CHARARRAY;lr.STRING=lr.CHARARRAY;Kp.UTF8=function(t,e,r){for(var n=[],i=r,a=0;a<i;a++,e+=1)n[a]=t.getUint8(e);return String.fromCharCode.apply(null,n)};Kp.UTF16=function(t,e,r){for(var n=[],i=r/2,a=0;a<i;a++,e+=2)n[a]=t.getUint16(e);return String.fromCharCode.apply(null,n)};Nt.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e};lr.UTF16=function(t){return t.length*2};var rk={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};Kp.MACSTRING=function(t,e,r,n){var i=rk[n];if(i!==void 0){for(var a="",s=0;s<r;s++){var o=t.getUint8(e+s);o<=127?a+=String.fromCharCode(o):a+=i[o&127]}return a}};var py=typeof WeakMap=="function"&&new WeakMap,my,qH=function(t){if(!my){my={};for(var e in rk)my[e]=new String(e)}var r=my[t];if(r!==void 0){if(py){var n=py.get(r);if(n!==void 0)return n}var i=rk[t];if(i!==void 0){for(var a={},s=0;s<i.length;s++)a[i.charCodeAt(s)]=s+128;return py&&py.set(r,a),a}}};Nt.MACSTRING=function(t,e){var r=qH(e);if(r!==void 0){for(var n=[],i=0;i<t.length;i++){var a=t.charCodeAt(i);if(a>=128&&(a=r[a],a===void 0))return;n[i]=a}return n}};lr.MACSTRING=function(t,e){var r=Nt.MACSTRING(t,e);return r!==void 0?r.length:0};function nk(t){return t>=-128&&t<=127}function $H(t,e,r){for(var n=0,i=t.length;e<i&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function KH(t,e,r){for(var n=0,i=t.length,a=e;a<i&&n<64;){var s=t[a];if(!nk(s)||s===0&&a+1<i&&t[a+1]===0)break;++a,++n}r.push(n-1);for(var o=e;o<a;++o)r.push(t[o]+256&255);return a}function ZH(t,e,r){for(var n=0,i=t.length,a=e;a<i&&n<64;){var s=t[a];if(s===0||nk(s)&&a+1<i&&nk(t[a+1]))break;++a,++n}r.push(64|n-1);for(var o=e;o<a;++o){var l=t[o];r.push(l+65536>>8&255,l+256&255)}return a}Nt.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=$H(t,e,r):n>=-128&&n<=127?e=KH(t,e,r):e=ZH(t,e,r)}return r};Nt.INDEX=function(t){for(var e=1,r=[e],n=[],i=0;i<t.length;i+=1){var a=Nt.OBJECT(t[i]);Array.prototype.push.apply(n,a),e+=a.length,r.push(e)}if(n.length===0)return[0,0];for(var s=[],o=1+Math.floor(Math.log(e)/Math.log(2))/8|0,l=[void 0,Nt.BYTE,Nt.USHORT,Nt.UINT24,Nt.ULONG][o],u=0;u<r.length;u+=1){var c=l(r[u]);Array.prototype.push.apply(s,c)}return Array.prototype.concat(Nt.Card16(t.length),Nt.OffSize(o),s,n)};lr.INDEX=function(t){return Nt.INDEX(t).length};Nt.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,i=0;i<n;i+=1){var a=parseInt(r[i],0),s=t[a];e=e.concat(Nt.OPERAND(s.value,s.type)),e=e.concat(Nt.OPERATOR(a))}return e};lr.DICT=function(t){return Nt.DICT(t).length};Nt.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]};Nt.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)pr.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(Nt.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(Nt.NUMBER(t));else if(e==="offset")r=r.concat(Nt.NUMBER32(t));else if(e==="number")r=r.concat(Nt.NUMBER(t));else if(e==="real")r=r.concat(Nt.REAL(t));else throw new Error("Unknown operand type "+e);return r};Nt.OP=Nt.BYTE;lr.OP=lr.BYTE;var gy=typeof WeakMap=="function"&&new WeakMap;Nt.CHARSTRING=function(t){if(gy){var e=gy.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,i=0;i<n;i+=1){var a=t[i];r=r.concat(Nt[a.type](a.value))}return gy&&gy.set(t,r),r};lr.CHARSTRING=function(t){return Nt.CHARSTRING(t).length};Nt.OBJECT=function(t){var e=Nt[t.type];return pr.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)};lr.OBJECT=function(t){var e=lr[t.type];return pr.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)};Nt.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],i=[],a=0;a<r;a+=1){var s=t.fields[a],o=Nt[s.type];pr.argument(o!==void 0,"No encoding function for field type "+s.type+" ("+s.name+")");var l=t[s.name];l===void 0&&(l=s.value);var u=o(l);s.type==="TABLE"?(i.push(e.length),e=e.concat([0,0]),n.push(u)):e=e.concat(u)}for(var c=0;c<n.length;c+=1){var h=i[c],p=e.length;pr.argument(p<65536,"Table "+t.tableName+" too big."),e[h]=p>>8,e[h+1]=p&255,e=e.concat(n[c])}return e};lr.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var i=t.fields[n],a=lr[i.type];pr.argument(a!==void 0,"No sizeOf function for field type "+i.type+" ("+i.name+")");var s=t[i.name];s===void 0&&(s=i.value),e+=a(s),i.type==="TABLE"&&(e+=2)}return e};Nt.RECORD=Nt.TABLE;lr.RECORD=lr.TABLE;Nt.LITERAL=function(t){return t};lr.LITERAL=function(t){return t.length};function fa(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var i=e[n];this[i.name]=i.value}if(this.tableName=t,this.fields=e,r)for(var a=Object.keys(r),s=0;s<a.length;s+=1){var o=a[s],l=r[o];this[o]!==void 0&&(this[o]=l)}}fa.prototype.encode=function(){return Nt.TABLE(this)};fa.prototype.sizeOf=function(){return lr.TABLE(this)};function Pv(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var i=0;i<e.length;i++)n[i+1]={name:t+i,type:"USHORT",value:e[i]};return n}function ik(t,e,r){var n=e.length,i=new Array(n+1);i[0]={name:t+"Count",type:"USHORT",value:n};for(var a=0;a<n;a++)i[a+1]={name:t+a,type:"TABLE",value:r(e[a],a)};return i}function Mv(t,e,r){var n=e.length,i=[];i[0]={name:t+"Count",type:"USHORT",value:n};for(var a=0;a<n;a++)i=i.concat(r(e[a],a));return i}function xx(t){t.format===1?fa.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Pv("glyph",t.glyphs))):t.format===2?fa.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(Mv("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):pr.assert(!1,"Coverage format must be 1 or 2.")}xx.prototype=Object.create(fa.prototype);xx.prototype.constructor=xx;function bx(t){fa.call(this,"scriptListTable",Mv("scriptRecord",t,function(e,r){var n=e.script,i=n.defaultLangSys;return pr.assert(!!i,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new fa("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new fa("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:i.reqFeatureIndex}].concat(Pv("featureIndex",i.featureIndexes)))}].concat(Mv("langSys",n.langSysRecords,function(a,s){var o=a.langSys;return[{name:"langSysTag"+s,type:"TAG",value:a.tag},{name:"langSys"+s,type:"TABLE",value:new fa("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(Pv("featureIndex",o.featureIndexes)))}]})))}]}))}bx.prototype=Object.create(fa.prototype);bx.prototype.constructor=bx;function wx(t){fa.call(this,"featureListTable",Mv("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new fa("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(Pv("lookupListIndex",n.lookupListIndexes)))}]}))}wx.prototype=Object.create(fa.prototype);wx.prototype.constructor=wx;function Sx(t,e){fa.call(this,"lookupListTable",ik("lookup",t,function(r){var n=e[r.lookupType];return pr.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new fa("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(ik("subtable",r.subtables,n)))}))}Sx.prototype=Object.create(fa.prototype);Sx.prototype.constructor=Sx;var Ht={Table:fa,Record:fa,Coverage:xx,ScriptList:bx,FeatureList:wx,LookupList:Sx,ushortList:Pv,tableList:ik,recordList:Mv};function E4(t,e){return t.getUint8(e)}function kx(t,e){return t.getUint16(e,!1)}function YH(t,e){return t.getInt16(e,!1)}function P_(t,e){return t.getUint32(e,!1)}function $L(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function XH(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function QH(t,e,r){for(var n=0,i=0;i<r;i+=1)n<<=8,n+=t.getUint8(e+i);return n}function JH(t,e,r){for(var n=[],i=e;i<r;i+=1)n.push(t.getUint8(i));return n}function eW(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var tW={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function We(t,e){this.data=t,this.offset=e,this.relativeOffset=0}We.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};We.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};We.prototype.parseCard8=We.prototype.parseByte;We.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};We.prototype.parseCard16=We.prototype.parseUShort;We.prototype.parseSID=We.prototype.parseUShort;We.prototype.parseOffset16=We.prototype.parseUShort;We.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};We.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t};We.prototype.parseULong=function(){var t=P_(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};We.prototype.parseOffset32=We.prototype.parseULong;We.prototype.parseFixed=function(){var t=$L(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};We.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var i=0;i<t;i++)n+=String.fromCharCode(e.getUint8(r+i));return n};We.prototype.parseTag=function(){return this.parseString(4)};We.prototype.parseLongDateTime=function(){var t=P_(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t};We.prototype.parseVersion=function(t){var e=kx(this.data,this.offset+this.relativeOffset),r=kx(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10};We.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=tW[t]*e};We.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e};We.prototype.parseOffset16List=We.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e};We.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e};We.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint8(n++);return this.relativeOffset+=t,e};We.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};We.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};We.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),i=0;i<t;i++){for(var a={},s=0;s<n.length;s++){var o=n[s],l=e[o];a[o]=l.call(this)}r[i]=a}return r};We.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),i=0;i<t;i++){for(var a={},s=0;s<n.length;s++){var o=n[s],l=e[o];a[o]=l.call(this)}r[i]=a}return r};We.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var i=e[n],a=t[i];r[i]=a.call(this)}return r};We.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};We.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r};We.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new We(this.data,this.offset+e).parseStruct(t)};We.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new We(this.data,this.offset+e).parseStruct(t)};We.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,i=new Array(r),a=0;a<r;a++){var s=e[a];if(s===0){i[a]=void 0;continue}if(this.relativeOffset=s,t){for(var o=this.parseOffset16List(),l=new Array(o.length),u=0;u<o.length;u++)this.relativeOffset=s+o[u],l[u]=t.call(this);i[a]=l}else i[a]=this.parseUShortList()}return this.relativeOffset=n,i};We.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),i=0;i<r;i++)n[i]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")};We.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:We.uShort,end:We.uShort,classId:We.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")};We.list=function(t,e){return function(){return this.parseList(t,e)}};We.list32=function(t,e){return function(){return this.parseList32(t,e)}};We.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}};We.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}};We.pointer=function(t){return function(){return this.parsePointer(t)}};We.pointer32=function(t){return function(){return this.parsePointer32(t)}};We.tag=We.prototype.parseTag;We.byte=We.prototype.parseByte;We.uShort=We.offset16=We.prototype.parseUShort;We.uShortList=We.prototype.parseUShortList;We.uLong=We.offset32=We.prototype.parseULong;We.uLongList=We.prototype.parseULongList;We.struct=We.prototype.parseStruct;We.coverage=We.prototype.parseCoverage;We.classDef=We.prototype.parseClassDef;var T4={reserved:We.uShort,reqFeatureIndex:We.uShort,featureIndexes:We.uShortList};We.prototype.parseScriptList=function(){return this.parsePointer(We.recordList({tag:We.tag,script:We.pointer({defaultLangSys:We.pointer(T4),langSysRecords:We.recordList({tag:We.tag,langSys:We.pointer(T4)})})}))||[]};We.prototype.parseFeatureList=function(){return this.parsePointer(We.recordList({tag:We.tag,feature:We.pointer({featureParams:We.offset16,lookupListIndexes:We.uShortList})}))||[]};We.prototype.parseLookupList=function(t){return this.parsePointer(We.list(We.pointer(function(){var e=this.parseUShort();pr.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(We.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]};We.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();pr.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:We.offset32,featureTableSubstitutionOffset:We.offset32});return r})||[]};var gr={getByte:E4,getCard8:E4,getUShort:kx,getCard16:kx,getShort:YH,getULong:P_,getFixed:$L,getTag:XH,getOffset:QH,getBytes:JH,bytesToString:eW,Parser:We};function rW(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var i=e.parseULong(),a=e.parseULong(),s=e.parseULong(),o=i;o<=a;o+=1)t.glyphIndexMap[o]=s,s++}function nW(t,e,r,n,i){t.length=e.parseUShort(),t.language=e.parseUShort();var a;t.segCount=a=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var s=new gr.Parser(r,n+i+14),o=new gr.Parser(r,n+i+16+a*2),l=new gr.Parser(r,n+i+16+a*4),u=new gr.Parser(r,n+i+16+a*6),c=n+i+16+a*8,h=0;h<a-1;h+=1)for(var p=void 0,g=s.parseUShort(),y=o.parseUShort(),S=l.parseShort(),w=u.parseUShort(),C=y;C<=g;C+=1)w!==0?(c=u.offset+u.relativeOffset-2,c+=w,c+=(C-y)*2,p=gr.getUShort(r,c),p!==0&&(p=p+S&65535)):p=C+S&65535,t.glyphIndexMap[C]=p}function iW(t,e){var r={};r.version=gr.getUShort(t,e),pr.argument(r.version===0,"cmap table version should be 0."),r.numTables=gr.getUShort(t,e+2);for(var n=-1,i=r.numTables-1;i>=0;i-=1){var a=gr.getUShort(t,e+4+i*8),s=gr.getUShort(t,e+4+i*8+2);if(a===3&&(s===0||s===1||s===10)||a===0&&(s===0||s===1||s===2||s===3||s===4)){n=gr.getULong(t,e+4+i*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var o=new gr.Parser(t,e+n);if(r.format=o.parseUShort(),r.format===12)rW(r,o);else if(r.format===4)nW(r,o,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function aW(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function sW(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function oW(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var i=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(i=i.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),i=i.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var a=new Ht.Table("cmap",i);for(a.segments=[],r=0;r<t.length;r+=1){for(var s=t.get(r),o=0;o<s.unicodes.length;o+=1)aW(a,s.unicodes[o],r);a.segments=a.segments.sort(function(_,T){return _.start-T.start})}sW(a);var l=a.segments.length,u=0,c=[],h=[],p=[],g=[],y=[],S=[];for(r=0;r<l;r+=1){var w=a.segments[r];w.end<=65535&&w.start<=65535?(c=c.concat({name:"end_"+r,type:"USHORT",value:w.end}),h=h.concat({name:"start_"+r,type:"USHORT",value:w.start}),p=p.concat({name:"idDelta_"+r,type:"SHORT",value:w.delta}),g=g.concat({name:"idRangeOffset_"+r,type:"USHORT",value:w.offset}),w.glyphId!==void 0&&(y=y.concat({name:"glyph_"+r,type:"USHORT",value:w.glyphId}))):u+=1,!e&&w.glyphIndex!==void 0&&(S=S.concat({name:"cmap12Start_"+r,type:"ULONG",value:w.start}),S=S.concat({name:"cmap12End_"+r,type:"ULONG",value:w.end}),S=S.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:w.glyphIndex}))}if(a.segCountX2=(l-u)*2,a.searchRange=Math.pow(2,Math.floor(Math.log(l-u)/Math.log(2)))*2,a.entrySelector=Math.log(a.searchRange/2)/Math.log(2),a.rangeShift=a.segCountX2-a.searchRange,a.fields=a.fields.concat(c),a.fields.push({name:"reservedPad",type:"USHORT",value:0}),a.fields=a.fields.concat(h),a.fields=a.fields.concat(p),a.fields=a.fields.concat(g),a.fields=a.fields.concat(y),a.cmap4Length=14+c.length*2+2+h.length*2+p.length*2+g.length*2+y.length*2,!e){var C=16+S.length*4;a.cmap12Offset=20+a.cmap4Length,a.fields=a.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:C},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:S.length/3}]),a.fields=a.fields.concat(S)}return a}var lW={parse:iW,make:oW},qy=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],uW=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],cW=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],N4=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function KL(t){this.font=t}KL.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var i=r.get(n),a=0;a<i.unicodes.length;a+=1)if(i.unicodes[a]===e)return n}return null};function _x(t,e){this.encoding=t,this.charset=e}_x.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function dW(t,e,r,n,i){t.beginPath(),t.moveTo(e,r),t.lineTo(n,i),t.stroke()}var Wh={line:dW};function hW(t,e){var r=e||new $i;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function il(t){this.bindConstructorValues(t)}il.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",hW(this,t.path))};il.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)};il.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};il.prototype.getPath=function(t,e,r,n,i){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var a,s;n||(n={});var o=n.xScale,l=n.yScale;if(n.hinting&&i&&i.hinting&&(s=this.path&&i.hinting.exec(this,r)),s)a=i.hinting.getCommands(s),t=Math.round(t),e=Math.round(e),o=l=1;else{a=this.path.commands;var u=1/(this.path.unitsPerEm||1e3)*r;o===void 0&&(o=u),l===void 0&&(l=u)}for(var c=new $i,h=0;h<a.length;h+=1){var p=a[h];p.type==="M"?c.moveTo(t+p.x*o,e+-p.y*l):p.type==="L"?c.lineTo(t+p.x*o,e+-p.y*l):p.type==="Q"?c.quadraticCurveTo(t+p.x1*o,e+-p.y1*l,t+p.x*o,e+-p.y*l):p.type==="C"?c.curveTo(t+p.x1*o,e+-p.y1*l,t+p.x2*o,e+-p.y2*l,t+p.x*o,e+-p.y*l):p.type==="Z"&&c.closePath()}return c};il.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return pr.argument(e.length===0,"There are still points left in the current contour."),t};il.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var i=t[n];i.type!=="Z"&&(e.push(i.x),r.push(i.y)),(i.type==="Q"||i.type==="C")&&(e.push(i.x1),r.push(i.y1)),i.type==="C"&&(e.push(i.x2),r.push(i.y2))}var a={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(a.xMin)||(a.xMin=0),isFinite(a.xMax)||(a.xMax=this.advanceWidth),isFinite(a.yMin)||(a.yMin=0),isFinite(a.yMax)||(a.yMax=0),a.rightSideBearing=this.advanceWidth-a.leftSideBearing-(a.xMax-a.xMin),a};il.prototype.draw=function(t,e,r,n,i){this.getPath(e,r,n,i).draw(t)};il.prototype.drawPoints=function(t,e,r,n){function i(h,p,g,y){t.beginPath();for(var S=0;S<h.length;S+=1)t.moveTo(p+h[S].x*y,g+h[S].y*y),t.arc(p+h[S].x*y,g+h[S].y*y,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var a=1/this.path.unitsPerEm*n,s=[],o=[],l=this.path,u=0;u<l.commands.length;u+=1){var c=l.commands[u];c.x!==void 0&&s.push({x:c.x,y:-c.y}),c.x1!==void 0&&o.push({x:c.x1,y:-c.y1}),c.x2!==void 0&&o.push({x:c.x2,y:-c.y2})}t.fillStyle="blue",i(s,e,r,a),t.fillStyle="red",i(o,e,r,a)};il.prototype.drawMetrics=function(t,e,r,n){var i;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,i=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",Wh.line(t,e,-1e4,e,1e4),Wh.line(t,-1e4,r,1e4,r);var a=this.xMin||0,s=this.yMin||0,o=this.xMax||0,l=this.yMax||0,u=this.advanceWidth||0;t.strokeStyle="blue",Wh.line(t,e+a*i,-1e4,e+a*i,1e4),Wh.line(t,e+o*i,-1e4,e+o*i,1e4),Wh.line(t,-1e4,r+-s*i,1e4,r+-s*i),Wh.line(t,-1e4,r+-l*i,1e4,r+-l*i),t.strokeStyle="green",Wh.line(t,e+u*i,-1e4,e+u*i,1e4)};function vy(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function M_(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}M_.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]};M_.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function fW(t,e){return new il({index:e,font:t})}function pW(t,e,r,n,i,a){return function(){var s=new il({index:e,font:t});return s.path=function(){r(s,n,i);var o=a(t.glyphs,s);return o.unitsPerEm=t.unitsPerEm,o},vy(s,"xMin","_xMin"),vy(s,"xMax","_xMax"),vy(s,"yMin","_yMin"),vy(s,"yMax","_yMax"),s}}function mW(t,e,r,n){return function(){var i=new il({index:e,font:t});return i.path=function(){var a=r(t,i,n);return a.unitsPerEm=t.unitsPerEm,a},i}}var Cu={GlyphSet:M_,glyphLoader:fW,ttfGlyphLoader:pW,cffGlyphLoader:mW};function ZL(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!ZL(t[r],e[r]))return!1;return!0}else return!1}function ak(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function _d(t,e,r){var n=[],i=[],a=gr.getCard16(t,e),s,o;if(a!==0){var l=gr.getByte(t,e+2);s=e+(a+1)*l+2;for(var u=e+3,c=0;c<a+1;c+=1)n.push(gr.getOffset(t,u,l)),u+=l;o=s+n[a]}else o=e+2;for(var h=0;h<n.length-1;h+=1){var p=gr.getBytes(t,s+n[h],s+n[h+1]);r&&(p=r(p)),i.push(p)}return{objects:i,startOffset:e,endOffset:o}}function gW(t,e){var r=[],n=gr.getCard16(t,e),i,a;if(n!==0){var s=gr.getByte(t,e+2);i=e+(n+1)*s+2;for(var o=e+3,l=0;l<n+1;l+=1)r.push(gr.getOffset(t,o,s)),o+=s;a=i+r[n]}else a=e+2;return{offsets:r,startOffset:e,endOffset:a}}function vW(t,e,r,n,i){var a=gr.getCard16(r,n),s=0;if(a!==0){var o=gr.getByte(r,n+2);s=n+(a+1)*o+2}var l=gr.getBytes(r,s+e[t],s+e[t+1]);return l}function yW(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var i=t.parseByte(),a=i>>4,s=i&15;if(a===r||(e+=n[a],s===r))break;e+=n[s]}return parseFloat(e)}function xW(t,e){var r,n,i,a;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),i=t.parseByte(),a=t.parseByte(),r<<24|n<<16|i<<8|a;if(e===30)return yW(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function bW(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],i=t[r][1],a=void 0;if(i.length===1?a=i[0]:a=i,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=a}return e}function YL(t,e,r){e=e!==void 0?e:0;var n=new gr.Parser(t,e),i=[],a=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var s=n.parseByte();s<=21?(s===12&&(s=1200+n.parseByte()),i.push([s,a]),a=[]):a.push(xW(n,s))}return bW(i)}function rv(t,e){return e<=390?e=qy[e]:e=t[e-391],e}function XL(t,e,r){for(var n={},i,a=0;a<e.length;a+=1){var s=e[a];if(Array.isArray(s.type)){var o=[];o.length=s.type.length;for(var l=0;l<s.type.length;l++)i=t[s.op]!==void 0?t[s.op][l]:void 0,i===void 0&&(i=s.value!==void 0&&s.value[l]!==void 0?s.value[l]:null),s.type[l]==="SID"&&(i=rv(r,i)),o[l]=i;n[s.name]=o}else i=t[s.op],i===void 0&&(i=s.value!==void 0?s.value:null),s.type==="SID"&&(i=rv(r,i)),n[s.name]=i}return n}function wW(t,e){var r={};return r.formatMajor=gr.getCard8(t,e),r.formatMinor=gr.getCard8(t,e+1),r.size=gr.getCard8(t,e+2),r.offsetSize=gr.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var QL=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],JL=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function SW(t,e){var r=YL(t,0,t.byteLength);return XL(r,QL,e)}function eR(t,e,r,n){var i=YL(t,e,r);return XL(i,JL,n)}function P4(t,e,r,n){for(var i=[],a=0;a<r.length;a+=1){var s=new DataView(new Uint8Array(r[a]).buffer),o=SW(s,n);o._subrs=[],o._subrsBias=0,o._defaultWidthX=0,o._nominalWidthX=0;var l=o.private[0],u=o.private[1];if(l!==0&&u!==0){var c=eR(t,u+e,l,n);if(o._defaultWidthX=c.defaultWidthX,o._nominalWidthX=c.nominalWidthX,c.subrs!==0){var h=u+c.subrs,p=_d(t,h+e);o._subrs=p.objects,o._subrsBias=ak(o._subrs)}o._privateDict=c}i.push(o)}return i}function kW(t,e,r,n){var i,a,s=new gr.Parser(t,e);r-=1;var o=[".notdef"],l=s.parseCard8();if(l===0)for(var u=0;u<r;u+=1)i=s.parseSID(),o.push(rv(n,i));else if(l===1)for(;o.length<=r;){i=s.parseSID(),a=s.parseCard8();for(var c=0;c<=a;c+=1)o.push(rv(n,i)),i+=1}else if(l===2)for(;o.length<=r;){i=s.parseSID(),a=s.parseCard16();for(var h=0;h<=a;h+=1)o.push(rv(n,i)),i+=1}else throw new Error("Unknown charset format "+l);return o}function _W(t,e,r){var n,i={},a=new gr.Parser(t,e),s=a.parseCard8();if(s===0)for(var o=a.parseCard8(),l=0;l<o;l+=1)n=a.parseCard8(),i[n]=l;else if(s===1){var u=a.parseCard8();n=1;for(var c=0;c<u;c+=1)for(var h=a.parseCard8(),p=a.parseCard8(),g=h;g<=h+p;g+=1)i[g]=n,n+=1}else throw new Error("Unknown encoding format "+s);return new _x(i,r)}function M4(t,e,r){var n,i,a,s,o=new $i,l=[],u=0,c=!1,h=!1,p=0,g=0,y,S,w,C;if(t.isCIDFont){var _=t.tables.cff.topDict._fdSelect[e.index],T=t.tables.cff.topDict._fdArray[_];y=T._subrs,S=T._subrsBias,w=T._defaultWidthX,C=T._nominalWidthX}else y=t.tables.cff.topDict._subrs,S=t.tables.cff.topDict._subrsBias,w=t.tables.cff.topDict._defaultWidthX,C=t.tables.cff.topDict._nominalWidthX;var N=w;function R(O,F){h&&o.closePath(),o.moveTo(O,F),h=!0}function I(){var O;O=l.length%2!==0,O&&!c&&(N=l.shift()+C),u+=l.length>>1,l.length=0,c=!0}function j(O){for(var F,z,V,q,D,U,G,Z,K,Q,ne,te,X=0;X<O.length;){var re=O[X];switch(X+=1,re){case 1:I();break;case 3:I();break;case 4:l.length>1&&!c&&(N=l.shift()+C,c=!0),g+=l.pop(),R(p,g);break;case 5:for(;l.length>0;)p+=l.shift(),g+=l.shift(),o.lineTo(p,g);break;case 6:for(;l.length>0&&(p+=l.shift(),o.lineTo(p,g),l.length!==0);)g+=l.shift(),o.lineTo(p,g);break;case 7:for(;l.length>0&&(g+=l.shift(),o.lineTo(p,g),l.length!==0);)p+=l.shift(),o.lineTo(p,g);break;case 8:for(;l.length>0;)n=p+l.shift(),i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),g=s+l.shift(),o.curveTo(n,i,a,s,p,g);break;case 10:D=l.pop()+S,U=y[D],U&&j(U);break;case 11:return;case 12:switch(re=O[X],X+=1,re){case 35:n=p+l.shift(),i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),G=a+l.shift(),Z=s+l.shift(),K=G+l.shift(),Q=Z+l.shift(),ne=K+l.shift(),te=Q+l.shift(),p=ne+l.shift(),g=te+l.shift(),l.shift(),o.curveTo(n,i,a,s,G,Z),o.curveTo(K,Q,ne,te,p,g);break;case 34:n=p+l.shift(),i=g,a=n+l.shift(),s=i+l.shift(),G=a+l.shift(),Z=s,K=G+l.shift(),Q=s,ne=K+l.shift(),te=g,p=ne+l.shift(),o.curveTo(n,i,a,s,G,Z),o.curveTo(K,Q,ne,te,p,g);break;case 36:n=p+l.shift(),i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),G=a+l.shift(),Z=s,K=G+l.shift(),Q=s,ne=K+l.shift(),te=Q+l.shift(),p=ne+l.shift(),o.curveTo(n,i,a,s,G,Z),o.curveTo(K,Q,ne,te,p,g);break;case 37:n=p+l.shift(),i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),G=a+l.shift(),Z=s+l.shift(),K=G+l.shift(),Q=Z+l.shift(),ne=K+l.shift(),te=Q+l.shift(),Math.abs(ne-p)>Math.abs(te-g)?p=ne+l.shift():g=te+l.shift(),o.curveTo(n,i,a,s,G,Z),o.curveTo(K,Q,ne,te,p,g);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+re),l.length=0}break;case 14:l.length>0&&!c&&(N=l.shift()+C,c=!0),h&&(o.closePath(),h=!1);break;case 18:I();break;case 19:case 20:I(),X+=u+7>>3;break;case 21:l.length>2&&!c&&(N=l.shift()+C,c=!0),g+=l.pop(),p+=l.pop(),R(p,g);break;case 22:l.length>1&&!c&&(N=l.shift()+C,c=!0),p+=l.pop(),R(p,g);break;case 23:I();break;case 24:for(;l.length>2;)n=p+l.shift(),i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),g=s+l.shift(),o.curveTo(n,i,a,s,p,g);p+=l.shift(),g+=l.shift(),o.lineTo(p,g);break;case 25:for(;l.length>6;)p+=l.shift(),g+=l.shift(),o.lineTo(p,g);n=p+l.shift(),i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),g=s+l.shift(),o.curveTo(n,i,a,s,p,g);break;case 26:for(l.length%2&&(p+=l.shift());l.length>0;)n=p,i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a,g=s+l.shift(),o.curveTo(n,i,a,s,p,g);break;case 27:for(l.length%2&&(g+=l.shift());l.length>0;)n=p+l.shift(),i=g,a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),g=s,o.curveTo(n,i,a,s,p,g);break;case 28:F=O[X],z=O[X+1],l.push((F<<24|z<<16)>>16),X+=2;break;case 29:D=l.pop()+t.gsubrsBias,U=t.gsubrs[D],U&&j(U);break;case 30:for(;l.length>0&&(n=p,i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),g=s+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,g),l.length!==0);)n=p+l.shift(),i=g,a=n+l.shift(),s=i+l.shift(),g=s+l.shift(),p=a+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,g);break;case 31:for(;l.length>0&&(n=p+l.shift(),i=g,a=n+l.shift(),s=i+l.shift(),g=s+l.shift(),p=a+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,g),l.length!==0);)n=p,i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),g=s+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,g);break;default:re<32?console.log("Glyph "+e.index+": unknown operator "+re):re<247?l.push(re-139):re<251?(F=O[X],X+=1,l.push((re-247)*256+F+108)):re<255?(F=O[X],X+=1,l.push(-(re-251)*256-F-108)):(F=O[X],z=O[X+1],V=O[X+2],q=O[X+3],X+=4,l.push((F<<24|z<<16|V<<8|q)/65536))}}}return j(r),e.advanceWidth=N,o}function CW(t,e,r,n){var i=[],a,s=new gr.Parser(t,e),o=s.parseCard8();if(o===0)for(var l=0;l<r;l++){if(a=s.parseCard8(),a>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+n+")");i.push(a)}else if(o===3){var u=s.parseCard16(),c=s.parseCard16();if(c!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+c);for(var h,p=0;p<u;p++){if(a=s.parseCard8(),h=s.parseCard16(),a>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+n+")");if(h>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+h);for(;c<h;c++)i.push(a);c=h}if(h!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+h)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+o);return i}function EW(t,e,r,n){r.tables.cff={};var i=wW(t,e),a=_d(t,i.endOffset,gr.bytesToString),s=_d(t,a.endOffset),o=_d(t,s.endOffset,gr.bytesToString),l=_d(t,o.endOffset);r.gsubrs=l.objects,r.gsubrsBias=ak(r.gsubrs);var u=P4(t,e,s.objects,o.objects);if(u.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+u.length);var c=u[0];if(r.tables.cff.topDict=c,c._privateDict&&(r.defaultWidthX=c._privateDict.defaultWidthX,r.nominalWidthX=c._privateDict.nominalWidthX),c.ros[0]!==void 0&&c.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var h=c.fdArray,p=c.fdSelect;if(h===0||p===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");h+=e;var g=_d(t,h),y=P4(t,e,g.objects,o.objects);c._fdArray=y,p+=e,c._fdSelect=CW(t,p,r.numGlyphs,y.length)}var S=e+c.private[1],w=eR(t,S,c.private[0],o.objects);if(r.defaultWidthX=w.defaultWidthX,r.nominalWidthX=w.nominalWidthX,w.subrs!==0){var C=S+w.subrs,_=_d(t,C);r.subrs=_.objects,r.subrsBias=ak(r.subrs)}else r.subrs=[],r.subrsBias=0;var T;n.lowMemory?(T=gW(t,e+c.charStrings),r.nGlyphs=T.offsets.length):(T=_d(t,e+c.charStrings),r.nGlyphs=T.objects.length);var N=kW(t,e+c.charset,r.nGlyphs,o.objects);if(c.encoding===0?r.cffEncoding=new _x(uW,N):c.encoding===1?r.cffEncoding=new _x(cW,N):r.cffEncoding=_W(t,e+c.encoding,N),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new Cu.GlyphSet(r),n.lowMemory)r._push=function(j){var O=vW(j,T.offsets,t,e+c.charStrings);r.glyphs.push(j,Cu.cffGlyphLoader(r,j,M4,O))};else for(var R=0;R<r.nGlyphs;R+=1){var I=T.objects[R];r.glyphs.push(R,Cu.cffGlyphLoader(r,R,M4,I))}}function tR(t,e){var r,n=qy.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+qy.length:(r=qy.length+e.length,e.push(t)),r}function TW(){return new Ht.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function NW(t){var e=new Ht.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function rR(t,e,r){for(var n={},i=0;i<t.length;i+=1){var a=t[i],s=e[a.name];s!==void 0&&!ZL(s,a.value)&&(a.type==="SID"&&(s=tR(s,r)),n[a.op]={name:a.name,type:a.type,value:s})}return n}function A4(t,e){var r=new Ht.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=rR(QL,t,e),r}function L4(t){var e=new Ht.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function PW(t){var e=new Ht.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function MW(){return new Ht.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function AW(t,e){for(var r=new Ht.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var i=t[n],a=tR(i,e);r.fields.push({name:"glyph_"+n,type:"SID",value:a})}return r}function LW(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,i=0,a=0;a<r.commands.length;a+=1){var s=void 0,o=void 0,l=r.commands[a];if(l.type==="Q"){var u=.3333333333333333,c=2/3;l={type:"C",x:l.x,y:l.y,x1:Math.round(u*n+c*l.x1),y1:Math.round(u*i+c*l.y1),x2:Math.round(u*l.x+c*l.x1),y2:Math.round(u*l.y+c*l.y1)}}if(l.type==="M")s=Math.round(l.x-n),o=Math.round(l.y-i),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(l.x),i=Math.round(l.y);else if(l.type==="L")s=Math.round(l.x-n),o=Math.round(l.y-i),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(l.x),i=Math.round(l.y);else if(l.type==="C"){var h=Math.round(l.x1-n),p=Math.round(l.y1-i),g=Math.round(l.x2-l.x1),y=Math.round(l.y2-l.y1);s=Math.round(l.x-l.x2),o=Math.round(l.y-l.y2),e.push({name:"dx1",type:"NUMBER",value:h}),e.push({name:"dy1",type:"NUMBER",value:p}),e.push({name:"dx2",type:"NUMBER",value:g}),e.push({name:"dy2",type:"NUMBER",value:y}),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(l.x),i=Math.round(l.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function RW(t){for(var e=new Ht.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),i=LW(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:i})}return e}function OW(t,e){var r=new Ht.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=rR(JL,t,e),r}function DW(t,e){for(var r=new Ht.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,i={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},a={},s=[],o,l=1;l<t.length;l+=1)o=t.get(l),s.push(o.name);var u=[];r.header=TW(),r.nameIndex=NW([e.postScriptName]);var c=A4(i,u);r.topDictIndex=L4(c),r.globalSubrIndex=MW(),r.charsets=AW(s,u),r.charStringsIndex=RW(t),r.privateDict=OW(a,u),r.stringIndex=PW(u);var h=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return i.charset=h,i.encoding=0,i.charStrings=i.charset+r.charsets.sizeOf(),i.private[1]=i.charStrings+r.charStringsIndex.sizeOf(),c=A4(i,u),r.topDictIndex=L4(c),r}var IW={parse:EW,make:DW};function jW(t,e){var r={},n=new gr.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),pr.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function FW(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new Ht.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var BW={parse:jW,make:FW};function zW(t,e){var r={},n=new gr.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function UW(t){return new Ht.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var GW={parse:zW,make:UW};function VW(t,e,r,n,i){for(var a,s,o=new gr.Parser(t,e),l=0;l<n;l+=1){l<r&&(a=o.parseUShort(),s=o.parseShort());var u=i.get(l);u.advanceWidth=a,u.leftSideBearing=s}}function HW(t,e,r,n,i){t._hmtxTableData={};for(var a,s,o=new gr.Parser(e,r),l=0;l<i;l+=1)l<n&&(a=o.parseUShort(),s=o.parseShort()),t._hmtxTableData[l]={advanceWidth:a,leftSideBearing:s}}function WW(t,e,r,n,i,a,s){s.lowMemory?HW(t,e,r,n,i):VW(e,r,n,i,a)}function qW(t){for(var e=new Ht.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),i=n.advanceWidth||0,a=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:i}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:a})}return e}var $W={parse:WW,make:qW};function KW(t){for(var e=new Ht.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,i=0;i<t.length;++i){var a=r.indexOf(t[i]);a<0&&(a=r.length,r+=t[i]),e.fields.push({name:"offset "+i,type:"USHORT",value:n+a}),e.fields.push({name:"length "+i,type:"USHORT",value:t[i].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function ZW(t,e){var r=new gr.Parser(t,e),n=r.parseULong();pr.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var i=r.parseULong(),a=[],s=0;s<i;s++){for(var o="",l=e+r.parseUShort(),u=r.parseUShort(),c=l;c<l+u;++c)o+=String.fromCharCode(t.getInt8(c));a.push(o)}return a}var YW={make:KW,parse:ZW};function XW(t,e){var r={},n=new gr.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function QW(t){return new Ht.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var JW={parse:XW,make:QW},nR=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],iR={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},eq={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},aR={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function tq(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return iR[e];case 3:return aR[e]}}var sk="utf-16",rq={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},nq={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function sR(t,e,r){switch(t){case 0:return sk;case 1:return nq[r]||rq[e];case 3:if(e===1||e===10)return sk;break}}function iq(t,e,r){for(var n={},i=new gr.Parser(t,e),a=i.parseUShort(),s=i.parseUShort(),o=i.offset+i.parseUShort(),l=0;l<s;l++){var u=i.parseUShort(),c=i.parseUShort(),h=i.parseUShort(),p=i.parseUShort(),g=nR[p]||p,y=i.parseUShort(),S=i.parseUShort(),w=tq(u,h,r),C=sR(u,c,h);if(C!==void 0&&w!==void 0){var _=void 0;if(C===sk?_=Kp.UTF16(t,o+S,y):_=Kp.MACSTRING(t,o+S,y,C),_){var T=n[g];T===void 0&&(T=n[g]={}),T[w]=_}}}return a===1&&i.parseUShort(),n}function F2(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function R4(t,e,r,n,i,a){return new Ht.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:i},{name:"offset",type:"USHORT",value:a}])}function aq(t,e){var r=t.length,n=e.length-r+1;e:for(var i=0;i<n;i++)for(;i<n;i++){for(var a=0;a<r;a++)if(e[i+a]!==t[a])continue e;return i}return-1}function O4(t,e){var r=aq(t,e);if(r<0){r=e.length;for(var n=0,i=t.length;n<i;++n)e.push(t[n])}return r}function sq(t,e){var r,n=[],i={},a=F2(nR);for(var s in t){var o=a[s];if(o===void 0&&(o=s),r=parseInt(o),isNaN(r))throw new Error('Name table entry "'+s+'" does not exist, see nameTableNames for complete list.');i[r]=t[s],n.push(r)}for(var l=F2(iR),u=F2(aR),c=[],h=[],p=0;p<n.length;p++){r=n[p];var g=i[r];for(var y in g){var S=g[y],w=1,C=l[y],_=eq[C],T=sR(w,_,C),N=Nt.MACSTRING(S,T);N===void 0&&(w=0,C=e.indexOf(y),C<0&&(C=e.length,e.push(y)),_=4,N=Nt.UTF16(S));var R=O4(N,h);c.push(R4(w,_,C,r,N.length,R));var I=u[y];if(I!==void 0){var j=Nt.UTF16(S),O=O4(j,h);c.push(R4(3,1,I,r,j.length,O))}}}c.sort(function(V,q){return V.platformID-q.platformID||V.encodingID-q.encodingID||V.languageID-q.languageID||V.nameID-q.nameID});for(var F=new Ht.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:c.length},{name:"stringOffset",type:"USHORT",value:6+c.length*12}]),z=0;z<c.length;z++)F.fields.push({name:"record_"+z,type:"RECORD",value:c[z]});return F.fields.push({name:"strings",type:"LITERAL",value:h}),F}var oq={parse:iq,make:sq},ok=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function lq(t){for(var e=0;e<ok.length;e+=1){var r=ok[e];if(t>=r.begin&&t<r.end)return e}return-1}function uq(t,e){var r={},n=new gr.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var i=0;i<10;i++)r.panose[i]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function cq(t){return new Ht.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var D4={parse:uq,make:cq,unicodeRanges:ok,getUnicodeRange:lq};function dq(t,e){var r={},n=new gr.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=N4.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var i=0;i<r.numberOfGlyphs;i++)r.glyphNameIndex[i]=n.parseUShort();r.names=[];for(var a=0;a<r.numberOfGlyphs;a++)if(r.glyphNameIndex[a]>=N4.length){var s=n.parseChar();r.names.push(n.parseString(s))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.offset[o]=n.parseChar();break}return r}function hq(){return new Ht.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var fq={parse:dq,make:hq},Fl=new Array(9);Fl[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(We.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(We.coverage),substitute:this.parseOffset16List()};pr.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};Fl[2]=function(){var e=this.parseUShort();return pr.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),sequences:this.parseListOfLists()}};Fl[3]=function(){var e=this.parseUShort();return pr.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),alternateSets:this.parseListOfLists()}};Fl[4]=function(){var e=this.parseUShort();return pr.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Up={sequenceIndex:We.uShort,lookupListIndex:We.uShort};Fl[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(We.coverage),ruleSets:this.parseListOfLists(function(){var a=this.parseUShort(),s=this.parseUShort();return{input:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(s,Up)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(We.coverage),classDef:this.parsePointer(We.classDef),classSets:this.parseListOfLists(function(){var a=this.parseUShort(),s=this.parseUShort();return{classes:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(s,Up)}})};if(r===3){var n=this.parseUShort(),i=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,We.pointer(We.coverage)),lookupRecords:this.parseRecordList(i,Up)}}pr.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};Fl[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(We.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Up)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(We.coverage),backtrackClassDef:this.parsePointer(We.classDef),inputClassDef:this.parsePointer(We.classDef),lookaheadClassDef:this.parsePointer(We.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Up)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(We.pointer(We.coverage)),inputCoverage:this.parseList(We.pointer(We.coverage)),lookaheadCoverage:this.parseList(We.pointer(We.coverage)),lookupRecords:this.parseRecordList(Up)};pr.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};Fl[7]=function(){var e=this.parseUShort();pr.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new We(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:Fl[r].call(n)}};Fl[8]=function(){var e=this.parseUShort();return pr.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),backtrackCoverage:this.parseList(We.pointer(We.coverage)),lookaheadCoverage:this.parseList(We.pointer(We.coverage)),substitutes:this.parseUShortList()}};function pq(t,e){e=e||0;var r=new We(t,e),n=r.parseVersion(1);return pr.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Fl)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Fl),variations:r.parseFeatureVariationsList()}}var mm=new Array(9);mm[1]=function(e){return e.substFormat===1?new Ht.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Ht.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Ht.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Ht.Coverage(e.coverage)}].concat(Ht.ushortList("substitute",e.substitute)))};mm[2]=function(e){return pr.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new Ht.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Ht.Coverage(e.coverage)}].concat(Ht.tableList("seqSet",e.sequences,function(r){return new Ht.Table("sequenceSetTable",Ht.ushortList("sequence",r))})))};mm[3]=function(e){return pr.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new Ht.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Ht.Coverage(e.coverage)}].concat(Ht.tableList("altSet",e.alternateSets,function(r){return new Ht.Table("alternateSetTable",Ht.ushortList("alternate",r))})))};mm[4]=function(e){return pr.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new Ht.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Ht.Coverage(e.coverage)}].concat(Ht.tableList("ligSet",e.ligatureSets,function(r){return new Ht.Table("ligatureSetTable",Ht.tableList("ligature",r,function(n){return new Ht.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(Ht.ushortList("component",n.components,n.components.length+1)))}))})))};mm[6]=function(e){if(e.substFormat===1){var r=new Ht.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Ht.Coverage(e.coverage)}].concat(Ht.tableList("chainRuleSet",e.chainRuleSets,function(a){return new Ht.Table("chainRuleSetTable",Ht.tableList("chainRule",a,function(s){var o=Ht.ushortList("backtrackGlyph",s.backtrack,s.backtrack.length).concat(Ht.ushortList("inputGlyph",s.input,s.input.length+1)).concat(Ht.ushortList("lookaheadGlyph",s.lookahead,s.lookahead.length)).concat(Ht.ushortList("substitution",[],s.lookupRecords.length));return s.lookupRecords.forEach(function(l,u){o=o.concat({name:"sequenceIndex"+u,type:"USHORT",value:l.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:l.lookupListIndex})}),new Ht.Table("chainRuleTable",o)}))})));return r}else if(e.substFormat===2)pr.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(a,s){n.push({name:"backtrackCoverage"+s,type:"TABLE",value:new Ht.Coverage(a)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(a,s){n.push({name:"inputCoverage"+s,type:"TABLE",value:new Ht.Coverage(a)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(a,s){n.push({name:"lookaheadCoverage"+s,type:"TABLE",value:new Ht.Coverage(a)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(a,s){n=n.concat({name:"sequenceIndex"+s,type:"USHORT",value:a.sequenceIndex}).concat({name:"lookupListIndex"+s,type:"USHORT",value:a.lookupListIndex})});var i=new Ht.Table("chainContextTable",n);return i}pr.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function mq(t){return new Ht.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Ht.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new Ht.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new Ht.LookupList(t.lookups,mm)}])}var gq={parse:pq,make:mq};function vq(t,e){var r=new gr.Parser(t,e),n=r.parseULong();pr.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var i=r.parseULong(),a={},s=0;s<i;s++){var o=r.parseTag(),l=r.parseULong(),u=r.parseULong(),c=Kp.UTF8(t,e+l,u);a[o]=c}return a}function yq(t){var e=Object.keys(t).length,r="",n=16+e*12,i=new Ht.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var a in t){var s=r.length;r+=t[a],i.fields.push({name:"tag "+a,type:"TAG",value:a}),i.fields.push({name:"offset "+a,type:"ULONG",value:n+s}),i.fields.push({name:"length "+a,type:"ULONG",value:t[a].length})}return i.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),i}var xq={parse:vq,make:yq};function I4(t){return Math.log(t)/Math.log(2)|0}function A_(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function j4(t,e,r,n){return new Ht.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function oR(t){var e=new Ht.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,I4(e.numTables));e.searchRange=16*r,e.entrySelector=I4(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],i=[],a=e.sizeOf()+j4().sizeOf()*e.numTables;a%4!==0;)a+=1,i.push({name:"padding",type:"BYTE",value:0});for(var s=0;s<t.length;s+=1){var o=t[s];pr.argument(o.tableName.length===4,"Table name"+o.tableName+" is invalid.");var l=o.sizeOf(),u=j4(o.tableName,A_(o.encode()),a,l);for(n.push({name:u.tag+" Table Record",type:"RECORD",value:u}),i.push({name:o.tableName+" table",type:"RECORD",value:o}),a+=l,pr.argument(!isNaN(a),"Something went wrong calculating the offset.");a%4!==0;)a+=1,i.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(c,h){return c.value.tag>h.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(i),e}function F4(t,e,r){for(var n=0;n<e.length;n+=1){var i=t.charToGlyphIndex(e[n]);if(i>0){var a=t.glyphs.get(i);return a.getMetrics()}}return r}function bq(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function wq(t){for(var e=[],r=[],n=[],i=[],a=[],s=[],o=[],l,u=0,c=0,h=0,p=0,g=0,y=0;y<t.glyphs.length;y+=1){var S=t.glyphs.get(y),w=S.unicode|0;if(isNaN(S.advanceWidth))throw new Error("Glyph "+S.name+" ("+y+"): advanceWidth is not a number.");(l>w||l===void 0)&&w>0&&(l=w),u<w&&(u=w);var C=D4.getUnicodeRange(w);if(C<32)c|=1<<C;else if(C<64)h|=1<<C-32;else if(C<96)p|=1<<C-64;else if(C<123)g|=1<<C-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(S.name!==".notdef"){var _=S.getMetrics();e.push(_.xMin),r.push(_.yMin),n.push(_.xMax),i.push(_.yMax),s.push(_.leftSideBearing),o.push(_.rightSideBearing),a.push(S.advanceWidth)}}var T={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,i),advanceWidthMax:Math.max.apply(null,a),advanceWidthAvg:bq(a),minLeftSideBearing:Math.min.apply(null,s),maxLeftSideBearing:Math.max.apply(null,s),minRightSideBearing:Math.min.apply(null,o)};T.ascender=t.ascender,T.descender=t.descender;var N=BW.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:T.xMin,yMin:T.yMin,xMax:T.xMax,yMax:T.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),R=GW.make({ascender:T.ascender,descender:T.descender,advanceWidthMax:T.advanceWidthMax,minLeftSideBearing:T.minLeftSideBearing,minRightSideBearing:T.minRightSideBearing,xMaxExtent:T.maxLeftSideBearing+(T.xMax-T.xMin),numberOfHMetrics:t.glyphs.length}),I=JW.make(t.glyphs.length),j=D4.make(Object.assign({xAvgCharWidth:Math.round(T.advanceWidthAvg),usFirstCharIndex:l,usLastCharIndex:u,ulUnicodeRange1:c,ulUnicodeRange2:h,ulUnicodeRange3:p,ulUnicodeRange4:g,sTypoAscender:T.ascender,sTypoDescender:T.descender,sTypoLineGap:0,usWinAscent:T.yMax,usWinDescent:Math.abs(T.yMin),ulCodePageRange1:1,sxHeight:F4(t,"xyvw",{yMax:Math.round(T.ascender/2)}).yMax,sCapHeight:F4(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",T).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),O=$W.make(t.glyphs),F=lW.make(t.glyphs),z=t.getEnglishName("fontFamily"),V=t.getEnglishName("fontSubfamily"),q=z+" "+V,D=t.getEnglishName("postScriptName");D||(D=z.replace(/\s/g,"")+"-"+V);var U={};for(var G in t.names)U[G]=t.names[G];U.uniqueID||(U.uniqueID={en:t.getEnglishName("manufacturer")+":"+q}),U.postScriptName||(U.postScriptName={en:D}),U.preferredFamily||(U.preferredFamily=t.names.fontFamily),U.preferredSubfamily||(U.preferredSubfamily=t.names.fontSubfamily);var Z=[],K=oq.make(U,Z),Q=Z.length>0?YW.make(Z):void 0,ne=fq.make(),te=IW.make(t.glyphs,{version:t.getEnglishName("version"),fullName:q,familyName:z,weightName:V,postScriptName:D,unitsPerEm:t.unitsPerEm,fontBBox:[0,T.yMin,T.ascender,T.advanceWidthMax]}),X=t.metas&&Object.keys(t.metas).length>0?xq.make(t.metas):void 0,re=[N,R,I,j,K,F,ne,te,O];Q&&re.push(Q),t.tables.gsub&&re.push(gq.make(t.tables.gsub)),X&&re.push(X);for(var he=oR(re),oe=he.encode(),se=A_(oe),fe=he.fields,ae=!1,pe=0;pe<fe.length;pe+=1)if(fe[pe].name==="head table"){fe[pe].value.checkSumAdjustment=2981146554-se,ae=!0;break}if(!ae)throw new Error("Could not find head table with checkSum to adjust.");return he}var Sq={make:oR,fontToTable:wq,computeCheckSum:A_};function B2(t,e){for(var r=0,n=t.length-1;r<=n;){var i=r+n>>>1,a=t[i].tag;if(a===e)return i;a<e?r=i+1:n=i-1}return-r-1}function B4(t,e){for(var r=0,n=t.length-1;r<=n;){var i=r+n>>>1,a=t[i];if(a===e)return i;a<e?r=i+1:n=i-1}return-r-1}function z4(t,e){for(var r,n=0,i=t.length-1;n<=i;){var a=n+i>>>1;r=t[a];var s=r.start;if(s===e)return r;s<e?n=a+1:i=a-1}if(n>0)return r=t[n-1],e>r.end?0:r}function a0(t,e){this.font=t,this.tableName=e}a0.prototype={searchTag:B2,binSearch:B4,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,i=B2(r.scripts,t);if(i>=0)return n[i].script;if(e){var a={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-i,0,a),a.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var i=B2(n.langSysRecords,e);if(i>=0)return n.langSysRecords[i].langSys;if(r){var a={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-i,0,a),a.langSys}}},getFeatureTable:function(t,e,r,n){var i=this.getLangSysTable(t,e,n);if(i){for(var a,s=i.featureIndexes,o=this.font.tables[this.tableName].features,l=0;l<s.length;l++)if(a=o[s[l]],a.tag===r)return a.feature;if(n){var u=o.length;return pr.assert(u===0||r>=o[u-1].tag,"Features must be added in alphabetical order."),a={tag:r,feature:{params:0,lookupListIndexes:[]}},o.push(a),s.push(u),a.feature}}},getLookupTables:function(t,e,r,n,i){var a=this.getFeatureTable(t,e,r,i),s=[];if(a){for(var o,l=a.lookupListIndexes,u=this.font.tables[this.tableName].lookups,c=0;c<l.length;c++)o=u[l[c]],o.lookupType===n&&s.push(o);if(s.length===0&&i){o={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var h=u.length;return u.push(o),l.push(h),[o]}}return s},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=z4(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=B4(t.glyphs,e);return r>=0?r:-1;case 2:var n=z4(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var i=r[n],a=i.start,s=i.end,o=a;o<=s;o++)e.push(o);return e}};function s0(t){a0.call(this,t,"gpos")}s0.prototype=a0.prototype;s0.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)};s0.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var i=t[n].subtables,a=0;a<i.length;a++){var s=i[a],o=this.getCoverageIndex(s.coverage,e);if(!(o<0))switch(s.posFormat){case 1:for(var l=s.pairSets[o],u=0;u<l.length;u++){var c=l[u];if(c.secondGlyph===r)return c.value1&&c.value1.xAdvance||0}break;case 2:var h=this.getGlyphClass(s.classDef1,e),p=this.getGlyphClass(s.classDef2,r),g=s.classRecords[h][p];return g.value1&&g.value1.xAdvance||0}}return 0};s0.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function wo(t){a0.call(this,t,"gsub")}function kq(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function L_(t,e,r){for(var n=t.subtables,i=0;i<n.length;i++){var a=n[i];if(a.substFormat===e)return a}if(r)return n.push(r),r}wo.prototype=a0.prototype;wo.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};wo.prototype.getSingle=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,1),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++){var l=s[o],u=this.expandCoverage(l.coverage),c=void 0;if(l.substFormat===1){var h=l.deltaGlyphId;for(c=0;c<u.length;c++){var p=u[c];n.push({sub:p,by:p+h})}}else{var g=l.substitute;for(c=0;c<u.length;c++)n.push({sub:u[c],by:g[c]})}}return n};wo.prototype.getMultiple=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,2),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++){var l=s[o],u=this.expandCoverage(l.coverage),c=void 0;for(c=0;c<u.length;c++){var h=u[c],p=l.sequences[c];n.push({sub:h,by:p})}}return n};wo.prototype.getAlternates=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,3),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++)for(var l=s[o],u=this.expandCoverage(l.coverage),c=l.alternateSets,h=0;h<u.length;h++)n.push({sub:u[h],by:c[h]});return n};wo.prototype.getLigatures=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,4),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++)for(var l=s[o],u=this.expandCoverage(l.coverage),c=l.ligatureSets,h=0;h<u.length;h++)for(var p=u[h],g=c[h],y=0;y<g.length;y++){var S=g[y];n.push({sub:[p].concat(S.components),by:S.ligGlyph})}return n};wo.prototype.addSingle=function(t,e,r,n){var i=this.getLookupTables(r,n,t,1,!0)[0],a=L_(i,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});pr.assert(a.coverage.format===1,"Single: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.substitute.splice(o,0,0)),a.substitute[o]=e.by};wo.prototype.addMultiple=function(t,e,r,n){pr.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var i=this.getLookupTables(r,n,t,2,!0)[0],a=L_(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});pr.assert(a.coverage.format===1,"Multiple: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.sequences.splice(o,0,0)),a.sequences[o]=e.by};wo.prototype.addAlternate=function(t,e,r,n){var i=this.getLookupTables(r,n,t,3,!0)[0],a=L_(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});pr.assert(a.coverage.format===1,"Alternate: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.alternateSets.splice(o,0,0)),a.alternateSets[o]=e.by};wo.prototype.addLigature=function(t,e,r,n){var i=this.getLookupTables(r,n,t,4,!0)[0],a=i.subtables[0];a||(a={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},i.subtables[0]=a),pr.assert(a.coverage.format===1,"Ligature: unable to modify coverage table format "+a.coverage.format);var s=e.sub[0],o=e.sub.slice(1),l={ligGlyph:e.by,components:o},u=this.binSearch(a.coverage.glyphs,s);if(u>=0){for(var c=a.ligatureSets[u],h=0;h<c.length;h++)if(kq(c[h].components,o))return;c.push(l)}else u=-1-u,a.coverage.glyphs.splice(u,0,s),a.ligatureSets.splice(u,0,[l])};wo.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}};wo.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function _q(){return typeof window<"u"}function Cq(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function Fg(t,e){if(!t)throw e}function U4(t,e,r,n,i){var a;return(e&n)>0?(a=t.parseByte(),(e&i)===0&&(a=-a),a=r+a):(e&i)>0?a=r:a=r+t.parseShort(),a}function lR(t,e,r){var n=new gr.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var i,a;if(t.numberOfContours>0){for(var s=t.endPointIndices=[],o=0;o<t.numberOfContours;o+=1)s.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var l=0;l<t.instructionLength;l+=1)t.instructions.push(n.parseByte());var u=s[s.length-1]+1;i=[];for(var c=0;c<u;c+=1)if(a=n.parseByte(),i.push(a),(a&8)>0)for(var h=n.parseByte(),p=0;p<h;p+=1)i.push(a),c+=1;if(pr.argument(i.length===u,"Bad flags."),s.length>0){var g=[],y;if(u>0){for(var S=0;S<u;S+=1)a=i[S],y={},y.onCurve=!!(a&1),y.lastPointOfContour=s.indexOf(S)>=0,g.push(y);for(var w=0,C=0;C<u;C+=1)a=i[C],y=g[C],y.x=U4(n,a,w,2,16),w=y.x;for(var _=0,T=0;T<u;T+=1)a=i[T],y=g[T],y.y=U4(n,a,_,4,32),_=y.y}t.points=g}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var N=!0;N;){i=n.parseUShort();var R={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(i&1)>0?(i&2)>0?(R.dx=n.parseShort(),R.dy=n.parseShort()):R.matchedPoints=[n.parseUShort(),n.parseUShort()]:(i&2)>0?(R.dx=n.parseChar(),R.dy=n.parseChar()):R.matchedPoints=[n.parseByte(),n.parseByte()],(i&8)>0?R.xScale=R.yScale=n.parseF2Dot14():(i&64)>0?(R.xScale=n.parseF2Dot14(),R.yScale=n.parseF2Dot14()):(i&128)>0&&(R.xScale=n.parseF2Dot14(),R.scale01=n.parseF2Dot14(),R.scale10=n.parseF2Dot14(),R.yScale=n.parseF2Dot14()),t.components.push(R),N=!!(i&32)}if(i&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var I=0;I<t.instructionLength;I+=1)t.instructions.push(n.parseByte())}}}function z2(t,e){for(var r=[],n=0;n<t.length;n+=1){var i=t[n],a={x:e.xScale*i.x+e.scale01*i.y+e.dx,y:e.scale10*i.x+e.yScale*i.y+e.dy,onCurve:i.onCurve,lastPointOfContour:i.lastPointOfContour};r.push(a)}return r}function Eq(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var i=t[n];r.push(i),i.lastPointOfContour&&(e.push(r),r=[])}return pr.argument(r.length===0,"There are still points left in the current contour."),e}function uR(t){var e=new $i;if(!t)return e;for(var r=Eq(t),n=0;n<r.length;++n){var i=r[n],a=null,s=i[i.length-1],o=i[0];if(s.onCurve)e.moveTo(s.x,s.y);else if(o.onCurve)e.moveTo(o.x,o.y);else{var l={x:(s.x+o.x)*.5,y:(s.y+o.y)*.5};e.moveTo(l.x,l.y)}for(var u=0;u<i.length;++u)if(a=s,s=o,o=i[(u+1)%i.length],s.onCurve)e.lineTo(s.x,s.y);else{var c=o;a.onCurve||((s.x+a.x)*.5,(s.y+a.y)*.5),o.onCurve||(c={x:(s.x+o.x)*.5,y:(s.y+o.y)*.5}),e.quadraticCurveTo(s.x,s.y,c.x,c.y)}e.closePath()}return e}function cR(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],i=t.get(n.glyphIndex);if(i.getPath(),i.points){var a=void 0;if(n.matchedPoints===void 0)a=z2(i.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>i.points.length-1)throw Error("Matched points out of range in "+e.name);var s=e.points[n.matchedPoints[0]],o=i.points[n.matchedPoints[1]],l={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};o=z2([o],l)[0],l.dx=s.x-o.x,l.dy=s.y-o.y,a=z2(i.points,l)}e.points=e.points.concat(a)}}return uR(e.points)}function Tq(t,e,r,n){for(var i=new Cu.GlyphSet(n),a=0;a<r.length-1;a+=1){var s=r[a],o=r[a+1];s!==o?i.push(a,Cu.ttfGlyphLoader(n,a,lR,t,e+s,cR)):i.push(a,Cu.glyphLoader(n,a))}return i}function Nq(t,e,r,n){var i=new Cu.GlyphSet(n);return n._push=function(a){var s=r[a],o=r[a+1];s!==o?i.push(a,Cu.ttfGlyphLoader(n,a,lR,t,e+s,cR)):i.push(a,Cu.glyphLoader(n,a))},i}function Pq(t,e,r,n,i){return i.lowMemory?Nq(t,e,r,n):Tq(t,e,r,n)}var Mq={getPath:uR,parse:Pq},dR,bf,hR,lk;function fR(t){this.font=t,this.getCommands=function(e){return Mq.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Aq(t){return t}function pR(t){return Math.sign(t)*Math.round(Math.abs(t))}function Lq(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function Rq(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function Oq(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function Dq(t){return Math.sign(t)*Math.floor(Math.abs(t))}var mR=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,i=1;return t<0&&(t=-t,i=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*i:t*i},_u={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var i,a,s,o,l,u,c;if(!n||n===this){if(i=t.xo-e.xo,a=t.xo-r.xo,l=e.x-e.xo,u=r.x-r.xo,s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){t.x=t.xo+(l+u)/2;return}t.x=t.xo+(l*o+u*s)/c;return}if(i=n.distance(t,e,!0,!0),a=n.distance(t,r,!0,!0),l=n.distance(e,e,!1,!0),u=n.distance(r,r,!1,!0),s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){_u.setRelative(t,t,(l+u)/2,n,!0);return}_u.setRelative(t,t,(l*o+u*s)/c,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,i){if(!n||n===this){t.x=(i?e.xo:e.x)+r;return}var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y;t.x=o+(t.y-l)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},hc={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var i,a,s,o,l,u,c;if(!n||n===this){if(i=t.yo-e.yo,a=t.yo-r.yo,l=e.y-e.yo,u=r.y-r.yo,s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){t.y=t.yo+(l+u)/2;return}t.y=t.yo+(l*o+u*s)/c;return}if(i=n.distance(t,e,!0,!0),a=n.distance(t,r,!0,!0),l=n.distance(e,e,!1,!0),u=n.distance(r,r,!1,!0),s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){hc.setRelative(t,t,(l+u)/2,n,!0);return}hc.setRelative(t,t,(l*o+u*s)/c,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,i){if(!n||n===this){t.y=(i?e.yo:e.y)+r;return}var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y;t.y=l+n.normalSlope*(t.x-o)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(_u);Object.freeze(hc);function o0(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}o0.prototype.distance=function(t,e,r,n){return this.x*_u.distance(t,e,r,n)+this.y*hc.distance(t,e,r,n)};o0.prototype.interpolate=function(t,e,r,n){var i,a,s,o,l,u,c;if(s=n.distance(t,e,!0,!0),o=n.distance(t,r,!0,!0),i=n.distance(e,e,!1,!0),a=n.distance(r,r,!1,!0),l=Math.abs(s),u=Math.abs(o),c=l+u,c===0){this.setRelative(t,t,(i+a)/2,n,!0);return}this.setRelative(t,t,(i*u+a*l)/c,n,!0)};o0.prototype.setRelative=function(t,e,r,n,i){n=n||this;var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y,u=n.normalSlope,c=this.slope,h=t.x,p=t.y;t.x=(c*h-u*o+l-p)/(c-u),t.y=c*(t.x-h)+p};o0.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function l0(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?_u:t===0&&e===1?hc:new o0(t,e)}function pc(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}pc.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};pc.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var Av=Object.freeze(new pc(0,0)),Iq={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Id(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=_u,this.round=pR}}fR.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var i=this._fpgmState;if(!i){Id.prototype=Iq,i=this._fpgmState=new Id("fpgm",r.tables.fpgm),i.funcs=[],i.font=r,et.DEBUG&&(console.log("---EXEC FPGM---"),i.step=-1);try{bf(i)}catch(u){console.log("Hinting error in FPGM:"+u),this._errorState=3;return}}Id.prototype=i,n=this._prepState=new Id("prep",r.tables.prep),n.ppem=e;var a=r.tables.cvt;if(a)for(var s=n.cvt=new Array(a.length),o=e/r.unitsPerEm,l=0;l<a.length;l++)s[l]=a[l]*o;else n.cvt=[];et.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{bf(n)}catch(u){this._errorState<2&&console.log("Hinting error in PREP:"+u),this._errorState=2}}if(!(this._errorState>1))try{return hR(t,n)}catch(u){this._errorState<1&&(console.log("Hinting error:"+u),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};hR=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,i=t.components,a,s,o;if(Id.prototype=e,!i)o=new Id("glyf",t.instructions),et.DEBUG&&(console.log("---EXEC GLYPH---"),o.step=-1),lk(t,o,r,n),s=o.gZone;else{var l=e.font;s=[],a=[];for(var u=0;u<i.length;u++){var c=i[u],h=l.glyphs.get(c.glyphIndex);o=new Id("glyf",h.instructions),et.DEBUG&&(console.log("---EXEC COMP "+u+"---"),o.step=-1),lk(h,o,r,n);for(var p=Math.round(c.dx*r),g=Math.round(c.dy*n),y=o.gZone,S=o.contours,w=0;w<y.length;w++){var C=y[w];C.xTouched=C.yTouched=!1,C.xo=C.x=C.x+p,C.yo=C.y=C.y+g}var _=s.length;s.push.apply(s,y);for(var T=0;T<S.length;T++)a.push(S[T]+_)}t.instructions&&!o.inhibitGridFit&&(o=new Id("glyf",t.instructions),o.gZone=o.z0=o.z1=o.z2=s,o.contours=a,s.push(new pc(0,0),new pc(Math.round(t.advanceWidth*r),0)),et.DEBUG&&(console.log("---EXEC COMPOSITE---"),o.step=-1),bf(o),s.length-=2)}return s};lk=function(t,e,r,n){for(var i=t.points||[],a=i.length,s=e.gZone=e.z0=e.z1=e.z2=[],o=e.contours=[],l,u=0;u<a;u++)l=i[u],s[u]=new pc(l.x*r,l.y*n,l.lastPointOfContour,l.onCurve);for(var c,h,p=0;p<a;p++)l=s[p],c||(c=l,o.push(p)),l.lastPointOfContour?(l.nextPointOnContour=c,c.prevPointOnContour=l,c=void 0):(h=s[p+1],l.nextPointOnContour=h,h.prevPointOnContour=l);if(!e.inhibitGridFit){if(et.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var g=0;g<a;g++)console.log(g,s[g].x,s[g].y)}if(s.push(new pc(0,0),new pc(Math.round(t.advanceWidth*r),0)),bf(e),s.length-=2,et.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var y=0;y<a;y++)console.log(y,s[y].x,s[y].y)}}};bf=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(et.DEBUG&&t.step++,n=dR[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function G1(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new pc(0,0)}function gR(t,e){var r=t.prog,n=t.ip,i=1,a;do if(a=r[++n],a===88)i++;else if(a===89)i--;else if(a===64)n+=r[n+1]+1;else if(a===65)n+=2*r[n+1]+1;else if(a>=176&&a<=183)n+=a-176+1;else if(a>=184&&a<=191)n+=(a-184+1)*2;else if(e&&i===1&&a===27)break;while(i>0);t.ip=n}function G4(t,e){et.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function V4(t,e){et.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function H4(t,e){et.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function W4(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];et.DEBUG&&console.log("SPVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.pv=e.dpv=l0(o,l)}function q4(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];et.DEBUG&&console.log("SFVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.fv=l0(o,l)}function jq(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=l0(n,r)}function Fq(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=l0(n,r)}function Bq(t){var e=t.stack,r=t.pv;et.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function zq(t){var e=t.stack,r=t.fv;et.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Uq(t){t.fv=t.pv,et.DEBUG&&console.log(t.step,"SFVTPV[]")}function Gq(t){var e=t.stack,r=e.pop(),n=e.pop(),i=e.pop(),a=e.pop(),s=e.pop(),o=t.z0,l=t.z1,u=o[r],c=o[n],h=l[i],p=l[a],g=t.z2[s];et.DEBUG&&console.log("ISECT[], ",r,n,i,a,s);var y=u.x,S=u.y,w=c.x,C=c.y,_=h.x,T=h.y,N=p.x,R=p.y,I=(y-w)*(T-R)-(S-C)*(_-N),j=y*C-S*w,O=_*R-T*N;g.x=(j*(_-N)-O*(y-w))/I,g.y=(j*(T-R)-O*(S-C))/I}function Vq(t){t.rp0=t.stack.pop(),et.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function Hq(t){t.rp1=t.stack.pop(),et.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function Wq(t){t.rp2=t.stack.pop(),et.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function qq(t){var e=t.stack.pop();switch(et.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||G1(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function $q(t){var e=t.stack.pop();switch(et.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||G1(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Kq(t){var e=t.stack.pop();switch(et.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||G1(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Zq(t){var e=t.stack.pop();switch(et.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||G1(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Yq(t){t.loop=t.stack.pop(),et.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function Xq(t){et.DEBUG&&console.log(t.step,"RTG[]"),t.round=pR}function Qq(t){et.DEBUG&&console.log(t.step,"RTHG[]"),t.round=Rq}function Jq(t){var e=t.stack.pop();et.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function e$(t){et.DEBUG&&console.log(t.step,"ELSE[]"),gR(t,!1)}function t$(t){var e=t.stack.pop();et.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function r$(t){var e=t.stack.pop();et.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function n$(t){var e=t.stack;et.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function U2(t){et.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function i$(t){et.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function a$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function s$(t){var e=t.stack;et.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function o$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var i=t.ip,a=t.prog;t.prog=t.funcs[r];for(var s=0;s<n;s++)bf(t),et.DEBUG&&console.log(++t.step,s+1<n?"next loopcall":"done loopcall",s);t.ip=i,t.prog=a}function l$(t){var e=t.stack.pop();et.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],bf(t),t.ip=r,t.prog=n,et.DEBUG&&console.log(++t.step,"returning from",e)}function u$(t){var e=t.stack,r=e.pop();et.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function c$(t){var e=t.stack,r=e.pop();et.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function d$(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,i=e.pop(),a=n;for(et.DEBUG&&console.log(t.step,"FDEF[]",i);r[++n]!==45;);t.ip=n,t.funcs[i]=r.slice(a+1,n)}function $4(t,e){var r=e.stack.pop(),n=e.z0[r],i=e.fv,a=e.pv;et.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var s=a.distance(n,Av);t&&(s=e.round(s)),i.setRelative(n,Av,s,a),i.touch(n),e.rp0=e.rp1=r}function K4(t,e){var r=e.z2,n=r.length-2,i,a,s;et.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var o=0;o<n;o++)i=r[o],!t.touched(i)&&(a=i.prevTouched(t),a!==i&&(s=i.nextTouched(t),a===s&&t.setRelative(i,i,t.distance(a,a,!1,!0),t,!0),t.interpolate(i,a,s,t)))}function Z4(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=e.loop,l=e.z2;o--;){var u=r.pop(),c=l[u],h=s.distance(i,i,!1,!0);a.setRelative(c,c,h,s),a.touch(c),et.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-o)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",u)}e.loop=1}function Y4(t,e){var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=r.pop(),l=e.z2[e.contours[o]],u=l;et.DEBUG&&console.log(e.step,"SHC["+t+"]",o);var c=s.distance(i,i,!1,!0);do u!==i&&a.setRelative(u,u,c,s),u=u.nextPointOnContour;while(u!==l)}function X4(t,e){var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=r.pop();et.DEBUG&&console.log(e.step,"SHZ["+t+"]",o);var l;switch(o){case 0:l=e.tZone;break;case 1:l=e.gZone;break;default:throw new Error("Invalid zone")}for(var u,c=s.distance(i,i,!1,!0),h=l.length-2,p=0;p<h;p++)u=l[p],a.setRelative(u,u,c,s)}function h$(t){for(var e=t.stack,r=t.loop,n=t.fv,i=e.pop()/64,a=t.z2;r--;){var s=e.pop(),o=a[s];et.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",s,i),n.setRelative(o,o,i),n.touch(o)}t.loop=1}function f$(t){for(var e=t.stack,r=t.rp1,n=t.rp2,i=t.loop,a=t.z0[r],s=t.z1[n],o=t.fv,l=t.dpv,u=t.z2;i--;){var c=e.pop(),h=u[c];et.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"IP[]",c,r,"<->",n),o.interpolate(h,a,s,l),o.touch(h)}t.loop=1}function Q4(t,e){var r=e.stack,n=r.pop()/64,i=r.pop(),a=e.z1[i],s=e.z0[e.rp0],o=e.fv,l=e.pv;o.setRelative(a,s,n,l),o.touch(a),et.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,i),e.rp1=e.rp0,e.rp2=i,t&&(e.rp0=i)}function p$(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],i=t.loop,a=t.fv,s=t.pv,o=t.z1;i--;){var l=e.pop(),u=o[l];et.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"ALIGNRP[]",l),a.setRelative(u,n,0,s),a.touch(u)}t.loop=1}function m$(t){et.DEBUG&&console.log(t.step,"RTDG[]"),t.round=Lq}function J4(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z0[i],s=e.fv,o=e.pv,l=e.cvt[n];et.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",l,")",i);var u=o.distance(a,Av);t&&(Math.abs(u-l)<e.cvCutIn&&(u=l),u=e.round(u)),s.setRelative(a,Av,u,o),e.zp0===0&&(a.xo=a.x,a.yo=a.y),s.touch(a),e.rp0=e.rp1=i}function g$(t){var e=t.prog,r=t.ip,n=t.stack,i=e[++r];et.DEBUG&&console.log(t.step,"NPUSHB[]",i);for(var a=0;a<i;a++)n.push(e[++r]);t.ip=r}function v$(t){var e=t.ip,r=t.prog,n=t.stack,i=r[++e];et.DEBUG&&console.log(t.step,"NPUSHW[]",i);for(var a=0;a<i;a++){var s=r[++e]<<8|r[++e];s&32768&&(s=-((s^65535)+1)),n.push(s)}t.ip=e}function y$(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),i=e.pop();et.DEBUG&&console.log(t.step,"WS",n,i),r[i]=n}function x$(t){var e=t.stack,r=t.store,n=e.pop();et.DEBUG&&console.log(t.step,"RS",n);var i=r&&r[n]||0;e.push(i)}function b$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function w$(t){var e=t.stack,r=e.pop();et.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function e3(t,e){var r=e.stack,n=r.pop(),i=e.z2[n];et.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(i,Av,t,!1)*64)}function t3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z1[n],s=e.z0[i],o=e.dpv.distance(s,a,t,t);et.DEBUG&&console.log(e.step,"MD["+t+"]",n,i,"->",o),e.stack.push(Math.round(o*64))}function S$(t){et.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function k$(t){et.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function _$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function C$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function E$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function T$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function N$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function P$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function M$(t){var e=t.stack,r=e.pop();et.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function A$(t){var e=t.stack,r=e.pop();et.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function L$(t){var e=t.stack.pop();et.DEBUG&&console.log(t.step,"IF[]",e),e||(gR(t,!0),et.DEBUG&&console.log(t.step,"EIF[]"))}function R$(t){et.DEBUG&&console.log(t.step,"EIF[]")}function O$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function D$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function I$(t){var e=t.stack,r=e.pop();et.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function G2(t,e){var r=e.stack,n=r.pop(),i=e.fv,a=e.pv,s=e.ppem,o=e.deltaBase+(t-1)*16,l=e.deltaShift,u=e.z0;et.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var c=0;c<n;c++){var h=r.pop(),p=r.pop(),g=o+((p&240)>>4);if(g===s){var y=(p&15)-8;y>=0&&y++,et.DEBUG&&console.log(e.step,"DELTAPFIX",h,"by",y*l);var S=u[h];i.setRelative(S,S,y*l,a)}}}function j$(t){var e=t.stack,r=e.pop();et.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function F$(t){var e=t.stack,r=e.pop();et.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function B$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function z$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function U$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function G$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function V$(t){var e=t.stack,r=e.pop();et.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function H$(t){var e=t.stack,r=e.pop();et.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function W$(t){var e=t.stack,r=e.pop();et.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function q$(t){var e=t.stack,r=e.pop();et.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function yy(t,e){var r=e.stack,n=r.pop();et.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function $$(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function V2(t,e){var r=e.stack,n=r.pop(),i=e.ppem,a=e.deltaBase+(t-1)*16,s=e.deltaShift;et.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var o=0;o<n;o++){var l=r.pop(),u=r.pop(),c=a+((u&240)>>4);if(c===i){var h=(u&15)-8;h>=0&&h++;var p=h*s;et.DEBUG&&console.log(e.step,"DELTACFIX",l,"by",p),e.cvt[l]+=p}}}function K$(t){var e=t.stack.pop();et.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=mR;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function Z$(t){var e=t.stack.pop();et.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=mR;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function Y$(t){et.DEBUG&&console.log(t.step,"ROFF[]"),t.round=Aq}function X$(t){et.DEBUG&&console.log(t.step,"RUTG[]"),t.round=Oq}function Q$(t){et.DEBUG&&console.log(t.step,"RDTG[]"),t.round=Dq}function J$(t){var e=t.stack.pop();et.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function r3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];et.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.dpv=l0(o,l)}function eK(t){var e=t.stack,r=e.pop(),n=0;et.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function tK(t){var e=t.stack,r=e.pop(),n=e.pop(),i=e.pop();et.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(i)}function rK(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function nK(t){var e=t.stack,r=e.pop(),n=e.pop();et.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function iK(t){var e=t.stack.pop();et.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function aK(t){var e=t.stack.pop(),r=t.stack.pop();switch(et.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function wd(t,e){var r=e.stack,n=e.prog,i=e.ip;et.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var a=0;a<t;a++)r.push(n[++i]);e.ip=i}function Sd(t,e){var r=e.ip,n=e.prog,i=e.stack;et.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var a=0;a<t;a++){var s=n[++r]<<8|n[++r];s&32768&&(s=-((s^65535)+1)),i.push(s)}e.ip=r}function Gt(t,e,r,n,i,a){var s=a.stack,o=t&&s.pop(),l=s.pop(),u=a.rp0,c=a.z0[u],h=a.z1[l],p=a.minDis,g=a.fv,y=a.dpv,S,w,C,_;w=S=y.distance(h,c,!0,!0),C=w>=0?1:-1,w=Math.abs(w),t&&(_=a.cvt[o],n&&Math.abs(w-_)<a.cvCutIn&&(w=_)),r&&w<p&&(w=p),n&&(w=a.round(w)),g.setRelative(h,c,C*w,y),g.touch(h),et.DEBUG&&console.log(a.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(i===0?"Gr":i===1?"Bl":i===2?"Wh":"")+"]",t?o+"("+a.cvt[o]+","+_+")":"",l,"(d =",S,"->",C*w,")"),a.rp1=a.rp0,a.rp2=l,e&&(a.rp0=l)}dR=[G4.bind(void 0,hc),G4.bind(void 0,_u),V4.bind(void 0,hc),V4.bind(void 0,_u),H4.bind(void 0,hc),H4.bind(void 0,_u),W4.bind(void 0,0),W4.bind(void 0,1),q4.bind(void 0,0),q4.bind(void 0,1),jq,Fq,Bq,zq,Uq,Gq,Vq,Hq,Wq,qq,$q,Kq,Zq,Yq,Xq,Qq,Jq,e$,t$,r$,void 0,void 0,n$,U2,i$,a$,s$,u$,c$,void 0,void 0,void 0,o$,l$,d$,void 0,$4.bind(void 0,0),$4.bind(void 0,1),K4.bind(void 0,hc),K4.bind(void 0,_u),Z4.bind(void 0,0),Z4.bind(void 0,1),Y4.bind(void 0,0),Y4.bind(void 0,1),X4.bind(void 0,0),X4.bind(void 0,1),h$,f$,Q4.bind(void 0,0),Q4.bind(void 0,1),p$,m$,J4.bind(void 0,0),J4.bind(void 0,1),g$,v$,y$,x$,b$,w$,e3.bind(void 0,0),e3.bind(void 0,1),void 0,t3.bind(void 0,0),t3.bind(void 0,1),S$,void 0,k$,void 0,void 0,_$,C$,E$,T$,N$,P$,M$,A$,L$,R$,O$,D$,I$,G2.bind(void 0,1),j$,F$,B$,z$,U$,G$,V$,H$,W$,q$,yy.bind(void 0,0),yy.bind(void 0,1),yy.bind(void 0,2),yy.bind(void 0,3),void 0,void 0,void 0,void 0,$$,G2.bind(void 0,2),G2.bind(void 0,3),V2.bind(void 0,1),V2.bind(void 0,2),V2.bind(void 0,3),K$,Z$,void 0,void 0,Y$,void 0,X$,Q$,U2,U2,void 0,void 0,void 0,void 0,void 0,J$,r3.bind(void 0,0),r3.bind(void 0,1),eK,void 0,tK,rK,nK,iK,aK,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,wd.bind(void 0,1),wd.bind(void 0,2),wd.bind(void 0,3),wd.bind(void 0,4),wd.bind(void 0,5),wd.bind(void 0,6),wd.bind(void 0,7),wd.bind(void 0,8),Sd.bind(void 0,1),Sd.bind(void 0,2),Sd.bind(void 0,3),Sd.bind(void 0,4),Sd.bind(void 0,5),Sd.bind(void 0,6),Sd.bind(void 0,7),Sd.bind(void 0,8),Gt.bind(void 0,0,0,0,0,0),Gt.bind(void 0,0,0,0,0,1),Gt.bind(void 0,0,0,0,0,2),Gt.bind(void 0,0,0,0,0,3),Gt.bind(void 0,0,0,0,1,0),Gt.bind(void 0,0,0,0,1,1),Gt.bind(void 0,0,0,0,1,2),Gt.bind(void 0,0,0,0,1,3),Gt.bind(void 0,0,0,1,0,0),Gt.bind(void 0,0,0,1,0,1),Gt.bind(void 0,0,0,1,0,2),Gt.bind(void 0,0,0,1,0,3),Gt.bind(void 0,0,0,1,1,0),Gt.bind(void 0,0,0,1,1,1),Gt.bind(void 0,0,0,1,1,2),Gt.bind(void 0,0,0,1,1,3),Gt.bind(void 0,0,1,0,0,0),Gt.bind(void 0,0,1,0,0,1),Gt.bind(void 0,0,1,0,0,2),Gt.bind(void 0,0,1,0,0,3),Gt.bind(void 0,0,1,0,1,0),Gt.bind(void 0,0,1,0,1,1),Gt.bind(void 0,0,1,0,1,2),Gt.bind(void 0,0,1,0,1,3),Gt.bind(void 0,0,1,1,0,0),Gt.bind(void 0,0,1,1,0,1),Gt.bind(void 0,0,1,1,0,2),Gt.bind(void 0,0,1,1,0,3),Gt.bind(void 0,0,1,1,1,0),Gt.bind(void 0,0,1,1,1,1),Gt.bind(void 0,0,1,1,1,2),Gt.bind(void 0,0,1,1,1,3),Gt.bind(void 0,1,0,0,0,0),Gt.bind(void 0,1,0,0,0,1),Gt.bind(void 0,1,0,0,0,2),Gt.bind(void 0,1,0,0,0,3),Gt.bind(void 0,1,0,0,1,0),Gt.bind(void 0,1,0,0,1,1),Gt.bind(void 0,1,0,0,1,2),Gt.bind(void 0,1,0,0,1,3),Gt.bind(void 0,1,0,1,0,0),Gt.bind(void 0,1,0,1,0,1),Gt.bind(void 0,1,0,1,0,2),Gt.bind(void 0,1,0,1,0,3),Gt.bind(void 0,1,0,1,1,0),Gt.bind(void 0,1,0,1,1,1),Gt.bind(void 0,1,0,1,1,2),Gt.bind(void 0,1,0,1,1,3),Gt.bind(void 0,1,1,0,0,0),Gt.bind(void 0,1,1,0,0,1),Gt.bind(void 0,1,1,0,0,2),Gt.bind(void 0,1,1,0,0,3),Gt.bind(void 0,1,1,0,1,0),Gt.bind(void 0,1,1,0,1,1),Gt.bind(void 0,1,1,0,1,2),Gt.bind(void 0,1,1,0,1,3),Gt.bind(void 0,1,1,1,0,0),Gt.bind(void 0,1,1,1,0,1),Gt.bind(void 0,1,1,1,0,2),Gt.bind(void 0,1,1,1,0,3),Gt.bind(void 0,1,1,1,1,0),Gt.bind(void 0,1,1,1,1,1),Gt.bind(void 0,1,1,1,1,2),Gt.bind(void 0,1,1,1,1,3)];function gm(t){this.char=t,this.state={},this.activeState=null}function R_(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function sK(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function Bl(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function V1(t){this.eventId=t,this.subscribers=[]}function oK(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(i){Object.defineProperty(e.events,i,{value:new V1(i)})}),t&&r.forEach(function(i){var a=t[i];typeof a=="function"&&e.events[i].subscribe(a)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(i){e.events[i].subscribe(e.updateContextsRanges)})}function mi(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],oK.call(this,t)}gm.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState};gm.prototype.getState=function(t){return this.state[t]||null};mi.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length};mi.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(a){return e[a[0]].apply(e,a.slice(1).concat(r))}),i=function(a){return typeof a=="object"&&a.hasOwnProperty("FAIL")};if(n.every(i))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(i)};this.dispatch("composeRUD",[n.filter(function(a){return!i(a)})])};mi.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var i=r.every(function(s){return s instanceof gm});if(!isNaN(t)&&this.inboundIndex(t)&&i){var a=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[a,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};mi.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof gm){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};mi.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n};mi.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}};mi.prototype.insertToken=function(t,e,r){var n=t.every(function(i){return i instanceof gm});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}};mi.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,i){var a=[n,i],s=e===null||e.apply(this,a)===!0,o=[n,i];if(s){var l=r.apply(this,o);n.setState(t,l)}}),this.registeredModifiers.push(t)};V1.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};V1.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)};Bl.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)};Bl.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}};mi.prototype.rangeToText=function(t){if(t instanceof R_)return this.getRangeTokens(t).map(function(e){return e.char}).join("")};mi.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")};mi.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null};mi.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null};mi.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof V1&&n.subscribers.forEach(function(i){i.apply(r,e||[])})};mi.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new sK(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n};mi.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))};mi.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}};mi.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}};mi.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new Bl(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])};mi.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new R_(r,t,e),i=this.getContext(e).ranges;return n.rangeId=e+"."+i.length,i.push(n),this.getContext(e).openRange=null,n};mi.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var i=n.contextName,a=e.getContext(i).openRange;if(!a&&n.checkStart(t)&&(a=new R_(r,null,i),e.getContext(i).openRange=a,e.dispatch("contextStart",[i,r])),a&&n.checkEnd(t)){var s=r-a.startIndex+1,o=e.setEndOffset(s,i);e.dispatch("contextEnd",[i,o])}})};mi.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],i=new Bl(e,r);this.dispatch("next",[i]),this.runContextCheck(i);var a=new gm(n);this.tokens.push(a),this.dispatch("newToken",[a,i])}return this.dispatch("end",[this.tokens]),this.tokens};function Hd(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function vR(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function th(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function $y(t){return/[A-z]/.test(t)}function lK(t){return/\s/.test(t)}function So(t){this.font=t,this.features={}}function Qh(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function u0(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var i=r[n];if(t>=i.start&&t<=i.end){var a=t-i.start;return i.index+a}}break;default:return-1}return-1}function uK(t,e){var r=u0(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function cK(t,e){var r=u0(t,e.coverage);return r===-1?null:e.substitute[r]}function H2(t,e){for(var r=[],n=0;n<t.length;n++){var i=t[n],a=e.current;a=Array.isArray(a)?a[0]:a;var s=u0(a,i);s!==-1&&r.push(s)}return r.length!==t.length?-1:r}function dK(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=H2(e.inputCoverage,t);if(n===-1)return[];var i=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var a=t.lookahead.slice(i);a.length&&th(a[0].char);)a.shift();var s=new Bl(a,0),o=H2(e.lookaheadCoverage,s),l=[].concat(t.backtrack);for(l.reverse();l.length&&th(l[0].char);)l.shift();if(l.length<e.backtrackCoverage.length)return[];var u=new Bl(l,0),c=H2(e.backtrackCoverage,u),h=n.length===e.inputCoverage.length&&o.length===e.lookaheadCoverage.length&&c.length===e.backtrackCoverage.length,p=[];if(h)for(var g=0;g<e.lookupRecords.length;g++)for(var y=e.lookupRecords[g],S=y.lookupListIndex,w=this.getLookupByIndex(S),C=0;C<w.subtables.length;C++){var _=w.subtables[C],T=this.getLookupMethod(w,_),N=this.getSubstitutionType(w,_);if(N==="12")for(var R=0;R<n.length;R++){var I=t.get(R),j=T(I);j&&p.push(j)}}return p}function hK(t,e){var r=t.current,n=u0(r,e.coverage);if(n===-1)return null;for(var i,a=e.ligatureSets[n],s=0;s<a.length;s++){i=a[s];for(var o=0;o<i.components.length;o++){var l=t.lookahead[o],u=i.components[o];if(l!==u)break;if(o===i.components.length-1)return i}}return null}function fK(t,e){var r=u0(t,e.coverage);return r===-1?null:e.sequences[r]}So.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]};So.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var i=r[n];if(i.tag===t&&i.script.defaultLangSys)return i.script.defaultLangSys.featureIndexes;var a=i.langSysRecords;if(a)for(var s=0;s<a.length;s++){var o=a[s];if(o.tag===t){var l=o.langSys;return l.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};So.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var i=t[n].tag,a=t[n].feature;r[i]=a}this.features[e].tags=r};So.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(i){return n.features[i]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e};So.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n};So.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(i){return uK.apply(r,[i,e])};case"12":return function(i){return cK.apply(r,[i,e])};case"63":return function(i){return dK.apply(r,[i,e])};case"41":return function(i){return hK.apply(r,[i,e])};case"21":return function(i){return fK.apply(r,[i,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};So.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var i=this.getFeatureLookups(n),a=[].concat(e.context),s=0;s<i.length;s++)for(var o=i[s],l=this.getLookupSubtables(o),u=0;u<l.length;u++){var c=l[u],h=this.getSubstitutionType(o,c),p=this.getLookupMethod(o,c),g=void 0;switch(h){case"11":g=p(e.current),g&&a.splice(r,1,new Qh({id:11,tag:t.tag,substitution:g}));break;case"12":g=p(e.current),g&&a.splice(r,1,new Qh({id:12,tag:t.tag,substitution:g}));break;case"63":g=p(e),Array.isArray(g)&&g.length&&a.splice(r,1,new Qh({id:63,tag:t.tag,substitution:g}));break;case"41":g=p(e),g&&a.splice(r,1,new Qh({id:41,tag:t.tag,substitution:g}));break;case"21":g=p(e.current),g&&a.splice(r,1,new Qh({id:21,tag:t.tag,substitution:g}));break}e=new Bl(a,r),!(Array.isArray(g)&&!g.length)&&(g=null)}return a.length?a:null};So.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r};So.prototype.getLookupSubtables=function(t){return t.subtables||null};So.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null};So.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))};So.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function pK(t){var e=t.current,r=t.get(-1);return r===null&&Hd(e)||!Hd(r)&&Hd(e)}function mK(t){var e=t.get(1);return e===null||!Hd(e)}var gK={startCheck:pK,endCheck:mK};function vK(t){var e=t.current,r=t.get(-1);return(Hd(e)||th(e))&&!Hd(r)}function yK(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!Hd(e)&&!th(e)):var r=lK(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(i){return Hd(i)||th(i)}),!n)return!0}break;default:return!1}}var xK={startCheck:vK,endCheck:yK};function bK(t,e,r){e[r].setState(t.tag,t.substitution)}function wK(t,e,r){e[r].setState(t.tag,t.substitution)}function SK(t,e,r){t.substitution.forEach(function(n,i){var a=e[r+i];a.setState(t.tag,n)})}function kK(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var i=t.substitution.components.length,a=0;a<i;a++)n=e[r+a+1],n.setState("deleted",!0)}var n3={11:bK,12:wK,63:SK,41:kK};function O_(t,e,r){t instanceof Qh&&n3[t.id]&&n3[t.id](t,e,r)}function _K(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],i=vR(n),a=th(n);if(!i&&!a)return!0;if(i)return!1}return!1}function CK(t){if(vR(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=th(r);if(!n)return!0}return!1}function EK(t){var e=this,r="arab",n=this.featuresTags[r],i=this.tokenizer.getRangeTokens(t);if(i.length!==1){var a=new Bl(i.map(function(o){return o.getState("glyphIndex")}),0),s=new Bl(i.map(function(o){return o.char}),0);i.forEach(function(o,l){if(!th(o.char)){a.setCurrentIndex(l),s.setCurrentIndex(l);var u=0;_K(s)&&(u|=1),CK(s)&&(u|=2);var c;switch(u){case 1:c="fina";break;case 2:c="init";break;case 3:c="medi";break}if(n.indexOf(c)!==-1){var h=e.query.lookupFeature({tag:c,script:r,contextParams:a});if(h instanceof Error)return console.info(h.message);h.forEach(function(p,g){p instanceof Qh&&(O_(p,i,g),a.context[g]=p.substitution)})}}})}}function i3(t,e){var r=t.map(function(n){return n.activeState.value});return new Bl(r,0)}function TK(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),i=i3(n);i.context.forEach(function(a,s){i.setCurrentIndex(s);var o=e.query.lookupFeature({tag:"rlig",script:r,contextParams:i});o.length&&(o.forEach(function(l){return O_(l,n,s)}),i=i3(n))})}function NK(t){var e=t.current,r=t.get(-1);return r===null&&$y(e)||!$y(r)&&$y(e)}function PK(t){var e=t.get(1);return e===null||!$y(e)}var MK={startCheck:NK,endCheck:PK};function a3(t,e){var r=t.map(function(n){return n.activeState.value});return new Bl(r,0)}function AK(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),i=a3(n);i.context.forEach(function(a,s){i.setCurrentIndex(s);var o=e.query.lookupFeature({tag:"liga",script:r,contextParams:i});o.length&&(o.forEach(function(l){return O_(l,n,s)}),i=a3(n))})}function Ul(t){this.baseDir=t||"ltr",this.tokenizer=new mi,this.featuresTags={}}Ul.prototype.setText=function(t){this.text=t};Ul.prototype.contextChecks={latinWordCheck:MK,arabicWordCheck:gK,arabicSentenceCheck:xK};function W2(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function LK(){return W2.call(this,"latinWord"),W2.call(this,"arabicWord"),W2.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function RK(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}Ul.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(i){return r.query.supports({script:t,tag:i})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n};Ul.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new So(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}};Ul.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function D_(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function OK(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){D_.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){EK.call(t,n)})}}function DK(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){D_.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(i){TK.call(t,i)})}}}function IK(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){D_.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(i){AK.call(t,i)})}}}Ul.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)};Ul.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(OK.call(this),DK.call(this)),this.checkContextReady("latinWord")&&IK.call(this),this.checkContextReady("arabicSentence")&&RK.call(this)};Ul.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),LK.call(this),this.applyFeaturesToContexts())};Ul.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()};Ul.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var i=n.activeState.value;e.push(Array.isArray(i)?i[0]:i)}}return e};function Mn(t){t=t||{},t.tables=t.tables||{},t.empty||(Fg(t.familyName,"When creating a new Font object, familyName is required."),Fg(t.styleName,"When creating a new Font object, styleName is required."),Fg(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Fg(t.ascender,"When creating a new Font object, ascender is required."),Fg(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new Cu.GlyphSet(this,t.glyphs||[]),this.encoding=new KL(this),this.position=new s0(this),this.substitution=new wo(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new fR(this)}})}Mn.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null};Mn.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)};Mn.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Mn.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})};Mn.prototype.stringToGlyphs=function(t,e){var r=this,n=new Ul,i=function(h){return r.charToGlyphIndex(h.char)};n.registerModifier("glyphIndex",null,i);var a=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,a);for(var s=n.getTextGlyphs(t),o=s.length,l=new Array(o),u=this.glyphs.get(0),c=0;c<o;c+=1)l[c]=this.glyphs.get(s[c])||u;return l};Mn.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)};Mn.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Mn.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""};Mn.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0};Mn.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Mn.prototype.forEachGlyph=function(t,e,r,n,i,a){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,i=Object.assign({},this.defaultRenderOptions,i);var s=1/this.unitsPerEm*n,o=this.stringToGlyphs(t,i),l;if(i.kerning){var u=i.script||this.position.getDefaultScriptName();l=this.position.getKerningTables(u,i.language)}for(var c=0;c<o.length;c+=1){var h=o[c];if(a.call(this,h,e,r,n,i),h.advanceWidth&&(e+=h.advanceWidth*s),i.kerning&&c<o.length-1){var p=l?this.position.getKerningValue(l,h.index,o[c+1].index):this.getKerningValue(h,o[c+1]);e+=p*s}i.letterSpacing?e+=i.letterSpacing*n:i.tracking&&(e+=i.tracking/1e3*n)}return e};Mn.prototype.getPath=function(t,e,r,n,i){var a=new $i;return this.forEachGlyph(t,e,r,n,i,function(s,o,l,u){var c=s.getPath(o,l,u,i,this);a.extend(c)}),a};Mn.prototype.getPaths=function(t,e,r,n,i){var a=[];return this.forEachGlyph(t,e,r,n,i,function(s,o,l,u){var c=s.getPath(o,l,u,i,this);a.push(c)}),a};Mn.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})};Mn.prototype.draw=function(t,e,r,n,i,a){this.getPath(e,r,n,i,a).draw(t)};Mn.prototype.drawPoints=function(t,e,r,n,i,a){this.forEachGlyph(e,r,n,i,a,function(s,o,l,u){s.drawPoints(t,o,l,u)})};Mn.prototype.drawMetrics=function(t,e,r,n,i,a){this.forEachGlyph(e,r,n,i,a,function(s,o,l,u){s.drawMetrics(t,o,l,u)})};Mn.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en};Mn.prototype.validate=function(){var t=this;function e(n,i){}function r(n){var i=t.getEnglishName(n);i&&i.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0};Mn.prototype.toTables=function(){return Sq.fontToTable(this)};Mn.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Mn.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),i=0;i<e.length;i++)n[i]=e[i];return r};Mn.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(_q())if(window.URL=window.URL||window.webkitURL,window.URL){var i=new DataView(n),a=new Blob([i],{type:"font/opentype"}),s=document.createElement("a");s.href=window.URL.createObjectURL(a),s.download=t;var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!1),s.dispatchEvent(o)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var l=require("fs"),u=Cq(n);l.writeFileSync(t,u)}};Mn.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Mn.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Mn.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var kc=new Array(10);kc[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(We.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(We.coverage),values:this.parseValueRecordList()};pr.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};kc[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();pr.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(We.coverage),i=this.parseUShort(),a=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:a,pairSets:this.parseList(We.pointer(We.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(i),value2:this.parseValueRecord(a)}})))};if(r===2){var s=this.parsePointer(We.classDef),o=this.parsePointer(We.classDef),l=this.parseUShort(),u=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:a,classDef1:s,classDef2:o,class1Count:l,class2Count:u,classRecords:this.parseList(l,We.list(u,function(){return{value1:this.parseValueRecord(i),value2:this.parseValueRecord(a)}}))}}};kc[3]=function(){return{error:"GPOS Lookup 3 not supported"}};kc[4]=function(){return{error:"GPOS Lookup 4 not supported"}};kc[5]=function(){return{error:"GPOS Lookup 5 not supported"}};kc[6]=function(){return{error:"GPOS Lookup 6 not supported"}};kc[7]=function(){return{error:"GPOS Lookup 7 not supported"}};kc[8]=function(){return{error:"GPOS Lookup 8 not supported"}};kc[9]=function(){return{error:"GPOS Lookup 9 not supported"}};new Array(10);const jK=({stageRef:t,layers:e,selectedShapeId:r,onSelectShape:n,onChangeShape:i,tool:a,color:s,strokeWidth:o,lineCap:l,onDrawEnd:u})=>{const c=ie.useRef(!1),[h,p]=ir.useState(null),g=N=>{const R=N.target.getStage(),I=R.getRelativePointerPosition();if(a==="select"){if(N.target===R)n(null),p({x1:I.x,y1:I.y,x2:I.x,y2:I.y});else{const O=N.target;O.name()==="shape"&&n(O.id())}return}c.current=!0,u("START",{tool:a,pos:I,stroke:s,strokeWidth:o,lineCap:l})},y=N=>{const I=N.target.getStage().getRelativePointerPosition();if(a==="select"&&h){p(j=>({...j,x2:I.x,y2:I.y}));return}c.current&&u("MOVE",{pos:I})},S=N=>{if(a==="select"&&h){const R=Math.min(h.x1,h.x2),I=Math.min(h.y1,h.y2),j=Math.abs(h.x1-h.x2),O=Math.abs(h.y1-h.y2);if(j>5&&O>5){const V=N.target.getStage().find(".shape").filter(q=>{const D=q.getClientRect();return D.x>=R&&D.y>=I&&D.x+D.width<=R+j&&D.y+D.height<=I+O});n(V.map(q=>q.id()))}p(null)}c.current=!1,u("END")},w=ie.useRef(null),[C,_]=ir.useState({width:0,height:0});ir.useLayoutEffect(()=>{const N=()=>{w.current&&_({width:w.current.offsetWidth,height:w.current.offsetHeight})};return window.addEventListener("resize",N),N(),()=>window.removeEventListener("resize",N)},[]);const T=Array.isArray(r);return m.jsxs("div",{ref:w,className:"w-full h-full bg-[#050B0D] relative overflow-hidden flex items-center justify-center",children:[m.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:"radial-gradient(#00E5FF 1px, transparent 1px)",backgroundSize:"20px 20px"}}),m.jsxs(RL,{width:C.width,height:C.height,ref:t,onMouseDown:g,onMouseMove:y,onMouseUp:S,className:"bg-black/20 shadow-2xl border border-white/5",children:[e.slice().reverse().map(N=>N.visible&&m.jsx(vx,{children:N.shapes.map(R=>{T?r.includes(R.id):R.id;const I={...R,name:"shape",id:R.id,onClick:()=>a==="select"&&!N.locked&&n(R.id),onTap:()=>a==="select"&&!N.locked&&n(R.id),draggable:a==="select"&&!N.locked,onDragEnd:j=>{i(R.id,{x:j.target.x(),y:j.target.y()})},onTransformEnd:j=>{const O=j.target,F={x:O.x(),y:O.y(),scaleX:O.scaleX(),scaleY:O.scaleY(),rotation:O.rotation()};R.type==="rect"&&(F.width=O.width()*O.scaleX(),F.height=O.height()*O.scaleY(),F.scaleX=1,F.scaleY=1),i(R.id,F)}};return m.jsxs(ir.Fragment,{children:[R.type==="line"&&m.jsx(AL,{...I,lineCap:R.lineCap||"round",lineJoin:R.lineJoin||"round",tension:R.tension||0}),R.type==="path"&&m.jsx(dH,{...I,data:R.data,fill:R.fill||"#00E5FF",stroke:R.stroke||"#00E5FF"}),R.type==="rect"&&m.jsx(yx,{...I}),R.type==="circle"&&m.jsx(lH,{...I})]},R.id)})},N.id)),m.jsxs(vx,{children:[h&&m.jsx(yx,{x:Math.min(h.x1,h.x2),y:Math.min(h.y1,h.y2),width:Math.abs(h.x1-h.x2),height:Math.abs(h.y1-h.y2),fill:"rgba(0, 229, 255, 0.1)",stroke:"#00E5FF",strokeWidth:1,dash:[5,5]}),a==="select"&&r&&m.jsx(FK,{selectedShapeIds:T?r:[r]})]})]})]})},FK=({selectedShapeIds:t})=>{const e=ie.useRef();return ie.useEffect(()=>{if(e.current){const r=e.current.getStage(),n=t.map(i=>r.findOne("#"+i)).filter(Boolean);e.current.nodes(n),e.current.getLayer().batchDraw()}},[t]),m.jsx(LL,{ref:e,boundBoxFunc:(r,n)=>n.width<5||n.height<5?r:n,borderStroke:"#00E5FF",anchorStroke:"#00E5FF",anchorFill:"#050B0D",anchorSize:8})},BK=({tool:t,setTool:e,strokeWidth:r,setStrokeWidth:n,color:i,setColor:a,opacity:s,setOpacity:o,lineCap:l,setLineCap:u,strokeStyle:c,setStrokeStyle:h,layers:p,activeLayerId:g,setActiveLayerId:y,onToggleLayerVisibility:S,onToggleLayerLock:w,onAddLayer:C,onDeleteLayer:_,activeShape:T,onSetProperty:N,onUndo:R,onRedo:I,onClear:j})=>m.jsxs("div",{className:"flex flex-col h-full gap-8 p-6 text-slate-300",children:[m.jsxs("section",{className:"bg-white/5 rounded-2xl p-4 grid grid-cols-4 gap-2",children:[[{id:"select",icon:"near_me",label:"Select"},{id:"brush",icon:"gesture",label:"Brush"},{id:"line",icon:"horizontal_rule",label:"Line"},{id:"rect",icon:"rectangle",label:"Box"},{id:"circle",icon:"circle",label:"Circle"},{id:"eraser",icon:"ink_eraser",label:"Erase"}].map(O=>m.jsx("button",{onClick:()=>e(O.id),className:`aspect-square rounded-xl flex flex-col items-center justify-center gap-1 transition-all ${t===O.id?"bg-primary text-white shadow-[0_0_15px_rgba(0,229,255,0.4)]":"text-slate-400 hover:text-white hover:bg-white/10"}`,title:O.label,children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:O.icon})},O.id)),m.jsx("button",{onClick:R,className:"aspect-square rounded-xl flex items-center justify-center text-slate-500 hover:text-white hover:bg-white/10",title:"Undo",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"undo"})}),m.jsx("button",{onClick:I,className:"aspect-square rounded-xl flex items-center justify-center text-slate-500 hover:text-white hover:bg-white/10",title:"Redo",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"redo"})}),m.jsx("button",{onClick:j,className:"aspect-square rounded-xl flex items-center justify-center text-slate-500 hover:text-red-400 hover:bg-red-400/10",title:"Clear Canvas",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"delete_sweep"})})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-primary/60 border-b border-white/5 pb-2",children:"Propiedades"}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between text-[10px] uppercase font-bold text-slate-500",children:[m.jsx("span",{children:"Grosor de Trazo"}),m.jsxs("span",{children:[r,"px"]})]}),m.jsx("input",{type:"range",min:"1",max:"50",value:r,onChange:O=>n(parseInt(O.target.value)),className:"w-full accent-primary h-1 bg-white/10 rounded-full appearance-none cursor-pointer"})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between text-[10px] uppercase font-bold text-slate-500",children:[m.jsx("span",{children:"Opacidad"}),m.jsxs("span",{children:[Math.round(s*100),"%"]})]}),m.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:s,onChange:O=>o(parseFloat(O.target.value)),className:"w-full accent-primary h-1 bg-white/10 rounded-full appearance-none cursor-pointer"})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Color / Relleno"}),m.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white/5 rounded-lg border border-white/5",children:[m.jsx("input",{type:"color",value:i,onChange:O=>a(O.target.value),className:"size-8 rounded cursor-pointer bg-transparent border-none"}),m.jsx("span",{className:"text-xs font-mono text-primary",children:i})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Terminacin (Cap)"}),m.jsx("div",{className:"flex bg-white/5 rounded-lg p-1",children:["butt","round","square"].map(O=>m.jsx("button",{onClick:()=>u(O),className:`flex-1 py-1 rounded text-[10px] uppercase transition-all ${l===O?"bg-primary text-white shadow-lg font-black":"hover:text-white text-slate-500"}`,children:O==="round"?"":O==="square"?"":"|"},O))})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Estilo de Trazo"}),m.jsx("div",{className:"flex bg-white/5 rounded-lg p-1",children:[{id:"linear",label:"Lnea",icon:"segment"},{id:"points",label:"Puntos",icon:"more_horiz"},{id:"quadratic",label:"Curva",icon:"conversion_path"}].map(O=>m.jsx("button",{onClick:()=>h(O.id),className:`flex-1 py-1.5 rounded flex items-center justify-center gap-2 text-[9px] uppercase transition-all ${c===O.id?"bg-primary text-white shadow-lg font-black":"hover:text-white text-slate-500"}`,title:O.label,children:m.jsx("span",{className:"material-symbols-outlined text-xs",children:O.icon})},O.id))})]})]}),m.jsxs("section",{className:"flex-1 flex flex-col min-h-0 space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between border-b border-white/5 pb-2",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-primary/60",children:"Capas"}),m.jsx("button",{onClick:C,className:"size-6 flex items-center justify-center rounded bg-white/5 hover:bg-primary hover:text-white transition-colors",title:"Nueva Capa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 pr-2 custom-scrollbar",children:p.slice().reverse().map(O=>m.jsxs("div",{onClick:()=>y(O.id),className:`group flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer ${g===O.id?"bg-primary/10 border-primary/50":"bg-white/5 border-transparent hover:border-white/10"}`,children:[m.jsx("button",{onClick:F=>{F.stopPropagation(),S(O.id)},className:`text-slate-500 hover:text-white ${!O.visible&&"opacity-30"}`,children:m.jsx("span",{className:"material-symbols-outlined text-base",children:O.visible?"visibility":"visibility_off"})}),m.jsxs("div",{className:"flex-1 flex flex-col",children:[m.jsx("span",{className:`text-xs font-bold leading-none ${g===O.id?"text-white":"text-slate-400"}`,children:O.name}),m.jsxs("span",{className:"text-[9px] font-black uppercase text-slate-600 mt-1",children:[O.shapes.length," Objetos"]})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("button",{onClick:F=>{F.stopPropagation(),w(O.id)},className:`text-slate-500 hover:text-white p-1 rounded hover:bg-white/5 ${O.locked?"text-red-400 opacity-100":"opacity-0 group-hover:opacity-100"}`,children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:O.locked?"lock":"lock_open"})}),m.jsx("button",{onClick:F=>{F.stopPropagation(),_(O.id)},className:"p-1 text-slate-500 hover:text-red-400 opacity-0 group-hover:opacity-100 rounded hover:bg-white/5",title:"Eliminar Capa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]})]},O.id))})]})]}),zK=({stats:t,langName:e,glyphs:r=[],rules:n=[],onEditGlyph:i,onCreateGlyph:a,onCreateRule:s,onViewAllGlyphs:o})=>{const{t:l}=Ps();return m.jsxs("div",{className:"h-full flex flex-col p-4 space-y-6 animate-in fade-in slide-in-from-right-4 overflow-y-auto custom-scrollbar",children:[m.jsxs("div",{className:"flex items-center gap-3 text-slate-400 shrink-0",children:[m.jsx("span",{className:"material-symbols-outlined",children:"translate"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest",children:e||"Language"})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-2 shrink-0",children:[m.jsxs("div",{className:"bg-[#1a1a20] border border-white/5 p-2 rounded-xl text-center",children:[m.jsx("div",{className:"text-xl font-serif text-white font-bold",children:t?.words||0}),m.jsx("div",{className:"text-[8px] text-slate-500 uppercase tracking-widest",children:"Words"})]}),m.jsxs("div",{className:"bg-[#1a1a20] border border-white/5 p-2 rounded-xl text-center",children:[m.jsx("div",{className:"text-xl font-serif text-white font-bold",children:t?.rules||0}),m.jsx("div",{className:"text-[8px] text-slate-500 uppercase tracking-widest",children:"Rules"})]}),m.jsxs("div",{className:"bg-[#1a1a20] border border-white/5 p-2 rounded-xl text-center",children:[m.jsx("div",{className:"text-xl font-serif text-white font-bold",children:t?.glyphs||0}),m.jsx("div",{className:"text-[8px] text-slate-500 uppercase tracking-widest",children:"Glyphs"})]})]}),m.jsx("div",{className:"h-px bg-white/5 my-2 shrink-0"}),m.jsxs("section",{className:"space-y-4 shrink-0",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:l("linguistics.writing_system")||"WRITING SYSTEM"}),m.jsx("button",{onClick:a,className:"text-primary hover:text-white transition-colors",title:"Create New Glyph",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"add_circle"})})]}),m.jsxs("div",{className:"p-4 bg-[#1a1a20] border border-white/5 rounded-2xl",children:[m.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[r.slice(0,12).map(u=>m.jsx("div",{onClick:()=>i(u),className:"aspect-square rounded-lg bg-black/40 border border-white/5 flex items-center justify-center text-xl font-serif text-primary hover:border-primary/40 hover:bg-primary/5 transition-all cursor-pointer",title:u.lema,children:m.jsx("span",{children:u.lema})},u.id)),r.length===0&&m.jsx("div",{className:"col-span-4 py-8 flex items-center justify-center opacity-20",children:m.jsx("span",{className:"text-[8px] font-black uppercase font-mono",children:"No Glyphs"})})]}),m.jsx("div",{className:"mt-3 text-center",children:m.jsxs("button",{onClick:o,className:"text-[9px] font-bold text-primary hover:underline uppercase tracking-wide",children:["View all (",r.length,")"]})})]})]}),m.jsxs("section",{className:"space-y-4 shrink-0",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:l("linguistics.grammar")||"GRAMMAR"}),m.jsx("button",{onClick:s,className:"text-primary hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"add_circle"})})]}),m.jsx("div",{className:"space-y-2",children:n.length>0?n.map(u=>m.jsxs("div",{className:"p-3 bg-[#1a1a20] border border-white/5 rounded-xl hover:border-primary/30 transition-all cursor-pointer group",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("div",{className:`size-1.5 rounded-full ${u.status==="complete"?"bg-emerald-500":"bg-amber-500"}`}),m.jsx("span",{className:"text-[10px] font-bold text-white group-hover:text-primary transition-colors",children:u.titulo})]}),m.jsx("p",{className:"text-[9px] text-slate-500 leading-tight line-clamp-2",children:u.descripcion})]},u.id)):m.jsx("div",{className:"p-4 text-center border border-dashed border-white/10 rounded-xl",children:m.jsx("p",{className:"text-[9px] text-slate-600 italic",children:"No rules defined."})})})]})]})},UK=({onOpenEditor:t})=>{const{t:e}=Ps(),{projectName:r}=Va(),{setRightPanelTab:n,setRightOpen:i}=bo(),[a,s]=ie.useState("..."),[o,l]=ie.useState({words:0,rules:0,glyphs:0}),[u,c]=ie.useState("..."),[h,p]=ie.useState([]),[g,y]=ie.useState([]),[S,w]=ie.useState(null),[C,_]=ie.useState(""),[T,N]=ie.useState(""),[R,I]=ie.useState(!1),[j,O]=ie.useState("lexicon"),[F,z]=ie.useState(""),[V,q]=ie.useState("MANAGEMENT"),[D,U]=ie.useState(!1),[G,Z]=ie.useState(null),[K,Q]=ie.useState(!1),[ne,te]=ie.useState(null),[X,re]=ie.useState(null),[he,oe]=ie.useState("CHRONOS_ATLAS_V1"),[se,fe]=ie.useState("ARCHITECT_ID"),[ae,pe]=ie.useState("TTF"),[ye,ve]=ie.useState(!0),[ue,xe]=ie.useState(!0),[Se,Oe]=ie.useState([{msg:"Inicializando Bfer de Glifos...",type:"info"},{msg:"Sincronizacin de Diccionario Activa",type:"success"}]),Ae={ALPHABET:{id:"ALPHABET"}},[tt,rt]=ie.useState(Ae.ALPHABET.id),[dt,_t]=ie.useState(""),[Xe,ht]=ie.useState([]),[ct,vt]=ie.useState([]),lt=(Ge,Ye="info")=>{Oe(nt=>[...nt.slice(-4),{msg:Ge,type:Ye}])},[Lt,jt]=ie.useState(!1),[Ne,qe]=ie.useState(null),[bt,at]=ie.useState([{id:"layer1",name:"Trazo Principal",visible:!0,locked:!1,shapes:[]},{id:"layer2",name:"Guas",visible:!0,locked:!1,shapes:[]}]),[ut,Fe]=ie.useState("layer1"),[de,ge]=ie.useState(null),[ke,Ee]=ie.useState([]),[Le,Qe]=ie.useState([]),Ve=Ge=>{const Ye=JSON.parse(JSON.stringify(Ge));Ee(nt=>[...nt.slice(-19),Ye]),Qe([])},xt=()=>{if(ke.length===0)return;const Ge=ke[ke.length-1];Ee(Ye=>Ye.slice(0,-1)),Qe(Ye=>[bt,...Ye]),at(Ge)},ze=()=>{if(Le.length===0)return;const Ge=Le[0];Qe(Ye=>Ye.slice(1)),Ee(Ye=>[...Ye,bt]),at(Ge)},[$e,wt]=ie.useState("brush"),[Pt,Ct]=ie.useState(4),[Vt,Yt]=ie.useState("#00E5FF"),[Lr,kr]=ie.useState(1),[Qr,Jr]=ie.useState("round"),[_r,hn]=ie.useState("linear"),vr=ir.useRef(null);ie.useEffect(()=>{gi(),i(!0),n&&n("CONTEXT"),I(!0);const Ge=setInterval(()=>{const Ye=document.getElementById("global-right-panel-portal");Ye&&(console.log("[LinguisticsHub] Portal found, clearing before use"),Ye.innerHTML="",re(Ye),clearInterval(Ge))},100);return()=>{clearInterval(Ge),console.log("[LinguisticsHub] Cleanup: clearing portal");const Ye=document.getElementById("global-right-panel-portal");Ye&&(Ye.innerHTML=""),n&&n("NOTEBOOKS")}},[]),ie.useEffect(()=>{!de||Array.isArray(de)||at(Ge=>{const Ye=Ge.map(nt=>({...nt,shapes:nt.shapes.map(pt=>{if(pt.id===de&&(pt.type==="line"||pt.type==="brush")){const Ze={...pt};return _r==="points"?(Ze.dash=[2,10],delete Ze.tension):_r==="quadratic"?(Ze.tension=.8,delete Ze.dash):(delete Ze.dash,delete Ze.tension),Ze}return pt})}));return Ve(Ye),Ye})},[_r]),ie.useEffect(()=>{!de||Array.isArray(de)&&de.length===0||at(Ge=>Ge.map(nt=>({...nt,shapes:nt.shapes.map(pt=>(Array.isArray(de)?de.includes(pt.id):pt.id===de)?{...pt,stroke:Vt,strokeWidth:Pt,opacity:Lr,lineCap:Qr}:pt)})))},[Vt,Pt,Lr,Qr]);const Et=Ge=>{if(qe(Ge.id),jt(!0),setRightPanelMode("LINGUISTICS"),Ge.rawEditorData)try{const nt=JSON.parse(Ge.rawEditorData);if(Array.isArray(nt)&&nt.length>0){at(nt),Fe(nt[0].id);return}}catch(nt){console.error("Error parsing rawEditorData:",nt)}const Ye=[];Ge.svgPathData&&Ye.push({id:crypto.randomUUID(),type:"path",data:Ge.svgPathData,x:0,y:0,stroke:"#00E5FF",strokeWidth:2,fill:null,scaleX:1,scaleY:1}),at([{id:"layer1",name:"Trazo Principal",visible:!0,locked:!1,shapes:Ye},{id:"layer2",name:"Guas",visible:!0,locked:!1,shapes:[]}]),Fe("layer1")},Br=()=>{jt(!1),qe(null),ge(null)},Xn=async()=>{if(!Ne||!S)return;const Ge=bt.filter(Jt=>Jt.visible&&!Jt.name.toLowerCase().includes("gua")).flatMap(Jt=>Jt.shapes);if(Ge.length===0){lt("No hay trazos para guardar","warning");return}let Ye="",nt=1/0,pt=1/0,Ze=-1/0,Dt=-1/0;const Nr=Jt=>{const tr=Jt.x||0,Rr=Jt.y||0;if(Jt.type==="line"&&Jt.points)for(let er=0;er<Jt.points.length;er+=2){const en=Jt.points[er]+tr,yn=Jt.points[er+1]+Rr;nt=Math.min(nt,en),pt=Math.min(pt,yn),Dt=Math.max(Dt,en),Ze=Math.max(Ze,yn)}else if(Jt.type==="rect")nt=Math.min(nt,tr),pt=Math.min(pt,Rr),Dt=Math.max(Dt,tr+(Jt.width||0)),Ze=Math.max(Ze,Rr+(Jt.height||0));else if(Jt.type==="circle"){const er=Jt.radius||0;nt=Math.min(nt,tr-er),pt=Math.min(pt,Rr-er),Dt=Math.max(Dt,tr+er),Ze=Math.max(Ze,Rr+er)}};if(Ge.forEach(Nr),nt===1/0)return;const Pr=(nt+Dt)/2,Fr=(pt+Ze)/2,vi=vr.current,zt=vi.width()/2-Pr,Ir=vi.height()/2-Fr,al=bt.map(Jt=>({...Jt,shapes:Jt.shapes.map(tr=>({...tr,x:(tr.x||0)+zt,y:(tr.y||0)+Ir}))}));Ge.forEach(Jt=>{const tr=(Jt.x||0)+zt,Rr=(Jt.y||0)+Ir;if(Jt.type==="line"&&Jt.points&&Jt.points.length>=4){if(Jt.globalCompositeOperation==="destination-out")return;Ye+=`M ${Jt.points[0]+tr} ${Jt.points[1]+Rr} `;for(let er=2;er<Jt.points.length;er+=2)Ye+=`L ${Jt.points[er]+tr} ${Jt.points[er+1]+Rr} `}else if(Jt.type==="rect"){const er=Jt.width||0,en=Jt.height||0;Ye+=`M ${tr} ${Rr} L ${tr+er} ${Rr} L ${tr+er} ${Rr+en} L ${tr} ${Rr+en} Z `}else if(Jt.type==="circle"){const er=Jt.radius||0,en=.5522847498*er;Ye+=`M ${tr} ${Rr-er} 
                             C ${tr+en} ${Rr-er} ${tr+er} ${Rr-en} ${tr+er} ${Rr} 
                             C ${tr+er} ${Rr+en} ${tr+en} ${Rr+er} ${tr} ${Rr+er} 
                             C ${tr-en} ${Rr+er} ${tr-er} ${Rr+en} ${tr-er} ${Rr} 
                             C ${tr-er} ${Rr-en} ${tr-en} ${Rr-er} ${tr} ${Rr-er} Z `}});try{const Jt=h.find(Rr=>Rr.id===Ne)||{lema:"Nuevo Glifo",categoriaGramatical:"GLYPH",definicion:"Glifo dibujado manualmente"};h.some(Rr=>Rr.id===Ne)?await Ke.put(`/conlang/${S}/palabra/${Ne}`,{...Jt,svgPathData:Ye,rawEditorData:JSON.stringify(al)}):await Ke.post(`/conlang/${S}/palabra`,{...Jt,id:Ne,svgPathData:Ye,rawEditorData:JSON.stringify(al)}),qa(S),lt("Glifo guardado y centrado con xito","success")}catch(Jt){throw console.error("Error saving glyph:",Jt),lt("Error al guardar glifo","error"),Jt}},Zi=Ge=>{te(Ge),Q(!0)},ds=async()=>{if(!(!ne||!S))try{await Ke.delete(`/conlang/${S}/palabra/${ne}`),qa(S),lt("Palabra eliminada","success"),te(null),Q(!1)}catch(Ge){console.error("Error deleting word:",Ge),lt("Error al eliminar palabra","error")}},As=Ge=>{Z(Ge),U(!0)},ni=async Ge=>{if(S)try{Ge.isNew?await Ke.post(`/conlang/${S}/palabra`,Ge):await Ke.put(`/conlang/${S}/palabra/${G.id}`,Ge),qa(S),lt("Cambios sincronizados","success"),U(!1),Z(null)}catch(Ye){console.error("Error saving meaning:",Ye),lt("Error al sincronizar cambios","error")}},sn=h.filter(Ge=>{const Ye=F.toLowerCase(),nt=(Ge.lema||"").toLowerCase(),pt=(Ge.traduccionEspanol||Ge.definicion||"").toLowerCase();return nt.includes(Ye)||pt.includes(Ye)}),kn=(Ge,Ye)=>{if(Ge==="START"){const nt=bt.find(Ze=>Ze.id===ut);if(!nt||nt.locked||!nt.visible){lt("Capa bloqueada u oculta","warning");return}const pt={id:crypto.randomUUID(),type:$e,stroke:Vt,strokeWidth:Pt,opacity:Lr,lineCap:Qr,lineJoin:"round",x:$e==="brush"||$e==="eraser"||$e==="line"?0:Ye.pos.x,y:$e==="brush"||$e==="eraser"||$e==="line"?0:Ye.pos.y};$e==="brush"||$e==="eraser"?(pt.type="line",pt.points=[Ye.pos.x,Ye.pos.y,Ye.pos.x,Ye.pos.y],$e==="eraser"&&(pt.globalCompositeOperation="destination-out",pt.strokeWidth=Pt*2),_r==="points"&&$e!=="eraser"&&(pt.dash=[2,10]),_r==="quadratic"&&$e!=="eraser"&&(pt.tension=.8)):$e==="line"?(pt.type="line",pt.points=[Ye.pos.x,Ye.pos.y,Ye.pos.x,Ye.pos.y],_r==="points"&&(pt.dash=[2,10]),_r==="quadratic"&&(pt.tension=.8)):$e==="rect"?(pt.width=0,pt.height=0,_r==="points"&&(pt.dash=[5,5])):$e==="circle"&&(pt.radius=0,_r==="points"&&(pt.dash=[5,5])),at(Ze=>{const Dt=Ze.map(Nr=>Nr.id===ut?{...Nr,shapes:[...Nr.shapes,pt]}:Nr);return Ve(Dt),Dt}),ge(pt.id)}else Ge==="MOVE"?at(nt=>nt.map(pt=>{if(pt.id===ut){const Ze=[...pt.shapes],Dt={...Ze[Ze.length-1]};if(!Dt)return pt;if($e==="brush"||$e==="eraser")Dt.points=[...Dt.points,Ye.pos.x,Ye.pos.y];else if($e==="line")Dt.points=[Dt.points[0],Dt.points[1],Ye.pos.x,Ye.pos.y];else if($e==="rect")Dt.width=Ye.pos.x-Dt.x,Dt.height=Ye.pos.y-Dt.y;else if($e==="circle"){const Nr=Ye.pos.x-Dt.x,Pr=Ye.pos.y-Dt.y;Dt.radius=Math.sqrt(Nr*Nr+Pr*Pr)}return Ze[Ze.length-1]=Dt,{...pt,shapes:Ze}}return pt})):Ge==="END"&&Ve(bt)},In=()=>{const Ge={id:crypto.randomUUID()};qe(Ge.id);const Ye=crypto.randomUUID();at([{id:Ye,name:"Capa 1",visible:!0,locked:!1,shapes:[]}]),Fe(Ye),jt(!0),setRightPanelMode("LINGUISTICS")},Ls=(Ge,Ye)=>{at(nt=>nt.map(pt=>({...pt,shapes:pt.shapes.map(Ze=>Ze.id===Ge?{...Ze,...Ye}:Ze)})))},gi=async()=>{try{const Ge=await Ke.get("/bd/proyecto-activo");s(Ge.nombreProyecto);const Ye=await Ke.get("/conlang/stats");l(Ye);const nt=await Ke.get("/conlang/lenguas");nt&&nt.length>0&&(c(nt[0].nombre),w(nt[0].id),ko(nt[0].id),qa(nt[0].id))}catch(Ge){console.error("Error loading conlang data:",Ge),s("Default Project")}},ko=async Ge=>{try{const Ye=await Ke.get(`/conlang/${Ge}/rules`);y(Ye)}catch(Ye){console.error("Error loading rules:",Ye)}},qa=async Ge=>{try{const Ye=await Ke.get(`/conlang/${Ge}/diccionario`);p(Ye),vt(Ye.filter(nt=>["GLYPH","GLYFO","GLIFO"].includes(nt.categoriaGramatical)||nt.svgPathData&&nt.lema.length===1))}catch(Ye){console.error("Error loading lexicon:",Ye)}},Ru=async()=>{if(!S)return;const Ge=prompt("Enter rule title:");if(!Ge)return;const Ye=prompt("Enter rule description:"),nt=prompt("Enter category (Grammar, Syntax, etc.):");try{await Ke.post(`/conlang/${S}/rules`,{titulo:Ge,descripcion:Ye,categoria:nt,status:"IN_PROGRESS"}),ko(S);const pt=await Ke.get("/conlang/stats");l(pt)}catch(pt){console.error("Error adding rule:",pt)}},_o=Ge=>{_(Ge);const Ye=Ge.split("").map(nt=>{const pt=ct.find(Ze=>Ze.lema.toLowerCase()===nt.toLowerCase());return pt?pt.lema:nt}).join(" ");N(Ye)},on=Ge=>{_t(Ge);const Ye=Ge.split("").map(nt=>ct.find(Ze=>Ze.lema.toLowerCase()===nt.toLowerCase())||{lema:nt,placeholder:!0});ht(Ye)},Co=async()=>{if(!(!S||!dt))try{await Ke.post(`/conlang/${S}/palabra`,{lema:dt,definicion:`Entrada automtica (${new Date().toLocaleDateString()})`,categoriaGramatical:"COMPUESTA"}),qa(S),lt(`Palabra "${dt}" sincronizada automticamente`,"success")}catch(Ge){console.error("Error al guardar automticamente:",Ge)}},hs=()=>{const Ge=ct.map(nt=>nt.unicodeCode).filter(nt=>nt&&nt.startsWith("U+")).map(nt=>parseInt(nt.replace("U+",""),16));return`U+${(Ge.length>0?Math.max(...Ge)+1:57344).toString(16).toUpperCase()}`},ro=ie.useRef(null),Yi=()=>{ro.current.click()},no=async Ge=>{const Ye=Ge.target.files[0];if(!Ye)return;const nt=new FileReader;nt.onload=async pt=>{const Dt=pt.target.result.match(/d="([^"]+)"/);if(Dt&&Dt[1]){const Nr=Dt[1],Pr=hs(),Fr=String.fromCharCode(parseInt(Pr.replace("U+",""),16));try{await Ke.post(`/conlang/${S}/palabra`,{lema:Fr,categoriaGramatical:"GLYFO",definicion:`Glifo importado (${Ye.name})`,svgPathData:Nr,unicodeCode:Pr}),qa(S),lt(`Glifo ${Pr} importado con xito`,"success")}catch{lt("Error al importar glifo","error")}}else alert("SVG invlido para renderizado de glifos.")},nt.readAsText(Ye),Ge.target.value=null};return m.jsxs("div",{className:"flex-1 flex flex-col h-full bg-[#050508] text-slate-300 font-sans overflow-hidden",children:[m.jsx("input",{type:"file",ref:ro,onChange:no,accept:".svg",className:"hidden"}),m.jsxs("div",{className:"h-16 border-b border-white/5 flex items-center justify-between px-8 bg-black/40",children:[m.jsx("div",{className:"flex items-center gap-4"}),!Lt&&m.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 flex bg-white/5 p-1 rounded-xl border border-white/5 backdrop-blur-md",children:[{id:"lexicon",label:e("linguistics.lexicon")},{id:"translator",label:e("linguistics.translator")},{id:"diccionario",label:"DICCIONARIO"}].map(Ge=>m.jsx("button",{onClick:()=>O(Ge.id),className:`px-6 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${j===Ge.id?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:Ge.label},Ge.id))}),Lt&&m.jsxs("div",{className:"flex items-center gap-3 bg-white/5 p-1 rounded-xl border border-white/5",children:[m.jsxs("button",{onClick:Br,className:"flex items-center gap-2 px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest text-red-400 hover:bg-red-400/10 transition-all border border-transparent hover:border-red-400/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"}),"Descartar"]}),m.jsx("div",{className:"w-px h-4 bg-white/10 mx-1"}),m.jsxs("button",{onClick:async()=>{await Xn(),Br()},className:"flex items-center gap-2 px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest bg-primary text-white shadow-lg hover:shadow-primary/20 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"check"}),"Aplicar y Guardar"]})]})]}),m.jsx("main",{className:"flex-1 overflow-y-auto no-scrollbar p-8 lg:p-12 relative flex flex-col",children:Lt?m.jsx("div",{className:"flex-1 flex flex-col h-full relative",children:m.jsx(jK,{stageRef:vr,layers:bt,selectedShapeId:de,onSelectShape:ge,onChangeShape:Ls,tool:$e,color:Vt,strokeWidth:Pt,onDrawEnd:kn})}):j==="lexicon"?m.jsx("div",{className:"max-w-6xl mx-auto w-full animate-in fade-in slide-in-from-bottom-4 duration-700",children:m.jsxs("section",{className:"space-y-8",children:[m.jsxs("div",{className:"flex justify-between items-center px-4",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("h3",{className:"text-3xl font-black text-white tracking-tight italic",children:e("linguistics.lexicon")}),m.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:[o.words," Palabras Mapeadas"]})]}),m.jsx(Dn,{variant:"primary",size:"md",onClick:In,icon:"draw",children:"Nuevo Glifo"})]}),m.jsxs(ti,{className:"p-0 border-white/5 bg-surface-dark/40 overflow-hidden shadow-2xl rounded-[2.5rem]",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 flex items-center gap-4 bg-black/20",children:[m.jsxs("div",{className:"flex-1 relative",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-primary/60 text-lg",children:"search"}),m.jsx("input",{type:"text",placeholder:e("linguistics.search_lexicon"),value:F,onChange:Ge=>z(Ge.target.value),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 pl-12 pr-4 text-xs font-bold text-white focus:ring-1 focus:ring-primary/30 outline-none transition-all placeholder-slate-600"})]}),m.jsx("button",{className:"size-12 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-slate-500 hover:text-white transition-all hover:bg-white/10",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"tune"})})]}),m.jsxs("div",{className:"p-8 space-y-2 max-h-[70vh] overflow-y-auto no-scrollbar custom-scrollbar",children:[sn.map(Ge=>m.jsx(GK,{word:Ge.lema||Ge.palabraOriginal,type:Ge.categoriaGramatical,gender:Ge.genero,def:Ge.definicion||Ge.traduccionEspanol,onEdit:()=>As(Ge),onDelete:()=>Zi(Ge.id)},Ge.id)),sn.length===0&&m.jsxs("div",{className:"py-20 flex flex-col items-center justify-center text-slate-600 opacity-20",children:[m.jsx("span",{className:"material-symbols-outlined text-8xl mb-4",children:"menu_book"}),m.jsx("p",{className:"text-[10px] uppercase tracking-[0.5em] font-black",children:F?"No se encontraron resultados":"Flujo de Datos Vaco"})]})]})]})]})}):j==="translator"?m.jsx("div",{className:"max-w-6xl mx-auto w-full animate-in fade-in slide-in-from-bottom-4 duration-700",children:m.jsxs("section",{className:"space-y-8",children:[m.jsxs("div",{className:"flex items-center gap-4 px-4",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-4xl",children:"sync_alt"}),m.jsx("h3",{className:"text-3xl font-black text-white tracking-tight italic",children:e("linguistics.translator")})]}),m.jsx(ti,{className:"p-12 border-primary/20 bg-primary/5 rounded-[3rem] shadow-2xl shadow-primary/5",children:m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-primary opacity-60",children:"Entrada de Origen"}),m.jsx("textarea",{value:C,onChange:Ge=>_o(Ge.target.value),placeholder:e("linguistics.source_text"),className:"w-full h-48 bg-black/40 border border-white/10 rounded-[2.5rem] p-8 text-lg font-bold text-white focus:border-primary/50 outline-none transition-all placeholder-slate-800 resize-none"})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-primary opacity-60",children:"Salida Visual"}),m.jsx("div",{className:"h-48 rounded-[2.5rem] bg-black/60 border border-white/5 flex items-center justify-center relative overflow-hidden group shadow-inner",children:m.jsx("span",{className:"text-7xl font-serif text-white opacity-40 group-hover:opacity-100 transition-all duration-1000 whitespace-pre drop-shadow-[0_0_20px_rgba(255,255,255,0.4)]",children:T||"   "})})]})]})})]})}):m.jsxs("section",{className:"max-w-7xl mx-auto w-full animate-in fade-in slide-in-from-bottom-8 duration-1000 flex flex-col gap-12",children:[m.jsxs("div",{className:"flex justify-between items-center px-4",children:[m.jsx("div",{className:"flex flex-col"}),m.jsx("div",{className:"px-6 py-2 rounded bg-[#00E5FF]/10 border border-[#00E5FF]/20 text-[10px] font-black text-[#00E5FF] uppercase tracking-[0.3em] animate-pulse",children:"Bfer de Sincronizacin Listo"})]}),m.jsxs("div",{className:"space-y-12",children:[m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center justify-between px-2",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-2 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF]"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-[#00E5FF]/60",children:"Glifos Mapeados"})]}),m.jsxs("div",{className:"flex flex-col gap-3 items-end",children:[m.jsxs("span",{className:"text-[10px] font-bold text-[#00E5FF]/40",children:[ct.length," Smbolos Indexados"]}),m.jsxs("div",{className:"flex items-center gap-4 px-6 py-2.5 rounded-2xl bg-black/40 border border-[#00E5FF]/10 backdrop-blur-md",children:[m.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.2em] text-[#00E5FF]/60 font-mono",children:"Estado del Bfer"}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-[10px] font-bold text-white tracking-widest",children:"SINCRONIZADO"}),m.jsx("div",{className:"size-1.5 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF] animate-pulse"})]})]})]})]}),m.jsxs("div",{className:"p-10 rounded-[2.5rem] border border-[#00E5FF]/10 bg-[#00E5FF]/[0.02] grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-6",children:[ct.map((Ge,Ye)=>m.jsx(VK,{symbol:Ge.lema,svgPath:Ge.svgPathData,keyLabel:Ge.lema.length===1&&Ge.lema.match(/[a-z]/i)?Ge.lema.toUpperCase():"",active:!1,onClick:()=>Et(Ge)},Ge.id||Ye)),m.jsxs("button",{onClick:In,className:"aspect-square rounded-2xl border-2 border-dashed border-[#00E5FF]/10 flex flex-col items-center justify-center text-[#00E5FF]/20 hover:text-[#00E5FF] hover:border-[#00E5FF]/40 transition-all cursor-pointer group gap-2",title:"Dibujar Nuevo Glifo",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl group-hover:scale-110 transition-transform",children:"draw"}),m.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity",children:"Dibujar"})]}),m.jsxs("button",{onClick:Yi,className:"aspect-square rounded-2xl border-2 border-dashed border-[#00E5FF]/10 flex flex-col items-center justify-center text-[#00E5FF]/20 hover:text-[#00E5FF] hover:border-[#00E5FF]/40 transition-all cursor-pointer group gap-2",title:"Importar desde SVG",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl group-hover:scale-110 transition-transform",children:"upload_file"}),m.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity",children:"Importar"})]})]})]}),m.jsx("div",{className:"px-10",children:m.jsx("div",{className:"w-full h-[2px] bg-white/5 overflow-hidden rounded-full",children:m.jsx("div",{className:"h-full bg-[#00E5FF] shadow-[0_0_10px_#00E5FF] transition-all duration-1000",style:{width:`${Math.min(100,ct.length/26*100)}%`}})})}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4 px-2",children:[m.jsx("div",{className:"size-2 bg-primary rounded-full shadow-[0_0_10px_#7c3aed] opacity-60"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-primary/60",children:"Compositor de Palabras"})]}),m.jsxs(ti,{className:"p-10 border-white/5 bg-black/40 rounded-[2.5rem] space-y-8",children:[m.jsxs("div",{className:"flex gap-8 items-start",children:[m.jsxs("div",{className:"flex-1 space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Escritura Fontica"}),m.jsx("input",{type:"text",value:dt,onChange:Ge=>on(Ge.target.value),onBlur:()=>{dt&&Co()},onKeyDown:Ge=>{Ge.key==="Enter"&&Co()},placeholder:"Escribe para componer...",className:"w-full bg-white/5 border border-white/10 rounded-2xl py-6 px-8 text-2xl font-bold text-white outline-none focus:border-primary/40 transition-all placeholder:text-slate-800"})]}),m.jsxs("div",{className:"mt-10 px-6 py-4 rounded-xl bg-white/5 border border-white/10 flex items-center gap-3",children:[m.jsx("div",{className:"size-2 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_#10b981]"}),m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-slate-400",children:"Auto-Sincronizacin"})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Flujo de Renderizado Visual"}),m.jsx("div",{className:"min-h-32 p-8 rounded-2xl bg-black/60 border border-white/5 flex flex-wrap gap-4 items-center justify-center relative group",children:Xe.length>0?Xe.map((Ge,Ye)=>m.jsxs("div",{className:"flex flex-col items-center gap-1",children:[m.jsx("span",{className:`text-5xl font-serif ${Ge.placeholder?"text-slate-800 animate-pulse":"text-[#00E5FF] drop-shadow-[0_0_10px_rgba(0,229,255,0.4)]"}`,children:Ge.lema}),m.jsx("span",{className:"text-[8px] font-black text-slate-600 uppercase tracking-widest",children:Ge.lema})]},Ye)):m.jsx("span",{className:"text-slate-800 font-black uppercase tracking-[0.5em] text-[10px]",children:"Sin glifos detectados"})})]})]})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-2 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF] opacity-40"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-[#00E5FF]/60",children:"Previsualizacin de Transmisin"})]}),m.jsxs("div",{className:"h-64 rounded-[2.5rem] border border-[#00E5FF]/10 bg-black/40 flex flex-col p-12 items-center justify-center relative group shadow-inner",children:[m.jsx("div",{className:"absolute top-6 left-8 text-[8px] opacity-20 uppercase tracking-[0.3em] font-black",children:"Estado del Bfer: Activo"}),m.jsx("textarea",{className:"w-full bg-transparent border-none outline-none text-center text-7xl font-bold tracking-widest text-[#00E5FF]/10 group-hover:text-[#00E5FF]/40 transition-all placeholder:text-[#00E5FF]/5 resize-none italic font-serif",placeholder:"..."}),m.jsxs("div",{className:"absolute bottom-6 right-8 flex gap-6 text-[8px] font-black uppercase tracking-widest text-[#00E5FF]/20",children:[m.jsx("span",{children:"Motor_V4"}),m.jsx("span",{children:"ASCII/UTF-8"})]})]})]})]})]})}),X&&eo.createPortal(m.jsx("div",{className:"h-full flex flex-col bg-background relative overflow-hidden",children:Lt?m.jsx(BK,{tool:$e,setTool:wt,strokeWidth:Pt,setStrokeWidth:Ct,color:Vt,setColor:Yt,opacity:Lr,setOpacity:kr,lineCap:Qr,setLineCap:Jr,strokeStyle:_r,setStrokeStyle:hn,layers:bt,activeLayerId:ut,setActiveLayerId:Fe,onToggleLayerVisibility:Ge=>at(Ye=>Ye.map(nt=>nt.id===Ge?{...nt,visible:!nt.visible}:nt)),onToggleLayerLock:Ge=>at(Ye=>Ye.map(nt=>nt.id===Ge?{...nt,locked:!nt.locked}:nt)),onAddLayer:()=>{const Ge=crypto.randomUUID();at(Ye=>[{id:Ge,name:`Capa ${Ye.length+1}`,visible:!0,locked:!1,shapes:[]},...Ye]),Fe(Ge)},onDeleteLayer:Ge=>{bt.length!==1&&at(Ye=>{const nt=Ye.filter(pt=>pt.id!==Ge);return ut===Ge&&Fe(nt[0].id),nt})},activeShape:de&&!Array.isArray(de)?bt.flatMap(Ge=>Ge.shapes).find(Ge=>Ge.id===de):null,onUndo:xt,onRedo:ze,onClear:()=>{at(Ge=>Ge.map(Ye=>Ye.id===ut?{...Ye,shapes:[]}:Ye)),lt("Capa limpiada","info")}}):m.jsx(zK,{stats:o,langName:u,glyphs:ct,rules:g,onEditGlyph:Et,onCreateGlyph:In,onCreateRule:Ru,onViewAllGlyphs:()=>O("lexicon")})}),X),m.jsx(Zk,{isOpen:K,onClose:()=>Q(!1),onConfirm:ds,title:"Eliminar Palabra",message:"Ests seguro de que quieres eliminar esta palabra? Esta accin no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar"}),D&&m.jsx(HK,{word:G,onClose:()=>U(!1),onSave:ni,onEditSymbol:Ge=>{U(!1),Et(Ge)}})]})},GK=({word:t,type:e,gender:r,def:n,onEdit:i,onDelete:a})=>m.jsxs("div",{className:"p-4 rounded-2xl border border-transparent hover:bg-white/5 hover:border-white/5 transition-all group cursor-pointer relative",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[m.jsx("h4",{className:"text-xl font-manrope font-black text-white group-hover:text-primary transition-colors",children:t}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("span",{className:"text-[9px] font-bold text-slate-600 italic",children:e}),r&&m.jsxs("span",{className:"text-[9px] font-bold text-slate-700 uppercase",children:["(",r,")"]})]})]}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed font-manrope line-clamp-2 pr-16",children:n}),m.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 flex gap-1",children:[m.jsx("button",{onClick:s=>{s.stopPropagation(),i?.()},className:"opacity-0 group-hover:opacity-100 transition-opacity p-2 bg-white/5 hover:bg-white/10 rounded-xl text-primary hover:text-white",title:"Editar Significado",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"edit"})}),m.jsx("button",{onClick:s=>{s.stopPropagation(),a?.()},className:"opacity-0 group-hover:opacity-100 transition-opacity p-2 bg-white/5 hover:bg-red-400/20 rounded-xl text-slate-600 hover:text-red-400",title:"Eliminar Palabra",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"delete"})})]})]}),VK=({symbol:t,svgPath:e,keyLabel:r,active:n,onClick:i})=>m.jsxs("div",{onClick:i,className:`aspect-square rounded-2xl border transition-all cursor-pointer flex items-center justify-center relative group overflow-hidden ${n?"bg-[#00E5FF]/20 border-[#00E5FF] shadow-[0_0_20px_rgba(0,229,255,0.3)]":"bg-black/40 border-[#00E5FF]/10 hover:border-[#00E5FF]/40"}`,children:[e?m.jsx("svg",{viewBox:"0 0 1200 800",className:"w-[80%] h-[80%] opacity-80 group-hover:opacity-100 transition-opacity",children:m.jsx("path",{d:e,fill:"none",stroke:n?"#00E5FF":"white",strokeWidth:"15",strokeLinecap:"round",strokeLinejoin:"round",className:"group-hover:stroke-[#00E5FF] transition-colors"})}):m.jsx("span",{className:`text-4xl font-serif ${n||t?"text-[#00E5FF]":"opacity-20 group-hover:opacity-60 text-white"}`,children:t||"?"}),r&&m.jsx("span",{className:`absolute top-2 right-3 text-[8px] font-black uppercase ${n?"text-[#00E5FF]/80":"opacity-20"}`,children:r})]}),HK=({word:t,onClose:e,onSave:r,onEditSymbol:n})=>{const[i,a]=ie.useState({lema:t?.lema||"",definicion:t?.definicion||t?.traduccionEspanol||"",categoriaGramatical:t?.categoriaGramatical||"Noun",notas:t?.notas||"",isNew:t?.isNew});return m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:m.jsxs("div",{className:"w-full max-w-lg bg-[#0A0A0F] border border-white/10 rounded-[2.5rem] overflow-hidden shadow-2xl animate-in zoom-in-95 duration-500",children:[m.jsxs("div",{className:"p-8 border-b border-white/5 bg-white/[0.02] flex justify-between items-center",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("h2",{className:"text-xl font-black text-white italic tracking-tight",children:"Editar Significado"}),m.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:"Atributos del Lema"})]}),m.jsx("button",{onClick:e,className:"size-10 rounded-xl bg-white/5 flex items-center justify-center text-slate-500 hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-4",children:"Palabra / Lema"}),m.jsx("input",{type:"text",value:i.lema,onChange:s=>a(o=>({...o,lema:s.target.value})),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white text-sm font-bold focus:border-primary/40 outline-none transition-all"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-4",children:"Categora"}),m.jsxs("select",{value:i.categoriaGramatical,onChange:s=>a(o=>({...o,categoriaGramatical:s.target.value})),className:"w-full bg-[#1a1a20] border border-white/10 rounded-2xl py-4 px-6 text-white text-xs font-bold focus:border-primary/40 outline-none transition-all appearance-none",children:[m.jsx("option",{value:"Noun",className:"bg-[#1a1a20] text-white",children:"Sustantivo"}),m.jsx("option",{value:"Verb",className:"bg-[#1a1a20] text-white",children:"Verbo"}),m.jsx("option",{value:"Adj",className:"bg-[#1a1a20] text-white",children:"Adjetivo"}),m.jsx("option",{value:"Adv",className:"bg-[#1a1a20] text-white",children:"Adverbio"}),m.jsx("option",{value:"Conj",className:"bg-[#1a1a20] text-white",children:"Conjuncin"}),m.jsx("option",{value:"GLYPH",className:"bg-[#1a1a20] text-white",children:"Glifo / Smbolo"}),m.jsx("option",{value:"GLYFO",className:"bg-[#1a1a20] text-white",children:"Glifo / Smbolo (Alt)"}),m.jsx("option",{value:"GLIFO",className:"bg-[#1a1a20] text-white",children:"Glifo / Smbolo (ES)"})]})]}),m.jsx("div",{className:"flex items-end pb-1",children:m.jsxs("button",{onClick:()=>n(t),className:"w-full h-[52px] rounded-2xl border border-primary/20 bg-primary/5 hover:bg-primary/20 text-primary text-[10px] font-black uppercase tracking-widest transition-all flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"draw"}),"Editar Smbolo"]})})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-4",children:"Definicin / Significado"}),m.jsx("textarea",{value:i.definicion,onChange:s=>a(o=>({...o,definicion:s.target.value})),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white text-sm font-bold focus:border-primary/40 outline-none transition-all h-24 resize-none"})]})]}),m.jsxs("div",{className:"p-8 bg-white/[0.02] border-t border-white/5 flex gap-4",children:[m.jsx("button",{onClick:e,className:"flex-1 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-white transition-all",children:"Cancelar"}),m.jsx("button",{onClick:()=>r(i),className:"flex-1 py-4 rounded-2xl bg-primary text-white text-[10px] font-black uppercase tracking-widest shadow-lg shadow-primary/20 transition-all hover:scale-105",children:"Guardar Cambios"})]})]})})},WK=()=>{const[t,e]=ie.useState("hub"),[r,n]=ie.useState(null),i=a=>{n(a),console.log("Opening editor for",a)};return m.jsx("div",{className:"flex-1 flex flex-col h-full bg-[#050508] overflow-hidden",children:t==="hub"&&m.jsx(UK,{onOpenEditor:i})})};var q2={exports:{}},$2={};var s3;function qK(){if(s3)return $2;s3=1;var t=sm();function e(h,p){return h===p&&(h!==0||1/h===1/p)||h!==h&&p!==p}var r=typeof Object.is=="function"?Object.is:e,n=t.useState,i=t.useEffect,a=t.useLayoutEffect,s=t.useDebugValue;function o(h,p){var g=p(),y=n({inst:{value:g,getSnapshot:p}}),S=y[0].inst,w=y[1];return a(function(){S.value=g,S.getSnapshot=p,l(S)&&w({inst:S})},[h,g,p]),i(function(){return l(S)&&w({inst:S}),h(function(){l(S)&&w({inst:S})})},[h]),s(g),g}function l(h){var p=h.getSnapshot;h=h.value;try{var g=p();return!r(h,g)}catch{return!0}}function u(h,p){return p()}var c=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:o;return $2.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:c,$2}var o3;function yR(){return o3||(o3=1,q2.exports=qK()),q2.exports}var xR=yR();function Ia(t){this.content=t}Ia.prototype={constructor:Ia,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,r){var n=r&&r!=t?this.remove(r):this,i=n.find(t),a=n.content.slice();return i==-1?a.push(r||t,e):(a[i+1]=e,r&&(a[i]=r)),new Ia(a)},remove:function(t){var e=this.find(t);if(e==-1)return this;var r=this.content.slice();return r.splice(e,2),new Ia(r)},addToStart:function(t,e){return new Ia([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var r=this.remove(t).content.slice();return r.push(t,e),new Ia(r)},addBefore:function(t,e,r){var n=this.remove(e),i=n.content.slice(),a=n.find(t);return i.splice(a==-1?i.length:a,0,e,r),new Ia(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Ia.from(t),t.size?new Ia(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Ia.from(t),t.size?new Ia(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Ia.from(t);for(var r=0;r<t.content.length;r+=2)e=e.remove(t.content[r]);return e},toObject:function(){var t={};return this.forEach(function(e,r){t[e]=r}),t},get size(){return this.content.length>>1}};Ia.from=function(t){if(t instanceof Ia)return t;var e=[];if(t)for(var r in t)e.push(r,t[r]);return new Ia(e)};function bR(t,e,r){for(let n=0;;n++){if(n==t.childCount||n==e.childCount)return t.childCount==e.childCount?null:r;let i=t.child(n),a=e.child(n);if(i==a){r+=i.nodeSize;continue}if(!i.sameMarkup(a))return r;if(i.isText&&i.text!=a.text){for(let s=0;i.text[s]==a.text[s];s++)r++;return r}if(i.content.size||a.content.size){let s=bR(i.content,a.content,r+1);if(s!=null)return s}r+=i.nodeSize}}function wR(t,e,r,n){for(let i=t.childCount,a=e.childCount;;){if(i==0||a==0)return i==a?null:{a:r,b:n};let s=t.child(--i),o=e.child(--a),l=s.nodeSize;if(s==o){r-=l,n-=l;continue}if(!s.sameMarkup(o))return{a:r,b:n};if(s.isText&&s.text!=o.text){let u=0,c=Math.min(s.text.length,o.text.length);for(;u<c&&s.text[s.text.length-u-1]==o.text[o.text.length-u-1];)u++,r--,n--;return{a:r,b:n}}if(s.content.size||o.content.size){let u=wR(s.content,o.content,r-1,n-1);if(u)return u}r-=l,n-=l}}class ot{constructor(e,r){if(this.content=e,this.size=r||0,r==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,r,n,i=0,a){for(let s=0,o=0;o<r;s++){let l=this.content[s],u=o+l.nodeSize;if(u>e&&n(l,i+o,a||null,s)!==!1&&l.content.size){let c=o+1;l.nodesBetween(Math.max(0,e-c),Math.min(l.content.size,r-c),n,i+c)}o=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,r,n,i){let a="",s=!0;return this.nodesBetween(e,r,(o,l)=>{let u=o.isText?o.text.slice(Math.max(e,l)-l,r-l):o.isLeaf?i?typeof i=="function"?i(o):i:o.type.spec.leafText?o.type.spec.leafText(o):"":"";o.isBlock&&(o.isLeaf&&u||o.isTextblock)&&n&&(s?s=!1:a+=n),a+=u},0),a}append(e){if(!e.size)return this;if(!this.size)return e;let r=this.lastChild,n=e.firstChild,i=this.content.slice(),a=0;for(r.isText&&r.sameMarkup(n)&&(i[i.length-1]=r.withText(r.text+n.text),a=1);a<e.content.length;a++)i.push(e.content[a]);return new ot(i,this.size+e.size)}cut(e,r=this.size){if(e==0&&r==this.size)return this;let n=[],i=0;if(r>e)for(let a=0,s=0;s<r;a++){let o=this.content[a],l=s+o.nodeSize;l>e&&((s<e||l>r)&&(o.isText?o=o.cut(Math.max(0,e-s),Math.min(o.text.length,r-s)):o=o.cut(Math.max(0,e-s-1),Math.min(o.content.size,r-s-1))),n.push(o),i+=o.nodeSize),s=l}return new ot(n,i)}cutByIndex(e,r){return e==r?ot.empty:e==0&&r==this.content.length?this:new ot(this.content.slice(e,r))}replaceChild(e,r){let n=this.content[e];if(n==r)return this;let i=this.content.slice(),a=this.size+r.nodeSize-n.nodeSize;return i[e]=r,new ot(i,a)}addToStart(e){return new ot([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new ot(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let r=0;r<this.content.length;r++)if(!this.content[r].eq(e.content[r]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let r=this.content[e];if(!r)throw new RangeError("Index "+e+" out of range for "+this);return r}maybeChild(e){return this.content[e]||null}forEach(e){for(let r=0,n=0;r<this.content.length;r++){let i=this.content[r];e(i,n,r),n+=i.nodeSize}}findDiffStart(e,r=0){return bR(this,e,r)}findDiffEnd(e,r=this.size,n=e.size){return wR(this,e,r,n)}findIndex(e){if(e==0)return xy(0,e);if(e==this.size)return xy(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,n=0;;r++){let i=this.child(r),a=n+i.nodeSize;if(a>=e)return a==e?xy(r+1,a):xy(r,n);n=a}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,r){if(!r)return ot.empty;if(!Array.isArray(r))throw new RangeError("Invalid input for Fragment.fromJSON");return new ot(r.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return ot.empty;let r,n=0;for(let i=0;i<e.length;i++){let a=e[i];n+=a.nodeSize,i&&a.isText&&e[i-1].sameMarkup(a)?(r||(r=e.slice(0,i)),r[r.length-1]=a.withText(r[r.length-1].text+a.text)):r&&r.push(a)}return new ot(r||e,n)}static from(e){if(!e)return ot.empty;if(e instanceof ot)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ot([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}ot.empty=new ot([],0);const K2={index:0,offset:0};function xy(t,e){return K2.index=t,K2.offset=e,K2}function Cx(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let r=Array.isArray(t);if(Array.isArray(e)!=r)return!1;if(r){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!Cx(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!Cx(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}let wn=class uk{constructor(e,r){this.type=e,this.attrs=r}addToSet(e){let r,n=!1;for(let i=0;i<e.length;i++){let a=e[i];if(this.eq(a))return e;if(this.type.excludes(a.type))r||(r=e.slice(0,i));else{if(a.type.excludes(this.type))return e;!n&&a.type.rank>this.type.rank&&(r||(r=e.slice(0,i)),r.push(this),n=!0),r&&r.push(a)}}return r||(r=e.slice()),n||r.push(this),r}removeFromSet(e){for(let r=0;r<e.length;r++)if(this.eq(e[r]))return e.slice(0,r).concat(e.slice(r+1));return e}isInSet(e){for(let r=0;r<e.length;r++)if(this.eq(e[r]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Cx(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let r in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,r){if(!r)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[r.type];if(!n)throw new RangeError(`There is no mark type ${r.type} in this schema`);let i=n.create(r.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,r){if(e==r)return!0;if(e.length!=r.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(r[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return uk.none;if(e instanceof uk)return[e];let r=e.slice();return r.sort((n,i)=>n.type.rank-i.type.rank),r}};wn.none=[];class Ex extends Error{}class Ot{constructor(e,r,n){this.content=e,this.openStart=r,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,r){let n=kR(this.content,e+this.openStart,r);return n&&new Ot(n,this.openStart,this.openEnd)}removeBetween(e,r){return new Ot(SR(this.content,e+this.openStart,r+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,r){if(!r)return Ot.empty;let n=r.openStart||0,i=r.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Ot(ot.fromJSON(e,r.content),n,i)}static maxOpen(e,r=!0){let n=0,i=0;for(let a=e.firstChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.firstChild)n++;for(let a=e.lastChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.lastChild)i++;return new Ot(e,n,i)}}Ot.empty=new Ot(ot.empty,0,0);function SR(t,e,r){let{index:n,offset:i}=t.findIndex(e),a=t.maybeChild(n),{index:s,offset:o}=t.findIndex(r);if(i==e||a.isText){if(o!=r&&!t.child(s).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(r))}if(n!=s)throw new RangeError("Removing non-flat range");return t.replaceChild(n,a.copy(SR(a.content,e-i-1,r-i-1)))}function kR(t,e,r,n){let{index:i,offset:a}=t.findIndex(e),s=t.maybeChild(i);if(a==e||s.isText)return n&&!n.canReplace(i,i,r)?null:t.cut(0,e).append(r).append(t.cut(e));let o=kR(s.content,e-a-1,r,s);return o&&t.replaceChild(i,s.copy(o))}function $K(t,e,r){if(r.openStart>t.depth)throw new Ex("Inserted content deeper than insertion position");if(t.depth-r.openStart!=e.depth-r.openEnd)throw new Ex("Inconsistent open depths");return _R(t,e,r,0)}function _R(t,e,r,n){let i=t.index(n),a=t.node(n);if(i==e.index(n)&&n<t.depth-r.openStart){let s=_R(t,e,r,n+1);return a.copy(a.content.replaceChild(i,s))}else if(r.content.size)if(!r.openStart&&!r.openEnd&&t.depth==n&&e.depth==n){let s=t.parent,o=s.content;return lf(s,o.cut(0,t.parentOffset).append(r.content).append(o.cut(e.parentOffset)))}else{let{start:s,end:o}=KK(r,t);return lf(a,ER(t,s,o,e,n))}else return lf(a,Tx(t,e,n))}function CR(t,e){if(!e.type.compatibleContent(t.type))throw new Ex("Cannot join "+e.type.name+" onto "+t.type.name)}function ck(t,e,r){let n=t.node(r);return CR(n,e.node(r)),n}function of(t,e){let r=e.length-1;r>=0&&t.isText&&t.sameMarkup(e[r])?e[r]=t.withText(e[r].text+t.text):e.push(t)}function nv(t,e,r,n){let i=(e||t).node(r),a=0,s=e?e.index(r):i.childCount;t&&(a=t.index(r),t.depth>r?a++:t.textOffset&&(of(t.nodeAfter,n),a++));for(let o=a;o<s;o++)of(i.child(o),n);e&&e.depth==r&&e.textOffset&&of(e.nodeBefore,n)}function lf(t,e){return t.type.checkContent(e),t.copy(e)}function ER(t,e,r,n,i){let a=t.depth>i&&ck(t,e,i+1),s=n.depth>i&&ck(r,n,i+1),o=[];return nv(null,t,i,o),a&&s&&e.index(i)==r.index(i)?(CR(a,s),of(lf(a,ER(t,e,r,n,i+1)),o)):(a&&of(lf(a,Tx(t,e,i+1)),o),nv(e,r,i,o),s&&of(lf(s,Tx(r,n,i+1)),o)),nv(n,null,i,o),new ot(o)}function Tx(t,e,r){let n=[];if(nv(null,t,r,n),t.depth>r){let i=ck(t,e,r+1);of(lf(i,Tx(t,e,r+1)),n)}return nv(e,null,r,n),new ot(n)}function KK(t,e){let r=e.depth-t.openStart,i=e.node(r).copy(t.content);for(let a=r-1;a>=0;a--)i=e.node(a).copy(ot.from(i));return{start:i.resolveNoCache(t.openStart+r),end:i.resolveNoCache(i.content.size-t.openEnd-r)}}class Lv{constructor(e,r,n){this.pos=e,this.path=r,this.parentOffset=n,this.depth=r.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,r=this.index(this.depth);if(r==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(r);return n?e.child(r).cut(n):i}get nodeBefore(){let e=this.index(this.depth),r=this.pos-this.path[this.path.length-1];return r?this.parent.child(e).cut(0,r):e==0?null:this.parent.child(e-1)}posAtIndex(e,r){r=this.resolveDepth(r);let n=this.path[r*3],i=r==0?0:this.path[r*3-1]+1;for(let a=0;a<e;a++)i+=n.child(a).nodeSize;return i}marks(){let e=this.parent,r=this.index();if(e.content.size==0)return wn.none;if(this.textOffset)return e.child(r).marks;let n=e.maybeChild(r-1),i=e.maybeChild(r);if(!n){let o=n;n=i,i=o}let a=n.marks;for(var s=0;s<a.length;s++)a[s].type.spec.inclusive===!1&&(!i||!a[s].isInSet(i.marks))&&(a=a[s--].removeFromSet(a));return a}marksAcross(e){let r=this.parent.maybeChild(this.index());if(!r||!r.isInline)return null;let n=r.marks,i=e.parent.maybeChild(e.index());for(var a=0;a<n.length;a++)n[a].type.spec.inclusive===!1&&(!i||!n[a].isInSet(i.marks))&&(n=n[a--].removeFromSet(n));return n}sharedDepth(e){for(let r=this.depth;r>0;r--)if(this.start(r)<=e&&this.end(r)>=e)return r;return 0}blockRange(e=this,r){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!r||r(this.node(n))))return new Nx(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let r=1;r<=this.depth;r++)e+=(e?"/":"")+this.node(r).type.name+"_"+this.index(r-1);return e+":"+this.parentOffset}static resolve(e,r){if(!(r>=0&&r<=e.content.size))throw new RangeError("Position "+r+" out of range");let n=[],i=0,a=r;for(let s=e;;){let{index:o,offset:l}=s.content.findIndex(a),u=a-l;if(n.push(s,o,i+l),!u||(s=s.child(o),s.isText))break;a=u-1,i+=l+1}return new Lv(r,n,a)}static resolveCached(e,r){let n=l3.get(e);if(n)for(let a=0;a<n.elts.length;a++){let s=n.elts[a];if(s.pos==r)return s}else l3.set(e,n=new ZK);let i=n.elts[n.i]=Lv.resolve(e,r);return n.i=(n.i+1)%YK,i}}class ZK{constructor(){this.elts=[],this.i=0}}const YK=12,l3=new WeakMap;class Nx{constructor(e,r,n){this.$from=e,this.$to=r,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const XK=Object.create(null);class Qo{constructor(e,r,n,i=wn.none){this.type=e,this.attrs=r,this.marks=i,this.content=n||ot.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,r,n,i=0){this.content.nodesBetween(e,r,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,r,n,i){return this.content.textBetween(e,r,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,r,n){return this.type==e&&Cx(this.attrs,r||e.defaultAttrs||XK)&&wn.sameSet(this.marks,n||wn.none)}copy(e=null){return e==this.content?this:new Qo(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Qo(this.type,this.attrs,this.content,e)}cut(e,r=this.content.size){return e==0&&r==this.content.size?this:this.copy(this.content.cut(e,r))}slice(e,r=this.content.size,n=!1){if(e==r)return Ot.empty;let i=this.resolve(e),a=this.resolve(r),s=n?0:i.sharedDepth(r),o=i.start(s),u=i.node(s).content.cut(i.pos-o,a.pos-o);return new Ot(u,i.depth-s,a.depth-s)}replace(e,r,n){return $K(this.resolve(e),this.resolve(r),n)}nodeAt(e){for(let r=this;;){let{index:n,offset:i}=r.content.findIndex(e);if(r=r.maybeChild(n),!r)return null;if(i==e||r.isText)return r;e-=i+1}}childAfter(e){let{index:r,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(r),index:r,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:r,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(r),index:r,offset:n};let i=this.content.child(r-1);return{node:i,index:r-1,offset:n-i.nodeSize}}resolve(e){return Lv.resolveCached(this,e)}resolveNoCache(e){return Lv.resolve(this,e)}rangeHasMark(e,r,n){let i=!1;return r>e&&this.nodesBetween(e,r,a=>(n.isInSet(a.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),TR(this.marks,e)}contentMatchAt(e){let r=this.type.contentMatch.matchFragment(this.content,0,e);if(!r)throw new Error("Called contentMatchAt on a node with invalid content");return r}canReplace(e,r,n=ot.empty,i=0,a=n.childCount){let s=this.contentMatchAt(e).matchFragment(n,i,a),o=s&&s.matchFragment(this.content,r);if(!o||!o.validEnd)return!1;for(let l=i;l<a;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,r,n,i){if(i&&!this.type.allowsMarks(i))return!1;let a=this.contentMatchAt(e).matchType(n),s=a&&a.matchFragment(this.content,r);return s?s.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=wn.none;for(let r=0;r<this.marks.length;r++){let n=this.marks[r];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!wn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(r=>r.type.name)}`);this.content.forEach(r=>r.check())}toJSON(){let e={type:this.type.name};for(let r in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(r=>r.toJSON())),e}static fromJSON(e,r){if(!r)throw new RangeError("Invalid input for Node.fromJSON");let n;if(r.marks){if(!Array.isArray(r.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=r.marks.map(e.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(r.text,n)}let i=ot.fromJSON(e,r.content),a=e.nodeType(r.type).create(r.attrs,i,n);return a.type.checkAttrs(a.attrs),a}}Qo.prototype.text=void 0;class Px extends Qo{constructor(e,r,n,i){if(super(e,r,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):TR(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,r){return this.text.slice(e,r)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Px(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Px(this.type,this.attrs,e,this.marks)}cut(e=0,r=this.text.length){return e==0&&r==this.text.length?this:this.withText(this.text.slice(e,r))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function TR(t,e){for(let r=t.length-1;r>=0;r--)e=t[r].type.name+"("+e+")";return e}class wf{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,r){let n=new QK(e,r);if(n.next==null)return wf.empty;let i=NR(n);n.next&&n.err("Unexpected trailing text");let a=aZ(iZ(i));return sZ(a,n),a}matchType(e){for(let r=0;r<this.next.length;r++)if(this.next[r].type==e)return this.next[r].next;return null}matchFragment(e,r=0,n=e.childCount){let i=this;for(let a=r;i&&a<n;a++)i=i.matchType(e.child(a).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:r}=this.next[e];if(!(r.isText||r.hasRequiredAttrs()))return r}return null}compatible(e){for(let r=0;r<this.next.length;r++)for(let n=0;n<e.next.length;n++)if(this.next[r].type==e.next[n].type)return!0;return!1}fillBefore(e,r=!1,n=0){let i=[this];function a(s,o){let l=s.matchFragment(e,n);if(l&&(!r||l.validEnd))return ot.from(o.map(u=>u.createAndFill()));for(let u=0;u<s.next.length;u++){let{type:c,next:h}=s.next[u];if(!(c.isText||c.hasRequiredAttrs())&&i.indexOf(h)==-1){i.push(h);let p=a(h,o.concat(c));if(p)return p}}return null}return a(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let r=this.computeWrapping(e);return this.wrapCache.push(e,r),r}computeWrapping(e){let r=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),a=i.match;if(a.matchType(e)){let s=[];for(let o=i;o.type;o=o.via)s.push(o.type);return s.reverse()}for(let s=0;s<a.next.length;s++){let{type:o,next:l}=a.next[s];!o.isLeaf&&!o.hasRequiredAttrs()&&!(o.name in r)&&(!i.type||l.validEnd)&&(n.push({match:o.contentMatch,type:o,via:i}),r[o.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function r(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&r(n.next[i].next)}return r(this),e.map((n,i)=>{let a=i+(n.validEnd?"*":" ")+" ";for(let s=0;s<n.next.length;s++)a+=(s?", ":"")+n.next[s].type.name+"->"+e.indexOf(n.next[s].next);return a}).join(`
`)}}wf.empty=new wf(!0);class QK{constructor(e,r){this.string=e,this.nodeTypes=r,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function NR(t){let e=[];do e.push(JK(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function JK(t){let e=[];do e.push(eZ(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function eZ(t){let e=nZ(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=tZ(t,e);else break;return e}function u3(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function tZ(t,e){let r=u3(t),n=r;return t.eat(",")&&(t.next!="}"?n=u3(t):n=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:r,max:n,expr:e}}function rZ(t,e){let r=t.nodeTypes,n=r[e];if(n)return[n];let i=[];for(let a in r){let s=r[a];s.isInGroup(e)&&i.push(s)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function nZ(t){if(t.eat("(")){let e=NR(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=rZ(t,t.next).map(r=>(t.inline==null?t.inline=r.isInline:t.inline!=r.isInline&&t.err("Mixing inline and block content"),{type:"name",value:r}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function iZ(t){let e=[[]];return i(a(t,0),r()),e;function r(){return e.push([])-1}function n(s,o,l){let u={term:l,to:o};return e[s].push(u),u}function i(s,o){s.forEach(l=>l.to=o)}function a(s,o){if(s.type=="choice")return s.exprs.reduce((l,u)=>l.concat(a(u,o)),[]);if(s.type=="seq")for(let l=0;;l++){let u=a(s.exprs[l],o);if(l==s.exprs.length-1)return u;i(u,o=r())}else if(s.type=="star"){let l=r();return n(o,l),i(a(s.expr,l),l),[n(l)]}else if(s.type=="plus"){let l=r();return i(a(s.expr,o),l),i(a(s.expr,l),l),[n(l)]}else{if(s.type=="opt")return[n(o)].concat(a(s.expr,o));if(s.type=="range"){let l=o;for(let u=0;u<s.min;u++){let c=r();i(a(s.expr,l),c),l=c}if(s.max==-1)i(a(s.expr,l),l);else for(let u=s.min;u<s.max;u++){let c=r();n(l,c),i(a(s.expr,l),c),l=c}return[n(l)]}else{if(s.type=="name")return[n(o,void 0,s.value)];throw new Error("Unknown expr type")}}}}function PR(t,e){return e-t}function c3(t,e){let r=[];return n(e),r.sort(PR);function n(i){let a=t[i];if(a.length==1&&!a[0].term)return n(a[0].to);r.push(i);for(let s=0;s<a.length;s++){let{term:o,to:l}=a[s];!o&&r.indexOf(l)==-1&&n(l)}}}function aZ(t){let e=Object.create(null);return r(c3(t,0));function r(n){let i=[];n.forEach(s=>{t[s].forEach(({term:o,to:l})=>{if(!o)return;let u;for(let c=0;c<i.length;c++)i[c][0]==o&&(u=i[c][1]);c3(t,l).forEach(c=>{u||i.push([o,u=[]]),u.indexOf(c)==-1&&u.push(c)})})});let a=e[n.join(",")]=new wf(n.indexOf(t.length-1)>-1);for(let s=0;s<i.length;s++){let o=i[s][1].sort(PR);a.next.push({type:i[s][0],next:e[o.join(",")]||r(o)})}return a}}function sZ(t,e){for(let r=0,n=[t];r<n.length;r++){let i=n[r],a=!i.validEnd,s=[];for(let o=0;o<i.next.length;o++){let{type:l,next:u}=i.next[o];s.push(l.name),a&&!(l.isText||l.hasRequiredAttrs())&&(a=!1),n.indexOf(u)==-1&&n.push(u)}a&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function MR(t){let e=Object.create(null);for(let r in t){let n=t[r];if(!n.hasDefault)return null;e[r]=n.default}return e}function AR(t,e){let r=Object.create(null);for(let n in t){let i=e&&e[n];if(i===void 0){let a=t[n];if(a.hasDefault)i=a.default;else throw new RangeError("No value supplied for attribute "+n)}r[n]=i}return r}function LR(t,e,r,n){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${r} of type ${i}`);for(let i in t){let a=t[i];a.validate&&a.validate(e[i])}}function RR(t,e){let r=Object.create(null);if(e)for(let n in e)r[n]=new lZ(t,n,e[n]);return r}let d3=class OR{constructor(e,r,n){this.name=e,this.schema=r,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=RR(e,n.attrs),this.defaultAttrs=MR(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==wf.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:AR(this.attrs,e)}create(e=null,r,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Qo(this,this.computeAttrs(e),ot.from(r),wn.setFrom(n))}createChecked(e=null,r,n){return r=ot.from(r),this.checkContent(r),new Qo(this,this.computeAttrs(e),r,wn.setFrom(n))}createAndFill(e=null,r,n){if(e=this.computeAttrs(e),r=ot.from(r),r.size){let s=this.contentMatch.fillBefore(r);if(!s)return null;r=s.append(r)}let i=this.contentMatch.matchFragment(r),a=i&&i.fillBefore(ot.empty,!0);return a?new Qo(this,e,r.append(a),wn.setFrom(n)):null}validContent(e){let r=this.contentMatch.matchFragment(e);if(!r||!r.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){LR(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let r=0;r<e.length;r++)if(!this.allowsMarkType(e[r].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let r;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?r&&r.push(e[n]):r||(r=e.slice(0,n));return r?r.length?r:wn.none:e}static compile(e,r){let n=Object.create(null);e.forEach((a,s)=>n[a]=new OR(a,r,s));let i=r.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let a in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function oZ(t,e,r){let n=r.split("|");return i=>{let a=i===null?"null":typeof i;if(n.indexOf(a)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${t}, got ${a}`)}}class lZ{constructor(e,r,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?oZ(e,r,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class H1{constructor(e,r,n,i){this.name=e,this.rank=r,this.schema=n,this.spec=i,this.attrs=RR(e,i.attrs),this.excluded=null;let a=MR(this.attrs);this.instance=a?new wn(this,a):null}create(e=null){return!e&&this.instance?this.instance:new wn(this,AR(this.attrs,e))}static compile(e,r){let n=Object.create(null),i=0;return e.forEach((a,s)=>n[a]=new H1(a,i++,r,s)),n}removeFromSet(e){for(var r=0;r<e.length;r++)e[r].type==this&&(e=e.slice(0,r).concat(e.slice(r+1)),r--);return e}isInSet(e){for(let r=0;r<e.length;r++)if(e[r].type==this)return e[r]}checkAttrs(e){LR(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class DR{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let r=this.spec={};for(let i in e)r[i]=e[i];r.nodes=Ia.from(e.nodes),r.marks=Ia.from(e.marks||{}),this.nodes=d3.compile(this.spec.nodes,this),this.marks=H1.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let a=this.nodes[i],s=a.spec.content||"",o=a.spec.marks;if(a.contentMatch=n[s]||(n[s]=wf.parse(s,this.nodes)),a.inlineContent=a.contentMatch.inlineContent,a.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!a.isInline||!a.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=a}a.markSet=o=="_"?null:o?h3(this,o.split(" ")):o==""||!a.inlineContent?[]:null}for(let i in this.marks){let a=this.marks[i],s=a.spec.excludes;a.excluded=s==null?[a]:s==""?[]:h3(this,s.split(" "))}this.nodeFromJSON=i=>Qo.fromJSON(this,i),this.markFromJSON=i=>wn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,r=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof d3){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(r,n,i)}text(e,r){let n=this.nodes.text;return new Px(n,n.defaultAttrs,e,wn.setFrom(r))}mark(e,r){return typeof e=="string"&&(e=this.marks[e]),e.create(r)}nodeType(e){let r=this.nodes[e];if(!r)throw new RangeError("Unknown node type: "+e);return r}}function h3(t,e){let r=[];for(let n=0;n<e.length;n++){let i=e[n],a=t.marks[i],s=a;if(a)r.push(a);else for(let o in t.marks){let l=t.marks[o];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&r.push(s=l)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return r}function uZ(t){return t.tag!=null}function cZ(t){return t.style!=null}class Wd{constructor(e,r){this.schema=e,this.rules=r,this.tags=[],this.styles=[];let n=this.matchedStyles=[];r.forEach(i=>{if(uZ(i))this.tags.push(i);else if(cZ(i)){let a=/[^=]*/.exec(i.style)[0];n.indexOf(a)<0&&n.push(a),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let a=e.nodes[i.node];return a.contentMatch.matchType(a)})}parse(e,r={}){let n=new p3(this,r,!1);return n.addAll(e,wn.none,r.from,r.to),n.finish()}parseSlice(e,r={}){let n=new p3(this,r,!0);return n.addAll(e,wn.none,r.from,r.to),Ot.maxOpen(n.finish())}matchTag(e,r,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let a=this.tags[i];if(fZ(e,a.tag)&&(a.namespace===void 0||e.namespaceURI==a.namespace)&&(!a.context||r.matchesContext(a.context))){if(a.getAttrs){let s=a.getAttrs(e);if(s===!1)continue;a.attrs=s||void 0}return a}}}matchStyle(e,r,n,i){for(let a=i?this.styles.indexOf(i)+1:0;a<this.styles.length;a++){let s=this.styles[a],o=s.style;if(!(o.indexOf(e)!=0||s.context&&!n.matchesContext(s.context)||o.length>e.length&&(o.charCodeAt(e.length)!=61||o.slice(e.length+1)!=r))){if(s.getAttrs){let l=s.getAttrs(r);if(l===!1)continue;s.attrs=l||void 0}return s}}}static schemaRules(e){let r=[];function n(i){let a=i.priority==null?50:i.priority,s=0;for(;s<r.length;s++){let o=r[s];if((o.priority==null?50:o.priority)<a)break}r.splice(s,0,i)}for(let i in e.marks){let a=e.marks[i].spec.parseDOM;a&&a.forEach(s=>{n(s=m3(s)),s.mark||s.ignore||s.clearMark||(s.mark=i)})}for(let i in e.nodes){let a=e.nodes[i].spec.parseDOM;a&&a.forEach(s=>{n(s=m3(s)),s.node||s.ignore||s.mark||(s.node=i)})}return r}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Wd(e,Wd.schemaRules(e)))}}const IR={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},dZ={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},jR={ol:!0,ul:!0},Rv=1,dk=2,iv=4;function f3(t,e,r){return e!=null?(e?Rv:0)|(e==="full"?dk:0):t&&t.whitespace=="pre"?Rv|dk:r&~iv}class by{constructor(e,r,n,i,a,s){this.type=e,this.attrs=r,this.marks=n,this.solid=i,this.options=s,this.content=[],this.activeMarks=wn.none,this.match=a||(s&iv?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let r=this.type.contentMatch.fillBefore(ot.from(e));if(r)this.match=this.type.contentMatch.matchFragment(r);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Rv)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let a=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=a.withText(a.text.slice(0,a.text.length-i[0].length))}}let r=ot.from(this.content);return!e&&this.match&&(r=r.append(this.match.fillBefore(ot.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!IR.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class p3{constructor(e,r,n){this.parser=e,this.options=r,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=r.topNode,a,s=f3(null,r.preserveWhitespace,0)|(n?iv:0);i?a=new by(i.type,i.attrs,wn.none,!0,r.topMatch||i.type.contentMatch,s):n?a=new by(null,null,wn.none,!0,null,s):a=new by(e.schema.topNodeType,null,wn.none,!0,null,s),this.nodes=[a],this.find=r.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,r){e.nodeType==3?this.addTextNode(e,r):e.nodeType==1&&this.addElement(e,r)}addTextNode(e,r){let n=e.nodeValue,i=this.top,a=i.options&dk?"full":this.localPreserveWS||(i.options&Rv)>0,{schema:s}=this.parser;if(a==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(a)if(a==="full")n=n.replace(/\r\n?/g,`
`);else if(s.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(s.linebreakReplacement.create())){let o=n.split(/\r?\n|\r/);for(let l=0;l<o.length;l++)l&&this.insertNode(s.linebreakReplacement.create(),r,!0),o[l]&&this.insertNode(s.text(o[l]),r,!/\S/.test(o[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let o=i.content[i.content.length-1],l=e.previousSibling;(!o||l&&l.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(n=n.slice(1))}n&&this.insertNode(s.text(n),r,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,r,n){let i=this.localPreserveWS,a=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let s=e.nodeName.toLowerCase(),o;jR.hasOwnProperty(s)&&this.parser.normalizeLists&&hZ(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(o=this.parser.matchTag(e,this,n));e:if(l?l.ignore:dZ.hasOwnProperty(s))this.findInside(e),this.ignoreFallback(e,r);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let u,c=this.needsBlock;if(IR.hasOwnProperty(s))a.content.length&&a.content[0].isInline&&this.open&&(this.open--,a=this.top),u=!0,a.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,r);break e}let h=l&&l.skip?r:this.readStyles(e,r);h&&this.addAll(e,h),u&&this.sync(a),this.needsBlock=c}else{let u=this.readStyles(e,r);u&&this.addElementByRule(e,l,u,l.consuming===!1?o:void 0)}this.localPreserveWS=i}leafFallback(e,r){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),r)}ignoreFallback(e,r){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),r,!0)}readStyles(e,r){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let a=this.parser.matchedStyles[i],s=n.getPropertyValue(a);if(s)for(let o=void 0;;){let l=this.parser.matchStyle(a,s,this,o);if(!l)break;if(l.ignore)return null;if(l.clearMark?r=r.filter(u=>!l.clearMark(u)):r=r.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)o=l;else break}}return r}addElementByRule(e,r,n,i){let a,s;if(r.node)if(s=this.parser.schema.nodes[r.node],s.isLeaf)this.insertNode(s.create(r.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(s,r.attrs||null,n,r.preserveWhitespace);l&&(a=!0,n=l)}else{let l=this.parser.schema.marks[r.mark];n=n.concat(l.create(r.attrs))}let o=this.top;if(s&&s.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(r.getContent)this.findInside(e),r.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof r.contentElement=="string"?l=e.querySelector(r.contentElement):typeof r.contentElement=="function"?l=r.contentElement(e):r.contentElement&&(l=r.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}a&&this.sync(o)&&this.open--}addAll(e,r,n,i){let a=n||0;for(let s=n?e.childNodes[n]:e.firstChild,o=i==null?null:e.childNodes[i];s!=o;s=s.nextSibling,++a)this.findAtPoint(e,a),this.addDOM(s,r);this.findAtPoint(e,a)}findPlace(e,r,n){let i,a;for(let s=this.open,o=0;s>=0;s--){let l=this.nodes[s],u=l.findWrapping(e);if(u&&(!i||i.length>u.length+o)&&(i=u,a=l,!u.length))break;if(l.solid){if(n)break;o+=2}}if(!i)return null;this.sync(a);for(let s=0;s<i.length;s++)r=this.enterInner(i[s],null,r,!1);return r}insertNode(e,r,n){if(e.isInline&&this.needsBlock&&!this.top.type){let a=this.textblockFromContext();a&&(r=this.enterInner(a,null,r))}let i=this.findPlace(e,r,n);if(i){this.closeExtra();let a=this.top;a.match&&(a.match=a.match.matchType(e.type));let s=wn.none;for(let o of i.concat(e.marks))(a.type?a.type.allowsMarkType(o.type):g3(o.type,e.type))&&(s=o.addToSet(s));return a.content.push(e.mark(s)),!0}return!1}enter(e,r,n,i){let a=this.findPlace(e.create(r),n,!1);return a&&(a=this.enterInner(e,r,n,!0,i)),a}enterInner(e,r,n,i=!1,a){this.closeExtra();let s=this.top;s.match=s.match&&s.match.matchType(e);let o=f3(e,a,s.options);s.options&iv&&s.content.length==0&&(o|=iv);let l=wn.none;return n=n.filter(u=>(s.type?s.type.allowsMarkType(u.type):g3(u.type,e))?(l=u.addToSet(l),!1):!0),this.nodes.push(new by(e,r,l,i,null,o)),this.open++,n}closeExtra(e=!1){let r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--)this.nodes[r-1].content.push(this.nodes[r].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let r=this.open;r>=0;r--){if(this.nodes[r]==e)return this.open=r,!0;this.localPreserveWS&&(this.nodes[r].options|=Rv)}return!1}get currentPos(){this.closeExtra();let e=0;for(let r=this.open;r>=0;r--){let n=this.nodes[r].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;r&&e++}return e}findAtPoint(e,r){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==r&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&(this.find[r].pos=this.currentPos)}findAround(e,r,n){if(e!=r&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&r.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&(this.find[r].pos=this.currentPos-(e.nodeValue.length-this.find[r].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let r=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),a=-(n?n.depth+1:0)+(i?0:1),s=(o,l)=>{for(;o>=0;o--){let u=r[o];if(u==""){if(o==r.length-1||o==0)continue;for(;l>=a;l--)if(s(o-1,l))return!0;return!1}else{let c=l>0||l==0&&i?this.nodes[l].type:n&&l>=a?n.node(l-a).type:null;if(!c||c.name!=u&&!c.isInGroup(u))return!1;l--}}return!0};return s(r.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let r=e.depth;r>=0;r--){let n=e.node(r).contentMatchAt(e.indexAfter(r)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let r in this.parser.schema.nodes){let n=this.parser.schema.nodes[r];if(n.isTextblock&&n.defaultAttrs)return n}}}function hZ(t){for(let e=t.firstChild,r=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&jR.hasOwnProperty(n)&&r?(r.appendChild(e),e=r):n=="li"?r=e:n&&(r=null)}}function fZ(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function m3(t){let e={};for(let r in t)e[r]=t[r];return e}function g3(t,e){let r=e.schema.nodes;for(let n in r){let i=r[n];if(!i.allowsMarkType(t))continue;let a=[],s=o=>{a.push(o);for(let l=0;l<o.edgeCount;l++){let{type:u,next:c}=o.edge(l);if(u==e||a.indexOf(c)<0&&s(c))return!0}};if(s(i.contentMatch))return!0}}class Af{constructor(e,r){this.nodes=e,this.marks=r}serializeFragment(e,r={},n){n||(n=Z2(r).createDocumentFragment());let i=n,a=[];return e.forEach(s=>{if(a.length||s.marks.length){let o=0,l=0;for(;o<a.length&&l<s.marks.length;){let u=s.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(a[o][0])||u.type.spec.spanning===!1)break;o++,l++}for(;o<a.length;)i=a.pop()[1];for(;l<s.marks.length;){let u=s.marks[l++],c=this.serializeMark(u,s.isInline,r);c&&(a.push([u,i]),i.appendChild(c.dom),i=c.contentDOM||c.dom)}}i.appendChild(this.serializeNodeInner(s,r))}),n}serializeNodeInner(e,r){let{dom:n,contentDOM:i}=Ky(Z2(r),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,r,i)}return n}serializeNode(e,r={}){let n=this.serializeNodeInner(e,r);for(let i=e.marks.length-1;i>=0;i--){let a=this.serializeMark(e.marks[i],e.isInline,r);a&&((a.contentDOM||a.dom).appendChild(n),n=a.dom)}return n}serializeMark(e,r,n={}){let i=this.marks[e.type.name];return i&&Ky(Z2(n),i(e,r),null,e.attrs)}static renderSpec(e,r,n=null,i){return Ky(e,r,n,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Af(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let r=v3(e.nodes);return r.text||(r.text=n=>n.text),r}static marksFromSchema(e){return v3(e.marks)}}function v3(t){let e={};for(let r in t){let n=t[r].spec.toDOM;n&&(e[r]=n)}return e}function Z2(t){return t.document||window.document}const y3=new WeakMap;function pZ(t){let e=y3.get(t);return e===void 0&&y3.set(t,e=mZ(t)),e}function mZ(t){let e=null;function r(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")e||(e=[]),e.push(n);else for(let i=0;i<n.length;i++)r(n[i]);else for(let i in n)r(n[i])}return r(t),e}function Ky(t,e,r,n){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],a;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(a=pZ(n))&&a.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s=i.indexOf(" ");s>0&&(r=i.slice(0,s),i=i.slice(s+1));let o,l=r?t.createElementNS(r,i):t.createElement(i),u=e[1],c=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){c=2;for(let h in u)if(u[h]!=null){let p=h.indexOf(" ");p>0?l.setAttributeNS(h.slice(0,p),h.slice(p+1),u[h]):h=="style"&&l.style?l.style.cssText=u[h]:l.setAttribute(h,u[h])}}for(let h=c;h<e.length;h++){let p=e[h];if(p===0){if(h<e.length-1||h>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:g,contentDOM:y}=Ky(t,p,r,n);if(l.appendChild(g),y){if(o)throw new RangeError("Multiple content holes");o=y}}}return{dom:l,contentDOM:o}}const FR=65535,BR=Math.pow(2,16);function gZ(t,e){return t+e*BR}function x3(t){return t&FR}function vZ(t){return(t-(t&FR))/BR}const zR=1,UR=2,Zy=4,GR=8;class hk{constructor(e,r,n){this.pos=e,this.delInfo=r,this.recover=n}get deleted(){return(this.delInfo&GR)>0}get deletedBefore(){return(this.delInfo&(zR|Zy))>0}get deletedAfter(){return(this.delInfo&(UR|Zy))>0}get deletedAcross(){return(this.delInfo&Zy)>0}}class go{constructor(e,r=!1){if(this.ranges=e,this.inverted=r,!e.length&&go.empty)return go.empty}recover(e){let r=0,n=x3(e);if(!this.inverted)for(let i=0;i<n;i++)r+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+r+vZ(e)}mapResult(e,r=1){return this._map(e,r,!1)}map(e,r=1){return this._map(e,r,!0)}_map(e,r,n){let i=0,a=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let l=this.ranges[o]-(this.inverted?i:0);if(l>e)break;let u=this.ranges[o+a],c=this.ranges[o+s],h=l+u;if(e<=h){let p=u?e==l?-1:e==h?1:r:r,g=l+i+(p<0?0:c);if(n)return g;let y=e==(r<0?l:h)?null:gZ(o/3,e-l),S=e==l?UR:e==h?zR:Zy;return(r<0?e!=l:e!=h)&&(S|=GR),new hk(g,S,y)}i+=c-u}return n?e+i:new hk(e+i,0,null)}touches(e,r){let n=0,i=x3(r),a=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let l=this.ranges[o]-(this.inverted?n:0);if(l>e)break;let u=this.ranges[o+a],c=l+u;if(e<=c&&o==i*3)return!0;n+=this.ranges[o+s]-u}return!1}forEach(e){let r=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,a=0;i<this.ranges.length;i+=3){let s=this.ranges[i],o=s-(this.inverted?a:0),l=s+(this.inverted?0:a),u=this.ranges[i+r],c=this.ranges[i+n];e(o,o+u,l,l+c),a+=c-u}}invert(){return new go(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?go.empty:new go(e<0?[0,-e,0]:[0,0,e])}}go.empty=new go([]);class Ov{constructor(e,r,n=0,i=e?e.length:0){this.mirror=r,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||r)}get maps(){return this._maps}slice(e=0,r=this.maps.length){return new Ov(this._maps,this.mirror,e,r)}appendMap(e,r){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),r!=null&&this.setMirror(this._maps.length-1,r)}appendMapping(e){for(let r=0,n=this._maps.length;r<e._maps.length;r++){let i=e.getMirror(r);this.appendMap(e._maps[r],i!=null&&i<r?n+i:void 0)}}getMirror(e){if(this.mirror){for(let r=0;r<this.mirror.length;r++)if(this.mirror[r]==e)return this.mirror[r+(r%2?-1:1)]}}setMirror(e,r){this.mirror||(this.mirror=[]),this.mirror.push(e,r)}appendMappingInverted(e){for(let r=e.maps.length-1,n=this._maps.length+e._maps.length;r>=0;r--){let i=e.getMirror(r);this.appendMap(e._maps[r].invert(),i!=null&&i>r?n-i-1:void 0)}}invert(){let e=new Ov;return e.appendMappingInverted(this),e}map(e,r=1){if(this.mirror)return this._map(e,r,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,r);return e}mapResult(e,r=1){return this._map(e,r,!1)}_map(e,r,n){let i=0;for(let a=this.from;a<this.to;a++){let s=this._maps[a],o=s.mapResult(e,r);if(o.recover!=null){let l=this.getMirror(a);if(l!=null&&l>a&&l<this.to){a=l,e=this._maps[l].recover(o.recover);continue}}i|=o.delInfo,e=o.pos}return n?e:new hk(e,i,null)}}const Y2=Object.create(null);class cs{getMap(){return go.empty}merge(e){return null}static fromJSON(e,r){if(!r||!r.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=Y2[r.stepType];if(!n)throw new RangeError(`No step type ${r.stepType} defined`);return n.fromJSON(e,r)}static jsonID(e,r){if(e in Y2)throw new RangeError("Duplicate use of step JSON ID "+e);return Y2[e]=r,r.prototype.jsonID=e,r}}class Ii{constructor(e,r){this.doc=e,this.failed=r}static ok(e){return new Ii(e,null)}static fail(e){return new Ii(null,e)}static fromReplace(e,r,n,i){try{return Ii.ok(e.replace(r,n,i))}catch(a){if(a instanceof Ex)return Ii.fail(a.message);throw a}}}function I_(t,e,r){let n=[];for(let i=0;i<t.childCount;i++){let a=t.child(i);a.content.size&&(a=a.copy(I_(a.content,e,a))),a.isInline&&(a=e(a,r,i)),n.push(a)}return ot.fromArray(n)}class jd extends cs{constructor(e,r,n){super(),this.from=e,this.to=r,this.mark=n}apply(e){let r=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),a=new Ot(I_(r.content,(s,o)=>!s.isAtom||!o.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),i),r.openStart,r.openEnd);return Ii.fromReplace(e,this.from,this.to,a)}invert(){return new Ol(this.from,this.to,this.mark)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deleted&&n.deleted||r.pos>=n.pos?null:new jd(r.pos,n.pos,this.mark)}merge(e){return e instanceof jd&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new jd(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new jd(r.from,r.to,e.markFromJSON(r.mark))}}cs.jsonID("addMark",jd);class Ol extends cs{constructor(e,r,n){super(),this.from=e,this.to=r,this.mark=n}apply(e){let r=e.slice(this.from,this.to),n=new Ot(I_(r.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),r.openStart,r.openEnd);return Ii.fromReplace(e,this.from,this.to,n)}invert(){return new jd(this.from,this.to,this.mark)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deleted&&n.deleted||r.pos>=n.pos?null:new Ol(r.pos,n.pos,this.mark)}merge(e){return e instanceof Ol&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ol(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ol(r.from,r.to,e.markFromJSON(r.mark))}}cs.jsonID("removeMark",Ol);class Fd extends cs{constructor(e,r){super(),this.pos=e,this.mark=r}apply(e){let r=e.nodeAt(this.pos);if(!r)return Ii.fail("No node at mark step's position");let n=r.type.create(r.attrs,null,this.mark.addToSet(r.marks));return Ii.fromReplace(e,this.pos,this.pos+1,new Ot(ot.from(n),0,r.isLeaf?0:1))}invert(e){let r=e.nodeAt(this.pos);if(r){let n=this.mark.addToSet(r.marks);if(n.length==r.marks.length){for(let i=0;i<r.marks.length;i++)if(!r.marks[i].isInSet(n))return new Fd(this.pos,r.marks[i]);return new Fd(this.pos,this.mark)}}return new Sf(this.pos,this.mark)}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Fd(r.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Fd(r.pos,e.markFromJSON(r.mark))}}cs.jsonID("addNodeMark",Fd);class Sf extends cs{constructor(e,r){super(),this.pos=e,this.mark=r}apply(e){let r=e.nodeAt(this.pos);if(!r)return Ii.fail("No node at mark step's position");let n=r.type.create(r.attrs,null,this.mark.removeFromSet(r.marks));return Ii.fromReplace(e,this.pos,this.pos+1,new Ot(ot.from(n),0,r.isLeaf?0:1))}invert(e){let r=e.nodeAt(this.pos);return!r||!this.mark.isInSet(r.marks)?this:new Fd(this.pos,this.mark)}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Sf(r.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Sf(r.pos,e.markFromJSON(r.mark))}}cs.jsonID("removeNodeMark",Sf);class ha extends cs{constructor(e,r,n,i=!1){super(),this.from=e,this.to=r,this.slice=n,this.structure=i}apply(e){return this.structure&&fk(e,this.from,this.to)?Ii.fail("Structure replace would overwrite content"):Ii.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new go([this.from,this.to-this.from,this.slice.size])}invert(e){return new ha(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deletedAcross&&n.deletedAcross?null:new ha(r.pos,Math.max(r.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof ha)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let r=this.slice.size+e.slice.size==0?Ot.empty:new Ot(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new ha(this.from,this.to+(e.to-e.from),r,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let r=this.slice.size+e.slice.size==0?Ot.empty:new Ot(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new ha(e.from,this.to,r,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ha(r.from,r.to,Ot.fromJSON(e,r.slice),!!r.structure)}}cs.jsonID("replace",ha);class ga extends cs{constructor(e,r,n,i,a,s,o=!1){super(),this.from=e,this.to=r,this.gapFrom=n,this.gapTo=i,this.slice=a,this.insert=s,this.structure=o}apply(e){if(this.structure&&(fk(e,this.from,this.gapFrom)||fk(e,this.gapTo,this.to)))return Ii.fail("Structure gap-replace would overwrite content");let r=e.slice(this.gapFrom,this.gapTo);if(r.openStart||r.openEnd)return Ii.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,r.content);return n?Ii.fromReplace(e,this.from,this.to,n):Ii.fail("Content does not fit in gap")}getMap(){return new go([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let r=this.gapTo-this.gapFrom;return new ga(this.from,this.from+this.slice.size+r,this.from+this.insert,this.from+this.insert+r,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?r.pos:e.map(this.gapFrom,-1),a=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return r.deletedAcross&&n.deletedAcross||i<r.pos||a>n.pos?null:new ga(r.pos,n.pos,i,a,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number"||typeof r.gapFrom!="number"||typeof r.gapTo!="number"||typeof r.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ga(r.from,r.to,r.gapFrom,r.gapTo,Ot.fromJSON(e,r.slice),r.insert,!!r.structure)}}cs.jsonID("replaceAround",ga);function fk(t,e,r){let n=t.resolve(e),i=r-e,a=n.depth;for(;i>0&&a>0&&n.indexAfter(a)==n.node(a).childCount;)a--,i--;if(i>0){let s=n.node(a).maybeChild(n.indexAfter(a));for(;i>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,i--}}return!1}function yZ(t,e,r,n){let i=[],a=[],s,o;t.doc.nodesBetween(e,r,(l,u,c)=>{if(!l.isInline)return;let h=l.marks;if(!n.isInSet(h)&&c.type.allowsMarkType(n.type)){let p=Math.max(u,e),g=Math.min(u+l.nodeSize,r),y=n.addToSet(h);for(let S=0;S<h.length;S++)h[S].isInSet(y)||(s&&s.to==p&&s.mark.eq(h[S])?s.to=g:i.push(s=new Ol(p,g,h[S])));o&&o.to==p?o.to=g:a.push(o=new jd(p,g,n))}}),i.forEach(l=>t.step(l)),a.forEach(l=>t.step(l))}function xZ(t,e,r,n){let i=[],a=0;t.doc.nodesBetween(e,r,(s,o)=>{if(!s.isInline)return;a++;let l=null;if(n instanceof H1){let u=s.marks,c;for(;c=n.isInSet(u);)(l||(l=[])).push(c),u=c.removeFromSet(u)}else n?n.isInSet(s.marks)&&(l=[n]):l=s.marks;if(l&&l.length){let u=Math.min(o+s.nodeSize,r);for(let c=0;c<l.length;c++){let h=l[c],p;for(let g=0;g<i.length;g++){let y=i[g];y.step==a-1&&h.eq(i[g].style)&&(p=y)}p?(p.to=u,p.step=a):i.push({style:h,from:Math.max(o,e),to:u,step:a})}}}),i.forEach(s=>t.step(new Ol(s.from,s.to,s.style)))}function j_(t,e,r,n=r.contentMatch,i=!0){let a=t.doc.nodeAt(e),s=[],o=e+1;for(let l=0;l<a.childCount;l++){let u=a.child(l),c=o+u.nodeSize,h=n.matchType(u.type);if(!h)s.push(new ha(o,c,Ot.empty));else{n=h;for(let p=0;p<u.marks.length;p++)r.allowsMarkType(u.marks[p].type)||t.step(new Ol(o,c,u.marks[p]));if(i&&u.isText&&r.whitespace!="pre"){let p,g=/\r?\n|\r/g,y;for(;p=g.exec(u.text);)y||(y=new Ot(ot.from(r.schema.text(" ",r.allowedMarks(u.marks))),0,0)),s.push(new ha(o+p.index,o+p.index+p[0].length,y))}}o=c}if(!n.validEnd){let l=n.fillBefore(ot.empty,!0);t.replace(o,o,new Ot(l,0,0))}for(let l=s.length-1;l>=0;l--)t.step(s[l])}function bZ(t,e,r){return(e==0||t.canReplace(e,t.childCount))&&(r==t.childCount||t.canReplace(0,r))}function vm(t){let r=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let n=t.depth,i=0,a=0;;--n){let s=t.$from.node(n),o=t.$from.index(n)+i,l=t.$to.indexAfter(n)-a;if(n<t.depth&&s.canReplace(o,l,r))return n;if(n==0||s.type.spec.isolating||!bZ(s,o,l))break;o&&(i=1),l<s.childCount&&(a=1)}return null}function wZ(t,e,r){let{$from:n,$to:i,depth:a}=e,s=n.before(a+1),o=i.after(a+1),l=s,u=o,c=ot.empty,h=0;for(let y=a,S=!1;y>r;y--)S||n.index(y)>0?(S=!0,c=ot.from(n.node(y).copy(c)),h++):l--;let p=ot.empty,g=0;for(let y=a,S=!1;y>r;y--)S||i.after(y+1)<i.end(y)?(S=!0,p=ot.from(i.node(y).copy(p)),g++):u++;t.step(new ga(l,u,s,o,new Ot(c.append(p),h,g),c.size-h,!0))}function F_(t,e,r=null,n=t){let i=SZ(t,e),a=i&&kZ(n,e);return a?i.map(b3).concat({type:e,attrs:r}).concat(a.map(b3)):null}function b3(t){return{type:t,attrs:null}}function SZ(t,e){let{parent:r,startIndex:n,endIndex:i}=t,a=r.contentMatchAt(n).findWrapping(e);if(!a)return null;let s=a.length?a[0]:e;return r.canReplaceWith(n,i,s)?a:null}function kZ(t,e){let{parent:r,startIndex:n,endIndex:i}=t,a=r.child(n),s=e.contentMatch.findWrapping(a.type);if(!s)return null;let l=(s.length?s[s.length-1]:e).contentMatch;for(let u=n;l&&u<i;u++)l=l.matchType(r.child(u).type);return!l||!l.validEnd?null:s}function _Z(t,e,r){let n=ot.empty;for(let s=r.length-1;s>=0;s--){if(n.size){let o=r[s].type.contentMatch.matchFragment(n);if(!o||!o.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=ot.from(r[s].type.create(r[s].attrs,n))}let i=e.start,a=e.end;t.step(new ga(i,a,i,a,new Ot(n,0,0),r.length,!0))}function CZ(t,e,r,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let a=t.steps.length;t.doc.nodesBetween(e,r,(s,o)=>{let l=typeof i=="function"?i(s):i;if(s.isTextblock&&!s.hasMarkup(n,l)&&EZ(t.doc,t.mapping.slice(a).map(o),n)){let u=null;if(n.schema.linebreakReplacement){let g=n.whitespace=="pre",y=!!n.contentMatch.matchType(n.schema.linebreakReplacement);g&&!y?u=!1:!g&&y&&(u=!0)}u===!1&&HR(t,s,o,a),j_(t,t.mapping.slice(a).map(o,1),n,void 0,u===null);let c=t.mapping.slice(a),h=c.map(o,1),p=c.map(o+s.nodeSize,1);return t.step(new ga(h,p,h+1,p-1,new Ot(ot.from(n.create(l,null,s.marks)),0,0),1,!0)),u===!0&&VR(t,s,o,a),!1}})}function VR(t,e,r,n){e.forEach((i,a)=>{if(i.isText){let s,o=/\r?\n|\r/g;for(;s=o.exec(i.text);){let l=t.mapping.slice(n).map(r+1+a+s.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function HR(t,e,r,n){e.forEach((i,a)=>{if(i.type==i.type.schema.linebreakReplacement){let s=t.mapping.slice(n).map(r+1+a);t.replaceWith(s,s+1,e.type.schema.text(`
`))}})}function EZ(t,e,r){let n=t.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,r)}function TZ(t,e,r,n,i){let a=t.doc.nodeAt(e);if(!a)throw new RangeError("No node at given position");r||(r=a.type);let s=r.create(n,null,i||a.marks);if(a.isLeaf)return t.replaceWith(e,e+a.nodeSize,s);if(!r.validContent(a.content))throw new RangeError("Invalid content for node type "+r.name);t.step(new ga(e,e+a.nodeSize,e+1,e+a.nodeSize-1,new Ot(ot.from(s),0,0),1,!0))}function mc(t,e,r=1,n){let i=t.resolve(e),a=i.depth-r,s=n&&n[n.length-1]||i.parent;if(a<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!s.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let u=i.depth-1,c=r-2;u>a;u--,c--){let h=i.node(u),p=i.index(u);if(h.type.spec.isolating)return!1;let g=h.content.cutByIndex(p,h.childCount),y=n&&n[c+1];y&&(g=g.replaceChild(0,y.type.create(y.attrs)));let S=n&&n[c]||h;if(!h.canReplace(p+1,h.childCount)||!S.type.validContent(g))return!1}let o=i.indexAfter(a),l=n&&n[0];return i.node(a).canReplaceWith(o,o,l?l.type:i.node(a+1).type)}function NZ(t,e,r=1,n){let i=t.doc.resolve(e),a=ot.empty,s=ot.empty;for(let o=i.depth,l=i.depth-r,u=r-1;o>l;o--,u--){a=ot.from(i.node(o).copy(a));let c=n&&n[u];s=ot.from(c?c.type.create(c.attrs,s):i.node(o).copy(s))}t.step(new ha(e,e,new Ot(a.append(s),r,r),!0))}function hh(t,e){let r=t.resolve(e),n=r.index();return WR(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(n,n+1)}function PZ(t,e){e.content.size||t.type.compatibleContent(e.type);let r=t.contentMatchAt(t.childCount),{linebreakReplacement:n}=t.type.schema;for(let i=0;i<e.childCount;i++){let a=e.child(i),s=a.type==n?t.type.schema.nodes.text:a.type;if(r=r.matchType(s),!r||!t.type.allowsMarks(a.marks))return!1}return r.validEnd}function WR(t,e){return!!(t&&e&&!t.isLeaf&&PZ(t,e))}function W1(t,e,r=-1){let n=t.resolve(e);for(let i=n.depth;;i--){let a,s,o=n.index(i);if(i==n.depth?(a=n.nodeBefore,s=n.nodeAfter):r>0?(a=n.node(i+1),o++,s=n.node(i).maybeChild(o)):(a=n.node(i).maybeChild(o-1),s=n.node(i+1)),a&&!a.isTextblock&&WR(a,s)&&n.node(i).canReplace(o,o+1))return e;if(i==0)break;e=r<0?n.before(i):n.after(i)}}function MZ(t,e,r){let n=null,{linebreakReplacement:i}=t.doc.type.schema,a=t.doc.resolve(e-r),s=a.node().type;if(i&&s.inlineContent){let c=s.whitespace=="pre",h=!!s.contentMatch.matchType(i);c&&!h?n=!1:!c&&h&&(n=!0)}let o=t.steps.length;if(n===!1){let c=t.doc.resolve(e+r);HR(t,c.node(),c.before(),o)}s.inlineContent&&j_(t,e+r-1,s,a.node().contentMatchAt(a.index()),n==null);let l=t.mapping.slice(o),u=l.map(e-r);if(t.step(new ha(u,l.map(e+r,-1),Ot.empty,!0)),n===!0){let c=t.doc.resolve(u);VR(t,c.node(),c.before(),t.steps.length)}return t}function AZ(t,e,r){let n=t.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),r))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let a=n.index(i);if(n.node(i).canReplaceWith(a,a,r))return n.before(i+1);if(a>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let a=n.indexAfter(i);if(n.node(i).canReplaceWith(a,a,r))return n.after(i+1);if(a<n.node(i).childCount)return null}return null}function qR(t,e,r){let n=t.resolve(e);if(!r.content.size)return e;let i=r.content;for(let a=0;a<r.openStart;a++)i=i.firstChild.content;for(let a=1;a<=(r.openStart==0&&r.size?2:1);a++)for(let s=n.depth;s>=0;s--){let o=s==n.depth?0:n.pos<=(n.start(s+1)+n.end(s+1))/2?-1:1,l=n.index(s)+(o>0?1:0),u=n.node(s),c=!1;if(a==1)c=u.canReplace(l,l,i);else{let h=u.contentMatchAt(l).findWrapping(i.firstChild.type);c=h&&u.canReplaceWith(l,l,h[0])}if(c)return o==0?n.pos:o<0?n.before(s+1):n.after(s+1)}return null}function q1(t,e,r=e,n=Ot.empty){if(e==r&&!n.size)return null;let i=t.resolve(e),a=t.resolve(r);return $R(i,a,n)?new ha(e,r,n):new LZ(i,a,n).fit()}function $R(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}class LZ{constructor(e,r,n){this.$from=e,this.$to=r,this.unplaced=n,this.frontier=[],this.placed=ot.empty;for(let i=0;i<=e.depth;i++){let a=e.node(i);this.frontier.push({type:a.type,match:a.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=ot.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let a=this.placed,s=n.depth,o=i.depth;for(;s&&o&&a.childCount==1;)a=a.firstChild.content,s--,o--;let l=new Ot(a,s,o);return e>-1?new ga(n.pos,e,this.$to.pos,this.$to.end(),l,r):l.size||n.pos!=this.$to.pos?new ha(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let r=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let a=r.firstChild;if(r.childCount>1&&(i=0),a.type.spec.isolating&&i<=n){e=n;break}r=a.content}for(let r=1;r<=2;r++)for(let n=r==1?e:this.unplaced.openStart;n>=0;n--){let i,a=null;n?(a=X2(this.unplaced.content,n-1).firstChild,i=a.content):i=this.unplaced.content;let s=i.firstChild;for(let o=this.depth;o>=0;o--){let{type:l,match:u}=this.frontier[o],c,h=null;if(r==1&&(s?u.matchType(s.type)||(h=u.fillBefore(ot.from(s),!1)):a&&l.compatibleContent(a.type)))return{sliceDepth:n,frontierDepth:o,parent:a,inject:h};if(r==2&&s&&(c=u.findWrapping(s.type)))return{sliceDepth:n,frontierDepth:o,parent:a,wrap:c};if(a&&u.matchType(a.type))break}}}openMore(){let{content:e,openStart:r,openEnd:n}=this.unplaced,i=X2(e,r);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Ot(e,r+1,Math.max(n,i.size+r>=e.size-n?r+1:0)),!0)}dropNode(){let{content:e,openStart:r,openEnd:n}=this.unplaced,i=X2(e,r);if(i.childCount<=1&&r>0){let a=e.size-r<=r+i.size;this.unplaced=new Ot(Zg(e,r-1,1),r-1,a?r-1:n)}else this.unplaced=new Ot(Zg(e,r,1),r,n)}placeNodes({sliceDepth:e,frontierDepth:r,parent:n,inject:i,wrap:a}){for(;this.depth>r;)this.closeFrontierNode();if(a)for(let S=0;S<a.length;S++)this.openFrontierNode(a[S]);let s=this.unplaced,o=n?n.content:s.content,l=s.openStart-e,u=0,c=[],{match:h,type:p}=this.frontier[r];if(i){for(let S=0;S<i.childCount;S++)c.push(i.child(S));h=h.matchFragment(i)}let g=o.size+e-(s.content.size-s.openEnd);for(;u<o.childCount;){let S=o.child(u),w=h.matchType(S.type);if(!w)break;u++,(u>1||l==0||S.content.size)&&(h=w,c.push(KR(S.mark(p.allowedMarks(S.marks)),u==1?l:0,u==o.childCount?g:-1)))}let y=u==o.childCount;y||(g=-1),this.placed=Yg(this.placed,r,ot.from(c)),this.frontier[r].match=h,y&&g<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let S=0,w=o;S<g;S++){let C=w.lastChild;this.frontier.push({type:C.type,match:C.contentMatchAt(C.childCount)}),w=C.content}this.unplaced=y?e==0?Ot.empty:new Ot(Zg(s.content,e-1,1),e-1,g<0?s.openEnd:e-1):new Ot(Zg(s.content,e,u),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],r;if(!e.type.isTextblock||!Q2(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let r=Math.min(this.depth,e.depth);r>=0;r--){let{match:n,type:i}=this.frontier[r],a=r<e.depth&&e.end(r+1)==e.pos+(e.depth-(r+1)),s=Q2(e,r,i,n,a);if(s){for(let o=r-1;o>=0;o--){let{match:l,type:u}=this.frontier[o],c=Q2(e,o,u,l,!0);if(!c||c.childCount)continue e}return{depth:r,fit:s,move:a?e.doc.resolve(e.after(r+1)):e}}}}close(e){let r=this.findCloseLevel(e);if(!r)return null;for(;this.depth>r.depth;)this.closeFrontierNode();r.fit.childCount&&(this.placed=Yg(this.placed,r.depth,r.fit)),e=r.move;for(let n=r.depth+1;n<=e.depth;n++){let i=e.node(n),a=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,a)}return e}openFrontierNode(e,r=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Yg(this.placed,this.depth,ot.from(e.create(r,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let r=this.frontier.pop().match.fillBefore(ot.empty,!0);r.childCount&&(this.placed=Yg(this.placed,this.frontier.length,r))}}function Zg(t,e,r){return e==0?t.cutByIndex(r,t.childCount):t.replaceChild(0,t.firstChild.copy(Zg(t.firstChild.content,e-1,r)))}function Yg(t,e,r){return e==0?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(Yg(t.lastChild.content,e-1,r)))}function X2(t,e){for(let r=0;r<e;r++)t=t.firstChild.content;return t}function KR(t,e,r){if(e<=0)return t;let n=t.content;return e>1&&(n=n.replaceChild(0,KR(n.firstChild,e-1,n.childCount==1?r-1:0))),e>0&&(n=t.type.contentMatch.fillBefore(n).append(n),r<=0&&(n=n.append(t.type.contentMatch.matchFragment(n).fillBefore(ot.empty,!0)))),t.copy(n)}function Q2(t,e,r,n,i){let a=t.node(e),s=i?t.indexAfter(e):t.index(e);if(s==a.childCount&&!r.compatibleContent(a.type))return null;let o=n.fillBefore(a.content,!0,s);return o&&!RZ(r,a.content,s)?o:null}function RZ(t,e,r){for(let n=r;n<e.childCount;n++)if(!t.allowsMarks(e.child(n).marks))return!0;return!1}function OZ(t){return t.spec.defining||t.spec.definingForContent}function DZ(t,e,r,n){if(!n.size)return t.deleteRange(e,r);let i=t.doc.resolve(e),a=t.doc.resolve(r);if($R(i,a,n))return t.step(new ha(e,r,n));let s=YR(i,a);s[s.length-1]==0&&s.pop();let o=-(i.depth+1);s.unshift(o);for(let p=i.depth,g=i.pos-1;p>0;p--,g--){let y=i.node(p).type.spec;if(y.defining||y.definingAsContext||y.isolating)break;s.indexOf(p)>-1?o=p:i.before(p)==g&&s.splice(1,0,-p)}let l=s.indexOf(o),u=[],c=n.openStart;for(let p=n.content,g=0;;g++){let y=p.firstChild;if(u.push(y),g==n.openStart)break;p=y.content}for(let p=c-1;p>=0;p--){let g=u[p],y=OZ(g.type);if(y&&!g.sameMarkup(i.node(Math.abs(o)-1)))c=p;else if(y||!g.type.isTextblock)break}for(let p=n.openStart;p>=0;p--){let g=(p+c+1)%(n.openStart+1),y=u[g];if(y)for(let S=0;S<s.length;S++){let w=s[(S+l)%s.length],C=!0;w<0&&(C=!1,w=-w);let _=i.node(w-1),T=i.index(w-1);if(_.canReplaceWith(T,T,y.type,y.marks))return t.replace(i.before(w),C?a.after(w):r,new Ot(ZR(n.content,0,n.openStart,g),g,n.openEnd))}}let h=t.steps.length;for(let p=s.length-1;p>=0&&(t.replace(e,r,n),!(t.steps.length>h));p--){let g=s[p];g<0||(e=i.before(g),r=a.after(g))}}function ZR(t,e,r,n,i){if(e<r){let a=t.firstChild;t=t.replaceChild(0,a.copy(ZR(a.content,e+1,r,n,a)))}if(e>n){let a=i.contentMatchAt(0),s=a.fillBefore(t).append(t);t=s.append(a.matchFragment(s).fillBefore(ot.empty,!0))}return t}function IZ(t,e,r,n){if(!n.isInline&&e==r&&t.doc.resolve(e).parent.content.size){let i=AZ(t.doc,e,n.type);i!=null&&(e=r=i)}t.replaceRange(e,r,new Ot(ot.from(n),0,0))}function jZ(t,e,r){let n=t.doc.resolve(e),i=t.doc.resolve(r),a=YR(n,i);for(let s=0;s<a.length;s++){let o=a[s],l=s==a.length-1;if(l&&o==0||n.node(o).type.contentMatch.validEnd)return t.delete(n.start(o),i.end(o));if(o>0&&(l||n.node(o-1).canReplace(n.index(o-1),i.indexAfter(o-1))))return t.delete(n.before(o),i.after(o))}for(let s=1;s<=n.depth&&s<=i.depth;s++)if(e-n.start(s)==n.depth-s&&r>n.end(s)&&i.end(s)-r!=i.depth-s&&n.start(s-1)==i.start(s-1)&&n.node(s-1).canReplace(n.index(s-1),i.index(s-1)))return t.delete(n.before(s),r);t.delete(e,r)}function YR(t,e){let r=[],n=Math.min(t.depth,e.depth);for(let i=n;i>=0;i--){let a=t.start(i);if(a<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(a==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==a-1)&&r.push(i)}return r}class Gp extends cs{constructor(e,r,n){super(),this.pos=e,this.attr=r,this.value=n}apply(e){let r=e.nodeAt(this.pos);if(!r)return Ii.fail("No node at attribute step's position");let n=Object.create(null);for(let a in r.attrs)n[a]=r.attrs[a];n[this.attr]=this.value;let i=r.type.create(n,null,r.marks);return Ii.fromReplace(e,this.pos,this.pos+1,new Ot(ot.from(i),0,r.isLeaf?0:1))}getMap(){return go.empty}invert(e){return new Gp(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Gp(r.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,r){if(typeof r.pos!="number"||typeof r.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Gp(r.pos,r.attr,r.value)}}cs.jsonID("attr",Gp);class Dv extends cs{constructor(e,r){super(),this.attr=e,this.value=r}apply(e){let r=Object.create(null);for(let i in e.attrs)r[i]=e.attrs[i];r[this.attr]=this.value;let n=e.type.create(r,e.content,e.marks);return Ii.ok(n)}getMap(){return go.empty}invert(e){return new Dv(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,r){if(typeof r.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Dv(r.attr,r.value)}}cs.jsonID("docAttr",Dv);let Zp=class extends Error{};Zp=function t(e){let r=Error.call(this,e);return r.__proto__=t.prototype,r};Zp.prototype=Object.create(Error.prototype);Zp.prototype.constructor=Zp;Zp.prototype.name="TransformError";class XR{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Ov}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let r=this.maybeStep(e);if(r.failed)throw new Zp(r.failed);return this}maybeStep(e){let r=e.apply(this.doc);return r.failed||this.addStep(e,r.doc),r}get docChanged(){return this.steps.length>0}changedRange(){let e=1e9,r=-1e9;for(let n=0;n<this.mapping.maps.length;n++){let i=this.mapping.maps[n];n&&(e=i.map(e,1),r=i.map(r,-1)),i.forEach((a,s,o,l)=>{e=Math.min(e,o),r=Math.max(r,l)})}return e==1e9?null:{from:e,to:r}}addStep(e,r){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=r}replace(e,r=e,n=Ot.empty){let i=q1(this.doc,e,r,n);return i&&this.step(i),this}replaceWith(e,r,n){return this.replace(e,r,new Ot(ot.from(n),0,0))}delete(e,r){return this.replace(e,r,Ot.empty)}insert(e,r){return this.replaceWith(e,e,r)}replaceRange(e,r,n){return DZ(this,e,r,n),this}replaceRangeWith(e,r,n){return IZ(this,e,r,n),this}deleteRange(e,r){return jZ(this,e,r),this}lift(e,r){return wZ(this,e,r),this}join(e,r=1){return MZ(this,e,r),this}wrap(e,r){return _Z(this,e,r),this}setBlockType(e,r=e,n,i=null){return CZ(this,e,r,n,i),this}setNodeMarkup(e,r,n=null,i){return TZ(this,e,r,n,i),this}setNodeAttribute(e,r,n){return this.step(new Gp(e,r,n)),this}setDocAttribute(e,r){return this.step(new Dv(e,r)),this}addNodeMark(e,r){return this.step(new Fd(e,r)),this}removeNodeMark(e,r){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(r instanceof wn)r.isInSet(n.marks)&&this.step(new Sf(e,r));else{let i=n.marks,a,s=[];for(;a=r.isInSet(i);)s.push(new Sf(e,a)),i=a.removeFromSet(i);for(let o=s.length-1;o>=0;o--)this.step(s[o])}return this}split(e,r=1,n){return NZ(this,e,r,n),this}addMark(e,r,n){return yZ(this,e,r,n),this}removeMark(e,r,n){return xZ(this,e,r,n),this}clearIncompatible(e,r,n){return j_(this,e,r,n),this}}const J2=Object.create(null);class Sr{constructor(e,r,n){this.$anchor=e,this.$head=r,this.ranges=n||[new FZ(e.min(r),e.max(r))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let r=0;r<e.length;r++)if(e[r].$from.pos!=e[r].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,r=Ot.empty){let n=r.content.lastChild,i=null;for(let o=0;o<r.openEnd;o++)i=n,n=n.lastChild;let a=e.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){let{$from:l,$to:u}=s[o],c=e.mapping.slice(a);e.replaceRange(c.map(l.pos),c.map(u.pos),o?Ot.empty:r),o==0&&k3(e,a,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,r){let n=e.steps.length,i=this.ranges;for(let a=0;a<i.length;a++){let{$from:s,$to:o}=i[a],l=e.mapping.slice(n),u=l.map(s.pos),c=l.map(o.pos);a?e.deleteRange(u,c):(e.replaceRangeWith(u,c,r),k3(e,n,r.isInline?-1:1))}}static findFrom(e,r,n=!1){let i=e.parent.inlineContent?new dr(e):Tp(e.node(0),e.parent,e.pos,e.index(),r,n);if(i)return i;for(let a=e.depth-1;a>=0;a--){let s=r<0?Tp(e.node(0),e.node(a),e.before(a+1),e.index(a),r,n):Tp(e.node(0),e.node(a),e.after(a+1),e.index(a)+1,r,n);if(s)return s}return null}static near(e,r=1){return this.findFrom(e,r)||this.findFrom(e,-r)||new yo(e.node(0))}static atStart(e){return Tp(e,e,0,0,1)||new yo(e)}static atEnd(e){return Tp(e,e,e.content.size,e.childCount,-1)||new yo(e)}static fromJSON(e,r){if(!r||!r.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=J2[r.type];if(!n)throw new RangeError(`No selection type ${r.type} defined`);return n.fromJSON(e,r)}static jsonID(e,r){if(e in J2)throw new RangeError("Duplicate use of selection JSON ID "+e);return J2[e]=r,r.prototype.jsonID=e,r}getBookmark(){return dr.between(this.$anchor,this.$head).getBookmark()}}Sr.prototype.visible=!0;class FZ{constructor(e,r){this.$from=e,this.$to=r}}let w3=!1;function S3(t){!w3&&!t.parent.inlineContent&&(w3=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class dr extends Sr{constructor(e,r=e){S3(e),S3(r),super(e,r)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,r){let n=e.resolve(r.map(this.head));if(!n.parent.inlineContent)return Sr.near(n);let i=e.resolve(r.map(this.anchor));return new dr(i.parent.inlineContent?i:n,n)}replace(e,r=Ot.empty){if(super.replace(e,r),r==Ot.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof dr&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new $1(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,r){if(typeof r.anchor!="number"||typeof r.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new dr(e.resolve(r.anchor),e.resolve(r.head))}static create(e,r,n=r){let i=e.resolve(r);return new this(i,n==r?i:e.resolve(n))}static between(e,r,n){let i=e.pos-r.pos;if((!n||i)&&(n=i>=0?1:-1),!r.parent.inlineContent){let a=Sr.findFrom(r,n,!0)||Sr.findFrom(r,-n,!0);if(a)r=a.$head;else return Sr.near(r,n)}return e.parent.inlineContent||(i==0?e=r:(e=(Sr.findFrom(e,-n,!0)||Sr.findFrom(e,n,!0)).$anchor,e.pos<r.pos!=i<0&&(e=r))),new dr(e,r)}}Sr.jsonID("text",dr);class $1{constructor(e,r){this.anchor=e,this.head=r}map(e){return new $1(e.map(this.anchor),e.map(this.head))}resolve(e){return dr.between(e.resolve(this.anchor),e.resolve(this.head))}}class Qt extends Sr{constructor(e){let r=e.nodeAfter,n=e.node(0).resolve(e.pos+r.nodeSize);super(e,n),this.node=r}map(e,r){let{deleted:n,pos:i}=r.mapResult(this.anchor),a=e.resolve(i);return n?Sr.near(a):new Qt(a)}content(){return new Ot(ot.from(this.node),0,0)}eq(e){return e instanceof Qt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new B_(this.anchor)}static fromJSON(e,r){if(typeof r.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Qt(e.resolve(r.anchor))}static create(e,r){return new Qt(e.resolve(r))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}Qt.prototype.visible=!1;Sr.jsonID("node",Qt);class B_{constructor(e){this.anchor=e}map(e){let{deleted:r,pos:n}=e.mapResult(this.anchor);return r?new $1(n,n):new B_(n)}resolve(e){let r=e.resolve(this.anchor),n=r.nodeAfter;return n&&Qt.isSelectable(n)?new Qt(r):Sr.near(r)}}class yo extends Sr{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,r=Ot.empty){if(r==Ot.empty){e.delete(0,e.doc.content.size);let n=Sr.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,r)}toJSON(){return{type:"all"}}static fromJSON(e){return new yo(e)}map(e){return new yo(e)}eq(e){return e instanceof yo}getBookmark(){return BZ}}Sr.jsonID("all",yo);const BZ={map(){return this},resolve(t){return new yo(t)}};function Tp(t,e,r,n,i,a=!1){if(e.inlineContent)return dr.create(t,r);for(let s=n-(i>0?0:1);i>0?s<e.childCount:s>=0;s+=i){let o=e.child(s);if(o.isAtom){if(!a&&Qt.isSelectable(o))return Qt.create(t,r-(i<0?o.nodeSize:0))}else{let l=Tp(t,o,r+i,i<0?o.childCount:0,i,a);if(l)return l}r+=o.nodeSize*i}return null}function k3(t,e,r){let n=t.steps.length-1;if(n<e)return;let i=t.steps[n];if(!(i instanceof ha||i instanceof ga))return;let a=t.mapping.maps[n],s;a.forEach((o,l,u,c)=>{s==null&&(s=c)}),t.setSelection(Sr.near(t.doc.resolve(s),r))}const _3=1,wy=2,C3=4;class zZ extends XR{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|_3)&~wy,this.storedMarks=null,this}get selectionSet(){return(this.updated&_3)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=wy,this}ensureMarks(e){return wn.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&wy)>0}addStep(e,r){super.addStep(e,r),this.updated=this.updated&~wy,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,r=!0){let n=this.selection;return r&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||wn.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,r,n){let i=this.doc.type.schema;if(r==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(n==null&&(n=r),!e)return this.deleteRange(r,n);let a=this.storedMarks;if(!a){let s=this.doc.resolve(r);a=n==r?s.marks():s.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(r,n,i.text(e,a)),!this.selection.empty&&this.selection.to==r+e.length&&this.setSelection(Sr.near(this.selection.$to)),this}}setMeta(e,r){return this.meta[typeof e=="string"?e:e.key]=r,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=C3,this}get scrolledIntoView(){return(this.updated&C3)>0}}function E3(t,e){return!e||!t?t:t.bind(e)}class Xg{constructor(e,r,n){this.name=e,this.init=E3(r.init,n),this.apply=E3(r.apply,n)}}const UZ=[new Xg("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Xg("selection",{init(t,e){return t.selection||Sr.atStart(e.doc)},apply(t){return t.selection}}),new Xg("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,r,n){return n.selection.$cursor?t.storedMarks:null}}),new Xg("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class eS{constructor(e,r){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=UZ.slice(),r&&r.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new Xg(n.key,n.spec.state,n))})}}class Dp{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,r=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=r){let i=this.config.plugins[n];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let r=[e],n=this.applyInner(e),i=null;for(;;){let a=!1;for(let s=0;s<this.config.plugins.length;s++){let o=this.config.plugins[s];if(o.spec.appendTransaction){let l=i?i[s].n:0,u=i?i[s].state:this,c=l<r.length&&o.spec.appendTransaction.call(o,l?r.slice(l):r,u,n);if(c&&n.filterTransaction(c,s)){if(c.setMeta("appendedTransaction",e),!i){i=[];for(let h=0;h<this.config.plugins.length;h++)i.push(h<s?{state:n,n:r.length}:{state:this,n:0})}r.push(c),n=n.applyInner(c),a=!0}i&&(i[s]={state:n,n:r.length})}}if(!a)return{state:n,transactions:r}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let r=new Dp(this.config),n=this.config.fields;for(let i=0;i<n.length;i++){let a=n[i];r[a.name]=a.apply(e,this[a.name],this,r)}return r}get tr(){return new zZ(this)}static create(e){let r=new eS(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new Dp(r);for(let i=0;i<r.fields.length;i++)n[r.fields[i].name]=r.fields[i].init(e,n);return n}reconfigure(e){let r=new eS(this.schema,e.plugins),n=r.fields,i=new Dp(r);for(let a=0;a<n.length;a++){let s=n[a].name;i[s]=this.hasOwnProperty(s)?this[s]:n[a].init(e,i)}return i}toJSON(e){let r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(r.storedMarks=this.storedMarks.map(n=>n.toJSON())),e&&typeof e=="object")for(let n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[n],a=i.spec.state;a&&a.toJSON&&(r[n]=a.toJSON.call(i,this[i.key]))}return r}static fromJSON(e,r,n){if(!r)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new eS(e.schema,e.plugins),a=new Dp(i);return i.fields.forEach(s=>{if(s.name=="doc")a.doc=Qo.fromJSON(e.schema,r.doc);else if(s.name=="selection")a.selection=Sr.fromJSON(a.doc,r.selection);else if(s.name=="storedMarks")r.storedMarks&&(a.storedMarks=r.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let o in n){let l=n[o],u=l.spec.state;if(l.key==s.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(r,o)){a[s.name]=u.fromJSON.call(l,e,r[o],a);return}}a[s.name]=s.init(e,a)}}),a}}function QR(t,e,r){for(let n in t){let i=t[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=QR(i,e,{})),r[n]=i}return r}class Yn{constructor(e){this.spec=e,this.props={},e.props&&QR(e.props,this,this.props),this.key=e.key?e.key.key:JR("plugin")}getState(e){return e[this.key]}}const tS=Object.create(null);function JR(t){return t in tS?t+"$"+ ++tS[t]:(tS[t]=0,t+"$")}class Ti{constructor(e="key"){this.key=JR(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const z_=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function eO(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("backward",t):r.parentOffset>0)?null:r}const tO=(t,e,r)=>{let n=eO(t,r);if(!n)return!1;let i=U_(n);if(!i){let s=n.blockRange(),o=s&&vm(s);return o==null?!1:(e&&e(t.tr.lift(s,o).scrollIntoView()),!0)}let a=i.nodeBefore;if(cO(t,i,e,-1))return!0;if(n.parent.content.size==0&&(Yp(a,"end")||Qt.isSelectable(a)))for(let s=n.depth;;s--){let o=q1(t.doc,n.before(s),n.after(s),Ot.empty);if(o&&o.slice.size<o.to-o.from){if(e){let l=t.tr.step(o);l.setSelection(Yp(a,"end")?Sr.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):Qt.create(l.doc,i.pos-a.nodeSize)),e(l.scrollIntoView())}return!0}if(s==1||n.node(s-1).childCount>1)break}return a.isAtom&&i.depth==n.depth-1?(e&&e(t.tr.delete(i.pos-a.nodeSize,i.pos).scrollIntoView()),!0):!1},GZ=(t,e,r)=>{let n=eO(t,r);if(!n)return!1;let i=U_(n);return i?rO(t,i,e):!1},VZ=(t,e,r)=>{let n=iO(t,r);if(!n)return!1;let i=G_(n);return i?rO(t,i,e):!1};function rO(t,e,r){let n=e.nodeBefore,i=n,a=e.pos-1;for(;!i.isTextblock;a--){if(i.type.spec.isolating)return!1;let c=i.lastChild;if(!c)return!1;i=c}let s=e.nodeAfter,o=s,l=e.pos+1;for(;!o.isTextblock;l++){if(o.type.spec.isolating)return!1;let c=o.firstChild;if(!c)return!1;o=c}let u=q1(t.doc,a,l,Ot.empty);if(!u||u.from!=a||u instanceof ha&&u.slice.size>=l-a)return!1;if(r){let c=t.tr.step(u);c.setSelection(dr.create(c.doc,a)),r(c.scrollIntoView())}return!0}function Yp(t,e,r=!1){for(let n=t;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(r&&n.childCount!=1)return!1}return!1}const nO=(t,e,r)=>{let{$head:n,empty:i}=t.selection,a=n;if(!i)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("backward",t):n.parentOffset>0)return!1;a=U_(n)}let s=a&&a.nodeBefore;return!s||!Qt.isSelectable(s)?!1:(e&&e(t.tr.setSelection(Qt.create(t.doc,a.pos-s.nodeSize)).scrollIntoView()),!0)};function U_(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function iO(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)?null:r}const aO=(t,e,r)=>{let n=iO(t,r);if(!n)return!1;let i=G_(n);if(!i)return!1;let a=i.nodeAfter;if(cO(t,i,e,1))return!0;if(n.parent.content.size==0&&(Yp(a,"start")||Qt.isSelectable(a))){let s=q1(t.doc,n.before(),n.after(),Ot.empty);if(s&&s.slice.size<s.to-s.from){if(e){let o=t.tr.step(s);o.setSelection(Yp(a,"start")?Sr.findFrom(o.doc.resolve(o.mapping.map(i.pos)),1):Qt.create(o.doc,o.mapping.map(i.pos))),e(o.scrollIntoView())}return!0}}return a.isAtom&&i.depth==n.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+a.nodeSize).scrollIntoView()),!0):!1},sO=(t,e,r)=>{let{$head:n,empty:i}=t.selection,a=n;if(!i)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)return!1;a=G_(n)}let s=a&&a.nodeAfter;return!s||!Qt.isSelectable(s)?!1:(e&&e(t.tr.setSelection(Qt.create(t.doc,a.pos)).scrollIntoView()),!0)};function G_(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let r=t.node(e);if(t.index(e)+1<r.childCount)return t.doc.resolve(t.after(e+1));if(r.type.spec.isolating)break}return null}const HZ=(t,e)=>{let r=t.selection,n=r instanceof Qt,i;if(n){if(r.node.isTextblock||!hh(t.doc,r.from))return!1;i=r.from}else if(i=W1(t.doc,r.from,-1),i==null)return!1;if(e){let a=t.tr.join(i);n&&a.setSelection(Qt.create(a.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(a.scrollIntoView())}return!0},WZ=(t,e)=>{let r=t.selection,n;if(r instanceof Qt){if(r.node.isTextblock||!hh(t.doc,r.to))return!1;n=r.to}else if(n=W1(t.doc,r.to,1),n==null)return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0},qZ=(t,e)=>{let{$from:r,$to:n}=t.selection,i=r.blockRange(n),a=i&&vm(i);return a==null?!1:(e&&e(t.tr.lift(i,a).scrollIntoView()),!0)},oO=(t,e)=>{let{$head:r,$anchor:n}=t.selection;return!r.parent.type.spec.code||!r.sameParent(n)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function V_(t){for(let e=0;e<t.edgeCount;e++){let{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}const $Z=(t,e)=>{let{$head:r,$anchor:n}=t.selection;if(!r.parent.type.spec.code||!r.sameParent(n))return!1;let i=r.node(-1),a=r.indexAfter(-1),s=V_(i.contentMatchAt(a));if(!s||!i.canReplaceWith(a,a,s))return!1;if(e){let o=r.after(),l=t.tr.replaceWith(o,o,s.createAndFill());l.setSelection(Sr.near(l.doc.resolve(o),1)),e(l.scrollIntoView())}return!0},lO=(t,e)=>{let r=t.selection,{$from:n,$to:i}=r;if(r instanceof yo||n.parent.inlineContent||i.parent.inlineContent)return!1;let a=V_(i.parent.contentMatchAt(i.indexAfter()));if(!a||!a.isTextblock)return!1;if(e){let s=(!n.parentOffset&&i.index()<i.parent.childCount?n:i).pos,o=t.tr.insert(s,a.createAndFill());o.setSelection(dr.create(o.doc,s+1)),e(o.scrollIntoView())}return!0},uO=(t,e)=>{let{$cursor:r}=t.selection;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){let a=r.before();if(mc(t.doc,a))return e&&e(t.tr.split(a).scrollIntoView()),!0}let n=r.blockRange(),i=n&&vm(n);return i==null?!1:(e&&e(t.tr.lift(n,i).scrollIntoView()),!0)};function KZ(t){return(e,r)=>{let{$from:n,$to:i}=e.selection;if(e.selection instanceof Qt&&e.selection.node.isBlock)return!n.parentOffset||!mc(e.doc,n.pos)?!1:(r&&r(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let a=[],s,o,l=!1,u=!1;for(let g=n.depth;;g--)if(n.node(g).isBlock){l=n.end(g)==n.pos+(n.depth-g),u=n.start(g)==n.pos-(n.depth-g),o=V_(n.node(g-1).contentMatchAt(n.indexAfter(g-1))),a.unshift(l&&o?{type:o}:null),s=g;break}else{if(g==1)return!1;a.unshift(null)}let c=e.tr;(e.selection instanceof dr||e.selection instanceof yo)&&c.deleteSelection();let h=c.mapping.map(n.pos),p=mc(c.doc,h,a.length,a);if(p||(a[0]=o?{type:o}:null,p=mc(c.doc,h,a.length,a)),!p)return!1;if(c.split(h,a.length,a),!l&&u&&n.node(s).type!=o){let g=c.mapping.map(n.before(s)),y=c.doc.resolve(g);o&&n.node(s-1).canReplaceWith(y.index(),y.index()+1,o)&&c.setNodeMarkup(c.mapping.map(n.before(s)),o)}return r&&r(c.scrollIntoView()),!0}}const ZZ=KZ(),YZ=(t,e)=>{let{$from:r,to:n}=t.selection,i,a=r.sharedDepth(n);return a==0?!1:(i=r.before(a),e&&e(t.tr.setSelection(Qt.create(t.doc,i))),!0)};function XZ(t,e,r){let n=e.nodeBefore,i=e.nodeAfter,a=e.index();return!n||!i||!n.type.compatibleContent(i.type)?!1:!n.content.size&&e.parent.canReplace(a-1,a)?(r&&r(t.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(a,a+1)||!(i.isTextblock||hh(t.doc,e.pos))?!1:(r&&r(t.tr.join(e.pos).scrollIntoView()),!0)}function cO(t,e,r,n){let i=e.nodeBefore,a=e.nodeAfter,s,o,l=i.type.spec.isolating||a.type.spec.isolating;if(!l&&XZ(t,e,r))return!0;let u=!l&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(s=(o=i.contentMatchAt(i.childCount)).findWrapping(a.type))&&o.matchType(s[0]||a.type).validEnd){if(r){let g=e.pos+a.nodeSize,y=ot.empty;for(let C=s.length-1;C>=0;C--)y=ot.from(s[C].create(null,y));y=ot.from(i.copy(y));let S=t.tr.step(new ga(e.pos-1,g,e.pos,g,new Ot(y,1,0),s.length,!0)),w=S.doc.resolve(g+2*s.length);w.nodeAfter&&w.nodeAfter.type==i.type&&hh(S.doc,w.pos)&&S.join(w.pos),r(S.scrollIntoView())}return!0}let c=a.type.spec.isolating||n>0&&l?null:Sr.findFrom(e,1),h=c&&c.$from.blockRange(c.$to),p=h&&vm(h);if(p!=null&&p>=e.depth)return r&&r(t.tr.lift(h,p).scrollIntoView()),!0;if(u&&Yp(a,"start",!0)&&Yp(i,"end")){let g=i,y=[];for(;y.push(g),!g.isTextblock;)g=g.lastChild;let S=a,w=1;for(;!S.isTextblock;S=S.firstChild)w++;if(g.canReplace(g.childCount,g.childCount,S.content)){if(r){let C=ot.empty;for(let T=y.length-1;T>=0;T--)C=ot.from(y[T].copy(C));let _=t.tr.step(new ga(e.pos-y.length,e.pos+a.nodeSize,e.pos+w,e.pos+a.nodeSize-w,new Ot(C,y.length,0),0,!0));r(_.scrollIntoView())}return!0}}return!1}function dO(t){return function(e,r){let n=e.selection,i=t<0?n.$from:n.$to,a=i.depth;for(;i.node(a).isInline;){if(!a)return!1;a--}return i.node(a).isTextblock?(r&&r(e.tr.setSelection(dr.create(e.doc,t<0?i.start(a):i.end(a)))),!0):!1}}const QZ=dO(-1),JZ=dO(1);function eY(t,e=null){return function(r,n){let{$from:i,$to:a}=r.selection,s=i.blockRange(a),o=s&&F_(s,t,e);return o?(n&&n(r.tr.wrap(s,o).scrollIntoView()),!0):!1}}function T3(t,e=null){return function(r,n){let i=!1;for(let a=0;a<r.selection.ranges.length&&!i;a++){let{$from:{pos:s},$to:{pos:o}}=r.selection.ranges[a];r.doc.nodesBetween(s,o,(l,u)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)i=!0;else{let c=r.doc.resolve(u),h=c.index();i=c.parent.canReplaceWith(h,h+1,t)}})}if(!i)return!1;if(n){let a=r.tr;for(let s=0;s<r.selection.ranges.length;s++){let{$from:{pos:o},$to:{pos:l}}=r.selection.ranges[s];a.setBlockType(o,l,t,e)}n(a.scrollIntoView())}return!0}}function H_(...t){return function(e,r,n){for(let i=0;i<t.length;i++)if(t[i](e,r,n))return!0;return!1}}H_(z_,tO,nO);H_(z_,aO,sO);H_(oO,lO,uO,ZZ);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function tY(t,e=null){return function(r,n){let{$from:i,$to:a}=r.selection,s=i.blockRange(a);if(!s)return!1;let o=n?r.tr:null;return rY(o,s,t,e)?(n&&n(o.scrollIntoView()),!0):!1}}function rY(t,e,r,n=null){let i=!1,a=e,s=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(r)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=s.resolve(e.start-2);a=new Nx(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new Nx(e.$from,s.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let o=F_(a,r,n,e);return o?(t&&nY(t,e,o,i,r),!0):!1}function nY(t,e,r,n,i){let a=ot.empty;for(let c=r.length-1;c>=0;c--)a=ot.from(r[c].type.create(r[c].attrs,a));t.step(new ga(e.start-(n?2:0),e.end,e.start,e.end,new Ot(a,0,0),r.length,!0));let s=0;for(let c=0;c<r.length;c++)r[c].type==i&&(s=c+1);let o=r.length-s,l=e.start+r.length-(n?2:0),u=e.parent;for(let c=e.startIndex,h=e.endIndex,p=!0;c<h;c++,p=!1)!p&&mc(t.doc,l,o)&&(t.split(l,o),l+=2*o),l+=u.child(c).nodeSize;return t}function iY(t){return function(e,r){let{$from:n,$to:i}=e.selection,a=n.blockRange(i,s=>s.childCount>0&&s.firstChild.type==t);return a?r?n.node(a.depth-1).type==t?aY(e,r,t,a):sY(e,r,a):!0:!1}}function aY(t,e,r,n){let i=t.tr,a=n.end,s=n.$to.end(n.depth);a<s&&(i.step(new ga(a-1,s,a,s,new Ot(ot.from(r.create(null,n.parent.copy())),1,0),1,!0)),n=new Nx(i.doc.resolve(n.$from.pos),i.doc.resolve(s),n.depth));const o=vm(n);if(o==null)return!1;i.lift(n,o);let l=i.doc.resolve(i.mapping.map(a,-1)-1);return hh(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function sY(t,e,r){let n=t.tr,i=r.parent;for(let g=r.end,y=r.endIndex-1,S=r.startIndex;y>S;y--)g-=i.child(y).nodeSize,n.delete(g-1,g+1);let a=n.doc.resolve(r.start),s=a.nodeAfter;if(n.mapping.map(r.end)!=r.start+a.nodeAfter.nodeSize)return!1;let o=r.startIndex==0,l=r.endIndex==i.childCount,u=a.node(-1),c=a.index(-1);if(!u.canReplace(c+(o?0:1),c+1,s.content.append(l?ot.empty:ot.from(i))))return!1;let h=a.pos,p=h+s.nodeSize;return n.step(new ga(h-(o?1:0),p+(l?1:0),h+1,p-1,new Ot((o?ot.empty:ot.from(i.copy(ot.empty))).append(l?ot.empty:ot.from(i.copy(ot.empty))),o?0:1,l?0:1),o?0:1)),e(n.scrollIntoView()),!0}function oY(t){return function(e,r){let{$from:n,$to:i}=e.selection,a=n.blockRange(i,u=>u.childCount>0&&u.firstChild.type==t);if(!a)return!1;let s=a.startIndex;if(s==0)return!1;let o=a.parent,l=o.child(s-1);if(l.type!=t)return!1;if(r){let u=l.lastChild&&l.lastChild.type==o.type,c=ot.from(u?t.create():null),h=new Ot(ot.from(t.create(null,ot.from(o.type.create(null,c)))),u?3:1,0),p=a.start,g=a.end;r(e.tr.step(new ga(p-(u?3:1),g,p,g,h,1,!0)).scrollIntoView())}return!0}}const ja=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},Xp=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let pk=null;const uc=function(t,e,r){let n=pk||(pk=document.createRange());return n.setEnd(t,r??t.nodeValue.length),n.setStart(t,e||0),n},lY=function(){pk=null},kf=function(t,e,r,n){return r&&(N3(t,e,r,n,-1)||N3(t,e,r,n,1))},uY=/^(img|br|input|textarea|hr)$/i;function N3(t,e,r,n,i){for(var a;;){if(t==r&&e==n)return!0;if(e==(i<0?0:Yo(t))){let s=t.parentNode;if(!s||s.nodeType!=1||c0(t)||uY.test(t.nodeName)||t.contentEditable=="false")return!1;e=ja(t)+(i<0?0:1),t=s}else if(t.nodeType==1){let s=t.childNodes[e+(i<0?-1:0)];if(s.nodeType==1&&s.contentEditable=="false")if(!((a=s.pmViewDesc)===null||a===void 0)&&a.ignoreForSelection)e+=i;else return!1;else t=s,e=i<0?Yo(t):0}else return!1}}function Yo(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function cY(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Yo(t)}else if(t.parentNode&&!c0(t))e=ja(t),t=t.parentNode;else return null}}function dY(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!c0(t))e=ja(t)+1,t=t.parentNode;else return null}}function hY(t,e,r){for(let n=e==0,i=e==Yo(t);n||i;){if(t==r)return!0;let a=ja(t);if(t=t.parentNode,!t)return!1;n=n&&a==0,i=i&&a==Yo(t)}}function c0(t){let e;for(let r=t;r&&!(e=r.pmViewDesc);r=r.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const K1=function(t){return t.focusNode&&kf(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function Jh(t,e){let r=document.createEvent("Event");return r.initEvent("keydown",!0,!0),r.keyCode=t,r.key=r.code=e,r}function fY(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function pY(t,e,r){if(t.caretPositionFromPoint)try{let n=t.caretPositionFromPoint(e,r);if(n)return{node:n.offsetNode,offset:Math.min(Yo(n.offsetNode),n.offset)}}catch{}if(t.caretRangeFromPoint){let n=t.caretRangeFromPoint(e,r);if(n)return{node:n.startContainer,offset:Math.min(Yo(n.startContainer),n.startOffset)}}}const Nu=typeof navigator<"u"?navigator:null,P3=typeof document<"u"?document:null,fh=Nu&&Nu.userAgent||"",mk=/Edge\/(\d+)/.exec(fh),hO=/MSIE \d/.exec(fh),gk=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(fh),Xs=!!(hO||gk||mk),qd=hO?document.documentMode:gk?+gk[1]:mk?+mk[1]:0,Jo=!Xs&&/gecko\/(\d+)/i.test(fh);Jo&&+(/Firefox\/(\d+)/.exec(fh)||[0,0])[1];const vk=!Xs&&/Chrome\/(\d+)/.exec(fh),pa=!!vk,fO=vk?+vk[1]:0,Ua=!Xs&&!!Nu&&/Apple Computer/.test(Nu.vendor),Qp=Ua&&(/Mobile\/\w+/.test(fh)||!!Nu&&Nu.maxTouchPoints>2),Ko=Qp||(Nu?/Mac/.test(Nu.platform):!1),pO=Nu?/Win/.test(Nu.platform):!1,fc=/Android \d/.test(fh),d0=!!P3&&"webkitFontSmoothing"in P3.documentElement.style,mY=d0?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function gY(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function ac(t,e){return typeof t=="number"?t:t[e]}function vY(t){let e=t.getBoundingClientRect(),r=e.width/t.offsetWidth||1,n=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*r,top:e.top,bottom:e.top+t.clientHeight*n}}function M3(t,e,r){let n=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,a=t.dom.ownerDocument;for(let s=r||t.dom;s;){if(s.nodeType!=1){s=Xp(s);continue}let o=s,l=o==a.body,u=l?gY(a):vY(o),c=0,h=0;if(e.top<u.top+ac(n,"top")?h=-(u.top-e.top+ac(i,"top")):e.bottom>u.bottom-ac(n,"bottom")&&(h=e.bottom-e.top>u.bottom-u.top?e.top+ac(i,"top")-u.top:e.bottom-u.bottom+ac(i,"bottom")),e.left<u.left+ac(n,"left")?c=-(u.left-e.left+ac(i,"left")):e.right>u.right-ac(n,"right")&&(c=e.right-u.right+ac(i,"right")),c||h)if(l)a.defaultView.scrollBy(c,h);else{let g=o.scrollLeft,y=o.scrollTop;h&&(o.scrollTop+=h),c&&(o.scrollLeft+=c);let S=o.scrollLeft-g,w=o.scrollTop-y;e={left:e.left-S,top:e.top-w,right:e.right-S,bottom:e.bottom-w}}let p=l?"fixed":getComputedStyle(s).position;if(/^(fixed|sticky)$/.test(p))break;s=p=="absolute"?s.offsetParent:Xp(s)}}function yY(t){let e=t.dom.getBoundingClientRect(),r=Math.max(0,e.top),n,i;for(let a=(e.left+e.right)/2,s=r+1;s<Math.min(innerHeight,e.bottom);s+=5){let o=t.root.elementFromPoint(a,s);if(!o||o==t.dom||!t.dom.contains(o))continue;let l=o.getBoundingClientRect();if(l.top>=r-20){n=o,i=l.top;break}}return{refDOM:n,refTop:i,stack:mO(t.dom)}}function mO(t){let e=[],r=t.ownerDocument;for(let n=t;n&&(e.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),t!=r);n=Xp(n));return e}function xY({refDOM:t,refTop:e,stack:r}){let n=t?t.getBoundingClientRect().top:0;gO(r,n==0?0:n-e)}function gO(t,e){for(let r=0;r<t.length;r++){let{dom:n,top:i,left:a}=t[r];n.scrollTop!=i+e&&(n.scrollTop=i+e),n.scrollLeft!=a&&(n.scrollLeft=a)}}let kp=null;function bY(t){if(t.setActive)return t.setActive();if(kp)return t.focus(kp);let e=mO(t);t.focus(kp==null?{get preventScroll(){return kp={preventScroll:!0},!0}}:void 0),kp||(kp=!1,gO(e,0))}function vO(t,e){let r,n=2e8,i,a=0,s=e.top,o=e.top,l,u;for(let c=t.firstChild,h=0;c;c=c.nextSibling,h++){let p;if(c.nodeType==1)p=c.getClientRects();else if(c.nodeType==3)p=uc(c).getClientRects();else continue;for(let g=0;g<p.length;g++){let y=p[g];if(y.top<=s&&y.bottom>=o){s=Math.max(y.bottom,s),o=Math.min(y.top,o);let S=y.left>e.left?y.left-e.left:y.right<e.left?e.left-y.right:0;if(S<n){r=c,n=S,i=S&&r.nodeType==3?{left:y.right<e.left?y.right:y.left,top:e.top}:e,c.nodeType==1&&S&&(a=h+(e.left>=(y.left+y.right)/2?1:0));continue}}else y.top>e.top&&!l&&y.left<=e.left&&y.right>=e.left&&(l=c,u={left:Math.max(y.left,Math.min(y.right,e.left)),top:y.top});!r&&(e.left>=y.right&&e.top>=y.top||e.left>=y.left&&e.top>=y.bottom)&&(a=h+1)}}return!r&&l&&(r=l,i=u,n=0),r&&r.nodeType==3?wY(r,i):!r||n&&r.nodeType==1?{node:t,offset:a}:vO(r,i)}function wY(t,e){let r=t.nodeValue.length,n=document.createRange(),i;for(let a=0;a<r;a++){n.setEnd(t,a+1),n.setStart(t,a);let s=Cd(n,1);if(s.top!=s.bottom&&W_(e,s)){i={node:t,offset:a+(e.left>=(s.left+s.right)/2?1:0)};break}}return n.detach(),i||{node:t,offset:0}}function W_(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function SY(t,e){let r=t.parentNode;return r&&/^li$/i.test(r.nodeName)&&e.left<t.getBoundingClientRect().left?r:t}function kY(t,e,r){let{node:n,offset:i}=vO(e,r),a=-1;if(n.nodeType==1&&!n.firstChild){let s=n.getBoundingClientRect();a=s.left!=s.right&&r.left>(s.left+s.right)/2?1:-1}return t.docView.posFromDOM(n,i,a)}function _Y(t,e,r,n){let i=-1;for(let a=e,s=!1;a!=t.dom;){let o=t.docView.nearestDesc(a,!0),l;if(!o)return null;if(o.dom.nodeType==1&&(o.node.isBlock&&o.parent||!o.contentDOM)&&((l=o.dom.getBoundingClientRect()).width||l.height)&&(o.node.isBlock&&o.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(o.dom.nodeName)&&(!s&&l.left>n.left||l.top>n.top?i=o.posBefore:(!s&&l.right<n.left||l.bottom<n.top)&&(i=o.posAfter),s=!0),!o.contentDOM&&i<0&&!o.node.isText))return(o.node.isBlock?n.top<(l.top+l.bottom)/2:n.left<(l.left+l.right)/2)?o.posBefore:o.posAfter;a=o.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,r,-1)}function yO(t,e,r){let n=t.childNodes.length;if(n&&r.top<r.bottom)for(let i=Math.max(0,Math.min(n-1,Math.floor(n*(e.top-r.top)/(r.bottom-r.top))-2)),a=i;;){let s=t.childNodes[a];if(s.nodeType==1){let o=s.getClientRects();for(let l=0;l<o.length;l++){let u=o[l];if(W_(e,u))return yO(s,e,u)}}if((a=(a+1)%n)==i)break}return t}function CY(t,e){let r=t.dom.ownerDocument,n,i=0,a=pY(r,e.left,e.top);a&&({node:n,offset:i}=a);let s=(t.root.elementFromPoint?t.root:r).elementFromPoint(e.left,e.top),o;if(!s||!t.dom.contains(s.nodeType!=1?s.parentNode:s)){let u=t.dom.getBoundingClientRect();if(!W_(e,u)||(s=yO(t.dom,e,u),!s))return null}if(Ua)for(let u=s;n&&u;u=Xp(u))u.draggable&&(n=void 0);if(s=SY(s,e),n){if(Jo&&n.nodeType==1&&(i=Math.min(i,n.childNodes.length),i<n.childNodes.length)){let c=n.childNodes[i],h;c.nodeName=="IMG"&&(h=c.getBoundingClientRect()).right<=e.left&&h.bottom>e.top&&i++}let u;d0&&i&&n.nodeType==1&&(u=n.childNodes[i-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&i--,n==t.dom&&i==n.childNodes.length-1&&n.lastChild.nodeType==1&&e.top>n.lastChild.getBoundingClientRect().bottom?o=t.state.doc.content.size:(i==0||n.nodeType!=1||n.childNodes[i-1].nodeName!="BR")&&(o=_Y(t,n,i,e))}o==null&&(o=kY(t,s,e));let l=t.docView.nearestDesc(s,!0);return{pos:o,inside:l?l.posAtStart-l.border:-1}}function A3(t){return t.top<t.bottom||t.left<t.right}function Cd(t,e){let r=t.getClientRects();if(r.length){let n=r[e<0?0:r.length-1];if(A3(n))return n}return Array.prototype.find.call(r,A3)||t.getBoundingClientRect()}const EY=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function xO(t,e,r){let{node:n,offset:i,atom:a}=t.docView.domFromPos(e,r<0?-1:1),s=d0||Jo;if(n.nodeType==3)if(s&&(EY.test(n.nodeValue)||(r<0?!i:i==n.nodeValue.length))){let l=Cd(uc(n,i,i),r);if(Jo&&i&&/\s/.test(n.nodeValue[i-1])&&i<n.nodeValue.length){let u=Cd(uc(n,i-1,i-1),-1);if(u.top==l.top){let c=Cd(uc(n,i,i+1),-1);if(c.top!=l.top)return Bg(c,c.left<u.left)}}return l}else{let l=i,u=i,c=r<0?1:-1;return r<0&&!i?(u++,c=-1):r>=0&&i==n.nodeValue.length?(l--,c=1):r<0?l--:u++,Bg(Cd(uc(n,l,u),c),c<0)}if(!t.state.doc.resolve(e-(a||0)).parent.inlineContent){if(a==null&&i&&(r<0||i==Yo(n))){let l=n.childNodes[i-1];if(l.nodeType==1)return rS(l.getBoundingClientRect(),!1)}if(a==null&&i<Yo(n)){let l=n.childNodes[i];if(l.nodeType==1)return rS(l.getBoundingClientRect(),!0)}return rS(n.getBoundingClientRect(),r>=0)}if(a==null&&i&&(r<0||i==Yo(n))){let l=n.childNodes[i-1],u=l.nodeType==3?uc(l,Yo(l)-(s?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(u)return Bg(Cd(u,1),!1)}if(a==null&&i<Yo(n)){let l=n.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let u=l?l.nodeType==3?uc(l,0,s?0:1):l.nodeType==1?l:null:null;if(u)return Bg(Cd(u,-1),!0)}return Bg(Cd(n.nodeType==3?uc(n):n,-r),r>=0)}function Bg(t,e){if(t.width==0)return t;let r=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:r,right:r}}function rS(t,e){if(t.height==0)return t;let r=e?t.top:t.bottom;return{top:r,bottom:r,left:t.left,right:t.right}}function bO(t,e,r){let n=t.state,i=t.root.activeElement;n!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return r()}finally{n!=e&&t.updateState(n),i!=t.dom&&i&&i.focus()}}function TY(t,e,r){let n=e.selection,i=r=="up"?n.$from:n.$to;return bO(t,e,()=>{let{node:a}=t.docView.domFromPos(i.pos,r=="up"?-1:1);for(;;){let o=t.docView.nearestDesc(a,!0);if(!o)break;if(o.node.isBlock){a=o.contentDOM||o.dom;break}a=o.dom.parentNode}let s=xO(t,i.pos,1);for(let o=a.firstChild;o;o=o.nextSibling){let l;if(o.nodeType==1)l=o.getClientRects();else if(o.nodeType==3)l=uc(o,0,o.nodeValue.length).getClientRects();else continue;for(let u=0;u<l.length;u++){let c=l[u];if(c.bottom>c.top+1&&(r=="up"?s.top-c.top>(c.bottom-s.top)*2:c.bottom-s.bottom>(s.bottom-c.top)*2))return!1}}return!0})}const NY=/[\u0590-\u08ac]/;function PY(t,e,r){let{$head:n}=e.selection;if(!n.parent.isTextblock)return!1;let i=n.parentOffset,a=!i,s=i==n.parent.content.size,o=t.domSelection();return o?!NY.test(n.parent.textContent)||!o.modify?r=="left"||r=="backward"?a:s:bO(t,e,()=>{let{focusNode:l,focusOffset:u,anchorNode:c,anchorOffset:h}=t.domSelectionRange(),p=o.caretBidiLevel;o.modify("move",r,"character");let g=n.depth?t.docView.domAfterPos(n.before()):t.dom,{focusNode:y,focusOffset:S}=t.domSelectionRange(),w=y&&!g.contains(y.nodeType==1?y:y.parentNode)||l==y&&u==S;try{o.collapse(c,h),l&&(l!=c||u!=h)&&o.extend&&o.extend(l,u)}catch{}return p!=null&&(o.caretBidiLevel=p),w}):n.pos==n.start()||n.pos==n.end()}let L3=null,R3=null,O3=!1;function MY(t,e,r){return L3==e&&R3==r?O3:(L3=e,R3=r,O3=r=="up"||r=="down"?TY(t,e,r):PY(t,e,r))}const el=0,D3=1,rf=2,Pu=3;class h0{constructor(e,r,n,i){this.parent=e,this.children=r,this.dom=n,this.contentDOM=i,this.dirty=el,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,r,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let r=0;r<this.children.length;r++)e+=this.children[r].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let r=0,n=this.posAtStart;;r++){let i=this.children[r];if(i==e)return n;n+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,r,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){let a,s;if(e==this.contentDOM)a=e.childNodes[r-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.previousSibling}for(;a&&!((s=a.pmViewDesc)&&s.parent==this);)a=a.previousSibling;return a?this.posBeforeChild(s)+s.size:this.posAtStart}else{let a,s;if(e==this.contentDOM)a=e.childNodes[r];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.nextSibling}for(;a&&!((s=a.pmViewDesc)&&s.parent==this);)a=a.nextSibling;return a?this.posBeforeChild(s):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=r>ja(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(r==0)for(let a=e;;a=a.parentNode){if(a==this.dom){i=!1;break}if(a.previousSibling)break}if(i==null&&r==e.childNodes.length)for(let a=e;;a=a.parentNode){if(a==this.dom){i=!0;break}if(a.nextSibling)break}}return i??n>0?this.posAtEnd:this.posAtStart}nearestDesc(e,r=!1){for(let n=!0,i=e;i;i=i.parentNode){let a=this.getDesc(i),s;if(a&&(!r||a.node))if(n&&(s=a.nodeDOM)&&!(s.nodeType==1?s.contains(e.nodeType==1?e:e.parentNode):s==e))n=!1;else return a}}getDesc(e){let r=e.pmViewDesc;for(let n=r;n;n=n.parent)if(n==this)return r}posFromDOM(e,r,n){for(let i=e;i;i=i.parentNode){let a=this.getDesc(i);if(a)return a.localPosFromDOM(e,r,n)}return-1}descAt(e){for(let r=0,n=0;r<this.children.length;r++){let i=this.children[r],a=n+i.size;if(n==e&&a!=n){for(;!i.border&&i.children.length;)for(let s=0;s<i.children.length;s++){let o=i.children[s];if(o.size){i=o;break}}return i}if(e<a)return i.descAt(e-n-i.border);n=a}}domFromPos(e,r){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,i=0;for(let a=0;n<this.children.length;n++){let s=this.children[n],o=a+s.size;if(o>e||s instanceof SO){i=e-a;break}a=o}if(i)return this.children[n].domFromPos(i-this.children[n].border,r);for(let a;n&&!(a=this.children[n-1]).size&&a instanceof wO&&a.side>=0;n--);if(r<=0){let a,s=!0;for(;a=n?this.children[n-1]:null,!(!a||a.dom.parentNode==this.contentDOM);n--,s=!1);return a&&r&&s&&!a.border&&!a.domAtom?a.domFromPos(a.size,r):{node:this.contentDOM,offset:a?ja(a.dom)+1:0}}else{let a,s=!0;for(;a=n<this.children.length?this.children[n]:null,!(!a||a.dom.parentNode==this.contentDOM);n++,s=!1);return a&&s&&!a.border&&!a.domAtom?a.domFromPos(0,r):{node:this.contentDOM,offset:a?ja(a.dom):this.contentDOM.childNodes.length}}}parseRange(e,r,n=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:r,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,a=-1;for(let s=n,o=0;;o++){let l=this.children[o],u=s+l.size;if(i==-1&&e<=u){let c=s+l.border;if(e>=c&&r<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,r,c);e=s;for(let h=o;h>0;h--){let p=this.children[h-1];if(p.size&&p.dom.parentNode==this.contentDOM&&!p.emptyChildAt(1)){i=ja(p.dom)+1;break}e-=p.size}i==-1&&(i=0)}if(i>-1&&(u>r||o==this.children.length-1)){r=u;for(let c=o+1;c<this.children.length;c++){let h=this.children[c];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){a=ja(h.dom);break}r+=h.size}a==-1&&(a=this.contentDOM.childNodes.length);break}s=u}return{node:this.contentDOM,from:e,to:r,fromOffset:i,toOffset:a}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let r=this.children[e<0?0:this.children.length-1];return r.size==0||r.emptyChildAt(e)}domAfterPos(e){let{node:r,offset:n}=this.domFromPos(e,0);if(r.nodeType!=1||n==r.childNodes.length)throw new RangeError("No node after pos "+e);return r.childNodes[n]}setSelection(e,r,n,i=!1){let a=Math.min(e,r),s=Math.max(e,r);for(let g=0,y=0;g<this.children.length;g++){let S=this.children[g],w=y+S.size;if(a>y&&s<w)return S.setSelection(e-y-S.border,r-y-S.border,n,i);y=w}let o=this.domFromPos(e,e?-1:1),l=r==e?o:this.domFromPos(r,r?-1:1),u=n.root.getSelection(),c=n.domSelectionRange(),h=!1;if((Jo||Ua)&&e==r){let{node:g,offset:y}=o;if(g.nodeType==3){if(h=!!(y&&g.nodeValue[y-1]==`
`),h&&y==g.nodeValue.length)for(let S=g,w;S;S=S.parentNode){if(w=S.nextSibling){w.nodeName=="BR"&&(o=l={node:w.parentNode,offset:ja(w)+1});break}let C=S.pmViewDesc;if(C&&C.node&&C.node.isBlock)break}}else{let S=g.childNodes[y-1];h=S&&(S.nodeName=="BR"||S.contentEditable=="false")}}if(Jo&&c.focusNode&&c.focusNode!=l.node&&c.focusNode.nodeType==1){let g=c.focusNode.childNodes[c.focusOffset];g&&g.contentEditable=="false"&&(i=!0)}if(!(i||h&&Ua)&&kf(o.node,o.offset,c.anchorNode,c.anchorOffset)&&kf(l.node,l.offset,c.focusNode,c.focusOffset))return;let p=!1;if((u.extend||e==r)&&!(h&&Jo)){u.collapse(o.node,o.offset);try{e!=r&&u.extend(l.node,l.offset),p=!0}catch{}}if(!p){if(e>r){let y=o;o=l,l=y}let g=document.createRange();g.setEnd(l.node,l.offset),g.setStart(o.node,o.offset),u.removeAllRanges(),u.addRange(g)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,r){for(let n=0,i=0;i<this.children.length;i++){let a=this.children[i],s=n+a.size;if(n==s?e<=s&&r>=n:e<s&&r>n){let o=n+a.border,l=s-a.border;if(e>=o&&r<=l){this.dirty=e==n||r==s?rf:D3,e==o&&r==l&&(a.contentLost||a.dom.parentNode!=this.contentDOM)?a.dirty=Pu:a.markDirty(e-o,r-o);return}else a.dirty=a.dom==a.contentDOM&&a.dom.parentNode==this.contentDOM&&!a.children.length?rf:Pu}n=s}this.dirty=rf}markParentsDirty(){let e=1;for(let r=this.parent;r;r=r.parent,e++){let n=e==1?rf:D3;r.dirty<n&&(r.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class wO extends h0{constructor(e,r,n,i){let a,s=r.type.toDOM;if(typeof s=="function"&&(s=s(n,()=>{if(!a)return i;if(a.parent)return a.parent.posBeforeChild(a)})),!r.type.spec.raw){if(s.nodeType!=1){let o=document.createElement("span");o.appendChild(s),s=o}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(e,[],s,null),this.widget=r,this.widget=r,a=this}matchesWidget(e){return this.dirty==el&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let r=this.widget.spec.stopEvent;return r?r(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class AY extends h0{constructor(e,r,n,i){super(e,[],r,null),this.textDOM=n,this.text=i}get size(){return this.text.length}localPosFromDOM(e,r){return e!=this.textDOM?this.posAtStart+(r?this.size:0):this.posAtStart+r}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class _f extends h0{constructor(e,r,n,i,a){super(e,[],n,i),this.mark=r,this.spec=a}static create(e,r,n,i){let a=i.nodeViews[r.type.name],s=a&&a(r,i,n);return(!s||!s.dom)&&(s=Af.renderSpec(document,r.type.spec.toDOM(r,n),null,r.attrs)),new _f(e,r,s.dom,s.contentDOM||s.dom,s)}parseRule(){return this.dirty&Pu||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Pu&&this.mark.eq(e)}markDirty(e,r){if(super.markDirty(e,r),this.dirty!=el){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=el}}slice(e,r,n){let i=_f.create(this.parent,this.mark,!0,n),a=this.children,s=this.size;r<s&&(a=xk(a,r,s,n)),e>0&&(a=xk(a,0,e,n));for(let o=0;o<a.length;o++)a[o].parent=i;return i.children=a,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class $d extends h0{constructor(e,r,n,i,a,s,o,l,u){super(e,[],a,s),this.node=r,this.outerDeco=n,this.innerDeco=i,this.nodeDOM=o}static create(e,r,n,i,a,s){let o=a.nodeViews[r.type.name],l,u=o&&o(r,a,()=>{if(!l)return s;if(l.parent)return l.parent.posBeforeChild(l)},n,i),c=u&&u.dom,h=u&&u.contentDOM;if(r.isText){if(!c)c=document.createTextNode(r.text);else if(c.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else c||({dom:c,contentDOM:h}=Af.renderSpec(document,r.type.spec.toDOM(r),null,r.attrs));!h&&!r.isText&&c.nodeName!="BR"&&(c.hasAttribute("contenteditable")||(c.contentEditable="false"),r.type.spec.draggable&&(c.draggable=!0));let p=c;return c=CO(c,n,r),u?l=new LY(e,r,n,i,c,h||null,p,u,a,s+1):r.isText?new Z1(e,r,n,i,c,p,a):new $d(e,r,n,i,c,h||null,p,a,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let r=this.children.length-1;r>=0;r--){let n=this.children[r];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>ot.empty)}return e}matchesNode(e,r,n){return this.dirty==el&&e.eq(this.node)&&Mx(r,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,r){let n=this.node.inlineContent,i=r,a=e.composing?this.localCompositionInfo(e,r):null,s=a&&a.pos>-1?a:null,o=a&&a.pos<0,l=new OY(this,s&&s.node,e);jY(this.node,this.innerDeco,(u,c,h)=>{u.spec.marks?l.syncToMarks(u.spec.marks,n,e,c):u.type.side>=0&&!h&&l.syncToMarks(c==this.node.childCount?wn.none:this.node.child(c).marks,n,e,c),l.placeWidget(u,e,i)},(u,c,h,p)=>{l.syncToMarks(u.marks,n,e,p);let g;l.findNodeMatch(u,c,h,p)||o&&e.state.selection.from>i&&e.state.selection.to<i+u.nodeSize&&(g=l.findIndexWithChild(a.node))>-1&&l.updateNodeAt(u,c,h,g,e)||l.updateNextNode(u,c,h,e,p,i)||l.addNode(u,c,h,e,i),i+=u.nodeSize}),l.syncToMarks([],n,e,0),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==rf)&&(s&&this.protectLocalComposition(e,s),kO(this.contentDOM,this.children,e),Qp&&FY(this.dom))}localCompositionInfo(e,r){let{from:n,to:i}=e.state.selection;if(!(e.state.selection instanceof dr)||n<r||i>r+this.node.content.size)return null;let a=e.input.compositionNode;if(!a||!this.dom.contains(a.parentNode))return null;if(this.node.inlineContent){let s=a.nodeValue,o=BY(this.node.content,s,n-r,i-r);return o<0?null:{node:a,pos:o,text:s}}else return{node:a,pos:-1,text:""}}protectLocalComposition(e,{node:r,pos:n,text:i}){if(this.getDesc(r))return;let a=r;for(;a.parentNode!=this.contentDOM;a=a.parentNode){for(;a.previousSibling;)a.parentNode.removeChild(a.previousSibling);for(;a.nextSibling;)a.parentNode.removeChild(a.nextSibling);a.pmViewDesc&&(a.pmViewDesc=void 0)}let s=new AY(this,a,r,i);e.input.compositionNodes.push(s),this.children=xk(this.children,n,n+i.length,e,s)}update(e,r,n,i){return this.dirty==Pu||!e.sameMarkup(this.node)?!1:(this.updateInner(e,r,n,i),!0)}updateInner(e,r,n,i){this.updateOuterDeco(r),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=el}updateOuterDeco(e){if(Mx(e,this.outerDeco))return;let r=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=_O(this.dom,this.nodeDOM,yk(this.outerDeco,this.node,r),yk(e,this.node,r)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function I3(t,e,r,n,i){CO(n,e,t);let a=new $d(void 0,t,e,r,n,n,n,i,0);return a.contentDOM&&a.updateChildren(i,0),a}class Z1 extends $d{constructor(e,r,n,i,a,s,o){super(e,r,n,i,a,null,s,o,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,r,n,i){return this.dirty==Pu||this.dirty!=el&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(r),(this.dirty!=el||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=el,!0)}inParent(){let e=this.parent.contentDOM;for(let r=this.nodeDOM;r;r=r.parentNode)if(r==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,r,n){return e==this.nodeDOM?this.posAtStart+Math.min(r,this.node.text.length):super.localPosFromDOM(e,r,n)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,r,n){let i=this.node.cut(e,r),a=document.createTextNode(i.text);return new Z1(this.parent,i,this.outerDeco,this.innerDeco,a,a,n)}markDirty(e,r){super.markDirty(e,r),this.dom!=this.nodeDOM&&(e==0||r==this.nodeDOM.nodeValue.length)&&(this.dirty=Pu)}get domAtom(){return!1}isText(e){return this.node.text==e}}class SO extends h0{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==el&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class LY extends $d{constructor(e,r,n,i,a,s,o,l,u,c){super(e,r,n,i,a,s,o,u,c),this.spec=l}update(e,r,n,i){if(this.dirty==Pu)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let a=this.spec.update(e,r,n);return a&&this.updateInner(e,r,n,i),a}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,r,n,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,r,n,i){this.spec.setSelection?this.spec.setSelection(e,r,n.root):super.setSelection(e,r,n,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function kO(t,e,r){let n=t.firstChild,i=!1;for(let a=0;a<e.length;a++){let s=e[a],o=s.dom;if(o.parentNode==t){for(;o!=n;)n=j3(n),i=!0;n=n.nextSibling}else i=!0,t.insertBefore(o,n);if(s instanceof _f){let l=n?n.previousSibling:t.lastChild;kO(s.contentDOM,s.children,r),n=l?l.nextSibling:t.firstChild}}for(;n;)n=j3(n),i=!0;i&&r.trackWrites==t&&(r.trackWrites=null)}const av=function(t){t&&(this.nodeName=t)};av.prototype=Object.create(null);const nf=[new av];function yk(t,e,r){if(t.length==0)return nf;let n=r?nf[0]:new av,i=[n];for(let a=0;a<t.length;a++){let s=t[a].type.attrs;if(s){s.nodeName&&i.push(n=new av(s.nodeName));for(let o in s){let l=s[o];l!=null&&(r&&i.length==1&&i.push(n=new av(e.isInline?"span":"div")),o=="class"?n.class=(n.class?n.class+" ":"")+l:o=="style"?n.style=(n.style?n.style+";":"")+l:o!="nodeName"&&(n[o]=l))}}}return i}function _O(t,e,r,n){if(r==nf&&n==nf)return e;let i=e;for(let a=0;a<n.length;a++){let s=n[a],o=r[a];if(a){let l;o&&o.nodeName==s.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(i),o=nf[0]),i=l}RY(i,o||nf[0],s)}return i}function RY(t,e,r){for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&!(n in r)&&t.removeAttribute(n);for(let n in r)n!="class"&&n!="style"&&n!="nodeName"&&r[n]!=e[n]&&t.setAttribute(n,r[n]);if(e.class!=r.class){let n=e.class?e.class.split(" ").filter(Boolean):[],i=r.class?r.class.split(" ").filter(Boolean):[];for(let a=0;a<n.length;a++)i.indexOf(n[a])==-1&&t.classList.remove(n[a]);for(let a=0;a<i.length;a++)n.indexOf(i[a])==-1&&t.classList.add(i[a]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=r.style){if(e.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=n.exec(e.style);)t.style.removeProperty(i[1])}r.style&&(t.style.cssText+=r.style)}}function CO(t,e,r){return _O(t,t,nf,yk(e,r,t.nodeType!=1))}function Mx(t,e){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!t[r].type.eq(e[r].type))return!1;return!0}function j3(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class OY{constructor(e,r,n){this.lock=r,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=DY(e.node.content,e)}destroyBetween(e,r){if(e!=r){for(let n=e;n<r;n++)this.top.children[n].destroy();this.top.children.splice(e,r-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,r,n,i){let a=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;a<o&&(a==s-1?this.top:this.stack[a+1<<1]).matchesMark(e[a])&&e[a].type.spec.spanning!==!1;)a++;for(;a<s;)this.destroyRest(),this.top.dirty=el,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let l=-1,u=this.top.children.length;i<this.preMatch.index&&(u=Math.min(this.index+3,u));for(let c=this.index;c<u;c++){let h=this.top.children[c];if(h.matchesMark(e[s])&&!this.isLocked(h.dom)){l=c;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let c=_f.create(this.top,e[s],r,n);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,s++}}findNodeMatch(e,r,n,i){let a=-1,s;if(i>=this.preMatch.index&&(s=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&s.matchesNode(e,r,n))a=this.top.children.indexOf(s,this.index);else for(let o=this.index,l=Math.min(this.top.children.length,o+5);o<l;o++){let u=this.top.children[o];if(u.matchesNode(e,r,n)&&!this.preMatch.matched.has(u)){a=o;break}}return a<0?!1:(this.destroyBetween(this.index,a),this.index++,!0)}updateNodeAt(e,r,n,i,a){let s=this.top.children[i];return s.dirty==Pu&&s.dom==s.contentDOM&&(s.dirty=rf),s.update(e,r,n,a)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let r=e.parentNode;if(!r)return-1;if(r==this.top.contentDOM){let n=e.pmViewDesc;if(n){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==n)return i}return-1}e=r}}updateNextNode(e,r,n,i,a,s){for(let o=this.index;o<this.top.children.length;o++){let l=this.top.children[o];if(l instanceof $d){let u=this.preMatch.matched.get(l);if(u!=null&&u!=a)return!1;let c=l.dom,h,p=this.isLocked(c)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=Pu&&Mx(r,l.outerDeco));if(!p&&l.update(e,r,n,i))return this.destroyBetween(this.index,o),l.dom!=c&&(this.changed=!0),this.index++,!0;if(!p&&(h=this.recreateWrapper(l,e,r,n,i,s)))return this.destroyBetween(this.index,o),this.top.children[this.index]=h,h.contentDOM&&(h.dirty=rf,h.updateChildren(i,s+1),h.dirty=el),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,r,n,i,a,s){if(e.dirty||r.isAtom||!e.children.length||!e.node.content.eq(r.content)||!Mx(n,e.outerDeco)||!i.eq(e.innerDeco))return null;let o=$d.create(this.top,r,n,i,a,s);if(o.contentDOM){o.children=e.children,e.children=[];for(let l of o.children)l.parent=o}return e.destroy(),o}addNode(e,r,n,i,a){let s=$d.create(this.top,e,r,n,i,a);s.contentDOM&&s.updateChildren(i,a+1),this.top.children.splice(this.index++,0,s),this.changed=!0}placeWidget(e,r,n){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let a=new wO(this.top,e,r,n);this.top.children.splice(this.index++,0,a),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],r=this.top;for(;e instanceof _f;)r=e,e=r.children[r.children.length-1];(!e||!(e instanceof Z1)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Ua||pa)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",r),this.addHackNode("BR",this.top))}addHackNode(e,r){if(r==this.top&&this.index<r.children.length&&r.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);e=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),e=="BR"&&(n.className="ProseMirror-trailingBreak");let i=new SO(this.top,[],n,null);r!=this.top?r.children.push(i):r.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function DY(t,e){let r=e,n=r.children.length,i=t.childCount,a=new Map,s=[];e:for(;i>0;){let o;for(;;)if(n){let u=r.children[n-1];if(u instanceof _f)r=u,n=u.children.length;else{o=u,n--;break}}else{if(r==e)break e;n=r.parent.children.indexOf(r),r=r.parent}let l=o.node;if(l){if(l!=t.child(i-1))break;--i,a.set(o,i),s.push(o)}}return{index:i,matched:a,matches:s.reverse()}}function IY(t,e){return t.type.side-e.type.side}function jY(t,e,r,n){let i=e.locals(t),a=0;if(i.length==0){for(let u=0;u<t.childCount;u++){let c=t.child(u);n(c,i,e.forChild(a,c),u),a+=c.nodeSize}return}let s=0,o=[],l=null;for(let u=0;;){let c,h;for(;s<i.length&&i[s].to==a;){let w=i[s++];w.widget&&(c?(h||(h=[c])).push(w):c=w)}if(c)if(h){h.sort(IY);for(let w=0;w<h.length;w++)r(h[w],u,!!l)}else r(c,u,!!l);let p,g;if(l)g=-1,p=l,l=null;else if(u<t.childCount)g=u,p=t.child(u++);else break;for(let w=0;w<o.length;w++)o[w].to<=a&&o.splice(w--,1);for(;s<i.length&&i[s].from<=a&&i[s].to>a;)o.push(i[s++]);let y=a+p.nodeSize;if(p.isText){let w=y;s<i.length&&i[s].from<w&&(w=i[s].from);for(let C=0;C<o.length;C++)o[C].to<w&&(w=o[C].to);w<y&&(l=p.cut(w-a),p=p.cut(0,w-a),y=w,g=-1)}else for(;s<i.length&&i[s].to<y;)s++;let S=p.isInline&&!p.isLeaf?o.filter(w=>!w.inline):o.slice();n(p,S,e.forChild(a,p),g),a=y}}function FY(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function BY(t,e,r,n){for(let i=0,a=0;i<t.childCount&&a<=n;){let s=t.child(i++),o=a;if(a+=s.nodeSize,!s.isText)continue;let l=s.text;for(;i<t.childCount;){let u=t.child(i++);if(a+=u.nodeSize,!u.isText)break;l+=u.text}if(a>=r){if(a>=n&&l.slice(n-e.length-o,n-o)==e)return n-e.length;let u=o<n?l.lastIndexOf(e,n-o-1):-1;if(u>=0&&u+e.length+o>=r)return o+u;if(r==n&&l.length>=n+e.length-o&&l.slice(n-o,n-o+e.length)==e)return n}}return-1}function xk(t,e,r,n,i){let a=[];for(let s=0,o=0;s<t.length;s++){let l=t[s],u=o,c=o+=l.size;u>=r||c<=e?a.push(l):(u<e&&a.push(l.slice(0,e-u,n)),i&&(a.push(i),i=void 0),c>r&&a.push(l.slice(r-u,l.size,n)))}return a}function q_(t,e=null){let r=t.domSelectionRange(),n=t.state.doc;if(!r.focusNode)return null;let i=t.docView.nearestDesc(r.focusNode),a=i&&i.size==0,s=t.docView.posFromDOM(r.focusNode,r.focusOffset,1);if(s<0)return null;let o=n.resolve(s),l,u;if(K1(r)){for(l=s;i&&!i.node;)i=i.parent;let h=i.node;if(i&&h.isAtom&&Qt.isSelectable(h)&&i.parent&&!(h.isInline&&hY(r.focusNode,r.focusOffset,i.dom))){let p=i.posBefore;u=new Qt(s==p?o:n.resolve(p))}}else{if(r instanceof t.dom.ownerDocument.defaultView.Selection&&r.rangeCount>1){let h=s,p=s;for(let g=0;g<r.rangeCount;g++){let y=r.getRangeAt(g);h=Math.min(h,t.docView.posFromDOM(y.startContainer,y.startOffset,1)),p=Math.max(p,t.docView.posFromDOM(y.endContainer,y.endOffset,-1))}if(h<0)return null;[l,s]=p==t.state.selection.anchor?[p,h]:[h,p],o=n.resolve(s)}else l=t.docView.posFromDOM(r.anchorNode,r.anchorOffset,1);if(l<0)return null}let c=n.resolve(l);if(!u){let h=e=="pointer"||t.state.selection.head<o.pos&&!a?1:-1;u=$_(t,c,o,h)}return u}function EO(t){return t.editable?t.hasFocus():NO(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function gc(t,e=!1){let r=t.state.selection;if(TO(t,r),!!EO(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&pa){let n=t.domSelectionRange(),i=t.domObserver.currentSelection;if(n.anchorNode&&i.anchorNode&&kf(n.anchorNode,n.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)UY(t);else{let{anchor:n,head:i}=r,a,s;F3&&!(r instanceof dr)&&(r.$from.parent.inlineContent||(a=B3(t,r.from)),!r.empty&&!r.$from.parent.inlineContent&&(s=B3(t,r.to))),t.docView.setSelection(n,i,t,e),F3&&(a&&z3(a),s&&z3(s)),r.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&zY(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const F3=Ua||pa&&fO<63;function B3(t,e){let{node:r,offset:n}=t.docView.domFromPos(e,0),i=n<r.childNodes.length?r.childNodes[n]:null,a=n?r.childNodes[n-1]:null;if(Ua&&i&&i.contentEditable=="false")return nS(i);if((!i||i.contentEditable=="false")&&(!a||a.contentEditable=="false")){if(i)return nS(i);if(a)return nS(a)}}function nS(t){return t.contentEditable="true",Ua&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function z3(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function zY(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let r=t.domSelectionRange(),n=r.anchorNode,i=r.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(r.anchorNode!=n||r.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!EO(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function UY(t){let e=t.domSelection();if(!e)return;let r=t.cursorWrapper.dom,n=r.nodeName=="IMG";n?e.collapse(r.parentNode,ja(r)+1):e.collapse(r,0),!n&&!t.state.selection.visible&&Xs&&qd<=11&&(r.disabled=!0,r.disabled=!1)}function TO(t,e){if(e instanceof Qt){let r=t.docView.descAt(e.from);r!=t.lastSelectedViewDesc&&(U3(t),r&&r.selectNode(),t.lastSelectedViewDesc=r)}else U3(t)}function U3(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function $_(t,e,r,n){return t.someProp("createSelectionBetween",i=>i(t,e,r))||dr.between(e,r,n)}function G3(t){return t.editable&&!t.hasFocus()?!1:NO(t)}function NO(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function GY(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),r=t.domSelectionRange();return kf(e.node,e.offset,r.anchorNode,r.anchorOffset)}function bk(t,e){let{$anchor:r,$head:n}=t.selection,i=e>0?r.max(n):r.min(n),a=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return a&&Sr.findFrom(a,e)}function Td(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function V3(t,e,r){let n=t.state.selection;if(n instanceof dr)if(r.indexOf("s")>-1){let{$head:i}=n,a=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!a||a.isText||!a.isLeaf)return!1;let s=t.state.doc.resolve(i.pos+a.nodeSize*(e<0?-1:1));return Td(t,new dr(n.$anchor,s))}else if(n.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=bk(t.state,e);return i&&i instanceof Qt?Td(t,i):!1}else if(!(Ko&&r.indexOf("m")>-1)){let i=n.$head,a=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,s;if(!a||a.isText)return!1;let o=e<0?i.pos-a.nodeSize:i.pos;return a.isAtom||(s=t.docView.descAt(o))&&!s.contentDOM?Qt.isSelectable(a)?Td(t,new Qt(e<0?t.state.doc.resolve(i.pos-a.nodeSize):i)):d0?Td(t,new dr(t.state.doc.resolve(e<0?o:o+a.nodeSize))):!1:!1}}else return!1;else{if(n instanceof Qt&&n.node.isInline)return Td(t,new dr(e>0?n.$to:n.$from));{let i=bk(t.state,e);return i?Td(t,i):!1}}}function Ax(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function sv(t,e){let r=t.pmViewDesc;return r&&r.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function _p(t,e){return e<0?VY(t):HY(t)}function VY(t){let e=t.domSelectionRange(),r=e.focusNode,n=e.focusOffset;if(!r)return;let i,a,s=!1;for(Jo&&r.nodeType==1&&n<Ax(r)&&sv(r.childNodes[n],-1)&&(s=!0);;)if(n>0){if(r.nodeType!=1)break;{let o=r.childNodes[n-1];if(sv(o,-1))i=r,a=--n;else if(o.nodeType==3)r=o,n=r.nodeValue.length;else break}}else{if(PO(r))break;{let o=r.previousSibling;for(;o&&sv(o,-1);)i=r.parentNode,a=ja(o),o=o.previousSibling;if(o)r=o,n=Ax(r);else{if(r=r.parentNode,r==t.dom)break;n=0}}}s?wk(t,r,n):i&&wk(t,i,a)}function HY(t){let e=t.domSelectionRange(),r=e.focusNode,n=e.focusOffset;if(!r)return;let i=Ax(r),a,s;for(;;)if(n<i){if(r.nodeType!=1)break;let o=r.childNodes[n];if(sv(o,1))a=r,s=++n;else break}else{if(PO(r))break;{let o=r.nextSibling;for(;o&&sv(o,1);)a=o.parentNode,s=ja(o)+1,o=o.nextSibling;if(o)r=o,n=0,i=Ax(r);else{if(r=r.parentNode,r==t.dom)break;n=i=0}}}a&&wk(t,a,s)}function PO(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function WY(t,e){for(;t&&e==t.childNodes.length&&!c0(t);)e=ja(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let r=t.childNodes[e];if(r.nodeType==3)return r;if(r.nodeType==1&&r.contentEditable=="false")break;t=r,e=0}}function qY(t,e){for(;t&&!e&&!c0(t);)e=ja(t),t=t.parentNode;for(;t&&e;){let r=t.childNodes[e-1];if(r.nodeType==3)return r;if(r.nodeType==1&&r.contentEditable=="false")break;t=r,e=t.childNodes.length}}function wk(t,e,r){if(e.nodeType!=3){let a,s;(s=WY(e,r))?(e=s,r=0):(a=qY(e,r))&&(e=a,r=a.nodeValue.length)}let n=t.domSelection();if(!n)return;if(K1(n)){let a=document.createRange();a.setEnd(e,r),a.setStart(e,r),n.removeAllRanges(),n.addRange(a)}else n.extend&&n.extend(e,r);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&gc(t)},50)}function H3(t,e){let r=t.state.doc.resolve(e);if(!(pa||pO)&&r.parent.inlineContent){let i=t.coordsAtPos(e);if(e>r.start()){let a=t.coordsAtPos(e-1),s=(a.top+a.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(a.left-i.left)>1)return a.left<i.left?"ltr":"rtl"}if(e<r.end()){let a=t.coordsAtPos(e+1),s=(a.top+a.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(a.left-i.left)>1)return a.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function W3(t,e,r){let n=t.state.selection;if(n instanceof dr&&!n.empty||r.indexOf("s")>-1||Ko&&r.indexOf("m")>-1)return!1;let{$from:i,$to:a}=n;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let s=bk(t.state,e);if(s&&s instanceof Qt)return Td(t,s)}if(!i.parent.inlineContent){let s=e<0?i:a,o=n instanceof yo?Sr.near(s,e):Sr.findFrom(s,e);return o?Td(t,o):!1}return!1}function q3(t,e){if(!(t.state.selection instanceof dr))return!0;let{$head:r,$anchor:n,empty:i}=t.state.selection;if(!r.sameParent(n))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let a=!r.textOffset&&(e<0?r.nodeBefore:r.nodeAfter);if(a&&!a.isText){let s=t.state.tr;return e<0?s.delete(r.pos-a.nodeSize,r.pos):s.delete(r.pos,r.pos+a.nodeSize),t.dispatch(s),!0}return!1}function $3(t,e,r){t.domObserver.stop(),e.contentEditable=r,t.domObserver.start()}function $Y(t){if(!Ua||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:r}=t.domSelectionRange();if(e&&e.nodeType==1&&r==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let n=e.firstChild;$3(t,n,"true"),setTimeout(()=>$3(t,n,"false"),20)}return!1}function KY(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function ZY(t,e){let r=e.keyCode,n=KY(e);if(r==8||Ko&&r==72&&n=="c")return q3(t,-1)||_p(t,-1);if(r==46&&!e.shiftKey||Ko&&r==68&&n=="c")return q3(t,1)||_p(t,1);if(r==13||r==27)return!0;if(r==37||Ko&&r==66&&n=="c"){let i=r==37?H3(t,t.state.selection.from)=="ltr"?-1:1:-1;return V3(t,i,n)||_p(t,i)}else if(r==39||Ko&&r==70&&n=="c"){let i=r==39?H3(t,t.state.selection.from)=="ltr"?1:-1:1;return V3(t,i,n)||_p(t,i)}else{if(r==38||Ko&&r==80&&n=="c")return W3(t,-1,n)||_p(t,-1);if(r==40||Ko&&r==78&&n=="c")return $Y(t)||W3(t,1,n)||_p(t,1);if(n==(Ko?"m":"c")&&(r==66||r==73||r==89||r==90))return!0}return!1}function K_(t,e){t.someProp("transformCopied",g=>{e=g(e,t)});let r=[],{content:n,openStart:i,openEnd:a}=e;for(;i>1&&a>1&&n.childCount==1&&n.firstChild.childCount==1;){i--,a--;let g=n.firstChild;r.push(g.type.name,g.attrs!=g.type.defaultAttrs?g.attrs:null),n=g.content}let s=t.someProp("clipboardSerializer")||Af.fromSchema(t.state.schema),o=DO(),l=o.createElement("div");l.appendChild(s.serializeFragment(n,{document:o}));let u=l.firstChild,c,h=0;for(;u&&u.nodeType==1&&(c=OO[u.nodeName.toLowerCase()]);){for(let g=c.length-1;g>=0;g--){let y=o.createElement(c[g]);for(;l.firstChild;)y.appendChild(l.firstChild);l.appendChild(y),h++}u=l.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${i} ${a}${h?` -${h}`:""} ${JSON.stringify(r)}`);let p=t.someProp("clipboardTextSerializer",g=>g(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:p,slice:e}}function MO(t,e,r,n,i){let a=i.parent.type.spec.code,s,o;if(!r&&!e)return null;let l=!!e&&(n||a||!r);if(l){if(t.someProp("transformPastedText",p=>{e=p(e,a||n,t)}),a)return o=new Ot(ot.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",p=>{o=p(o,t,!0)}),o;let h=t.someProp("clipboardTextParser",p=>p(e,i,n,t));if(h)o=h;else{let p=i.marks(),{schema:g}=t.state,y=Af.fromSchema(g);s=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(S=>{let w=s.appendChild(document.createElement("p"));S&&w.appendChild(y.serializeNode(g.text(S,p)))})}}else t.someProp("transformPastedHTML",h=>{r=h(r,t)}),s=JY(r),d0&&eX(s);let u=s&&s.querySelector("[data-pm-slice]"),c=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(c&&c[3])for(let h=+c[3];h>0;h--){let p=s.firstChild;for(;p&&p.nodeType!=1;)p=p.nextSibling;if(!p)break;s=p}if(o||(o=(t.someProp("clipboardParser")||t.someProp("domParser")||Wd.fromSchema(t.state.schema)).parseSlice(s,{preserveWhitespace:!!(l||c),context:i,ruleFromNode(p){return p.nodeName=="BR"&&!p.nextSibling&&p.parentNode&&!YY.test(p.parentNode.nodeName)?{ignore:!0}:null}})),c)o=tX(K3(o,+c[1],+c[2]),c[4]);else if(o=Ot.maxOpen(XY(o.content,i),!0),o.openStart||o.openEnd){let h=0,p=0;for(let g=o.content.firstChild;h<o.openStart&&!g.type.spec.isolating;h++,g=g.firstChild);for(let g=o.content.lastChild;p<o.openEnd&&!g.type.spec.isolating;p++,g=g.lastChild);o=K3(o,h,p)}return t.someProp("transformPasted",h=>{o=h(o,t,l)}),o}const YY=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function XY(t,e){if(t.childCount<2)return t;for(let r=e.depth;r>=0;r--){let i=e.node(r).contentMatchAt(e.index(r)),a,s=[];if(t.forEach(o=>{if(!s)return;let l=i.findWrapping(o.type),u;if(!l)return s=null;if(u=s.length&&a.length&&LO(l,a,o,s[s.length-1],0))s[s.length-1]=u;else{s.length&&(s[s.length-1]=RO(s[s.length-1],a.length));let c=AO(o,l);s.push(c),i=i.matchType(c.type),a=l}}),s)return ot.from(s)}return t}function AO(t,e,r=0){for(let n=e.length-1;n>=r;n--)t=e[n].create(null,ot.from(t));return t}function LO(t,e,r,n,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let a=LO(t,e,r,n.lastChild,i+1);if(a)return n.copy(n.content.replaceChild(n.childCount-1,a));if(n.contentMatchAt(n.childCount).matchType(i==t.length-1?r.type:t[i+1]))return n.copy(n.content.append(ot.from(AO(r,t,i+1))))}}function RO(t,e){if(e==0)return t;let r=t.content.replaceChild(t.childCount-1,RO(t.lastChild,e-1)),n=t.contentMatchAt(t.childCount).fillBefore(ot.empty,!0);return t.copy(r.append(n))}function Sk(t,e,r,n,i,a){let s=e<0?t.firstChild:t.lastChild,o=s.content;return t.childCount>1&&(a=0),i<n-1&&(o=Sk(o,e,r,n,i+1,a)),i>=r&&(o=e<0?s.contentMatchAt(0).fillBefore(o,a<=i).append(o):o.append(s.contentMatchAt(s.childCount).fillBefore(ot.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(o))}function K3(t,e,r){return e<t.openStart&&(t=new Ot(Sk(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),r<t.openEnd&&(t=new Ot(Sk(t.content,1,r,t.openEnd,0,0),t.openStart,r)),t}const OO={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Z3=null;function DO(){return Z3||(Z3=document.implementation.createHTMLDocument("title"))}let iS=null;function QY(t){let e=window.trustedTypes;return e?(iS||(iS=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:r=>r})),iS.createHTML(t)):t}function JY(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let r=DO().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(t),i;if((i=n&&OO[n[1].toLowerCase()])&&(t=i.map(a=>"<"+a+">").join("")+t+i.map(a=>"</"+a+">").reverse().join("")),r.innerHTML=QY(t),i)for(let a=0;a<i.length;a++)r=r.querySelector(i[a])||r;return r}function eX(t){let e=t.querySelectorAll(pa?"span:not([class]):not([style])":"span.Apple-converted-space");for(let r=0;r<e.length;r++){let n=e[r];n.childNodes.length==1&&n.textContent==""&&n.parentNode&&n.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),n)}}function tX(t,e){if(!t.size)return t;let r=t.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch{return t}let{content:i,openStart:a,openEnd:s}=t;for(let o=n.length-2;o>=0;o-=2){let l=r.nodes[n[o]];if(!l||l.hasRequiredAttrs())break;i=ot.from(l.create(n[o+1],i)),a++,s++}return new Ot(i,a,s)}const Ts={},Ns={},rX={touchstart:!0,touchmove:!0};class nX{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.badSafariComposition=!1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function iX(t){for(let e in Ts){let r=Ts[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=n=>{sX(t,n)&&!Z_(t,n)&&(t.editable||!(n.type in Ns))&&r(t,n)},rX[e]?{passive:!0}:void 0)}Ua&&t.dom.addEventListener("input",()=>null),kk(t)}function Bd(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function aX(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function kk(t){t.someProp("handleDOMEvents",e=>{for(let r in e)t.input.eventHandlers[r]||t.dom.addEventListener(r,t.input.eventHandlers[r]=n=>Z_(t,n))})}function Z_(t,e){return t.someProp("handleDOMEvents",r=>{let n=r[e.type];return n?n(t,e)||e.defaultPrevented:!1})}function sX(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let r=e.target;r!=t.dom;r=r.parentNode)if(!r||r.nodeType==11||r.pmViewDesc&&r.pmViewDesc.stopEvent(e))return!1;return!0}function oX(t,e){!Z_(t,e)&&Ts[e.type]&&(t.editable||!(e.type in Ns))&&Ts[e.type](t,e)}Ns.keydown=(t,e)=>{let r=e;if(t.input.shiftKey=r.keyCode==16||r.shiftKey,!jO(t,r)&&(t.input.lastKeyCode=r.keyCode,t.input.lastKeyCodeTime=Date.now(),!(fc&&pa&&r.keyCode==13)))if(r.keyCode!=229&&t.domObserver.forceFlush(),Qp&&r.keyCode==13&&!r.ctrlKey&&!r.altKey&&!r.metaKey){let n=Date.now();t.input.lastIOSEnter=n,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==n&&(t.someProp("handleKeyDown",i=>i(t,Jh(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",n=>n(t,r))||ZY(t,r)?r.preventDefault():Bd(t,"key")};Ns.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Ns.keypress=(t,e)=>{let r=e;if(jO(t,r)||!r.charCode||r.ctrlKey&&!r.altKey||Ko&&r.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,r))){r.preventDefault();return}let n=t.state.selection;if(!(n instanceof dr)||!n.$from.sameParent(n.$to)){let i=String.fromCharCode(r.charCode),a=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",s=>s(t,n.$from.pos,n.$to.pos,i,a))&&t.dispatch(a()),r.preventDefault()}};function Y1(t){return{left:t.clientX,top:t.clientY}}function lX(t,e){let r=e.x-t.clientX,n=e.y-t.clientY;return r*r+n*n<100}function Y_(t,e,r,n,i){if(n==-1)return!1;let a=t.state.doc.resolve(n);for(let s=a.depth+1;s>0;s--)if(t.someProp(e,o=>s>a.depth?o(t,r,a.nodeAfter,a.before(s),i,!0):o(t,r,a.node(s),a.before(s),i,!1)))return!0;return!1}function Vp(t,e,r){if(t.focused||t.focus(),t.state.selection.eq(e))return;let n=t.state.tr.setSelection(e);n.setMeta("pointer",!0),t.dispatch(n)}function uX(t,e){if(e==-1)return!1;let r=t.state.doc.resolve(e),n=r.nodeAfter;return n&&n.isAtom&&Qt.isSelectable(n)?(Vp(t,new Qt(r)),!0):!1}function cX(t,e){if(e==-1)return!1;let r=t.state.selection,n,i;r instanceof Qt&&(n=r.node);let a=t.state.doc.resolve(e);for(let s=a.depth+1;s>0;s--){let o=s>a.depth?a.nodeAfter:a.node(s);if(Qt.isSelectable(o)){n&&r.$from.depth>0&&s>=r.$from.depth&&a.before(r.$from.depth+1)==r.$from.pos?i=a.before(r.$from.depth):i=a.before(s);break}}return i!=null?(Vp(t,Qt.create(t.state.doc,i)),!0):!1}function dX(t,e,r,n,i){return Y_(t,"handleClickOn",e,r,n)||t.someProp("handleClick",a=>a(t,e,n))||(i?cX(t,r):uX(t,r))}function hX(t,e,r,n){return Y_(t,"handleDoubleClickOn",e,r,n)||t.someProp("handleDoubleClick",i=>i(t,e,n))}function fX(t,e,r,n){return Y_(t,"handleTripleClickOn",e,r,n)||t.someProp("handleTripleClick",i=>i(t,e,n))||pX(t,r,n)}function pX(t,e,r){if(r.button!=0)return!1;let n=t.state.doc;if(e==-1)return n.inlineContent?(Vp(t,dr.create(n,0,n.content.size)),!0):!1;let i=n.resolve(e);for(let a=i.depth+1;a>0;a--){let s=a>i.depth?i.nodeAfter:i.node(a),o=i.before(a);if(s.inlineContent)Vp(t,dr.create(n,o+1,o+1+s.content.size));else if(Qt.isSelectable(s))Vp(t,Qt.create(n,o));else continue;return!0}}function X_(t){return Lx(t)}const IO=Ko?"metaKey":"ctrlKey";Ts.mousedown=(t,e)=>{let r=e;t.input.shiftKey=r.shiftKey;let n=X_(t),i=Date.now(),a="singleClick";i-t.input.lastClick.time<500&&lX(r,t.input.lastClick)&&!r[IO]&&t.input.lastClick.button==r.button&&(t.input.lastClick.type=="singleClick"?a="doubleClick":t.input.lastClick.type=="doubleClick"&&(a="tripleClick")),t.input.lastClick={time:i,x:r.clientX,y:r.clientY,type:a,button:r.button};let s=t.posAtCoords(Y1(r));s&&(a=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new mX(t,s,r,!!n)):(a=="doubleClick"?hX:fX)(t,s.pos,s.inside,r)?r.preventDefault():Bd(t,"pointer"))};class mX{constructor(e,r,n,i){this.view=e,this.pos=r,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[IO],this.allowDefault=n.shiftKey;let a,s;if(r.inside>-1)a=e.state.doc.nodeAt(r.inside),s=r.inside;else{let c=e.state.doc.resolve(r.pos);a=c.parent,s=c.depth?c.before():0}const o=i?null:n.target,l=o?e.docView.nearestDesc(o,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:u}=e.state;(n.button==0&&a.type.spec.draggable&&a.type.spec.selectable!==!1||u instanceof Qt&&u.from<=s&&u.to>s)&&(this.mightDrag={node:a,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Jo&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Bd(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>gc(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let r=this.pos;this.view.state.doc!=this.startDoc&&(r=this.view.posAtCoords(Y1(e))),this.updateAllowDefault(e),this.allowDefault||!r?Bd(this.view,"pointer"):dX(this.view,r.pos,r.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Ua&&this.mightDrag&&!this.mightDrag.node.isAtom||pa&&!this.view.state.selection.visible&&Math.min(Math.abs(r.pos-this.view.state.selection.from),Math.abs(r.pos-this.view.state.selection.to))<=2)?(Vp(this.view,Sr.near(this.view.state.doc.resolve(r.pos))),e.preventDefault()):Bd(this.view,"pointer")}move(e){this.updateAllowDefault(e),Bd(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Ts.touchstart=t=>{t.input.lastTouch=Date.now(),X_(t),Bd(t,"pointer")};Ts.touchmove=t=>{t.input.lastTouch=Date.now(),Bd(t,"pointer")};Ts.contextmenu=t=>X_(t);function jO(t,e){return t.composing?!0:Ua&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const gX=fc?5e3:-1;Ns.compositionstart=Ns.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,r=e.selection.$to;if(e.selection instanceof dr&&(e.storedMarks||!r.textOffset&&r.parentOffset&&r.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)||pa&&pO&&vX(t)))t.markCursor=t.state.storedMarks||r.marks(),Lx(t,!0),t.markCursor=null;else if(Lx(t,!e.selection.empty),Jo&&e.selection.empty&&r.parentOffset&&!r.textOffset&&r.nodeBefore.marks.length){let n=t.domSelectionRange();for(let i=n.focusNode,a=n.focusOffset;i&&i.nodeType==1&&a!=0;){let s=a<0?i.lastChild:i.childNodes[a-1];if(!s)break;if(s.nodeType==3){let o=t.domSelection();o&&o.collapse(s,s.nodeValue.length);break}else i=s,a=-1}}t.input.composing=!0}FO(t,gX)};function vX(t){let{focusNode:e,focusOffset:r}=t.domSelectionRange();if(!e||e.nodeType!=1||r>=e.childNodes.length)return!1;let n=e.childNodes[r];return n.nodeType==1&&n.contentEditable=="false"}Ns.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.badSafariComposition?t.domObserver.forceFlush():t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,FO(t,20))};function FO(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Lx(t),e))}function BO(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=xX());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function yX(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let r=cY(e.focusNode,e.focusOffset),n=dY(e.focusNode,e.focusOffset);if(r&&n&&r!=n){let i=n.pmViewDesc,a=t.domObserver.lastChangedTextNode;if(r==a||n==a)return a;if(!i||!i.isText(n.nodeValue))return n;if(t.input.compositionNode==n){let s=r.pmViewDesc;if(!(!s||!s.isText(r.nodeValue)))return n}}return r||n}function xX(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Lx(t,e=!1){if(!(fc&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),BO(t),e||t.docView&&t.docView.dirty){let r=q_(t),n=t.state.selection;return r&&!r.eq(n)?t.dispatch(t.state.tr.setSelection(r)):(t.markCursor||e)&&!n.$from.node(n.$from.sharedDepth(n.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function bX(t,e){if(!t.dom.parentNode)return;let r=t.dom.parentNode.appendChild(document.createElement("div"));r.appendChild(e),r.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),n.removeAllRanges(),n.addRange(i),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r),t.focus()},50)}const Iv=Xs&&qd<15||Qp&&mY<604;Ts.copy=Ns.cut=(t,e)=>{let r=e,n=t.state.selection,i=r.type=="cut";if(n.empty)return;let a=Iv?null:r.clipboardData,s=n.content(),{dom:o,text:l}=K_(t,s);a?(r.preventDefault(),a.clearData(),a.setData("text/html",o.innerHTML),a.setData("text/plain",l)):bX(t,o),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function wX(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function SX(t,e){if(!t.dom.parentNode)return;let r=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,n=t.dom.parentNode.appendChild(document.createElement(r?"textarea":"div"));r||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),n.parentNode&&n.parentNode.removeChild(n),r?jv(t,n.value,null,i,e):jv(t,n.textContent,n.innerHTML,i,e)},50)}function jv(t,e,r,n,i){let a=MO(t,e,r,n,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,a||Ot.empty)))return!0;if(!a)return!1;let s=wX(a),o=s?t.state.tr.replaceSelectionWith(s,n):t.state.tr.replaceSelection(a);return t.dispatch(o.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function zO(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let r=t.getData("text/uri-list");return r?r.replace(/\r?\n/g," "):""}Ns.paste=(t,e)=>{let r=e;if(t.composing&&!fc)return;let n=Iv?null:r.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;n&&jv(t,zO(n),n.getData("text/html"),i,r)?r.preventDefault():SX(t,r)};class UO{constructor(e,r,n){this.slice=e,this.move=r,this.node=n}}const kX=Ko?"altKey":"ctrlKey";function GO(t,e){let r=t.someProp("dragCopies",n=>!n(e));return r??!e[kX]}Ts.dragstart=(t,e)=>{let r=e,n=t.input.mouseDown;if(n&&n.done(),!r.dataTransfer)return;let i=t.state.selection,a=i.empty?null:t.posAtCoords(Y1(r)),s;if(!(a&&a.pos>=i.from&&a.pos<=(i instanceof Qt?i.to-1:i.to))){if(n&&n.mightDrag)s=Qt.create(t.state.doc,n.mightDrag.pos);else if(r.target&&r.target.nodeType==1){let h=t.docView.nearestDesc(r.target,!0);h&&h.node.type.spec.draggable&&h!=t.docView&&(s=Qt.create(t.state.doc,h.posBefore))}}let o=(s||t.state.selection).content(),{dom:l,text:u,slice:c}=K_(t,o);(!r.dataTransfer.files.length||!pa||fO>120)&&r.dataTransfer.clearData(),r.dataTransfer.setData(Iv?"Text":"text/html",l.innerHTML),r.dataTransfer.effectAllowed="copyMove",Iv||r.dataTransfer.setData("text/plain",u),t.dragging=new UO(c,GO(t,r),s)};Ts.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Ns.dragover=Ns.dragenter=(t,e)=>e.preventDefault();Ns.drop=(t,e)=>{try{_X(t,e,t.dragging)}finally{t.dragging=null}};function _X(t,e,r){if(!e.dataTransfer)return;let n=t.posAtCoords(Y1(e));if(!n)return;let i=t.state.doc.resolve(n.pos),a=r&&r.slice;a?t.someProp("transformPasted",g=>{a=g(a,t,!1)}):a=MO(t,zO(e.dataTransfer),Iv?null:e.dataTransfer.getData("text/html"),!1,i);let s=!!(r&&GO(t,e));if(t.someProp("handleDrop",g=>g(t,e,a||Ot.empty,s))){e.preventDefault();return}if(!a)return;e.preventDefault();let o=a?qR(t.state.doc,i.pos,a):i.pos;o==null&&(o=i.pos);let l=t.state.tr;if(s){let{node:g}=r;g?g.replace(l):l.deleteSelection()}let u=l.mapping.map(o),c=a.openStart==0&&a.openEnd==0&&a.content.childCount==1,h=l.doc;if(c?l.replaceRangeWith(u,u,a.content.firstChild):l.replaceRange(u,u,a),l.doc.eq(h))return;let p=l.doc.resolve(u);if(c&&Qt.isSelectable(a.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(a.content.firstChild))l.setSelection(new Qt(p));else{let g=l.mapping.map(o);l.mapping.maps[l.mapping.maps.length-1].forEach((y,S,w,C)=>g=C),l.setSelection($_(t,p,l.doc.resolve(g)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}Ts.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&gc(t)},20))};Ts.blur=(t,e)=>{let r=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),r.relatedTarget&&t.dom.contains(r.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Ts.beforeinput=(t,e)=>{if(pa&&fc&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:n}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=n||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",a=>a(t,Jh(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in Ns)Ts[t]=Ns[t];function Fv(t,e){if(t==e)return!0;for(let r in t)if(t[r]!==e[r])return!1;for(let r in e)if(!(r in t))return!1;return!0}class Rx{constructor(e,r){this.toDOM=e,this.spec=r||uf,this.side=this.spec.side||0}map(e,r,n,i){let{pos:a,deleted:s}=e.mapResult(r.from+i,this.side<0?-1:1);return s?null:new as(a-n,a-n,this)}valid(){return!0}eq(e){return this==e||e instanceof Rx&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Fv(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Kd{constructor(e,r){this.attrs=e,this.spec=r||uf}map(e,r,n,i){let a=e.map(r.from+i,this.spec.inclusiveStart?-1:1)-n,s=e.map(r.to+i,this.spec.inclusiveEnd?1:-1)-n;return a>=s?null:new as(a,s,this)}valid(e,r){return r.from<r.to}eq(e){return this==e||e instanceof Kd&&Fv(this.attrs,e.attrs)&&Fv(this.spec,e.spec)}static is(e){return e.type instanceof Kd}destroy(){}}class Q_{constructor(e,r){this.attrs=e,this.spec=r||uf}map(e,r,n,i){let a=e.mapResult(r.from+i,1);if(a.deleted)return null;let s=e.mapResult(r.to+i,-1);return s.deleted||s.pos<=a.pos?null:new as(a.pos-n,s.pos-n,this)}valid(e,r){let{index:n,offset:i}=e.content.findIndex(r.from),a;return i==r.from&&!(a=e.child(n)).isText&&i+a.nodeSize==r.to}eq(e){return this==e||e instanceof Q_&&Fv(this.attrs,e.attrs)&&Fv(this.spec,e.spec)}destroy(){}}class as{constructor(e,r,n){this.from=e,this.to=r,this.type=n}copy(e,r){return new as(e,r,this.type)}eq(e,r=0){return this.type.eq(e.type)&&this.from+r==e.from&&this.to+r==e.to}map(e,r,n){return this.type.map(e,this,r,n)}static widget(e,r,n){return new as(e,e,new Rx(r,n))}static inline(e,r,n,i){return new as(e,r,new Kd(n,i))}static node(e,r,n,i){return new as(e,r,new Q_(n,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Kd}get widget(){return this.type instanceof Rx}}const Np=[],uf={};class $n{constructor(e,r){this.local=e.length?e:Np,this.children=r.length?r:Np}static create(e,r){return r.length?Ox(r,e,0,uf):is}find(e,r,n){let i=[];return this.findInner(e??0,r??1e9,i,0,n),i}findInner(e,r,n,i,a){for(let s=0;s<this.local.length;s++){let o=this.local[s];o.from<=r&&o.to>=e&&(!a||a(o.spec))&&n.push(o.copy(o.from+i,o.to+i))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<r&&this.children[s+1]>e){let o=this.children[s]+1;this.children[s+2].findInner(e-o,r-o,n,i+o,a)}}map(e,r,n){return this==is||e.maps.length==0?this:this.mapInner(e,r,0,0,n||uf)}mapInner(e,r,n,i,a){let s;for(let o=0;o<this.local.length;o++){let l=this.local[o].map(e,n,i);l&&l.type.valid(r,l)?(s||(s=[])).push(l):a.onRemove&&a.onRemove(this.local[o].spec)}return this.children.length?CX(this.children,s||[],e,r,n,i,a):s?new $n(s.sort(cf),Np):is}add(e,r){return r.length?this==is?$n.create(e,r):this.addInner(e,r,0):this}addInner(e,r,n){let i,a=0;e.forEach((o,l)=>{let u=l+n,c;if(c=HO(r,o,u)){for(i||(i=this.children.slice());a<i.length&&i[a]<l;)a+=3;i[a]==l?i[a+2]=i[a+2].addInner(o,c,u+1):i.splice(a,0,l,l+o.nodeSize,Ox(c,o,u+1,uf)),a+=3}});let s=VO(a?WO(r):r,-n);for(let o=0;o<s.length;o++)s[o].type.valid(e,s[o])||s.splice(o--,1);return new $n(s.length?this.local.concat(s).sort(cf):this.local,i||this.children)}remove(e){return e.length==0||this==is?this:this.removeInner(e,0)}removeInner(e,r){let n=this.children,i=this.local;for(let a=0;a<n.length;a+=3){let s,o=n[a]+r,l=n[a+1]+r;for(let c=0,h;c<e.length;c++)(h=e[c])&&h.from>o&&h.to<l&&(e[c]=null,(s||(s=[])).push(h));if(!s)continue;n==this.children&&(n=this.children.slice());let u=n[a+2].removeInner(s,o+1);u!=is?n[a+2]=u:(n.splice(a,3),a-=3)}if(i.length){for(let a=0,s;a<e.length;a++)if(s=e[a])for(let o=0;o<i.length;o++)i[o].eq(s,r)&&(i==this.local&&(i=this.local.slice()),i.splice(o--,1))}return n==this.children&&i==this.local?this:i.length||n.length?new $n(i,n):is}forChild(e,r){if(this==is)return this;if(r.isLeaf)return $n.empty;let n,i;for(let o=0;o<this.children.length;o+=3)if(this.children[o]>=e){this.children[o]==e&&(n=this.children[o+2]);break}let a=e+1,s=a+r.content.size;for(let o=0;o<this.local.length;o++){let l=this.local[o];if(l.from<s&&l.to>a&&l.type instanceof Kd){let u=Math.max(a,l.from)-a,c=Math.min(s,l.to)-a;u<c&&(i||(i=[])).push(l.copy(u,c))}}if(i){let o=new $n(i.sort(cf),Np);return n?new Md([o,n]):o}return n||is}eq(e){if(this==e)return!0;if(!(e instanceof $n)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let r=0;r<this.local.length;r++)if(!this.local[r].eq(e.local[r]))return!1;for(let r=0;r<this.children.length;r+=3)if(this.children[r]!=e.children[r]||this.children[r+1]!=e.children[r+1]||!this.children[r+2].eq(e.children[r+2]))return!1;return!0}locals(e){return J_(this.localsInner(e))}localsInner(e){if(this==is)return Np;if(e.inlineContent||!this.local.some(Kd.is))return this.local;let r=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof Kd||r.push(this.local[n]);return r}forEachSet(e){e(this)}}$n.empty=new $n([],[]);$n.removeOverlap=J_;const is=$n.empty;class Md{constructor(e){this.members=e}map(e,r){const n=this.members.map(i=>i.map(e,r,uf));return Md.from(n)}forChild(e,r){if(r.isLeaf)return $n.empty;let n=[];for(let i=0;i<this.members.length;i++){let a=this.members[i].forChild(e,r);a!=is&&(a instanceof Md?n=n.concat(a.members):n.push(a))}return Md.from(n)}eq(e){if(!(e instanceof Md)||e.members.length!=this.members.length)return!1;for(let r=0;r<this.members.length;r++)if(!this.members[r].eq(e.members[r]))return!1;return!0}locals(e){let r,n=!0;for(let i=0;i<this.members.length;i++){let a=this.members[i].localsInner(e);if(a.length)if(!r)r=a;else{n&&(r=r.slice(),n=!1);for(let s=0;s<a.length;s++)r.push(a[s])}}return r?J_(n?r:r.sort(cf)):Np}static from(e){switch(e.length){case 0:return is;case 1:return e[0];default:return new Md(e.every(r=>r instanceof $n)?e:e.reduce((r,n)=>r.concat(n instanceof $n?n:n.members),[]))}}forEachSet(e){for(let r=0;r<this.members.length;r++)this.members[r].forEachSet(e)}}function CX(t,e,r,n,i,a,s){let o=t.slice();for(let u=0,c=a;u<r.maps.length;u++){let h=0;r.maps[u].forEach((p,g,y,S)=>{let w=S-y-(g-p);for(let C=0;C<o.length;C+=3){let _=o[C+1];if(_<0||p>_+c-h)continue;let T=o[C]+c-h;g>=T?o[C+1]=p<=T?-2:-1:p>=c&&w&&(o[C]+=w,o[C+1]+=w)}h+=w}),c=r.maps[u].map(c,-1)}let l=!1;for(let u=0;u<o.length;u+=3)if(o[u+1]<0){if(o[u+1]==-2){l=!0,o[u+1]=-1;continue}let c=r.map(t[u]+a),h=c-i;if(h<0||h>=n.content.size){l=!0;continue}let p=r.map(t[u+1]+a,-1),g=p-i,{index:y,offset:S}=n.content.findIndex(h),w=n.maybeChild(y);if(w&&S==h&&S+w.nodeSize==g){let C=o[u+2].mapInner(r,w,c+1,t[u]+a+1,s);C!=is?(o[u]=h,o[u+1]=g,o[u+2]=C):(o[u+1]=-2,l=!0)}else l=!0}if(l){let u=EX(o,t,e,r,i,a,s),c=Ox(u,n,0,s);e=c.local;for(let h=0;h<o.length;h+=3)o[h+1]<0&&(o.splice(h,3),h-=3);for(let h=0,p=0;h<c.children.length;h+=3){let g=c.children[h];for(;p<o.length&&o[p]<g;)p+=3;o.splice(p,0,c.children[h],c.children[h+1],c.children[h+2])}}return new $n(e.sort(cf),o)}function VO(t,e){if(!e||!t.length)return t;let r=[];for(let n=0;n<t.length;n++){let i=t[n];r.push(new as(i.from+e,i.to+e,i.type))}return r}function EX(t,e,r,n,i,a,s){function o(l,u){for(let c=0;c<l.local.length;c++){let h=l.local[c].map(n,i,u);h?r.push(h):s.onRemove&&s.onRemove(l.local[c].spec)}for(let c=0;c<l.children.length;c+=3)o(l.children[c+2],l.children[c]+u+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&o(t[l+2],e[l]+a+1);return r}function HO(t,e,r){if(e.isLeaf)return null;let n=r+e.nodeSize,i=null;for(let a=0,s;a<t.length;a++)(s=t[a])&&s.from>r&&s.to<n&&((i||(i=[])).push(s),t[a]=null);return i}function WO(t){let e=[];for(let r=0;r<t.length;r++)t[r]!=null&&e.push(t[r]);return e}function Ox(t,e,r,n){let i=[],a=!1;e.forEach((o,l)=>{let u=HO(t,o,l+r);if(u){a=!0;let c=Ox(u,o,r+l+1,n);c!=is&&i.push(l,l+o.nodeSize,c)}});let s=VO(a?WO(t):t,-r).sort(cf);for(let o=0;o<s.length;o++)s[o].type.valid(e,s[o])||(n.onRemove&&n.onRemove(s[o].spec),s.splice(o--,1));return s.length||i.length?new $n(s,i):is}function cf(t,e){return t.from-e.from||t.to-e.to}function J_(t){let e=t;for(let r=0;r<e.length-1;r++){let n=e[r];if(n.from!=n.to)for(let i=r+1;i<e.length;i++){let a=e[i];if(a.from==n.from){a.to!=n.to&&(e==t&&(e=t.slice()),e[i]=a.copy(a.from,n.to),Y3(e,i+1,a.copy(n.to,a.to)));continue}else{a.from<n.to&&(e==t&&(e=t.slice()),e[r]=n.copy(n.from,a.from),Y3(e,i,n.copy(a.from,n.to)));break}}}return e}function Y3(t,e,r){for(;e<t.length&&cf(r,t[e])>0;)e++;t.splice(e,0,r)}function aS(t){let e=[];return t.someProp("decorations",r=>{let n=r(t.state);n&&n!=is&&e.push(n)}),t.cursorWrapper&&e.push($n.create(t.state.doc,[t.cursorWrapper.deco])),Md.from(e)}const TX={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},NX=Xs&&qd<=11;class PX{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class MX{constructor(e,r){this.view=e,this.handleDOMChange=r,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new PX,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let i=0;i<n.length;i++)this.queue.push(n[i]);Xs&&qd<=11&&n.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():Ua&&e.composing&&n.some(i=>i.type=="childList"&&i.target.nodeName=="TR")?(e.input.badSafariComposition=!0,this.flushSoon()):this.flush()}),NX&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,TX)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let r=0;r<e.length;r++)this.queue.push(e[r]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(G3(this.view)){if(this.suppressingSelectionUpdates)return gc(this.view);if(Xs&&qd<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&kf(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let r=new Set,n;for(let a=e.focusNode;a;a=Xp(a))r.add(a);for(let a=e.anchorNode;a;a=Xp(a))if(r.has(a)){n=a;break}let i=n&&this.view.docView.nearestDesc(n);if(i&&i.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let r=this.pendingRecords();r.length&&(this.queue=[]);let n=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&G3(e)&&!this.ignoreSelectionChange(n),a=-1,s=-1,o=!1,l=[];if(e.editable)for(let c=0;c<r.length;c++){let h=this.registerMutation(r[c],l);h&&(a=a<0?h.from:Math.min(h.from,a),s=s<0?h.to:Math.max(h.to,s),h.typeOver&&(o=!0))}if(Jo&&l.length){let c=l.filter(h=>h.nodeName=="BR");if(c.length==2){let[h,p]=c;h.parentNode&&h.parentNode.parentNode==p.parentNode?p.remove():h.remove()}else{let{focusNode:h}=this.currentSelection;for(let p of c){let g=p.parentNode;g&&g.nodeName=="LI"&&(!h||RX(e,h)!=g)&&p.remove()}}}else if((pa||Ua)&&l.some(c=>c.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let c of l)if(c.nodeName=="BR"&&c.parentNode){let h=c.nextSibling;h&&h.nodeType==1&&h.contentEditable=="false"&&c.parentNode.removeChild(c)}}let u=null;a<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&K1(n)&&(u=q_(e))&&u.eq(Sr.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,gc(e),this.currentSelection.set(n),e.scrollToSelection()):(a>-1||i)&&(a>-1&&(e.docView.markDirty(a,s),AX(e)),e.input.badSafariComposition&&(e.input.badSafariComposition=!1,OX(e,l)),this.handleDOMChange(a,s,o,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||gc(e),this.currentSelection.set(n))}registerMutation(e,r){if(r.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(n==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!n||n.ignoreMutation(e))return null;if(e.type=="childList"){for(let c=0;c<e.addedNodes.length;c++){let h=e.addedNodes[c];r.push(h),h.nodeType==3&&(this.lastChangedTextNode=h)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let i=e.previousSibling,a=e.nextSibling;if(Xs&&qd<=11&&e.addedNodes.length)for(let c=0;c<e.addedNodes.length;c++){let{previousSibling:h,nextSibling:p}=e.addedNodes[c];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(i=h),(!p||Array.prototype.indexOf.call(e.addedNodes,p)<0)&&(a=p)}let s=i&&i.parentNode==e.target?ja(i)+1:0,o=n.localPosFromDOM(e.target,s,-1),l=a&&a.parentNode==e.target?ja(a):e.target.childNodes.length,u=n.localPosFromDOM(e.target,l,1);return{from:o,to:u}}else return e.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let X3=new WeakMap,Q3=!1;function AX(t){if(!X3.has(t)&&(X3.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Jo,Q3)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Q3=!0}}function J3(t,e){let r=e.startContainer,n=e.startOffset,i=e.endContainer,a=e.endOffset,s=t.domAtPos(t.state.selection.anchor);return kf(s.node,s.offset,i,a)&&([r,n,i,a]=[i,a,r,n]),{anchorNode:r,anchorOffset:n,focusNode:i,focusOffset:a}}function LX(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return J3(t,i)}let r;function n(i){i.preventDefault(),i.stopImmediatePropagation(),r=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",n,!0),r?J3(t,r):null}function RX(t,e){for(let r=e.parentNode;r&&r!=t.dom;r=r.parentNode){let n=t.docView.nearestDesc(r,!0);if(n&&n.node.isBlock)return r}return null}function OX(t,e){var r;let{focusNode:n,focusOffset:i}=t.domSelectionRange();for(let a of e)if(((r=a.parentNode)===null||r===void 0?void 0:r.nodeName)=="TR"){let s=a.nextSibling;for(;s&&s.nodeName!="TD"&&s.nodeName!="TH";)s=s.nextSibling;if(s){let o=s;for(;;){let l=o.firstChild;if(!l||l.nodeType!=1||l.contentEditable=="false"||/^(BR|IMG)$/.test(l.nodeName))break;o=l}o.insertBefore(a,o.firstChild),n==a&&t.domSelection().collapse(a,i)}else a.parentNode.removeChild(a)}}function DX(t,e,r){let{node:n,fromOffset:i,toOffset:a,from:s,to:o}=t.docView.parseRange(e,r),l=t.domSelectionRange(),u,c=l.anchorNode;if(c&&t.dom.contains(c.nodeType==1?c:c.parentNode)&&(u=[{node:c,offset:l.anchorOffset}],K1(l)||u.push({node:l.focusNode,offset:l.focusOffset})),pa&&t.input.lastKeyCode===8)for(let w=a;w>i;w--){let C=n.childNodes[w-1],_=C.pmViewDesc;if(C.nodeName=="BR"&&!_){a=w;break}if(!_||_.size)break}let h=t.state.doc,p=t.someProp("domParser")||Wd.fromSchema(t.state.schema),g=h.resolve(s),y=null,S=p.parse(n,{topNode:g.parent,topMatch:g.parent.contentMatchAt(g.index()),topOpen:!0,from:i,to:a,preserveWhitespace:g.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:IX,context:g});if(u&&u[0].pos!=null){let w=u[0].pos,C=u[1]&&u[1].pos;C==null&&(C=w),y={anchor:w+s,head:C+s}}return{doc:S,sel:y,from:s,to:o}}function IX(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Ua&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let r=document.createElement("div");return r.appendChild(document.createElement("li")),{skip:r}}else if(t.parentNode.lastChild==t||Ua&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const jX=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function FX(t,e,r,n,i){let a=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let j=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,O=q_(t,j);if(O&&!t.state.selection.eq(O)){if(pa&&fc&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",z=>z(t,Jh(13,"Enter"))))return;let F=t.state.tr.setSelection(O);j=="pointer"?F.setMeta("pointer",!0):j=="key"&&F.scrollIntoView(),a&&F.setMeta("composition",a),t.dispatch(F)}return}let s=t.state.doc.resolve(e),o=s.sharedDepth(r);e=s.before(o+1),r=t.state.doc.resolve(r).after(o+1);let l=t.state.selection,u=DX(t,e,r),c=t.state.doc,h=c.slice(u.from,u.to),p,g;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(p=t.state.selection.to,g="end"):(p=t.state.selection.from,g="start"),t.input.lastKeyCode=null;let y=UX(h.content,u.doc.content,u.from,p,g);if(y&&t.input.domChangeCount++,(Qp&&t.input.lastIOSEnter>Date.now()-225||fc)&&i.some(j=>j.nodeType==1&&!jX.test(j.nodeName))&&(!y||y.endA>=y.endB)&&t.someProp("handleKeyDown",j=>j(t,Jh(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!y)if(n&&l instanceof dr&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))y={start:l.from,endA:l.to,endB:l.to};else{if(u.sel){let j=eP(t,t.state.doc,u.sel);if(j&&!j.eq(t.state.selection)){let O=t.state.tr.setSelection(j);a&&O.setMeta("composition",a),t.dispatch(O)}}return}t.state.selection.from<t.state.selection.to&&y.start==y.endB&&t.state.selection instanceof dr&&(y.start>t.state.selection.from&&y.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?y.start=t.state.selection.from:y.endA<t.state.selection.to&&y.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(y.endB+=t.state.selection.to-y.endA,y.endA=t.state.selection.to)),Xs&&qd<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>u.from&&u.doc.textBetween(y.start-u.from-1,y.start-u.from+1)==" "&&(y.start--,y.endA--,y.endB--);let S=u.doc.resolveNoCache(y.start-u.from),w=u.doc.resolveNoCache(y.endB-u.from),C=c.resolve(y.start),_=S.sameParent(w)&&S.parent.inlineContent&&C.end()>=y.endA;if((Qp&&t.input.lastIOSEnter>Date.now()-225&&(!_||i.some(j=>j.nodeName=="DIV"||j.nodeName=="P"))||!_&&S.pos<u.doc.content.size&&(!S.sameParent(w)||!S.parent.inlineContent)&&S.pos<w.pos&&!/\S/.test(u.doc.textBetween(S.pos,w.pos,"","")))&&t.someProp("handleKeyDown",j=>j(t,Jh(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>y.start&&zX(c,y.start,y.endA,S,w)&&t.someProp("handleKeyDown",j=>j(t,Jh(8,"Backspace")))){fc&&pa&&t.domObserver.suppressSelectionUpdates();return}pa&&y.endB==y.start&&(t.input.lastChromeDelete=Date.now()),fc&&!_&&S.start()!=w.start()&&w.parentOffset==0&&S.depth==w.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==y.endA&&(y.endB-=2,w=u.doc.resolveNoCache(y.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(j){return j(t,Jh(13,"Enter"))})},20));let T=y.start,N=y.endA,R=j=>{let O=j||t.state.tr.replace(T,N,u.doc.slice(y.start-u.from,y.endB-u.from));if(u.sel){let F=eP(t,O.doc,u.sel);F&&!(pa&&t.composing&&F.empty&&(y.start!=y.endB||t.input.lastChromeDelete<Date.now()-100)&&(F.head==T||F.head==O.mapping.map(N)-1)||Xs&&F.empty&&F.head==T)&&O.setSelection(F)}return a&&O.setMeta("composition",a),O.scrollIntoView()},I;if(_)if(S.pos==w.pos){Xs&&qd<=11&&S.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>gc(t),20));let j=R(t.state.tr.delete(T,N)),O=c.resolve(y.start).marksAcross(c.resolve(y.endA));O&&j.ensureMarks(O),t.dispatch(j)}else if(y.endA==y.endB&&(I=BX(S.parent.content.cut(S.parentOffset,w.parentOffset),C.parent.content.cut(C.parentOffset,y.endA-C.start())))){let j=R(t.state.tr);I.type=="add"?j.addMark(T,N,I.mark):j.removeMark(T,N,I.mark),t.dispatch(j)}else if(S.parent.child(S.index()).isText&&S.index()==w.index()-(w.textOffset?0:1)){let j=S.parent.textBetween(S.parentOffset,w.parentOffset),O=()=>R(t.state.tr.insertText(j,T,N));t.someProp("handleTextInput",F=>F(t,T,N,j,O))||t.dispatch(O())}else t.dispatch(R());else t.dispatch(R())}function eP(t,e,r){return Math.max(r.anchor,r.head)>e.content.size?null:$_(t,e.resolve(r.anchor),e.resolve(r.head))}function BX(t,e){let r=t.firstChild.marks,n=e.firstChild.marks,i=r,a=n,s,o,l;for(let c=0;c<n.length;c++)i=n[c].removeFromSet(i);for(let c=0;c<r.length;c++)a=r[c].removeFromSet(a);if(i.length==1&&a.length==0)o=i[0],s="add",l=c=>c.mark(o.addToSet(c.marks));else if(i.length==0&&a.length==1)o=a[0],s="remove",l=c=>c.mark(o.removeFromSet(c.marks));else return null;let u=[];for(let c=0;c<e.childCount;c++)u.push(l(e.child(c)));if(ot.from(u).eq(t))return{mark:o,type:s}}function zX(t,e,r,n,i){if(r-e<=i.pos-n.pos||sS(n,!0,!1)<i.pos)return!1;let a=t.resolve(e);if(!n.parent.isTextblock){let o=a.nodeAfter;return o!=null&&r==e+o.nodeSize}if(a.parentOffset<a.parent.content.size||!a.parent.isTextblock)return!1;let s=t.resolve(sS(a,!0,!0));return!s.parent.isTextblock||s.pos>r||sS(s,!0,!1)<r?!1:n.parent.content.cut(n.parentOffset).eq(s.parent.content)}function sS(t,e,r){let n=t.depth,i=e?t.end():t.pos;for(;n>0&&(e||t.indexAfter(n)==t.node(n).childCount);)n--,i++,e=!1;if(r){let a=t.node(n).maybeChild(t.indexAfter(n));for(;a&&!a.isLeaf;)a=a.firstChild,i++}return i}function UX(t,e,r,n,i){let a=t.findDiffStart(e,r);if(a==null)return null;let{a:s,b:o}=t.findDiffEnd(e,r+t.size,r+e.size);if(i=="end"){let l=Math.max(0,a-Math.min(s,o));n-=s+l-a}if(s<a&&t.size<e.size){let l=n<=a&&n>=s?a-n:0;a-=l,a&&a<e.size&&tP(e.textBetween(a-1,a+1))&&(a+=l?1:-1),o=a+(o-s),s=a}else if(o<a){let l=n<=a&&n>=o?a-n:0;a-=l,a&&a<t.size&&tP(t.textBetween(a-1,a+1))&&(a+=l?1:-1),s=a+(s-o),o=a}return{start:a,endA:s,endB:o}}function tP(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),r=t.charCodeAt(1);return e>=56320&&e<=57343&&r>=55296&&r<=56319}class qO{constructor(e,r){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new nX,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=r,this.state=r.state,this.directPlugins=r.plugins||[],this.directPlugins.forEach(sP),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=iP(this),nP(this),this.nodeViews=aP(this),this.docView=I3(this.state.doc,rP(this),aS(this),this.dom,this),this.domObserver=new MX(this,(n,i,a,s)=>FX(this,n,i,a,s)),this.domObserver.start(),iX(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let r in e)this._props[r]=e[r];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&kk(this);let r=this._props;this._props=e,e.plugins&&(e.plugins.forEach(sP),this.directPlugins=e.plugins),this.updateStateInner(e.state,r)}setProps(e){let r={};for(let n in this._props)r[n]=this._props[n];r.state=this.state;for(let n in e)r[n]=e[n];this.update(r)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,r){var n;let i=this.state,a=!1,s=!1;e.storedMarks&&this.composing&&(BO(this),s=!0),this.state=e;let o=i.plugins!=e.plugins||this._props.plugins!=r.plugins;if(o||this._props.plugins!=r.plugins||this._props.nodeViews!=r.nodeViews){let g=aP(this);VX(g,this.nodeViews)&&(this.nodeViews=g,a=!0)}(o||r.handleDOMEvents!=this._props.handleDOMEvents)&&kk(this),this.editable=iP(this),nP(this);let l=aS(this),u=rP(this),c=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",h=a||!this.docView.matchesNode(e.doc,u,l);(h||!e.selection.eq(i.selection))&&(s=!0);let p=c=="preserve"&&s&&this.dom.style.overflowAnchor==null&&yY(this);if(s){this.domObserver.stop();let g=h&&(Xs||pa)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&GX(i.selection,e.selection);if(h){let y=pa?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=yX(this)),(a||!this.docView.update(e.doc,u,l,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=I3(e.doc,u,l,this.dom,this)),y&&(!this.trackWrites||!this.dom.contains(this.trackWrites))&&(g=!0)}g||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&GY(this))?gc(this,g):(TO(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((n=this.dragging)===null||n===void 0)&&n.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),c=="reset"?this.dom.scrollTop=0:c=="to selection"?this.scrollToSelection():p&&xY(p)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",r=>r(this)))if(this.state.selection instanceof Qt){let r=this.docView.domAfterPos(this.state.selection.from);r.nodeType==1&&M3(this,r.getBoundingClientRect(),e)}else M3(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let r=0;r<this.directPlugins.length;r++){let n=this.directPlugins[r];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let r=0;r<this.state.plugins.length;r++){let n=this.state.plugins[r];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let r=0;r<this.pluginViews.length;r++){let n=this.pluginViews[r];n.update&&n.update(this,e)}}updateDraggedNode(e,r){let n=e.node,i=-1;if(this.state.doc.nodeAt(n.from)==n.node)i=n.from;else{let a=n.from+(this.state.doc.content.size-r.doc.content.size);(a>0&&this.state.doc.nodeAt(a))==n.node&&(i=a)}this.dragging=new UO(e.slice,e.move,i<0?void 0:Qt.create(this.state.doc,i))}someProp(e,r){let n=this._props&&this._props[e],i;if(n!=null&&(i=r?r(n):n))return i;for(let s=0;s<this.directPlugins.length;s++){let o=this.directPlugins[s].props[e];if(o!=null&&(i=r?r(o):o))return i}let a=this.state.plugins;if(a)for(let s=0;s<a.length;s++){let o=a[s].props[e];if(o!=null&&(i=r?r(o):o))return i}}hasFocus(){if(Xs){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&bY(this.dom),gc(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let r=this.dom.parentNode;r;r=r.parentNode)if(r.nodeType==9||r.nodeType==11&&r.host)return r.getSelection||(Object.getPrototypeOf(r).getSelection=()=>r.ownerDocument.getSelection()),this._root=r}return e||document}updateRoot(){this._root=null}posAtCoords(e){return CY(this,e)}coordsAtPos(e,r=1){return xO(this,e,r)}domAtPos(e,r=0){return this.docView.domFromPos(e,r)}nodeDOM(e){let r=this.docView.descAt(e);return r?r.nodeDOM:null}posAtDOM(e,r,n=-1){let i=this.docView.posFromDOM(e,r,n);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,r){return MY(this,r||this.state,e)}pasteHTML(e,r){return jv(this,"",e,!1,r||new ClipboardEvent("paste"))}pasteText(e,r){return jv(this,e,null,!0,r||new ClipboardEvent("paste"))}serializeForClipboard(e){return K_(this,e)}destroy(){this.docView&&(aX(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],aS(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,lY())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return oX(this,e)}domSelectionRange(){let e=this.domSelection();return e?Ua&&this.root.nodeType===11&&fY(this.dom.ownerDocument)==this.dom&&LX(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}qO.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function rP(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",r=>{if(typeof r=="function"&&(r=r(t.state)),r)for(let n in r)n=="class"?e.class+=" "+r[n]:n=="style"?e.style=(e.style?e.style+";":"")+r[n]:!e[n]&&n!="contenteditable"&&n!="nodeName"&&(e[n]=String(r[n]))}),e.translate||(e.translate="no"),[as.node(0,t.state.doc.content.size,e)]}function nP(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:as.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function iP(t){return!t.someProp("editable",e=>e(t.state)===!1)}function GX(t,e){let r=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(r)!=e.$anchor.start(r)}function aP(t){let e=Object.create(null);function r(n){for(let i in n)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=n[i])}return t.someProp("nodeViews",r),t.someProp("markViews",r),e}function VX(t,e){let r=0,n=0;for(let i in t){if(t[i]!=e[i])return!0;r++}for(let i in e)n++;return r!=n}function sP(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var rh={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Dx={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},HX=typeof navigator<"u"&&/Mac/.test(navigator.platform),WX=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Fa=0;Fa<10;Fa++)rh[48+Fa]=rh[96+Fa]=String(Fa);for(var Fa=1;Fa<=24;Fa++)rh[Fa+111]="F"+Fa;for(var Fa=65;Fa<=90;Fa++)rh[Fa]=String.fromCharCode(Fa+32),Dx[Fa]=String.fromCharCode(Fa);for(var oS in rh)Dx.hasOwnProperty(oS)||(Dx[oS]=rh[oS]);function qX(t){var e=HX&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||WX&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",r=!e&&t.key||(t.shiftKey?Dx:rh)[t.keyCode]||t.key||"Unidentified";return r=="Esc"&&(r="Escape"),r=="Del"&&(r="Delete"),r=="Left"&&(r="ArrowLeft"),r=="Up"&&(r="ArrowUp"),r=="Right"&&(r="ArrowRight"),r=="Down"&&(r="ArrowDown"),r}const $X=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),KX=typeof navigator<"u"&&/Win/.test(navigator.platform);function ZX(t){let e=t.split(/-(?!$)/),r=e[e.length-1];r=="Space"&&(r=" ");let n,i,a,s;for(let o=0;o<e.length-1;o++){let l=e[o];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))a=!0;else if(/^mod$/i.test(l))$X?s=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return n&&(r="Alt-"+r),i&&(r="Ctrl-"+r),s&&(r="Meta-"+r),a&&(r="Shift-"+r),r}function YX(t){let e=Object.create(null);for(let r in t)e[ZX(r)]=t[r];return e}function lS(t,e,r=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),r&&e.shiftKey&&(t="Shift-"+t),t}function XX(t){return new Yn({props:{handleKeyDown:$O(t)}})}function $O(t){let e=YX(t);return function(r,n){let i=qX(n),a,s=e[lS(i,n)];if(s&&s(r.state,r.dispatch,r))return!0;if(i.length==1&&i!=" "){if(n.shiftKey){let o=e[lS(i,n,!1)];if(o&&o(r.state,r.dispatch,r))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(KX&&n.ctrlKey&&n.altKey)&&(a=rh[n.keyCode])&&a!=i){let o=e[lS(a,n)];if(o&&o(r.state,r.dispatch,r))return!0}}return!1}}var QX=Object.defineProperty,eC=(t,e)=>{for(var r in e)QX(t,r,{get:e[r],enumerable:!0})};function X1(t){const{state:e,transaction:r}=t;let{selection:n}=r,{doc:i}=r,{storedMarks:a}=r;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return a},get selection(){return n},get doc(){return i},get tr(){return n=r.selection,i=r.doc,a=r.storedMarks,r}}}var Q1=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:r}=this,{view:n}=e,{tr:i}=r,a=this.buildProps(i);return Object.fromEntries(Object.entries(t).map(([s,o])=>[s,(...u)=>{const c=o(...u)(a);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&n.dispatch(i),c}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:r,editor:n,state:i}=this,{view:a}=n,s=[],o=!!t,l=t||i.tr,u=()=>(!o&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(l),s.every(h=>h===!0)),c={...Object.fromEntries(Object.entries(r).map(([h,p])=>[h,(...y)=>{const S=this.buildProps(l,e),w=p(...y)(S);return s.push(w),c}])),run:u};return c}createCan(t){const{rawCommands:e,state:r}=this,n=!1,i=t||r.tr,a=this.buildProps(i,n);return{...Object.fromEntries(Object.entries(e).map(([o,l])=>[o,(...u)=>l(...u)({...a,dispatch:void 0})])),chain:()=>this.createChain(i,n)}}buildProps(t,e=!0){const{rawCommands:r,editor:n,state:i}=this,{view:a}=n,s={tr:t,editor:n,view:a,state:X1({state:i,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(r).map(([o,l])=>[o,(...u)=>l(...u)(s)]))}};return s}},KO={};eC(KO,{blur:()=>JX,clearContent:()=>eQ,clearNodes:()=>tQ,command:()=>rQ,createParagraphNear:()=>nQ,cut:()=>iQ,deleteCurrentNode:()=>aQ,deleteNode:()=>sQ,deleteRange:()=>oQ,deleteSelection:()=>lQ,enter:()=>uQ,exitCode:()=>cQ,extendMarkRange:()=>dQ,first:()=>hQ,focus:()=>pQ,forEach:()=>mQ,insertContent:()=>gQ,insertContentAt:()=>xQ,joinBackward:()=>SQ,joinDown:()=>wQ,joinForward:()=>kQ,joinItemBackward:()=>_Q,joinItemForward:()=>CQ,joinTextblockBackward:()=>EQ,joinTextblockForward:()=>TQ,joinUp:()=>bQ,keyboardShortcut:()=>PQ,lift:()=>MQ,liftEmptyBlock:()=>AQ,liftListItem:()=>LQ,newlineInCode:()=>RQ,resetAttributes:()=>OQ,scrollIntoView:()=>DQ,selectAll:()=>IQ,selectNodeBackward:()=>jQ,selectNodeForward:()=>FQ,selectParentNode:()=>BQ,selectTextblockEnd:()=>zQ,selectTextblockStart:()=>UQ,setContent:()=>GQ,setMark:()=>lJ,setMeta:()=>uJ,setNode:()=>cJ,setNodeSelection:()=>dJ,setTextDirection:()=>hJ,setTextSelection:()=>fJ,sinkListItem:()=>pJ,splitBlock:()=>mJ,splitListItem:()=>gJ,toggleList:()=>vJ,toggleMark:()=>yJ,toggleNode:()=>xJ,toggleWrap:()=>bJ,undoInputRule:()=>wJ,unsetAllMarks:()=>SJ,unsetMark:()=>kJ,unsetTextDirection:()=>_J,updateAttributes:()=>CJ,wrapIn:()=>EJ,wrapInList:()=>TJ});var JX=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var r;t.isDestroyed||(e.dom.blur(),(r=window?.getSelection())==null||r.removeAllRanges())}),!0),eQ=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),tQ=()=>({state:t,tr:e,dispatch:r})=>{const{selection:n}=e,{ranges:i}=n;return r&&i.forEach(({$from:a,$to:s})=>{t.doc.nodesBetween(a.pos,s.pos,(o,l)=>{if(o.type.isText)return;const{doc:u,mapping:c}=e,h=u.resolve(c.map(l)),p=u.resolve(c.map(l+o.nodeSize)),g=h.blockRange(p);if(!g)return;const y=vm(g);if(o.type.isTextblock){const{defaultType:S}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(g.start,S)}(y||y===0)&&e.lift(g,y)})}),!0},rQ=t=>e=>t(e),nQ=()=>({state:t,dispatch:e})=>lO(t,e),iQ=(t,e)=>({editor:r,tr:n})=>{const{state:i}=r,a=i.doc.slice(t.from,t.to);n.deleteRange(t.from,t.to);const s=n.mapping.map(e);return n.insert(s,a.content),n.setSelection(new dr(n.doc.resolve(Math.max(s-1,0)))),!0},aQ=()=>({tr:t,dispatch:e})=>{const{selection:r}=t,n=r.$anchor.node();if(n.content.size>0)return!1;const i=t.selection.$anchor;for(let a=i.depth;a>0;a-=1)if(i.node(a).type===n.type){if(e){const o=i.before(a),l=i.after(a);t.delete(o,l).scrollIntoView()}return!0}return!1};function ji(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var sQ=t=>({tr:e,state:r,dispatch:n})=>{const i=ji(t,r.schema),a=e.selection.$anchor;for(let s=a.depth;s>0;s-=1)if(a.node(s).type===i){if(n){const l=a.before(s),u=a.after(s);e.delete(l,u).scrollIntoView()}return!0}return!1},oQ=t=>({tr:e,dispatch:r})=>{const{from:n,to:i}=t;return r&&e.delete(n,i),!0},lQ=()=>({state:t,dispatch:e})=>z_(t,e),uQ=()=>({commands:t})=>t.keyboardShortcut("Enter"),cQ=()=>({state:t,dispatch:e})=>$Z(t,e);function tC(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Ix(t,e,r={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>r.strict?e[i]===t[i]:tC(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function ZO(t,e,r={}){return t.find(n=>n.type===e&&Ix(Object.fromEntries(Object.keys(r).map(i=>[i,n.attrs[i]])),r))}function oP(t,e,r={}){return!!ZO(t,e,r)}function rC(t,e,r){var n;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(c=>c.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(c=>c.type===e)||(r=r||((n=i.node.marks[0])==null?void 0:n.attrs),!ZO([...i.node.marks],e,r)))return;let s=i.index,o=t.start()+i.offset,l=s+1,u=o+i.node.nodeSize;for(;s>0&&oP([...t.parent.child(s-1).marks],e,r);)s-=1,o-=t.parent.child(s).nodeSize;for(;l<t.parent.childCount&&oP([...t.parent.child(l).marks],e,r);)u+=t.parent.child(l).nodeSize,l+=1;return{from:o,to:u}}function _c(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var dQ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{const a=_c(t,n.schema),{doc:s,selection:o}=r,{$from:l,from:u,to:c}=o;if(i){const h=rC(l,a,e);if(h&&h.from<=u&&h.to>=c){const p=dr.create(s,h.from,h.to);r.setSelection(p)}}return!0},hQ=t=>e=>{const r=typeof t=="function"?t(e):t;for(let n=0;n<r.length;n+=1)if(r[n](e))return!0;return!1};function YO(t){return t instanceof dr}function af(t=0,e=0,r=0){return Math.min(Math.max(t,e),r)}function XO(t,e=null){if(!e)return null;const r=Sr.atStart(t),n=Sr.atEnd(t);if(e==="start"||e===!0)return r;if(e==="end")return n;const i=r.from,a=n.to;return e==="all"?dr.create(t,af(0,i,a),af(t.content.size,i,a)):dr.create(t,af(e,i,a),af(e,i,a))}function lP(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function jx(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function fQ(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var pQ=(t=null,e={})=>({editor:r,view:n,tr:i,dispatch:a})=>{e={scrollIntoView:!0,...e};const s=()=>{(jx()||lP())&&n.dom.focus(),fQ()&&!jx()&&!lP()&&n.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{r.isDestroyed||(n.focus(),e?.scrollIntoView&&r.commands.scrollIntoView())})};if(n.hasFocus()&&t===null||t===!1)return!0;if(a&&t===null&&!YO(r.state.selection))return s(),!0;const o=XO(i.doc,t)||r.state.selection,l=r.state.selection.eq(o);return a&&(l||i.setSelection(o),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),s()),!0},mQ=(t,e)=>r=>t.every((n,i)=>e(n,{...r,index:i})),gQ=(t,e)=>({tr:r,commands:n})=>n.insertContentAt({from:r.selection.from,to:r.selection.to},t,e),QO=t=>{const e=t.childNodes;for(let r=e.length-1;r>=0;r-=1){const n=e[r];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?t.removeChild(n):n.nodeType===1&&QO(n)}return t};function Sy(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,r=new window.DOMParser().parseFromString(e,"text/html").body;return QO(r)}function Bv(t,e,r){if(t instanceof Qo||t instanceof ot)return t;r={slice:!0,parseOptions:{},...r};const n=typeof t=="object"&&t!==null,i=typeof t=="string";if(n)try{if(Array.isArray(t)&&t.length>0)return ot.fromArray(t.map(o=>e.nodeFromJSON(o)));const s=e.nodeFromJSON(t);return r.errorOnInvalidContent&&s.check(),s}catch(a){if(r.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:a});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",a),Bv("",e,r)}if(i){if(r.errorOnInvalidContent){let s=!1,o="";const l=new DR({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(s=!0,o=typeof u=="string"?u:u.outerHTML,null)}]}})});if(r.slice?Wd.fromSchema(l).parseSlice(Sy(t),r.parseOptions):Wd.fromSchema(l).parse(Sy(t),r.parseOptions),r.errorOnInvalidContent&&s)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${o}`)})}const a=Wd.fromSchema(e);return r.slice?a.parseSlice(Sy(t),r.parseOptions).content:a.parse(Sy(t),r.parseOptions)}return Bv("",e,r)}function vQ(t,e,r){const n=t.steps.length-1;if(n<e)return;const i=t.steps[n];if(!(i instanceof ha||i instanceof ga))return;const a=t.mapping.maps[n];let s=0;a.forEach((o,l,u,c)=>{s===0&&(s=c)}),t.setSelection(Sr.near(t.doc.resolve(s),r))}var yQ=t=>!("type"in t),xQ=(t,e,r)=>({tr:n,dispatch:i,editor:a})=>{var s;if(i){r={parseOptions:a.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...r};let o;const l=w=>{a.emit("contentError",{editor:a,error:w,disableCollaboration:()=>{"collaboration"in a.storage&&typeof a.storage.collaboration=="object"&&a.storage.collaboration&&(a.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...r.parseOptions};if(!r.errorOnInvalidContent&&!a.options.enableContentCheck&&a.options.emitContentError)try{Bv(e,a.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(w){l(w)}try{o=Bv(e,a.schema,{parseOptions:u,errorOnInvalidContent:(s=r.errorOnInvalidContent)!=null?s:a.options.enableContentCheck})}catch(w){return l(w),!1}let{from:c,to:h}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},p=!0,g=!0;if((yQ(o)?o:[o]).forEach(w=>{w.check(),p=p?w.isText&&w.marks.length===0:!1,g=g?w.isBlock:!1}),c===h&&g){const{parent:w}=n.doc.resolve(c);w.isTextblock&&!w.type.spec.code&&!w.childCount&&(c-=1,h+=1)}let S;if(p){if(Array.isArray(e))S=e.map(w=>w.text||"").join("");else if(e instanceof ot){let w="";e.forEach(C=>{C.text&&(w+=C.text)}),S=w}else typeof e=="object"&&e&&e.text?S=e.text:S=e;n.insertText(S,c,h)}else{S=o;const w=n.doc.resolve(c),C=w.node(),_=w.parentOffset===0,T=C.isText||C.isTextblock,N=C.content.size>0;_&&T&&N&&(c=Math.max(0,c-1)),n.replaceWith(c,h,S)}r.updateSelection&&vQ(n,n.steps.length-1,-1),r.applyInputRules&&n.setMeta("applyInputRules",{from:c,text:S}),r.applyPasteRules&&n.setMeta("applyPasteRules",{from:c,text:S})}return!0},bQ=()=>({state:t,dispatch:e})=>HZ(t,e),wQ=()=>({state:t,dispatch:e})=>WZ(t,e),SQ=()=>({state:t,dispatch:e})=>tO(t,e),kQ=()=>({state:t,dispatch:e})=>aO(t,e),_Q=()=>({state:t,dispatch:e,tr:r})=>{try{const n=W1(t.doc,t.selection.$from.pos,-1);return n==null?!1:(r.join(n,2),e&&e(r),!0)}catch{return!1}},CQ=()=>({state:t,dispatch:e,tr:r})=>{try{const n=W1(t.doc,t.selection.$from.pos,1);return n==null?!1:(r.join(n,2),e&&e(r),!0)}catch{return!1}},EQ=()=>({state:t,dispatch:e})=>GZ(t,e),TQ=()=>({state:t,dispatch:e})=>VZ(t,e);function JO(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function NQ(t){const e=t.split(/-(?!$)/);let r=e[e.length-1];r==="Space"&&(r=" ");let n,i,a,s;for(let o=0;o<e.length-1;o+=1){const l=e[o];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))a=!0;else if(/^mod$/i.test(l))jx()||JO()?s=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(r=`Alt-${r}`),i&&(r=`Ctrl-${r}`),s&&(r=`Meta-${r}`),a&&(r=`Shift-${r}`),r}var PQ=t=>({editor:e,view:r,tr:n,dispatch:i})=>{const a=NQ(t).split(/-(?!$)/),s=a.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),o=new KeyboardEvent("keydown",{key:s==="Space"?" ":s,altKey:a.includes("Alt"),ctrlKey:a.includes("Ctrl"),metaKey:a.includes("Meta"),shiftKey:a.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{r.someProp("handleKeyDown",u=>u(r,o))});return l?.steps.forEach(u=>{const c=u.map(n.mapping);c&&i&&n.maybeStep(c)}),!0};function nh(t,e,r={}){const{from:n,to:i,empty:a}=t.selection,s=e?ji(e,t.schema):null,o=[];t.doc.nodesBetween(n,i,(h,p)=>{if(h.isText)return;const g=Math.max(n,p),y=Math.min(i,p+h.nodeSize);o.push({node:h,from:g,to:y})});const l=i-n,u=o.filter(h=>s?s.name===h.node.type.name:!0).filter(h=>Ix(h.node.attrs,r,{strict:!1}));return a?!!u.length:u.reduce((h,p)=>h+p.to-p.from,0)>=l}var MQ=(t,e={})=>({state:r,dispatch:n})=>{const i=ji(t,r.schema);return nh(r,i,e)?qZ(r,n):!1},AQ=()=>({state:t,dispatch:e})=>uO(t,e),LQ=t=>({state:e,dispatch:r})=>{const n=ji(t,e.schema);return iY(n)(e,r)},RQ=()=>({state:t,dispatch:e})=>oO(t,e);function J1(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function uP(t,e){const r=typeof e=="string"?[e]:e;return Object.keys(t).reduce((n,i)=>(r.includes(i)||(n[i]=t[i]),n),{})}var OQ=(t,e)=>({tr:r,state:n,dispatch:i})=>{let a=null,s=null;const o=J1(typeof t=="string"?t:t.name,n.schema);if(!o)return!1;o==="node"&&(a=ji(t,n.schema)),o==="mark"&&(s=_c(t,n.schema));let l=!1;return r.selection.ranges.forEach(u=>{n.doc.nodesBetween(u.$from.pos,u.$to.pos,(c,h)=>{a&&a===c.type&&(l=!0,i&&r.setNodeMarkup(h,void 0,uP(c.attrs,e))),s&&c.marks.length&&c.marks.forEach(p=>{s===p.type&&(l=!0,i&&r.addMark(h,h+c.nodeSize,s.create(uP(p.attrs,e))))})})}),l},DQ=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),IQ=()=>({tr:t,dispatch:e})=>{if(e){const r=new yo(t.doc);t.setSelection(r)}return!0},jQ=()=>({state:t,dispatch:e})=>nO(t,e),FQ=()=>({state:t,dispatch:e})=>sO(t,e),BQ=()=>({state:t,dispatch:e})=>YZ(t,e),zQ=()=>({state:t,dispatch:e})=>JZ(t,e),UQ=()=>({state:t,dispatch:e})=>QZ(t,e);function _k(t,e,r={},n={}){return Bv(t,e,{slice:!1,parseOptions:r,errorOnInvalidContent:n.errorOnInvalidContent})}var GQ=(t,{errorOnInvalidContent:e,emitUpdate:r=!0,parseOptions:n={}}={})=>({editor:i,tr:a,dispatch:s,commands:o})=>{const{doc:l}=a;if(n.preserveWhitespace!=="full"){const u=_k(t,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return s&&a.replaceWith(0,l.content.size,u).setMeta("preventUpdate",!r),!0}return s&&a.setMeta("preventUpdate",!r),o.insertContentAt({from:0,to:l.content.size},t,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function e6(t,e){const r=_c(e,t.schema),{from:n,to:i,empty:a}=t.selection,s=[];a?(t.storedMarks&&s.push(...t.storedMarks),s.push(...t.selection.$head.marks())):t.doc.nodesBetween(n,i,l=>{s.push(...l.marks)});const o=s.find(l=>l.type.name===r.name);return o?{...o.attrs}:{}}function t6(t,e){const r=new XR(t);return e.forEach(n=>{n.steps.forEach(i=>{r.step(i)})}),r}function VQ(t){for(let e=0;e<t.edgeCount;e+=1){const{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function HQ(t,e,r){const n=[];return t.nodesBetween(e.from,e.to,(i,a)=>{r(i)&&n.push({node:i,pos:a})}),n}function WQ(t,e){for(let r=t.depth;r>0;r-=1){const n=t.node(r);if(e(n))return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:n}}}function eb(t){return e=>WQ(e.$from,t)}function Kt(t,e,r){return t.config[e]===void 0&&t.parent?Kt(t.parent,e,r):typeof t.config[e]=="function"?t.config[e].bind({...r,parent:t.parent?Kt(t.parent,e,r):null}):t.config[e]}function nC(t){return t.map(e=>{const r={name:e.name,options:e.options,storage:e.storage},n=Kt(e,"addExtensions",r);return n?[e,...nC(n())]:e}).flat(10)}function iC(t,e){const r=Af.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(r),i.innerHTML}function r6(t){return typeof t=="function"}function dn(t,e=void 0,...r){return r6(t)?e?t.bind(e)(...r):t(...r):t}function qQ(t={}){return Object.keys(t).length===0&&t.constructor===Object}function Jp(t){const e=t.filter(i=>i.type==="extension"),r=t.filter(i=>i.type==="node"),n=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:r,markExtensions:n}}function n6(t){const e=[],{nodeExtensions:r,markExtensions:n}=Jp(t),i=[...r,...n],a={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(s=>{const o={name:s.name,options:s.options,storage:s.storage,extensions:i},l=Kt(s,"addGlobalAttributes",o);if(!l)return;l().forEach(c=>{c.types.forEach(h=>{Object.entries(c.attributes).forEach(([p,g])=>{e.push({type:h,name:p,attribute:{...a,...g}})})})})}),i.forEach(s=>{const o={name:s.name,options:s.options,storage:s.storage},l=Kt(s,"addAttributes",o);if(!l)return;const u=l();Object.entries(u).forEach(([c,h])=>{const p={...a,...h};typeof p?.default=="function"&&(p.default=p.default()),p?.isRequired&&p?.default===void 0&&delete p.default,e.push({type:s.name,name:c,attribute:p})})}),e}function Zn(...t){return t.filter(e=>!!e).reduce((e,r)=>{const n={...e};return Object.entries(r).forEach(([i,a])=>{if(!n[i]){n[i]=a;return}if(i==="class"){const o=a?String(a).split(" "):[],l=n[i]?n[i].split(" "):[],u=o.filter(c=>!l.includes(c));n[i]=[...l,...u].join(" ")}else if(i==="style"){const o=a?a.split(";").map(c=>c.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(c=>c.trim()).filter(Boolean):[],u=new Map;l.forEach(c=>{const[h,p]=c.split(":").map(g=>g.trim());u.set(h,p)}),o.forEach(c=>{const[h,p]=c.split(":").map(g=>g.trim());u.set(h,p)}),n[i]=Array.from(u.entries()).map(([c,h])=>`${c}: ${h}`).join("; ")}else n[i]=a}),n},{})}function zv(t,e){return e.filter(r=>r.type===t.type.name).filter(r=>r.attribute.rendered).map(r=>r.attribute.renderHTML?r.attribute.renderHTML(t.attrs)||{}:{[r.name]:t.attrs[r.name]}).reduce((r,n)=>Zn(r,n),{})}function $Q(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function cP(t,e){return"style"in t?t:{...t,getAttrs:r=>{const n=t.getAttrs?t.getAttrs(r):t.attrs;if(n===!1)return!1;const i=e.reduce((a,s)=>{const o=s.attribute.parseHTML?s.attribute.parseHTML(r):$Q(r.getAttribute(s.name));return o==null?a:{...a,[s.name]:o}},{});return{...n,...i}}}}function dP(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>e==="attrs"&&qQ(r)?!1:r!=null))}function hP(t){var e,r;const n={};return!((e=t?.attribute)!=null&&e.isRequired)&&"default"in(t?.attribute||{})&&(n.default=t.attribute.default),((r=t?.attribute)==null?void 0:r.validate)!==void 0&&(n.validate=t.attribute.validate),[t.name,n]}function KQ(t,e){var r;const n=n6(t),{nodeExtensions:i,markExtensions:a}=Jp(t),s=(r=i.find(u=>Kt(u,"topNode")))==null?void 0:r.name,o=Object.fromEntries(i.map(u=>{const c=n.filter(C=>C.type===u.name),h={name:u.name,options:u.options,storage:u.storage,editor:e},p=t.reduce((C,_)=>{const T=Kt(_,"extendNodeSchema",h);return{...C,...T?T(u):{}}},{}),g=dP({...p,content:dn(Kt(u,"content",h)),marks:dn(Kt(u,"marks",h)),group:dn(Kt(u,"group",h)),inline:dn(Kt(u,"inline",h)),atom:dn(Kt(u,"atom",h)),selectable:dn(Kt(u,"selectable",h)),draggable:dn(Kt(u,"draggable",h)),code:dn(Kt(u,"code",h)),whitespace:dn(Kt(u,"whitespace",h)),linebreakReplacement:dn(Kt(u,"linebreakReplacement",h)),defining:dn(Kt(u,"defining",h)),isolating:dn(Kt(u,"isolating",h)),attrs:Object.fromEntries(c.map(hP))}),y=dn(Kt(u,"parseHTML",h));y&&(g.parseDOM=y.map(C=>cP(C,c)));const S=Kt(u,"renderHTML",h);S&&(g.toDOM=C=>S({node:C,HTMLAttributes:zv(C,c)}));const w=Kt(u,"renderText",h);return w&&(g.toText=w),[u.name,g]})),l=Object.fromEntries(a.map(u=>{const c=n.filter(w=>w.type===u.name),h={name:u.name,options:u.options,storage:u.storage,editor:e},p=t.reduce((w,C)=>{const _=Kt(C,"extendMarkSchema",h);return{...w,..._?_(u):{}}},{}),g=dP({...p,inclusive:dn(Kt(u,"inclusive",h)),excludes:dn(Kt(u,"excludes",h)),group:dn(Kt(u,"group",h)),spanning:dn(Kt(u,"spanning",h)),code:dn(Kt(u,"code",h)),attrs:Object.fromEntries(c.map(hP))}),y=dn(Kt(u,"parseHTML",h));y&&(g.parseDOM=y.map(w=>cP(w,c)));const S=Kt(u,"renderHTML",h);return S&&(g.toDOM=w=>S({mark:w,HTMLAttributes:zv(w,c)})),[u.name,g]}));return new DR({topNode:s,nodes:o,marks:l})}function ZQ(t){const e=t.filter((r,n)=>t.indexOf(r)!==n);return Array.from(new Set(e))}function Fx(t){return t.sort((r,n)=>{const i=Kt(r,"priority")||100,a=Kt(n,"priority")||100;return i>a?-1:i<a?1:0})}function i6(t){const e=Fx(nC(t)),r=ZQ(e.map(n=>n.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(n=>`'${n}'`).join(", ")}]. This can lead to issues.`),e}function a6(t,e,r){const{from:n,to:i}=e,{blockSeparator:a=`

`,textSerializers:s={}}=r||{};let o="";return t.nodesBetween(n,i,(l,u,c,h)=>{var p;l.isBlock&&u>n&&(o+=a);const g=s?.[l.type.name];if(g)return c&&(o+=g({node:l,pos:u,parent:c,index:h,range:e})),!1;l.isText&&(o+=(p=l?.text)==null?void 0:p.slice(Math.max(n,u)-u,i-u))}),o}function YQ(t,e){const r={from:0,to:t.content.size};return a6(t,r,e)}function s6(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,r])=>[e,r.spec.toText]))}function XQ(t,e){const r=ji(e,t.schema),{from:n,to:i}=t.selection,a=[];t.doc.nodesBetween(n,i,o=>{a.push(o)});const s=a.reverse().find(o=>o.type.name===r.name);return s?{...s.attrs}:{}}function o6(t,e){const r=J1(typeof e=="string"?e:e.name,t.schema);return r==="node"?XQ(t,e):r==="mark"?e6(t,e):{}}function QQ(t,e=JSON.stringify){const r={};return t.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(r,i)?!1:r[i]=!0})}function JQ(t){const e=QQ(t);return e.length===1?e:e.filter((r,n)=>!e.filter((a,s)=>s!==n).some(a=>r.oldRange.from>=a.oldRange.from&&r.oldRange.to<=a.oldRange.to&&r.newRange.from>=a.newRange.from&&r.newRange.to<=a.newRange.to))}function l6(t){const{mapping:e,steps:r}=t,n=[];return e.maps.forEach((i,a)=>{const s=[];if(i.ranges.length)i.forEach((o,l)=>{s.push({from:o,to:l})});else{const{from:o,to:l}=r[a];if(o===void 0||l===void 0)return;s.push({from:o,to:l})}s.forEach(({from:o,to:l})=>{const u=e.slice(a).map(o,-1),c=e.slice(a).map(l),h=e.invert().map(u,-1),p=e.invert().map(c);n.push({oldRange:{from:h,to:p},newRange:{from:u,to:c}})})}),JQ(n)}function aC(t,e,r){const n=[];return t===e?r.resolve(t).marks().forEach(i=>{const a=r.resolve(t),s=rC(a,i.type);s&&n.push({mark:i,...s})}):r.nodesBetween(t,e,(i,a)=>{!i||i?.nodeSize===void 0||n.push(...i.marks.map(s=>({from:a,to:a+i.nodeSize,mark:s})))}),n}var eJ=(t,e,r,n=20)=>{const i=t.doc.resolve(r);let a=n,s=null;for(;a>0&&s===null;){const o=i.node(a);o?.type.name===e?s=o:a-=1}return[s,a]};function ky(t,e){return e.nodes[t]||e.marks[t]||null}function Yy(t,e,r){return Object.fromEntries(Object.entries(r).filter(([n])=>{const i=t.find(a=>a.type===e&&a.name===n);return i?i.attribute.keepOnSplit:!1}))}var tJ=(t,e=500)=>{let r="";const n=t.parentOffset;return t.parent.nodesBetween(Math.max(0,n-e),n,(i,a,s,o)=>{var l,u;const c=((u=(l=i.type.spec).toText)==null?void 0:u.call(l,{node:i,pos:a,parent:s,index:o}))||i.textContent||"%leaf%";r+=i.isAtom&&!i.isText?c:c.slice(0,Math.max(0,n-a))}),r};function Ck(t,e,r={}){const{empty:n,ranges:i}=t.selection,a=e?_c(e,t.schema):null;if(n)return!!(t.storedMarks||t.selection.$from.marks()).filter(h=>a?a.name===h.type.name:!0).find(h=>Ix(h.attrs,r,{strict:!1}));let s=0;const o=[];if(i.forEach(({$from:h,$to:p})=>{const g=h.pos,y=p.pos;t.doc.nodesBetween(g,y,(S,w)=>{if(!S.isText&&!S.marks.length)return;const C=Math.max(g,w),_=Math.min(y,w+S.nodeSize),T=_-C;s+=T,o.push(...S.marks.map(N=>({mark:N,from:C,to:_})))})}),s===0)return!1;const l=o.filter(h=>a?a.name===h.mark.type.name:!0).filter(h=>Ix(h.mark.attrs,r,{strict:!1})).reduce((h,p)=>h+p.to-p.from,0),u=o.filter(h=>a?h.mark.type!==a&&h.mark.type.excludes(a):!0).reduce((h,p)=>h+p.to-p.from,0);return(l>0?l+u:l)>=s}function rJ(t,e,r={}){if(!e)return nh(t,null,r)||Ck(t,null,r);const n=J1(e,t.schema);return n==="node"?nh(t,e,r):n==="mark"?Ck(t,e,r):!1}var nJ=(t,e)=>{const{$from:r,$to:n,$anchor:i}=t.selection;if(e){const a=eb(o=>o.type.name===e)(t.selection);if(!a)return!1;const s=t.doc.resolve(a.pos+1);return i.pos+1===s.end()}return!(n.parentOffset<n.parent.nodeSize-2||r.pos!==n.pos)},iJ=t=>{const{$from:e,$to:r}=t.selection;return!(e.parentOffset>0||e.pos!==r.pos)};function fP(t,e){return Array.isArray(e)?e.some(r=>(typeof r=="string"?r:r.name)===t.name):e}function pP(t,e){const{nodeExtensions:r}=Jp(e),n=r.find(s=>s.name===t);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},a=dn(Kt(n,"group",i));return typeof a!="string"?!1:a.split(" ").includes("list")}function tb(t,{checkChildren:e=!0,ignoreWhitespace:r=!1}={}){var n;if(r){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((n=t.text)!=null?n:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(a=>{i!==!1&&(tb(a,{ignoreWhitespace:r,checkChildren:e})||(i=!1))}),i}return!1}function u6(t){return t instanceof Qt}var c6=class d6{constructor(e){this.position=e}static fromJSON(e){return new d6(e.position)}toJSON(){return{position:this.position}}};function aJ(t,e){const r=e.mapping.mapResult(t.position);return{position:new c6(r.pos),mapResult:r}}function sJ(t){return new c6(t)}function oJ(t,e,r){var n;const{selection:i}=e;let a=null;if(YO(i)&&(a=i.$cursor),a){const o=(n=t.storedMarks)!=null?n:a.marks();return a.parent.type.allowsMarkType(r)&&(!!r.isInSet(o)||!o.some(u=>u.type.excludes(r)))}const{ranges:s}=i;return s.some(({$from:o,$to:l})=>{let u=o.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(r):!1;return t.doc.nodesBetween(o.pos,l.pos,(c,h,p)=>{if(u)return!1;if(c.isInline){const g=!p||p.type.allowsMarkType(r),y=!!r.isInSet(c.marks)||!c.marks.some(S=>S.type.excludes(r));u=g&&y}return!u}),u})}var lJ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{const{selection:a}=r,{empty:s,ranges:o}=a,l=_c(t,n.schema);if(i)if(s){const u=e6(n,l);r.addStoredMark(l.create({...u,...e}))}else o.forEach(u=>{const c=u.$from.pos,h=u.$to.pos;n.doc.nodesBetween(c,h,(p,g)=>{const y=Math.max(g,c),S=Math.min(g+p.nodeSize,h);p.marks.find(C=>C.type===l)?p.marks.forEach(C=>{l===C.type&&r.addMark(y,S,l.create({...C.attrs,...e}))}):r.addMark(y,S,l.create(e))})});return oJ(n,r,l)},uJ=(t,e)=>({tr:r})=>(r.setMeta(t,e),!0),cJ=(t,e={})=>({state:r,dispatch:n,chain:i})=>{const a=ji(t,r.schema);let s;return r.selection.$anchor.sameParent(r.selection.$head)&&(s=r.selection.$anchor.parent.attrs),a.isTextblock?i().command(({commands:o})=>T3(a,{...s,...e})(r)?!0:o.clearNodes()).command(({state:o})=>T3(a,{...s,...e})(o,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},dJ=t=>({tr:e,dispatch:r})=>{if(r){const{doc:n}=e,i=af(t,0,n.content.size),a=Qt.create(n,i);e.setSelection(a)}return!0},hJ=(t,e)=>({tr:r,state:n,dispatch:i})=>{const{selection:a}=n;let s,o;return typeof e=="number"?(s=e,o=e):e&&"from"in e&&"to"in e?(s=e.from,o=e.to):(s=a.from,o=a.to),i&&r.doc.nodesBetween(s,o,(l,u)=>{l.isText||r.setNodeMarkup(u,void 0,{...l.attrs,dir:t})}),!0},fJ=t=>({tr:e,dispatch:r})=>{if(r){const{doc:n}=e,{from:i,to:a}=typeof t=="number"?{from:t,to:t}:t,s=dr.atStart(n).from,o=dr.atEnd(n).to,l=af(i,s,o),u=af(a,s,o),c=dr.create(n,l,u);e.setSelection(c)}return!0},pJ=t=>({state:e,dispatch:r})=>{const n=ji(t,e.schema);return oY(n)(e,r)};function mP(t,e){const r=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(r){const n=r.filter(i=>e?.includes(i.type.name));t.tr.ensureMarks(n)}}var mJ=({keepMarks:t=!0}={})=>({tr:e,state:r,dispatch:n,editor:i})=>{const{selection:a,doc:s}=e,{$from:o,$to:l}=a,u=i.extensionManager.attributes,c=Yy(u,o.node().type.name,o.node().attrs);if(a instanceof Qt&&a.node.isBlock)return!o.parentOffset||!mc(s,o.pos)?!1:(n&&(t&&mP(r,i.extensionManager.splittableMarks),e.split(o.pos).scrollIntoView()),!0);if(!o.parent.isBlock)return!1;const h=l.parentOffset===l.parent.content.size,p=o.depth===0?void 0:VQ(o.node(-1).contentMatchAt(o.indexAfter(-1)));let g=h&&p?[{type:p,attrs:c}]:void 0,y=mc(e.doc,e.mapping.map(o.pos),1,g);if(!g&&!y&&mc(e.doc,e.mapping.map(o.pos),1,p?[{type:p}]:void 0)&&(y=!0,g=p?[{type:p,attrs:c}]:void 0),n){if(y&&(a instanceof dr&&e.deleteSelection(),e.split(e.mapping.map(o.pos),1,g),p&&!h&&!o.parentOffset&&o.parent.type!==p)){const S=e.mapping.map(o.before()),w=e.doc.resolve(S);o.node(-1).canReplaceWith(w.index(),w.index()+1,p)&&e.setNodeMarkup(e.mapping.map(o.before()),p)}t&&mP(r,i.extensionManager.splittableMarks),e.scrollIntoView()}return y},gJ=(t,e={})=>({tr:r,state:n,dispatch:i,editor:a})=>{var s;const o=ji(t,n.schema),{$from:l,$to:u}=n.selection,c=n.selection.node;if(c&&c.isBlock||l.depth<2||!l.sameParent(u))return!1;const h=l.node(-1);if(h.type!==o)return!1;const p=a.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==o||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let C=ot.empty;const _=l.index(-1)?1:l.index(-2)?2:3;for(let O=l.depth-_;O>=l.depth-3;O-=1)C=ot.from(l.node(O).copy(C));const T=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,N={...Yy(p,l.node().type.name,l.node().attrs),...e},R=((s=o.contentMatch.defaultType)==null?void 0:s.createAndFill(N))||void 0;C=C.append(ot.from(o.createAndFill(null,R)||void 0));const I=l.before(l.depth-(_-1));r.replace(I,l.after(-T),new Ot(C,4-_,0));let j=-1;r.doc.nodesBetween(I,r.doc.content.size,(O,F)=>{if(j>-1)return!1;O.isTextblock&&O.content.size===0&&(j=F+1)}),j>-1&&r.setSelection(dr.near(r.doc.resolve(j))),r.scrollIntoView()}return!0}const g=u.pos===l.end()?h.contentMatchAt(0).defaultType:null,y={...Yy(p,h.type.name,h.attrs),...e},S={...Yy(p,l.node().type.name,l.node().attrs),...e};r.delete(l.pos,u.pos);const w=g?[{type:o,attrs:y},{type:g,attrs:S}]:[{type:o,attrs:y}];if(!mc(r.doc,l.pos,2))return!1;if(i){const{selection:C,storedMarks:_}=n,{splittableMarks:T}=a.extensionManager,N=_||C.$to.parentOffset&&C.$from.marks();if(r.split(l.pos,2,w).scrollIntoView(),!N||!i)return!0;const R=N.filter(I=>T.includes(I.type.name));r.ensureMarks(R)}return!0},uS=(t,e)=>{const r=eb(s=>s.type===e)(t.selection);if(!r)return!0;const n=t.doc.resolve(Math.max(0,r.pos-1)).before(r.depth);if(n===void 0)return!0;const i=t.doc.nodeAt(n);return r.node.type===i?.type&&hh(t.doc,r.pos)&&t.join(r.pos),!0},cS=(t,e)=>{const r=eb(s=>s.type===e)(t.selection);if(!r)return!0;const n=t.doc.resolve(r.start).after(r.depth);if(n===void 0)return!0;const i=t.doc.nodeAt(n);return r.node.type===i?.type&&hh(t.doc,n)&&t.join(n),!0},vJ=(t,e,r,n={})=>({editor:i,tr:a,state:s,dispatch:o,chain:l,commands:u,can:c})=>{const{extensions:h,splittableMarks:p}=i.extensionManager,g=ji(t,s.schema),y=ji(e,s.schema),{selection:S,storedMarks:w}=s,{$from:C,$to:_}=S,T=C.blockRange(_),N=w||S.$to.parentOffset&&S.$from.marks();if(!T)return!1;const R=eb(I=>pP(I.type.name,h))(S);if(T.depth>=1&&R&&T.depth-R.depth<=1){if(R.node.type===g)return u.liftListItem(y);if(pP(R.node.type.name,h)&&g.validContent(R.node.content)&&o)return l().command(()=>(a.setNodeMarkup(R.pos,g),!0)).command(()=>uS(a,g)).command(()=>cS(a,g)).run()}return!r||!N||!o?l().command(()=>c().wrapInList(g,n)?!0:u.clearNodes()).wrapInList(g,n).command(()=>uS(a,g)).command(()=>cS(a,g)).run():l().command(()=>{const I=c().wrapInList(g,n),j=N.filter(O=>p.includes(O.type.name));return a.ensureMarks(j),I?!0:u.clearNodes()}).wrapInList(g,n).command(()=>uS(a,g)).command(()=>cS(a,g)).run()},yJ=(t,e={},r={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:a=!1}=r,s=_c(t,n.schema);return Ck(n,s,e)?i.unsetMark(s,{extendEmptyMarkRange:a}):i.setMark(s,e)},xJ=(t,e,r={})=>({state:n,commands:i})=>{const a=ji(t,n.schema),s=ji(e,n.schema),o=nh(n,a,r);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),o?i.setNode(s,l):i.setNode(a,{...l,...r})},bJ=(t,e={})=>({state:r,commands:n})=>{const i=ji(t,r.schema);return nh(r,i,e)?n.lift(i):n.wrapIn(i,e)},wJ=()=>({state:t,dispatch:e})=>{const r=t.plugins;for(let n=0;n<r.length;n+=1){const i=r[n];let a;if(i.spec.isInputRules&&(a=i.getState(t))){if(e){const s=t.tr,o=a.transform;for(let l=o.steps.length-1;l>=0;l-=1)s.step(o.steps[l].invert(o.docs[l]));if(a.text){const l=s.doc.resolve(a.from).marks();s.replaceWith(a.from,a.to,t.schema.text(a.text,l))}else s.delete(a.from,a.to)}return!0}}return!1},SJ=()=>({tr:t,dispatch:e})=>{const{selection:r}=t,{empty:n,ranges:i}=r;return n||e&&i.forEach(a=>{t.removeMark(a.$from.pos,a.$to.pos)}),!0},kJ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{var a;const{extendEmptyMarkRange:s=!1}=e,{selection:o}=r,l=_c(t,n.schema),{$from:u,empty:c,ranges:h}=o;if(!i)return!0;if(c&&s){let{from:p,to:g}=o;const y=(a=u.marks().find(w=>w.type===l))==null?void 0:a.attrs,S=rC(u,l,y);S&&(p=S.from,g=S.to),r.removeMark(p,g,l)}else h.forEach(p=>{r.removeMark(p.$from.pos,p.$to.pos,l)});return r.removeStoredMark(l),!0},_J=t=>({tr:e,state:r,dispatch:n})=>{const{selection:i}=r;let a,s;return typeof t=="number"?(a=t,s=t):t&&"from"in t&&"to"in t?(a=t.from,s=t.to):(a=i.from,s=i.to),n&&e.doc.nodesBetween(a,s,(o,l)=>{if(o.isText)return;const u={...o.attrs};delete u.dir,e.setNodeMarkup(l,void 0,u)}),!0},CJ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{let a=null,s=null;const o=J1(typeof t=="string"?t:t.name,n.schema);if(!o)return!1;o==="node"&&(a=ji(t,n.schema)),o==="mark"&&(s=_c(t,n.schema));let l=!1;return r.selection.ranges.forEach(u=>{const c=u.$from.pos,h=u.$to.pos;let p,g,y,S;r.selection.empty?n.doc.nodesBetween(c,h,(w,C)=>{a&&a===w.type&&(l=!0,y=Math.max(C,c),S=Math.min(C+w.nodeSize,h),p=C,g=w)}):n.doc.nodesBetween(c,h,(w,C)=>{C<c&&a&&a===w.type&&(l=!0,y=Math.max(C,c),S=Math.min(C+w.nodeSize,h),p=C,g=w),C>=c&&C<=h&&(a&&a===w.type&&(l=!0,i&&r.setNodeMarkup(C,void 0,{...w.attrs,...e})),s&&w.marks.length&&w.marks.forEach(_=>{if(s===_.type&&(l=!0,i)){const T=Math.max(C,c),N=Math.min(C+w.nodeSize,h);r.addMark(T,N,s.create({..._.attrs,...e}))}}))}),g&&(p!==void 0&&i&&r.setNodeMarkup(p,void 0,{...g.attrs,...e}),s&&g.marks.length&&g.marks.forEach(w=>{s===w.type&&i&&r.addMark(y,S,s.create({...w.attrs,...e}))}))}),l},EJ=(t,e={})=>({state:r,dispatch:n})=>{const i=ji(t,r.schema);return eY(i,e)(r,n)},TJ=(t,e={})=>({state:r,dispatch:n})=>{const i=ji(t,r.schema);return tY(i,e)(r,n)},NJ=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const r=this.callbacks[t];return r&&r.forEach(n=>n.apply(this,e)),this}off(t,e){const r=this.callbacks[t];return r&&(e?this.callbacks[t]=r.filter(n=>n!==e):delete this.callbacks[t]),this}once(t,e){const r=(...n)=>{this.off(t,r),e.apply(this,n)};return this.on(t,r)}removeAllListeners(){this.callbacks={}}},rb=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},PJ=(t,e)=>{if(tC(e))return e.exec(t);const r=e(t);if(!r)return null;const n=[r.text];return n.index=r.index,n.input=t,n.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),n.push(r.replaceWith)),n};function _y(t){var e;const{editor:r,from:n,to:i,text:a,rules:s,plugin:o}=t,{view:l}=r;if(l.composing)return!1;const u=l.state.doc.resolve(n);if(u.parent.type.spec.code||(e=u.nodeBefore||u.nodeAfter)!=null&&e.marks.find(p=>p.type.spec.code))return!1;let c=!1;const h=tJ(u)+a;return s.forEach(p=>{if(c)return;const g=PJ(h,p.find);if(!g)return;const y=l.state.tr,S=X1({state:l.state,transaction:y}),w={from:n-(g[0].length-a.length),to:i},{commands:C,chain:_,can:T}=new Q1({editor:r,state:S});p.handler({state:S,range:w,match:g,commands:C,chain:_,can:T})===null||!y.steps.length||(p.undoable&&y.setMeta(o,{transform:y,from:n,to:i,text:a}),l.dispatch(y),c=!0)}),c}function MJ(t){const{editor:e,rules:r}=t,n=new Yn({state:{init(){return null},apply(i,a,s){const o=i.getMeta(n);if(o)return o;const l=i.getMeta("applyInputRules");return l&&setTimeout(()=>{let{text:c}=l;typeof c=="string"?c=c:c=iC(ot.from(c),s.schema);const{from:h}=l,p=h+c.length;_y({editor:e,from:h,to:p,text:c,rules:r,plugin:n})}),i.selectionSet||i.docChanged?null:a}},props:{handleTextInput(i,a,s,o){return _y({editor:e,from:a,to:s,text:o,rules:r,plugin:n})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:a}=i.state.selection;a&&_y({editor:e,from:a.pos,to:a.pos,text:"",rules:r,plugin:n})}),!1)},handleKeyDown(i,a){if(a.key!=="Enter")return!1;const{$cursor:s}=i.state.selection;return s?_y({editor:e,from:s.pos,to:s.pos,text:`
`,rules:r,plugin:n}):!1}},isInputRules:!0});return n}function AJ(t){return Object.prototype.toString.call(t).slice(8,-1)}function Cy(t){return AJ(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function h6(t,e){const r={...t};return Cy(t)&&Cy(e)&&Object.keys(e).forEach(n=>{Cy(e[n])&&Cy(t[n])?r[n]=h6(t[n],e[n]):r[n]=e[n]}),r}var sC=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...dn(Kt(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...dn(Kt(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>h6(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},Lf=class f6 extends sC{constructor(){super(...arguments),this.type="mark"}static create(e={}){const r=typeof e=="function"?e():e;return new f6(r)}static handleExit({editor:e,mark:r}){const{tr:n}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const s=i.marks();if(!!!s.find(u=>u?.type.name===r.name))return!1;const l=s.find(u=>u?.type.name===r.name);return l&&n.removeStoredMark(l),n.insertText(" ",i.pos),e.view.dispatch(n),!0}return!1}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}};function LJ(t){return typeof t=="number"}var RJ=class{constructor(t){this.find=t.find,this.handler=t.handler}},OJ=(t,e,r)=>{if(tC(e))return[...t.matchAll(e)];const n=e(t,r);return n?n.map(i=>{const a=[i.text];return a.index=i.index,a.input=t,a.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),a.push(i.replaceWith)),a}):[]};function DJ(t){const{editor:e,state:r,from:n,to:i,rule:a,pasteEvent:s,dropEvent:o}=t,{commands:l,chain:u,can:c}=new Q1({editor:e,state:r}),h=[];return r.doc.nodesBetween(n,i,(g,y)=>{var S,w,C,_,T;if((w=(S=g.type)==null?void 0:S.spec)!=null&&w.code||!(g.isText||g.isTextblock||g.isInline))return;const N=(T=(_=(C=g.content)==null?void 0:C.size)!=null?_:g.nodeSize)!=null?T:0,R=Math.max(n,y),I=Math.min(i,y+N);if(R>=I)return;const j=g.isText?g.text||"":g.textBetween(R-y,I-y,void 0,"");OJ(j,a.find,s).forEach(F=>{if(F.index===void 0)return;const z=R+F.index+1,V=z+F[0].length,q={from:r.tr.mapping.map(z),to:r.tr.mapping.map(V)},D=a.handler({state:r,range:q,match:F,commands:l,chain:u,can:c,pasteEvent:s,dropEvent:o});h.push(D)})}),h.every(g=>g!==null)}var Ey=null,IJ=t=>{var e;const r=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=r.clipboardData)==null||e.setData("text/html",t),r};function jJ(t){const{editor:e,rules:r}=t;let n=null,i=!1,a=!1,s=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,o;try{o=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{o=null}const l=({state:c,from:h,to:p,rule:g,pasteEvt:y})=>{const S=c.tr,w=X1({state:c,transaction:S});if(!(!DJ({editor:e,state:w,from:Math.max(h-1,0),to:p.b-1,rule:g,pasteEvent:y,dropEvent:o})||!S.steps.length)){try{o=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{o=null}return s=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,S}};return r.map(c=>new Yn({view(h){const p=y=>{var S;n=(S=h.dom.parentElement)!=null&&S.contains(y.target)?h.dom.parentElement:null,n&&(Ey=e)},g=()=>{Ey&&(Ey=null)};return window.addEventListener("dragstart",p),window.addEventListener("dragend",g),{destroy(){window.removeEventListener("dragstart",p),window.removeEventListener("dragend",g)}}},props:{handleDOMEvents:{drop:(h,p)=>{if(a=n===h.dom.parentElement,o=p,!a){const g=Ey;g?.isEditable&&setTimeout(()=>{const y=g.state.selection;y&&g.commands.deleteRange({from:y.from,to:y.to})},10)}return!1},paste:(h,p)=>{var g;const y=(g=p.clipboardData)==null?void 0:g.getData("text/html");return s=p,i=!!y?.includes("data-pm-slice"),!1}}},appendTransaction:(h,p,g)=>{const y=h[0],S=y.getMeta("uiEvent")==="paste"&&!i,w=y.getMeta("uiEvent")==="drop"&&!a,C=y.getMeta("applyPasteRules"),_=!!C;if(!S&&!w&&!_)return;if(_){let{text:R}=C;typeof R=="string"?R=R:R=iC(ot.from(R),g.schema);const{from:I}=C,j=I+R.length,O=IJ(R);return l({rule:c,state:g,from:I,to:{b:j},pasteEvt:O})}const T=p.doc.content.findDiffStart(g.doc.content),N=p.doc.content.findDiffEnd(g.doc.content);if(!(!LJ(T)||!N||T===N.b))return l({rule:c,state:g,from:T,to:N,pasteEvt:s})}}))}var nb=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=i6(t),this.schema=KQ(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:ky(e.name,this.schema)},n=Kt(e,"addCommands",r);return n?{...t,...n()}:t},{})}get plugins(){const{editor:t}=this;return Fx([...this.extensions].reverse()).flatMap(n=>{const i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:ky(n.name,this.schema)},a=[],s=Kt(n,"addKeyboardShortcuts",i);let o={};if(n.type==="mark"&&Kt(n,"exitable",i)&&(o.ArrowRight=()=>Lf.handleExit({editor:t,mark:n})),s){const p=Object.fromEntries(Object.entries(s()).map(([g,y])=>[g,()=>y({editor:t})]));o={...o,...p}}const l=XX(o);a.push(l);const u=Kt(n,"addInputRules",i);if(fP(n,t.options.enableInputRules)&&u){const p=u();if(p&&p.length){const g=MJ({editor:t,rules:p}),y=Array.isArray(g)?g:[g];a.push(...y)}}const c=Kt(n,"addPasteRules",i);if(fP(n,t.options.enablePasteRules)&&c){const p=c();if(p&&p.length){const g=jJ({editor:t,rules:p});a.push(...g)}}const h=Kt(n,"addProseMirrorPlugins",i);if(h){const p=h();a.push(...p)}return a})}get attributes(){return n6(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=Jp(this.extensions);return Object.fromEntries(e.filter(r=>!!Kt(r,"addNodeView")).map(r=>{const n=this.attributes.filter(l=>l.type===r.name),i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:ji(r.name,this.schema)},a=Kt(r,"addNodeView",i);if(!a)return[];const s=a();if(!s)return[];const o=(l,u,c,h,p)=>{const g=zv(l,n);return s({node:l,view:u,getPos:c,decorations:h,innerDecorations:p,editor:t,extension:r,HTMLAttributes:g})};return[r.name,o]}))}dispatchTransaction(t){const{editor:e}=this;return Fx([...this.extensions].reverse()).reduceRight((n,i)=>{const a={name:i.name,options:i.options,storage:this.editor.extensionStorage[i.name],editor:e,type:ky(i.name,this.schema)},s=Kt(i,"dispatchTransaction",a);return s?o=>{s.call(a,{transaction:o,next:n})}:n},t)}get markViews(){const{editor:t}=this,{markExtensions:e}=Jp(this.extensions);return Object.fromEntries(e.filter(r=>!!Kt(r,"addMarkView")).map(r=>{const n=this.attributes.filter(o=>o.type===r.name),i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:_c(r.name,this.schema)},a=Kt(r,"addMarkView",i);if(!a)return[];const s=(o,l,u)=>{const c=zv(o,n);return a()({mark:o,view:l,inline:u,editor:t,extension:r,HTMLAttributes:c,updateAttributes:h=>{XJ(o,t,h)}})};return[r.name,s]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var r;const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:ky(e.name,this.schema)};e.type==="mark"&&((r=dn(Kt(e,"keepOnSplit",n)))==null||r)&&this.splittableMarks.push(e.name);const i=Kt(e,"onBeforeCreate",n),a=Kt(e,"onCreate",n),s=Kt(e,"onUpdate",n),o=Kt(e,"onSelectionUpdate",n),l=Kt(e,"onTransaction",n),u=Kt(e,"onFocus",n),c=Kt(e,"onBlur",n),h=Kt(e,"onDestroy",n);i&&this.editor.on("beforeCreate",i),a&&this.editor.on("create",a),s&&this.editor.on("update",s),o&&this.editor.on("selectionUpdate",o),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),c&&this.editor.on("blur",c),h&&this.editor.on("destroy",h)})}};nb.resolve=i6;nb.sort=Fx;nb.flatten=nC;var FJ={};eC(FJ,{ClipboardTextSerializer:()=>m6,Commands:()=>g6,Delete:()=>v6,Drop:()=>y6,Editable:()=>x6,FocusEvents:()=>w6,Keymap:()=>S6,Paste:()=>k6,Tabindex:()=>_6,TextDirection:()=>C6,focusEventsPluginKey:()=>b6});var Ni=class p6 extends sC{constructor(){super(...arguments),this.type="extension"}static create(e={}){const r=typeof e=="function"?e():e;return new p6(r)}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}},m6=Ni.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Yn({key:new Ti("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:r}=t,{doc:n,selection:i}=e,{ranges:a}=i,s=Math.min(...a.map(c=>c.$from.pos)),o=Math.max(...a.map(c=>c.$to.pos)),l=s6(r);return a6(n,{from:s,to:o},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),g6=Ni.create({name:"commands",addCommands(){return{...KO}}}),v6=Ni.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var r,n,i;const a=()=>{var s,o,l,u;if((u=(l=(o=(s=this.editor.options.coreExtensionOptions)==null?void 0:s.delete)==null?void 0:o.filterTransaction)==null?void 0:l.call(o,t))!=null?u:t.getMeta("y-sync$"))return;const c=t6(t.before,[t,...e]);l6(c).forEach(g=>{c.mapping.mapResult(g.oldRange.from).deletedAfter&&c.mapping.mapResult(g.oldRange.to).deletedBefore&&c.before.nodesBetween(g.oldRange.from,g.oldRange.to,(y,S)=>{const w=S+y.nodeSize-2,C=g.oldRange.from<=S&&w<=g.oldRange.to;this.editor.emit("delete",{type:"node",node:y,from:S,to:w,newFrom:c.mapping.map(S),newTo:c.mapping.map(w),deletedRange:g.oldRange,newRange:g.newRange,partial:!C,editor:this.editor,transaction:t,combinedTransform:c})})});const p=c.mapping;c.steps.forEach((g,y)=>{var S,w;if(g instanceof Ol){const C=p.slice(y).map(g.from,-1),_=p.slice(y).map(g.to),T=p.invert().map(C,-1),N=p.invert().map(_),R=(S=c.doc.nodeAt(C-1))==null?void 0:S.marks.some(j=>j.eq(g.mark)),I=(w=c.doc.nodeAt(_))==null?void 0:w.marks.some(j=>j.eq(g.mark));this.editor.emit("delete",{type:"mark",mark:g.mark,from:g.from,to:g.to,deletedRange:{from:T,to:N},newRange:{from:C,to:_},partial:!!(I||R),editor:this.editor,transaction:t,combinedTransform:c})}})};(i=(n=(r=this.editor.options.coreExtensionOptions)==null?void 0:r.delete)==null?void 0:n.async)==null||i?setTimeout(a,0):a()}}),y6=Ni.create({name:"drop",addProseMirrorPlugins(){return[new Yn({key:new Ti("tiptapDrop"),props:{handleDrop:(t,e,r,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:r,moved:n})}}})]}}),x6=Ni.create({name:"editable",addProseMirrorPlugins(){return[new Yn({key:new Ti("editable"),props:{editable:()=>this.editor.options.editable}})]}}),b6=new Ti("focusEvents"),w6=Ni.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Yn({key:b6,props:{handleDOMEvents:{focus:(e,r)=>{t.isFocused=!0;const n=t.state.tr.setMeta("focus",{event:r}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,r)=>{t.isFocused=!1;const n=t.state.tr.setMeta("blur",{event:r}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),S6=Ni.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:s})=>[()=>s.undoInputRule(),()=>s.command(({tr:o})=>{const{selection:l,doc:u}=o,{empty:c,$anchor:h}=l,{pos:p,parent:g}=h,y=h.parent.isTextblock&&p>0?o.doc.resolve(p-1):h,S=y.parent.type.spec.isolating,w=h.pos-h.parentOffset,C=S&&y.parent.childCount===1?w===h.pos:Sr.atStart(u).from===p;return!c||!g.type.isTextblock||g.textContent.length||!C||C&&h.parent.type.name==="paragraph"?!1:s.clearNodes()}),()=>s.deleteSelection(),()=>s.joinBackward(),()=>s.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:s})=>[()=>s.deleteSelection(),()=>s.deleteCurrentNode(),()=>s.joinForward(),()=>s.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:s})=>[()=>s.newlineInCode(),()=>s.createParagraphNear(),()=>s.liftEmptyBlock(),()=>s.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},a={...n,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return jx()||JO()?a:i},addProseMirrorPlugins(){return[new Yn({key:new Ti("clearDocument"),appendTransaction:(t,e,r)=>{if(t.some(S=>S.getMeta("composition")))return;const n=t.some(S=>S.docChanged)&&!e.doc.eq(r.doc),i=t.some(S=>S.getMeta("preventClearDocument"));if(!n||i)return;const{empty:a,from:s,to:o}=e.selection,l=Sr.atStart(e.doc).from,u=Sr.atEnd(e.doc).to;if(a||!(s===l&&o===u)||!tb(r.doc))return;const p=r.tr,g=X1({state:r,transaction:p}),{commands:y}=new Q1({editor:this.editor,state:g});if(y.clearNodes(),!!p.steps.length)return p}})]}}),k6=Ni.create({name:"paste",addProseMirrorPlugins(){return[new Yn({key:new Ti("tiptapPaste"),props:{handlePaste:(t,e,r)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:r})}}})]}}),_6=Ni.create({name:"tabindex",addProseMirrorPlugins(){return[new Yn({key:new Ti("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),C6=Ni.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=Jp(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const r=e.getAttribute("dir");return r&&(r==="ltr"||r==="rtl"||r==="auto")?r:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Yn({key:new Ti("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}}),BJ=class Pp{constructor(e,r,n=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=r,this.currentNode=i}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let r=this.from,n=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}r=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:r,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),r=this.resolvedPos.doc.resolve(e);return new Pp(r,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Pp(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Pp(e,this.editor)}get children(){const e=[];return this.node.content.forEach((r,n)=>{const i=r.isBlock&&!r.isTextblock,a=r.isAtom&&!r.isText,s=this.pos+n+(a?0:1);if(s<0||s>this.resolvedPos.doc.nodeSize-2)return;const o=this.resolvedPos.doc.resolve(s);if(!i&&o.depth<=this.depth)return;const l=new Pp(o,this.editor,i,i?r:null);i&&(l.actualDepth=this.depth+1),e.push(new Pp(o,this.editor,i,i?r:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,r={}){let n=null,i=this.parent;for(;i&&!n;){if(i.node.type.name===e)if(Object.keys(r).length>0){const a=i.node.attrs,s=Object.keys(r);for(let o=0;o<s.length;o+=1){const l=s[o];if(a[l]!==r[l])break}}else n=i;i=i.parent}return n}querySelector(e,r={}){return this.querySelectorAll(e,r,!0)[0]||null}querySelectorAll(e,r={},n=!1){let i=[];if(!this.children||this.children.length===0)return i;const a=Object.keys(r);return this.children.forEach(s=>{n&&i.length>0||(s.node.type.name===e&&a.every(l=>r[l]===s.node.attrs[l])&&i.push(s),!(n&&i.length>0)&&(i=i.concat(s.querySelectorAll(e,r,n))))}),i}setAttribute(e){const{tr:r}=this.editor.state;r.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(r)}},zJ=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function UJ(t,e,r){const n=document.querySelector("style[data-tiptap-style]");if(n!==null)return n;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}var GJ=class extends NJ{constructor(t={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null,enableExtensionDispatchTransaction:!0},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:aJ,createMappablePosition:sJ},this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:i,moved:a})=>this.options.onDrop(n,i,a)),this.on("paste",({event:n,slice:i})=>this.options.onPaste(n,i)),this.on("delete",this.options.onDelete);const e=this.createDoc(),r=XO(e,this.options.autofocus);this.editorState=Dp.create({doc:e,schema:this.schema,selection:r||void 0}),this.options.element&&this.mount(this.options.element)}mount(t){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const t=this.editorView.dom;t?.editor&&delete t.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(t){console.warn("Failed to remove CSS element:",t)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=UJ(zJ,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:t=>{this.editorState=t},dispatch:t=>{this.dispatchTransaction(t)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(t,e)=>{if(this.editorView)return this.editorView[e];if(e==="state")return this.editorState;if(e in t)return Reflect.get(t,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(t,e){const r=r6(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],n=this.state.reconfigure({plugins:r});return this.view.updateState(n),n}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let r=e;if([].concat(t).forEach(i=>{const a=typeof i=="string"?`${i}$`:i.key;r=r.filter(s=>!s.key.startsWith(a))}),e.length===r.length)return;const n=this.state.reconfigure({plugins:r});return this.view.updateState(n),n}createExtensionManager(){var t,e;const n=[...this.options.enableCoreExtensions?[x6,m6.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)==null?void 0:t.clipboardTextSerializer)==null?void 0:e.blockSeparator}),g6,w6,S6,_6,y6,k6,v6,C6.configure({direction:this.options.textDirection})].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i?.type));this.extensionManager=new nb(n,this)}createCommandManager(){this.commandManager=new Q1({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let t;try{t=_k(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(r=>r.name!=="collaboration"),this.createExtensionManager()}}),t=_k(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t}createView(t){const{editorProps:e,enableExtensionDispatchTransaction:r}=this.options,n=e.dispatchTransaction||this.dispatchTransaction.bind(this),i=r?this.extensionManager.dispatchTransaction(n):n;this.editorView=new qO(t,{...e,attributes:{role:"textbox",...e?.attributes},dispatchTransaction:i,state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const a=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(a),this.prependClass(),this.injectCSS();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(u=>{var c;return(c=this.capturedTransaction)==null?void 0:c.step(u)});return}const{state:e,transactions:r}=this.state.applyTransaction(t),n=!this.state.selection.eq(e.selection),i=r.includes(t),a=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),!i)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:r.slice(1)}),n&&this.emit("selectionUpdate",{editor:this,transaction:t});const s=r.findLast(u=>u.getMeta("focus")||u.getMeta("blur")),o=s?.getMeta("focus"),l=s?.getMeta("blur");o&&this.emit("focus",{editor:this,event:o.event,transaction:s}),l&&this.emit("blur",{editor:this,event:l.event,transaction:s}),!(t.getMeta("preventUpdate")||!r.some(u=>u.docChanged)||a.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:t,appendedTransactions:r.slice(1)})}getAttributes(t){return o6(this.state,t)}isActive(t,e){const r=typeof t=="string"?t:null,n=typeof t=="string"?e:t;return rJ(this.state,r,n)}getJSON(){return this.state.doc.toJSON()}getHTML(){return iC(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:r={}}=t||{};return YQ(this.state.doc,{blockSeparator:e,textSerializers:{...s6(this.schema),...r}})}get isEmpty(){return tb(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var t,e;return(e=(t=this.editorView)==null?void 0:t.isDestroyed)!=null?e:!0}$node(t,e){var r;return((r=this.$doc)==null?void 0:r.querySelector(t,e))||null}$nodes(t,e){var r;return((r=this.$doc)==null?void 0:r.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new BJ(e,this)}get $doc(){return this.$pos(0)}};function em(t){return new rb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=dn(t.getAttributes,void 0,n);if(i===!1||i===null)return null;const{tr:a}=e,s=n[n.length-1],o=n[0];if(s){const l=o.search(/\S/),u=r.from+o.indexOf(s),c=u+s.length;if(aC(r.from,r.to,e.doc).filter(g=>g.mark.type.excluded.find(S=>S===t.type&&S!==g.mark.type)).filter(g=>g.to>u).length)return null;c<r.to&&a.delete(c,r.to),u>r.from&&a.delete(r.from+l,u);const p=r.from+l+s.length;a.addMark(r.from+l,p,t.type.create(i||{})),a.removeStoredMark(t.type)}},undoable:t.undoable})}function VJ(t){return new rb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=dn(t.getAttributes,void 0,n)||{},{tr:a}=e,s=r.from;let o=r.to;const l=t.type.create(i);if(n[1]){const u=n[0].lastIndexOf(n[1]);let c=s+u;c>o?c=o:o=c+n[1].length;const h=n[0][n[0].length-1];a.insertText(h,s+n[0].length-1),a.replaceWith(c,o,l)}else if(n[0]){const u=t.type.isInline?s:s-1;a.insert(u,t.type.create(i)).delete(a.mapping.map(s),a.mapping.map(o))}a.scrollIntoView()},undoable:t.undoable})}function Ek(t){return new rb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=e.doc.resolve(r.from),a=dn(t.getAttributes,void 0,n)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(r.from,r.to).setBlockType(r.from,r.from,t.type,a)},undoable:t.undoable})}function tm(t){return new rb({find:t.find,handler:({state:e,range:r,match:n,chain:i})=>{const a=dn(t.getAttributes,void 0,n)||{},s=e.tr.delete(r.from,r.to),l=s.doc.resolve(r.from).blockRange(),u=l&&F_(l,t.type,a);if(!u)return null;if(s.wrap(l,u),t.keepMarks&&t.editor){const{selection:h,storedMarks:p}=e,{splittableMarks:g}=t.editor.extensionManager,y=p||h.$to.parentOffset&&h.$from.marks();if(y){const S=y.filter(w=>g.includes(w.type.name));s.ensureMarks(S)}}if(t.keepAttributes){const h=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(h,a).run()}const c=s.doc.resolve(r.from-1).nodeBefore;c&&c.type===t.type&&hh(s.doc,r.from-1)&&(!t.joinPredicate||t.joinPredicate(n,c))&&s.join(r.from-1)},undoable:t.undoable})}function HJ(t,e){const{selection:r}=t,{$from:n}=r;if(r instanceof Qt){const a=n.index();return n.parent.canReplaceWith(a,a+1,e)}let i=n.depth;for(;i>=0;){const a=n.index(i);if(n.node(i).contentMatchAt(a).matchType(e))return!0;i-=1}return!1}function WJ(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}var qJ={};eC(qJ,{createAtomBlockMarkdownSpec:()=>$J,createBlockMarkdownSpec:()=>KJ,createInlineMarkdownSpec:()=>E6,parseAttributes:()=>oC,parseIndentedBlocks:()=>Tk,renderNestedMarkdownContent:()=>uC,serializeAttributes:()=>lC});function oC(t){if(!t?.trim())return{};const e={},r=[],n=t.replace(/["']([^"']*)["']/g,u=>(r.push(u),`__QUOTED_${r.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const u=i.map(c=>c.trim().slice(1));e.class=u.join(" ")}const a=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);a&&(e.id=a[1]);const s=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(s)).forEach(([,u,c])=>{var h;const p=parseInt(((h=c.match(/__QUOTED_(\d+)__/))==null?void 0:h[1])||"0",10),g=r[p];g&&(e[u]=g.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(c=>{c.match(/^[a-zA-Z][\w-]*$/)&&(e[c]=!0)}),e}function lC(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([r,n])=>{r==="class"||r==="id"||(n===!0?e.push(r):n!==!1&&n!=null&&e.push(`${r}="${String(n)}"`))}),e.join(" ")}function $J(t){const{nodeName:e,name:r,parseAttributes:n=oC,serializeAttributes:i=lC,defaultAttributes:a={},requiredAttributes:s=[],allowedAttributes:o}=t,l=r||e,u=c=>{if(!o)return c;const h={};return o.forEach(p=>{p in c&&(h[p]=c[p])}),h};return{parseMarkdown:(c,h)=>{const p={...a,...c.attributes};return h.createNode(e,p,[])},markdownTokenizer:{name:e,level:"block",start(c){var h;const p=new RegExp(`^:::${l}(?:\\s|$)`,"m"),g=(h=c.match(p))==null?void 0:h.index;return g!==void 0?g:-1},tokenize(c,h,p){const g=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),y=c.match(g);if(!y)return;const S=y[1]||"",w=n(S);if(!s.find(_=>!(_ in w)))return{type:e,raw:y[0],attributes:w}}},renderMarkdown:c=>{const h=u(c.attrs||{}),p=i(h),g=p?` {${p}}`:"";return`:::${l}${g} :::`}}}function KJ(t){const{nodeName:e,name:r,getContent:n,parseAttributes:i=oC,serializeAttributes:a=lC,defaultAttributes:s={},content:o="block",allowedAttributes:l}=t,u=r||e,c=h=>{if(!l)return h;const p={};return l.forEach(g=>{g in h&&(p[g]=h[g])}),p};return{parseMarkdown:(h,p)=>{let g;if(n){const S=n(h);g=typeof S=="string"?[{type:"text",text:S}]:S}else o==="block"?g=p.parseChildren(h.tokens||[]):g=p.parseInline(h.tokens||[]);const y={...s,...h.attributes};return p.createNode(e,y,g)},markdownTokenizer:{name:e,level:"block",start(h){var p;const g=new RegExp(`^:::${u}`,"m"),y=(p=h.match(g))==null?void 0:p.index;return y!==void 0?y:-1},tokenize(h,p,g){var y;const S=new RegExp(`^:::${u}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),w=h.match(S);if(!w)return;const[C,_=""]=w,T=i(_);let N=1;const R=C.length;let I="";const j=/^:::([\w-]*)(\s.*)?/gm,O=h.slice(R);for(j.lastIndex=0;;){const F=j.exec(O);if(F===null)break;const z=F.index,V=F[1];if(!((y=F[2])!=null&&y.endsWith(":::"))){if(V)N+=1;else if(N-=1,N===0){const q=O.slice(0,z);I=q.trim();const D=h.slice(0,R+z+F[0].length);let U=[];if(I)if(o==="block")for(U=g.blockTokens(q),U.forEach(G=>{G.text&&(!G.tokens||G.tokens.length===0)&&(G.tokens=g.inlineTokens(G.text))});U.length>0;){const G=U[U.length-1];if(G.type==="paragraph"&&(!G.text||G.text.trim()===""))U.pop();else break}else U=g.inlineTokens(I);return{type:e,raw:D,attributes:T,content:I,tokens:U}}}}}},renderMarkdown:(h,p)=>{const g=c(h.attrs||{}),y=a(g),S=y?` {${y}}`:"",w=p.renderChildren(h.content||[],`

`);return`:::${u}${S}

${w}

:::`}}}function ZJ(t){if(!t.trim())return{};const e={},r=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=r.exec(t);for(;n!==null;){const[,i,a,s]=n;e[i]=a||s,n=r.exec(t)}return e}function YJ(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,r])=>`${e}="${r}"`).join(" ")}function E6(t){const{nodeName:e,name:r,getContent:n,parseAttributes:i=ZJ,serializeAttributes:a=YJ,defaultAttributes:s={},selfClosing:o=!1,allowedAttributes:l}=t,u=r||e,c=p=>{if(!l)return p;const g={};return l.forEach(y=>{const S=typeof y=="string"?y:y.name,w=typeof y=="string"?void 0:y.skipIfDefault;if(S in p){const C=p[S];if(w!==void 0&&C===w)return;g[S]=C}}),g},h=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(p,g)=>{const y={...s,...p.attributes};if(o)return g.createNode(e,y);const S=n?n(p):p.content||"";return S?g.createNode(e,y,[g.createTextNode(S)]):g.createNode(e,y,[])},markdownTokenizer:{name:e,level:"inline",start(p){const g=o?new RegExp(`\\[${h}\\s*[^\\]]*\\]`):new RegExp(`\\[${h}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${h}\\]`),y=p.match(g),S=y?.index;return S!==void 0?S:-1},tokenize(p,g,y){const S=o?new RegExp(`^\\[${h}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${h}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${h}\\]`),w=p.match(S);if(!w)return;let C="",_="";if(o){const[,N]=w;_=N}else{const[,N,R]=w;_=N,C=R||""}const T=i(_.trim());return{type:e,raw:w[0],content:C.trim(),attributes:T}}},renderMarkdown:p=>{let g="";n?g=n(p):p.content&&p.content.length>0&&(g=p.content.filter(C=>C.type==="text").map(C=>C.text).join(""));const y=c(p.attrs||{}),S=a(y),w=S?` ${S}`:"";return o?`[${u}${w}]`:`[${u}${w}]${g}[/${u}]`}}}function Tk(t,e,r){var n,i,a,s;const o=t.split(`
`),l=[];let u="",c=0;const h=e.baseIndentSize||2;for(;c<o.length;){const p=o[c],g=p.match(e.itemPattern);if(!g){if(l.length>0)break;if(p.trim()===""){c+=1,u=`${u}${p}
`;continue}else return}const y=e.extractItemData(g),{indentLevel:S,mainContent:w}=y;u=`${u}${p}
`;const C=[w];for(c+=1;c<o.length;){const R=o[c];if(R.trim()===""){const j=o.slice(c+1).findIndex(z=>z.trim()!=="");if(j===-1)break;if((((i=(n=o[c+1+j].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>S){C.push(R),u=`${u}${R}
`,c+=1;continue}else break}if((((s=(a=R.match(/^(\s*)/))==null?void 0:a[1])==null?void 0:s.length)||0)>S)C.push(R),u=`${u}${R}
`,c+=1;else break}let _;const T=C.slice(1);if(T.length>0){const R=T.map(I=>I.slice(S+h)).join(`
`);R.trim()&&(e.customNestedParser?_=e.customNestedParser(R):_=r.blockTokens(R))}const N=e.createToken(y,_);l.push(N)}if(l.length!==0)return{items:l,raw:u}}function uC(t,e,r,n){if(!t||!Array.isArray(t.content))return"";const i=typeof r=="function"?r(n):r,[a,...s]=t.content,o=e.renderChildren([a]),l=[`${i}${o}`];return s&&s.length>0&&s.forEach(u=>{const c=e.renderChildren([u]);if(c){const h=c.split(`
`).map(p=>p?e.indent(p):"").join(`
`);l.push(h)}}),l.join(`
`)}function XJ(t,e,r={}){const{state:n}=e,{doc:i,tr:a}=n,s=t;i.descendants((o,l)=>{const u=a.mapping.map(l),c=a.mapping.map(l)+o.nodeSize;let h=null;if(o.marks.forEach(g=>{if(g!==s)return!1;h=g}),!h)return;let p=!1;if(Object.keys(r).forEach(g=>{r[g]!==h.attrs[g]&&(p=!0)}),p){const g=t.type.create({...t.attrs,...r});a.removeMark(u,c,t.type),a.addMark(u,c,g)}}),a.docChanged&&e.view.dispatch(a)}var to=class T6 extends sC{constructor(){super(...arguments),this.type="node"}static create(e={}){const r=typeof e=="function"?e():e;return new T6(r)}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}};function Cf(t){return new RJ({find:t.find,handler:({state:e,range:r,match:n,pasteEvent:i})=>{const a=dn(t.getAttributes,void 0,n,i);if(a===!1||a===null)return null;const{tr:s}=e,o=n[n.length-1],l=n[0];let u=r.to;if(o){const c=l.search(/\S/),h=r.from+l.indexOf(o),p=h+o.length;if(aC(r.from,r.to,e.doc).filter(y=>y.mark.type.excluded.find(w=>w===t.type&&w!==y.mark.type)).filter(y=>y.to>h).length)return null;p<r.to&&s.delete(p,r.to),h>r.from&&s.delete(r.from+c,h),u=r.from+c+o.length,s.addMark(r.from+c,u,t.type.create(a||{})),s.removeStoredMark(t.type)}}})}const{getOwnPropertyNames:QJ,getOwnPropertySymbols:JJ}=Object,{hasOwnProperty:eee}=Object.prototype;function dS(t,e){return function(n,i,a){return t(n,i,a)&&e(n,i,a)}}function Ty(t){return function(r,n,i){if(!r||!n||typeof r!="object"||typeof n!="object")return t(r,n,i);const{cache:a}=i,s=a.get(r),o=a.get(n);if(s&&o)return s===n&&o===r;a.set(r,n),a.set(n,r);const l=t(r,n,i);return a.delete(r),a.delete(n),l}}function tee(t){return t?.[Symbol.toStringTag]}function gP(t){return QJ(t).concat(JJ(t))}const ree=Object.hasOwn||((t,e)=>eee.call(t,e));function Rf(t,e){return t===e||!t&&!e&&t!==t&&e!==e}const nee="__v",iee="__o",aee="_owner",{getOwnPropertyDescriptor:vP,keys:yP}=Object;function see(t,e){return t.byteLength===e.byteLength&&Bx(new Uint8Array(t),new Uint8Array(e))}function oee(t,e,r){let n=t.length;if(e.length!==n)return!1;for(;n-- >0;)if(!r.equals(t[n],e[n],n,n,t,e,r))return!1;return!0}function lee(t,e){return t.byteLength===e.byteLength&&Bx(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function uee(t,e){return Rf(t.getTime(),e.getTime())}function cee(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function dee(t,e){return t===e}function xP(t,e,r){const n=t.size;if(n!==e.size)return!1;if(!n)return!0;const i=new Array(n),a=t.entries();let s,o,l=0;for(;(s=a.next())&&!s.done;){const u=e.entries();let c=!1,h=0;for(;(o=u.next())&&!o.done;){if(i[h]){h++;continue}const p=s.value,g=o.value;if(r.equals(p[0],g[0],l,h,t,e,r)&&r.equals(p[1],g[1],p[0],g[0],t,e,r)){c=i[h]=!0;break}h++}if(!c)return!1;l++}return!0}const hee=Rf;function fee(t,e,r){const n=yP(t);let i=n.length;if(yP(e).length!==i)return!1;for(;i-- >0;)if(!N6(t,e,r,n[i]))return!1;return!0}function zg(t,e,r){const n=gP(t);let i=n.length;if(gP(e).length!==i)return!1;let a,s,o;for(;i-- >0;)if(a=n[i],!N6(t,e,r,a)||(s=vP(t,a),o=vP(e,a),(s||o)&&(!s||!o||s.configurable!==o.configurable||s.enumerable!==o.enumerable||s.writable!==o.writable)))return!1;return!0}function pee(t,e){return Rf(t.valueOf(),e.valueOf())}function mee(t,e){return t.source===e.source&&t.flags===e.flags}function bP(t,e,r){const n=t.size;if(n!==e.size)return!1;if(!n)return!0;const i=new Array(n),a=t.values();let s,o;for(;(s=a.next())&&!s.done;){const l=e.values();let u=!1,c=0;for(;(o=l.next())&&!o.done;){if(!i[c]&&r.equals(s.value,o.value,s.value,o.value,t,e,r)){u=i[c]=!0;break}c++}if(!u)return!1}return!0}function Bx(t,e){let r=t.byteLength;if(e.byteLength!==r||t.byteOffset!==e.byteOffset)return!1;for(;r-- >0;)if(t[r]!==e[r])return!1;return!0}function gee(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function N6(t,e,r,n){return(n===aee||n===iee||n===nee)&&(t.$$typeof||e.$$typeof)?!0:ree(e,n)&&r.equals(t[n],e[n],n,n,t,e,r)}const vee="[object ArrayBuffer]",yee="[object Arguments]",xee="[object Boolean]",bee="[object DataView]",wee="[object Date]",See="[object Error]",kee="[object Map]",_ee="[object Number]",Cee="[object Object]",Eee="[object RegExp]",Tee="[object Set]",Nee="[object String]",Pee={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float16Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0,"[object BigInt64Array]":!0,"[object BigUint64Array]":!0},Mee="[object URL]",Aee=Object.prototype.toString;function Lee({areArrayBuffersEqual:t,areArraysEqual:e,areDataViewsEqual:r,areDatesEqual:n,areErrorsEqual:i,areFunctionsEqual:a,areMapsEqual:s,areNumbersEqual:o,areObjectsEqual:l,arePrimitiveWrappersEqual:u,areRegExpsEqual:c,areSetsEqual:h,areTypedArraysEqual:p,areUrlsEqual:g,unknownTagComparators:y}){return function(w,C,_){if(w===C)return!0;if(w==null||C==null)return!1;const T=typeof w;if(T!==typeof C)return!1;if(T!=="object")return T==="number"?o(w,C,_):T==="function"?a(w,C,_):!1;const N=w.constructor;if(N!==C.constructor)return!1;if(N===Object)return l(w,C,_);if(Array.isArray(w))return e(w,C,_);if(N===Date)return n(w,C,_);if(N===RegExp)return c(w,C,_);if(N===Map)return s(w,C,_);if(N===Set)return h(w,C,_);const R=Aee.call(w);if(R===wee)return n(w,C,_);if(R===Eee)return c(w,C,_);if(R===kee)return s(w,C,_);if(R===Tee)return h(w,C,_);if(R===Cee)return typeof w.then!="function"&&typeof C.then!="function"&&l(w,C,_);if(R===Mee)return g(w,C,_);if(R===See)return i(w,C,_);if(R===yee)return l(w,C,_);if(Pee[R])return p(w,C,_);if(R===vee)return t(w,C,_);if(R===bee)return r(w,C,_);if(R===xee||R===_ee||R===Nee)return u(w,C,_);if(y){let I=y[R];if(!I){const j=tee(w);j&&(I=y[j])}if(I)return I(w,C,_)}return!1}}function Ree({circular:t,createCustomConfig:e,strict:r}){let n={areArrayBuffersEqual:see,areArraysEqual:r?zg:oee,areDataViewsEqual:lee,areDatesEqual:uee,areErrorsEqual:cee,areFunctionsEqual:dee,areMapsEqual:r?dS(xP,zg):xP,areNumbersEqual:hee,areObjectsEqual:r?zg:fee,arePrimitiveWrappersEqual:pee,areRegExpsEqual:mee,areSetsEqual:r?dS(bP,zg):bP,areTypedArraysEqual:r?dS(Bx,zg):Bx,areUrlsEqual:gee,unknownTagComparators:void 0};if(e&&(n=Object.assign({},n,e(n))),t){const i=Ty(n.areArraysEqual),a=Ty(n.areMapsEqual),s=Ty(n.areObjectsEqual),o=Ty(n.areSetsEqual);n=Object.assign({},n,{areArraysEqual:i,areMapsEqual:a,areObjectsEqual:s,areSetsEqual:o})}return n}function Oee(t){return function(e,r,n,i,a,s,o){return t(e,r,o)}}function Dee({circular:t,comparator:e,createState:r,equals:n,strict:i}){if(r)return function(o,l){const{cache:u=t?new WeakMap:void 0,meta:c}=r();return e(o,l,{cache:u,equals:n,meta:c,strict:i})};if(t)return function(o,l){return e(o,l,{cache:new WeakMap,equals:n,meta:void 0,strict:i})};const a={cache:void 0,equals:n,meta:void 0,strict:i};return function(o,l){return e(o,l,a)}}const Iee=ph();ph({strict:!0});ph({circular:!0});ph({circular:!0,strict:!0});ph({createInternalComparator:()=>Rf});ph({strict:!0,createInternalComparator:()=>Rf});ph({circular:!0,createInternalComparator:()=>Rf});ph({circular:!0,createInternalComparator:()=>Rf,strict:!0});function ph(t={}){const{circular:e=!1,createInternalComparator:r,createState:n,strict:i=!1}=t,a=Ree(t),s=Lee(a),o=r?r(s):Oee(s);return Dee({circular:e,comparator:s,createState:n,equals:o,strict:i})}var hS={exports:{}},fS={};var wP;function jee(){if(wP)return fS;wP=1;var t=sm(),e=yR();function r(u,c){return u===c&&(u!==0||1/u===1/c)||u!==u&&c!==c}var n=typeof Object.is=="function"?Object.is:r,i=e.useSyncExternalStore,a=t.useRef,s=t.useEffect,o=t.useMemo,l=t.useDebugValue;return fS.useSyncExternalStoreWithSelector=function(u,c,h,p,g){var y=a(null);if(y.current===null){var S={hasValue:!1,value:null};y.current=S}else S=y.current;y=o(function(){function C(I){if(!_){if(_=!0,T=I,I=p(I),g!==void 0&&S.hasValue){var j=S.value;if(g(j,I))return N=j}return N=I}if(j=N,n(T,I))return j;var O=p(I);return g!==void 0&&g(j,O)?(T=I,j):(T=I,N=O)}var _=!1,T,N,R=h===void 0?null:h;return[function(){return C(c())},R===null?void 0:function(){return C(R())}]},[c,h,p,g]);var w=i(u,y[0],y[1]);return s(function(){S.hasValue=!0,S.value=w},[w]),l(w),w},fS}var SP;function Fee(){return SP||(SP=1,hS.exports=jee()),hS.exports}var Bee=Fee(),zee=(...t)=>e=>{t.forEach(r=>{typeof r=="function"?r(e):r&&(r.current=e)})},Uee=({contentComponent:t})=>{const e=xR.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return m.jsx(m.Fragment,{children:Object.values(e)})};function Gee(){const t=new Set;let e={};return{subscribe(r){return t.add(r),()=>{t.delete(r)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(r,n){e={...e,[r]:QD.createPortal(n.reactElement,n.element,r)},t.forEach(i=>i())},removeRenderer(r){const n={...e};delete n[r],e=n,t.forEach(i=>i())}}}var Vee=class extends ir.Component{constructor(t){var e;super(t),this.editorContentRef=ir.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((e=t.editor)!=null&&e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){var t;const e=this.props.editor;if(e&&!e.isDestroyed&&((t=e.view.dom)!=null&&t.parentNode)){if(e.contentComponent)return;const r=this.editorContentRef.current;r.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:r}),e.contentComponent=Gee(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(n=>n.hasContentComponentInitialized?n:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var t;const e=this.props.editor;if(e){this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null;try{if(!((t=e.view.dom)!=null&&t.parentNode))return;const r=document.createElement("div");r.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:r})}catch{}}}render(){const{editor:t,innerRef:e,...r}=this.props;return m.jsxs(m.Fragment,{children:[m.jsx("div",{ref:zee(e,this.editorContentRef),...r}),t?.contentComponent&&m.jsx(Uee,{contentComponent:t.contentComponent})]})}},Hee=ie.forwardRef((t,e)=>{const r=ir.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return ir.createElement(Vee,{key:r,innerRef:e,...t})}),Wee=ir.memo(Hee),qee=typeof window<"u"?ie.useLayoutEffect:ie.useEffect,$ee=class{constructor(t){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=t,this.lastSnapshot={editor:t,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(t){return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}watch(t){if(this.editor=t,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(n=>n())},r=this.editor;return r.on("transaction",e),()=>{r.off("transaction",e)}}}};function Kee(t){var e;const[r]=ie.useState(()=>new $ee(t.editor)),n=Bee.useSyncExternalStoreWithSelector(r.subscribe,r.getSnapshot,r.getServerSnapshot,t.selector,(e=t.equalityFn)!=null?e:Iee);return qee(()=>r.watch(t.editor),[t.editor,r]),ie.useDebugValue(n),n}var Zee=!1,Nk=typeof window>"u",Yee=Nk||!!(typeof window<"u"&&window.next),Xee=class P6{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(r=>r())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?Nk||Yee?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...n)=>{var i,a;return(a=(i=this.options.current).onBeforeCreate)==null?void 0:a.call(i,...n)},onBlur:(...n)=>{var i,a;return(a=(i=this.options.current).onBlur)==null?void 0:a.call(i,...n)},onCreate:(...n)=>{var i,a;return(a=(i=this.options.current).onCreate)==null?void 0:a.call(i,...n)},onDestroy:(...n)=>{var i,a;return(a=(i=this.options.current).onDestroy)==null?void 0:a.call(i,...n)},onFocus:(...n)=>{var i,a;return(a=(i=this.options.current).onFocus)==null?void 0:a.call(i,...n)},onSelectionUpdate:(...n)=>{var i,a;return(a=(i=this.options.current).onSelectionUpdate)==null?void 0:a.call(i,...n)},onTransaction:(...n)=>{var i,a;return(a=(i=this.options.current).onTransaction)==null?void 0:a.call(i,...n)},onUpdate:(...n)=>{var i,a;return(a=(i=this.options.current).onUpdate)==null?void 0:a.call(i,...n)},onContentError:(...n)=>{var i,a;return(a=(i=this.options.current).onContentError)==null?void 0:a.call(i,...n)},onDrop:(...n)=>{var i,a;return(a=(i=this.options.current).onDrop)==null?void 0:a.call(i,...n)},onPaste:(...n)=>{var i,a;return(a=(i=this.options.current).onPaste)==null?void 0:a.call(i,...n)},onDelete:(...n)=>{var i,a;return(a=(i=this.options.current).onDelete)==null?void 0:a.call(i,...n)}};return new GJ(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,r){return Object.keys(e).every(n=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(n)?!0:n==="extensions"&&e.extensions&&r.extensions?e.extensions.length!==r.extensions.length?!1:e.extensions.every((i,a)=>{var s;return i===((s=r.extensions)==null?void 0:s[a])}):e[n]===r[n])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?P6.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((n,i)=>n===e[i]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,r=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){r&&r.setOptions(this.options.current);return}r&&!r.isDestroyed&&(r.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function Qee(t={},e=[]){const r=ie.useRef(t);r.current=t;const[n]=ie.useState(()=>new Xee(r)),i=xR.useSyncExternalStore(n.subscribe,n.getEditor,n.getServerSnapshot);return ie.useDebugValue(i),ie.useEffect(n.onRender(e)),Kee({editor:i,selector:({transactionNumber:a})=>t.shouldRerenderOnTransaction===!1||t.shouldRerenderOnTransaction===void 0?null:t.immediatelyRender&&a===0?0:a+1}),i}var Jee=ie.createContext({editor:null});Jee.Consumer;var ete=ie.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),tte=()=>ie.useContext(ete);ir.forwardRef((t,e)=>{const{onDragStart:r}=tte(),n=t.as||"div";return m.jsx(n,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:r,style:{whiteSpace:"normal",...t.style}})});function kP(t){return!!(typeof t=="function"&&t.prototype&&t.prototype.isReactComponent)}function _P(t){return!!(typeof t=="object"&&t.$$typeof&&(t.$$typeof.toString()==="Symbol(react.forward_ref)"||t.$$typeof.description==="react.forward_ref"))}function rte(t){return!!(typeof t=="object"&&t.$$typeof&&(t.$$typeof.toString()==="Symbol(react.memo)"||t.$$typeof.description==="react.memo"))}function nte(t){if(kP(t)||_P(t))return!0;if(rte(t)){const e=t.type;if(e)return kP(e)||_P(e)}return!1}function ite(){try{if(ie.version)return parseInt(ie.version.split(".")[0],10)>=19}catch{}return!1}var ate=class{constructor(t,{editor:e,props:r={},as:n="div",className:i=""}){this.ref=null,this.destroyed=!1,this.id=Math.floor(Math.random()*4294967295).toString(),this.component=t,this.editor=e,this.props=r,this.element=document.createElement(n),this.element.classList.add("react-renderer"),i&&this.element.classList.add(...i.split(" ")),this.editor.isInitialized?eo.flushSync(()=>{this.render()}):queueMicrotask(()=>{this.destroyed||this.render()})}render(){var t;if(this.destroyed)return;const e=this.component,r=this.props,n=this.editor,i=ite(),a=nte(e),s={...r};s.ref&&!(i||a)&&delete s.ref,!s.ref&&(i||a)&&(s.ref=o=>{this.ref=o}),this.reactElement=m.jsx(e,{...s}),(t=n?.contentComponent)==null||t.setRenderer(this.id,this)}updateProps(t={}){this.destroyed||(this.props={...this.props,...t},this.render())}destroy(){var t;this.destroyed=!0;const e=this.editor;(t=e?.contentComponent)==null||t.removeRenderer(this.id);try{this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}catch{}}updateAttributes(t){Object.keys(t).forEach(e=>{this.element.setAttribute(e,t[e])})}};ir.createContext({markViewContentRef:()=>{}});var zx=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:r,...n}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,n,r]},ste=/^\s*>\s$/,ote=to.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return zx("blockquote",{...Zn(this.options.HTMLAttributes,t),children:zx("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const r=">",n=[];return t.content.forEach(i=>{const o=e.renderChildren([i]).split(`
`).map(l=>l.trim()===""?r:`${r} ${l}`);n.push(o.join(`
`))}),n.join(`
${r}
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[tm({find:ste,type:this.type})]}}),lte=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,ute=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,cte=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,dte=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,hte=Lf.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return zx("strong",{...Zn(this.options.HTMLAttributes,t),children:zx("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[em({find:lte,type:this.type}),em({find:cte,type:this.type})]},addPasteRules(){return[Cf({find:ute,type:this.type}),Cf({find:dte,type:this.type})]}}),fte=/(^|[^`])`([^`]+)`(?!`)$/,pte=/(^|[^`])`([^`]+)`(?!`)/g,mte=Lf.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[em({find:fte,type:this.type})]},addPasteRules(){return[Cf({find:pte,type:this.type})]}}),pS=4,gte=/^```([a-z]+)?[\s\n]$/,vte=/^~~~([a-z]+)?[\s\n]$/,yte=to.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:pS,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:r}=this.options;if(!r)return null;const a=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(s=>s.startsWith(r)).map(s=>s.replace(r,""))[0];return a||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Zn(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var r;return((r=t.raw)==null?void 0:r.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var r;let n="";const i=((r=t.attrs)==null?void 0:r.language)||"";return t.content?n=[`\`\`\`${i}`,e.renderChildren(t.content),"```"].join(`
`):n=`\`\`\`${i}

\`\`\``,n},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,r=e.pos===1;return!t||e.parent.type.name!==this.name?!1:r||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const r=(e=this.options.tabSize)!=null?e:pS,{state:n}=t,{selection:i}=n,{$from:a,empty:s}=i;if(a.parent.type!==this.type)return!1;const o=" ".repeat(r);return s?t.commands.insertContent(o):t.commands.command(({tr:l})=>{const{from:u,to:c}=i,g=n.doc.textBetween(u,c,`
`,`
`).split(`
`).map(y=>o+y).join(`
`);return l.replaceWith(u,c,n.schema.text(g)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const r=(e=this.options.tabSize)!=null?e:pS,{state:n}=t,{selection:i}=n,{$from:a,empty:s}=i;return a.parent.type!==this.type?!1:s?t.commands.command(({tr:o})=>{var l;const{pos:u}=a,c=a.start(),h=a.end(),g=n.doc.textBetween(c,h,`
`,`
`).split(`
`);let y=0,S=0;const w=u-c;for(let I=0;I<g.length;I+=1){if(S+g[I].length>=w){y=I;break}S+=g[I].length+1}const _=((l=g[y].match(/^ */))==null?void 0:l[0])||"",T=Math.min(_.length,r);if(T===0)return!0;let N=c;for(let I=0;I<y;I+=1)N+=g[I].length+1;return o.delete(N,N+T),u-N<=T&&o.setSelection(dr.create(o.doc,N)),!0}):t.commands.command(({tr:o})=>{const{from:l,to:u}=i,p=n.doc.textBetween(l,u,`
`,`
`).split(`
`).map(g=>{var y;const S=((y=g.match(/^ */))==null?void 0:y[0])||"",w=Math.min(S.length,r);return g.slice(w)}).join(`
`);return o.replaceWith(l,u,n.schema.text(p)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:r}=e,{$from:n,empty:i}=r;if(!i||n.parent.type!==this.type)return!1;const a=n.parentOffset===n.parent.nodeSize-2,s=n.parent.textContent.endsWith(`

`);return!a||!s?!1:t.chain().command(({tr:o})=>(o.delete(n.pos-2,n.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:r,doc:n}=e,{$from:i,empty:a}=r;if(!a||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const o=i.after();return o===void 0?!1:n.nodeAt(o)?t.commands.command(({tr:u})=>(u.setSelection(Sr.near(n.resolve(o))),!0)):t.commands.exitCode()}}},addInputRules(){return[Ek({find:gte,type:this.type,getAttributes:t=>({language:t[1]})}),Ek({find:vte,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Yn({key:new Ti("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const r=e.clipboardData.getData("text/plain"),n=e.clipboardData.getData("vscode-editor-data"),i=n?JSON.parse(n):void 0,a=i?.mode;if(!r||!a)return!1;const{tr:s,schema:o}=t.state,l=o.text(r.replace(/\r\n?/g,`
`));return s.replaceSelectionWith(this.type.create({language:a},l)),s.selection.$from.parent.type!==this.type&&s.setSelection(dr.near(s.doc.resolve(Math.max(0,s.selection.from-2)))),s.setMeta("paste",!0),t.dispatch(s),!0}}})]}}),xte=to.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),bte=to.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Zn(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:r,editor:n})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:a}=r;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:s}=this.options,{splittableMarks:o}=n.extensionManager,l=a||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:c})=>{if(c&&l&&s){const h=l.filter(p=>o.includes(p.type.name));u.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),wte=to.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Zn(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var r;const n=(r=t.attrs)!=null&&r.level?parseInt(t.attrs.level,10):1,i="#".repeat(n);return t.content?`${i} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Ek({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),Ste=to.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Zn(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!HJ(e,e.schema.nodes[this.name]))return!1;const{selection:r}=e,{$to:n}=r,i=t();return u6(r)?i.insertContentAt(n.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({state:a,tr:s,dispatch:o})=>{if(o){const{$to:l}=s.selection,u=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?s.setSelection(dr.create(s.doc,l.pos+1)):l.nodeAfter.isBlock?s.setSelection(Qt.create(s.doc,l.pos)):s.setSelection(dr.create(s.doc,l.pos));else{const c=a.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,h=c?.create();h&&(s.insert(u,h),s.setSelection(dr.create(s.doc,u+1)))}s.scrollIntoView()}return!0}).run()}}},addInputRules(){return[VJ({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),kte=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,_te=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Cte=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Ete=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Tte=Lf.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Zn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[em({find:kte,type:this.type}),em({find:Cte,type:this.type})]},addPasteRules(){return[Cf({find:_te,type:this.type}),Cf({find:Ete,type:this.type})]}});const Nte="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Pte="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Pk="numeric",Mk="ascii",Ak="alpha",ov="asciinumeric",Qg="alphanumeric",Lk="domain",M6="emoji",Mte="scheme",Ate="slashscheme",mS="whitespace";function Lte(t,e){return t in e||(e[t]=[]),e[t]}function sf(t,e,r){e[Pk]&&(e[ov]=!0,e[Qg]=!0),e[Mk]&&(e[ov]=!0,e[Ak]=!0),e[ov]&&(e[Qg]=!0),e[Ak]&&(e[Qg]=!0),e[Qg]&&(e[Lk]=!0),e[M6]&&(e[Lk]=!0);for(const n in e){const i=Lte(n,r);i.indexOf(t)<0&&i.push(t)}}function Rte(t,e){const r={};for(const n in e)e[n].indexOf(t)>=0&&(r[n]=!0);return r}function Zs(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Zs.groups={};Zs.prototype={accepts(){return!!this.t},go(t){const e=this,r=e.j[t];if(r)return r;for(let n=0;n<e.jr.length;n++){const i=e.jr[n][0],a=e.jr[n][1];if(a&&i.test(t))return a}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,r,n){for(let i=0;i<t.length;i++)this.tt(t[i],e,r,n)},tr(t,e,r,n){n=n||Zs.groups;let i;return e&&e.j?i=e:(i=new Zs(e),r&&n&&sf(e,r,n)),this.jr.push([t,i]),i},ts(t,e,r,n){let i=this;const a=t.length;if(!a)return i;for(let s=0;s<a-1;s++)i=i.tt(t[s]);return i.tt(t[a-1],e,r,n)},tt(t,e,r,n){n=n||Zs.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const a=e;let s,o=i.go(t);if(o?(s=new Zs,Object.assign(s.j,o.j),s.jr.push.apply(s.jr,o.jr),s.jd=o.jd,s.t=o.t):s=new Zs,a){if(n)if(s.t&&typeof s.t=="string"){const l=Object.assign(Rte(s.t,n),r);sf(a,l,n)}else r&&sf(a,r,n);s.t=a}return i.j[t]=s,s}};const wr=(t,e,r,n,i)=>t.ta(e,r,n,i),ci=(t,e,r,n,i)=>t.tr(e,r,n,i),CP=(t,e,r,n,i)=>t.ts(e,r,n,i),mt=(t,e,r,n,i)=>t.tt(e,r,n,i),lc="WORD",Rk="UWORD",A6="ASCIINUMERICAL",L6="ALPHANUMERICAL",Uv="LOCALHOST",Ok="TLD",Dk="UTLD",Xy="SCHEME",Mp="SLASH_SCHEME",cC="NUM",Ik="WS",dC="NL",lv="OPENBRACE",uv="CLOSEBRACE",Ux="OPENBRACKET",Gx="CLOSEBRACKET",Vx="OPENPAREN",Hx="CLOSEPAREN",Wx="OPENANGLEBRACKET",qx="CLOSEANGLEBRACKET",$x="FULLWIDTHLEFTPAREN",Kx="FULLWIDTHRIGHTPAREN",Zx="LEFTCORNERBRACKET",Yx="RIGHTCORNERBRACKET",Xx="LEFTWHITECORNERBRACKET",Qx="RIGHTWHITECORNERBRACKET",Jx="FULLWIDTHLESSTHAN",e1="FULLWIDTHGREATERTHAN",t1="AMPERSAND",r1="APOSTROPHE",n1="ASTERISK",Nd="AT",i1="BACKSLASH",a1="BACKTICK",s1="CARET",Ad="COLON",hC="COMMA",o1="DOLLAR",xu="DOT",l1="EQUALS",fC="EXCLAMATION",$o="HYPHEN",cv="PERCENT",u1="PIPE",c1="PLUS",d1="POUND",dv="QUERY",pC="QUOTE",R6="FULLWIDTHMIDDLEDOT",mC="SEMI",bu="SLASH",hv="TILDE",h1="UNDERSCORE",O6="EMOJI",f1="SYM";var D6=Object.freeze({__proto__:null,ALPHANUMERICAL:L6,AMPERSAND:t1,APOSTROPHE:r1,ASCIINUMERICAL:A6,ASTERISK:n1,AT:Nd,BACKSLASH:i1,BACKTICK:a1,CARET:s1,CLOSEANGLEBRACKET:qx,CLOSEBRACE:uv,CLOSEBRACKET:Gx,CLOSEPAREN:Hx,COLON:Ad,COMMA:hC,DOLLAR:o1,DOT:xu,EMOJI:O6,EQUALS:l1,EXCLAMATION:fC,FULLWIDTHGREATERTHAN:e1,FULLWIDTHLEFTPAREN:$x,FULLWIDTHLESSTHAN:Jx,FULLWIDTHMIDDLEDOT:R6,FULLWIDTHRIGHTPAREN:Kx,HYPHEN:$o,LEFTCORNERBRACKET:Zx,LEFTWHITECORNERBRACKET:Xx,LOCALHOST:Uv,NL:dC,NUM:cC,OPENANGLEBRACKET:Wx,OPENBRACE:lv,OPENBRACKET:Ux,OPENPAREN:Vx,PERCENT:cv,PIPE:u1,PLUS:c1,POUND:d1,QUERY:dv,QUOTE:pC,RIGHTCORNERBRACKET:Yx,RIGHTWHITECORNERBRACKET:Qx,SCHEME:Xy,SEMI:mC,SLASH:bu,SLASH_SCHEME:Mp,SYM:f1,TILDE:hv,TLD:Ok,UNDERSCORE:h1,UTLD:Dk,UWORD:Rk,WORD:lc,WS:Ik});const sc=/[a-z]/,Ug=new RegExp("\\p{L}","u"),gS=new RegExp("\\p{Emoji}","u"),oc=/\d/,vS=/\s/,EP="\r",yS=`
`,Ote="",Dte="",xS="";let Ny=null,Py=null;function Ite(t=[]){const e={};Zs.groups=e;const r=new Zs;Ny==null&&(Ny=TP(Nte)),Py==null&&(Py=TP(Pte)),mt(r,"'",r1),mt(r,"{",lv),mt(r,"}",uv),mt(r,"[",Ux),mt(r,"]",Gx),mt(r,"(",Vx),mt(r,")",Hx),mt(r,"<",Wx),mt(r,">",qx),mt(r,"",$x),mt(r,"",Kx),mt(r,"",Zx),mt(r,"",Yx),mt(r,"",Xx),mt(r,"",Qx),mt(r,"",Jx),mt(r,"",e1),mt(r,"&",t1),mt(r,"*",n1),mt(r,"@",Nd),mt(r,"`",a1),mt(r,"^",s1),mt(r,":",Ad),mt(r,",",hC),mt(r,"$",o1),mt(r,".",xu),mt(r,"=",l1),mt(r,"!",fC),mt(r,"-",$o),mt(r,"%",cv),mt(r,"|",u1),mt(r,"+",c1),mt(r,"#",d1),mt(r,"?",dv),mt(r,'"',pC),mt(r,"/",bu),mt(r,";",mC),mt(r,"~",hv),mt(r,"_",h1),mt(r,"\\",i1),mt(r,"",R6);const n=ci(r,oc,cC,{[Pk]:!0});ci(n,oc,n);const i=ci(n,sc,A6,{[ov]:!0}),a=ci(n,Ug,L6,{[Qg]:!0}),s=ci(r,sc,lc,{[Mk]:!0});ci(s,oc,i),ci(s,sc,s),ci(i,oc,i),ci(i,sc,i);const o=ci(r,Ug,Rk,{[Ak]:!0});ci(o,sc),ci(o,oc,a),ci(o,Ug,o),ci(a,oc,a),ci(a,sc),ci(a,Ug,a);const l=mt(r,yS,dC,{[mS]:!0}),u=mt(r,EP,Ik,{[mS]:!0}),c=ci(r,vS,Ik,{[mS]:!0});mt(r,xS,c),mt(u,yS,l),mt(u,xS,c),ci(u,vS,c),mt(c,EP),mt(c,yS),ci(c,vS,c),mt(c,xS,c);const h=ci(r,gS,O6,{[M6]:!0});mt(h,"#"),ci(h,gS,h),mt(h,Ote,h);const p=mt(h,Dte);mt(p,"#"),ci(p,gS,h);const g=[[sc,s],[oc,i]],y=[[sc,null],[Ug,o],[oc,a]];for(let S=0;S<Ny.length;S++)kd(r,Ny[S],Ok,lc,g);for(let S=0;S<Py.length;S++)kd(r,Py[S],Dk,Rk,y);sf(Ok,{tld:!0,ascii:!0},e),sf(Dk,{utld:!0,alpha:!0},e),kd(r,"file",Xy,lc,g),kd(r,"mailto",Xy,lc,g),kd(r,"http",Mp,lc,g),kd(r,"https",Mp,lc,g),kd(r,"ftp",Mp,lc,g),kd(r,"ftps",Mp,lc,g),sf(Xy,{scheme:!0,ascii:!0},e),sf(Mp,{slashscheme:!0,ascii:!0},e),t=t.sort((S,w)=>S[0]>w[0]?1:-1);for(let S=0;S<t.length;S++){const w=t[S][0],_=t[S][1]?{[Mte]:!0}:{[Ate]:!0};w.indexOf("-")>=0?_[Lk]=!0:sc.test(w)?oc.test(w)?_[ov]=!0:_[Mk]=!0:_[Pk]=!0,CP(r,w,w,_)}return CP(r,"localhost",Uv,{ascii:!0}),r.jd=new Zs(f1),{start:r,tokens:Object.assign({groups:e},D6)}}function I6(t,e){const r=jte(e.replace(/[A-Z]/g,o=>o.toLowerCase())),n=r.length,i=[];let a=0,s=0;for(;s<n;){let o=t,l=null,u=0,c=null,h=-1,p=-1;for(;s<n&&(l=o.go(r[s]));)o=l,o.accepts()?(h=0,p=0,c=o):h>=0&&(h+=r[s].length,p++),u+=r[s].length,a+=r[s].length,s++;a-=h,s-=p,u-=h,i.push({t:c.t,v:e.slice(a-u,a),s:a-u,e:a})}return i}function jte(t){const e=[],r=t.length;let n=0;for(;n<r;){let i=t.charCodeAt(n),a,s=i<55296||i>56319||n+1===r||(a=t.charCodeAt(n+1))<56320||a>57343?t[n]:t.slice(n,n+2);e.push(s),n+=s.length}return e}function kd(t,e,r,n,i){let a;const s=e.length;for(let o=0;o<s-1;o++){const l=e[o];t.j[l]?a=t.j[l]:(a=new Zs(n),a.jr=i.slice(),t.j[l]=a),t=a}return a=new Zs(r),a.jr=i.slice(),t.j[e[s-1]]=a,a}function TP(t){const e=[],r=[];let n=0,i="0123456789";for(;n<t.length;){let a=0;for(;i.indexOf(t[n+a])>=0;)a++;if(a>0){e.push(r.join(""));for(let s=parseInt(t.substring(n,n+a),10);s>0;s--)r.pop();n+=a}else r.push(t[n]),n++}return e}const Gv={defaultProtocol:"http",events:null,format:NP,formatHref:NP,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function gC(t,e=null){let r=Object.assign({},Gv);t&&(r=Object.assign(r,t instanceof gC?t.o:t));const n=r.ignoreTags,i=[];for(let a=0;a<n.length;a++)i.push(n[a].toUpperCase());this.o=r,e&&(this.defaultRender=e),this.ignoreTags=i}gC.prototype={o:Gv,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,r){const n=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=r.t in i?i[r.t]:Gv[t],typeof i=="function"&&n&&(i=i(e,r))):typeof i=="function"&&n&&(i=i(e,r.t,r)),i)},getObj(t,e,r){let n=this.o[t];return typeof n=="function"&&e!=null&&(n=n(e,r.t,r)),n},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function NP(t){return t}function j6(t,e){this.t="token",this.v=t,this.tk=e}j6.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),r=t.get("truncate",e,this),n=t.get("format",e,this);return r&&n.length>r?n.substring(0,r)+"":n},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Gv.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,r=this.toHref(t.get("defaultProtocol")),n=t.get("formatHref",r,this),i=t.get("tagName",r,e),a=this.toFormattedString(t),s={},o=t.get("className",r,e),l=t.get("target",r,e),u=t.get("rel",r,e),c=t.getObj("attributes",r,e),h=t.getObj("events",r,e);return s.href=n,o&&(s.class=o),l&&(s.target=l),u&&(s.rel=u),c&&Object.assign(s,c),{tagName:i,attributes:s,content:a,eventListeners:h}}};function ib(t,e){class r extends j6{constructor(i,a){super(i,a),this.t=t}}for(const n in e)r.prototype[n]=e[n];return r.t=t,r}const PP=ib("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),MP=ib("text"),Fte=ib("nl"),My=ib("url",{isLink:!0,toHref(t=Gv.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==Uv&&t[1].t===Ad}}),Wo=t=>new Zs(t);function Bte({groups:t}){const e=t.domain.concat([t1,n1,Nd,i1,a1,s1,o1,l1,$o,cC,cv,u1,c1,d1,bu,f1,hv,h1]),r=[r1,Ad,hC,xu,fC,cv,dv,pC,mC,Wx,qx,lv,uv,Gx,Ux,Vx,Hx,$x,Kx,Zx,Yx,Xx,Qx,Jx,e1],n=[t1,r1,n1,i1,a1,s1,o1,l1,$o,lv,uv,cv,u1,c1,d1,dv,bu,f1,hv,h1],i=Wo(),a=mt(i,hv);wr(a,n,a),wr(a,t.domain,a);const s=Wo(),o=Wo(),l=Wo();wr(i,t.domain,s),wr(i,t.scheme,o),wr(i,t.slashscheme,l),wr(s,n,a),wr(s,t.domain,s);const u=mt(s,Nd);mt(a,Nd,u),mt(o,Nd,u),mt(l,Nd,u);const c=mt(a,xu);wr(c,n,a),wr(c,t.domain,a);const h=Wo();wr(u,t.domain,h),wr(h,t.domain,h);const p=mt(h,xu);wr(p,t.domain,h);const g=Wo(PP);wr(p,t.tld,g),wr(p,t.utld,g),mt(u,Uv,g);const y=mt(h,$o);mt(y,$o,y),wr(y,t.domain,h),wr(g,t.domain,h),mt(g,xu,p),mt(g,$o,y);const S=mt(g,Ad);wr(S,t.numeric,PP);const w=mt(s,$o),C=mt(s,xu);mt(w,$o,w),wr(w,t.domain,s),wr(C,n,a),wr(C,t.domain,s);const _=Wo(My);wr(C,t.tld,_),wr(C,t.utld,_),wr(_,t.domain,s),wr(_,n,a),mt(_,xu,C),mt(_,$o,w),mt(_,Nd,u);const T=mt(_,Ad),N=Wo(My);wr(T,t.numeric,N);const R=Wo(My),I=Wo();wr(R,e,R),wr(R,r,I),wr(I,e,R),wr(I,r,I),mt(_,bu,R),mt(N,bu,R);const j=mt(o,Ad),O=mt(l,Ad),F=mt(O,bu),z=mt(F,bu);wr(o,t.domain,s),mt(o,xu,C),mt(o,$o,w),wr(l,t.domain,s),mt(l,xu,C),mt(l,$o,w),wr(j,t.domain,R),mt(j,bu,R),mt(j,dv,R),wr(z,t.domain,R),wr(z,e,R),mt(z,bu,R);const V=[[lv,uv],[Ux,Gx],[Vx,Hx],[Wx,qx],[$x,Kx],[Zx,Yx],[Xx,Qx],[Jx,e1]];for(let q=0;q<V.length;q++){const[D,U]=V[q],G=mt(R,D);mt(I,D,G),mt(G,U,R);const Z=Wo(My);wr(G,e,Z);const K=Wo();wr(G,r),wr(Z,e,Z),wr(Z,r,K),wr(K,e,Z),wr(K,r,K),mt(Z,U,R),mt(K,U,R)}return mt(i,Uv,_),mt(i,dC,Fte),{start:i,tokens:D6}}function zte(t,e,r){let n=r.length,i=0,a=[],s=[];for(;i<n;){let o=t,l=null,u=null,c=0,h=null,p=-1;for(;i<n&&!(l=o.go(r[i].t));)s.push(r[i++]);for(;i<n&&(u=l||o.go(r[i].t));)l=null,o=u,o.accepts()?(p=0,h=o):p>=0&&p++,i++,c++;if(p<0)i-=c,i<n&&(s.push(r[i]),i++);else{s.length>0&&(a.push(bS(MP,e,s)),s=[]),i-=p,c-=p;const g=h.t,y=r.slice(i-c,i);a.push(bS(g,e,y))}}return s.length>0&&a.push(bS(MP,e,s)),a}function bS(t,e,r){const n=r[0].s,i=r[r.length-1].e,a=e.slice(n,i);return new t(a,r)}const Ute=typeof console<"u"&&console&&console.warn||(()=>{}),Gte="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Rn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Vte(){return Zs.groups={},Rn.scanner=null,Rn.parser=null,Rn.tokenQueue=[],Rn.pluginQueue=[],Rn.customSchemes=[],Rn.initialized=!1,Rn}function AP(t,e=!1){if(Rn.initialized&&Ute(`linkifyjs: already initialized - will not register custom scheme "${t}" ${Gte}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Rn.customSchemes.push([t,e])}function Hte(){Rn.scanner=Ite(Rn.customSchemes);for(let t=0;t<Rn.tokenQueue.length;t++)Rn.tokenQueue[t][1]({scanner:Rn.scanner});Rn.parser=Bte(Rn.scanner.tokens);for(let t=0;t<Rn.pluginQueue.length;t++)Rn.pluginQueue[t][1]({scanner:Rn.scanner,parser:Rn.parser});return Rn.initialized=!0,Rn}function vC(t){return Rn.initialized||Hte(),zte(Rn.parser.start,t,I6(Rn.scanner.start,t))}vC.scan=I6;function F6(t,e=null,r=null){if(e&&typeof e=="object"){if(r)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);r=e,e=null}const n=new gC(r),i=vC(t),a=[];for(let s=0;s<i.length;s++){const o=i[s];o.isLink&&(!e||o.t===e)&&n.check(o)&&a.push(o.toFormattedObject(n))}return a}var yC="[\0- -\u2029]",Wte=new RegExp(yC),qte=new RegExp(`${yC}$`),$te=new RegExp(yC,"g");function Kte(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function Zte(t){return new Yn({key:new Ti("autolink"),appendTransaction:(e,r,n)=>{const i=e.some(u=>u.docChanged)&&!r.doc.eq(n.doc),a=e.some(u=>u.getMeta("preventAutolink"));if(!i||a)return;const{tr:s}=n,o=t6(r.doc,[...e]);if(l6(o).forEach(({newRange:u})=>{const c=HQ(n.doc,u,g=>g.isTextblock);let h,p;if(c.length>1)h=c[0],p=n.doc.textBetween(h.pos,h.pos+h.node.nodeSize,void 0," ");else if(c.length){const g=n.doc.textBetween(u.from,u.to," "," ");if(!qte.test(g))return;h=c[0],p=n.doc.textBetween(h.pos,u.to,void 0," ")}if(h&&p){const g=p.split(Wte).filter(Boolean);if(g.length<=0)return!1;const y=g[g.length-1],S=h.pos+p.lastIndexOf(y);if(!y)return!1;const w=vC(y).map(C=>C.toObject(t.defaultProtocol));if(!Kte(w))return!1;w.filter(C=>C.isLink).map(C=>({...C,from:S+C.start+1,to:S+C.end+1})).filter(C=>n.schema.marks.code?!n.doc.rangeHasMark(C.from,C.to,n.schema.marks.code):!0).filter(C=>t.validate(C.value)).filter(C=>t.shouldAutoLink(C.value)).forEach(C=>{aC(C.from,C.to,n.doc).some(_=>_.mark.type===t.type)||s.addMark(C.from,C.to,t.type.create({href:C.href}))})}}),!!s.steps.length)return s}})}function Yte(t){return new Yn({key:new Ti("handleClickLink"),props:{handleClick:(e,r,n)=>{var i,a;if(n.button!==0||!e.editable)return!1;let s=null;if(n.target instanceof HTMLAnchorElement)s=n.target;else{const l=n.target;if(!l)return!1;const u=t.editor.view.dom;s=l.closest("a"),s&&!u.contains(s)&&(s=null)}if(!s)return!1;let o=!1;if(t.enableClickSelection&&(o=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){const l=o6(e.state,t.type.name),u=(i=s.href)!=null?i:l.href,c=(a=s.target)!=null?a:l.target;u&&(window.open(u,c),o=!0)}return o}}})}function Xte(t){return new Yn({key:new Ti("handlePasteLink"),props:{handlePaste:(e,r,n)=>{const{shouldAutoLink:i}=t,{state:a}=e,{selection:s}=a,{empty:o}=s;if(o)return!1;let l="";n.content.forEach(c=>{l+=c.textContent});const u=F6(l,{defaultProtocol:t.defaultProtocol}).find(c=>c.isLink&&c.value===l);return!l||!u||i!==void 0&&!i(u.value)?!1:t.editor.commands.setMark(t.type,{href:u.href})}}})}function qh(t,e){const r=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(n=>{const i=typeof n=="string"?n:n.scheme;i&&r.push(i)}),!t||t.replace($te,"").match(new RegExp(`^(?:(?:${r.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var Qte=Lf.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){AP(t);return}AP(t.scheme,t.optionalSlashes)})},onDestroy(){Vte()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!qh(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>{const e=/^[a-z][a-z0-9+.-]*:\/\//i.test(t),r=/^[a-z][a-z0-9+.-]*:/i.test(t);if(e||r&&!t.includes("@"))return!0;const i=(t.includes("@")?t.split("@").pop():t).split(/[/?#:]/)[0];return!(/^\d{1,3}(\.\d{1,3}){3}$/.test(i)||!/\./.test(i))}}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:r=>!!qh(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!qh(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Zn(this.options.HTMLAttributes,t),0]:["a",Zn(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var r;const n=((r=t.attrs)==null?void 0:r.href)||"";return`[${e.renderChildren(t)}](${n})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:r}=t;return this.options.isAllowedUri(r,{defaultValidate:n=>!!qh(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:r}=t||{};return r&&!this.options.isAllowedUri(r,{defaultValidate:n=>!!qh(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Cf({find:t=>{const e=[];if(t){const{protocols:r,defaultProtocol:n}=this.options,i=F6(t).filter(a=>a.isLink&&this.options.isAllowedUri(a.value,{defaultValidate:s=>!!qh(s,r),protocols:r,defaultProtocol:n}));i.length&&i.forEach(a=>{this.options.shouldAutoLink(a.value)&&e.push({text:a.value,data:{href:a.href},index:a.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:r}=this.options;return this.options.autolink&&t.push(Zte({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:n=>this.options.isAllowedUri(n,{defaultValidate:i=>!!qh(i,e),protocols:e,defaultProtocol:r}),shouldAutoLink:this.options.shouldAutoLink})),t.push(Yte({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(Xte({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),Jte=Object.defineProperty,ere=(t,e)=>{for(var r in e)Jte(t,r,{get:e[r],enumerable:!0})},tre="listItem",LP="textStyle",RP=/^\s*([-+*])\s$/,B6=to.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(tre,this.editor.getAttributes(LP)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=tm({find:RP,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=tm({find:RP,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(LP),editor:this.editor})),[t]}}),z6=to.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let r=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(i=>i.type==="paragraph"))r=e.parseChildren(t.tokens);else{const i=t.tokens[0];if(i&&i.type==="text"&&i.tokens&&i.tokens.length>0){if(r=[{type:"paragraph",content:e.parseInline(i.tokens)}],t.tokens.length>1){const s=t.tokens.slice(1),o=e.parseChildren(s);r.push(...o)}}else r=e.parseChildren(t.tokens)}return r.length===0&&(r=[{type:"paragraph",content:[]}]),{type:"listItem",content:r}},renderMarkdown:(t,e,r)=>uC(t,e,n=>n.parentType==="bulletList"?"- ":n.parentType==="orderedList"?`${n.index+1}. `:"- ",r),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),rre={};ere(rre,{findListItemPos:()=>f0,getNextListDepth:()=>xC,handleBackspace:()=>jk,handleDelete:()=>Fk,hasListBefore:()=>U6,hasListItemAfter:()=>nre,hasListItemBefore:()=>G6,listItemHasSubList:()=>V6,nextListIsDeeper:()=>H6,nextListIsHigher:()=>W6});var f0=(t,e)=>{const{$from:r}=e.selection,n=ji(t,e.schema);let i=null,a=r.depth,s=r.pos,o=null;for(;a>0&&o===null;)i=r.node(a),i.type===n?o=a:(a-=1,s-=1);return o===null?null:{$pos:e.doc.resolve(s),depth:o}},xC=(t,e)=>{const r=f0(t,e);if(!r)return!1;const[,n]=eJ(e,t,r.$pos.pos+4);return n},U6=(t,e,r)=>{const{$anchor:n}=t.selection,i=Math.max(0,n.pos-2),a=t.doc.resolve(i).node();return!(!a||!r.includes(a.type.name))},G6=(t,e)=>{var r;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-2);return!(i.index()===0||((r=i.nodeBefore)==null?void 0:r.type.name)!==t)},V6=(t,e,r)=>{if(!r)return!1;const n=ji(t,e.schema);let i=!1;return r.descendants(a=>{a.type===n&&(i=!0)}),i},jk=(t,e,r)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!nh(t.state,e)&&U6(t.state,e,r)){const{$anchor:o}=t.state.selection,l=t.state.doc.resolve(o.before()-1),u=[];l.node().descendants((p,g)=>{p.type.name===e&&u.push({node:p,pos:g})});const c=u.at(-1);if(!c)return!1;const h=t.state.doc.resolve(l.start()+c.pos+1);return t.chain().cut({from:o.start()-1,to:o.end()+1},h.end()).joinForward().run()}if(!nh(t.state,e)||!iJ(t.state))return!1;const n=f0(e,t.state);if(!n)return!1;const a=t.state.doc.resolve(n.$pos.pos-2).node(n.depth),s=V6(e,t.state,a);return G6(e,t.state)&&!s?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},H6=(t,e)=>{const r=xC(t,e),n=f0(t,e);return!n||!r?!1:r>n.depth},W6=(t,e)=>{const r=xC(t,e),n=f0(t,e);return!n||!r?!1:r<n.depth},Fk=(t,e)=>{if(!nh(t.state,e)||!nJ(t.state,e))return!1;const{selection:r}=t.state,{$from:n,$to:i}=r;return!r.empty&&n.sameParent(i)?!1:H6(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():W6(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},nre=(t,e)=>{var r;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-n.parentOffset-2);return!(i.index()===i.parent.childCount-1||((r=i.nodeAfter)==null?void 0:r.type.name)!==t)},q6=Ni.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r})=>{t.state.schema.nodes[r]!==void 0&&Fk(t,r)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r})=>{t.state.schema.nodes[r]!==void 0&&Fk(t,r)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r,wrapperNames:n})=>{t.state.schema.nodes[r]!==void 0&&jk(t,r,n)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r,wrapperNames:n})=>{t.state.schema.nodes[r]!==void 0&&jk(t,r,n)&&(e=!0)}),e}}}}),OP=/^(\s*)(\d+)\.\s+(.*)$/,ire=/^\s/;function are(t){const e=[];let r=0,n=0;for(;r<t.length;){const i=t[r],a=i.match(OP);if(!a)break;const[,s,o,l]=a,u=s.length;let c=l,h=r+1;const p=[i];for(;h<t.length;){const g=t[h];if(g.match(OP))break;if(g.trim()==="")p.push(g),c+=`
`,h+=1;else if(g.match(ire))p.push(g),c+=`
${g.slice(u+2)}`,h+=1;else break}e.push({indent:u,number:parseInt(o,10),content:c.trim(),raw:p.join(`
`)}),n=h,r=h}return[e,n]}function $6(t,e,r){var n;const i=[];let a=0;for(;a<t.length;){const s=t[a];if(s.indent===e){const o=s.content.split(`
`),l=((n=o[0])==null?void 0:n.trim())||"",u=[];l&&u.push({type:"paragraph",raw:l,tokens:r.inlineTokens(l)});const c=o.slice(1).join(`
`).trim();if(c){const g=r.blockTokens(c);u.push(...g)}let h=a+1;const p=[];for(;h<t.length&&t[h].indent>e;)p.push(t[h]),h+=1;if(p.length>0){const g=Math.min(...p.map(S=>S.indent)),y=$6(p,g,r);u.push({type:"list",ordered:!0,start:p[0].number,items:y,raw:p.map(S=>S.raw).join(`
`)})}i.push({type:"list_item",raw:s.raw,tokens:u}),a=h}else a+=1}return i}function sre(t,e){return t.map(r=>{if(r.type!=="list_item")return e.parseChildren([r])[0];const n=[];return r.tokens&&r.tokens.length>0&&r.tokens.forEach(i=>{if(i.type==="paragraph"||i.type==="list"||i.type==="blockquote"||i.type==="code")n.push(...e.parseChildren([i]));else if(i.type==="text"&&i.tokens){const a=e.parseChildren([i]);n.push({type:"paragraph",content:a})}else{const a=e.parseChildren([i]);a.length>0&&n.push(...a)}}),{type:"listItem",content:n}})}var ore="listItem",DP="textStyle",IP=/^(\d+)\.\s$/,K6=to.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...r}=t;return e===1?["ol",Zn(this.options.HTMLAttributes,r),0]:["ol",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const r=t.start||1,n=t.items?sre(t.items,e):[];return r!==1?{type:"orderedList",attrs:{start:r},content:n}:{type:"orderedList",content:n}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),r=e?.index;return r!==void 0?r:-1},tokenize:(t,e,r)=>{var n;const i=t.split(`
`),[a,s]=are(i);if(a.length===0)return;const o=$6(a,0,r);return o.length===0?void 0:{type:"list",ordered:!0,start:((n=a[0])==null?void 0:n.number)||1,items:o,raw:i.slice(0,s).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ore,this.editor.getAttributes(DP)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=tm({find:IP,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,r)=>r.childCount+r.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=tm({find:IP,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(DP)}),joinPredicate:(e,r)=>r.childCount+r.attrs.start===+e[1],editor:this.editor})),[t]}}),lre=/^\s*(\[([( |x])?\])\s$/,ure=to.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",Zn(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const r=[];if(t.tokens&&t.tokens.length>0?r.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?r.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):r.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const n=e.parseChildren(t.nestedTokens);r.push(...n)}return e.createNode("taskItem",{checked:t.checked||!1},r)},renderMarkdown:(t,e)=>{var r;const i=`- [${(r=t.attrs)!=null&&r.checked?"x":" "}] `;return uC(t,e,i)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:r,editor:n})=>{const i=document.createElement("li"),a=document.createElement("label"),s=document.createElement("span"),o=document.createElement("input"),l=document.createElement("div"),u=h=>{var p,g;o.ariaLabel=((g=(p=this.options.a11y)==null?void 0:p.checkboxLabel)==null?void 0:g.call(p,h,o.checked))||`Task item checkbox for ${h.textContent||"empty task item"}`};u(t),a.contentEditable="false",o.type="checkbox",o.addEventListener("mousedown",h=>h.preventDefault()),o.addEventListener("change",h=>{if(!n.isEditable&&!this.options.onReadOnlyChecked){o.checked=!o.checked;return}const{checked:p}=h.target;n.isEditable&&typeof r=="function"&&n.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:g})=>{const y=r();if(typeof y!="number")return!1;const S=g.doc.nodeAt(y);return g.setNodeMarkup(y,void 0,{...S?.attrs,checked:p}),!0}).run(),!n.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,p)||(o.checked=!o.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([h,p])=>{i.setAttribute(h,p)}),i.dataset.checked=t.attrs.checked,o.checked=t.attrs.checked,a.append(o,s),i.append(a,l),Object.entries(e).forEach(([h,p])=>{i.setAttribute(h,p)});let c=new Set(Object.keys(e));return{dom:i,contentDOM:l,update:h=>{if(h.type!==this.type)return!1;i.dataset.checked=h.attrs.checked,o.checked=h.attrs.checked,u(h);const p=n.extensionManager.attributes,g=zv(h,p),y=new Set(Object.keys(g)),S=this.options.HTMLAttributes;return c.forEach(w=>{y.has(w)||(w in S?i.setAttribute(w,S[w]):i.removeAttribute(w))}),Object.entries(g).forEach(([w,C])=>{C==null?w in S?i.setAttribute(w,S[w]):i.removeAttribute(w):i.setAttribute(w,C)}),c=y,!0}}}},addInputRules(){return[tm({find:lre,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),cre=to.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",Zn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const r=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return r!==void 0?r:-1},tokenize(t,e,r){const n=a=>{const s=Tk(a,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:o=>({indentLevel:o[1].length,mainContent:o[4],checked:o[3].toLowerCase()==="x"}),createToken:(o,l)=>({type:"taskItem",raw:"",mainContent:o.mainContent,indentLevel:o.indentLevel,checked:o.checked,text:o.mainContent,tokens:r.inlineTokens(o.mainContent),nestedTokens:l}),customNestedParser:n},r);return s?[{type:"taskList",raw:s.raw,items:s.items}]:r.blockTokens(a)},i=Tk(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,s)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:r.inlineTokens(a.mainContent),nestedTokens:s}),customNestedParser:n},r);if(i)return{type:"taskList",raw:i.raw,items:i.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Ni.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(B6.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(z6.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(q6.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(K6.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(ure.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(cre.configure(this.options.taskList)),t}});var dre=to.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Zn(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const r=t.tokens||[];return r.length===1&&r[0].type==="image"?e.parseChildren([r[0]]):e.createNode("paragraph",void 0,e.parseInline(r))},renderMarkdown:(t,e)=>!t||!Array.isArray(t.content)?"":e.renderChildren(t.content),addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),hre=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,fre=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,pre=Lf.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[em({find:hre,type:this.type})]},addPasteRules(){return[Cf({find:fre,type:this.type})]}}),mre=to.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),gre=Lf.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",Zn(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,r){const i=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!i)return;const a=i[2].trim();return{type:"underline",raw:i[0],text:a,tokens:r.inlineTokens(a)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function vre(t={}){return new Yn({view(e){return new yre(e,t)}})}class yre{constructor(e,r){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(n=r.width)!==null&&n!==void 0?n:1,this.color=r.color===!1?void 0:r.color||"black",this.class=r.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let a=s=>{this[i](s)};return e.dom.addEventListener(i,a),{name:i,handler:a}})}destroy(){this.handlers.forEach(({name:e,handler:r})=>this.editorView.dom.removeEventListener(e,r))}update(e,r){this.cursorPos!=null&&r.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),r=!e.parent.inlineContent,n,i=this.editorView.dom,a=i.getBoundingClientRect(),s=a.width/i.offsetWidth,o=a.height/i.offsetHeight;if(r){let h=e.nodeBefore,p=e.nodeAfter;if(h||p){let g=this.editorView.nodeDOM(this.cursorPos-(h?h.nodeSize:0));if(g){let y=g.getBoundingClientRect(),S=h?y.bottom:y.top;h&&p&&(S=(S+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let w=this.width/2*o;n={left:y.left,right:y.right,top:S-w,bottom:S+w}}}}if(!n){let h=this.editorView.coordsAtPos(this.cursorPos),p=this.width/2*s;n={left:h.left-p,right:h.left+p,top:h.top,bottom:h.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",r),this.element.classList.toggle("prosemirror-dropcursor-inline",!r);let u,c;if(!l||l==document.body&&getComputedStyle(l).position=="static")u=-pageXOffset,c=-pageYOffset;else{let h=l.getBoundingClientRect(),p=h.width/l.offsetWidth,g=h.height/l.offsetHeight;u=h.left-l.scrollLeft*p,c=h.top-l.scrollTop*g}this.element.style.left=(n.left-u)/s+"px",this.element.style.top=(n.top-c)/o+"px",this.element.style.width=(n.right-n.left)/s+"px",this.element.style.height=(n.bottom-n.top)/o+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let r=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=r&&r.inside>=0&&this.editorView.state.doc.nodeAt(r.inside),i=n&&n.type.spec.disableDropCursor,a=typeof i=="function"?i(this.editorView,r,e):i;if(r&&!a){let s=r.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let o=qR(this.editorView.state.doc,s,this.editorView.dragging.slice);o!=null&&(s=o)}this.setCursor(s),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class di extends Sr{constructor(e){super(e,e)}map(e,r){let n=e.resolve(r.map(this.head));return di.valid(n)?new di(n):Sr.near(n)}content(){return Ot.empty}eq(e){return e instanceof di&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new di(e.resolve(r.pos))}getBookmark(){return new bC(this.anchor)}static valid(e){let r=e.parent;if(r.isTextblock||!xre(e)||!bre(e))return!1;let n=r.type.spec.allowGapCursor;if(n!=null)return n;let i=r.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,r,n=!1){e:for(;;){if(!n&&di.valid(e))return e;let i=e.pos,a=null;for(let s=e.depth;;s--){let o=e.node(s);if(r>0?e.indexAfter(s)<o.childCount:e.index(s)>0){a=o.child(r>0?e.indexAfter(s):e.index(s)-1);break}else if(s==0)return null;i+=r;let l=e.doc.resolve(i);if(di.valid(l))return l}for(;;){let s=r>0?a.firstChild:a.lastChild;if(!s){if(a.isAtom&&!a.isText&&!Qt.isSelectable(a)){e=e.doc.resolve(i+a.nodeSize*r),n=!1;continue e}break}a=s,i+=r;let o=e.doc.resolve(i);if(di.valid(o))return o}return null}}}di.prototype.visible=!1;di.findFrom=di.findGapCursorFrom;Sr.jsonID("gapcursor",di);class bC{constructor(e){this.pos=e}map(e){return new bC(e.map(this.pos))}resolve(e){let r=e.resolve(this.pos);return di.valid(r)?new di(r):Sr.near(r)}}function Z6(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function xre(t){for(let e=t.depth;e>=0;e--){let r=t.index(e),n=t.node(e);if(r==0){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(r-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||Z6(i.type))return!0;if(i.inlineContent)return!1}}return!0}function bre(t){for(let e=t.depth;e>=0;e--){let r=t.indexAfter(e),n=t.node(e);if(r==n.childCount){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(r);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||Z6(i.type))return!0;if(i.inlineContent)return!1}}return!0}function wre(){return new Yn({props:{decorations:Cre,createSelectionBetween(t,e,r){return e.pos==r.pos&&di.valid(r)?new di(r):null},handleClick:kre,handleKeyDown:Sre,handleDOMEvents:{beforeinput:_re}}})}const Sre=$O({ArrowLeft:Ay("horiz",-1),ArrowRight:Ay("horiz",1),ArrowUp:Ay("vert",-1),ArrowDown:Ay("vert",1)});function Ay(t,e){const r=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(n,i,a){let s=n.selection,o=e>0?s.$to:s.$from,l=s.empty;if(s instanceof dr){if(!a.endOfTextblock(r)||o.depth==0)return!1;l=!1,o=n.doc.resolve(e>0?o.after():o.before())}let u=di.findGapCursorFrom(o,e,l);return u?(i&&i(n.tr.setSelection(new di(u))),!0):!1}}function kre(t,e,r){if(!t||!t.editable)return!1;let n=t.state.doc.resolve(e);if(!di.valid(n))return!1;let i=t.posAtCoords({left:r.clientX,top:r.clientY});return i&&i.inside>-1&&Qt.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new di(n))),!0)}function _re(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof di))return!1;let{$from:r}=t.state.selection,n=r.parent.contentMatchAt(r.index()).findWrapping(t.state.schema.nodes.text);if(!n)return!1;let i=ot.empty;for(let s=n.length-1;s>=0;s--)i=ot.from(n[s].createAndFill(null,i));let a=t.state.tr.replace(r.pos,r.pos,new Ot(i,0,0));return a.setSelection(dr.near(a.doc.resolve(r.pos+1))),t.dispatch(a),!1}function Cre(t){if(!(t.selection instanceof di))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",$n.create(t.doc,[as.widget(t.selection.head,e,{key:"gapcursor"})])}var p1=200,va=function(){};va.prototype.append=function(e){return e.length?(e=va.from(e),!this.length&&e||e.length<p1&&this.leafAppend(e)||this.length<p1&&e.leafPrepend(this)||this.appendInner(e)):this};va.prototype.prepend=function(e){return e.length?va.from(e).append(this):this};va.prototype.appendInner=function(e){return new Ere(this,e)};va.prototype.slice=function(e,r){return e===void 0&&(e=0),r===void 0&&(r=this.length),e>=r?va.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,r))};va.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};va.prototype.forEach=function(e,r,n){r===void 0&&(r=0),n===void 0&&(n=this.length),r<=n?this.forEachInner(e,r,n,0):this.forEachInvertedInner(e,r,n,0)};va.prototype.map=function(e,r,n){r===void 0&&(r=0),n===void 0&&(n=this.length);var i=[];return this.forEach(function(a,s){return i.push(e(a,s))},r,n),i};va.from=function(e){return e instanceof va?e:e&&e.length?new Y6(e):va.empty};var Y6=(function(t){function e(n){t.call(this),this.values=n}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,a){return i==0&&a==this.length?this:new e(this.values.slice(i,a))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,a,s,o){for(var l=a;l<s;l++)if(i(this.values[l],o+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,a,s,o){for(var l=a-1;l>=s;l--)if(i(this.values[l],o+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=p1)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=p1)return new e(i.flatten().concat(this.values))},r.length.get=function(){return this.values.length},r.depth.get=function(){return 0},Object.defineProperties(e.prototype,r),e})(va);va.empty=new Y6([]);var Ere=(function(t){function e(r,n){t.call(this),this.left=r,this.right=n,this.length=r.length+n.length,this.depth=Math.max(r.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,i,a,s){var o=this.left.length;if(i<o&&this.left.forEachInner(n,i,Math.min(a,o),s)===!1||a>o&&this.right.forEachInner(n,Math.max(i-o,0),Math.min(this.length,a)-o,s+o)===!1)return!1},e.prototype.forEachInvertedInner=function(n,i,a,s){var o=this.left.length;if(i>o&&this.right.forEachInvertedInner(n,i-o,Math.max(a,o)-o,s+o)===!1||a<o&&this.left.forEachInvertedInner(n,Math.min(i,o),a,s)===!1)return!1},e.prototype.sliceInner=function(n,i){if(n==0&&i==this.length)return this;var a=this.left.length;return i<=a?this.left.slice(n,i):n>=a?this.right.slice(n-a,i-a):this.left.slice(n,a).append(this.right.slice(0,i-a))},e.prototype.leafAppend=function(n){var i=this.right.leafAppend(n);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(n){var i=this.left.leafPrepend(n);if(i)return new e(i,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e})(va);const Tre=500;class Rl{constructor(e,r){this.items=e,this.eventCount=r}popEvent(e,r){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let i,a;r&&(i=this.remapping(n,this.items.length),a=i.maps.length);let s=e.tr,o,l,u=[],c=[];return this.items.forEach((h,p)=>{if(!h.step){i||(i=this.remapping(n,p+1),a=i.maps.length),a--,c.push(h);return}if(i){c.push(new wu(h.map));let g=h.step.map(i.slice(a)),y;g&&s.maybeStep(g).doc&&(y=s.mapping.maps[s.mapping.maps.length-1],u.push(new wu(y,void 0,void 0,u.length+c.length))),a--,y&&i.appendMap(y,a)}else s.maybeStep(h.step);if(h.selection)return o=i?h.selection.map(i.slice(a)):h.selection,l=new Rl(this.items.slice(0,n).append(c.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:s,selection:o}}addTransform(e,r,n,i){let a=[],s=this.eventCount,o=this.items,l=!i&&o.length?o.get(o.length-1):null;for(let c=0;c<e.steps.length;c++){let h=e.steps[c].invert(e.docs[c]),p=new wu(e.mapping.maps[c],h,r),g;(g=l&&l.merge(p))&&(p=g,c?a.pop():o=o.slice(0,o.length-1)),a.push(p),r&&(s++,r=void 0),i||(l=p)}let u=s-n.depth;return u>Pre&&(o=Nre(o,u),s-=u),new Rl(o.append(a),s)}remapping(e,r){let n=new Ov;return this.items.forEach((i,a)=>{let s=i.mirrorOffset!=null&&a-i.mirrorOffset>=e?n.maps.length-i.mirrorOffset:void 0;n.appendMap(i.map,s)},e,r),n}addMaps(e){return this.eventCount==0?this:new Rl(this.items.append(e.map(r=>new wu(r))),this.eventCount)}rebased(e,r){if(!this.eventCount)return this;let n=[],i=Math.max(0,this.items.length-r),a=e.mapping,s=e.steps.length,o=this.eventCount;this.items.forEach(p=>{p.selection&&o--},i);let l=r;this.items.forEach(p=>{let g=a.getMirror(--l);if(g==null)return;s=Math.min(s,g);let y=a.maps[g];if(p.step){let S=e.steps[g].invert(e.docs[g]),w=p.selection&&p.selection.map(a.slice(l+1,g));w&&o++,n.push(new wu(y,S,w))}else n.push(new wu(y))},i);let u=[];for(let p=r;p<s;p++)u.push(new wu(a.maps[p]));let c=this.items.slice(0,i).append(u).append(n),h=new Rl(c,o);return h.emptyItemCount()>Tre&&(h=h.compress(this.items.length-n.length)),h}emptyItemCount(){let e=0;return this.items.forEach(r=>{r.step||e++}),e}compress(e=this.items.length){let r=this.remapping(0,e),n=r.maps.length,i=[],a=0;return this.items.forEach((s,o)=>{if(o>=e)i.push(s),s.selection&&a++;else if(s.step){let l=s.step.map(r.slice(n)),u=l&&l.getMap();if(n--,u&&r.appendMap(u,n),l){let c=s.selection&&s.selection.map(r.slice(n));c&&a++;let h=new wu(u.invert(),l,c),p,g=i.length-1;(p=i.length&&i[g].merge(h))?i[g]=p:i.push(h)}}else s.map&&n--},this.items.length,0),new Rl(va.from(i.reverse()),a)}}Rl.empty=new Rl(va.empty,0);function Nre(t,e){let r;return t.forEach((n,i)=>{if(n.selection&&e--==0)return r=i,!1}),t.slice(r)}class wu{constructor(e,r,n,i){this.map=e,this.step=r,this.selection=n,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let r=e.step.merge(this.step);if(r)return new wu(r.getMap().invert(),r,this.selection)}}}class Pd{constructor(e,r,n,i,a){this.done=e,this.undone=r,this.prevRanges=n,this.prevTime=i,this.prevComposition=a}}const Pre=20;function Mre(t,e,r,n){let i=r.getMeta(df),a;if(i)return i.historyState;r.getMeta(Rre)&&(t=new Pd(t.done,t.undone,null,0,-1));let s=r.getMeta("appendedTransaction");if(r.steps.length==0)return t;if(s&&s.getMeta(df))return s.getMeta(df).redo?new Pd(t.done.addTransform(r,void 0,n,Qy(e)),t.undone,jP(r.mapping.maps),t.prevTime,t.prevComposition):new Pd(t.done,t.undone.addTransform(r,void 0,n,Qy(e)),null,t.prevTime,t.prevComposition);if(r.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){let o=r.getMeta("composition"),l=t.prevTime==0||!s&&t.prevComposition!=o&&(t.prevTime<(r.time||0)-n.newGroupDelay||!Are(r,t.prevRanges)),u=s?wS(t.prevRanges,r.mapping):jP(r.mapping.maps);return new Pd(t.done.addTransform(r,l?e.selection.getBookmark():void 0,n,Qy(e)),Rl.empty,u,r.time,o??t.prevComposition)}else return(a=r.getMeta("rebased"))?new Pd(t.done.rebased(r,a),t.undone.rebased(r,a),wS(t.prevRanges,r.mapping),t.prevTime,t.prevComposition):new Pd(t.done.addMaps(r.mapping.maps),t.undone.addMaps(r.mapping.maps),wS(t.prevRanges,r.mapping),t.prevTime,t.prevComposition)}function Are(t,e){if(!e)return!1;if(!t.docChanged)return!0;let r=!1;return t.mapping.maps[0].forEach((n,i)=>{for(let a=0;a<e.length;a+=2)n<=e[a+1]&&i>=e[a]&&(r=!0)}),r}function jP(t){let e=[];for(let r=t.length-1;r>=0&&e.length==0;r--)t[r].forEach((n,i,a,s)=>e.push(a,s));return e}function wS(t,e){if(!t)return null;let r=[];for(let n=0;n<t.length;n+=2){let i=e.map(t[n],1),a=e.map(t[n+1],-1);i<=a&&r.push(i,a)}return r}function Lre(t,e,r){let n=Qy(e),i=df.get(e).spec.config,a=(r?t.undone:t.done).popEvent(e,n);if(!a)return null;let s=a.selection.resolve(a.transform.doc),o=(r?t.done:t.undone).addTransform(a.transform,e.selection.getBookmark(),i,n),l=new Pd(r?o:a.remaining,r?a.remaining:o,null,0,-1);return a.transform.setSelection(s).setMeta(df,{redo:r,historyState:l})}let SS=!1,FP=null;function Qy(t){let e=t.plugins;if(FP!=e){SS=!1,FP=e;for(let r=0;r<e.length;r++)if(e[r].spec.historyPreserveItems){SS=!0;break}}return SS}const df=new Ti("history"),Rre=new Ti("closeHistory");function Ore(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Yn({key:df,state:{init(){return new Pd(Rl.empty,Rl.empty,null,0,-1)},apply(e,r,n){return Mre(r,n,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,r){let n=r.inputType,i=n=="historyUndo"?Q6:n=="historyRedo"?J6:null;return!i||!e.editable?!1:(r.preventDefault(),i(e.state,e.dispatch))}}}})}function X6(t,e){return(r,n)=>{let i=df.getState(r);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(n){let a=Lre(i,r,t);a&&n(e?a.scrollIntoView():a)}return!0}}const Q6=X6(!1,!0),J6=X6(!0,!0);Ni.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=t?.node||this.editor.state.doc;if((t?.mode||this.options.mode)==="textSize"){const n=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(n)}return e.nodeSize},this.storage.words=t=>{const e=t?.node||this.editor.state.doc,r=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(r)}},addProseMirrorPlugins(){let t=!1;return[new Yn({key:new Ti("characterCount"),appendTransaction:(e,r,n)=>{if(t)return;const i=this.options.limit;if(i==null||i===0){t=!0;return}const a=this.storage.characters({node:n.doc});if(a>i){const s=a-i,o=0,l=s;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const u=n.tr.deleteRange(o,l);return t=!0,u}t=!0},filterTransaction:(e,r)=>{const n=this.options.limit;if(!e.docChanged||n===0||n===null||n===void 0)return!0;const i=this.storage.characters({node:r.doc}),a=this.storage.characters({node:e.doc});if(a<=n||i>n&&a>n&&a<=i)return!0;if(i>n&&a>n&&a>i||!e.getMeta("paste"))return!1;const o=e.selection.$head.pos,l=a-n,u=o-l,c=o;return e.deleteRange(u,c),!(this.storage.characters({node:e.doc})>n)}})]}});var Dre=Ni.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[vre(this.options)]}});Ni.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new Yn({key:new Ti("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:r,isFocused:n}=this.editor,{anchor:i}=e,a=[];if(!r||!n)return $n.create(t,[]);let s=0;this.options.mode==="deepest"&&t.descendants((l,u)=>{if(l.isText)return;if(!(i>=u&&i<=u+l.nodeSize-1))return!1;s+=1});let o=0;return t.descendants((l,u)=>{if(l.isText||!(i>=u&&i<=u+l.nodeSize-1))return!1;if(o+=1,this.options.mode==="deepest"&&s-o>0||this.options.mode==="shallowest"&&o>1)return this.options.mode==="deepest";a.push(as.node(u,u+l.nodeSize,{class:this.options.className}))}),$n.create(t,a)}}})]}});var Ire=Ni.create({name:"gapCursor",addProseMirrorPlugins(){return[wre()]},extendNodeSchema(t){var e;const r={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=dn(Kt(t,"allowGapCursor",r)))!=null?e:null}}}),jre=Ni.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Yn({key:new Ti("placeholder"),props:{decorations:({doc:t,selection:e})=>{const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:n}=e,i=[];if(!r)return null;const a=this.editor.isEmpty;return t.descendants((s,o)=>{const l=n>=o&&n<=o+s.nodeSize,u=!s.isLeaf&&tb(s);if((l||!this.options.showOnlyCurrent)&&u){const c=[this.options.emptyNodeClass];a&&c.push(this.options.emptyEditorClass);const h=as.node(o,o+s.nodeSize,{class:c.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:s,pos:o,hasAnchor:l}):this.options.placeholder});i.push(h)}return this.options.includeChildren}),$n.create(t,i)}}})]}});Ni.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new Yn({key:new Ti("selection"),props:{decorations(r){return r.selection.empty||t.isFocused||!t.isEditable||u6(r.selection)||t.view.dragging?null:$n.create(r.doc,[as.inline(r.selection.from,r.selection.to,{class:e.className})])}}})]}});function BP({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||e?.type===t}var Fre=Ni.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new Ti(this.name),r=this.options.node||((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||"paragraph",n=Object.entries(this.editor.schema.nodes).map(([,i])=>i).filter(i=>(this.options.notAfter||[]).concat(r).includes(i.name));return[new Yn({key:e,appendTransaction:(i,a,s)=>{const{doc:o,tr:l,schema:u}=s,c=e.getState(s),h=o.content.size,p=u.nodes[r];if(c)return l.insert(h,p.create())},state:{init:(i,a)=>{const s=a.tr.doc.lastChild;return!BP({node:s,types:n})},apply:(i,a)=>{if(!i.docChanged||i.getMeta("__uniqueIDTransaction"))return a;const s=i.doc.lastChild;return!BP({node:s,types:n})}}})]}}),Bre=Ni.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>Q6(t,e),redo:()=>({state:t,dispatch:e})=>J6(t,e)}},addProseMirrorPlugins(){return[Ore(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),zre=Ni.create({name:"starterKit",addExtensions(){var t,e,r,n;const i=[];return this.options.bold!==!1&&i.push(hte.configure(this.options.bold)),this.options.blockquote!==!1&&i.push(ote.configure(this.options.blockquote)),this.options.bulletList!==!1&&i.push(B6.configure(this.options.bulletList)),this.options.code!==!1&&i.push(mte.configure(this.options.code)),this.options.codeBlock!==!1&&i.push(yte.configure(this.options.codeBlock)),this.options.document!==!1&&i.push(xte.configure(this.options.document)),this.options.dropcursor!==!1&&i.push(Dre.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&i.push(Ire.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&i.push(bte.configure(this.options.hardBreak)),this.options.heading!==!1&&i.push(wte.configure(this.options.heading)),this.options.undoRedo!==!1&&i.push(Bre.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&i.push(Ste.configure(this.options.horizontalRule)),this.options.italic!==!1&&i.push(Tte.configure(this.options.italic)),this.options.listItem!==!1&&i.push(z6.configure(this.options.listItem)),this.options.listKeymap!==!1&&i.push(q6.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&i.push(Qte.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&i.push(K6.configure(this.options.orderedList)),this.options.paragraph!==!1&&i.push(dre.configure(this.options.paragraph)),this.options.strike!==!1&&i.push(pre.configure(this.options.strike)),this.options.text!==!1&&i.push(mre.configure(this.options.text)),this.options.underline!==!1&&i.push(gre.configure((r=this.options)==null?void 0:r.underline)),this.options.trailingNode!==!1&&i.push(Fre.configure((n=this.options)==null?void 0:n.trailingNode)),i}}),Ure=zre,Gre=jre;function Vre(t){var e;const{char:r,allowSpaces:n,allowToIncludeChar:i,allowedPrefixes:a,startOfLine:s,$position:o}=t,l=n&&!i,u=WJ(r),c=new RegExp(`\\s${u}$`),h=s?"^":"",p=i?"":u,g=l?new RegExp(`${h}${u}.*?(?=\\s${p}|$)`,"gm"):new RegExp(`${h}(?:^)?${u}[^\\s${p}]*`,"gm"),y=((e=o.nodeBefore)==null?void 0:e.isText)&&o.nodeBefore.text;if(!y)return null;const S=o.pos-y.length,w=Array.from(y.matchAll(g)).pop();if(!w||w.input===void 0||w.index===void 0)return null;const C=w.input.slice(Math.max(0,w.index-1),w.index),_=new RegExp(`^[${a?.join("")}\0]?$`).test(C);if(a!==null&&!_)return null;const T=S+w.index;let N=T+w[0].length;return l&&c.test(y.slice(N-1,N+1))&&(w[0]+=" ",N+=1),T<o.pos&&N>=o.pos?{range:{from:T,to:N},query:w[0].slice(r.length),text:w[0]}:null}var Hre=new Ti("suggestion");function Wre({pluginKey:t=Hre,editor:e,char:r="@",allowSpaces:n=!1,allowToIncludeChar:i=!1,allowedPrefixes:a=[" "],startOfLine:s=!1,decorationTag:o="span",decorationClass:l="suggestion",decorationContent:u="",decorationEmptyClass:c="is-empty",command:h=()=>null,items:p=()=>[],render:g=()=>({}),allow:y=()=>!0,findSuggestionMatch:S=Vre,shouldShow:w}){let C;const _=g?.(),T=()=>{const j=e.state.selection.$anchor.pos,O=e.view.coordsAtPos(j),{top:F,right:z,bottom:V,left:q}=O;try{return new DOMRect(q,F,z-q,V-F)}catch{return null}},N=(j,O)=>O?()=>{const F=t.getState(e.state),z=F?.decorationId,V=j.dom.querySelector(`[data-decoration-id="${z}"]`);return V?.getBoundingClientRect()||null}:T;function R(j,O){var F;try{const V=t.getState(j.state),q=V?.decorationId?j.dom.querySelector(`[data-decoration-id="${V.decorationId}"]`):null,D={editor:e,range:V?.range||{from:0,to:0},query:V?.query||null,text:V?.text||null,items:[],command:U=>h({editor:e,range:V?.range||{from:0,to:0},props:U}),decorationNode:q,clientRect:N(j,q)};(F=_?.onExit)==null||F.call(_,D)}catch{}const z=j.state.tr.setMeta(O,{exit:!0});j.dispatch(z)}const I=new Yn({key:t,view(){return{update:async(j,O)=>{var F,z,V,q,D,U,G;const Z=(F=this.key)==null?void 0:F.getState(O),K=(z=this.key)==null?void 0:z.getState(j.state),Q=Z.active&&K.active&&Z.range.from!==K.range.from,ne=!Z.active&&K.active,te=Z.active&&!K.active,X=!ne&&!te&&Z.query!==K.query,re=ne||Q&&X,he=X||Q,oe=te||Q&&X;if(!re&&!he&&!oe)return;const se=oe&&!re?Z:K,fe=j.dom.querySelector(`[data-decoration-id="${se.decorationId}"]`);C={editor:e,range:se.range,query:se.query,text:se.text,items:[],command:ae=>h({editor:e,range:se.range,props:ae}),decorationNode:fe,clientRect:N(j,fe)},re&&((V=_?.onBeforeStart)==null||V.call(_,C)),he&&((q=_?.onBeforeUpdate)==null||q.call(_,C)),(he||re)&&(C.items=await p({editor:e,query:se.query})),oe&&((D=_?.onExit)==null||D.call(_,C)),he&&((U=_?.onUpdate)==null||U.call(_,C)),re&&((G=_?.onStart)==null||G.call(_,C))},destroy:()=>{var j;C&&((j=_?.onExit)==null||j.call(_,C))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(j,O,F,z){const{isEditable:V}=e,{composing:q}=e.view,{selection:D}=j,{empty:U,from:G}=D,Z={...O},K=j.getMeta(t);if(K&&K.exit)return Z.active=!1,Z.decorationId=null,Z.range={from:0,to:0},Z.query=null,Z.text=null,Z;if(Z.composing=q,V&&(U||e.view.composing)){(G<O.range.from||G>O.range.to)&&!q&&!O.composing&&(Z.active=!1);const Q=S({char:r,allowSpaces:n,allowToIncludeChar:i,allowedPrefixes:a,startOfLine:s,$position:D.$from}),ne=`id_${Math.floor(Math.random()*4294967295)}`;Q&&y({editor:e,state:z,range:Q.range,isActive:O.active})&&(!w||w({editor:e,range:Q.range,query:Q.query,text:Q.text,transaction:j}))?(Z.active=!0,Z.decorationId=O.decorationId?O.decorationId:ne,Z.range=Q.range,Z.query=Q.query,Z.text=Q.text):Z.active=!1}else Z.active=!1;return Z.active||(Z.decorationId=null,Z.range={from:0,to:0},Z.query=null,Z.text=null),Z}},props:{handleKeyDown(j,O){var F,z,V,q;const{active:D,range:U}=I.getState(j.state);if(!D)return!1;if(O.key==="Escape"||O.key==="Esc"){const Z=I.getState(j.state),K=(F=C?.decorationNode)!=null?F:null,Q=K??(Z?.decorationId?j.dom.querySelector(`[data-decoration-id="${Z.decorationId}"]`):null);if(((z=_?.onKeyDown)==null?void 0:z.call(_,{view:j,event:O,range:Z.range}))||!1)return!0;const te={editor:e,range:Z.range,query:Z.query,text:Z.text,items:[],command:X=>h({editor:e,range:Z.range,props:X}),decorationNode:Q,clientRect:Q?()=>Q.getBoundingClientRect()||null:null};return(V=_?.onExit)==null||V.call(_,te),R(j,t),!0}return((q=_?.onKeyDown)==null?void 0:q.call(_,{view:j,event:O,range:U}))||!1},decorations(j){const{active:O,range:F,decorationId:z,query:V}=I.getState(j);if(!O)return null;const q=!V?.length,D=[l];return q&&D.push(c),$n.create(j.doc,[as.inline(F.from,F.to,{nodeName:o,class:D.join(" "),"data-decoration-id":z,"data-decoration-content":u})])}}});return I}function qre({editor:t,overrideSuggestionOptions:e,extensionName:r,char:n="@"}){const i=new Ti;return{editor:t,char:n,pluginKey:i,command:({editor:a,range:s,props:o})=>{var l,u,c;const h=a.view.state.selection.$to.nodeAfter;(l=h?.text)!=null&&l.startsWith(" ")&&(s.to+=1),a.chain().focus().insertContentAt(s,[{type:r,attrs:{...o,mentionSuggestionChar:n}},{type:"text",text:" "}]).run(),(c=(u=a.view.dom.ownerDocument.defaultView)==null?void 0:u.getSelection())==null||c.collapseToEnd()},allow:({state:a,range:s})=>{const o=a.doc.resolve(s.from),l=a.schema.nodes[r];return!!o.parent.type.contentMatch.matchType(l)},...e}}function eD(t){return(t.options.suggestions.length?t.options.suggestions:[t.options.suggestion]).map(e=>qre({editor:t.editor,overrideSuggestionOptions:e,extensionName:t.name,char:e.char}))}function zP(t,e){const r=eD(t),n=r.find(i=>i.char===e);return n||(r.length?r[0]:null)}var $re=to.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({node:t,suggestion:e}){var r,n;return`${(r=e?.char)!=null?r:"@"}${(n=t.attrs.label)!=null?n:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:t,node:e,suggestion:r}){var n,i;return["span",Zn(this.HTMLAttributes,t.HTMLAttributes),`${(n=r?.char)!=null?n:"@"}${(i=e.attrs.label)!=null?i:e.attrs.id}`]},suggestions:[],suggestion:{}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:t=>t.getAttribute("data-mention-suggestion-char"),renderHTML:t=>({"data-mention-suggestion-char":t.mentionSuggestionChar})}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){const r=zP(this,t.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",Zn({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t,suggestion:r})];const n={...this.options};n.HTMLAttributes=Zn({"data-type":this.name},this.options.HTMLAttributes,e);const i=this.options.renderHTML({options:n,node:t,suggestion:r});return typeof i=="string"?["span",Zn({"data-type":this.name},this.options.HTMLAttributes,e),i]:i},...E6({nodeName:"mention",name:"@",selfClosing:!0,allowedAttributes:["id","label",{name:"mentionSuggestionChar",skipIfDefault:"@"}],parseAttributes:t=>{const e={},r=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=r.exec(t);for(;n!==null;){const[,i,a,s]=n,o=a??s;e[i==="char"?"mentionSuggestionChar":i]=o,n=r.exec(t)}return e},serializeAttributes:t=>Object.entries(t).filter(([,e])=>e!=null).map(([e,r])=>`${e==="mentionSuggestionChar"?"char":e}="${r}"`).join(" ")}),renderText({node:t}){const e={options:this.options,node:t,suggestion:zP(this,t.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(e)):this.options.renderText(e)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let r=!1;const{selection:n}=e,{empty:i,anchor:a}=n;if(!i)return!1;let s=new Qo,o=0;return e.doc.nodesBetween(a-1,a,(l,u)=>{if(l.type.name===this.name)return r=!0,s=l,o=u,!1}),r&&t.insertText(this.options.deleteTriggerWithBackspace?"":s.attrs.mentionSuggestionChar,o,o+s.nodeSize),r})}},addProseMirrorPlugins(){return eD(this).map(Wre)}}),Kre=$re,Qs="top",rl="bottom",nl="right",Js="left",wC="auto",p0=[Qs,rl,nl,Js],rm="start",Vv="end",Zre="clippingParents",tD="viewport",Gg="popper",Yre="reference",UP=p0.reduce(function(t,e){return t.concat([e+"-"+rm,e+"-"+Vv])},[]),rD=[].concat(p0,[wC]).reduce(function(t,e){return t.concat([e,e+"-"+rm,e+"-"+Vv])},[]),Xre="beforeRead",Qre="read",Jre="afterRead",ene="beforeMain",tne="main",rne="afterMain",nne="beforeWrite",ine="write",ane="afterWrite",sne=[Xre,Qre,Jre,ene,tne,rne,nne,ine,ane];function Mu(t){return t?(t.nodeName||"").toLowerCase():null}function xo(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Ef(t){var e=xo(t).Element;return t instanceof e||t instanceof Element}function tl(t){var e=xo(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function SC(t){if(typeof ShadowRoot>"u")return!1;var e=xo(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function one(t){var e=t.state;Object.keys(e.elements).forEach(function(r){var n=e.styles[r]||{},i=e.attributes[r]||{},a=e.elements[r];!tl(a)||!Mu(a)||(Object.assign(a.style,n),Object.keys(i).forEach(function(s){var o=i[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function lne(t){var e=t.state,r={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,r.popper),e.styles=r,e.elements.arrow&&Object.assign(e.elements.arrow.style,r.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],a=e.attributes[n]||{},s=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:r[n]),o=s.reduce(function(l,u){return l[u]="",l},{});!tl(i)||!Mu(i)||(Object.assign(i.style,o),Object.keys(a).forEach(function(l){i.removeAttribute(l)}))})}}const nD={name:"applyStyles",enabled:!0,phase:"write",fn:one,effect:lne,requires:["computeStyles"]};function Eu(t){return t.split("-")[0]}var hf=Math.max,m1=Math.min,nm=Math.round;function Bk(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function iD(){return!/^((?!chrome|android).)*safari/i.test(Bk())}function im(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!1);var n=t.getBoundingClientRect(),i=1,a=1;e&&tl(t)&&(i=t.offsetWidth>0&&nm(n.width)/t.offsetWidth||1,a=t.offsetHeight>0&&nm(n.height)/t.offsetHeight||1);var s=Ef(t)?xo(t):window,o=s.visualViewport,l=!iD()&&r,u=(n.left+(l&&o?o.offsetLeft:0))/i,c=(n.top+(l&&o?o.offsetTop:0))/a,h=n.width/i,p=n.height/a;return{width:h,height:p,top:c,right:u+h,bottom:c+p,left:u,x:u,y:c}}function kC(t){var e=im(t),r=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-r)<=1&&(r=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:r,height:n}}function aD(t,e){var r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&SC(r)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function xc(t){return xo(t).getComputedStyle(t)}function une(t){return["table","td","th"].indexOf(Mu(t))>=0}function mh(t){return((Ef(t)?t.ownerDocument:t.document)||window.document).documentElement}function ab(t){return Mu(t)==="html"?t:t.assignedSlot||t.parentNode||(SC(t)?t.host:null)||mh(t)}function GP(t){return!tl(t)||xc(t).position==="fixed"?null:t.offsetParent}function cne(t){var e=/firefox/i.test(Bk()),r=/Trident/i.test(Bk());if(r&&tl(t)){var n=xc(t);if(n.position==="fixed")return null}var i=ab(t);for(SC(i)&&(i=i.host);tl(i)&&["html","body"].indexOf(Mu(i))<0;){var a=xc(i);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return i;i=i.parentNode}return null}function m0(t){for(var e=xo(t),r=GP(t);r&&une(r)&&xc(r).position==="static";)r=GP(r);return r&&(Mu(r)==="html"||Mu(r)==="body"&&xc(r).position==="static")?e:r||cne(t)||e}function _C(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function fv(t,e,r){return hf(t,m1(e,r))}function dne(t,e,r){var n=fv(t,e,r);return n>r?r:n}function sD(){return{top:0,right:0,bottom:0,left:0}}function oD(t){return Object.assign({},sD(),t)}function lD(t,e){return e.reduce(function(r,n){return r[n]=t,r},{})}var hne=function(e,r){return e=typeof e=="function"?e(Object.assign({},r.rects,{placement:r.placement})):e,oD(typeof e!="number"?e:lD(e,p0))};function fne(t){var e,r=t.state,n=t.name,i=t.options,a=r.elements.arrow,s=r.modifiersData.popperOffsets,o=Eu(r.placement),l=_C(o),u=[Js,nl].indexOf(o)>=0,c=u?"height":"width";if(!(!a||!s)){var h=hne(i.padding,r),p=kC(a),g=l==="y"?Qs:Js,y=l==="y"?rl:nl,S=r.rects.reference[c]+r.rects.reference[l]-s[l]-r.rects.popper[c],w=s[l]-r.rects.reference[l],C=m0(a),_=C?l==="y"?C.clientHeight||0:C.clientWidth||0:0,T=S/2-w/2,N=h[g],R=_-p[c]-h[y],I=_/2-p[c]/2+T,j=fv(N,I,R),O=l;r.modifiersData[n]=(e={},e[O]=j,e.centerOffset=j-I,e)}}function pne(t){var e=t.state,r=t.options,n=r.element,i=n===void 0?"[data-popper-arrow]":n;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||aD(e.elements.popper,i)&&(e.elements.arrow=i))}const mne={name:"arrow",enabled:!0,phase:"main",fn:fne,effect:pne,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function am(t){return t.split("-")[1]}var gne={top:"auto",right:"auto",bottom:"auto",left:"auto"};function vne(t,e){var r=t.x,n=t.y,i=e.devicePixelRatio||1;return{x:nm(r*i)/i||0,y:nm(n*i)/i||0}}function VP(t){var e,r=t.popper,n=t.popperRect,i=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,h=t.isFixed,p=s.x,g=p===void 0?0:p,y=s.y,S=y===void 0?0:y,w=typeof c=="function"?c({x:g,y:S}):{x:g,y:S};g=w.x,S=w.y;var C=s.hasOwnProperty("x"),_=s.hasOwnProperty("y"),T=Js,N=Qs,R=window;if(u){var I=m0(r),j="clientHeight",O="clientWidth";if(I===xo(r)&&(I=mh(r),xc(I).position!=="static"&&o==="absolute"&&(j="scrollHeight",O="scrollWidth")),I=I,i===Qs||(i===Js||i===nl)&&a===Vv){N=rl;var F=h&&I===R&&R.visualViewport?R.visualViewport.height:I[j];S-=F-n.height,S*=l?1:-1}if(i===Js||(i===Qs||i===rl)&&a===Vv){T=nl;var z=h&&I===R&&R.visualViewport?R.visualViewport.width:I[O];g-=z-n.width,g*=l?1:-1}}var V=Object.assign({position:o},u&&gne),q=c===!0?vne({x:g,y:S},xo(r)):{x:g,y:S};if(g=q.x,S=q.y,l){var D;return Object.assign({},V,(D={},D[N]=_?"0":"",D[T]=C?"0":"",D.transform=(R.devicePixelRatio||1)<=1?"translate("+g+"px, "+S+"px)":"translate3d("+g+"px, "+S+"px, 0)",D))}return Object.assign({},V,(e={},e[N]=_?S+"px":"",e[T]=C?g+"px":"",e.transform="",e))}function yne(t){var e=t.state,r=t.options,n=r.gpuAcceleration,i=n===void 0?!0:n,a=r.adaptive,s=a===void 0?!0:a,o=r.roundOffsets,l=o===void 0?!0:o,u={placement:Eu(e.placement),variation:am(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,VP(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,VP(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const xne={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:yne,data:{}};var Ly={passive:!0};function bne(t){var e=t.state,r=t.instance,n=t.options,i=n.scroll,a=i===void 0?!0:i,s=n.resize,o=s===void 0?!0:s,l=xo(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",r.update,Ly)}),o&&l.addEventListener("resize",r.update,Ly),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",r.update,Ly)}),o&&l.removeEventListener("resize",r.update,Ly)}}const wne={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:bne,data:{}};var Sne={left:"right",right:"left",bottom:"top",top:"bottom"};function Jy(t){return t.replace(/left|right|bottom|top/g,function(e){return Sne[e]})}var kne={start:"end",end:"start"};function HP(t){return t.replace(/start|end/g,function(e){return kne[e]})}function CC(t){var e=xo(t),r=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:r,scrollTop:n}}function EC(t){return im(mh(t)).left+CC(t).scrollLeft}function _ne(t,e){var r=xo(t),n=mh(t),i=r.visualViewport,a=n.clientWidth,s=n.clientHeight,o=0,l=0;if(i){a=i.width,s=i.height;var u=iD();(u||!u&&e==="fixed")&&(o=i.offsetLeft,l=i.offsetTop)}return{width:a,height:s,x:o+EC(t),y:l}}function Cne(t){var e,r=mh(t),n=CC(t),i=(e=t.ownerDocument)==null?void 0:e.body,a=hf(r.scrollWidth,r.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),s=hf(r.scrollHeight,r.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),o=-n.scrollLeft+EC(t),l=-n.scrollTop;return xc(i||r).direction==="rtl"&&(o+=hf(r.clientWidth,i?i.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function TC(t){var e=xc(t),r=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(r+i+n)}function uD(t){return["html","body","#document"].indexOf(Mu(t))>=0?t.ownerDocument.body:tl(t)&&TC(t)?t:uD(ab(t))}function pv(t,e){var r;e===void 0&&(e=[]);var n=uD(t),i=n===((r=t.ownerDocument)==null?void 0:r.body),a=xo(n),s=i?[a].concat(a.visualViewport||[],TC(n)?n:[]):n,o=e.concat(s);return i?o:o.concat(pv(ab(s)))}function zk(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Ene(t,e){var r=im(t,!1,e==="fixed");return r.top=r.top+t.clientTop,r.left=r.left+t.clientLeft,r.bottom=r.top+t.clientHeight,r.right=r.left+t.clientWidth,r.width=t.clientWidth,r.height=t.clientHeight,r.x=r.left,r.y=r.top,r}function WP(t,e,r){return e===tD?zk(_ne(t,r)):Ef(e)?Ene(e,r):zk(Cne(mh(t)))}function Tne(t){var e=pv(ab(t)),r=["absolute","fixed"].indexOf(xc(t).position)>=0,n=r&&tl(t)?m0(t):t;return Ef(n)?e.filter(function(i){return Ef(i)&&aD(i,n)&&Mu(i)!=="body"}):[]}function Nne(t,e,r,n){var i=e==="clippingParents"?Tne(t):[].concat(e),a=[].concat(i,[r]),s=a[0],o=a.reduce(function(l,u){var c=WP(t,u,n);return l.top=hf(c.top,l.top),l.right=m1(c.right,l.right),l.bottom=m1(c.bottom,l.bottom),l.left=hf(c.left,l.left),l},WP(t,s,n));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function cD(t){var e=t.reference,r=t.element,n=t.placement,i=n?Eu(n):null,a=n?am(n):null,s=e.x+e.width/2-r.width/2,o=e.y+e.height/2-r.height/2,l;switch(i){case Qs:l={x:s,y:e.y-r.height};break;case rl:l={x:s,y:e.y+e.height};break;case nl:l={x:e.x+e.width,y:o};break;case Js:l={x:e.x-r.width,y:o};break;default:l={x:e.x,y:e.y}}var u=i?_C(i):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case rm:l[u]=l[u]-(e[c]/2-r[c]/2);break;case Vv:l[u]=l[u]+(e[c]/2-r[c]/2);break}}return l}function Hv(t,e){e===void 0&&(e={});var r=e,n=r.placement,i=n===void 0?t.placement:n,a=r.strategy,s=a===void 0?t.strategy:a,o=r.boundary,l=o===void 0?Zre:o,u=r.rootBoundary,c=u===void 0?tD:u,h=r.elementContext,p=h===void 0?Gg:h,g=r.altBoundary,y=g===void 0?!1:g,S=r.padding,w=S===void 0?0:S,C=oD(typeof w!="number"?w:lD(w,p0)),_=p===Gg?Yre:Gg,T=t.rects.popper,N=t.elements[y?_:p],R=Nne(Ef(N)?N:N.contextElement||mh(t.elements.popper),l,c,s),I=im(t.elements.reference),j=cD({reference:I,element:T,placement:i}),O=zk(Object.assign({},T,j)),F=p===Gg?O:I,z={top:R.top-F.top+C.top,bottom:F.bottom-R.bottom+C.bottom,left:R.left-F.left+C.left,right:F.right-R.right+C.right},V=t.modifiersData.offset;if(p===Gg&&V){var q=V[i];Object.keys(z).forEach(function(D){var U=[nl,rl].indexOf(D)>=0?1:-1,G=[Qs,rl].indexOf(D)>=0?"y":"x";z[D]+=q[G]*U})}return z}function Pne(t,e){e===void 0&&(e={});var r=e,n=r.placement,i=r.boundary,a=r.rootBoundary,s=r.padding,o=r.flipVariations,l=r.allowedAutoPlacements,u=l===void 0?rD:l,c=am(n),h=c?o?UP:UP.filter(function(y){return am(y)===c}):p0,p=h.filter(function(y){return u.indexOf(y)>=0});p.length===0&&(p=h);var g=p.reduce(function(y,S){return y[S]=Hv(t,{placement:S,boundary:i,rootBoundary:a,padding:s})[Eu(S)],y},{});return Object.keys(g).sort(function(y,S){return g[y]-g[S]})}function Mne(t){if(Eu(t)===wC)return[];var e=Jy(t);return[HP(t),e,HP(e)]}function Ane(t){var e=t.state,r=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var i=r.mainAxis,a=i===void 0?!0:i,s=r.altAxis,o=s===void 0?!0:s,l=r.fallbackPlacements,u=r.padding,c=r.boundary,h=r.rootBoundary,p=r.altBoundary,g=r.flipVariations,y=g===void 0?!0:g,S=r.allowedAutoPlacements,w=e.options.placement,C=Eu(w),_=C===w,T=l||(_||!y?[Jy(w)]:Mne(w)),N=[w].concat(T).reduce(function(oe,se){return oe.concat(Eu(se)===wC?Pne(e,{placement:se,boundary:c,rootBoundary:h,padding:u,flipVariations:y,allowedAutoPlacements:S}):se)},[]),R=e.rects.reference,I=e.rects.popper,j=new Map,O=!0,F=N[0],z=0;z<N.length;z++){var V=N[z],q=Eu(V),D=am(V)===rm,U=[Qs,rl].indexOf(q)>=0,G=U?"width":"height",Z=Hv(e,{placement:V,boundary:c,rootBoundary:h,altBoundary:p,padding:u}),K=U?D?nl:Js:D?rl:Qs;R[G]>I[G]&&(K=Jy(K));var Q=Jy(K),ne=[];if(a&&ne.push(Z[q]<=0),o&&ne.push(Z[K]<=0,Z[Q]<=0),ne.every(function(oe){return oe})){F=V,O=!1;break}j.set(V,ne)}if(O)for(var te=y?3:1,X=function(se){var fe=N.find(function(ae){var pe=j.get(ae);if(pe)return pe.slice(0,se).every(function(ye){return ye})});if(fe)return F=fe,"break"},re=te;re>0;re--){var he=X(re);if(he==="break")break}e.placement!==F&&(e.modifiersData[n]._skip=!0,e.placement=F,e.reset=!0)}}const Lne={name:"flip",enabled:!0,phase:"main",fn:Ane,requiresIfExists:["offset"],data:{_skip:!1}};function qP(t,e,r){return r===void 0&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function $P(t){return[Qs,nl,rl,Js].some(function(e){return t[e]>=0})}function Rne(t){var e=t.state,r=t.name,n=e.rects.reference,i=e.rects.popper,a=e.modifiersData.preventOverflow,s=Hv(e,{elementContext:"reference"}),o=Hv(e,{altBoundary:!0}),l=qP(s,n),u=qP(o,i,a),c=$P(l),h=$P(u);e.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:h},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":h})}const One={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Rne};function Dne(t,e,r){var n=Eu(t),i=[Js,Qs].indexOf(n)>=0?-1:1,a=typeof r=="function"?r(Object.assign({},e,{placement:t})):r,s=a[0],o=a[1];return s=s||0,o=(o||0)*i,[Js,nl].indexOf(n)>=0?{x:o,y:s}:{x:s,y:o}}function Ine(t){var e=t.state,r=t.options,n=t.name,i=r.offset,a=i===void 0?[0,0]:i,s=rD.reduce(function(c,h){return c[h]=Dne(h,e.rects,a),c},{}),o=s[e.placement],l=o.x,u=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[n]=s}const jne={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Ine};function Fne(t){var e=t.state,r=t.name;e.modifiersData[r]=cD({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const Bne={name:"popperOffsets",enabled:!0,phase:"read",fn:Fne,data:{}};function zne(t){return t==="x"?"y":"x"}function Une(t){var e=t.state,r=t.options,n=t.name,i=r.mainAxis,a=i===void 0?!0:i,s=r.altAxis,o=s===void 0?!1:s,l=r.boundary,u=r.rootBoundary,c=r.altBoundary,h=r.padding,p=r.tether,g=p===void 0?!0:p,y=r.tetherOffset,S=y===void 0?0:y,w=Hv(e,{boundary:l,rootBoundary:u,padding:h,altBoundary:c}),C=Eu(e.placement),_=am(e.placement),T=!_,N=_C(C),R=zne(N),I=e.modifiersData.popperOffsets,j=e.rects.reference,O=e.rects.popper,F=typeof S=="function"?S(Object.assign({},e.rects,{placement:e.placement})):S,z=typeof F=="number"?{mainAxis:F,altAxis:F}:Object.assign({mainAxis:0,altAxis:0},F),V=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,q={x:0,y:0};if(I){if(a){var D,U=N==="y"?Qs:Js,G=N==="y"?rl:nl,Z=N==="y"?"height":"width",K=I[N],Q=K+w[U],ne=K-w[G],te=g?-O[Z]/2:0,X=_===rm?j[Z]:O[Z],re=_===rm?-O[Z]:-j[Z],he=e.elements.arrow,oe=g&&he?kC(he):{width:0,height:0},se=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:sD(),fe=se[U],ae=se[G],pe=fv(0,j[Z],oe[Z]),ye=T?j[Z]/2-te-pe-fe-z.mainAxis:X-pe-fe-z.mainAxis,ve=T?-j[Z]/2+te+pe+ae+z.mainAxis:re+pe+ae+z.mainAxis,ue=e.elements.arrow&&m0(e.elements.arrow),xe=ue?N==="y"?ue.clientTop||0:ue.clientLeft||0:0,Se=(D=V?.[N])!=null?D:0,Oe=K+ye-Se-xe,Ae=K+ve-Se,tt=fv(g?m1(Q,Oe):Q,K,g?hf(ne,Ae):ne);I[N]=tt,q[N]=tt-K}if(o){var rt,dt=N==="x"?Qs:Js,_t=N==="x"?rl:nl,Xe=I[R],ht=R==="y"?"height":"width",ct=Xe+w[dt],vt=Xe-w[_t],lt=[Qs,Js].indexOf(C)!==-1,Lt=(rt=V?.[R])!=null?rt:0,jt=lt?ct:Xe-j[ht]-O[ht]-Lt+z.altAxis,Ne=lt?Xe+j[ht]+O[ht]-Lt-z.altAxis:vt,qe=g&&lt?dne(jt,Xe,Ne):fv(g?jt:ct,Xe,g?Ne:vt);I[R]=qe,q[R]=qe-Xe}e.modifiersData[n]=q}}const Gne={name:"preventOverflow",enabled:!0,phase:"main",fn:Une,requiresIfExists:["offset"]};function Vne(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function Hne(t){return t===xo(t)||!tl(t)?CC(t):Vne(t)}function Wne(t){var e=t.getBoundingClientRect(),r=nm(e.width)/t.offsetWidth||1,n=nm(e.height)/t.offsetHeight||1;return r!==1||n!==1}function qne(t,e,r){r===void 0&&(r=!1);var n=tl(e),i=tl(e)&&Wne(e),a=mh(e),s=im(t,i,r),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!r)&&((Mu(e)!=="body"||TC(a))&&(o=Hne(e)),tl(e)?(l=im(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=EC(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function $ne(t){var e=new Map,r=new Set,n=[];t.forEach(function(a){e.set(a.name,a)});function i(a){r.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!r.has(o)){var l=e.get(o);l&&i(l)}}),n.push(a)}return t.forEach(function(a){r.has(a.name)||i(a)}),n}function Kne(t){var e=$ne(t);return sne.reduce(function(r,n){return r.concat(e.filter(function(i){return i.phase===n}))},[])}function Zne(t){var e;return function(){return e||(e=new Promise(function(r){Promise.resolve().then(function(){e=void 0,r(t())})})),e}}function Yne(t){var e=t.reduce(function(r,n){var i=r[n.name];return r[n.name]=i?Object.assign({},i,n,{options:Object.assign({},i.options,n.options),data:Object.assign({},i.data,n.data)}):n,r},{});return Object.keys(e).map(function(r){return e[r]})}var KP={placement:"bottom",modifiers:[],strategy:"absolute"};function ZP(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function Xne(t){t===void 0&&(t={});var e=t,r=e.defaultModifiers,n=r===void 0?[]:r,i=e.defaultOptions,a=i===void 0?KP:i;return function(o,l,u){u===void 0&&(u=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},KP,a),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},h=[],p=!1,g={state:c,setOptions:function(C){var _=typeof C=="function"?C(c.options):C;S(),c.options=Object.assign({},a,c.options,_),c.scrollParents={reference:Ef(o)?pv(o):o.contextElement?pv(o.contextElement):[],popper:pv(l)};var T=Kne(Yne([].concat(n,c.options.modifiers)));return c.orderedModifiers=T.filter(function(N){return N.enabled}),y(),g.update()},forceUpdate:function(){if(!p){var C=c.elements,_=C.reference,T=C.popper;if(ZP(_,T)){c.rects={reference:qne(_,m0(T),c.options.strategy==="fixed"),popper:kC(T)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(z){return c.modifiersData[z.name]=Object.assign({},z.data)});for(var N=0;N<c.orderedModifiers.length;N++){if(c.reset===!0){c.reset=!1,N=-1;continue}var R=c.orderedModifiers[N],I=R.fn,j=R.options,O=j===void 0?{}:j,F=R.name;typeof I=="function"&&(c=I({state:c,options:O,name:F,instance:g})||c)}}}},update:Zne(function(){return new Promise(function(w){g.forceUpdate(),w(c)})}),destroy:function(){S(),p=!0}};if(!ZP(o,l))return g;g.setOptions(u).then(function(w){!p&&u.onFirstUpdate&&u.onFirstUpdate(w)});function y(){c.orderedModifiers.forEach(function(w){var C=w.name,_=w.options,T=_===void 0?{}:_,N=w.effect;if(typeof N=="function"){var R=N({state:c,name:C,instance:g,options:T}),I=function(){};h.push(R||I)}})}function S(){h.forEach(function(w){return w()}),h=[]}return g}}var Qne=[wne,Bne,xne,nD,jne,Lne,Gne,mne,One],Jne=Xne({defaultModifiers:Qne}),eie="tippy-box",dD="tippy-content",tie="tippy-backdrop",hD="tippy-arrow",fD="tippy-svg-arrow",Zh={passive:!0,capture:!0},pD=function(){return document.body};function kS(t,e,r){if(Array.isArray(t)){var n=t[e];return n??(Array.isArray(r)?r[e]:r)}return t}function NC(t,e){var r={}.toString.call(t);return r.indexOf("[object")===0&&r.indexOf(e+"]")>-1}function mD(t,e){return typeof t=="function"?t.apply(void 0,e):t}function YP(t,e){if(e===0)return t;var r;return function(n){clearTimeout(r),r=setTimeout(function(){t(n)},e)}}function rie(t){return t.split(/\s+/).filter(Boolean)}function Ap(t){return[].concat(t)}function XP(t,e){t.indexOf(e)===-1&&t.push(e)}function nie(t){return t.filter(function(e,r){return t.indexOf(e)===r})}function iie(t){return t.split("-")[0]}function g1(t){return[].slice.call(t)}function QP(t){return Object.keys(t).reduce(function(e,r){return t[r]!==void 0&&(e[r]=t[r]),e},{})}function mv(){return document.createElement("div")}function sb(t){return["Element","Fragment"].some(function(e){return NC(t,e)})}function aie(t){return NC(t,"NodeList")}function sie(t){return NC(t,"MouseEvent")}function oie(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function lie(t){return sb(t)?[t]:aie(t)?g1(t):Array.isArray(t)?t:g1(document.querySelectorAll(t))}function _S(t,e){t.forEach(function(r){r&&(r.style.transitionDuration=e+"ms")})}function JP(t,e){t.forEach(function(r){r&&r.setAttribute("data-state",e)})}function uie(t){var e,r=Ap(t),n=r[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function cie(t,e){var r=e.clientX,n=e.clientY;return t.every(function(i){var a=i.popperRect,s=i.popperState,o=i.props,l=o.interactiveBorder,u=iie(s.placement),c=s.modifiersData.offset;if(!c)return!0;var h=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,g=u==="right"?c.left.x:0,y=u==="left"?c.right.x:0,S=a.top-n+h>l,w=n-a.bottom-p>l,C=a.left-r+g>l,_=r-a.right-y>l;return S||w||C||_})}function CS(t,e,r){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){t[n](i,r)})}function eM(t,e){for(var r=e;r;){var n;if(t.contains(r))return!0;r=r.getRootNode==null||(n=r.getRootNode())==null?void 0:n.host}return!1}var Su={isTouch:!1},tM=0;function die(){Su.isTouch||(Su.isTouch=!0,window.performance&&document.addEventListener("mousemove",gD))}function gD(){var t=performance.now();t-tM<20&&(Su.isTouch=!1,document.removeEventListener("mousemove",gD)),tM=t}function hie(){var t=document.activeElement;if(oie(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function fie(){document.addEventListener("touchstart",die,Zh),window.addEventListener("blur",hie)}var pie=typeof window<"u"&&typeof document<"u",mie=pie?!!window.msCrypto:!1,gie={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},vie={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Dl=Object.assign({appendTo:pD,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},gie,vie),yie=Object.keys(Dl),xie=function(e){var r=Object.keys(e);r.forEach(function(n){Dl[n]=e[n]})};function vD(t){var e=t.plugins||[],r=e.reduce(function(n,i){var a=i.name,s=i.defaultValue;if(a){var o;n[a]=t[a]!==void 0?t[a]:(o=Dl[a])!=null?o:s}return n},{});return Object.assign({},t,r)}function bie(t,e){var r=e?Object.keys(vD(Object.assign({},Dl,{plugins:e}))):yie,n=r.reduce(function(i,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return i;if(a==="content")i[a]=s;else try{i[a]=JSON.parse(s)}catch{i[a]=s}return i},{});return n}function rM(t,e){var r=Object.assign({},e,{content:mD(e.content,[t])},e.ignoreAttributes?{}:bie(t,e.plugins));return r.aria=Object.assign({},Dl.aria,r.aria),r.aria={expanded:r.aria.expanded==="auto"?e.interactive:r.aria.expanded,content:r.aria.content==="auto"?e.interactive?null:"describedby":r.aria.content},r}var wie=function(){return"innerHTML"};function Uk(t,e){t[wie()]=e}function nM(t){var e=mv();return t===!0?e.className=hD:(e.className=fD,sb(t)?e.appendChild(t):Uk(e,t)),e}function iM(t,e){sb(e.content)?(Uk(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Uk(t,e.content):t.textContent=e.content)}function Gk(t){var e=t.firstElementChild,r=g1(e.children);return{box:e,content:r.find(function(n){return n.classList.contains(dD)}),arrow:r.find(function(n){return n.classList.contains(hD)||n.classList.contains(fD)}),backdrop:r.find(function(n){return n.classList.contains(tie)})}}function yD(t){var e=mv(),r=mv();r.className=eie,r.setAttribute("data-state","hidden"),r.setAttribute("tabindex","-1");var n=mv();n.className=dD,n.setAttribute("data-state","hidden"),iM(n,t.props),e.appendChild(r),r.appendChild(n),i(t.props,t.props);function i(a,s){var o=Gk(e),l=o.box,u=o.content,c=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&iM(u,t.props),s.arrow?c?a.arrow!==s.arrow&&(l.removeChild(c),l.appendChild(nM(s.arrow))):l.appendChild(nM(s.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:i}}yD.$$tippy=!0;var Sie=1,Ry=[],ES=[];function kie(t,e){var r=rM(t,Object.assign({},Dl,vD(QP(e)))),n,i,a,s=!1,o=!1,l=!1,u=!1,c,h,p,g=[],y=YP(Oe,r.interactiveDebounce),S,w=Sie++,C=null,_=nie(r.plugins),T={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},N={id:w,reference:t,popper:mv(),popperInstance:C,props:r,state:T,plugins:_,clearDelayTimeouts:jt,setProps:Ne,setContent:qe,show:bt,hide:at,hideWithInteractivity:ut,enable:lt,disable:Lt,unmount:Fe,destroy:de};if(!r.render)return N;var R=r.render(N),I=R.popper,j=R.onUpdate;I.setAttribute("data-tippy-root",""),I.id="tippy-"+N.id,N.popper=I,t._tippy=N,I._tippy=N;var O=_.map(function(ge){return ge.fn(N)}),F=t.hasAttribute("aria-expanded");return ue(),te(),K(),Q("onCreate",[N]),r.showOnCreate&&ct(),I.addEventListener("mouseenter",function(){N.props.interactive&&N.state.isVisible&&N.clearDelayTimeouts()}),I.addEventListener("mouseleave",function(){N.props.interactive&&N.props.trigger.indexOf("mouseenter")>=0&&U().addEventListener("mousemove",y)}),N;function z(){var ge=N.props.touch;return Array.isArray(ge)?ge:[ge,0]}function V(){return z()[0]==="hold"}function q(){var ge;return!!((ge=N.props.render)!=null&&ge.$$tippy)}function D(){return S||t}function U(){var ge=D().parentNode;return ge?uie(ge):document}function G(){return Gk(I)}function Z(ge){return N.state.isMounted&&!N.state.isVisible||Su.isTouch||c&&c.type==="focus"?0:kS(N.props.delay,ge?0:1,Dl.delay)}function K(ge){ge===void 0&&(ge=!1),I.style.pointerEvents=N.props.interactive&&!ge?"":"none",I.style.zIndex=""+N.props.zIndex}function Q(ge,ke,Ee){if(Ee===void 0&&(Ee=!0),O.forEach(function(Qe){Qe[ge]&&Qe[ge].apply(Qe,ke)}),Ee){var Le;(Le=N.props)[ge].apply(Le,ke)}}function ne(){var ge=N.props.aria;if(ge.content){var ke="aria-"+ge.content,Ee=I.id,Le=Ap(N.props.triggerTarget||t);Le.forEach(function(Qe){var Ve=Qe.getAttribute(ke);if(N.state.isVisible)Qe.setAttribute(ke,Ve?Ve+" "+Ee:Ee);else{var xt=Ve&&Ve.replace(Ee,"").trim();xt?Qe.setAttribute(ke,xt):Qe.removeAttribute(ke)}})}}function te(){if(!(F||!N.props.aria.expanded)){var ge=Ap(N.props.triggerTarget||t);ge.forEach(function(ke){N.props.interactive?ke.setAttribute("aria-expanded",N.state.isVisible&&ke===D()?"true":"false"):ke.removeAttribute("aria-expanded")})}}function X(){U().removeEventListener("mousemove",y),Ry=Ry.filter(function(ge){return ge!==y})}function re(ge){if(!(Su.isTouch&&(l||ge.type==="mousedown"))){var ke=ge.composedPath&&ge.composedPath()[0]||ge.target;if(!(N.props.interactive&&eM(I,ke))){if(Ap(N.props.triggerTarget||t).some(function(Ee){return eM(Ee,ke)})){if(Su.isTouch||N.state.isVisible&&N.props.trigger.indexOf("click")>=0)return}else Q("onClickOutside",[N,ge]);N.props.hideOnClick===!0&&(N.clearDelayTimeouts(),N.hide(),o=!0,setTimeout(function(){o=!1}),N.state.isMounted||fe())}}}function he(){l=!0}function oe(){l=!1}function se(){var ge=U();ge.addEventListener("mousedown",re,!0),ge.addEventListener("touchend",re,Zh),ge.addEventListener("touchstart",oe,Zh),ge.addEventListener("touchmove",he,Zh)}function fe(){var ge=U();ge.removeEventListener("mousedown",re,!0),ge.removeEventListener("touchend",re,Zh),ge.removeEventListener("touchstart",oe,Zh),ge.removeEventListener("touchmove",he,Zh)}function ae(ge,ke){ye(ge,function(){!N.state.isVisible&&I.parentNode&&I.parentNode.contains(I)&&ke()})}function pe(ge,ke){ye(ge,ke)}function ye(ge,ke){var Ee=G().box;function Le(Qe){Qe.target===Ee&&(CS(Ee,"remove",Le),ke())}if(ge===0)return ke();CS(Ee,"remove",h),CS(Ee,"add",Le),h=Le}function ve(ge,ke,Ee){Ee===void 0&&(Ee=!1);var Le=Ap(N.props.triggerTarget||t);Le.forEach(function(Qe){Qe.addEventListener(ge,ke,Ee),g.push({node:Qe,eventType:ge,handler:ke,options:Ee})})}function ue(){V()&&(ve("touchstart",Se,{passive:!0}),ve("touchend",Ae,{passive:!0})),rie(N.props.trigger).forEach(function(ge){if(ge!=="manual")switch(ve(ge,Se),ge){case"mouseenter":ve("mouseleave",Ae);break;case"focus":ve(mie?"focusout":"blur",tt);break;case"focusin":ve("focusout",tt);break}})}function xe(){g.forEach(function(ge){var ke=ge.node,Ee=ge.eventType,Le=ge.handler,Qe=ge.options;ke.removeEventListener(Ee,Le,Qe)}),g=[]}function Se(ge){var ke,Ee=!1;if(!(!N.state.isEnabled||rt(ge)||o)){var Le=((ke=c)==null?void 0:ke.type)==="focus";c=ge,S=ge.currentTarget,te(),!N.state.isVisible&&sie(ge)&&Ry.forEach(function(Qe){return Qe(ge)}),ge.type==="click"&&(N.props.trigger.indexOf("mouseenter")<0||s)&&N.props.hideOnClick!==!1&&N.state.isVisible?Ee=!0:ct(ge),ge.type==="click"&&(s=!Ee),Ee&&!Le&&vt(ge)}}function Oe(ge){var ke=ge.target,Ee=D().contains(ke)||I.contains(ke);if(!(ge.type==="mousemove"&&Ee)){var Le=ht().concat(I).map(function(Qe){var Ve,xt=Qe._tippy,ze=(Ve=xt.popperInstance)==null?void 0:Ve.state;return ze?{popperRect:Qe.getBoundingClientRect(),popperState:ze,props:r}:null}).filter(Boolean);cie(Le,ge)&&(X(),vt(ge))}}function Ae(ge){var ke=rt(ge)||N.props.trigger.indexOf("click")>=0&&s;if(!ke){if(N.props.interactive){N.hideWithInteractivity(ge);return}vt(ge)}}function tt(ge){N.props.trigger.indexOf("focusin")<0&&ge.target!==D()||N.props.interactive&&ge.relatedTarget&&I.contains(ge.relatedTarget)||vt(ge)}function rt(ge){return Su.isTouch?V()!==ge.type.indexOf("touch")>=0:!1}function dt(){_t();var ge=N.props,ke=ge.popperOptions,Ee=ge.placement,Le=ge.offset,Qe=ge.getReferenceClientRect,Ve=ge.moveTransition,xt=q()?Gk(I).arrow:null,ze=Qe?{getBoundingClientRect:Qe,contextElement:Qe.contextElement||D()}:t,$e={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Ct){var Vt=Ct.state;if(q()){var Yt=G(),Lr=Yt.box;["placement","reference-hidden","escaped"].forEach(function(kr){kr==="placement"?Lr.setAttribute("data-placement",Vt.placement):Vt.attributes.popper["data-popper-"+kr]?Lr.setAttribute("data-"+kr,""):Lr.removeAttribute("data-"+kr)}),Vt.attributes.popper={}}}},wt=[{name:"offset",options:{offset:Le}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Ve}},$e];q()&&xt&&wt.push({name:"arrow",options:{element:xt,padding:3}}),wt.push.apply(wt,ke?.modifiers||[]),N.popperInstance=Jne(ze,I,Object.assign({},ke,{placement:Ee,onFirstUpdate:p,modifiers:wt}))}function _t(){N.popperInstance&&(N.popperInstance.destroy(),N.popperInstance=null)}function Xe(){var ge=N.props.appendTo,ke,Ee=D();N.props.interactive&&ge===pD||ge==="parent"?ke=Ee.parentNode:ke=mD(ge,[Ee]),ke.contains(I)||ke.appendChild(I),N.state.isMounted=!0,dt()}function ht(){return g1(I.querySelectorAll("[data-tippy-root]"))}function ct(ge){N.clearDelayTimeouts(),ge&&Q("onTrigger",[N,ge]),se();var ke=Z(!0),Ee=z(),Le=Ee[0],Qe=Ee[1];Su.isTouch&&Le==="hold"&&Qe&&(ke=Qe),ke?n=setTimeout(function(){N.show()},ke):N.show()}function vt(ge){if(N.clearDelayTimeouts(),Q("onUntrigger",[N,ge]),!N.state.isVisible){fe();return}if(!(N.props.trigger.indexOf("mouseenter")>=0&&N.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(ge.type)>=0&&s)){var ke=Z(!1);ke?i=setTimeout(function(){N.state.isVisible&&N.hide()},ke):a=requestAnimationFrame(function(){N.hide()})}}function lt(){N.state.isEnabled=!0}function Lt(){N.hide(),N.state.isEnabled=!1}function jt(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(a)}function Ne(ge){if(!N.state.isDestroyed){Q("onBeforeUpdate",[N,ge]),xe();var ke=N.props,Ee=rM(t,Object.assign({},ke,QP(ge),{ignoreAttributes:!0}));N.props=Ee,ue(),ke.interactiveDebounce!==Ee.interactiveDebounce&&(X(),y=YP(Oe,Ee.interactiveDebounce)),ke.triggerTarget&&!Ee.triggerTarget?Ap(ke.triggerTarget).forEach(function(Le){Le.removeAttribute("aria-expanded")}):Ee.triggerTarget&&t.removeAttribute("aria-expanded"),te(),K(),j&&j(ke,Ee),N.popperInstance&&(dt(),ht().forEach(function(Le){requestAnimationFrame(Le._tippy.popperInstance.forceUpdate)})),Q("onAfterUpdate",[N,ge])}}function qe(ge){N.setProps({content:ge})}function bt(){var ge=N.state.isVisible,ke=N.state.isDestroyed,Ee=!N.state.isEnabled,Le=Su.isTouch&&!N.props.touch,Qe=kS(N.props.duration,0,Dl.duration);if(!(ge||ke||Ee||Le)&&!D().hasAttribute("disabled")&&(Q("onShow",[N],!1),N.props.onShow(N)!==!1)){if(N.state.isVisible=!0,q()&&(I.style.visibility="visible"),K(),se(),N.state.isMounted||(I.style.transition="none"),q()){var Ve=G(),xt=Ve.box,ze=Ve.content;_S([xt,ze],0)}p=function(){var wt;if(!(!N.state.isVisible||u)){if(u=!0,I.offsetHeight,I.style.transition=N.props.moveTransition,q()&&N.props.animation){var Pt=G(),Ct=Pt.box,Vt=Pt.content;_S([Ct,Vt],Qe),JP([Ct,Vt],"visible")}ne(),te(),XP(ES,N),(wt=N.popperInstance)==null||wt.forceUpdate(),Q("onMount",[N]),N.props.animation&&q()&&pe(Qe,function(){N.state.isShown=!0,Q("onShown",[N])})}},Xe()}}function at(){var ge=!N.state.isVisible,ke=N.state.isDestroyed,Ee=!N.state.isEnabled,Le=kS(N.props.duration,1,Dl.duration);if(!(ge||ke||Ee)&&(Q("onHide",[N],!1),N.props.onHide(N)!==!1)){if(N.state.isVisible=!1,N.state.isShown=!1,u=!1,s=!1,q()&&(I.style.visibility="hidden"),X(),fe(),K(!0),q()){var Qe=G(),Ve=Qe.box,xt=Qe.content;N.props.animation&&(_S([Ve,xt],Le),JP([Ve,xt],"hidden"))}ne(),te(),N.props.animation?q()&&ae(Le,N.unmount):N.unmount()}}function ut(ge){U().addEventListener("mousemove",y),XP(Ry,y),y(ge)}function Fe(){N.state.isVisible&&N.hide(),N.state.isMounted&&(_t(),ht().forEach(function(ge){ge._tippy.unmount()}),I.parentNode&&I.parentNode.removeChild(I),ES=ES.filter(function(ge){return ge!==N}),N.state.isMounted=!1,Q("onHidden",[N]))}function de(){N.state.isDestroyed||(N.clearDelayTimeouts(),N.unmount(),xe(),delete t._tippy,N.state.isDestroyed=!0,Q("onDestroy",[N]))}}function g0(t,e){e===void 0&&(e={});var r=Dl.plugins.concat(e.plugins||[]);fie();var n=Object.assign({},e,{plugins:r}),i=lie(t),a=i.reduce(function(s,o){var l=o&&kie(o,n);return l&&s.push(l),s},[]);return sb(t)?a[0]:a}g0.defaultProps=Dl;g0.setDefaultProps=xie;g0.currentInput=Su;Object.assign({},nD,{effect:function(e){var r=e.state,n={popper:{position:r.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(r.elements.popper.style,n.popper),r.styles=n,r.elements.arrow&&Object.assign(r.elements.arrow.style,n.arrow)}});g0.setDefaultProps({render:yD});const _ie=ie.forwardRef((t,e)=>{const[r,n]=ie.useState(0),i=l=>{const u=t.items[l];u&&t.command({id:u.id,label:u.label})},a=()=>{n((r+t.items.length-1)%t.items.length)},s=()=>{n((r+1)%t.items.length)},o=()=>{i(r)};return ie.useEffect(()=>n(0),[t.items]),ie.useImperativeHandle(e,()=>({onKeyDown:({event:l})=>l.key==="ArrowUp"?(a(),!0):l.key==="ArrowDown"?(s(),!0):l.key==="Enter"?(o(),!0):!1})),m.jsx("div",{className:"items bg-white border border-slate-200 rounded-xl shadow-2xl overflow-hidden min-w-[200px] p-2 animate-in zoom-in-95 duration-200",children:t.items.length?t.items.map((l,u)=>m.jsxs("button",{className:`flex w-full items-center text-xs px-4 py-2.5 rounded-lg outline-none text-left transition-all ${u===r?"bg-primary text-white shadow-lg":"text-slate-700 hover:bg-slate-50"}`,onClick:()=>i(u),children:[m.jsx("span",{className:"material-symbols-outlined text-[14px] mr-2 opacity-50",children:"auto_stories"}),m.jsx("span",{className:"font-serif font-bold",children:l.label})]},u)):m.jsx("div",{className:"item text-sm px-2 py-1.5 text-muted-foreground",children:"No result"})})}),Cie={items:async({query:t})=>{try{return(await Ke.get("/world-bible/entities")).filter(r=>r.nombre.toLowerCase().startsWith(t.toLowerCase())).slice(0,5).map(r=>({id:r.id,label:r.nombre}))}catch(e){return console.error(e),[]}},render:()=>{let t,e;return{onStart:r=>{t=new ate(_ie,{props:r,editor:r.editor}),r.clientRect&&(e=g0("body",{getReferenceClientRect:r.clientRect,appendTo:()=>document.body,content:t.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"}))},onUpdate(r){t.updateProps(r),r.clientRect&&e[0].setProps({getReferenceClientRect:r.clientRect})},onKeyDown(r){return r.event.key==="Escape"?(e[0].hide(),!0):t.ref?.onKeyDown(r)},onExit(){e[0].destroy(),t.destroy()}}}},Eie=({content:t,onUpdate:e,editable:r=!0,paperMode:n=!1})=>{const[i,a]=ir.useState({font:"Cormorant Garamond",fontSize:18});ir.useEffect(()=>{const o=localStorage.getItem("app_settings");o&&a(JSON.parse(o))},[]);const s=Qee({extensions:[Ure,Gre.configure({placeholder:"Escribe tu historia aqu... Usa @ para mencionar entidades."}),Kre.configure({HTMLAttributes:{class:"mention"},suggestion:Cie})],content:t,editable:r,onUpdate:({editor:o})=>{e(o.getHTML())},editorProps:{attributes:{class:`prose prose-invert max-w-none focus:outline-none min-h-[300px] p-8 ${n?"text-slate-100":"text-foreground/90"} leading-relaxed text-lg transition-all`,style:`font-family: "${i.font}", serif; font-size: ${i.fontSize}px;`}}});return ie.useEffect(()=>{s&&t!==s.getHTML()&&s.commands.setContent(t)},[t,s]),s?m.jsx("div",{className:`zen-editor-container w-full h-full overflow-y-auto no-scrollbar ${n?"bg-transparent border-none shadow-none":"bg-card/20 rounded-lg border border-border/50"}`,children:m.jsx(Wee,{editor:s,className:"h-full"})}):null},Tie=()=>{const{notebookId:t}=Va(),e=Ga(),{setRightPanelTab:r,setRightOpen:n}=bo(),{t:i}=Ps(),[a,s]=ie.useState(null),[o,l]=ie.useState([]),[u,c]=ie.useState(0),[h,p]=ie.useState(!1),[g,y]=ie.useState(!0),[S,w]=ie.useState(!1),[C,_]=ie.useState(null),T=ie.useRef(null),N=ie.useRef(o),R=ie.useRef(u),I=ie.useRef(!0);ie.useEffect(()=>{N.current=o},[o]),ie.useEffect(()=>{R.current=u},[u]);const[j,O]=ie.useState(null),[F,z]=ie.useState("index");ie.useEffect(()=>{r&&r("CONTEXT"),n(!0),t&&V(t)},[t,r]),ie.useEffect(()=>{const te=setInterval(()=>{const X=document.getElementById("global-right-panel-portal");X&&(O(X),clearInterval(te))},100);return()=>{clearInterval(te),r&&r("NOTEBOOKS")}},[r]),ie.useEffect(()=>{I.current=!0;const te=X=>{T.current&&(X.preventDefault(),X.returnValue="")};return window.addEventListener("beforeunload",te),()=>{if(I.current=!1,window.removeEventListener("beforeunload",te),T.current){clearTimeout(T.current);const X=N.current[R.current];X&&(console.log("Saving on unmount (keepalive):",X.id),Ke.request(`/escritura/hoja/${X.id}`,{method:"PUT",body:JSON.stringify({contenido:X.contenido}),keepalive:!0}).catch(re=>console.error("Error preventing data loss:",re)))}}},[]);const V=async te=>{try{y(!0);const X=await Ke.get(`/escritura/cuaderno/${te}`);s(X);const re=await Ke.get(`/escritura/cuaderno/${te}/hojas`);if(re&&re.length>0)l(re),c(0);else{const he=await Ke.post(`/escritura/cuaderno/${te}/hoja`,{});l([he]),c(0)}}catch(X){console.error("Error loading notebook/pages:",X),e(-1)}finally{y(!1)}},q=te=>{if(!o[u])return;const X=[...o];X[u].contenido=te,l(X),T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{D(X[u])},800)},D=async te=>{I.current&&p(!0);try{await Ke.put(`/escritura/hoja/${te.id}`,{contenido:te.contenido})}catch(X){console.error("Error saving page:",X)}finally{I.current&&p(!1)}},U=async()=>{if(a)try{const te=await Ke.post(`/escritura/cuaderno/${a.id}/hoja`,{});l([...o,te]),c(o.length)}catch(te){console.error("Error creating page:",te)}},G=async te=>{T.current&&clearTimeout(T.current);const X=o[u];if(X)try{await Ke.put(`/escritura/hoja/${X.id}`,{contenido:X.contenido})}catch(re){console.error("Error saving before page switch:",re)}c(te)},Z=(te,X,re)=>{if(te.stopPropagation(),o.length<=1){_({id:X,index:re,error:"one_page"}),w(!0);return}_({id:X,index:re}),w(!0)},K=async()=>{if(!C)return;const{id:te,index:X}=C;try{await Ke.delete(`/escritura/hoja/${te}`);const re=o.filter(oe=>oe.id!==te);let he=u;u===X?he=Math.max(0,X-1):u>X&&(he=u-1),l(re),c(he)}catch(re){console.error("Error deleting page:",re)}finally{w(!1),_(null)}},Q=()=>m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark/95",children:[m.jsxs("div",{className:"p-4 border-b border-white/5 flex items-center justify-center bg-black/60 relative",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-slate-500",children:"Chronicle Hub"}),h&&m.jsx("div",{className:"absolute right-4 animate-pulse",children:m.jsx("span",{className:"material-symbols-outlined text-xs text-amber-500",children:"sync"})})]}),m.jsxs("div",{className:"flex p-2 gap-2 border-b border-white/5 bg-black/20",children:[m.jsx("button",{onClick:()=>z("index"),className:`flex-1 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${F==="index"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:i("writing.index")}),m.jsx("button",{onClick:()=>z("format"),className:`flex-1 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${F==="format"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:i("writing.format")})]}),m.jsx("div",{className:"flex-1 overflow-hidden",children:F==="index"?m.jsxs("div",{className:"flex flex-col h-full",children:[m.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:o.map((te,X)=>m.jsxs("div",{className:"group relative",children:[m.jsxs("button",{onClick:()=>G(X),className:`w-full text-left p-4 rounded-2xl border transition-all ${X===u?"bg-primary/10 border-primary/30 text-primary":"bg-white/5 border-transparent hover:bg-white/10 text-slate-400"}`,children:[m.jsxs("div",{className:"flex justify-between items-center mb-1",children:[m.jsxs("span",{className:"font-serif font-bold text-sm truncate",children:[i("writing.page")," ",X+1]}),X===u&&m.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary shrink-0 ml-2"})]}),m.jsx("p",{className:"text-[10px] line-clamp-2 opacity-50 font-mono break-words leading-relaxed",children:te.contenido?.replace(/<[^>]+>/g,"").substring(0,40)||i("writing.empty")})]}),m.jsx("button",{onClick:re=>Z(re,te.id,X),className:"absolute top-2 right-2 p-1.5 rounded-lg text-slate-600 hover:text-red-400 hover:bg-red-400/10 transition-all opacity-0 group-hover:opacity-100",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},te.id))}),m.jsx("div",{className:"p-4 bg-black/20 border-t border-white/5",children:m.jsxs("button",{onClick:U,className:"w-full py-3 bg-primary text-white rounded-2xl text-[10px] font-black uppercase tracking-widest flex items-center justify-center gap-2 transition-all hover:scale-[1.02] shadow-xl shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-base",children:"add"}),m.jsx("span",{children:i("writing.new_page")})]})})]}):m.jsx("div",{className:"p-6 space-y-8 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-xs font-black uppercase text-primary mb-4 tracking-widest",children:i("writing.format")}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("p",{className:"text-[9px] text-slate-500 uppercase font-bold mb-3",children:"Atajos de Teclado"}),m.jsxs("div",{className:"space-y-2 text-[11px] text-slate-400",children:[m.jsxs("div",{className:"flex justify-between items-center p-2 bg-black/20 rounded",children:[m.jsx("span",{children:"Negrita"}),m.jsx("kbd",{className:"px-2 py-1 bg-slate-800 rounded text-[9px] font-mono",children:"Ctrl+B"})]}),m.jsxs("div",{className:"flex justify-between items-center p-2 bg-black/20 rounded",children:[m.jsx("span",{children:"Cursiva"}),m.jsx("kbd",{className:"px-2 py-1 bg-slate-800 rounded text-[9px] font-mono",children:"Ctrl+I"})]}),m.jsxs("div",{className:"flex justify-between items-center p-2 bg-black/20 rounded",children:[m.jsx("span",{children:"Mencionar entidad"}),m.jsx("kbd",{className:"px-2 py-1 bg-slate-800 rounded text-[9px] font-mono",children:"@"})]}),m.jsxs("div",{className:"flex justify-between items-center p-2 bg-black/20 rounded",children:[m.jsx("span",{children:"Deshacer"}),m.jsx("kbd",{className:"px-2 py-1 bg-slate-800 rounded text-[9px] font-mono",children:"Ctrl+Z"})]}),m.jsxs("div",{className:"flex justify-between items-center p-2 bg-black/20 rounded",children:[m.jsx("span",{children:"Rehacer"}),m.jsx("kbd",{className:"px-2 py-1 bg-slate-800 rounded text-[9px] font-mono",children:"Ctrl+Y"})]})]})]})]})})})]}),ne=o[u];return g?m.jsx("div",{className:"flex-1 flex items-center justify-center bg-background-dark",children:m.jsx("div",{className:"animate-pulse text-slate-500 font-serif text-2xl italic tracking-widest",children:i("writing.opening_chronicle")})}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"flex-1 flex w-full h-full bg-black relative overflow-hidden font-sans",children:[j&&eo.createPortal(Q(),j),m.jsx("div",{className:"flex-1 flex flex-col relative z-10 overflow-hidden",children:m.jsx("main",{className:"flex-1 overflow-y-auto custom-scrollbar flex justify-center bg-black relative no-scrollbar",children:ne&&m.jsx("div",{className:"w-full min-h-full flex flex-col animate-in slide-in-from-bottom-8 duration-700",children:m.jsxs("div",{className:"flex-1 bg-slate-900 overflow-hidden flex flex-col transition-all duration-500 group",children:[m.jsx("div",{className:"h-32 flex items-end px-20 pb-8 border-b border-slate-700/50",children:m.jsx("input",{type:"text",className:"w-full bg-transparent text-5xl font-serif font-black text-slate-100 placeholder:text-slate-600 border-none outline-none focus:ring-0",defaultValue:`${i("writing.chapter")} ${u+1}`,placeholder:i("writing.title_placeholder")})}),m.jsx("div",{className:"flex-1 px-20 py-20 text-slate-100 mx-auto max-w-5xl w-full",children:m.jsx(Eie,{content:ne.contenido,onUpdate:q,paperMode:!0})}),m.jsxs("footer",{className:"h-16 border-t border-slate-700 flex items-center justify-between px-16 text-[10px] font-mono text-slate-500 select-none",children:[m.jsxs("span",{children:[i("writing.page").toUpperCase()," ",u+1," ",i("writing.of")," ",o.length]}),m.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity uppercase font-black tracking-widest",children:a?.titulo||i("common.no_results")})]})]})})})})]}),m.jsx(Zk,{isOpen:S,onClose:()=>{w(!1),_(null)},onConfirm:C?.error==="one_page"?()=>{w(!1),_(null)}:K,title:C?.error==="one_page"?i("common.error"):i("writing.delete_page"),message:C?.error==="one_page"?i("writing.one_page_error"):i("writing.delete_page_confirm"),confirmText:C?.error==="one_page"?i("common.ok"):i("common.confirm_delete"),isDestructive:C?.error!=="one_page"})]})},Nie=()=>{const{username:t,projectName:e}=Va(),r=Ga(),{t:n}=Ps(),{setRightPanelTab:i,setRightOpen:a}=bo(),[s,o]=ie.useState([]),[l,u]=ie.useState(!0),[c,h]=ie.useState(!1),[p,g]=ie.useState("");ie.useEffect(()=>{i&&i("NOTEBOOKS"),y()},[i]);const y=async()=>{try{u(!0);const C=await Ke.get("/escritura/cuadernos");o(C||[])}catch(C){console.error("Error loading notebooks:",C)}finally{u(!1)}},S=async C=>{C.preventDefault();try{const _=await Ke.post("/escritura/cuaderno",{titulo:p||n("writing.new_notebook")});o([...s,_]),h(!1),g(""),r(`/${t}/${e}/writing/${_.id}`)}catch(_){console.error("Error creating notebook:",_)}},w=async(C,_)=>{if(C.stopPropagation(),!!window.confirm(n("writing.delete_confirm")))try{await Ke.delete(`/escritura/cuaderno/${_}`),o(s.filter(T=>T.id!==_))}catch(T){console.error("Error deleting notebook:",T)}};return l?m.jsx("div",{className:"flex-1 flex items-center justify-center bg-background-dark",children:m.jsx("div",{className:"animate-spin text-primary material-symbols-outlined text-4xl",children:"sync"})}):m.jsxs("div",{className:"flex-1 flex flex-col bg-background-dark overflow-y-auto no-scrollbar p-12",children:[m.jsxs("header",{className:"mb-12 flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-4xl font-serif font-bold text-white mb-2",children:n("writing.library")}),m.jsx("p",{className:"text-slate-500 uppercase text-[10px] font-black tracking-[0.2em]",children:n("writing.library_desc")})]}),m.jsx("button",{onClick:()=>h(!0),className:"group relative px-6 py-3 bg-primary/10 hover:bg-primary/20 border border-primary/30 rounded-2xl transition-all overflow-hidden",children:m.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[m.jsx("span",{className:"material-symbols-outlined text-sm transition-transform group-hover:rotate-90",children:"add"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:n("writing.new_notebook")})]})})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:s.map(C=>m.jsxs("div",{onClick:()=>r(`/${t}/${e}/writing/${C.id}`),className:"group relative h-64 bg-surface-dark border border-white/5 rounded-3xl p-6 cursor-pointer hover:border-primary/50 hover:bg-white/[0.02] transition-all hover:-translate-y-2 flex flex-col justify-between overflow-hidden shadow-2xl",children:[m.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 bg-primary/40 group-hover:bg-primary transition-colors"}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined",children:"folder_open"})}),m.jsx("button",{onClick:_=>w(_,C.id),className:"p-1.5 rounded-lg text-slate-600 hover:text-red-400 hover:bg-red-400/10 transition-all opacity-0 group-hover:opacity-100",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-serif font-bold text-slate-100 group-hover:text-primary transition-colors line-clamp-2",children:C.titulo||n("common.no_results")}),m.jsxs("p",{className:"text-[10px] text-slate-500 font-mono mt-1",children:["ID: #",C.id]})]})]}),m.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-white/5 opacity-50 group-hover:opacity-100 transition-opacity",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"auto_stories"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:n("writing.open_archivador")})]})]},C.id))}),c&&m.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:m.jsxs("div",{className:"bg-surface-dark border border-white/10 rounded-[2rem] p-10 w-full max-w-lg shadow-2xl animate-in zoom-in-95 duration-300",children:[m.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[m.jsx("div",{className:"size-12 rounded-2xl bg-primary flex items-center justify-center text-white shadow-xl shadow-primary/30",children:m.jsx("span",{className:"material-symbols-outlined",children:"create_new_folder"})}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-2xl font-serif font-bold text-white",children:"New Archivador"}),m.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-black tracking-widest",children:"Library Expansion"})]})]}),m.jsxs("form",{onSubmit:S,className:"space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] uppercase font-black text-slate-500 tracking-[0.2em] ml-2",children:"Book Title"}),m.jsx("input",{autoFocus:!0,className:"w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all placeholder:text-slate-700",placeholder:"The Chronicles of Void...",value:p,onChange:C=>g(C.target.value),required:!0})]}),m.jsxs("div",{className:"flex gap-4 pt-4",children:[m.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 py-4 text-slate-400 hover:text-white font-black uppercase text-[10px] tracking-widest transition-colors",children:"Cancel"}),m.jsx("button",{type:"submit",className:"flex-[2] py-4 bg-primary hover:bg-primary-dark text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-xl shadow-primary/20 hover:scale-[1.02] active:scale-95 transition-all",children:"Create and Open"})]})]})]})})]})};function Pie(){const{id:t}=Va();Ga();const[e,r]=ie.useState([]),[n,i]=ie.useState(!0),[a,s]=ie.useState(null);ie.useEffect(()=>{o()},[t]);const o=async()=>{try{i(!0);const c=await Ke.get("/api/papelera/items");r(c),s(null)}catch(c){console.error("Error loading trash:",c),s("Failed to load trash items.")}finally{i(!1)}},l=async(c,h)=>{try{await Ke.post(`/api/papelera/restaurar/${c}/${h}`),o()}catch(p){console.error("Restoration failed",p)}},u=async(c,h)=>{if(window.confirm("Are you sure you want to PERMANENTLY delete this item? This cannot be undone."))try{await Ke.delete(`/api/papelera/eliminar/${c}/${h}`),o()}catch(p){console.error("Deletion failed",p)}};return n?m.jsx("div",{className:"text-white p-8",children:"Loading Trash Bin..."}):m.jsxs("div",{className:"flex flex-col h-full bg-[#09090b] text-white p-8 overflow-y-auto",children:[m.jsx("h1",{className:"text-3xl font-light mb-2 text-white/90",children:"Trash Bin"}),m.jsx("p",{className:"text-white/50 mb-8 font-light text-sm",children:"Items are automatically deleted after 30 days."}),a&&m.jsx("div",{className:"bg-red-500/10 border border-red-500/20 text-red-400 p-4 rounded mb-6",children:a}),e.length===0?m.jsxs("div",{className:"flex flex-col items-center justify-center py-20 opacity-50 border border-dashed border-white/10 rounded-xl",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"delete_outline"}),m.jsx("p",{children:"Trash is empty"})]}):m.jsx("div",{className:"bg-zinc-900/50 rounded-xl border border-white/5 overflow-hidden",children:m.jsxs("table",{className:"w-full text-left border-collapse",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"border-b border-white/5 text-xs text-white/40 uppercase tracking-wider",children:[m.jsx("th",{className:"p-4 font-normal",children:"Name"}),m.jsx("th",{className:"p-4 font-normal",children:"Type"}),m.jsx("th",{className:"p-4 font-normal",children:"Deleted Date"}),m.jsx("th",{className:"p-4 font-normal text-right",children:"Actions"})]})}),m.jsx("tbody",{className:"divide-y divide-white/5",children:e.map(c=>m.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[m.jsx("td",{className:"p-4 text-white/80 font-medium",children:c.nombre||"Untitled"}),m.jsx("td",{className:"p-4 text-white/50 text-sm",children:c.tipo}),m.jsx("td",{className:"p-4 text-white/50 text-sm font-mono",children:c.deleted_date?new Date(c.deleted_date).toLocaleDateString():"-"}),m.jsxs("td",{className:"p-4 text-right space-x-2",children:[m.jsx("button",{onClick:()=>l(c.tipo,c.id),className:"px-3 py-1.5 text-xs bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20 rounded-md transition-colors border border-emerald-500/20",children:"RESTORE"}),m.jsx("button",{onClick:()=>u(c.tipo,c.id),className:"px-3 py-1.5 text-xs bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded-md transition-colors border border-red-500/20",children:"DELETE"})]})]},`${c.tipo}-${c.id}`))})]})})]})}const Mie=({attribute:t,value:e,onChange:r,onRemove:n,linkableEntities:i=[]})=>{const a=t.plantilla||t,s=()=>{switch(a.tipo){case"text":return m.jsx("textarea",{className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none resize-none no-scrollbar h-auto min-h-[100px]",value:e||"",onChange:p=>r(p.target.value),placeholder:"..."});case"short_text":return m.jsx("input",{type:"text",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none",value:e||"",onChange:p=>r(p.target.value),placeholder:"..."});case"number":return m.jsx("input",{type:"number",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none",value:e||"",onChange:p=>r(p.target.value)});case"boolean":return m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("button",{onClick:()=>r(e==="true"?"false":"true"),className:`size-6 rounded-lg border flex items-center justify-center transition-all ${e==="true"?"bg-primary border-primary text-white":"border-glass-border text-transparent hover:border-primary/50"}`,children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"check"})}),m.jsx("span",{className:"text-xs text-text-muted",children:e==="true"?"Enabled":"Disabled"})]});case"select":let o=[];try{o=(typeof a.metadata=="string"?JSON.parse(a.metadata||"{}"):a.metadata||{}).options||[]}catch{}return m.jsxs("div",{className:"relative",children:[m.jsxs("select",{className:"w-full bg-black/30 border border-white/5 rounded-xl px-4 py-2.5 text-sm text-white focus:outline-none focus:border-primary/50 appearance-none cursor-pointer",value:e||"",onChange:p=>r(p.target.value),children:[m.jsx("option",{value:"",className:"bg-[#1a1a20] text-white",children:"Select an option..."}),o.map((p,g)=>m.jsx("option",{value:p,className:"bg-surface-dark text-white p-2",children:p},g))]}),m.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"unfold_more"})})]});case"multi_select":let l=[];try{l=(typeof a.metadata=="string"?JSON.parse(a.metadata||"{}"):a.metadata||{}).options||[]}catch{}let u=[];try{u=e?JSON.parse(e):[],Array.isArray(u)||(u=[])}catch(p){console.error("Error parsing select values",p)}const c=p=>{const g=u.includes(p)?u.filter(y=>y!==p):[...u,p];r(JSON.stringify(g))};return m.jsxs("div",{className:"bg-black/20 border border-white/5 rounded-xl p-2 space-y-1 max-h-40 overflow-y-auto custom-scrollbar",children:[l.map((p,g)=>m.jsxs("label",{onClick:y=>{y.preventDefault(),c(p)},className:"flex items-center gap-3 p-2 hover:bg-white/5 rounded-lg cursor-pointer group transition-colors",children:[m.jsx("div",{className:`size-4 rounded border flex items-center justify-center transition-all ${u.includes(p)?"bg-primary border-primary":"border-white/10 group-hover:border-white/30"}`,children:u.includes(p)&&m.jsx("span",{className:"material-symbols-outlined text-[10px] text-white",children:"check"})}),m.jsx("span",{className:`text-xs font-medium ${u.includes(p)?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:p})]},g)),l.length===0&&m.jsx("div",{className:"text-xs text-slate-500 p-2 italic",children:"No options defined."})]});case"date":return m.jsx("input",{type:"date",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none [color-scheme:dark]",value:e||"",onChange:p=>r(p.target.value)});case"entity_link":return m.jsxs("div",{className:"relative",children:[m.jsxs("select",{className:"w-full bg-black/30 border border-white/5 rounded-xl px-4 py-2.5 text-sm text-white focus:outline-none focus:border-primary/50 appearance-none cursor-pointer",value:e||"",onChange:p=>r(p.target.value),children:[m.jsx("option",{value:"",className:"bg-[#1a1a20] text-white",children:"Select an Entity Link..."}),i.map(p=>m.jsx("option",{value:p.id,className:"bg-surface-dark text-white p-2",children:p.nombre},p.id))]}),m.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"link"})})]});case"image":return m.jsxs("div",{className:"space-y-2",children:[m.jsx("div",{className:"flex gap-2",children:m.jsx("input",{type:"text",className:"flex-1 bg-black/30 border border-white/5 rounded-xl px-4 py-2 text-xs text-text-muted focus:text-white focus:outline-none",placeholder:"Image URL...",value:e||"",onChange:p=>r(p.target.value)})}),e&&m.jsx("div",{className:"w-full aspect-video rounded-xl bg-black/40 border border-white/5 overflow-hidden relative group",children:m.jsx("img",{src:e,alt:"Preview",className:"w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"})}),!e&&m.jsx("div",{className:"w-full h-20 rounded-xl bg-white/5 border border-dashed border-white/10 flex items-center justify-center text-text-muted/30",children:m.jsx("span",{className:"material-symbols-outlined",children:"image"})})]});case"table":const h=e||"[]";return m.jsxs("div",{className:"space-y-2",children:[m.jsx("textarea",{className:"w-full h-32 bg-black/30 border border-white/5 rounded-xl p-3 text-xs font-mono text-white/70 focus:outline-none focus:border-primary/50",value:h,onChange:p=>r(p.target.value),placeholder:'[{"Item": "Sword", "Qty": 1}, ...]'}),m.jsxs("div",{className:"text-[10px] text-text-muted flex justify-between",children:[m.jsx("span",{children:"JSON Format supported"}),m.jsx("span",{className:"material-symbols-outlined text-xs",children:"data_array"})]})]});default:return m.jsxs("div",{className:"text-sm font-medium text-white/70 italic p-2 rounded-lg bg-white/5 border border-white/5",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 mr-2",children:a.tipo}),e]})}};return m.jsxs("div",{className:"p-4 border border-white/5 rounded-2xl bg-surface-dark/50 backdrop-blur-sm relative overflow-hidden h-full flex flex-col group hover:border-primary/20 transition-all",children:[m.jsxs("label",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted mb-3 flex items-center justify-between gap-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-xs opacity-50",children:"label"}),a.nombre]}),n&&m.jsx("button",{onClick:o=>{o.preventDefault(),n()},className:"text-white/20 hover:text-red-400 transition-colors",title:"Remove Attribute",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),m.jsx("div",{className:"flex-1 nodrag",children:s()}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"})]})},Aie=[{value:"All",label:"Todo"},{value:"Individual",label:"Personaje"},{value:"Group",label:"Grupo/Faccin"},{value:"Location",label:"Lugar"},{value:"Item",label:"Objeto"},{value:"Event",label:"Evento"},{value:"Timeline",label:"Lnea de Tiempo"},{value:"Map",label:"Mapa"},{value:"Structure",label:"Construccin"},{value:"Creature",label:"Criatura"},{value:"Plant",label:"Flora"}],Lie=({entityId:t,entityType:e})=>{console.log(">>> RELATIONSHIP MANAGER V2 LOADED");const[r,n]=ie.useState([]),[i,a]=ie.useState(!1),[s,o]=ie.useState(!1),[l,u]=ie.useState("All"),[c,h]=ie.useState([]),[p,g]=ie.useState(""),[y,S]=ie.useState(""),[w,C]=ie.useState(""),[_,T]=ie.useState(""),[N,R]=ie.useState(!1);ie.useEffect(()=>{t&&I()},[t,e]),ie.useEffect(()=>{s&&l&&j(l)},[s,l]);const I=async()=>{a(!0);try{const q=(await Ke.get("/bd/relacion")).filter(U=>U.nodoOrigenId===parseInt(t)&&(U.tipoOrigen===e||U.tipoOrigen==="GenericEntity")||U.nodoDestinoId===parseInt(t)&&(U.tipoDestino===e||U.tipoDestino==="GenericEntity")),D=await Promise.all(q.map(async U=>{const G=U.nodoOrigenId===parseInt(t),Z=G?U.nodoDestinoId:U.nodoOrigenId,K=await Ke.get(`/world-bible/entities/${Z}`);if(!K)throw new Error(`Entity ${Z} not found`);return{...U,otherName:K.nombre,otherType:K.categoria||"Entity",isOutgoing:G}}));n(D)}catch(V){console.error("Failed to load relationships",V)}finally{a(!1)}},j=async V=>{R(!0);try{const q=await Ke.get("/world-bible/entities"),D=V==="All"?q:q.filter(U=>(U.categoria||"Generic").toLowerCase()===V.toLowerCase()||U.tipoEspecial&&U.tipoEspecial.toLowerCase()===V.toLowerCase());h(D||[])}catch(q){console.error("Failed to fetch targets",q),h([])}finally{R(!1)}},O=async()=>{if(!(!y||!w))try{const V={nodoOrigenId:parseInt(t),tipoOrigen:e,nodoDestinoId:parseInt(y),tipoDestino:"GenericEntity",tipoRelacion:w,descripcion:_,metadata:JSON.stringify({originalCategory:l}),tipoEntidad:"relacion"};await Ke.put("/bd/insertar",V),o(!1),z(),I(),window.dispatchEvent(new CustomEvent("relationships-update"))}catch(V){console.error("Failed to save relationship",V),alert("Error saving relationship")}},F=async V=>{if(confirm("Are you sure?"))try{await Ke.delete(`/bd/relacion/${V}`),I(),window.dispatchEvent(new CustomEvent("relationships-update"))}catch(q){console.error("Failed to delete",q)}},z=()=>{u("All"),g(""),S(""),C(""),T("")};return m.jsxs("div",{className:"p-6 space-y-6",children:[m.jsxs("header",{className:"flex justify-between items-center",children:[m.jsx("h3",{className:"text-lg font-bold text-white uppercase tracking-widest",children:"Relationships"}),m.jsx(Dn,{variant:"secondary",icon:"add_link",onClick:()=>o(!s),children:s?"Cancel":"Connect"})]}),s&&m.jsxs("div",{className:"p-4 rounded-2xl bg-white/5 border border-white/10 space-y-4 animate-in fade-in slide-in-from-top-4",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Target Type"}),m.jsx("select",{className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary",value:l,onChange:V=>{u(V.target.value),g(""),S("")},children:Aie.map(V=>m.jsx("option",{value:V.value,className:"bg-[#1a1a20] text-white",children:V.label},V.value))})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Search & Select Target"}),m.jsxs("div",{className:"relative",children:[m.jsx("input",{type:"text",className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 pl-8 text-sm text-white outline-none focus:border-primary",placeholder:"Type to search...",value:p,onChange:V=>g(V.target.value)}),m.jsx("span",{className:"material-symbols-outlined absolute left-2 top-2 text-slate-500 text-sm",children:"search"}),p&&!y&&m.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-surface-dark border border-white/10 rounded-xl shadow-2xl z-50 max-h-40 overflow-y-auto custom-scrollbar",children:c.filter(V=>V.nombre.toLowerCase().includes(p.toLowerCase())).length===0?m.jsx("div",{className:"p-3 text-[10px] text-slate-500 text-center italic",children:"No results found"}):c.filter(V=>V.nombre.toLowerCase().includes(p.toLowerCase())).map(V=>m.jsx("div",{onClick:()=>{S(V.id),g(V.nombre)},className:"p-2 hover:bg-primary/20 cursor-pointer text-xs text-slate-200 border-b border-white/5 last:border-0",children:V.nombre},V.id))}),y&&m.jsx("button",{onClick:()=>{S(""),g("")},className:"absolute right-2 top-2 text-slate-500 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]})]})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Relationship Type"}),m.jsx("input",{type:"text",placeholder:"e.g. Father of, Located in, Enemy of...",className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary",value:w,onChange:V=>C(V.target.value)})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Description (The Why)"}),m.jsx("textarea",{placeholder:"Explain the nature of this connection...",className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary h-20 resize-none",value:_,onChange:V=>T(V.target.value)})]}),m.jsx("div",{className:"flex justify-end pt-2",children:m.jsx(Dn,{variant:"primary",icon:"save",onClick:O,disabled:!y||!w,children:"Save Connection"})})]}),m.jsx("div",{className:"space-y-3",children:i?m.jsx("div",{className:"text-center text-slate-500 py-8",children:"Scanning connections..."}):r.length===0?m.jsx("div",{className:"text-center text-slate-500 py-8 italic border border-dashed border-white/10 rounded-2xl",children:"No connections established"}):r.map((V,q)=>m.jsxs("div",{className:"group relative p-4 rounded-2xl bg-surface-dark border border-white/5 hover:border-primary/50 transition-all flex items-start gap-4",children:[m.jsx("div",{className:"mt-1",children:m.jsx("span",{className:"material-symbols-outlined text-slate-500",children:V.isOutgoing?"arrow_outward":"arrow_inward"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:V.isOutgoing?"To:":"From:"}),m.jsx("span",{className:"text-sm font-bold text-white",children:V.otherName}),m.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-white/10 text-slate-400 font-bold uppercase tracking-wider",children:V.otherType})]}),m.jsx("div",{className:"text-primary text-xs font-black uppercase tracking-widest mb-2",children:V.tipoRelacion}),V.descripcion&&m.jsxs("p",{className:"text-xs text-slate-400 leading-relaxed bg-black/20 p-2 rounded-lg border border-white/5",children:['"',V.descripcion,'"']})]}),m.jsx("button",{onClick:()=>F(V.id),className:"opacity-0 group-hover:opacity-100 p-2 text-slate-600 hover:text-red-400 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},V.id||q))})]})},Rie=({templates:t,onAddTemplate:e,currentFields:r=[]})=>{const{t:n}=Ps(),[i,a]=ie.useState(""),[s,o]=ie.useState(!1),[l,u]=ie.useState({label:"",tipo:"text"}),c=(t||[]).filter(g=>g.label?.toLowerCase().includes(i.toLowerCase())||g.code?.toLowerCase().includes(i.toLowerCase())),h=(g,y)=>{g.dataTransfer.setData("application/reactflow/type","attribute"),g.dataTransfer.setData("templateId",y.id.toString()),g.dataTransfer.setData("templateData",JSON.stringify(y)),g.dataTransfer.effectAllowed="copy"},p=()=>{l.label.trim()&&(e({...l,id:Date.now(),code:l.label.toLowerCase().replace(/\s+/g,"_")}),u({label:"",tipo:"text"}),o(!1))};return m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark border-l border-glass-border w-full animate-in slide-in-from-right duration-500",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 bg-gradient-to-br from-primary/10 to-transparent",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"schema"})," ",n("builder.templates")||"Templates"]}),m.jsx("button",{onClick:()=>o(!s),className:`size-8 rounded-full flex items-center justify-center transition-all ${s?"bg-red-500 text-white rotate-45":"bg-white/5 text-primary hover:bg-primary hover:text-white"}`,children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})]}),s?m.jsxs("div",{className:"space-y-3 p-4 rounded-2xl bg-black/40 border border-primary/20 animate-in fade-in zoom-in-95",children:[m.jsx("input",{autoFocus:!0,placeholder:"Nombre del atributo...",className:"w-full bg-transparent border-b border-white/10 py-1 text-xs text-white outline-none focus:border-primary",value:l.label,onChange:g=>u({...l,label:g.target.value})}),m.jsxs("select",{className:"w-full bg-black/50 border border-white/10 rounded-lg px-2 py-1.5 text-[10px] text-white/70 outline-none",value:l.tipo,onChange:g=>u({...l,tipo:g.target.value}),children:[m.jsx("option",{value:"text",children:"Texto Largo"}),m.jsx("option",{value:"short_text",children:"Texto Corto"}),m.jsx("option",{value:"number",children:"Nmero"}),m.jsx("option",{value:"boolean",children:"Booleano"}),m.jsx("option",{value:"date",children:"Fecha"}),m.jsx("option",{value:"select",children:"Seleccin nica"})]}),m.jsx("button",{onClick:p,className:"w-full py-2 bg-primary text-white rounded-lg text-[10px] font-black uppercase tracking-widest shadow-lg shadow-primary/20",children:"Crear Plantilla"})]}):m.jsxs("div",{className:"relative",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-xs text-text-muted",children:"search"}),m.jsx("input",{type:"text",placeholder:n("common.search"),className:"w-full bg-black/20 border border-white/5 rounded-xl pl-9 pr-4 py-2 text-xs text-white focus:border-primary/50 outline-none transition-all placeholder:text-white/10",value:i,onChange:g=>a(g.target.value)})]})]}),r.length>0&&m.jsxs("div",{className:"space-y-2 p-6 pt-0",children:[m.jsxs("div",{className:"flex items-center gap-2 text-slate-500 px-1",children:[m.jsx("span",{className:"material-symbols-outlined text-xs",children:"summary"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Active Attributes"})]}),m.jsx("div",{className:"max-h-48 overflow-y-auto custom-scrollbar space-y-1 bg-white/[0.02] rounded-xl p-2 border border-white/5",children:r.map(g=>m.jsxs("div",{className:"flex flex-col p-1.5 rounded bg-white/5 border border-white/5",children:[m.jsx("span",{className:"text-[9px] font-bold text-primary uppercase tracking-tighter truncate",children:g.attribute?.nombre||"Unnamed"}),m.jsx("span",{className:"text-[10px] text-slate-300 truncate",children:typeof g.value=="string"&&g.value.startsWith("[")?"Multiple Values":g.value||"---"})]},g.id))})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-1",children:c.length===0?m.jsx("div",{className:"text-center py-8 text-slate-600 text-xs italic",children:"No templates found."}):c.map(g=>m.jsxs("div",{draggable:!0,onDragStart:y=>h(y,g),className:"bg-[#1a1a20] hover:bg-white/5 border border-white/5 hover:border-white/20 rounded-lg p-3 cursor-grab active:cursor-grabbing transition-all group",children:[m.jsxs("div",{className:"flex items-center justify-between mb-1",children:[m.jsx("span",{className:"text-xs font-bold text-slate-200 group-hover:text-white",children:g.label}),m.jsx("span",{className:"material-symbols-outlined text-slate-600 text-xs",children:"drag_pan"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:`text-[8px] font-black px-1.5 py-0.5 rounded uppercase tracking-wider ${g.tipoDato==="text"?"bg-blue-500/20 text-blue-300":g.tipoDato==="number"?"bg-emerald-500/20 text-emerald-300":g.tipoDato==="boolean"?"bg-purple-500/20 text-purple-300":"bg-slate-500/20 text-slate-300"}`,children:g.tipoDato}),g.esObligatorio&&m.jsx("span",{className:"text-[8px] font-black text-rose-400 uppercase",children:"*Req"})]})]},g.id))}),m.jsx("div",{className:"pt-2 border-t border-white/5 text-center",children:m.jsx("p",{className:"text-[10px] text-slate-600",children:"Manage templates in Bible Settings"})})]})},Vg=({mode:t})=>{const{username:e,projectName:r,entitySlug:n,folderSlug:i,type:a}=Va(),s=Ga(),o=t==="creation",{setRightOpen:l,setRightPanelTab:u,setAvailableTemplates:c,setAddAttributeHandler:h}=bo(),[p,g]=ie.useState({nombre:"",tipo:"entidadindividual",descripcion:"",color:"#6366f1",apariencia:"",notas:"",iconUrl:null,tipoEspecial:a||null,carpeta:null,categoria:"Individual"}),[y,S]=ie.useState([]),[w,C]=ie.useState(!0),[_,T]=ie.useState(!1),[N,R]=ie.useState([]),[I,j]=ie.useState([]),[O,F]=ie.useState("identity"),[z,V]=ie.useState(!1),[q,D]=ie.useState(null),[U,G]=ie.useState(null);ie.useEffect(()=>{l(!0),u&&u("CONTEXT");const se=setInterval(()=>{const fe=document.getElementById("global-right-panel-portal");fe&&(G(fe),clearInterval(se))},100);return()=>{clearInterval(se),u&&u("NOTEBOOKS")}},[]),ie.useEffect(()=>{o?K():Q()},[n,i,o]);const Z=se=>{c(se),j(se),h(fe=>{const ae=se.find(pe=>pe.id===fe);ae&&S(pe=>[...pe,{id:`temp-${ae.id}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,attribute:ae,value:ae.valorDefecto||"",isTemp:!0}])})},K=async()=>{C(!0);try{const se=await Ke.get(`/world-bible/folders/${i}`),fe=await Ke.get(`/world-bible/folders/${i}/templates`);Z(fe),g(pe=>({...pe,nombre:`Nuevo ${a==="map"?"Mapa":a==="timeline"?"Cronograma":"Ente"}`,carpeta:se,tipoEspecial:a||"entidadindividual",tipo:a||"entidadindividual"}));const ae=fe.filter(pe=>pe.esObligatorio).map(pe=>({id:`temp-${pe.id}-${Math.random().toString(36).substr(2,9)}`,attribute:pe,value:pe.valorDefecto||"",isTemp:!0}));S(ae)}catch(se){console.error("Error creating draft:",se)}finally{C(!1)}},Q=async()=>{C(!0);try{const se=await Ke.get(`/world-bible/entities/${n}`);if(g({...se,apariencia:se.apariencia||"",notas:se.notas||"",iconUrl:se.iconUrl||null,tags:se.tags||"",tipo:se.tipoEspecial||Oie(se.tipo).id,color:se.color||"#6366f1",categoria:se.categoria||"Individual",attributes:se.attributes||{}}),se.carpeta?.id){const ae=await Ke.get(`/world-bible/folders/${se.carpeta.id}/templates`);Z(ae)}const fe=(se.valores||[]).filter(ae=>ae.plantilla).map(ae=>({id:ae.id.toString(),attribute:ae.plantilla,value:ae.valor,isTemp:!1}));S(fe)}catch(se){console.error("Error loading entity:",se)}finally{C(!1)}},ne=se=>{const fe=Array.from(se.target.files);fe.length!==0&&(fe.forEach(ae=>{const pe=new FileReader;pe.onload=ye=>{const ve=ye.target.result,ue=p.attributes?.images||[];g(xe=>({...xe,attributes:{...xe.attributes,images:[...ue,ve]}}))},pe.readAsDataURL(ae)}),se.target.value=null)},te=se=>{const fe=[...p.attributes?.images||[]];fe.splice(se,1),g(ae=>({...ae,attributes:{...ae.attributes,images:fe}}))},X=(se,fe)=>{g(ae=>({...ae,[se]:fe}))},re=(se,fe)=>{S(ae=>ae.map(pe=>pe.id===se?{...pe,value:fe}:pe))},he=se=>{se.toString().startsWith("temp-")||R(fe=>[...fe,se]),S(fe=>fe.filter(ae=>ae.id!==se))},oe=async(se=!0)=>{T(!0);try{const fe={nombre:p.nombre,descripcion:p.descripcion,tags:p.tags,apariencia:p.apariencia,notas:p.notas,iconUrl:p.iconUrl,tipoEspecial:p.tipoEspecial||"entidadindividual",color:p.color,categoria:p.categoria,attributes:p.attributes};let ae=p.id;if(o){if(!p.carpeta&&!i){alert("Error: Missing context (no folder). Redirecting."),s(`/${e}/${r}/bible`);return}if(fe.carpetaId=p.carpeta?.id,!fe.carpetaId&&i)try{const Se=await Ke.get(`/world-bible/folders/${i}`);fe.carpetaId=Se.id}catch(Se){console.error("Could not resolve folder",Se)}const ue=await Ke.post("/world-bible/entities",fe);ae=ue.id;const xe=[...y];for(let Se=0;Se<xe.length;Se++){const Oe=xe[Se];if(Oe.isTemp)try{const Ae=await Ke.post(`/world-bible/entities/${ue.id}/attributes`,{plantillaId:Oe.attribute.id});await Ke.patch(`/world-bible/entities/${ue.id}/values`,[{valorId:Ae.id,nuevoValor:Oe.value}]),xe[Se]={...Oe,id:Ae.id.toString(),isTemp:!1}}catch(Ae){console.error("Attr save failed",Ae)}}if(S(xe),T(!1),se){const Se=ue.carpeta?ue.carpeta.slug||ue.carpeta.id:i;s(`/${e}/${r}/bible/folder/${Se}`)}else{const Se=ue.carpeta?ue.carpeta.slug||ue.carpeta.id:i;s(`/${e}/${r}/bible/folder/${Se}/entity/${ue.slug||ue.id}`,{replace:!0})}return}await Ke.put(`/world-bible/entities/${ae}`,{nombre:fe.nombre,color:fe.color,iconUrl:fe.iconUrl}),await Ke.patch(`/world-bible/entities/${ae}/details`,{descripcion:fe.descripcion,tags:fe.tags,apariencia:fe.apariencia,notas:fe.notas,iconUrl:fe.iconUrl,attributes:fe.attributes}),N.length>0&&(await Promise.all(N.map(ue=>Ke.delete(`/world-bible/values/${ue}`))),R([]));const pe=y.filter(ue=>!ue.isTemp).map(ue=>({valorId:parseInt(ue.id),nuevoValor:ue.value}));pe.length>0&&await Ke.patch(`/world-bible/entities/${ae}/values`,pe);let ye=!1;const ve=[...y];for(let ue=0;ue<ve.length;ue++){const xe=ve[ue];if(xe.isTemp)try{const Se=await Ke.post(`/world-bible/entities/${ae}/attributes`,{plantillaId:xe.attribute.id});await Ke.patch(`/world-bible/entities/${ae}/values`,[{valorId:Se.id,nuevoValor:xe.value}]),ve[ue]={...xe,id:Se.id.toString(),isTemp:!1},ye=!0}catch(Se){console.error("Error saving field:",xe,Se)}}if(ye&&S(ve),T(!1),se){const xe=i||(p.carpeta?p.carpeta.slug||p.carpeta.id:"root")||"root";s(`/${e}/${r}/bible/folder/${xe}`)}}catch(fe){console.error("Save error",fe),T(!1)}};return w?m.jsx("div",{className:"p-20 text-center animate-pulse",children:"Loading Builder..."}):m.jsx("div",{className:"flex h-full w-full bg-background-dark overflow-hidden",children:m.jsxs("div",{className:"flex-1 flex flex-col min-w-0 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("div",{className:"border-b border-white/5 p-4 flex justify-between items-center bg-background-dark/80 backdrop-blur sticky top-0 z-30",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(Kk,{url:p.iconUrl,name:p.nombre,className:"size-10 rounded-lg border border-white/10"}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-lg font-bold text-white leading-tight",children:p.nombre||"Sin Nombre"}),m.jsx("span",{className:"text-[10px] uppercase font-black tracking-widest text-slate-500",children:o?"Creando Nueva Entidad":"Editando Entidad"})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("button",{onClick:()=>s(`/${e}/${r}/bible/folder/${i}`),className:"px-4 py-2 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 text-xs font-bold uppercase tracking-widest transition-all",children:"Cancelar"}),m.jsxs("div",{className:"flex bg-white/5 rounded-xl p-1 gap-1 border border-white/10",children:[m.jsxs("button",{onClick:()=>oe(!0),disabled:_,className:"h-9 px-4 rounded-lg bg-primary hover:bg-primary-light text-white text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 disabled:opacity-50",children:[_?m.jsx("span",{className:"material-symbols-outlined animate-spin text-sm",children:"refresh"}):m.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Guardar"]}),m.jsx("div",{className:"w-px bg-white/10 my-1"}),m.jsx("button",{onClick:()=>oe(!1),disabled:_,className:"h-9 px-3 rounded-lg bg-transparent hover:bg-white/10 text-white transition-all flex items-center justify-center disabled:opacity-50",title:"Guardar y Seguir Editando",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit_document"})})]})]})]}),U&&eo.createPortal(m.jsx(Rie,{templates:I,currentFields:y,onAddTemplate:se=>{S(fe=>[...fe,{id:`temp-${se.id}-${Date.now()}`,attribute:se,value:se.valorDefecto||"",isTemp:!0}])}}),U),m.jsx("div",{className:"flex border-b border-white/5 px-8 gap-6 bg-background-dark/80 backdrop-blur sticky top-[73px] z-20",children:["identity","narrative","attributes"].map(se=>m.jsx("button",{onClick:()=>F(se),className:`py-4 text-[10px] font-black uppercase tracking-widest border-b-2 transition-colors ${O===se?"border-primary text-primary":"border-transparent text-slate-500 hover:text-white"}`,children:se},se))}),m.jsxs("div",{className:"p-8 pb-32 max-w-5xl mx-auto w-full",children:[O==="identity"&&m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 items-start",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx(ti,{title:"IDENTITY",icon:"fingerprint",children:m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsxs("label",{className:"text-xs font-black uppercase text-primary mb-3 block tracking-wider flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-base",children:"badge"}),"Nombre Principal"]}),m.jsx("input",{type:"text",className:"w-full bg-gradient-to-br from-indigo-950/90 to-purple-950/90 border-2 border-indigo-500/50 rounded-2xl p-5 text-2xl font-black text-white focus:border-indigo-400 focus:from-indigo-950 focus:to-purple-950 outline-none transition-all placeholder:text-slate-500 shadow-lg shadow-indigo-900/20",placeholder:"Entiende el nombre...",value:p.nombre,onChange:se=>g({...p,nombre:se.target.value})})]}),m.jsxs("div",{children:[m.jsxs("label",{className:"text-xs font-black uppercase text-purple-400 mb-3 block tracking-wider flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-base",children:"category"}),"Categora / Tags"]}),m.jsxs("select",{className:"w-full bg-gradient-to-r from-purple-950/90 to-indigo-950/90 border-2 border-purple-500/50 rounded-xl px-4 py-3 text-sm text-white font-bold focus:border-purple-400 focus:from-purple-950 focus:to-indigo-950 outline-none transition-all cursor-pointer shadow-md",value:p.categoria,onChange:se=>g({...p,categoria:se.target.value}),children:[m.jsx("option",{value:"Individual",className:"bg-slate-900",children:" Individual"}),m.jsx("option",{value:"Lugar",className:"bg-slate-900",children:" Lugar"}),m.jsx("option",{value:"Organizacin",className:"bg-slate-900",children:" Organizacin"}),m.jsx("option",{value:"Objeto",className:"bg-slate-900",children:" Objeto"}),m.jsx("option",{value:"Concepto",className:"bg-slate-900",children:" Concepto"}),m.jsx("option",{value:"Evento",className:"bg-slate-900",children:" Evento"}),m.jsx("option",{value:"Criatura",className:"bg-slate-900",children:" Criatura"}),m.jsx("option",{value:"Faccin",className:"bg-slate-900",children:" Faccin"})]})]}),m.jsxs("div",{children:[m.jsxs("label",{className:"text-xs font-black uppercase text-slate-400 mb-3 block tracking-wider flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-base",children:"description"}),"Resumen Breve"]}),m.jsx("textarea",{className:"w-full bg-slate-950/90 border-2 border-slate-600/60 rounded-xl p-5 text-sm text-slate-100 leading-relaxed min-h-[120px] outline-none focus:border-slate-500 focus:bg-slate-950 transition-all resize-none custom-scrollbar shadow-inner",placeholder:"Describe brevemente quin o qu es...",value:p.descripcion,onChange:se=>g({...p,descripcion:se.target.value})})]})]})}),m.jsx(ti,{title:"APARIENCIA FSICA",icon:"accessibility_new",children:m.jsx("textarea",{className:"w-full bg-slate-950/90 border-2 border-slate-600/60 rounded-xl p-6 text-sm text-slate-100 leading-relaxed min-h-[280px] outline-none focus:border-slate-500 focus:bg-slate-950 transition-all resize-none custom-scrollbar shadow-inner",placeholder:"Detalles de su aspecto fsico, vestimenta, rasgos distintivos...",value:p.attributes?.appearance||"",onChange:se=>g({...p,attributes:{...p.attributes,appearance:se.target.value}})})})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx(ti,{title:"GALLERY",icon:"photo_library",children:m.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[p.attributes?.images?.map((se,fe)=>m.jsxs("div",{className:"aspect-square rounded-xl bg-black/40 border border-white/5 overflow-hidden relative group cursor-pointer",onClick:()=>D(se),children:[m.jsx("img",{src:se,className:"w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-110 transition-all duration-500",alt:"Gallery"}),m.jsx("button",{onClick:ae=>{ae.stopPropagation(),te(fe)},className:"absolute top-1 right-1 size-6 bg-red-500 text-white rounded-lg flex items-center justify-center translate-y-[-120%] group-hover:translate-y-0 transition-transform shadow-lg",children:m.jsx("span",{className:"material-symbols-outlined text-xs",children:"close"})})]},fe)),m.jsxs("label",{className:"aspect-square rounded-xl border-2 border-dashed border-white/10 flex flex-col items-center justify-center gap-2 hover:bg-white/5 hover:border-primary/50 transition-all cursor-pointer group",children:[m.jsx("span",{className:"material-symbols-outlined text-text-muted group-hover:text-primary transition-colors",children:"add_photo_alternate"}),m.jsx("span",{className:"text-[8px] font-black uppercase text-text-muted group-hover:text-primary",children:"Upload Photos"}),m.jsx("input",{type:"file",multiple:!0,className:"hidden",onChange:ne,accept:"image/*"})]})]})}),m.jsx(ti,{title:"NOTES",icon:"sticky_note_2",children:m.jsx("textarea",{className:"w-full bg-amber-950/90 border-2 border-amber-700/60 rounded-xl p-5 text-sm text-amber-100 leading-relaxed min-h-[200px] outline-none focus:border-amber-600 focus:bg-amber-950 transition-all resize-none custom-scrollbar shadow-inner",placeholder:"Apuntes rpidos, secretos o ideas sueltas...",value:p.attributes?.notes||"",onChange:se=>g({...p,attributes:{...p.attributes,notes:se.target.value}})})})]})]}),O==="narrative"&&m.jsxs("div",{className:"animate-in fade-in duration-500 space-y-8",children:[m.jsxs(ti,{className:"min-h-[40vh] flex flex-col p-8",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"history_edu"})," Biography"]}),m.jsx("span",{className:"text-[10px] text-slate-500 bg-white/5 px-2 py-1 rounded",children:"Markdown Supported"})]}),m.jsx("textarea",{className:"flex-1 w-full bg-slate-950/90 border-2 border-slate-600/60 rounded-xl p-6 text-slate-100 leading-relaxed resize-none focus:border-slate-500 focus:bg-slate-950 outline-none placeholder:text-slate-600 custom-scrollbar text-base min-h-[320px] shadow-inner",placeholder:"Write the origin story...",value:p.descripcion||"",onChange:se=>X("descripcion",se.target.value)})]}),m.jsxs(ti,{className:"min-h-[40vh]",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary p-6 pb-0 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"hub"})," Relationships"]}),o?m.jsxs("div",{className:"p-12 text-center text-slate-500",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-4",children:"save_as"}),m.jsx("p",{className:"text-sm font-bold",children:"Please save the entity first to manage relationships."})]}):m.jsx(Lie,{entityId:p.id,entityType:p.tipo||"entidadindividual"})]})]}),O==="attributes"&&m.jsxs("div",{className:`animate-in fade-in duration-500 space-y-6 min-h-[50vh] transition-colors rounded-2xl p-4 ${window.isDraggingOver?"bg-primary/10 border-2 border-dashed border-primary":""}`,onDragOver:se=>{se.preventDefault(),se.dataTransfer.dropEffect="copy",se.currentTarget.classList.add("bg-primary/10","border-primary","border-dashed","border-2")},onDragLeave:se=>{se.preventDefault(),se.currentTarget.classList.remove("bg-primary/10","border-primary","border-dashed","border-2")},onDrop:se=>{if(se.preventDefault(),se.currentTarget.classList.remove("bg-primary/10","border-primary","border-dashed","border-2"),se.dataTransfer.getData("application/reactflow/type")!=="attribute")return;let ae=null;try{const pe=se.dataTransfer.getData("templateData");if(pe)ae=JSON.parse(pe);else{const ye=parseInt(se.dataTransfer.getData("templateId"));ae=I.find(ve=>ve.id===ye)}}catch(pe){console.error("Drop error",pe)}ae&&S(pe=>[...pe,{id:`temp-${ae.id}-${Date.now()}`,attribute:ae,value:ae.valorDefecto||"",isTemp:!0}])},children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary border-b border-white/5 pb-4 flex items-center justify-between",children:[m.jsx("span",{children:"Atributos especiales"}),m.jsx("span",{className:"text-[10px] text-slate-500 font-normal normal-case opacity-50 hidden md:block",children:"Arraste atributos desde el panel derecho"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4 border-2 border-dashed border-white/5 rounded-2xl hover:border-primary/20 transition-colors bg-white/[0.01]",children:[y.length===0&&m.jsxs("div",{className:"col-span-full py-12 text-center text-slate-500 text-sm pointer-events-none",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 opacity-50",children:"drag_indicator"}),m.jsx("p",{children:"Arrastra plantillas aqu para aadir atributos"})]}),y.filter(se=>se.attribute).map(se=>m.jsx(Mie,{attribute:se.attribute,value:se.value,onChange:fe=>re(se.id,fe),onRemove:()=>he(se.id)},se.id))]})]})]}),z&&p.iconUrl&&m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm animate-in fade-in duration-300",onClick:()=>V(!1),children:m.jsxs("div",{className:"relative max-w-[90vw] max-h-[90vh] p-2",children:[m.jsx("button",{onClick:()=>V(!1),className:"absolute -top-12 right-0 p-2 text-white hover:text-primary transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:"close"})}),m.jsx("img",{src:p.iconUrl,alt:p.nombre,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl border border-white/10",onClick:se=>se.stopPropagation()})]})}),q&&m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-md animate-in fade-in duration-300",onClick:()=>D(null),children:m.jsxs("div",{className:"relative max-w-[95vw] max-h-[95vh] p-4",children:[m.jsx("button",{onClick:()=>D(null),className:"absolute -top-14 right-0 p-3 text-white/80 hover:text-white hover:bg-white/10 rounded-xl transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:"close"})}),m.jsx("img",{src:q,alt:"Gallery Preview",className:"max-w-full max-h-[90vh] object-contain rounded-2xl shadow-2xl border-2 border-white/20",onClick:se=>se.stopPropagation()})]})})]})})},Oie=t=>({id:t,label:t}),Die=t=>{switch(t?.toLowerCase()){case"text":return"notes";case"short_text":return"short_text";case"number":return"pin";case"date":return"calendar_today";case"select":return"list";case"boolean":return"check_box";case"map":return"map";case"timeline":return"timeline";case"character":case"entidadindividual":return"person";case"location":case"zona":case"construccion":return"location_on";case"culture":case"entidadcolectiva":return"groups";case"universe":case"galaxy":case"system":case"planet":return"public";case"entity_link":return"link";default:return"description"}},ex=({item:t,type:e,linkTo:r,onContextMenu:n,onDelete:i})=>{const a=e==="folder";return m.jsxs(ff,{to:r,onContextMenu:n,className:"group relative flex flex-col p-4 rounded-3xl bg-surface-dark border border-glass-border hover:border-primary/50 hover:bg-white/5 transition-all duration-300 backdrop-blur-sm overflow-hidden",children:[t.iconUrl&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"absolute inset-0 z-0",children:m.jsx("img",{src:t.iconUrl,alt:"",className:"w-full h-full object-cover opacity-60 group-hover:scale-105 transition-transform duration-700"})}),m.jsx("div",{className:"absolute inset-0 z-0 bg-gradient-to-t from-[#0a0a0c] via-[#0a0a0c]/80 to-transparent"})]}),m.jsxs("div",{className:"relative z-10 flex items-start justify-between mb-4",children:[m.jsx("div",{className:`
                    size-12 rounded-2xl flex items-center justify-center text-xl transition-transform group-hover:scale-110 
                    ${a?"bg-primary/20 text-primary":"bg-white/5 text-text-muted group-hover:text-white backdrop-blur-md border border-white/5"}
                `,children:m.jsx("span",{className:"material-symbols-outlined",children:a?"folder":Die(t.tipoEspecial)})}),a&&m.jsx("div",{className:"px-2 py-1 rounded-lg bg-surface-light/50 border border-glass-border text-[10px] font-black text-white shadow-sm backdrop-blur-md",children:t.itemCount||0})]}),m.jsxs("div",{className:"relative z-10 mt-auto",children:[m.jsx("h3",{className:"text-sm font-bold text-white truncate group-hover:text-primary transition-colors drop-shadow-md",children:t.nombre}),m.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted mt-1 opacity-70 group-hover:opacity-100 transition-opacity",children:a?"Folder":t.tipoEspecial||"Entity"})]}),m.jsxs("div",{className:"absolute top-4 right-4 z-20 flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[i&&m.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),i(t)},className:"p-1.5 rounded-lg bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white transition-all border border-red-500/20 shadow-lg shadow-red-500/5 group/del backdrop-blur-md",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})}),m.jsx("span",{className:"material-symbols-outlined text-primary text-sm transform group-hover:translate-x-1 transition-transform drop-shadow-md",children:"arrow_forward"})]})]})},Iie=({path:t,currentFolder:e})=>{const{username:r,projectName:n}=Va(),i=`/${r}/${n}/bible`;return!t&&!e?null:m.jsxs("nav",{className:"flex items-center gap-2 text-[10px] uppercase font-bold tracking-wider text-slate-500 mb-4 overflow-x-auto no-scrollbar whitespace-nowrap",children:[m.jsxs(ff,{to:i,className:"hover:text-primary transition-colors flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"home"}),"Bible"]}),t&&t.map((a,s)=>m.jsxs(ir.Fragment,{children:[m.jsx("span",{className:"text-slate-700",children:"/"}),m.jsx(ff,{to:`${i}/folder/${a.slug||a.id}`,className:"hover:text-primary transition-colors",children:a.nombre})]},a.id)),e&&m.jsxs(m.Fragment,{children:[m.jsx("span",{className:"text-slate-700",children:"/"}),m.jsx("span",{className:"text-white bg-white/5 px-2 py-0.5 rounded",children:e.nombre})]})]})},jie=({entities:t=[],onAddEvent:e})=>{const r=[...t].sort((n,i)=>n.id-i.id);return m.jsx("div",{className:"w-full max-w-3xl mx-auto p-4 animate-slide-up",children:m.jsxs("div",{className:"relative border-l-2 border-white/10 ml-6 space-y-12 py-8",children:[r.length===0&&m.jsx("div",{className:"pl-12 opacity-50",children:m.jsx("p",{className:"text-white text-sm",children:"No events recorded in this timeline yet."})}),r.map((n,i)=>m.jsxs("div",{className:"relative pl-12 group",children:[m.jsx("div",{className:"absolute left-[-9px] top-0 size-4 rounded-full bg-background-dark border-2 border-primary group-hover:scale-125 group-hover:bg-primary transition-all shadow-[0_0_10px_rgba(99,102,241,0.3)]"}),m.jsxs(ti,{className:"p-6 border-white/5 hover:border-primary/30 transition-all hover:-translate-y-1 cursor-pointer",children:[m.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:n.nombre}),m.jsx("p",{className:"text-sm text-text-muted leading-relaxed line-clamp-3",children:n.descripcion||"No description provided."})]})]},n.id)),m.jsxs("div",{onClick:e,className:"relative pl-12 group cursor-pointer opacity-50 hover:opacity-100 transition-opacity",children:[m.jsx("div",{className:"absolute left-[-9px] top-2 size-4 rounded-full bg-background-dark border-2 border-dashed border-white/30"}),m.jsxs("div",{className:"p-4 border-2 border-dashed border-white/10 rounded-2xl flex items-center justify-center text-text-muted hover:border-primary/50 hover:text-white transition-all",children:[m.jsx("span",{className:"material-symbols-outlined mr-2",children:"add_circle"}),m.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Add Historical Event"})]})]})]})})},Fie=()=>{const{username:t,projectName:e,folderSlug:r}=Va(),n=Ga(),{handleCreateEntity:i,handleDeleteEntity:a,handleDeleteFolder:s,handleCreateSimpleFolder:o,folderSearchTerm:l,folderFilterType:u}=bo(),[c,h]=ie.useState([]),[p,g]=ie.useState(null),[y,S]=ie.useState([]),[w,C]=ie.useState(!0),[_,T]=ie.useState(!1),N={folders:(p?.subfolders||[]).filter(O=>{const F=O.nombre.toLowerCase().includes((l||"").toLowerCase()),z=u==="ALL"||u==="MAP"&&O.tipoEspecial==="map"||u==="TIMELINE"&&O.tipoEspecial==="timeline";return F&&z}),entities:c.filter(O=>{const F=O.nombre.toLowerCase().includes((l||"").toLowerCase()),z=u==="ALL"||u==="ENTITY"&&(!O.tipoEspecial||O.tipoEspecial==="entidadindividual")||u==="individual"&&O.tipoEspecial==="individual"||O.tipoEspecial==="entidadindividual"||u==="location"&&O.tipoEspecial==="location"||O.tipoEspecial==="zona"||u==="culture"&&O.tipoEspecial==="culture"||O.tipoEspecial==="entidadcolectiva"||u==="MAP"&&O.tipoEspecial==="map"||u==="TIMELINE"&&O.tipoEspecial==="timeline";return F&&z})};ie.useEffect(()=>{const O=F=>{const{folderId:z,removeId:V,type:q,item:D}=F.detail||{};z===(p?.id||r)&&(V?q==="entity"&&h(U=>U.filter(G=>G.id!==V)):D&&D.slug&&D.slug!==r?n(`/${t}/${e}/bible/folder/${D.slug}`,{replace:!0}):R())};return window.addEventListener("folder-update",O),()=>window.removeEventListener("folder-update",O)},[r,p?.id]),ie.useEffect(()=>{R()},[r]);const R=async()=>{C(!0);try{const[O,F]=await Promise.all([Ke.get(`/world-bible/folders/${r}/entities`),Ke.get(`/world-bible/folders/${r}`)]);h(O||[]),F.folder?(g({...F.folder,subfolders:F.subfolders||[]}),S(F.path||[])):(g({...F||{nombre:"Folder"},subfolders:F.subfolders||[]}),S([]))}catch(O){console.error("Error loading folder content:",O),g(null),S([])}finally{C(!1)}};if(w)return m.jsx("div",{className:"p-20 text-center animate-pulse text-text-muted",children:"Loading sector..."});if(!p)return m.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-20 text-text-muted",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 opacity-20",children:"folder_off"}),m.jsx("h2",{className:"text-xl font-bold opacity-50",children:"Folder Not Found"}),m.jsx("p",{className:"text-sm opacity-30 mt-2",children:"The sector you are looking for does not exist or has been moved."}),m.jsx(ff,{to:`/${t}/${e}/bible`,className:"mt-6 px-6 py-2 bg-white/5 hover:bg-white/10 rounded-full text-xs font-bold transition-colors",children:"Return to Root"})]});const I=p&&p.tipo&&(["UNIVERSE","GALAXY","SYSTEM","PLANET"].includes(p.tipo)||p.tipo==="MAGIC"),j=p?LS(p.tipo):ef.FOLDER;return I?m.jsxs("div",{className:"flex-1 overflow-y-auto bg-[#0a0a0c] text-white w-full h-full relative",children:[m.jsxs("div",{className:`w-full min-h-[300px] ${j.bgColor} relative flex items-end p-10 border-b border-white/5`,children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#0a0a0c] to-transparent opacity-80 pointer-events-none"}),m.jsx("div",{className:"absolute top-6 left-10 z-20",children:m.jsx(Iie,{path:y,currentFolder:p})}),m.jsxs("div",{className:"relative z-10 flex gap-8 items-end w-full max-w-7xl mx-auto",children:[m.jsx("div",{className:`w-32 h-32 rounded-3xl ${j.bgColor} border border-white/10 flex items-center justify-center shadow-2xl`,children:m.jsx("span",{className:`material-symbols-outlined text-6xl ${j.color}`,children:j.icon})}),m.jsxs("div",{className:"flex-1 mb-2",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border border-white/10 ${j.bgColor} ${j.color}`,children:j.label}),m.jsxs("span",{className:"text-white/30 text-xs font-mono tracking-widest uppercase",children:["ID: ",p.id]})]}),m.jsx("h1",{className:"text-6xl font-black tracking-tighter text-white mb-2",children:p.nombre}),m.jsx("p",{className:"text-lg text-white/50 max-w-2xl font-light leading-relaxed",children:p.descripcion||"Sin descripcin definida para este sector cosmolgico."})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("button",{onClick:()=>n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadindividual`),className:"px-4 py-2 bg-primary/20 hover:bg-primary/30 text-primary rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"person_add"})," Nueva Entidad"]}),m.jsxs("button",{onClick:()=>n(`/${t}/${e}/map-editor/create/${r}`,{state:{folderId:p?.id}}),className:"px-4 py-2 bg-white/5 hover:bg-white/10 text-white rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-all border border-glass-border",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"map"})," Mapa"]})]})]})]}),m.jsxs("div",{className:"max-w-7xl mx-auto p-10 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"bg-[#13141f] border border-white/5 rounded-2xl p-6",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Estadsticas"}),m.jsx("div",{className:"grid grid-cols-2 gap-4",children:m.jsxs("div",{children:[m.jsx("div",{className:"text-2xl font-black text-white",children:c.length}),m.jsx("div",{className:"text-[10px] text-white/40 uppercase",children:"Elementos"})]})})]}),m.jsxs("div",{className:"bg-[#13141f] border border-white/5 rounded-2xl p-6 h-64 flex flex-col",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Notas Rpidas"}),m.jsx("textarea",{className:"flex-1 bg-transparent resize-none outline-none text-sm text-white/70 placeholder-white/20",placeholder:"Escribir notas de la zona..."})]})]}),m.jsxs("div",{className:"lg:col-span-2",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Contenido Interno"}),c.length===0&&m.jsxs("div",{className:"p-12 border border-dashed border-white/10 rounded-2xl text-center",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl text-white/20 mb-2",children:"folder_open"}),m.jsx("p",{className:"text-white/30 text-sm",children:"Este sector est vaco."})]}),m.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:N.entities.map(O=>m.jsx(ex,{item:O,type:"entity",linkTo:`/${t}/${e}/bible/folder/${p.slug||r}/entity/${O.slug||O.id}`,onDelete:()=>a(O.id,p?.id||r)},O.id))})]})]})]}):m.jsxs("div",{className:"flex-1 p-8 max-w-[1600px] mx-auto w-full h-full overflow-y-auto",children:[m.jsxs("header",{className:"mb-8 flex items-end justify-between",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsxs(ff,{to:`/${t}/${e}/bible`,className:"text-xs font-bold text-text-muted hover:text-primary transition-colors flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})," Root"]}),p&&m.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] bg-white/5 border border-white/10 ${j.color}`,children:j.label})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("span",{className:`material-symbols-outlined text-3xl ${j.color}`,children:j.icon}),m.jsx("h1",{className:"text-4xl font-black text-white tracking-tighter",children:p?.nombre||"Unnamed Folder"})]}),m.jsx("p",{className:"text-white/50 text-sm mt-2 max-w-xl",children:p?.descripcion})]}),m.jsxs("div",{className:"flex items-center gap-3 relative",children:[m.jsxs("button",{onClick:()=>T(!_),className:"h-10 px-6 rounded-xl bg-primary hover:bg-primary-light transition flex items-center gap-2 text-xs font-bold text-white shadow-lg shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"}),m.jsx("span",{children:"Aadir Elemento"})]}),_&&m.jsxs("div",{className:"absolute top-full right-0 mt-2 w-56 bg-surface-dark border border-glass-border rounded-2xl shadow-2xl py-2 z-50 animate-in fade-in slide-in-from-top-2",children:[m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadindividual`),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"person"})," Personaje"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadcolectiva`),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-blue-400",children:"groups"})," Cultura / Grupo"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/zona`),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-green-400",children:"location_on"})," Lugar / Geografa"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/interaccion`),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-amber-400",children:"history_edu"})," Lore / Interaccin"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/efectos`),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-purple-400",children:"magic_button"})," Objeto / Efecto"]}),m.jsx("div",{className:"h-px bg-white/5 my-1"}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/map-editor/create/${r}`,{state:{folderId:p?.id}}),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-red-400",children:"map"})," Nuevo Mapa"]}),m.jsxs("button",{onClick:()=>{o(p,"TIMELINE"),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-cyan-400",children:"timeline"})," Timeline"]})]})]})]}),p?.tipo==="TIMELINE"?m.jsx(jie,{entities:N.entities,folderId:r,onAddEvent:()=>n(`/${t}/${e}/bible/folder/${r}/entity/new/evento`)}):m.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:[N.folders.map(O=>m.jsx(ex,{item:O,type:"folder",linkTo:`/${t}/${e}/bible/folder/${O.slug||O.id}`,onDelete:()=>s(O.id,p?.id||r)},O.id)),N.entities.map(O=>{const F=O.tipoEspecial==="map"||O.tipoEspecial==="timeline"?O.tipoEspecial:"entity";return m.jsx(ex,{item:O,type:"entity",linkTo:`/${t}/${e}/bible/folder/${p?.slug||r}/${F}/${O.slug||O.id}`,onDelete:()=>a(O.id,p?.id||r)},O.id)})]}),c.length===0&&m.jsx("div",{className:"p-20 text-center border-2 border-dashed border-glass-border rounded-[3rem] opacity-30 mt-8",children:m.jsx("p",{className:"text-text-muted font-bold uppercase tracking-widest",children:"Empty Folder"})})]})},Bie=({isOpen:t,onClose:e,onCreate:r,parentFolder:n})=>{const[i,a]=ie.useState({nombre:"",descripcion:"",tipo:"FOLDER",canvasType:"BLANK"});if(!t)return null;const s=()=>{r(i),e(),a({nombre:"",descripcion:"",tipo:"FOLDER",canvasType:"BLANK"})},o=[ef.UNIVERSE,ef.GALAXY,ef.SYSTEM,ef.PLANET];return m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:m.jsxs("div",{className:"bg-[#1a1b26] w-full max-w-4xl rounded-2xl shadow-2xl border border-white/10 overflow-hidden flex flex-col max-h-[90vh]",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-[#1f202e]",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400",children:m.jsx("span",{className:"material-icons text-sm",children:"add"})}),m.jsx("h2",{className:"text-xl font-semibold text-white",children:n?"Crear Nuevo Espacio":"Crear Nuevo Mapa"})]}),m.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition",children:m.jsx("span",{className:"material-icons",children:"close"})})]}),m.jsx("div",{className:"p-8 overflow-y-auto flex-1",children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-indigo-400",children:"Identidad"}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-2",children:"Nombre del Espacio"}),m.jsx("input",{autoFocus:!0,type:"text",value:i.nombre,onChange:l=>a({...i,nombre:l.target.value}),className:"w-full bg-black/40 border border-white/5 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-indigo-500/50 transition-all shadow-inner",placeholder:"ej. Sistema Solar"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-2",children:"Descripcin"}),m.jsx("textarea",{value:i.descripcion,onChange:l=>a({...i,descripcion:l.target.value}),className:"w-full h-32 bg-black/40 border border-white/5 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-indigo-500/50 resize-none transition-all",placeholder:"Detalles sobre este nivel jerrquico..."})]})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-indigo-400",children:"Configuracin"}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-1",children:"Tipo de Jerarqua"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:o.concat([{id:"FOLDER",label:"Carpeta",icon:"folder",color:"text-white/50"}]).map(l=>m.jsxs("div",{onClick:()=>a({...i,tipo:l.id}),className:`flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${i.tipo===l.id?"bg-indigo-500/10 border-indigo-500/50":"bg-white/5 border-white/5 hover:bg-white/10"}`,children:[m.jsx("span",{className:`material-icons text-lg ${l.color||""}`,children:l.icon}),m.jsx("span",{className:"text-xs font-bold text-white/80",children:l.label})]},l.id||"FOLDER"))})]}),m.jsx("div",{className:"p-4 rounded-2xl bg-indigo-500/5 border border-indigo-500/10",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400",children:m.jsx("span",{className:"material-icons",children:"info"})}),m.jsxs("div",{children:[m.jsx("p",{className:"text-[10px] uppercase font-black text-indigo-300",children:"Ubicacin Actual"}),m.jsx("p",{className:"text-xs text-indigo-100/50",children:n?n.nombre:"Raz del Mundo"})]})]})})]})]})}),m.jsxs("div",{className:"p-6 border-t border-white/5 flex justify-end gap-3 bg-[#1f202e]",children:[m.jsx("button",{onClick:e,className:"px-6 py-3 rounded-xl text-xs font-black uppercase tracking-widest text-text-muted hover:text-white transition",children:"Cancelar"}),m.jsx("button",{onClick:s,disabled:!i.nombre,className:"px-8 py-3 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-black uppercase tracking-widest shadow-lg shadow-indigo-500/20 transition-all disabled:opacity-30 disabled:pointer-events-none",children:"Confirmar y Crear"})]})]})})},zie=()=>{const{username:t,projectName:e}=Va(),r=Ga(),{handleCreateEntity:n,...i}=bo()||{},{t:a}=Ps(),[s,o]=ie.useState([]),[l,u]=ie.useState(!1),[c,h]=ie.useState(null),[p,g]=ie.useState(""),[y,S]=ie.useState("ALL"),[w,C]=ie.useState(!1),[_,T]=ie.useState(null),N=`/${t}/${e}/bible`;ie.useEffect(()=>{R()},[e]),ie.useEffect(()=>{i?.setBibleExplorerState&&i.setBibleExplorerState({folders:s,searchTerm:p,setSearchTerm:g,filterType:y,setFilterType:S,handleCreateSimpleFolder:j,handleRenameFolder:q,handleDeleteFolder:D,handleMoveEntity:F,handleDuplicateEntity:z,handleCreateEntity:V,handleConfirmCreate:Z})},[s,p,y]);const R=async()=>{try{const K=await Ke.get("/world-bible/folders");o(K)}catch(K){console.error("Error loading folders:",K)}},I=(K=null)=>{h(K),u(!0),setCreationMenuOpen(!1)},j=async(K=null,Q="FOLDER")=>{try{const ne=K?typeof K=="object"?K.id:K:null,te=await Ke.post("/world-bible/folders",{nombre:a(Q==="TIMELINE"?"bible.new_timeline":"bible.new_folder"),padreId:ne,tipo:Q});if(ne===null){const X=await Ke.get("/world-bible/folders");o(X),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:null}}))}else window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,optimisticType:"folder",item:te,expand:!0}}))}catch(ne){console.error("Error creating simple folder:",ne)}},O=async K=>{try{const Q=c?c.id:null,ne=await Ke.post("/world-bible/folders",{nombre:K.nombre,descripcion:K.descripcion,padreId:Q,tipo:K.tipo});if(Q===null){const te=await Ke.get("/world-bible/folders");o(te),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:null}}))}else ne.id||console.error("CRITICAL: Created folder has no ID!",ne),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Q,optimisticType:"folder",item:ne,expand:!0}}))}catch(Q){console.error(Q),alert("Error creating folder/zone.")}},F=async(K,Q,ne)=>{try{await Ke.put(`/world-bible/entities/${K}`,{carpetaId:Q}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,removeId:K,type:"entity"}})),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Q,type:"move-in",entityId:K}}))}catch(te){console.error("Move failed:",te)}},z=async(K,Q)=>{try{const ne=await Ke.get(`/world-bible/entities/${K}`),te=await Ke.post("/world-bible/entities",{...ne,id:void 0,nombre:`${ne.nombre} (Copia)`,carpetaId:Q});window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Q,type:"entity",item:te}}))}catch(ne){console.error("Duplicate failed:",ne)}},V=async(K,Q="entidadindividual")=>{const ne=typeof K=="object"?K.slug||K.id:K;r(`${N}/folder/${ne}/entity/new/${Q}`)},q=async(K,Q)=>{try{await Ke.put(`/world-bible/folders/${K}`,{nombre:Q}),o(ne=>ne.map(te=>te.id===K?{...te,nombre:Q}:te))}catch(ne){throw ne}},D=(K,Q=null)=>{T({id:K,parentId:Q,type:"folder"}),C(!0)},U=async()=>{if(!_)return;const{id:K,parentId:Q,type:ne,folderId:te}=_;try{ne==="folder"?(await Ke.delete(`/world-bible/folders/${K}`),Q===null&&o(X=>X.filter(re=>re.id!==K)),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Q,removeId:K,type:"folder"}}))):ne==="entity"&&(await Ke.delete(`/world-bible/entities/${K}`),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:te,removeId:K,type:"entity"}})))}catch(X){console.error("Deletion failed:",X),alert("Error trying to delete item.")}finally{T(null)}},G=(K,Q)=>{T({id:K,folderId:Q,type:"entity"}),C(!0)},Z=async(K,Q,ne,te,X)=>{try{if(ne==="folder")typeof K=="number"&&!K.toString().startsWith("temp")&&(await Ke.put(`/world-bible/folders/${K}`,{nombre:Q}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:te,confirmedType:"folder",oldId:K,item:{id:K,nombre:Q,parentId:te,tipo:X,uiKey:Date.now()}}})),te||o(re=>re.map(he=>he.id===K?{...he,nombre:Q}:he)));else if(ne==="entity")if(typeof K=="string"&&K.startsWith("new-")){const re=await Ke.post("/world-bible/entities",{nombre:Q,carpetaId:te,tipoEspecial:X||"entidadindividual"});window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:te,confirmedType:"entity",oldId:K,item:re}}))}else await Ke.put(`/world-bible/entities/${K}`,{nombre:Q}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:te,confirmedType:"entity",oldId:K,item:{id:K,nombre:Q,carpeta:{id:te},tipoEspecial:X,slug:K}}})),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:te}}))}catch(re){console.error("Creation/Rename failed",re),ne==="folder"&&D(K,te)}};return m.jsxs("div",{className:"flex h-full w-full bg-background-dark max-w-[1920px] mx-auto",children:[m.jsx("main",{className:"flex-1 overflow-hidden relative bg-gradient-to-br from-background-dark to-surface-dark/20",children:m.jsx(Wk,{context:{...i,folders:s,searchTerm:p,setSearchTerm:g,filterType:y,setFilterType:S,handleCreateEntity:V,handleOpenCreateModal:I,handleDeleteFolder:D,handleRenameFolder:q,handleDeleteEntity:G,handleMoveEntity:F,handleDuplicateEntity:z,handleCreateSimpleFolder:j,handleConfirmCreate:Z}})}),m.jsx(Bie,{isOpen:l,onClose:()=>u(!1),onCreate:O,parentFolder:c}),m.jsx(qv,{isOpen:w,onClose:()=>C(!1),onConfirm:U,title:_?.type==="folder"?a("bible.delete_folder"):a("bible.delete_entity"),message:_?.type==="folder"?a("bible.delete_folder_msg"):a("bible.delete_entity_msg"),confirmText:a("common.confirm_delete")})]})},Uie=()=>{const{username:t,projectName:e}=Va();Ga();const{handleOpenCreateModal:r,handleDeleteFolder:n,handleCreateSimpleFolder:i,handleRenameFolder:a,folders:s=[]}=bo(),{t:o}=Ps(),[l,u]=ie.useState(null),[c,h]=ie.useState(null),[p,g]=ie.useState(""),y=(C,_)=>{C.preventDefault(),C.stopPropagation(),u({x:C.clientX,y:C.clientY,folder:_})},S=()=>u(null);ie.useEffect(()=>{if(l){const C=()=>S();return window.addEventListener("click",C),()=>window.removeEventListener("click",C)}},[l]);const w=async(C,_)=>{_.trim()&&a&&await a(C,_.trim()),h(null),g("")};return s===void 0?m.jsx("div",{className:"p-20 text-center animate-pulse text-text-muted",children:o("common.loading")}):m.jsxs("div",{className:"flex-1 p-8 max-w-[1600px] mx-auto w-full h-full overflow-y-auto",children:[m.jsxs("header",{className:"mb-8 flex items-end justify-between",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 text-xs font-black uppercase tracking-widest text-primary italic mb-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"auto_stories"}),o("nav.bible")]}),m.jsx("h1",{className:"text-4xl font-black text-white tracking-tighter",children:o("bible.root_index")}),m.jsx("p",{className:"text-text-muted mt-2 max-w-lg text-sm",children:o("bible.central_archive")})]}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs("button",{onClick:()=>i(null,"FOLDER"),className:"px-6 py-2 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold flex items-center gap-2 transition-all shadow-lg shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"create_new_folder"})," ",o("bible.new_folder")]})})]}),m.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:s.map(C=>c===C.id?m.jsx("div",{className:"p-4 rounded-3xl bg-surface-dark border border-primary/50",children:m.jsx("input",{autoFocus:!0,type:"text",value:p,onChange:_=>g(_.target.value),onKeyDown:_=>{_.key==="Enter"&&w(C.id,p),_.key==="Escape"&&(h(null),g(""))},onBlur:()=>w(C.id,p),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-primary/50 outline-none",placeholder:o("common.rename")})},C.id):m.jsx(ex,{item:C,type:"folder",linkTo:`/${t}/${e}/bible/folder/${C.slug||C.id}`,onDelete:()=>n(C.id),onContextMenu:_=>y(_,C)},C.id))}),s.length===0&&m.jsxs("div",{className:"p-20 text-center border-2 border-dashed border-glass-border rounded-[3rem] opacity-30 mt-8",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 text-text-muted",children:"library_books"}),m.jsx("h3",{className:"text-xl font-bold text-white uppercase tracking-widest",children:o("bible.empty_archive")}),m.jsx("p",{className:"text-text-muted mt-2",children:o("bible.empty_archive_desc")})]}),l&&m.jsxs("div",{className:"fixed bg-surface-dark border border-glass-border shadow-2xl rounded-xl py-2 z-50 w-52 text-xs font-medium flex flex-col animate-in fade-in zoom-in-95 duration-150",style:{top:l.y,left:l.x},onClick:C=>C.stopPropagation(),children:[m.jsxs("div",{className:"px-4 py-2 border-b border-white/5 font-bold text-text-muted truncate flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"folder"}),l.folder.nombre]}),m.jsxs("button",{className:"px-4 py-2.5 hover:bg-white/5 text-left flex items-center gap-3 text-white/80 hover:text-white transition-colors",onClick:()=>{h(l.folder.id),g(l.folder.nombre),S()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," ",o("common.rename")]}),m.jsxs("button",{className:"px-4 py-2.5 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-3 transition-colors",onClick:()=>{n(l.folder.id),S()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," ",o("bible.delete_folder")]})]})]})};function Gie(){const[t,e]=ie.useState("deep_space"),[r,n]=ie.useState(null);return ie.useEffect(()=>{const i=localStorage.getItem("app_settings");if(i){const o=JSON.parse(i);o.theme&&e(o.theme)}const a=localStorage.getItem("user");a&&a!=="undefined"&&n(JSON.parse(a));const s=()=>{const o=localStorage.getItem("app_settings");if(o){const u=JSON.parse(o);u.theme&&e(u.theme)}const l=localStorage.getItem("user");l&&l!=="undefined"&&n(JSON.parse(l))};return window.addEventListener("storage_update",s),()=>window.removeEventListener("storage_update",s)},[]),ie.useEffect(()=>{document.body.classList.forEach(i=>{i.startsWith("theme-")&&document.body.classList.remove(i)}),document.body.classList.add(`theme-${t}`)},[t]),m.jsx(uj,{children:m.jsx("div",{className:`app-container theme-${t} h-screen w-screen overflow-hidden`,children:m.jsx(X8,{children:m.jsxs(V8,{children:[m.jsx(qn,{path:"/",element:m.jsx(UI,{})}),m.jsxs(qn,{element:m.jsx(DI,{}),children:[m.jsx(qn,{path:"/settings",element:m.jsx(dj,{})}),m.jsxs(qn,{path:"/:username/:projectName",element:m.jsx(vj,{}),children:[m.jsx(qn,{index:!0,element:m.jsx(cj,{})}),m.jsx(qn,{path:"writing",element:m.jsx(Nie,{})}),m.jsx(qn,{path:"writing/:notebookId",element:m.jsx(Tie,{})}),m.jsx(qn,{path:"entities/:type/:entityId",element:m.jsx(pG,{})}),m.jsx(qn,{path:"map-editor/create/:folderId",element:m.jsx(ek,{mode:"create"})}),m.jsx(qn,{path:"map-editor/edit/:entityId",element:m.jsx(ek,{mode:"edit"})}),m.jsxs(qn,{path:"bible",element:m.jsx(zie,{}),children:[m.jsx(qn,{index:!0,element:m.jsx(Uie,{})}),m.jsx(qn,{path:"folder/:folderSlug/entity/new/:type",element:m.jsx(Vg,{mode:"creation"})}),m.jsx(qn,{path:"folder/:folderSlug",element:m.jsx(Fie,{})}),m.jsx(qn,{path:"entity/:entitySlug",element:m.jsx(Vg,{})}),m.jsx(qn,{path:"folder/:folderSlug/entity/:entitySlug",element:m.jsx(Vg,{})}),m.jsx(qn,{path:"folder/:folderSlug/map/:entitySlug",element:m.jsx(Vg,{})}),m.jsx(qn,{path:"folder/:folderSlug/timeline/:entitySlug",element:m.jsx(Vg,{})})]}),m.jsx(qn,{path:"map",element:m.jsx(zH,{})}),m.jsx(qn,{path:"timeline",element:m.jsx(mG,{})}),m.jsx(qn,{path:"languages",element:m.jsx(WK,{})}),m.jsx(qn,{path:"trash",element:m.jsx(Pie,{})}),m.jsx(qn,{path:"graph",element:m.jsx(uG,{})})]})]})]})})})})}const PC=(t,e,r,n="")=>{fetch("/api/logs/error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source:t,message:e,stack:r,componentStack:n})}).catch(i=>console.error("Failed to send error log:",i))};window.onerror=(t,e,r,n,i)=>{PC("Global Window Error",t,i?i.stack:`${e}:${r}:${n}`)};window.onunhandledrejection=t=>{PC("Unhandled Promise Rejection",t.reason?t.reason.message:"Unknown reason",t.reason?t.reason.stack:"")};class Vie extends ir.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,r){this.setState({error:e,errorInfo:r}),console.error("Uncaught Error:",e,r),PC("React ErrorBoundary",e.message,e.stack,r.componentStack)}render(){return this.state.hasError?m.jsxs("div",{style:{padding:20,background:"#222",color:"red",height:"100vh"},children:[m.jsx("h1",{children:"Something went wrong."}),m.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),m.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}):this.props.children}}const aM=document.getElementById("root");aM?XD.createRoot(aM).render(m.jsx(ir.StrictMode,{children:m.jsx(Vie,{children:m.jsx(Gie,{})})})):console.error("React root element not found (looked for #root)")});export default Hie();
